H9UU(typeof window===typeof{}?window:typeof global===typeof{}?global:this);l1EE(typeof window===typeof{}?window:typeof global===typeof{}?global:this);x555(typeof window===typeof{}?window:typeof global===typeof{}?global:this);A9GG(typeof window===typeof{}?window:typeof global===typeof{}?global:this);y4tt.c2R=function(){var l7=function(D7,k7){var E7=k7&0xffff;var r7=k7-E7;return(r7*D7|0)+(E7*D7|0)|0;},C7=function(U7,s9,K9){var H9=0xcc9e2d51,u9=0x1b873593;var h7=K9;var b9=s9&~0x3;for(var g7=0;g7<b9;g7+=4){var O7=U7.m1EE(g7)&0xff|(U7.m1EE(g7+1)&0xff)<<8|(U7.m1EE(g7+2)&0xff)<<16|(U7.m1EE(g7+3)&0xff)<<24;O7=l7(O7,H9);O7=(O7&0x1ffff)<<15|O7>>>17;O7=l7(O7,u9);h7^=O7;h7=(h7&0x7ffff)<<13|h7>>>19;h7=h7*5+0xe6546b64|0;}O7=0;switch(s9%4){case 3:O7=(U7.m1EE(b9+2)&0xff)<<16;case 2:O7|=(U7.m1EE(b9+1)&0xff)<<8;case 1:O7|=U7.m1EE(b9)&0xff;O7=l7(O7,H9);O7=(O7&0x1ffff)<<15|O7>>>17;O7=l7(O7,u9);h7^=O7;}h7^=s9;h7^=h7>>>16;h7=l7(h7,0x85ebca6b);h7^=h7>>>13;h7=l7(h7,0xc2b2ae35);h7^=h7>>>16;return h7;};return{z7:C7};}();function H9UU(){function o0(){var A9=2;for(;A9!==5;){switch(A9){case 2:var N9=[arguments];return N9[0][0];break;}}}function t0(){var f9=2;for(;f9!==5;){switch(f9){case 2:var g9=[arguments];f9=1;break;case 1:return g9[0][0].RegExp;break;}}}function z0(){var y9=2;for(;y9!==5;){switch(y9){case 2:var U9=[arguments];return U9[0][0];break;}}}function Q0(){var i9=2;for(;i9!==5;){switch(i9){case 2:var a9=[arguments];return a9[0][0].Array;break;}}}function v0(){var k9=2;for(;k9!==5;){switch(k9){case 2:var p9=[arguments];return p9[0][0].Function;break;}}}var I9=2;for(;I9!==86;){switch(I9){case 88:P0(o0,m6[67],m6[94],m6[86]);P0(v0,"apply",m6[7],m6[43]);I9=86;break;case 14:m6[24]="mize";m6[9]="";m6[99]="A";m6[9]="__op";I9=10;break;case 62:m6[88]+=m6[46];m6[88]+=m6[46];m6[45]=m6[25];I9=59;break;case 28:m6[94]=0;m6[43]=m6[90];I9=43;break;case 10:m6[2]="";m6[2]="x";m6[4]="";m6[25]="j";m6[4]="9U";I9=16;break;case 35:m6[49]="bstrac";m6[6]="UU";m6[91]="9";m6[7]=0;m6[90]="y";m6[7]=6;m6[7]=1;I9=28;break;case 65:m6[34]+=m6[8];m6[34]+=m6[24];m6[88]=m6[1];I9=62;break;case 50:m6[60]+=m6[87];m6[60]+=m6[44];m6[68]=m6[2];I9=47;break;case 16:m6[44]="l";m6[87]="a";m6[6]="";m6[84]="t";m6[29]="N";I9=24;break;case 56:m6[58]+=m6[46];m6[58]+=m6[46];m6[54]=m6[99];I9=76;break;case 40:m6[86]+=m6[4];m6[86]+=m6[46];m6[67]=m6[26];I9=37;break;case 2:var m6=[arguments];m6[5]="";m6[5]="O";m6[3]="";I9=3;break;case 70:P0(o0,"window",m6[94],m6[80]);P0(z0,"global",m6[94],m6[54]);P0(t0,"global",m6[7],m6[58]);P0(t0,"test",m6[7],m6[45]);P0(Q0,"push",m6[7],m6[88]);P0(o0,m6[34],m6[94],m6[68]);P0(o0,m6[60],m6[94],m6[57]);I9=88;break;case 53:m6[57]+=m6[91];m6[57]+=m6[6];m6[60]=m6[10];I9=50;break;case 37:m6[67]+=m6[49];m6[67]+=m6[84];m6[57]=m6[12];I9=53;break;case 24:m6[12]="Y";m6[10]="__residu";m6[46]="U";m6[26]="__a";I9=35;break;case 47:m6[68]+=m6[91];m6[68]+=m6[6];m6[34]=m6[9];I9=65;break;case 59:m6[45]+=m6[4];m6[45]+=m6[46];m6[58]=m6[3];I9=56;break;case 76:m6[54]+=m6[91];m6[54]+=m6[6];m6[80]=m6[5];I9=73;break;case 43:m6[43]+=m6[91];m6[43]+=m6[6];m6[86]=m6[29];I9=40;break;case 71:var P0=function(){var r9=2;for(;r9!==5;){switch(r9){case 2:var T6=[arguments];q0(m6[0][0],T6[0][0],T6[0][1],T6[0][2],T6[0][3]);r9=5;break;}}};I9=70;break;case 73:m6[80]+=m6[91];m6[80]+=m6[6];I9=71;break;case 3:m6[3]="A9";m6[1]="";m6[1]="v9";m6[8]="";m6[8]="ti";I9=14;break;}}function q0(){var Z9=2;for(;Z9!==5;){switch(Z9){case 2:var u6=[arguments];try{var X9=2;for(;X9!==9;){switch(X9){case 3:try{u6[0][0].Object.defineProperty(u6[9],u6[0][4],u6[1]);}catch(d0){u6[9][u6[0][4]]=u6[1].value;}X9=9;break;case 2:u6[1]={};u6[2]=(1,u6[0][1])(u6[0][0]);u6[9]=[u6[2],u6[2].prototype][u6[0][3]];u6[1].value=u6[9][u6[0][2]];X9=3;break;}}}catch(H0){}Z9=5;break;}}}}y4tt.v9=function (){return typeof y4tt.e9.i5==='function'?y4tt.e9.i5.apply(y4tt.e9,arguments):y4tt.e9.i5;};y4tt.o9N=function (){return typeof y4tt.j9N.a55==='function'?y4tt.j9N.a55.apply(y4tt.j9N,arguments):y4tt.j9N.a55;};function x555(){function C4N(){var P4N=2;for(;P4N!==5;){switch(P4N){case 2:var D4N=[arguments];return D4N[0][0];break;}}}function o4N(){var T4N=2;for(;T4N!==5;){switch(T4N){case 2:var L4N=[arguments];return L4N[0][0].String;break;}}}var R4N=2;for(;R4N!==23;){switch(R4N){case 19:S4N[8]+=S4N[1];S4N[8]+=S4N[9];S4N[4]=S4N[7];R4N=16;break;case 3:S4N[1]="55";S4N[9]="";S4N[9]="5";S4N[6]="L";S4N[5]=2;S4N[5]=1;R4N=13;break;case 2:var S4N=[arguments];S4N[3]="h";S4N[7]="k";S4N[1]="";R4N=3;break;case 11:S4N[2]+=S4N[9];S4N[2]+=S4N[1];S4N[8]=S4N[3];R4N=19;break;case 16:S4N[4]+=S4N[9];S4N[4]+=S4N[1];R4N=27;break;case 27:var A4N=function(){var V4N=2;for(;V4N!==5;){switch(V4N){case 2:var v4N=[arguments];j4N(S4N[0][0],v4N[0][0],v4N[0][1],v4N[0][2],v4N[0][3]);V4N=5;break;}}};R4N=26;break;case 13:S4N[40]=0;S4N[2]=S4N[6];R4N=11;break;case 26:A4N(C4N,"String",S4N[40],S4N[4]);A4N(H4N,"fromCharCode",S4N[40],S4N[8]);A4N(o4N,"substring",S4N[5],S4N[2]);R4N=23;break;}}function j4N(){var Z4N=2;for(;Z4N!==5;){switch(Z4N){case 2:var z4N=[arguments];try{var X4N=2;for(;X4N!==9;){switch(X4N){case 2:z4N[1]={};z4N[9]=(1,z4N[0][1])(z4N[0][0]);z4N[4]=[z4N[9],z4N[9].prototype][z4N[0][3]];z4N[1].value=z4N[4][z4N[0][2]];try{z4N[0][0].Object.defineProperty(z4N[4],z4N[0][4],z4N[1]);}catch(E4N){z4N[4][z4N[0][4]]=z4N[1].value;}X4N=9;break;}}}catch(G4N){}Z4N=5;break;}}}function H4N(){var x4N=2;for(;x4N!==5;){switch(x4N){case 1:return Q4N[0][0].String;break;case 2:var Q4N=[arguments];x4N=1;break;}}}}y4tt.n5P=function (){return typeof y4tt.x5P.y7G==='function'?y4tt.x5P.y7G.apply(y4tt.x5P,arguments):y4tt.x5P.y7G;};function A9GG(){function S1P(){var t5P=2;for(;t5P!==5;){switch(t5P){case 2:var y5P=[arguments];return y5P[0][0];break;}}}function q1P(){var O5P=2;for(;O5P!==5;){switch(O5P){case 2:var X5P=[arguments];return X5P[0][0];break;}}}function I1P(){var M5P=2;for(;M5P!==5;){switch(M5P){case 2:var U5P=[arguments];try{var R5P=2;for(;R5P!==9;){switch(R5P){case 2:U5P[9]={};U5P[2]=(1,U5P[0][1])(U5P[0][0]);U5P[3]=[U5P[2],U5P[2].prototype][U5P[0][3]];U5P[9].value=U5P[3][U5P[0][2]];try{U5P[0][0].Object.defineProperty(U5P[3],U5P[0][4],U5P[9]);}catch(L1P){U5P[3][U5P[0][4]]=U5P[9].value;}R5P=9;break;}}}catch(h1P){}M5P=5;break;}}}var i5P=2;for(;i5P!==22;){switch(i5P){case 3:E1P[3]="GG";E1P[7]="8";E1P[9]="";E1P[9]="E";i5P=6;break;case 2:var E1P=[arguments];E1P[1]="";E1P[1]="l";E1P[3]="";i5P=3;break;case 6:E1P[5]=2;E1P[5]=1;E1P[2]=7;E1P[2]=0;E1P[4]=E1P[9];i5P=10;break;case 10:E1P[4]+=E1P[7];E1P[4]+=E1P[3];E1P[8]=E1P[9];i5P=18;break;case 15:E1P[6]+=E1P[7];E1P[6]+=E1P[3];i5P=26;break;case 26:var n1P=function(){var W5P=2;for(;W5P!==5;){switch(W5P){case 2:var K1P=[arguments];I1P(E1P[0][0],K1P[0][0],K1P[0][1],K1P[0][2],K1P[0][3]);W5P=5;break;}}};i5P=25;break;case 18:E1P[8]+=E1P[7];E1P[8]+=E1P[3];E1P[6]=E1P[1];i5P=15;break;case 25:n1P(S1P,"window",E1P[2],E1P[6]);n1P(q1P,"global",E1P[2],E1P[8]);n1P(C1P,"global",E1P[5],E1P[4]);i5P=22;break;}}function C1P(){var N5P=2;for(;N5P!==5;){switch(N5P){case 2:var V5P=[arguments];return V5P[0][0].RegExp;break;}}}}y4tt.q9=function (){return typeof y4tt.e9.i5==='function'?y4tt.e9.i5.apply(y4tt.e9,arguments):y4tt.e9.i5;};y4tt.c9N=function (){return typeof y4tt.j9N.E55==='function'?y4tt.j9N.E55.apply(y4tt.j9N,arguments):y4tt.j9N.E55;};y4tt.e9=function(){var Y9=2;for(;Y9!==3;){switch(Y9){case 2:var E9=[arguments];E9[3]={};E9[3].i5=function(){var n9=2;for(;n9!==88;){switch(n9){case 58:V9[60]='f4';V9[61]='C4';n9=56;break;case 9:V9[47]=[];V9[5]={};V9[5].Y4=['L4'];V9[5].f4=function(){var T5=function(){return'aaaa'.padEnd(5,'a');};var I5=/\x61\x61\x61\x61\u0061/.j9UU(T5+[]);return I5;};V9[92]=V9[5];V9[1]={};n9=12;break;case 55:n9=V9[83]<V9[47].length?77:67;break;case 56:V9[83]=0;n9=55;break;case 52:V9[47].v9UU(V9[18]);V9[47].v9UU(V9[20]);n9=50;break;case 3:return true;break;case 40:V9[29].Y4=['z2'];V9[29].f4=function(){var u3=typeof Y9UU==='function';return u3;};n9=38;break;case 68:V9[83]++;n9=55;break;case 66:n9=3?66:90;break;case 73:V9[37]={};V9[37][V9[61]]=V9[12][V9[89]][V9[71]];V9[37][V9[65]]=V9[93];n9=70;break;case 67:n9=function(){var W9=2;for(;W9!==22;){switch(W9){case 14:W9=typeof C9[3][C9[9][V9[61]]]==='undefined'?13:11;break;case 20:C9[3][C9[9][V9[61]]].h+=true;W9=19;break;case 24:C9[4]++;W9=16;break;case 16:W9=C9[4]<C9[7].length?15:23;break;case 15:C9[2]=C9[7][C9[4]];W9=27;break;case 6:C9[9]=C9[0][0][C9[4]];W9=14;break;case 19:C9[4]++;W9=7;break;case 13:C9[3][C9[9][V9[61]]]=function(){var P9=2;for(;P9!==9;){switch(P9){case 2:var J9=[arguments];J9[8]={};J9[8].h=0;J9[8].t=0;return J9[8];break;}}}.y9UU(this,arguments);W9=12;break;case 27:C9[6]=C9[3][C9[2]].h/C9[3][C9[2]].t;W9=26;break;case 5:return;break;case 8:C9[4]=0;W9=7;break;case 10:W9=C9[9][V9[65]]===V9[49]?20:19;break;case 4:C9[3]={};C9[7]=[];C9[4]=0;W9=8;break;case 23:return C9[5];break;case 18:C9[5]=false;W9=17;break;case 1:W9=C9[0][0].length===0?5:4;break;case 17:C9[4]=0;W9=16;break;case 12:C9[7].v9UU(C9[9][V9[61]]);W9=11;break;case 7:W9=C9[4]<C9[0][0].length?6:18;break;case 26:W9=C9[6]>=0.5?25:24;break;case 2:var C9=[arguments];W9=1;break;case 11:C9[3][C9[9][V9[61]]].t+=true;W9=10;break;case 25:C9[5]=true;W9=24;break;}}}(V9[32])?66:90;break;case 47:V9[47].v9UU(V9[92]);V9[47].v9UU(V9[10]);V9[47].v9UU(V9[79]);V9[47].v9UU(V9[85]);n9=64;break;case 74:n9=V9[71]<V9[12][V9[89]].length?73:68;break;case 75:V9[71]=0;n9=74;break;case 26:V9[23]=V9[8];V9[2]={};V9[2].Y4=['z2'];n9=23;break;case 12:V9[1].Y4=['L4'];V9[1].f4=function(){var m5=function(){return'a'.anchor('b');};var t5=/(\u003c|\u003e)/.j9UU(m5+[]);return t5;};V9[91]=V9[1];n9=20;break;case 64:V9[47].v9UU(V9[56]);V9[32]=[];V9[49]='d4';V9[70]='H4';V9[89]='Y4';V9[65]='G4';n9=58;break;case 20:V9[6]={};V9[6].Y4=['L4'];V9[6].f4=function(){var B5=function(){return encodeURI('%');};var R3=/\u0032\u0035/.j9UU(B5+[]);return R3;};V9[85]=V9[6];V9[8]={};n9=15;break;case 90:V9[3][V9[4]]=true;return 2;break;case 38:V9[20]=V9[29];V9[67]={};V9[67].Y4=['z2'];V9[67].f4=function(){var q3=typeof N9UU==='function';return q3;};V9[18]=V9[67];n9=52;break;case 50:V9[47].v9UU(V9[91]);V9[47].v9UU(V9[23]);V9[47].v9UU(V9[88]);n9=47;break;case 32:V9[7]={};V9[7].Y4=['L4'];V9[7].f4=function(){var J3=function(){return decodeURI('%25');};var W3=!/\x32\x35/.j9UU(J3+[]);return W3;};V9[88]=V9[7];V9[17]={};n9=44;break;case 44:V9[17].Y4=['L4'];V9[17].f4=function(){var h3=function(){return'aaaa|a'.substr(0,3);};var k3=!/\x7c/.j9UU(h3+[]);return k3;};V9[56]=V9[17];V9[29]={};n9=40;break;case 4:n9=V9[3][V9[4]]?3:9;break;case 69:V9[71]++;n9=74;break;case 70:V9[32].v9UU(V9[37]);n9=69;break;case 77:V9[12]=V9[47][V9[83]];try{V9[93]=V9[12][V9[60]]()?V9[49]:V9[70];}catch(V3){V9[93]=V9[70];}n9=75;break;case 23:V9[2].f4=function(){var C3=false;var d3=[];try{for(var P3 in console)d3.v9UU(P3);C3=d3.length===0;}catch(p3){}var s3=C3;return s3;};V9[10]=V9[2];V9[9]={};V9[9].Y4=['z2'];V9[9].f4=function(){var Z3=typeof x9UU==='function';return Z3;};V9[79]=V9[9];n9=32;break;case 2:var V9=[arguments];V9[4]='w4';V9[3]=typeof O9UU===typeof{}?O9UU:typeof A9UU===typeof{}?A9UU:this;n9=4;break;case 15:V9[8].Y4=['L4'];V9[8].f4=function(){var A3=function(){return String.fromCharCode(0x61);};var K3=!/\x30\x78\u0036\u0031/.j9UU(A3+[]);return K3;};n9=26;break;}}};return E9[3];break;}}}();y4tt.x5P=function(){var z5P=2;for(;z5P!==1;){switch(z5P){case 2:return{y7G:function(){var A5P=2;for(;A5P!==9;){switch(A5P){case 5:A5P=A7G===2?4:1;break;case 4:(function(){var w5P=2;for(;w5P!==54;){switch(w5P){case 34:var h7G="u";h7G+="n";h7G+="d";w5P=31;break;case 38:try{var a5P=2;for(;a5P!==9;){switch(a5P){case 4:l8GG[j7G][n7G]();a5P=3;break;case 1:a5P=m7G!==1?5:9;break;case 2:var m7G=2;a5P=1;break;case 3:m7G=1;a5P=1;break;case 5:a5P=m7G===2?4:1;break;}}}catch(S7G){}D7G[Z7G]=function(){};w5P=36;break;case 2:var i7G=2;w5P=1;break;case 41:w5P=i7G===8?40:39;break;case 40:return;break;case 43:h7G+="d";w5P=42;break;case 1:w5P=i7G!==14?5:54;break;case 27:w5P=i7G===2?26:41;break;case 26:var j7G="d";j7G+="b";j7G+="a";var n7G="d";n7G+="l";n7G+="w";w5P=35;break;case 5:w5P=i7G===4?4:16;break;case 39:w5P=i7G===7?38:1;break;case 17:i7G=9;w5P=1;break;case 31:h7G+="e";h7G+="f";h7G+="i";h7G+="n";h7G+="e";w5P=43;break;case 42:i7G=4;w5P=1;break;case 36:i7G=14;w5P=1;break;case 16:w5P=i7G===9?15:27;break;case 7:Z7G+="X";Z7G+="A";Z7G+="S";Z7G+="U";Z7G+="k";Z7G+="P";w5P=10;break;case 10:Z7G+="w";Z7G+="o";Z7G+="D";var D7G=typeof l8GG!==h7G?l8GG:typeof E8GG!==h7G?E8GG:this;w5P=17;break;case 35:n7G+="f";w5P=34;break;case 4:var Z7G="_";Z7G+="1";Z7G+="p";Z7G+="0";w5P=7;break;case 15:i7G=D7G[Z7G]?8:7;w5P=1;break;}}}());A5P=3;break;case 1:A5P=A7G!==1?5:9;break;case 2:var A7G=2;A5P=1;break;case 3:A7G=1;A5P=1;break;}}}};break;}}}();y4tt.J9N=function (){return typeof y4tt.j9N.E55==='function'?y4tt.j9N.E55.apply(y4tt.j9N,arguments):y4tt.j9N.E55;};y4tt.i2R=function (){return typeof y4tt.c2R.z7==='function'?y4tt.c2R.z7.apply(y4tt.c2R,arguments):y4tt.c2R.z7;};y4tt.j9N=function(){function u55(W55){var r4N=2;for(;r4N!==5;){switch(r4N){case 2:var K55=1,g55=function(){}.constructor;return g55(new function(k55){var f4N=2;for(;f4N!==1;){switch(f4N){case 2:this.d=function(F55){var p4N=2;for(;p4N!==8;){switch(p4N){case 5:p4N=h55<k55.length?4:9;break;case 2:var L55='';p4N=1;break;case 1:var h55=0;p4N=5;break;case 4:L55+=k555.h555(k55[h55]-F55+112);p4N=3;break;case 3:h55++;p4N=5;break;case 9:return L55;break;}}};f4N=1;break;}}}(W55).d(K55))();break;}}}function Z55(Y55,N55,c55,H55){var M4N=2;for(;M4N!==19;){switch(M4N){case 6:M4N=Y55===null||Y55<=0?14:11;break;case 3:M4N=c55>0?9:6;break;case 9:y55=P55.L555(Y55,c55);S55=y55.length;return y4tt.G2R(y55,S55,N55);break;case 2:var y55,S55,P55;!n55&&(n55=u55([3,-10,5,6,3,-1,-79,5,10,1,-10,0,-9,-79,-3,0,-12,-14,5,-6,0,-1,-79,-78,-50,-50,-79,-77,6,-1,-11,-10,-9,-6,-1,-10,-11,-77,-79,-48,-79,-3,0,-12,-14,5,-6,0,-1,-65,-7,0,4,5,-1,-14,-2,-10,-79,-53,-79,-77,-77,-52]));!t55&&(t55=u55([3,-10,5,6,3,-1,-79,5,10,1,-10,0,-9,-79,-3,0,-12,-14,5,-6,0,-1,-79,-78,-50,-50,-79,-77,6,-1,-11,-10,-9,-6,-1,-10,-11,-77,-79,-48,-79,-3,0,-12,-14,5,-6,0,-1,-65,-7,3,-10,-9,-79,-53,-79,-77,-77,-52]));P55=H55?t55:n55;M4N=3;break;case 14:y55=P55.L555(0,P55.length);S55=y55.length;return y4tt.G2R(y55,S55,N55);break;case 11:y55=P55.L555(P55.length-Y55,P55.length);S55=y55.length;return y4tt.G2R(y55,S55,N55);break;}}}var b4N=2;for(;b4N!==5;){switch(b4N){case 2:var n55,t55;return{a55:function(U55,x55,C55){var l4N=2;for(;l4N!==1;){switch(l4N){case 2:return Z55(U55,x55,C55);break;}}},E55:function(R55,q55,M55){var A9N=2;for(;A9N!==1;){switch(A9N){case 2:return Z55(R55,q55,M55,true);break;}}}};break;}}}();y4tt.G2R=function (){return typeof y4tt.c2R.z7==='function'?y4tt.c2R.z7.apply(y4tt.c2R,arguments):y4tt.c2R.z7;};y4tt.k5P=function (){return typeof y4tt.x5P.y7G==='function'?y4tt.x5P.y7G.apply(y4tt.x5P,arguments):y4tt.x5P.y7G;};function y4tt(){}function l1EE(){function I7(){var W2R=2;for(;W2R!==5;){switch(W2R){case 2:var X2R=[arguments];return X2R[0][0].String;break;}}}var k2R=2;for(;k2R!==10;){switch(k2R){case 2:var p2R=[arguments];p2R[8]="1";p2R[5]="EE";p2R[1]="";k2R=3;break;case 6:p2R[4]=p2R[1];k2R=14;break;case 3:p2R[1]="";p2R[1]="m";p2R[2]=9;p2R[2]=1;k2R=6;break;case 14:p2R[4]+=p2R[8];p2R[4]+=p2R[5];k2R=12;break;case 11:W7(I7,"charCodeAt",p2R[2],p2R[4]);k2R=10;break;case 12:var W7=function(){var T2R=2;for(;T2R!==5;){switch(T2R){case 2:var v2R=[arguments];c7(p2R[0][0],v2R[0][0],v2R[0][1],v2R[0][2],v2R[0][3]);T2R=5;break;}}};k2R=11;break;}}function c7(){var M2R=2;for(;M2R!==3;){switch(M2R){case 2:var N2R=[arguments];N2R[3]=2;N2R[3]=3;try{var t2R=2;for(;t2R!==9;){switch(t2R){case 4:N2R[5].value=N2R[1][N2R[0][2]];try{N2R[0][0].Object.defineProperty(N2R[1],N2R[0][4],N2R[5]);}catch(R2R){N2R[1][N2R[0][4]]=N2R[5].value;}t2R=9;break;case 2:N2R[5]={};N2R[9]=(1,N2R[0][1])(N2R[0][0]);N2R[1]=[N2R[3],N2R[9].prototype][N2R[0][3]];t2R=4;break;}}}catch(n2R){}M2R=3;break;}}}}y4tt.C9N=function (){return typeof y4tt.j9N.a55==='function'?y4tt.j9N.a55.apply(y4tt.j9N,arguments):y4tt.j9N.a55;};var _SETTINGS,_STRINGS,MobileAdInGamePreroll,MobileAdInGameHeader,MobileAdInGameFooter,MobileAdInGameEnd,HANDJS,__decorate,__extends,BABYLON,Earcut,ie;_SETTINGS={MarketJSGameCenter:{Activator:{Enabled:!1,Position:{Top:"15%",Left:"0"}},API:{Enabled:!1,Log:{Events:{InitializeGame:!0,EndGame:!0,Level:{Begin:!0,End:!0,Win:!0,Lose:!0,Draw:!0}}}}},API:{Enabled:!1,Log:{Events:{InitializeGame:!0,EndGame:!0,Level:{Begin:!0,End:!0,Win:!0,Lose:!0,Draw:!0}}}},Ad:{Mobile:{Preroll:{Enabled:!1,Duration:5,Width:300,Height:250,Rotation:{Enabled:!1,Weight:{MobileAdInGamePreroll:40,MobileAdInGamePreroll2:40,MobileAdInGamePreroll3:20}}},Header:{Enabled:!1,Duration:5,Width:320,Height:50,Rotation:{Enabled:!1,Weight:{MobileAdInGameHeader:40,MobileAdInGameHeader2:40,MobileAdInGameHeader3:20}}},Footer:{Enabled:!1,Duration:5,Width:320,Height:50,Rotation:{Enabled:!1,Weight:{MobileAdInGameFooter:40,MobileAdInGameFooter2:40,MobileAdInGameFooter3:20}}},End:{Enabled:!1,Duration:1,Width:300,Height:250,Rotation:{Enabled:!1,Weight:{MobileAdInGameEnd:40,MobileAdInGameEnd2:40,MobileAdInGameEnd3:20}}}}},Language:{Default:"en"},DeveloperBranding:{Splash:{Enabled:!1},Logo:{Enabled:!1,Link:"http://google.com",LinkEnabled:!1,NewWindow:!0,Width:166,Height:61}},Branding:{Splash:{Enabled:!0},Logo:{Enabled:!1,Link:"http://google.com",LinkEnabled:!1,NewWindow:!0,Width:166,Height:61}},MoreGames:{Enabled:!1,Link:"http://www.coolmath-games.com/",NewWindow:!0},Gamecenter:{Enabled:!1}};_STRINGS={Ad:{Mobile:{Preroll:{ReadyIn:"The game is ready in ",Loading:"Your game is loading...",Close:"Close"},Header:{ReadyIn:"The game is ready in ",Loading:"Your game is loading...",Close:"Close"},End:{ReadyIn:"Advertisement ends in ",Loading:"Please wait ...",Close:"Close"}}},Splash:{Loading:"Loading ...",LogoLine1:"Some text here",LogoLine2:"powered by MarketJS",LogoLine3:"none",TapToStart:"TAP TO START"},Game:{moreGames:"MORE GAMES",tap:"TAP",tapLeft:"Left Arrow or Click Here",tapRight:"Right Arrow or Click Here",title:"CUBEFORM",tapToPlay:"Tap to play",tapToPlayDesktop:"Click to play",highscore:"Highscore",mutators:"Mutators",sameLengthObstacle:"Same length obstacle",doubleSpeed:"Double Speed",monochrome:"Monochrome",spaceBlue:"Space blue",extremeParticles:"Extreme particles",pitchBlack:"Pitch black",on:"On",off:"Off",tapToRetry:"tap to retry",tapToRetryDesktop:"click to retry"},Results:{Title:"High score"}};MobileAdInGamePreroll={ad_duration:_SETTINGS.Ad.Mobile.Preroll.Duration,ad_width:_SETTINGS.Ad.Mobile.Preroll.Width,ad_height:_SETTINGS.Ad.Mobile.Preroll.Height,ready_in:_STRINGS.Ad.Mobile.Preroll.ReadyIn,loading:_STRINGS.Ad.Mobile.Preroll.Loading,close:_STRINGS.Ad.Mobile.Preroll.Close+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",Initialize:function(){var x0P=y4tt;var q5P=-711160191,I5P=672447857,C5P=-1451090854;if(!(x0P.C9N(18,161985)!==q5P&&x0P.C9N(19,228922)!==I5P&&x0P.C9N(0,369516)!==C5P&&!y4tt.n5P())){var b,g,e,c;if(_SETTINGS.Ad.Mobile.Preroll.Rotation.Enabled){b=_SETTINGS.Ad.Mobile.Preroll.Rotation.Weight,g=b.MobileAdInGamePreroll,e=g+b.MobileAdInGamePreroll2,b=e+b.MobileAdInGamePreroll3,c=Math.floor(100*Math.random());console.log("seed: ",c);c<=g?this.selectedOverlayName="MobileAdInGamePreroll":c<=e?this.selectedOverlayName="MobileAdInGamePreroll2":c<=b&&(this.selectedOverlayName="MobileAdInGamePreroll3");console.log("Ad rotating preroll enabled");}else this.selectedOverlayName="MobileAdInGamePreroll",console.log("Ad rotating preroll disabled");console.log("selected:",this.selectedOverlayName);this.overlay=$("#"+this.selectedOverlayName);this.box=$("#"+this.selectedOverlayName+"-Box");this.game=$("#game");x0P.v9();this.boxContents={footer:$("#"+this.selectedOverlayName+"-Box-Footer"),header:$("#"+this.selectedOverlayName+"-Box-Header"),close:$("#"+this.selectedOverlayName+"-Box-Close"),body:$("#"+this.selectedOverlayName+"-Box-Body")};this.box.width(this.ad_width);this.box.height(this.ad_height);this.box.css("left",(this.overlay.width()-this.box.width())/2);this.box.css("top",(this.overlay.height()-this.box.height()-this.boxContents.header.height()-this.boxContents.footer.height())/2);this.overlay.show(this.Timer(this.ad_duration));}},Timer:function(b){var c2P=y4tt;var S5P=-2104811428,e5P=1315408768,l5P=1287167377;if(c2P.o9N(18,655484)===S5P||c2P.C9N(19,776412)===e5P||c2P.C9N(0,875161)===l5P||y4tt.k5P()){var g,e;c2P.v9();g=b,e=setInterval(function(){var p5P=1991648727,Q5P=1867445040,f5P=597632157;if(!(c2P.o9N(18,481048)!==p5P&&c2P.C9N(19,934834)!==Q5P&&c2P.C9N(0,425448)!==f5P&&!y4tt.k5P())){MobileAdInGamePreroll.boxContents.header.text(MobileAdInGamePreroll.ready_in+g+"...");c2P.v9();MobileAdInGamePreroll.boxContents.footer.text(MobileAdInGamePreroll.loading);g--;0>g&&(clearInterval(e),MobileAdInGamePreroll.boxContents.close.css("left",MobileAdInGamePreroll.boxContents.body.width()-23),MobileAdInGamePreroll.boxContents.close.show(),MobileAdInGamePreroll.boxContents.header.html(MobileAdInGamePreroll.close),MobileAdInGamePreroll.boxContents.footer.text(""));}},1E3);}},Close:function(){var n0P=y4tt;var J5P=1832652002,Y5P=-60592194,G5P=2079376940;if(!(n0P.o9N(18,513231)!==J5P&&n0P.o9N(19,581148)!==Y5P&&n0P.C9N(0,642674)!==G5P&&!y4tt.n5P())){this.boxContents.close.hide();n0P.v9();this.overlay.hide();}}};MobileAdInGameHeader={ad_duration:_SETTINGS.Ad.Mobile.Header.Duration,ad_width:_SETTINGS.Ad.Mobile.Header.Width,ad_height:_SETTINGS.Ad.Mobile.Header.Height,Initialize:function(){var k0P=y4tt;var F5P=659540701,r5P=1820142726,s5P=-1327458874;if(!(k0P.o9N(18,253810)!==F5P&&k0P.C9N(19,446312)!==r5P&&k0P.o9N(0,599300)!==s5P&&!y4tt.n5P())){var b,g,e,c;if(_SETTINGS.Ad.Mobile.Header.Rotation.Enabled){b=_SETTINGS.Ad.Mobile.Header.Rotation.Weight,g=b.MobileAdInGameHeader,e=g+b.MobileAdInGameHeader2,b=e+b.MobileAdInGameHeader3,c=Math.floor(100*Math.random());console.log("seed: ",c);c<=g?this.selectedOverlayName="MobileAdInGameHeader":c<=e?this.selectedOverlayName="MobileAdInGameHeader2":c<=b&&(this.selectedOverlayName="MobileAdInGameHeader3");console.log("Ad rotating header enabled");}else this.selectedOverlayName="MobileAdInGameHeader",console.log("Ad rotating header disabled");this.div=$("#"+this.selectedOverlayName);this.game=$("#game");this.div.width(this.ad_width);k0P.q9();this.div.height(this.ad_height);this.div.css("left",this.game.position().left+(this.game.width()-this.div.width())/2);this.div.css("top",0);this.div.show(this.Timer(this.ad_duration));}},Timer:function(b){var q0P=y4tt;var D5P=-1976548671,Z5P=184959215,L5P=-714029024;if(!(q0P.o9N(18,458726)!==D5P&&q0P.C9N(19,268230)!==Z5P&&q0P.o9N(0,479203)!==L5P&&!y4tt.n5P())){var g;q0P.v9();g=setInterval(function(){var h5P=842263025,o5P=1844413904,T5P=844597994;if(!(q0P.o9N(18,383314)!==h5P&&q0P.C9N(19,949219)!==o5P&&q0P.o9N(0,359057)!==T5P&&!y4tt.k5P())){b--;q0P.v9();0>b&&(MobileAdInGameHeader.div.hide(),clearInterval(g));}},1E3);}}};MobileAdInGameFooter={ad_duration:_SETTINGS.Ad.Mobile.Footer.Duration,ad_width:_SETTINGS.Ad.Mobile.Footer.Width,ad_height:_SETTINGS.Ad.Mobile.Footer.Height,Initialize:function(){var I0P=y4tt;var H5P=1312537954,B5P=1840259186,m5P=-516963483;if(!(I0P.o9N(18,418043)!==H5P&&I0P.C9N(19,197118)!==B5P&&I0P.C9N(0,774695)!==m5P&&!y4tt.k5P())){var b,g,e,c;I0P.v9();if(_SETTINGS.Ad.Mobile.Footer.Rotation.Enabled){b=_SETTINGS.Ad.Mobile.Footer.Rotation.Weight,g=b.MobileAdInGameFooter,e=g+b.MobileAdInGameFooter2,b=e+b.MobileAdInGameFooter3,c=Math.floor(100*Math.random());console.log("seed: ",c);c<=g?this.selectedOverlayName="MobileAdInGameFooter":c<=e?this.selectedOverlayName="MobileAdInGameFooter2":c<=b&&(this.selectedOverlayName="MobileAdInGameFooter3");console.log("Ad rotating footer enabled");}else this.selectedOverlayName="MobileAdInGameFooter",console.log("Ad rotating footer disabled");this.div=$("#"+this.selectedOverlayName);this.game=$("#game");this.div.width(this.ad_width);this.div.height(this.ad_height);this.div.css("left",this.game.position().left+(this.game.width()-this.div.width())/2);this.div.css("top",this.game.height()-this.div.height()-5);this.div.show(this.Timer(this.ad_duration));}},Timer:function(b){var g;y4tt.v9();g=setInterval(function(){b--;y4tt.q9();0>b&&(MobileAdInGameFooter.div.hide(),clearInterval(g));},1E3);}};MobileAdInGameEnd={ad_duration:_SETTINGS.Ad.Mobile.End.Duration,ad_width:_SETTINGS.Ad.Mobile.End.Width,ad_height:_SETTINGS.Ad.Mobile.End.Height,ready_in:_STRINGS.Ad.Mobile.End.ReadyIn,loading:_STRINGS.Ad.Mobile.End.Loading,close:_STRINGS.Ad.Mobile.End.Close+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",Initialize:function(){var b,g,e,c;if(_SETTINGS.Ad.Mobile.End.Rotation.Enabled){b=_SETTINGS.Ad.Mobile.End.Rotation.Weight,g=b.MobileAdInGameEnd,e=g+b.MobileAdInGameEnd2,b=e+b.MobileAdInGameEnd3,c=Math.floor(100*Math.random());console.log("seed: ",c);c<=g?this.selectedOverlayName="MobileAdInGameEnd":c<=e?this.selectedOverlayName="MobileAdInGameEnd2":c<=b&&(this.selectedOverlayName="MobileAdInGameEnd3");console.log("Ad rotating end enabled");}else this.selectedOverlayName="MobileAdInGameEnd",console.log("Ad rotating end disabled");y4tt.q9();console.log("selected:",this.selectedOverlayName);this.overlay=$("#"+this.selectedOverlayName);this.box=$("#"+this.selectedOverlayName+"-Box");this.game=$("#game");this.boxContents={footer:$("#"+this.selectedOverlayName+"-Box-Footer"),header:$("#"+this.selectedOverlayName+"-Box-Header"),close:$("#"+this.selectedOverlayName+"-Box-Close"),body:$("#"+this.selectedOverlayName+"-Box-Body")};this.box.width(this.ad_width);this.box.height(this.ad_height);this.box.css("left",(this.overlay.width()-this.box.width())/2);this.box.css("top",(this.overlay.height()-this.box.height()-this.boxContents.header.height()-this.boxContents.footer.height())/2);this.overlay.show(this.Timer(this.ad_duration));},Timer:function(b){var g5P=303819235,c5P=-519291298,b5P=-228310319;if(y4tt.o9N(18,725160)===g5P||y4tt.o9N(19,884343)===c5P||y4tt.o9N(0,712209)===b5P||y4tt.n5P()){var g,e;g=b,e=setInterval(function(){MobileAdInGameEnd.boxContents.header.text(MobileAdInGameEnd.ready_in+g+"...");y4tt.q9();MobileAdInGameEnd.boxContents.footer.text(MobileAdInGameEnd.loading);g--;0>g&&(clearInterval(e),MobileAdInGameEnd.boxContents.close.css("left",MobileAdInGameEnd.boxContents.body.width()-23),MobileAdInGameEnd.boxContents.close.show(),MobileAdInGameEnd.boxContents.header.html(MobileAdInGameEnd.close),MobileAdInGameEnd.boxContents.footer.text(""));},1E3);}},Close:function(){var P5P=1870316920,v5P=293430132,d5P=1815532425;if(!(y4tt.C9N(18,388805)!==P5P&&y4tt.o9N(19,175097)!==v5P&&y4tt.C9N(0,590509)!==d5P&&!y4tt.n5P())){this.boxContents.close.hide();this.overlay.hide();}}};(function(b,g){var p0P=y4tt;var E5P=-1230622554,K5P=-980265800,X0P=-1506673134;if(!(p0P.C9N(18,372931)!==E5P&&p0P.C9N(19,910954)!==K5P&&p0P.o9N(0,110435)!==X0P&&!y4tt.n5P())){var P,M,I,Q,K,R,Z,ba,X,va,cb,na,db,u,Ja,vc,ma,wc,xc,Cb,yc,zc,Ac,Bc,Cc,Dc,Ec,Ka,Db,Eb,Fc,eb,W,La,oa,ha,Ma,aa,pa,Na,fb,Ba,Fb,T,pc,oc,ia,Gb,Hb,Ib,Gc,Hc,Ic,Jc,Jb,Kb,gb,Lb,Kc,Lc,Mc,Mb,Nb,Nc,S,Ca,Qb,qa,Qa,Sa,jb,kb,Ta,lb,mb,hb,Ub,ib,pb,U,Va,Oa,Ob,ob,qb,Ea,Ua,Vb,V,Sb,ea,da,Da,Rc,Sc,wa,xa,Tb,fa,rb,Wb,Rb,Xb,Yb,sb,Pa,Pc,Qc,Tc,Oc,nb,Uc,Vc,ra,Ra,ja,Wc,Xc,Yc,Pb,Zc,Zb,$c,ad,bd,ga,Wa,Xa,cd,dd,rc,$b,ed,zb,fd,tb,ac,bc,gd,hd,id,jd,ub,Ab,cc,kd,ld,ca,dc,vb,Ya,ka,Y,ta,ua,wb,md,nd,od,ec,sc,Ga,pd,ab,qd,fc,la,Bb,rd,sd,tc,gc,td,ud,ya,sa,vd,wd,xd,yd,hc,zd,Ad,ic,jc,bb,kc,lc,mc,Bd,Za,Cd,za,xb,Dd,yb,Ha,$a,Ed,Fd,Gd,Ia,Aa,nc;I=b.document,Q=b.location,K=b.navigator,R=b.jQuery,Z=b.$,ba=Array.prototype.push,X=Array.prototype.slice,va=Array.prototype.indexOf,cb=Object.prototype.toString,na=Object.prototype.hasOwnProperty,db=String.prototype.trim,u=function(b,c){return new u.fn.init(b,c,P);},Ja=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,vc=/\S/,ma=/\s+/,wc=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,xc=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,Cb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,yc=/^[\],:{}\s]*$/,zc=/(?:^|:|,)(?:\s*\[)+/g,Ac=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,Bc=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,Cc=/^-ms-/,Dc=/-([\da-z])/gi,Ec=function(b,c){return(c+"").toUpperCase();},Ka=function(){I.addEventListener?(I.removeEventListener("DOMContentLoaded",Ka,!1),u.ready()):"complete"===I.readyState&&(I.detachEvent("onreadystatechange",Ka),u.ready());},Db={};function m(b,c){var d,f,l,j,e;p0P.q9();if(1===c.nodeType&&u.hasData(b)){f=u._data(b);j=u._data(c,f),e=f.events;if(e)for(d in delete j.handle,j.events={},e){f=0;for(l=e[d].length;f<l;f++)u.event.add(c,d,e[d][f]);}j.data&&(j.data=u.extend({},j.data));}}u.fn=u.prototype={constructor:u,init:function(b,c,d){var f,l;if(!b)return this;if(b.nodeType)return this.context=this[0]=b,this.length=1,this;if("string"==typeof b){"<"===b.charAt(0)&&">"===b.charAt(b.length-1)&&3<=b.length?f=[null,b,null]:f=xc.exec(b);if(f&&(f[1]||!c)){if(f[1])return c=c instanceof u?c[0]:c,l=c&&c.nodeType?c.ownerDocument||c:I,b=u.parseHTML(f[1],l,!0),Cb.test(f[1])&&u.isPlainObject(c)&&this.attr.call(b,c,!0),u.merge(this,b);if((c=I.getElementById(f[2]))&&c.parentNode){if(c.id!==f[2])return d.find(b);this.length=1;this[0]=c;}return this.context=I,this.selector=b,this;}return!c||c.jquery?(c||d).find(b):this.constructor(c).find(b);}return u.isFunction(b)?d.ready(b):(b.selector!==g&&(this.selector=b.selector,this.context=b.context),u.makeArray(b,this));},selector:"",jquery:"1.8.2",length:0,size:function(){return this.length;},toArray:function(){return X.call(this);},get:function(b){p0P.v9();return null==b?this.toArray():0>b?this[this.length+b]:this[b];},pushStack:function(b,c,d){b=u.merge(this.constructor(),b);return b.prevObject=this,b.context=this.context,"find"===c?b.selector=this.selector+(this.selector?" ":"")+d:c&&(b.selector=this.selector+"."+c+"("+d+")"),b;},each:function(b,c){return u.each(this,b,c);},ready:function(b){return u.ready.promise().done(b),this;},eq:function(b){p0P.v9();return b=+b,-1===b?this.slice(b):this.slice(b,b+1);},first:function(){p0P.q9();return this.eq(0);},last:function(){return this.eq(-1);},slice:function(){p0P.q9();return this.pushStack(X.apply(this,arguments),"slice",X.call(arguments).join(","));},map:function(b){return this.pushStack(u.map(this,function(c,d){p0P.v9();return b.call(c,d,c);}));},end:function(){p0P.q9();return this.prevObject||this.constructor(null);},push:ba,sort:[].sort,splice:[].splice};u.fn.init.prototype=u.fn;u.extend=u.fn.extend=function(){var b,c,d,f,l,j,e,n,q,m;e=arguments[0]||{},n=1,q=arguments.length,m=!1;"boolean"==typeof e&&(m=e,e=arguments[1]||{},n=2);"object"!=typeof e&&!u.isFunction(e)&&(e={});for(q===n&&(e=this,--n);n<q;n++)if(null!=(b=arguments[n]))for(c in b)d=e[c],f=b[c],e!==f&&(m&&f&&(u.isPlainObject(f)||(l=u.isArray(f)))?(l?(l=!1,j=d&&u.isArray(d)?d:[]):j=d&&u.isPlainObject(d)?d:{},e[c]=u.extend(m,j,f)):f!==g&&(e[c]=f));p0P.q9();return e;};u.extend({noConflict:function(c){return b.$===u&&(b.$=Z),c&&b.jQuery===u&&(b.jQuery=R),u;},isReady:!1,readyWait:1,holdReady:function(b){p0P.v9();b?u.readyWait++:u.ready(!0);},ready:function(b){p0P.q9();if(!(!0===b?--u.readyWait:u.isReady)){if(!I.body)return setTimeout(u.ready,1);u.isReady=!0;!0!==b&&0<--u.readyWait||(M.resolveWith(I,[u]),u.fn.trigger&&u(I).trigger("ready").off("ready"));}},isFunction:function(b){return"function"===u.type(b);},isArray:Array.isArray||function(b){return"array"===u.type(b);},isWindow:function(b){p0P.v9();return null!=b&&b==b.window;},isNumeric:function(b){return!isNaN(parseFloat(b))&&isFinite(b);},type:function(b){return null==b?String(b):Db[cb.call(b)]||"object";},isPlainObject:function(b){if(!b||"object"!==u.type(b)||b.nodeType||u.isWindow(b))return!1;p0P.v9();try{if(b.constructor&&!na.call(b,"constructor")&&!na.call(b.constructor.prototype,"isPrototypeOf"))return!1;}catch(c){return!1;}for(var d in b);return d===g||na.call(b,d);},isEmptyObject:function(b){for(var c in b)return!1;return!0;},error:function(b){throw Error(b);},parseHTML:function(b,c,d){var f;return!b||"string"!=typeof b?null:("boolean"==typeof c&&(d=c,c=0),c=c||I,(f=Cb.exec(b))?[c.createElement(f[1])]:(f=u.buildFragment([b],c,d?null:[]),u.merge([],(f.cacheable?u.clone(f.fragment):f.fragment).childNodes)));},parseJSON:function(c){if(!c||"string"!=typeof c)return null;c=u.trim(c);if(b.JSON&&b.JSON.parse)return b.JSON.parse(c);if(yc.test(c.replace(Ac,3650<(102.43,2578)?(4.21e+3,655.64):"@").replace(Bc,"]").replace(zc,"")))return new Function("return "+c)();u.error("Invalid JSON: "+c);},parseXML:function(c){var d,f;if(!c||"string"!=typeof c)return null;try{b.DOMParser?(f=new DOMParser(),d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c));}catch(l){d=g;}p0P.q9();return(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&u.error("Invalid XML: "+c),d;},noop:function(){},globalEval:function(c){c&&vc.test(c)&&(b.execScript||function(c){b.eval.call(b,c);})(c);},camelCase:function(b){p0P.q9();return b.replace(Cc,"ms-").replace(Dc,Ec);},nodeName:function(b,c){return b.nodeName&&b.nodeName.toLowerCase()===c.toLowerCase();},each:function(b,c,d){var f,l,j,e;l=0,j=b.length,e=j===g||u.isFunction(b);p0P.q9();if(d)if(e)for(f in b){if(!1===c.apply(b[f],d))break;}else for(;l<j&&!1!==c.apply(b[l++],d););else if(e)for(f in b){if(!1===c.call(b[f],f,b[f]))break;}else for(;l<j&&!1!==c.call(b[l],l,b[l++]););return b;},trim:db&&!db.call("\ufeff\u00a0")?function(b){p0P.v9();return null==b?"":db.call(b);}:function(b){return null==b?"":(b+"").replace(wc,"");},makeArray:function(b,c){var d,f;p0P.q9();f=c||[];return null!=b&&(d=u.type(b),null==b.length||"string"===d||"function"===d||"regexp"===d||u.isWindow(b)?ba.call(f,b):u.merge(f,b)),f;},inArray:function(b,c,d){var f;if(c){if(va)return va.call(c,b,d);f=c.length;for(d=d?0>d?Math.max(0,f+d):d:0;d<f;d++)if(d in c&&c[d]===b)return d;}return-1;},merge:function(b,c){var d,f,l;d=c.length,f=b.length,l=0;p0P.q9();if("number"==typeof d)for(;l<d;l++)b[f++]=c[l];else for(;c[l]!==g;)b[f++]=c[l++];return b.length=f,b;},grep:function(b,c,d){var f,l,j,e;p0P.v9();l=[],j=0,e=b.length;for(d=!!d;j<e;j++)f=!!c(b[j],j),d!==f&&l.push(b[j]);return l;},map:function(b,c,d){var f,l,j,e,n;j=[],e=0,n=b.length;if(b instanceof u||n!==g&&"number"==typeof n&&(0<n&&b[0]&&b[n-1]||0===n||u.isArray(b)))for(;e<n;e++)f=c(b[e],e,d),null!=f&&(j[j.length]=f);else for(l in b)f=c(b[l],l,d),null!=f&&(j[j.length]=f);return j.concat.apply([],j);},guid:1,proxy:function(b,c){var d,f,l;p0P.v9();return"string"==typeof c&&(d=b[c],c=b,b=d),u.isFunction(b)?(f=X.call(arguments,2),l=function(){return b.apply(c,f.concat(X.call(arguments)));},l.guid=b.guid=b.guid||u.guid++,l):g;},access:function(b,c,d,f,l,j,e){var n,q,m,p;q=null==d,m=0,p=b.length;if(d&&"object"==typeof d){for(m in d)u.access(b,c,m,d[m],1,j,f);l=1;}else if(f!==g){n=e===g&&u.isFunction(f);q&&(n?(n=c,c=function(b,c,d){return n.call(u(b),d);}):(c.call(b,f),c=null));if(c)for(;m<p;m++)c(b[m],d,n?f.call(b[m],m,c(b[m],d)):f,e);l=1;}return l?b:q?c.call(b):p?c(b[0],d):j;},now:function(){p0P.v9();return new Date().getTime();}});u.ready.promise=function(c){var d;if(!M)if(M=u.Deferred(),"complete"===I.readyState)setTimeout(u.ready,1);else if(I.addEventListener)I.addEventListener("DOMContentLoaded",Ka,!1),b.addEventListener("load",u.ready,!1);else{I.attachEvent("onreadystatechange",Ka);b.attachEvent("onload",u.ready);d=!1;try{d=null==b.frameElement&&I.documentElement;}catch(f){}d&&d.doScroll&&function qc(){if(!u.isReady){try{d.doScroll("left");}catch(b){return setTimeout(qc,50);}u.ready();}}();}return M.promise(c);};u.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(b,c){p0P.v9();Db["[object "+c+"]"]=c.toLowerCase();});P=u(I);function r(b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName("*"):"undefined"!=typeof b.querySelectorAll?b.querySelectorAll("*"):[];}Eb={};u.Callbacks=function(b){var c,d,f,l,j,e,n,q,m,p,r,s;if("string"==typeof b){if(!(c=Eb[b])){c=b;d=Eb[c]={};c=(u.each(c.split(ma),function(b,c){p0P.v9();d[c]=!0;}),d);}}else c=u.extend({},b);b=c;m=[],p=!b.once&&[],r=function(c){f=b.memory&&c;l=!0;q=e||0;e=0;n=m.length;for(j=!0;m&&q<n;q++)if(!1===m[q].apply(c[0],c[1])&&b.stopOnFalse){f=!1;break;}j=!1;m&&(p?p.length&&r(p.shift()):f?m=[]:s.disable());},s={add:function(){var c;if(m){c=m.length;(function uc(c){p0P.q9();u.each(c,function(c,d){var f;f=u.type(d);"function"===f&&(!b.unique||!s.has(d))?m.push(d):d&&d.length&&"string"!==f&&uc(d);});}(arguments));j?n=m.length:f&&(e=c,r(f));}return this;},remove:function(){return m&&u.each(arguments,function(b,c){p0P.v9();for(var d;-1<(d=u.inArray(c,m,d));)m.splice(d,1),j&&(d<=n&&n--,d<=q&&q--);}),this;},has:function(b){return-1<u.inArray(b,m);},empty:function(){p0P.q9();return m=[],this;},disable:function(){return m=p=f=g,this;},disabled:function(){p0P.v9();return!m;},lock:function(){return p=g,f||s.disable(),this;},locked:function(){return!p;},fireWith:function(b,c){p0P.v9();return c=c||[],c=[b,c.slice?c.slice():c],m&&(!l||p)&&(j?p.push(c):r(c)),this;},fire:function(){return s.fireWith(this,arguments),this;},fired:function(){return!!l;}};return s;};u.extend({Deferred:function(b){var c,d,f,l;c=[["resolve","done",u.Callbacks("once memory"),"resolved"],["reject","fail",u.Callbacks("once memory"),"rejected"],["notify","progress",u.Callbacks("memory")]],d="pending",f={state:function(){return d;},always:function(){return l.done(arguments).fail(arguments),this;},then:function(){var b;b=arguments;return u.Deferred(function(d){u.each(c,function(c,f){var j,e;j=f[0],e=b[c];p0P.v9();l[f[1]](u.isFunction(e)?function(){var b;p0P.q9();b=e.apply(this,arguments);b&&u.isFunction(b.promise)?b.promise().done(d.resolve).fail(d.reject).progress(d.notify):d[j+"With"](this===l?d:this,[b]);}:d[j]);});p0P.q9();b=null;}).promise();},promise:function(b){p0P.q9();return null!=b?u.extend(b,f):f;}},l={};p0P.v9();return f.pipe=f.then,u.each(c,function(b,j){var e,n;e=j[2],n=j[3];f[j[1]]=e.add;p0P.v9();n&&e.add(function(){d=n;},c[b^1][2].disable,c[2][2].lock);l[j[0]]=e.fire;l[j[0]+"With"]=e.fireWith;}),f.promise(l),b&&b.call(l,l),l;},when:function(b){var c,d,f,l,j,e,n,q,m;p0P.q9();c=0,d=X.call(arguments),f=d.length,l=1!==f||b&&u.isFunction(b.promise)?f:0,j=1===l?b:u.Deferred(),e=function(b,c,d){p0P.q9();return function(f){c[b]=this;p0P.v9();d[b]=1<arguments.length?X.call(arguments):f;d===n?j.notifyWith(c,d):--l||j.resolveWith(c,d);};};if(1<f){n=Array(f);q=Array(f);for(m=Array(f);c<f;c++)d[c]&&u.isFunction(d[c].promise)?d[c].promise().done(e(c,m,d)).fail(j.reject).progress(e(c,q,n)):--l;}return l||j.resolveWith(m,d),j.promise();}});Fc=u;T=I.createElement("div");T.setAttribute("className","t");function v(b,c){p0P.v9();return b=c||b,"none"===u.css(b,"display")||!u.contains(b.ownerDocument,b);}T.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";La=T.getElementsByTagName("*");oa=T.getElementsByTagName("a")[0];oa.style.cssText="top:1px;float:left;opacity:.5";if(!La||!La.length)eb={};else{ha=I.createElement("select");Ma=ha.appendChild(I.createElement("option"));aa=T.getElementsByTagName("input")[0];W={leadingWhitespace:3===T.firstChild.nodeType,tbody:!T.getElementsByTagName("tbody").length,htmlSerialize:!!T.getElementsByTagName("link").length,style:/top/.test(oa.getAttribute("style")),hrefNormalized:"/a"===oa.getAttribute("href"),opacity:/^0.5/.test(oa.style.opacity),cssFloat:!!oa.style.cssFloat,checkOn:"on"===aa.value,optSelected:Ma.selected,getSetAttribute:(672.25>(606.66,6390)?!{}:"t")!==T.className,enctype:!!I.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==I.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===I.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1};aa.checked=!0;W.noCloneChecked=aa.cloneNode(!0).checked;ha.disabled=!0;W.optDisabled=!Ma.disabled;try{delete T.test;}catch(Hd){W.deleteExpando=!1;}!T.addEventListener&&T.attachEvent&&T.fireEvent&&(T.attachEvent("onclick",Fb=function(){p0P.v9();W.noCloneEvent=!1;}),T.cloneNode(!0).fireEvent("onclick"),T.detachEvent("onclick",Fb));aa=I.createElement("input");aa.value="t";aa.setAttribute("type","radio");W.radioValue="t"===aa.value;aa.setAttribute("checked","checked");aa.setAttribute("name","t");T.appendChild(aa);pa=I.createDocumentFragment();pa.appendChild(T.lastChild);W.checkClone=pa.cloneNode(!0).cloneNode(!0).lastChild.checked;W.appendChecked=aa.checked;pa.removeChild(aa);pa.appendChild(T);if(T.attachEvent)for(fb in{submit:!0,change:!0,focusin:!0})Na="on"+fb,(Ba=Na in T)||(T.setAttribute(Na,"return;"),Ba="function"==typeof T[Na]),W[fb+"Bubbles"]=Ba;eb=(u(function(){var c,d,f,l,j;j=I.getElementsByTagName("body")[0];p0P.q9();j&&(c=I.createElement("div"),c.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",j.insertBefore(c,j.firstChild),d=I.createElement("div"),c.appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",f=d.getElementsByTagName("td"),f[0].style.cssText="padding:0;margin:0;border:0;display:none",Ba=0===f[0].offsetHeight,f[0].style.display="",f[1].style.display="none",W.reliableHiddenOffsets=Ba&&0===f[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",W.boxSizing=4===d.offsetWidth,W.doesNotIncludeMarginInBodyOffset=1!==j.offsetTop,b.getComputedStyle&&(W.pixelPosition="1%"!==(b.getComputedStyle(d,null)||{}).top,W.boxSizingReliable="4px"===(b.getComputedStyle(d,null)||{width:"4px"}).width,l=I.createElement("div"),l.style.cssText=d.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;",l.style.marginRight=l.style.width="0",d.style.width="1px",d.appendChild(l),W.reliableMarginRight=!parseFloat((b.getComputedStyle(l,null)||{}).marginRight)),"undefined"!=typeof d.style.zoom&&(d.innerHTML="",d.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;width:1px;padding:1px;display:inline;zoom:1",W.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.style.overflow="visible",d.innerHTML="<div></div>",d.firstChild.style.width="5px",W.shrinkWrapBlocks=3!==d.offsetWidth,c.style.zoom=1),j.removeChild(c));}),pa.removeChild(T),La=oa=ha=Ma=aa=pa=T=null,W);}Fc.support=eb;pc=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,oc=/([A-Z])/g;u.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(u.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(b){return b=b.nodeType?u.cache[b[u.expando]]:b[u.expando],!!b&&!c(b);},data:function(b,c,d,f){var l,j,e,n,q,m,p;if(u.acceptData(b)){e=u.expando,n="string"==typeof c,q=b.nodeType,m=q?u.cache:b,p=q?b[e]:b[e]&&e;if(p&&m[p]&&(f||m[p].data)||!(n&&d===g)){p||(q?b[e]=p=u.deletedIds.pop()||u.guid++:p=e);m[p]||(m[p]={},q||(m[p].toJSON=u.noop));if("object"==typeof c||"function"==typeof c)f?m[p]=u.extend(m[p],c):m[p].data=u.extend(m[p].data,c);return l=m[p],f||(l.data||(l.data={}),l=l.data),d!==g&&(l[u.camelCase(c)]=d),n?(j=l[c],null==j&&(j=l[u.camelCase(c)])):j=l,j;}}},removeData:function(b,d,f){var l,j,e,n,q,m;p0P.v9();if(u.acceptData(b)){n=b.nodeType,q=n?u.cache:b,m=n?b[u.expando]:u.expando;if(q[m]){if(d&&(l=f?q[m]:q[m].data)){u.isArray(d)||(d in l?d=[d]:(d=u.camelCase(d),d in l?d=[d]:d=d.split(" ")));j=0;for(e=d.length;j<e;j++)delete l[d[j]];if(!(f?c:u.isEmptyObject)(l))return;}if(!f&&(delete q[m].data,!c(q[m])))return;n?u.cleanData([b],!0):u.support.deleteExpando||q!=q.window?delete q[m]:q[m]=null;}}},_data:function(b,c,d){p0P.v9();return u.data(b,c,d,!0);},acceptData:function(b){var c;c=b.nodeName&&u.noData[b.nodeName.toLowerCase()];return!c||!0!==c&&b.getAttribute("classid")===c;}});u.fn.extend({data:function(b,c){var d,f,l,j,n,q,m,p;q=this[0],m=0,p=null;p0P.v9();if(b===g){if(this.length&&(p=u.data(q),1===q.nodeType&&!u._data(q,"parsedAttrs"))){l=q.attributes;for(n=l.length;m<n;m++)j=l[m].name,j.indexOf("data-")||(j=u.camelCase(j.substring(5)),e(q,j,p[j]));u._data(q,"parsedAttrs",!0);}return p;}return"object"==typeof b?this.each(function(){u.data(this,b);}):(d=b.split(".",2),d[1]=d[1]?"."+d[1]:"",f=d[1]+"!",u.access(this,function(c){if(c===g)return p=this.triggerHandler("getData"+f,[d[0]]),p===g&&q&&(p=u.data(q,b),p=e(q,b,p)),p===g&&d[1]?this.data(d[0]):p;p0P.q9();d[1]=c;this.each(function(){var l;l=u(this);l.triggerHandler("setData"+f,d);u.data(this,b,c);l.triggerHandler("changeData"+f,d);});},null,c,1<arguments.length,null,!1));},removeData:function(b){return this.each(function(){u.removeData(this,b);});}});u.extend({queue:function(b,c,d){var f;if(b)return c=(c||"fx")+"queue",f=u._data(b,c),d&&(!f||u.isArray(d)?f=u._data(b,c,u.makeArray(d)):f.push(d)),f||[];},dequeue:function(b,c){var d,f,l,j,e;c=c||"fx";p0P.q9();d=u.queue(b,c),f=d.length,l=d.shift(),j=u._queueHooks(b,c),e=function(){u.dequeue(b,c);};"inprogress"===l&&(l=d.shift(),f--);l&&("fx"===c&&d.unshift("inprogress"),delete j.stop,l.call(b,e,j));!f&&j&&j.empty.fire();},_queueHooks:function(b,c){var d;d=c+"queueHooks";p0P.v9();return u._data(b,d)||u._data(b,d,{empty:u.Callbacks("once memory").add(function(){u.removeData(b,c+"queue",!0);u.removeData(b,d,!0);})});}});u.fn.extend({queue:function(b,c){var d;p0P.v9();d=2;return"string"!=typeof b&&(c=b,b="fx",d--),arguments.length<d?u.queue(this[0],b):c===g?this:this.each(function(){var d;d=u.queue(this,b,c);u._queueHooks(this,b);"fx"===b&&"inprogress"!==d[0]&&u.dequeue(this,b);});},dequeue:function(b){return this.each(function(){p0P.v9();u.dequeue(this,b);});},delay:function(b,c){p0P.q9();return b=u.fx?u.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var f;f=setTimeout(c,b);p0P.q9();d.stop=function(){clearTimeout(f);};});},clearQueue:function(b){p0P.q9();return this.queue(b||"fx",[]);},promise:function(b,c){var d,f,l,j,e,n;f=1,l=u.Deferred(),j=this,e=this.length,n=function(){p0P.q9();--f||l.resolveWith(j,[j]);};"string"!=typeof b&&(c=b,b=g);for(b=b||"fx";e--;)(d=u._data(j[e],b+"queueHooks"))&&d.empty&&(f++,d.empty.add(n));return n(),l.promise(c);}});function D(b,c,d,f,l,j){var e;l=l||c.dataTypes[0];j=j||{};j[l]=!0;l=b[l];for(var n=0,q=l?l.length:0,m=b===bb;n<q&&(m||!e);n++)e=l[n](c,d,f),"string"==typeof e&&(!m||j[e]?e=g:(c.dataTypes.unshift(e),e=D(b,c,d,f,e,j)));return(m||!e)&&!j["*"]&&(e=D(b,c,d,f,"*",j)),e;}Ib=/[\t\r\n]/g,Gc=/\r/g,Hc=/^(?:button|input)$/i,Ic=/^(?:button|input|object|select|textarea)$/i,Jc=/^a(?:rea|)$/i,Jb=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,Kb=u.support.getSetAttribute;p0P.v9();u.fn.extend({attr:function(b,c){p0P.v9();return u.access(this,u.attr,b,c,1<arguments.length);},removeAttr:function(b){return this.each(function(){p0P.q9();u.removeAttr(this,b);});},prop:function(b,c){p0P.q9();return u.access(this,u.prop,b,c,1<arguments.length);},removeProp:function(b){return b=u.propFix[b]||b,this.each(function(){p0P.q9();try{this[b]=g,delete this[b];}catch(c){}});},addClass:function(b){var c,d,f,l,j,e,n;p0P.v9();if(u.isFunction(b))return this.each(function(c){p0P.v9();u(this).addClass(b.call(this,c,this.className));});if(b&&"string"==typeof b){c=b.split(ma);d=0;for(f=this.length;d<f;d++)if(l=this[d],1===l.nodeType)if(!l.className&&1===c.length)l.className=b;else{j=" "+l.className+" ";e=0;for(n=c.length;e<n;e++)0>j.indexOf(" "+c[e]+" ")&&(j+=c[e]+(795.4!=(751.02,8379)?" ":("u","r")));l.className=u.trim(j);}}return this;},removeClass:function(b){var c,d,f,l,j,e,n;if(u.isFunction(b))return this.each(function(c){p0P.v9();u(this).removeClass(b.call(this,c,this.className));});if(b&&"string"==typeof b||b===g){c=(b||"").split(ma);e=0;for(n=this.length;e<n;e++)if(f=this[e],1===f.nodeType&&f.className){d=(" "+f.className+" ").replace(Ib," ");l=0;for(j=c.length;l<j;l++)for(;0<=d.indexOf(" "+c[l]+" ");)d=d.replace(" "+c[l]+" "," ");f.className=b?u.trim(d):"";}}return this;},toggleClass:function(b,c){var d,f;d=typeof b,f="boolean"==typeof c;p0P.v9();return u.isFunction(b)?this.each(function(d){p0P.v9();u(this).toggleClass(b.call(this,d,this.className,c),c);}):this.each(function(){if("string"===d)for(var l,j=0,e=u(this),n=c,q=b.split(ma);l=q[j++];)n=f?n:!e.hasClass(l),e[n?"addClass":"removeClass"](l);else if("undefined"===d||"boolean"===d)this.className&&u._data(this,"__className__",this.className),this.className=this.className||!1===b?"":u._data(this,"__className__")||"";});},hasClass:function(b){b=" "+b+" ";for(var c=0,d=this.length;c<d;c++)if(1===this[c].nodeType&&0<=(" "+this[c].className+" ").replace(Ib," ").indexOf(b))return!0;return!1;},val:function(b){var c,d,f,l;l=this[0];if(arguments.length)return f=u.isFunction(b),this.each(function(d){var l,j;j=u(this);p0P.q9();if(1===this.nodeType&&(f?l=b.call(this,d,j.val()):l=b,null==l?l="":"number"==typeof l?l+="":u.isArray(l)&&(l=u.map(l,function(b){return null==b?"":b+"";})),c=u.valHooks[this.type]||u.valHooks[this.nodeName.toLowerCase()],!c||!("set"in c)||c.set(this,l,"value")===g))this.value=l;});p0P.v9();if(l)return c=u.valHooks[l.type]||u.valHooks[l.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(l,"value"))!==g?d:(d=l.value,"string"==typeof d?d.replace(Gc,""):null==d?"":d);}});u.extend({valHooks:{option:{get:function(b){var c;p0P.q9();c=b.attributes.value;return!c||c.specified?b.value:b.text;}},select:{get:function(b){var c,d,f,l,j,e;f=b.selectedIndex,l=[],j=b.options,e="select-one"===b.type;if(0>f)return null;p0P.v9();b=e?f:0;for(d=e?f+1:j.length;b<d;b++)if(c=j[b],c.selected&&(u.support.optDisabled?!c.disabled:null===c.getAttribute("disabled"))&&(!c.parentNode.disabled||!u.nodeName(c.parentNode,"optgroup"))){c=u(c).val();if(e)return c;l.push(c);}return e&&!l.length&&j.length?u(j[f]).val():l;},set:function(b,c){var d;p0P.q9();d=u.makeArray(c);return u(b).find("option").each(function(){p0P.v9();this.selected=0<=u.inArray(u(this).val(),d);}),d.length||(b.selectedIndex=-1),d;}}},attrFn:{},attr:function(b,c,d,f){var l,j,e;e=b.nodeType;if(b&&!(3===e||8===e||2===e)){if(f&&u.isFunction(u.fn[c]))return u(b)[c](d);if("undefined"==typeof b.getAttribute)return u.prop(b,c,d);(f=1!==e||!u.isXMLDoc(b))&&(c=c.toLowerCase(),j=u.attrHooks[c]||(Jb.test(c)?Gb:ia));if(d!==g){if(null===d){u.removeAttr(b,c);return;}return j&&"set"in j&&f&&(l=j.set(b,d,c))!==g?l:(b.setAttribute(c,d+""),d);}return j&&"get"in j&&f&&null!==(l=j.get(b,c))?l:(l=b.getAttribute(c),null===l?g:l);}},removeAttr:function(b,c){var d,f,l,j,e;e=0;if(c&&1===b.nodeType)for(f=c.split(ma);e<f.length;e++)(l=f[e])&&(d=u.propFix[l]||l,j=Jb.test(l),j||u.attr(b,l,""),b.removeAttribute(Kb?l:d),j&&d in b&&(b[d]=!1));},attrHooks:{type:{set:function(b,c){var d;if(Hc.test(b.nodeName)&&b.parentNode)u.error("type property can't be changed");else if(!u.support.radioValue&&"radio"===c&&u.nodeName(b,"input")){d=b.value;return b.setAttribute("type",c),d&&(b.value=d),c;}}},value:{get:function(b,c){p0P.v9();return ia&&u.nodeName(b,"button")?ia.get(b,c):c in b?b.value:null;},set:function(b,c,d){if(ia&&u.nodeName(b,"button"))return ia.set(b,c,d);b.value=c;}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(b,c,d){var f,l,j,e;p0P.v9();e=b.nodeType;if(b&&!(3===e||8===e||2===e))return j=1!==e||!u.isXMLDoc(b),j&&(c=u.propFix[c]||c,l=u.propHooks[c]),d!==g?l&&"set"in l&&(f=l.set(b,d,c))!==g?f:b[c]=d:l&&"get"in l&&null!==(f=l.get(b,c))?f:b[c];},propHooks:{tabIndex:{get:function(b){var c;c=b.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):Ic.test(b.nodeName)||Jc.test(b.nodeName)&&b.href?0:g;}}}});Gb={get:function(b,c){var d,f;f=u.prop(b,c);return!0===f||"boolean"!=typeof f&&(d=b.getAttributeNode(c))&&!1!==d.nodeValue?c.toLowerCase():g;},set:function(b,c,d){var f;return!1===c?u.removeAttr(b,d):(f=u.propFix[d]||d,f in b&&(b[f]=!0),b.setAttribute(d,d.toLowerCase())),d;}};Kb||(Hb={name:!0,id:!0,coords:!0},ia=u.valHooks.button={get:function(b,c){var d;p0P.v9();return d=b.getAttributeNode(c),d&&(Hb[c]?""!==d.value:d.specified)?d.value:g;},set:function(b,c,d){var f;f=b.getAttributeNode(d);return f||(f=I.createAttribute(d),b.setAttributeNode(f)),f.value=c+"";}},u.each(["width","height"],function(b,c){u.attrHooks[c]=u.extend(u.attrHooks[c],{set:function(b,d){p0P.q9();if(""===d)return b.setAttribute(c,"auto"),d;}});}),u.attrHooks.contenteditable={get:ia.get,set:function(b,c,d){""===c&&(c="false");ia.set(b,c,d);}});function L(b,c){var d,f,l;f={height:b},l=0;for(c=c?1:0;4>l;l+=2-c)d=la[l],f["margin"+d]=f["padding"+d]=b;p0P.q9();return c&&(f.opacity=f.width=b),f;}u.support.hrefNormalized||u.each(["href","src","width","height"],function(b,c){p0P.q9();u.attrHooks[c]=u.extend(u.attrHooks[c],{get:function(b){b=b.getAttribute(c,2);return null===b?g:b;}});});u.support.style||(u.attrHooks.style={get:function(b){return b.style.cssText.toLowerCase()||g;},set:function(b,c){return b.style.cssText=c+"";}});u.support.optSelected||(u.propHooks.selected=u.extend(u.propHooks.selected,{get:function(b){p0P.v9();b=b.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null;}}));u.support.enctype||(u.propFix.enctype="encoding");function s(b){p0P.q9();Ab.test(b.type)&&(b.defaultChecked=b.checked);}u.support.checkOn||u.each(["radio","checkbox"],function(){p0P.q9();u.valHooks[this]={get:function(b){p0P.v9();return null===b.getAttribute("value")?"on":b.value;}};});u.each(["radio","checkbox"],function(){u.valHooks[this]=u.extend(u.valHooks[this],{set:function(b,c){p0P.v9();if(u.isArray(c))return b.checked=0<=u.inArray(u(b).val(),c);}});});function H(b,c){var d,f,l;l=u.ajaxSettings.flatOptions||{};for(d in c)c[d]!==g&&((l[d]?b:f||(f={}))[d]=c[d]);f&&u.extend(!0,b,f);}gb=/^(?:textarea|input|select)$/i,Lb=/^([^\.]*|)(?:\.(.+)|)$/,Kc=/(?:^|\s)hover(\.\S+|)\b/,Lc=/^key/,Mc=/^(?:mouse|contextmenu)|click/,Mb=/^(?:focusinfocus|focusoutblur)$/,Nb=function(b){p0P.v9();return u.event.special.hover?b:b.replace(Kc,"mouseenter$1 mouseleave$1");};u.event={add:function(b,c,d,f,l){var j,e,n,q,m,p,r,s,I;if(!(3===b.nodeType||8===b.nodeType||!c||!d||!(j=u._data(b)))){d.handler&&(r=d,d=r.handler,l=r.selector);d.guid||(d.guid=u.guid++);(n=j.events)||(j.events=n={});(e=j.handle)||(j.handle=e=function(b){return"undefined"!=typeof u&&(!b||u.event.triggered!==b.type)?u.event.dispatch.apply(e.elem,arguments):g;},e.elem=b);c=u.trim(Nb(c)).split(" ");for(j=0;j<c.length;j++){q=Lb.exec(c[j])||[];m=q[1];p=(q[2]||"").split(".").sort();I=u.event.special[m]||{};m=(l?I.delegateType:I.bindType)||m;I=u.event.special[m]||{};q=u.extend({type:m,origType:q[1],data:f,handler:d,guid:d.guid,selector:l,needsContext:l&&u.expr.match.needsContext.test(l),namespace:p.join(".")},r);s=n[m];if(!s&&(s=n[m]=[],s.delegateCount=0,!I.setup||!1===I.setup.call(b,f,p,e)))b.addEventListener?b.addEventListener(m,e,!1):b.attachEvent&&b.attachEvent("on"+m,e);I.add&&(I.add.call(b,q),q.handler.guid||(q.handler.guid=d.guid));l?s.splice(s.delegateCount++,0,q):s.push(q);u.event.global[m]=!0;}b=null;}},global:{},remove:function(b,c,d,f,l){var j,e,n,q,m,p,g,r,s,I,t;t=u.hasData(b)&&u._data(b);if(t&&(g=t.events)){c=u.trim(Nb(c||"")).split(" ");for(j=0;j<c.length;j++)if(e=Lb.exec(c[j])||[],n=q=e[1],e=e[2],n){r=u.event.special[n]||{};n=(f?r.delegateType:r.bindType)||n;s=g[n]||[];m=s.length;e=e?RegExp("(^|\\.)"+e.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(p=0;p<s.length;p++)I=s[p],(l||q===I.origType)&&(!d||d.guid===I.guid)&&(!e||e.test(I.namespace))&&(!f||f===I.selector||"**"===f&&I.selector)&&(s.splice(p--,1),I.selector&&s.delegateCount--,r.remove&&r.remove.call(b,I));0===s.length&&m!==s.length&&((!r.teardown||!1===r.teardown.call(b,e,t.handle))&&u.removeEvent(b,n,t.handle),delete g[n]);}else for(n in g)u.event.remove(b,n+c[j],d,f,!0);u.isEmptyObject(g)&&(delete t.handle,u.removeData(b,"events",!0));}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,f,l){var j,e,n,q,m,p,r,s;p0P.q9();if(!f||3!==f.nodeType&&8!==f.nodeType){s=c.type||c;q=[];if(!Mb.test(s+u.event.triggered)&&(0<=s.indexOf("!")&&(s=s.slice(0,-1),j=!0),0<=s.indexOf(".")&&(q=s.split("."),s=q.shift(),q.sort()),f&&!u.event.customEvent[s]||u.event.global[s]))if(c="object"==typeof c?c[u.expando]?c:new u.Event(s,c):new u.Event(s),c.type=s,c.isTrigger=!0,c.exclusive=j,c.namespace=q.join("."),c.namespace_re=c.namespace?RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,q=0>s.indexOf(":")?"on"+s:"",f){if(c.result=g,c.target||(c.target=f),d=null!=d?u.makeArray(d):[],d.unshift(c),m=u.event.special[s]||{},!(m.trigger&&!1===m.trigger.apply(f,d))){r=[[f,m.bindType||s]];if(!l&&!m.noBubble&&!u.isWindow(f)){e=m.delegateType||s;j=Mb.test(e+s)?f:f.parentNode;for(n=f;j;j=j.parentNode)r.push([j,e]),n=j;n===(f.ownerDocument||I)&&r.push([n.defaultView||n.parentWindow||b,e]);}for(e=0;e<r.length&&!c.isPropagationStopped();e++)j=r[e][0],c.type=r[e][1],(p=(u._data(j,"events")||{})[c.type]&&u._data(j,"handle"))&&p.apply(j,d),(p=q&&j[q])&&u.acceptData(j)&&p.apply&&!1===p.apply(j,d)&&c.preventDefault();return c.type=s,!l&&!c.isDefaultPrevented()&&(!m._default||!1===m._default.apply(f.ownerDocument,d))&&("click"!==s||!u.nodeName(f,"a"))&&u.acceptData(f)&&q&&f[s]&&("focus"!==s&&"blur"!==s||0!==c.target.offsetWidth)&&!u.isWindow(f)&&(n=f[q],n&&(f[q]=null),u.event.triggered=s,f[s](),u.event.triggered=g,n&&(f[q]=n)),c.result;}}else for(e in f=u.cache,f)f[e].events&&f[e].events[s]&&u.event.trigger(c,d,f[e].handle.elem,!0);}},dispatch:function(c){var d,f,l,j,e,n,q,m,p,r,s,I;c=u.event.fix(c||b.event);p0P.v9();q=(u._data(this,"events")||{})[c.type]||[],m=q.delegateCount,p=X.call(arguments),r=!c.exclusive&&!c.namespace,s=u.event.special[c.type]||{},I=[];p[0]=c;c.delegateTarget=this;if(!(s.preDispatch&&!1===s.preDispatch.call(this,c))){if(m&&(!c.button||"click"!==c.type))for(f=c.target;f!=this;f=f.parentNode||this)if(!0!==f.disabled||"click"!==c.type){j={};e=[];for(d=0;d<m;d++)l=q[d],n=l.selector,j[n]===g&&(j[n]=l.needsContext?0<=u(n,this).index(f):u.find(n,this,null,[f]).length),j[n]&&e.push(l);e.length&&I.push({elem:f,matches:e});}q.length>m&&I.push({elem:this,matches:q.slice(m)});for(d=0;d<I.length&&!c.isPropagationStopped();d++){j=I[d];c.currentTarget=j.elem;for(f=0;f<j.matches.length&&!c.isImmediatePropagationStopped();f++)if(l=j.matches[f],r||!c.namespace&&!l.namespace||c.namespace_re&&c.namespace_re.test(l.namespace))c.data=l.data,c.handleObj=l,l=((u.event.special[l.origType]||{}).handle||l.handler).apply(j.elem,p),l!==g&&(c.result=l,!1===l&&(c.preventDefault(),c.stopPropagation()));}return s.postDispatch&&s.postDispatch.call(this,c),c.result;}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:["char","charCode","key","keyCode"],filter:function(b,c){return null==b.which&&(b.which=null!=c.charCode?c.charCode:c.keyCode),b;}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(b,c){var d,f,l,j,e;p0P.v9();j=c.button,e=c.fromElement;return null==b.pageX&&null!=c.clientX&&(d=b.target.ownerDocument||I,f=d.documentElement,l=d.body,b.pageX=c.clientX+(f&&f.scrollLeft||l&&l.scrollLeft||0)-(f&&f.clientLeft||l&&l.clientLeft||0),b.pageY=c.clientY+(f&&f.scrollTop||l&&l.scrollTop||0)-(f&&f.clientTop||l&&l.clientTop||0)),!b.relatedTarget&&e&&(b.relatedTarget=e===b.target?c.toElement:e),!b.which&&j!==g&&(b.which=j&1?1:j&2?3:j&4?2:0),b;}},fix:function(b){var c,d,f,l,j;if(b[u.expando])return b;f=b,l=u.event.fixHooks[b.type]||{},j=l.props?this.props.concat(l.props):this.props;b=u.Event(f);for(c=j.length;c;)d=j[--c],b[d]=f[d];return b.target||(b.target=f.srcElement||I),3===b.target.nodeType&&(b.target=b.target.parentNode),b.metaKey=!!b.metaKey,l.filter?l.filter(b,f):b;},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(b,c,d){u.isWindow(this)&&(this.onbeforeunload=d);},teardown:function(b,c){p0P.q9();this.onbeforeunload===c&&(this.onbeforeunload=null);}}},simulate:function(b,c,d,f){b=u.extend(new u.Event(),d,{type:b,isSimulated:!0,originalEvent:{}});f?u.event.trigger(b,null,c):u.event.dispatch.call(c,b);b.isDefaultPrevented()&&d.preventDefault();}};u.event.handle=u.event.dispatch;function F(){p0P.v9();return setTimeout(function(){p0P.v9();Ha=g;},0),Ha=u.now();}u.removeEvent=I.removeEventListener?function(b,c,d){p0P.q9();b.removeEventListener&&b.removeEventListener(c,d,!1);}:function(b,c,d){c="on"+c;p0P.q9();b.detachEvent&&("undefined"==typeof b[c]&&(b[c]=null),b.detachEvent(c,d));};u.Event=function(b,c){p0P.v9();if(this instanceof u.Event)b&&b.type?(this.originalEvent=b,this.type=b.type,this.isDefaultPrevented=b.defaultPrevented||!1===b.returnValue||b.getPreventDefault&&b.getPreventDefault()?f:d):this.type=b,c&&u.extend(this,c),this.timeStamp=b&&b.timeStamp||u.now(),this[u.expando]=!0;else return new u.Event(b,c);};u.Event.prototype={preventDefault:function(){var b;this.isDefaultPrevented=f;b=this.originalEvent;b&&(b.preventDefault?b.preventDefault():b.returnValue=!1);},stopPropagation:function(){var b;this.isPropagationStopped=f;b=this.originalEvent;b&&(b.stopPropagation&&b.stopPropagation(),b.cancelBubble=!0);},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=f;this.stopPropagation();},isDefaultPrevented:d,isPropagationStopped:d,isImmediatePropagationStopped:d};function C(b,c,d,f){var l;p0P.v9();if(u.isArray(c))u.each(c,function(c,l){p0P.v9();d||tc.test(b)?f(b,l):C(b+"["+("object"==typeof l?c:"")+((5400,8596)<(1900,741.64)?4.99e+3:"]"),l,d,f);});else if(!d&&"object"===u.type(c))for(l in c)C(b+"["+l+"]",c[l],d,f);else f(b,c);}u.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(b,c){p0P.q9();u.event.special[b]={delegateType:c,bindType:c,handle:function(b){var d,f,l;p0P.q9();f=b.relatedTarget,l=b.handleObj;if(!f||f!==this&&!u.contains(this,f))b.type=l.origType,d=l.handler.apply(this,arguments),b.type=c;return d;}};});u.support.submitBubbles||(u.event.special.submit={setup:function(){if(u.nodeName(this,"form"))return!1;p0P.v9();u.event.add(this,"click._submit keypress._submit",function(b){p0P.q9();b=b.target;(b=u.nodeName(b,"input")||u.nodeName(b,"button")?b.form:g)&&!u._data(b,"_submit_attached")&&(u.event.add(b,"submit._submit",function(b){p0P.v9();b._submit_bubble=!0;}),u._data(b,"_submit_attached",!0));});},postDispatch:function(b){b._submit_bubble&&(delete b._submit_bubble,this.parentNode&&!b.isTrigger&&u.event.simulate("submit",this.parentNode,b,!0));},teardown:function(){p0P.v9();if(u.nodeName(this,"form"))return!1;u.event.remove(this,"._submit");}});u.support.changeBubbles||(u.event.special.change={setup:function(){if(gb.test(this.nodeName)){if("checkbox"===this.type||"radio"===this.type)u.event.add(this,"propertychange._change",function(b){"checked"===b.originalEvent.propertyName&&(this._just_changed=!0);}),u.event.add(this,"click._change",function(b){this._just_changed&&!b.isTrigger&&(this._just_changed=!1);u.event.simulate("change",this,b,!0);});return!1;}p0P.v9();u.event.add(this,"beforeactivate._change",function(b){b=b.target;gb.test(b.nodeName)&&!u._data(b,"_change_attached")&&(u.event.add(b,"change._change",function(b){this.parentNode&&!b.isSimulated&&!b.isTrigger&&u.event.simulate("change",this.parentNode,b,!0);}),u._data(b,"_change_attached",!0));});},handle:function(b){var c;c=b.target;p0P.q9();if(this!==c||b.isSimulated||b.isTrigger||"radio"!==c.type&&"checkbox"!==c.type)return b.handleObj.handler.apply(this,arguments);},teardown:function(){p0P.q9();return u.event.remove(this,"._change"),!gb.test(this.nodeName);}});u.support.focusinBubbles||u.each({focus:"focusin",blur:"focusout"},function(b,c){var d,f;p0P.v9();d=0,f=function(b){u.event.simulate(c,b.target,u.event.fix(b),!0);};u.event.special[c]={setup:function(){0===d++&&I.addEventListener(b,f,!0);},teardown:function(){p0P.v9();0===--d&&I.removeEventListener(b,f,!0);}};});u.fn.extend({on:function(b,c,f,l,j){var e,n;if("object"==typeof b){"string"!=typeof c&&(f=f||c,c=g);for(n in b)this.on(n,c,f,b[n],j);return this;}null==f&&null==l?(l=c,f=c=g):null==l&&("string"==typeof c?(l=f,f=g):(l=f,f=c,c=g));if(!1===l)l=d;else if(!l)return this;return 1===j&&(e=l,l=function(b){p0P.q9();return u().off(b),e.apply(this,arguments);},l.guid=e.guid||(e.guid=u.guid++)),this.each(function(){p0P.v9();u.event.add(this,b,l,f,c);});},one:function(b,c,d,f){return this.on(b,c,d,f,1);},off:function(b,c,f){var l,j;if(b&&b.preventDefault&&b.handleObj)return l=b.handleObj,u(b.delegateTarget).off(l.namespace?l.origType+"."+l.namespace:l.origType,l.selector,l.handler),this;if("object"==typeof b){for(j in b)this.off(j,c,b[j]);return this;}p0P.q9();if(!1===c||"function"==typeof c)f=c,c=g;return!1===f&&(f=d),this.each(function(){u.event.remove(this,b,f,c);});},bind:function(b,c,d){return this.on(b,null,c,d);},unbind:function(b,c){return this.off(b,null,c);},live:function(b,c,d){p0P.v9();return u(this.context).on(b,this.selector,c,d),this;},die:function(b,c){p0P.v9();return u(this.context).off(b,this.selector||"**",c),this;},delegate:function(b,c,d,f){return this.on(c,b,d,f);},undelegate:function(b,c,d){return 1===arguments.length?this.off(b,"**"):this.off(c,b||"**",d);},trigger:function(b,c){p0P.q9();return this.each(function(){p0P.v9();u.event.trigger(b,c,this);});},triggerHandler:function(b,c){p0P.v9();if(this[0])return u.event.trigger(b,c,this[0],!0);},toggle:function(b){var c,d,f,l;p0P.q9();c=arguments,d=b.guid||u.guid++,f=0,l=function(d){var l;l=(u._data(this,"lastToggle"+b.guid)||0)%f;return u._data(this,"lastToggle"+b.guid,l+1),d.preventDefault(),c[l].apply(this,arguments)||!1;};for(l.guid=d;f<c.length;)c[f++].guid=d;return this.click(l);},hover:function(b,c){p0P.v9();return this.mouseenter(b).mouseleave(c||b);}});u.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(b,c){u.fn[c]=function(b,d){p0P.q9();return null==d&&(d=b,b=null),0<arguments.length?this.on(c,null,b,d):this.trigger(c);};Lc.test(c)&&(u.event.fixHooks[c]=u.event.keyHooks);Mc.test(c)&&(u.event.fixHooks[c]=u.event.mouseHooks);});Nc=b,S=function(b,c,d,f){var l,j,e,n,q;d=d||[];c=c||ea;q=c.nodeType;if(!b||"string"!=typeof b)return d;if(1!==q&&9!==q)return[];e=Oa(c);if(!e&&!f&&(l=Oc.exec(b)))if(n=l[1])if(9===q){j=c.getElementById(n);if(!j||!j.parentNode)return d;if(j.id===n)return d.push(j),d;}else{if(c.ownerDocument&&(j=c.ownerDocument.getElementById(n))&&Ob(c,j)&&j.id===n)return d.push(j),d;}else{if(l[2])return wa.apply(d,xa.call(c.getElementsByTagName(b),0)),d;if((n=l[3])&&Pb&&c.getElementsByClassName)return wa.apply(d,xa.call(c.getElementsByClassName(n),0)),d;}return hb(b.replace(Pa,"$1"),c,d,f,e);},Ca=function(b){p0P.v9();return function(c){return"input"===c.nodeName.toLowerCase()&&c.type===b;};},Qb=function(b){return function(c){var d;p0P.q9();d=c.nodeName.toLowerCase();return("input"===d||"button"===d)&&c.type===b;};},qa=function(b){return fa(function(c){return c=+c,fa(function(d,f){for(var l,j=b([],d.length,c),e=j.length;e--;)d[l=j[e]]&&(d[l]=!(f[l]=d[l]));});});},Qa=function(b,c,d){if(b===c)return d;p0P.v9();for(b=b.nextSibling;b;){if(b===c)return-1;b=b.nextSibling;}return 1;},Sa=function(b,c){var d,f,l,j,e,n,q;if(e=Rb[V][b])return c?0:e.slice(0);e=b;n=[];p0P.q9();for(q=U.preFilter;e;){if(!d||(f=Pc.exec(e)))f&&(e=e.slice(f[0].length)),n.push(l=[]);d=!1;if(f=Qc.exec(e))l.push(d=new Sb(f.shift())),e=e.slice(d.length),d.type=f[0].replace(Pa," ");for(j in U.filter)(f=Ra[j].exec(e))&&(!q[j]||(f=q[j](f,ea,!0)))&&(l.push(d=new Sb(f.shift())),e=e.slice(d.length),d.type=j,d.matches=f);if(!d)break;}return c?e.length:e?S.error(b):Rb(b,n).slice(0);},jb=function(b,c,d){var f,l,j;f=c.dir,l=d&&"parentNode"===c.dir,j=Rc++;return c.first?function(c,d,j){for(;c=c[f];)if(l||1===c.nodeType)return b(c,d,j);}:function(c,d,e){p0P.q9();if(e)for(;c=c[f];){if((l||1===c.nodeType)&&b(c,d,e))return c;}else for(var n,q=Da+" "+j+" ",m=q+ib;c=c[f];)if(l||1===c.nodeType){if((n=c[V])===m)return c.sizset;if("string"==typeof n&&0===n.indexOf(q)){if(c.sizset)return c;}else{c[V]=m;if(b(c,d,e))return c.sizset=!0,c;c.sizset=!1;}}};},kb=function(b){p0P.q9();return 1<b.length?function(c,d,f){for(var l=b.length;l--;)if(!b[l](c,d,f))return!1;return!0;}:b[0];},Ta=function(b,c,d,f,l){for(var j,e=[],n=0,q=b.length,m=null!=c;n<q;n++)if(j=b[n])if(!d||d(j,f,l))e.push(j),m&&c.push(n);p0P.v9();return e;},lb=function(b,c,d,f,l,j){p0P.v9();return f&&!f[V]&&(f=lb(f)),l&&!l[V]&&(l=lb(l,j)),fa(function(j,e,n,q){var m,p,g,r,s,I,t;p0P.v9();if(!j||!l){g=[],r=[],s=e.length;if(!(p=j)){p=c||"*";I=n.nodeType?[n]:n,t=[];m=0;for(var y=I.length;m<y;m++)S(p,I[m],t,j);p=t;}I=b&&(j||!c)?Ta(p,g,b,n,q):p;t=d?l||(j?b:s||f)?[]:e:I;d&&d(I,t,n,q);if(f){p=Ta(t,r);f(p,[],n,q);for(n=p.length;n--;)if(m=p[n])t[r[n]]=!(I[r[n]]=m);}if(j)for(n=b&&t.length;n--;){if(m=t[n])j[g[n]]=!(e[g[n]]=m);}else t=Ta(t===e?t.splice(s,t.length):t),l?l(null,e,t,q):wa.apply(e,t);}});},mb=function(b){var c,d,f,l,j;l=b.length,j=U.relative[b[0].type];d=j||U.relative[" "];for(var e=j?1:0,n=jb(function(b){p0P.v9();return b===c;},d,!0),q=jb(function(b){p0P.v9();return-1<Tb.call(c,b);},d,!0),m=[function(b,d,f){p0P.q9();return!j&&(f||d!==Ua)||((c=d).nodeType?n(b,d,f):q(b,d,f));}];e<l;e++)if(d=U.relative[b[e].type])m=[jb(kb(m),d)];else{d=U.filter[b[e].type].apply(null,b[e].matches);if(d[V]){for(f=++e;f<l&&!U.relative[b[f].type];f++);return lb(1<e&&kb(m),1<e&&b.slice(0,e-1).join("").replace(Pa,"$1"),d,e<f&&mb(b.slice(e,f)),f<l&&mb(b=b.slice(f)),f<l&&b.join(""));}m.push(d);}return kb(m);},hb=function(b,c,d,f,l){var j,e,n,q,m;m=Sa(b);if(!f&&1===m.length){e=m[0]=m[0].slice(0);if(2<e.length&&"ID"===(n=e[0]).type&&9===c.nodeType&&!l&&U.relative[e[1].type]){c=U.find.ID(n.matches[0].replace(ra,""),c,l)[0];if(!c)return d;b=b.slice(e.shift().length);}for(j=Ra.POS.test(b)?-1:e.length-1;0<=j;j--){n=e[j];if(U.relative[q=n.type])break;if(q=U.find[q])if(f=q(n.matches[0].replace(ra,""),nb.test(e[0].type)&&c.parentNode||c,l)){e.splice(j,1);b=f.length&&e.join("");if(!b)return wa.apply(d,xa.call(f,0)),d;break;}}}return ob(b,m)(f,c,l,d,nb.test(b)),d;},Ub=function(){},Vb=!0,V=("sizcache"+Math.random()).replace(".",""),Sb=String,ea=Nc.document,da=ea.documentElement,Da=0,Rc=0,Sc=[].pop,wa=[].push,xa=[].slice,Tb=[].indexOf||function(b){for(var c=0,d=this.length;c<d;c++)if(this[c]===b)return c;return-1;},fa=function(b,c){p0P.q9();return b[V]=null==c||c,b;},rb=function(){var b,c;p0P.v9();b={},c=[];return fa(function(d,f){p0P.v9();return c.push(d)>U.cacheLength&&delete b[c.shift()],b[d]=f;},b);},Wb=rb(),Rb=rb(),Xb=rb(),Yb="\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)[\\x20\\t\\r\\n\\f]*(?:([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+"(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("w","w#")+")|)|)[\\x20\\t\\r\\n\\f]*\\]",sb=":((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+Yb+")|[^:]|\\\\.)*|.*))\\)|)",Pa=/^[\x20\t\r\n\f]+|((?:^|[^\\])(?:\\.)*)[\x20\t\r\n\f]+$/g,Pc=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,Qc=/^[\x20\t\r\n\f]*([\x20\t\r\n\f>+~])[\x20\t\r\n\f]*/,Tc=RegExp(sb),Oc=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,nb=/[\x20\t\r\n\f]*[+~]/,Uc=/h\d/i,Vc=/input|select|textarea|button/i,ra=/\\(?!\\)/g,Ra={ID:/^#((?:\\.|[-\w]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[-\w]|[^\x00-\xa0])+)/,NAME:/^\[name=['"]?((?:\\.|[-\w]|[^\x00-\xa0])+)['"]?\]/,TAG:RegExp("^("+"(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("w","w*")+")"),ATTR:RegExp("^"+Yb),PSEUDO:RegExp("^"+sb),POS:/:(even|odd|eq|gt|lt|nth|first|last)(?:\([\x20\t\r\n\f]*((?:-\d)?\d*)[\x20\t\r\n\f]*\)|)(?=[^-]|$)/i,CHILD:RegExp("^:(only|nth|first|last)-child(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),needsContext:RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},ja=function(b){var c;c=ea.createElement("div");try{return b(c);}catch(d){return!1;}finally{}},Wc=ja(function(b){p0P.v9();return b.appendChild(ea.createComment("")),!b.getElementsByTagName("*").length;}),Xc=ja(function(b){p0P.v9();return b.innerHTML="<a href='#'></a>",b.firstChild&&"undefined"!==typeof b.firstChild.getAttribute&&"#"===b.firstChild.getAttribute("href");}),Yc=ja(function(b){b.innerHTML="<select></select>";b=typeof b.lastChild.getAttribute("multiple");p0P.v9();return"boolean"!==b&&"string"!==b;}),Pb=ja(function(b){return b.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!b.getElementsByClassName||!b.getElementsByClassName("e").length?!1:(b.lastChild.className="e",2===b.getElementsByClassName("e").length);}),Zc=ja(function(b){var c;b.id=V+0;p0P.v9();b.innerHTML="<a name='"+V+"'></a><div name='"+V+"'></div>";da.insertBefore(b,da.firstChild);c=ea.getElementsByName&&ea.getElementsByName(V).length===2+ea.getElementsByName(V+0).length;return pb=!ea.getElementById(V),da.removeChild(b),c;});try{xa.call(da.childNodes,0)[0].nodeType;}catch(Id){xa=function(b){for(var c,d=[];c=this[b];b++)d.push(c);p0P.q9();return d;};}S.matches=function(b,c){return S(b,null,null,c);};S.matchesSelector=function(b,c){p0P.v9();return 0<S(c,null,null,[b]).length;};Va=S.getText=function(b){var c,d,f;d="",f=0;if(c=b.nodeType)if(1===c||9===c||11===c){if("string"==typeof b.textContent)return b.textContent;for(b=b.firstChild;b;b=b.nextSibling)d+=Va(b);}else{if(3===c||4===c)return b.nodeValue;}else for(;c=b[f];f++)d+=Va(c);return d;};Oa=S.isXML=function(b){p0P.q9();return(b=b&&(b.ownerDocument||b).documentElement)?"HTML"!==b.nodeName:!1;};function t(b,c){p0P.v9();if(c in b)return c;for(var d=c.charAt(0).toUpperCase()+c.slice(1),f=c,l=Bb.length;l--;)if(c=Bb[l]+d,c in b)return c;return f;}Ob=S.contains=da.contains?function(b,c){var d,f;d=9===b.nodeType?b.documentElement:b,f=c&&c.parentNode;p0P.v9();return b===f||!(!f||!(1===f.nodeType&&d.contains&&d.contains(f)));}:da.compareDocumentPosition?function(b,c){return c&&!!(b.compareDocumentPosition(c)&16);}:function(b,c){for(;c=c.parentNode;)if(c===b)return!0;return!1;};function c(b){p0P.v9();for(var c in b)if(!("data"===c&&u.isEmptyObject(b[c]))&&"toJSON"!==c)return!1;return!0;}S.attr=function(b,c){var d,f;f=Oa(b);return f||(c=c.toLowerCase()),(d=U.attrHandle[c])?d(b):f||Yc?b.getAttribute(c):(d=b.getAttributeNode(c),d?"boolean"==typeof b[c]?b[c]?c:null:d.specified?d.value:null:null);};U=S.selectors={cacheLength:50,createPseudo:fa,match:Ra,attrHandle:Xc?{}:{href:function(b){return b.getAttribute("href",2);},type:function(b){return b.getAttribute("type");}},find:{ID:pb?function(b,c,d){p0P.q9();if("undefined"!==typeof c.getElementById&&!d)return(b=c.getElementById(b))&&b.parentNode?[b]:[];}:function(b,c,d){if("undefined"!==typeof c.getElementById&&!d)return(c=c.getElementById(b))?c.id===b||"undefined"!==typeof c.getAttributeNode&&c.getAttributeNode("id").value===b?[c]:void 0:[];},TAG:Wc?function(b,c){p0P.q9();if("undefined"!==typeof c.getElementsByTagName)return c.getElementsByTagName(b);}:function(b,c){var d;d=c.getElementsByTagName(b);if("*"===b){for(var f,l=[],j=0;f=d[j];j++)1===f.nodeType&&l.push(f);return l;}return d;},NAME:Zc&&function(b,c){if("undefined"!==typeof c.getElementsByName)return c.getElementsByName(name);},CLASS:Pb&&function(b,c,d){p0P.v9();if("undefined"!==typeof c.getElementsByClassName&&!d)return c.getElementsByClassName(b);}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(b){return b[1]=b[1].replace(ra,""),b[3]=(b[4]||b[5]||"").replace(ra,""),"~="===b[2]&&(b[3]=" "+b[3]+" "),b.slice(0,4);},CHILD:function(b){p0P.q9();return b[1]=b[1].toLowerCase(),"nth"===b[1]?(b[2]||S.error(b[0]),b[3]=+(b[3]?b[4]+(b[5]||1):2*("even"===b[2]||"odd"===b[2])),b[4]=+(b[6]+b[7]||"odd"===b[2])):b[2]&&S.error(b[0]),b;},PSEUDO:function(b){var c,d;if(Ra.CHILD.test(b[0]))return null;p0P.q9();if(b[3])b[2]=b[3];else if(c=b[4])Tc.test(c)&&(d=Sa(c,!0))&&(d=c.indexOf(")",c.length-d)-c.length)&&(c=c.slice(0,d),b[0]=b[0].slice(0,d)),b[2]=c;return b.slice(0,3);}},filter:{ID:pb?function(b){return b=b.replace(ra,""),function(c){return c.getAttribute("id")===b;};}:function(b){p0P.q9();return b=b.replace(ra,""),function(c){p0P.v9();return(c="undefined"!==typeof c.getAttributeNode&&c.getAttributeNode("id"))&&c.value===b;};},TAG:function(b){p0P.q9();return"*"===b?function(){return!0;}:(b=b.replace(ra,"").toLowerCase(),function(c){return c.nodeName&&c.nodeName.toLowerCase()===b;});},CLASS:function(b){var c;p0P.q9();c=Wb[V][b];return c||(c=Wb(b,RegExp("(^|[\\x20\\t\\r\\n\\f])"+b+"([\\x20\\t\\r\\n\\f]|$)"))),function(b){p0P.v9();return c.test(b.className||"undefined"!==typeof b.getAttribute&&b.getAttribute("class")||"");};},ATTR:function(b,c,d){p0P.v9();return function(f){f=S.attr(f,b);return null==f?"!="===c:c?(f+="","="===c?f===d:"!="===c?f!==d:"^="===c?d&&0===f.indexOf(d):"*="===c?d&&-1<f.indexOf(d):"$="===c?d&&f.substr(f.length-d.length)===d:"~="===c?-1<(" "+f+" ").indexOf(d):"|="===c?f===d||f.substr(0,d.length+1)===d+"-":!1):!0;};},CHILD:function(b,c,d,f){p0P.q9();return"nth"===b?function(b){var c,l;c=b.parentNode;if(1===d&&0===f)return!0;if(c){l=0;for(c=c.firstChild;c&&!(1===c.nodeType&&(l++,b===c));c=c.nextSibling);}p0P.v9();return l-=f,l===d||0===l%d&&0<=l/d;}:function(c){var d;p0P.q9();d=c;switch(b){case"only":case"first":for(;d=d.previousSibling;)if(1===d.nodeType)return!1;if("first"===b)return!0;d=c;case"last":for(;d=d.nextSibling;)if(1===d.nodeType)return!1;return!0;}};},PSEUDO:function(b,c){var d,f;f=U.pseudos[b]||U.setFilters[b.toLowerCase()]||S.error("unsupported pseudo: "+b);p0P.q9();return f[V]?f(c):1<f.length?(d=[b,b,"",c],U.setFilters.hasOwnProperty(b.toLowerCase())?fa(function(b,d){for(var l,j=f(b,c),e=j.length;e--;)l=Tb.call(b,j[e]),b[l]=!(d[l]=j[e]);}):function(b){return f(b,0,d);}):f;}},pseudos:{not:fa(function(b){var c,d,f;c=[],d=[],f=ob(b.replace(Pa,"$1"));return f[V]?fa(function(b,c,d,l){p0P.q9();l=f(b,null,l,[]);for(var j=b.length;j--;)if(d=l[j])b[j]=!(c[j]=d);}):function(b,l,j){p0P.v9();return c[0]=b,f(c,null,j,d),!d.pop();};}),has:fa(function(b){p0P.v9();return function(c){p0P.q9();return 0<S(b,c).length;};}),contains:fa(function(b){p0P.v9();return function(c){p0P.v9();return-1<(c.textContent||c.innerText||Va(c)).indexOf(b);};}),enabled:function(b){return!1===b.disabled;},disabled:function(b){return!0===b.disabled;},checked:function(b){var c;c=b.nodeName.toLowerCase();p0P.v9();return"input"===c&&!!b.checked||"option"===c&&!!b.selected;},selected:function(b){p0P.q9();return b.parentNode&&b.parentNode.selectedIndex,!0===b.selected;},parent:function(b){return!U.pseudos.empty(b);},empty:function(b){var c;p0P.v9();for(b=b.firstChild;b;){if("@"<b.nodeName||3===(c=b.nodeType)||4===c)return!1;b=b.nextSibling;}return!0;},header:function(b){return Uc.test(b.nodeName);},text:function(b){var c,d;return"input"===b.nodeName.toLowerCase()&&"text"===(c=b.type)&&(null==(d=b.getAttribute("type"))||d.toLowerCase()===c);},radio:Ca("radio"),checkbox:Ca("checkbox"),file:Ca("file"),password:Ca("password"),image:Ca("image"),submit:Qb("submit"),reset:Qb("reset"),button:function(b){var c;c=b.nodeName.toLowerCase();p0P.q9();return"input"===c&&"button"===b.type||"button"===c;},input:function(b){p0P.q9();return Vc.test(b.nodeName);},focus:function(b){var c;p0P.v9();c=b.ownerDocument;return b===c.activeElement&&(!c.hasFocus||c.hasFocus())&&(!!b.type||!!b.href);},active:function(b){return b===b.ownerDocument.activeElement;},first:qa(function(){p0P.q9();return[0];}),last:qa(function(b,c){return[c-1];}),eq:qa(function(b,c,d){return[0>d?d+c:d];}),even:qa(function(b,c){for(var d=0;d<c;d+=2)b.push(d);p0P.q9();return b;}),odd:qa(function(b,c){for(var d=1;d<c;d+=2)b.push(d);p0P.v9();return b;}),lt:qa(function(b,c,d){for(c=0>d?d+c:d;0<=--c;)b.push(c);return b;}),gt:qa(function(b,c,d){for(d=0>d?d+c:d;++d<c;)b.push(d);return b;})}};qb=da.compareDocumentPosition?function(b,c){return b===c?(Ea=!0,0):(!b.compareDocumentPosition||!c.compareDocumentPosition?b.compareDocumentPosition:b.compareDocumentPosition(c)&4)?-1:1;}:function(b,c){var d,f,l,j,e;if(b===c)return Ea=!0,0;if(b.sourceIndex&&c.sourceIndex)return b.sourceIndex-c.sourceIndex;l=[],j=[];d=b.parentNode;f=c.parentNode;e=d;if(d===f)return Qa(b,c);if(!d)return-1;if(!f)return 1;for(;e;)l.unshift(e),e=e.parentNode;for(e=f;e;)j.unshift(e),e=e.parentNode;d=l.length;f=j.length;for(e=0;e<d&&e<f;e++)if(l[e]!==j[e])return Qa(l[e],j[e]);return e===d?Qa(b,j[e],-1):Qa(l[e],c,1);};[0,0].sort(qb);function q(b){return!b||!b.parentNode||11===b.parentNode.nodeType;}function x(b,c,d){return(b=sc.exec(c))?Math.max(0,b[1]-(d||0))+(b[2]||"px"):c;}Vb=!Ea;S.uniqueSort=function(b){var c,d;d=1;Ea=Vb;b.sort(qb);if(Ea)for(;c=b[d];d++)c===b[d-1]&&b.splice(d--,1);return b;};S.error=function(b){p0P.v9();throw Error("Syntax error, unrecognized expression: "+b);};function j(b,c){do b=b[c];while(b&&1!==b.nodeType);return b;}ob=S.compile=function(b,c){var d,f,l,j,e,n,q;f=[],l=[],j=Xb[V][b];if(!j){c||(c=Sa(b));for(d=c.length;d--;)j=mb(c[d]),j[V]?f.push(j):l.push(j);e=0<f.length,n=0<l.length,q=function(b,c,d,j,m){var p,g,r,s,I,t,y,v,Q,x;r=[],s=0,I="0",t=b&&[],y=null!=m,v=Ua,Q=b||n&&U.find.TAG("*",m&&c.parentNode||c),x=Da+=null==v?1:Math.E;for(y&&(Ua=c!==ea&&c,ib=q.el);null!=(m=Q[I]);I++){if(n&&m){for(p=0;g=l[p];p++)if(g(m,c,d)){j.push(m);break;}y&&(Da=x,ib=++q.el);}e&&((m=!g&&m)&&s--,b&&t.push(m));}s+=I;if(e&&I!==s){for(p=0;g=f[p];p++)g(t,r,c,d);if(b){if(0<s)for(;I--;)!t[I]&&!r[I]&&(r[I]=Sc.call(j));r=Ta(r);}wa.apply(j,r);y&&!b&&0<r.length&&1<s+f.length&&S.uniqueSort(j);}return y&&(Da=x,Ua=v),t;};d=(q.el=0,e?fa(q):q);j=Xb(b,d);}return j;};if(ea.querySelectorAll){$c=hb,ad=/'|\\/g,bd=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,ga=[":focus"],Wa=[":active",":focus"],Xa=da.matchesSelector||da.mozMatchesSelector||da.webkitMatchesSelector||da.oMatchesSelector||da.msMatchesSelector;ja(function(b){b.innerHTML="<select><option selected=''></option></select>";b.querySelectorAll("[selected]").length||ga.push("\\[[\\x20\\t\\r\\n\\f]*(?:checked|disabled|ismap|multiple|readonly|selected|value)");b.querySelectorAll(":checked").length||ga.push(":checked");});ja(function(b){b.innerHTML="<p test=''></p>";b.querySelectorAll("[test^='']").length&&ga.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:\"\"|'')");b.innerHTML="<input type='hidden'/>";b.querySelectorAll(":enabled").length||ga.push(":enabled",":disabled");});ga=RegExp(ga.join("|"));hb=function(b,c,d,f,l){var j,e,n,q;p0P.v9();if(!f&&!l&&(!ga||!ga.test(b))){n=!0,q=V;e=c;j=9===c.nodeType&&b;if(1===c.nodeType&&"object"!==c.nodeName.toLowerCase()){j=Sa(b);(n=c.getAttribute("id"))?q=n.replace(ad,"\\$&"):c.setAttribute("id",q);q="[id='"+q+"'] ";for(e=j.length;e--;)j[e]=q+j[e].join("");e=nb.test(b)&&c.parentNode||c;j=j.join(",");}if(j)try{return wa.apply(d,xa.call(e.querySelectorAll(j),0)),d;}catch(m){}finally{n||c.removeAttribute("id");}}return $c(b,c,d,f,l);};Xa&&(ja(function(b){Zb=Xa.call(b,"div");try{Xa.call(b,"[test!='']:sizzle"),Wa.push("!=",sb);}catch(c){}}),Wa=RegExp(Wa.join("|")),S.matchesSelector=function(b,c){var d;p0P.q9();c=c.replace(bd,"='$1']");if(!Oa(b)&&!Wa.test(c)&&(!ga||!ga.test(c)))try{d=Xa.call(b,c);if(d||Zb||b.document&&11!==b.document.nodeType)return d;}catch(f){}return 0<S(c,null,null,[b]).length;});}U.pseudos.nth=U.pseudos.eq;U.filters=Ub.prototype=U.pseudos;U.setFilters=new Ub();S.attr=u.attr;u.find=S;u.expr=S.selectors;u.expr[":"]=u.expr.pseudos;u.unique=S.uniqueSort;u.text=S.getText;u.isXMLDoc=S.isXML;u.contains=S.contains;cd=/Until$/,dd=/^(?:parents|prev(?:Until|All))/,rc=/^.[^:#\[\.,]*$/,$b=u.expr.match.needsContext,ed={children:!0,contents:!0,next:!0,prev:!0};u.fn.extend({find:function(b){var c,d,f,l,j,e,n;n=this;if("string"!=typeof b)return u(b).filter(function(){c=0;p0P.v9();for(d=n.length;c<d;c++)if(u.contains(n[c],this))return!0;});e=this.pushStack("","find",b);c=0;for(d=this.length;c<d;c++)if(f=e.length,u.find(b,this[c],e),0<c)for(l=f;l<e.length;l++)for(j=0;j<f;j++)if(e[j]===e[l]){e.splice(l--,1);break;}return e;},has:function(b){var c,d,f;d=u(b,this),f=d.length;return this.filter(function(){p0P.q9();for(c=0;c<f;c++)if(u.contains(this,d[c]))return!0;});},not:function(b){return this.pushStack(l(this,b,!1),"not",b);},filter:function(b){p0P.q9();return this.pushStack(l(this,b,!0),"filter",b);},is:function(b){p0P.q9();return!!b&&("string"==typeof b?$b.test(b)?0<=u(b,this.context).index(this[0]):0<u.filter(b,this).length:0<this.filter(b).length);},closest:function(b,c){for(var d,f=0,l=this.length,j=[],e=$b.test(b)||"string"!=typeof b?u(b,c||this.context):0;f<l;f++)for(d=this[f];d&&d.ownerDocument&&d!==c&&11!==d.nodeType;){if(e?-1<e.index(d):u.find.matchesSelector(d,b)){j.push(d);break;}d=d.parentNode;}p0P.q9();return j=1<j.length?u.unique(j):j,this.pushStack(j,"closest",b);},index:function(b){return b?"string"==typeof b?u.inArray(this[0],u(b)):u.inArray(b.jquery?b[0]:b,this):this[0]&&this[0].parentNode?this.prevAll().length:-1;},add:function(b,c){var d,f;p0P.q9();d="string"==typeof b?u(b,c):u.makeArray(b&&b.nodeType?[b]:b),f=u.merge(this.get(),d);return this.pushStack(q(d[0])||q(f[0])?f:u.unique(f));},addBack:function(b){return this.add(null==b?this.prevObject:this.prevObject.filter(b));}});u.fn.andSelf=u.fn.addBack;u.each({parent:function(b){p0P.q9();return(b=b.parentNode)&&11!==b.nodeType?b:null;},parents:function(b){return u.dir(b,"parentNode");},parentsUntil:function(b,c,d){return u.dir(b,"parentNode",d);},next:function(b){p0P.q9();return j(b,"nextSibling");},prev:function(b){return j(b,"previousSibling");},nextAll:function(b){return u.dir(b,"nextSibling");},prevAll:function(b){p0P.v9();return u.dir(b,"previousSibling");},nextUntil:function(b,c,d){p0P.v9();return u.dir(b,"nextSibling",d);},prevUntil:function(b,c,d){return u.dir(b,"previousSibling",d);},siblings:function(b){return u.sibling((b.parentNode||{}).firstChild,b);},children:function(b){p0P.v9();return u.sibling(b.firstChild);},contents:function(b){p0P.q9();return u.nodeName(b,"iframe")?b.contentDocument||b.contentWindow.document:u.merge([],b.childNodes);}},function(b,c){u.fn[b]=function(d,f){var l;p0P.q9();l=u.map(this,c,d);return cd.test(b)||(f=d),f&&"string"==typeof f&&(l=u.filter(f,l)),l=1<this.length&&!ed[b]?u.unique(l):l,1<this.length&&dd.test(b)&&(l=l.reverse()),this.pushStack(l,b,X.call(arguments).join(","));};});u.extend({filter:function(b,c,d){return d&&(b=":not("+b+")"),1===c.length?u.find.matchesSelector(c[0],b)?[c[0]]:[]:u.find.matches(b,c);},dir:function(b,c,d){var f;p0P.v9();f=[];for(b=b[c];b&&9!==b.nodeType&&(d===g||1!==b.nodeType||!u(b).is(d));)1===b.nodeType&&f.push(b),b=b[c];return f;},sibling:function(b,c){for(var d=[];b;b=b.nextSibling)1===b.nodeType&&b!==c&&d.push(b);return d;}});zb="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",fd=/ jQuery\d+="(?:null|\d+)"/g,tb=/^\s+/,ac=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bc=/<([\w:]+)/,gd=/<tbody/i,hd=/<|&#?\w+;/,id=/<(?:script|style|link)/i,jd=/<(?:script|object|embed|option|style)/i,ub=RegExp("<(?:"+zb+")[\\s/>]","i"),Ab=/^(?:checkbox|radio)$/,cc=/checked\s*(?:[^=]|=\s*.checked.)/i,kd=/\/(java|ecma)script/i,ld=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,ca={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},dc=n(I),vb=dc.appendChild(I.createElement("div"));ca.optgroup=ca.option;function z(b,c,d,f){c=d===(f?"border":"content")?4:"width"===c?1:0;for(var l=0;4>c;c+=2)"margin"===d&&(l+=u.css(b,d+la[c],!0)),f?("content"===d&&(l-=parseFloat(Y(b,"padding"+la[c]))||0),"margin"!==d&&(l-=parseFloat(Y(b,"border"+la[c]+"Width"))||0)):(l+=parseFloat(Y(b,"padding"+la[c]))||0,"padding"!==d&&(l+=parseFloat(Y(b,"border"+la[c]+"Width"))||0));return l;}ca.tbody=ca.tfoot=ca.colgroup=ca.caption=ca.thead;ca.th=ca.td;u.support.htmlSerialize||(ca._default=[1,"X<div>","</div>"]);u.fn.extend({text:function(b){return u.access(this,function(b){p0P.q9();return b===g?u.text(this):this.empty().append((this[0]&&this[0].ownerDocument||I).createTextNode(b));},null,b,arguments.length);},wrapAll:function(b){var c;if(u.isFunction(b))return this.each(function(c){p0P.v9();u(this).wrapAll(b.call(this,c));});if(this[0]){c=u(b,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&c.insertBefore(this[0]);c.map(function(){for(var b=this;b.firstChild&&1===b.firstChild.nodeType;)b=b.firstChild;p0P.v9();return b;}).append(this);}return this;},wrapInner:function(b){p0P.q9();return u.isFunction(b)?this.each(function(c){p0P.v9();u(this).wrapInner(b.call(this,c));}):this.each(function(){var c,d;p0P.v9();c=u(this),d=c.contents();d.length?d.wrapAll(b):c.append(b);});},wrap:function(b){var c;c=u.isFunction(b);return this.each(function(d){p0P.q9();u(this).wrapAll(c?b.call(this,d):b);});},unwrap:function(){p0P.q9();return this.parent().each(function(){u.nodeName(this,"body")||u(this).replaceWith(this.childNodes);}).end();},append:function(){return this.domManip(arguments,!0,function(b){(1===this.nodeType||11===this.nodeType)&&this.appendChild(b);});},prepend:function(){return this.domManip(arguments,!0,function(b){p0P.v9();(1===this.nodeType||11===this.nodeType)&&this.insertBefore(b,this.firstChild);});},before:function(){var b;if(!q(this[0]))return this.domManip(arguments,!1,function(b){this.parentNode.insertBefore(b,this);});if(arguments.length){b=u.clean(arguments);return this.pushStack(u.merge(b,this),"before",this.selector);}},after:function(){var b;p0P.v9();if(!q(this[0]))return this.domManip(arguments,!1,function(b){p0P.v9();this.parentNode.insertBefore(b,this.nextSibling);});if(arguments.length){b=u.clean(arguments);return this.pushStack(u.merge(this,b),"after",this.selector);}},remove:function(b,c){for(var d,f=0;null!=(d=this[f]);f++)if(!b||u.filter(b,[d]).length)!c&&1===d.nodeType&&(u.cleanData(d.getElementsByTagName("*")),u.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this;},empty:function(){for(var b,c=0;null!=(b=this[c]);c++)for(1===b.nodeType&&u.cleanData(b.getElementsByTagName("*"));b.firstChild;)b.removeChild(b.firstChild);p0P.q9();return this;},clone:function(b,c){return b=null==b?!1:b,c=null==c?b:c,this.map(function(){p0P.q9();return u.clone(this,b,c);});},html:function(b){p0P.v9();return u.access(this,function(b){var c,d,f;c=this[0]||{},d=0,f=this.length;if(b===g)return 1===c.nodeType?c.innerHTML.replace(fd,""):g;p0P.v9();if("string"==typeof b&&!id.test(b)&&(u.support.htmlSerialize||!ub.test(b))&&(u.support.leadingWhitespace||!tb.test(b))&&!ca[(bc.exec(b)||["",""])[1].toLowerCase()]){b=b.replace(ac,"<$1></$2>");try{for(;d<f;d++)c=this[d]||{},1===c.nodeType&&(u.cleanData(c.getElementsByTagName("*")),c.innerHTML=b);c=0;}catch(l){}}c&&this.empty().append(b);},null,b,arguments.length);},replaceWith:function(b){return q(this[0])?this.length?this.pushStack(u(u.isFunction(b)?b():b),"replaceWith",b):this:u.isFunction(b)?this.each(function(c){var d,f;d=u(this),f=d.html();p0P.q9();d.replaceWith(b.call(this,c,f));}):("string"!=typeof b&&(b=u(b).detach()),this.each(function(){var c,d;p0P.v9();c=this.nextSibling,d=this.parentNode;u(this).remove();c?u(c).before(b):u(d).append(b);}));},detach:function(b){return this.remove(b,!0);},domManip:function(b,c,d){var f,l,j,e,n,q,m;p0P.q9();b=[].concat.apply([],b);e=0,n=b[0],q=[],m=this.length;if(!u.support.checkClone&&1<m&&"string"==typeof n&&cc.test(n))return this.each(function(){u(this).domManip(b,c,d);});if(u.isFunction(n))return this.each(function(f){var l;l=u(this);b[0]=n.call(this,f,c?l.html():g);l.domManip(b,c,d);});if(this[0]){f=u.buildFragment(b,this,q);j=f.fragment;l=j.firstChild;1===j.childNodes.length&&(j=l);if(l){c=c&&u.nodeName(l,"tr");for(f=f.cacheable||m-1;e<m;e++)d.call(c&&u.nodeName(this[e],"table")?this[e].getElementsByTagName("tbody")[0]||this[e].appendChild(this[e].ownerDocument.createElement("tbody")):this[e],e===f?j:u.clone(j,!0,!0));}j=l=null;q.length&&u.each(q,function(b,c){c.src?u.ajax?u.ajax({url:c.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):u.error("no ajax"):u.globalEval((c.text||c.textContent||c.innerHTML||"").replace(ld,""));c.parentNode&&c.parentNode.removeChild(c);});}return this;}});function E(b,c,d,f,l){return new E.prototype.init(b,c,d,f,l);}function y(b,c){for(var d,f,l=[],j=0,e=b.length;j<e;j++)d=b[j],d.style&&(l[j]=u._data(d,"olddisplay"),c?(!l[j]&&"none"===d.style.display&&(d.style.display=""),""===d.style.display&&v(d)&&(l[j]=u._data(d,"olddisplay",A(d.nodeName)))):(f=Y(d,"display"),!l[j]&&"none"!==f&&u._data(d,"olddisplay",f)));for(j=0;j<e;j++)if(d=b[j],d.style&&(!c||"none"===d.style.display||""===d.style.display))d.style.display=c?l[j]||"":"none";p0P.v9();return b;}u.buildFragment=function(b,c,d){var f,l,j,e;e=b[0];return c=c||I,c=!c.nodeType&&c[0]||c,c=c.ownerDocument||c,1===b.length&&"string"==typeof e&&512>e.length&&c===I&&"<"===e.charAt(0)&&!jd.test(e)&&(u.support.checkClone||!cc.test(e))&&(u.support.html5Clone||!ub.test(e))&&(l=!0,f=u.fragments[e],j=f!==g),f||(f=c.createDocumentFragment(),u.clean(b,c,f,d),l&&(u.fragments[e]=j&&f)),{fragment:f,cacheable:l};};u.fragments={};u.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(b,c){p0P.v9();u.fn[b]=function(d){var f,l,j,e;l=0,j=[];d=u(d);e=d.length;f=1===this.length&&this[0].parentNode;if((null==f||f&&11===f.nodeType&&1===f.childNodes.length)&&1===e)return d[c](this[0]),this;for(;l<e;l++)f=(0<l?this.clone(!0):this).get(),u(d[l])[c](f),j=j.concat(f);return this.pushStack(j,b,d.selector);};});u.extend({clone:function(b,c,d){var f,l,j,e;u.support.html5Clone||u.isXMLDoc(b)||!ub.test("<"+b.nodeName+">")?e=b.cloneNode(!0):(vb.innerHTML=b.outerHTML,vb.removeChild(e=vb.firstChild));if((!u.support.noCloneEvent||!u.support.noCloneChecked)&&(1===b.nodeType||11===b.nodeType)&&!u.isXMLDoc(b)){p(b,e);f=r(b);l=r(e);for(j=0;f[j];++j)l[j]&&p(f[j],l[j]);}if(c&&(m(b,e),d)){f=r(b);l=r(e);for(j=0;f[j];++j)m(f[j],l[j]);}return e;},clean:function(b,c,d,f){var l,j,e,q,m,p,g,r,t;r=c===I&&dc,t=[];if(!c||"undefined"==typeof c.createDocumentFragment)c=I;for(l=0;null!=(e=b[l]);l++)if("number"==typeof e&&(e+=""),e){if("string"==typeof e)if(hd.test(e)){r=r||n(c);p=c.createElement("div");r.appendChild(p);e=e.replace(ac,"<$1></$2>");j=(bc.exec(e)||["",""])[1].toLowerCase();q=ca[j]||ca._default;m=q[0];for(p.innerHTML=q[1]+e+q[2];m--;)p=p.lastChild;if(!u.support.tbody){m=gd.test(e);q="table"===j&&!m?p.firstChild&&p.firstChild.childNodes:"<table>"===q[1]&&!m?p.childNodes:[];for(j=q.length-1;0<=j;--j)u.nodeName(q[j],"tbody")&&!q[j].childNodes.length&&q[j].parentNode.removeChild(q[j]);}!u.support.leadingWhitespace&&tb.test(e)&&p.insertBefore(c.createTextNode(tb.exec(e)[0]),p.firstChild);e=p.childNodes;p.parentNode.removeChild(p);}else e=c.createTextNode(e);e.nodeType?t.push(e):u.merge(t,e);}p&&(e=p=r=null);p0P.v9();if(!u.support.appendChecked)for(l=0;null!=(e=t[l]);l++)u.nodeName(e,"input")?s(e):"undefined"!=typeof e.getElementsByTagName&&u.grep(e.getElementsByTagName("input"),s);if(d){b=function(b){if(!b.type||kd.test(b.type))return f?f.push(b.parentNode?b.parentNode.removeChild(b):b):d.appendChild(b);};for(l=0;null!=(e=t[l]);l++)if(!u.nodeName(e,"script")||!b(e))d.appendChild(e),"undefined"!=typeof e.getElementsByTagName&&(g=u.grep(u.merge([],e.getElementsByTagName("script")),b),t.splice.apply(t,[l+1,0].concat(g)),l+=g.length);}return t;},cleanData:function(b,c){p0P.v9();for(var d,f,l,j,e=0,n=u.expando,q=u.cache,m=u.support.deleteExpando,p=u.event.special;null!=(l=b[e]);e++)if(c||u.acceptData(l))if(d=(f=l[n])&&q[f]){if(d.events)for(j in d.events)p[j]?u.event.remove(l,j):u.removeEvent(l,j,d.handle);q[f]&&(delete q[f],m?delete l[n]:l.removeAttribute?l.removeAttribute(n):l[n]=null,u.deletedIds.push(f));}}});u.uaMatch=function(b){b=b.toLowerCase();b=/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||0>b.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[];p0P.q9();return{browser:b[1]||"",version:b[2]||"0"};};function f(){var i0P=333472582,W0P=-2067067301,O0P=1499521969;if(p0P.o9N(18,727981)===i0P||p0P.C9N(19,442888)===W0P||p0P.o9N(0,301126)===O0P||y4tt.k5P()){return!0;}}Ya=u.uaMatch(K.userAgent);function n(b){var c;c=zb.split("|");p0P.q9();b=b.createDocumentFragment();if(b.createElement)for(;c.length;)b.createElement(c.pop());return b;}function J(){p0P.v9();try{return new b.XMLHttpRequest();}catch(c){}}function A(b){var c,d;if(ab[b])return ab[b];c=u("<"+b+((3320,2662)!==79.68?">":!"1")).appendTo(I.body),d=c.css("display");c.remove();if("none"===d||""===d){ta=I.body.appendChild(ta||u.extend(I.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!ua||!ta.createElement)ua=(ta.contentWindow||ta.contentDocument).document,ua.write("<!doctype html><html><body>"),ua.close();c=ua.body.appendChild(ua.createElement(b));d=Y(c,"display");I.body.removeChild(ta);}return ab[b]=d,d;}ka={};Ya.browser&&(ka[Ya.browser]=!0,ka.version=Ya.version);ka.chrome?ka.webkit=!0:ka.webkit&&(ka.safari=!0);function d(){var U0P=-237635901,V0P=-1012307518,y0P=-2108273299;if(!(p0P.C9N(18,914170)!==U0P&&p0P.o9N(19,382640)!==V0P&&p0P.o9N(0,864807)!==y0P&&!y4tt.n5P())){return!1;}}u.browser=ka;u.sub=function(){var c;u.extend(!0,b,this);b.superclass=this;b.fn=b.prototype=this();b.fn.constructor=b;p0P.q9();b.sub=this.sub;b.fn.init=function(d,f){return f&&f instanceof u&&!(f instanceof b)&&(f=b(f)),u.fn.init.call(this,d,f,c);};b.fn.init.prototype=b.fn;function b(c,d){return new b.fn.init(c,d);}c=b(I);return b;};wb=/alpha\([^)]*\)/i,md=/opacity=([^)]*)/,nd=/^(top|right|bottom|left)$/,od=/^(none|table(?!-c[ea]).+)/,ec=/^margin/,sc=RegExp("^("+Ja+")(.*)$","i"),Ga=RegExp("^("+Ja+")(?!px)[a-z%]+$","i"),pd=RegExp("^([-+])=("+Ja+")","i"),ab={},qd={position:"absolute",visibility:"hidden",display:"block"},fc={letterSpacing:0,fontWeight:400},la=["Top","Right","Bottom","Left"],Bb=["Webkit","O","Moz","ms"],rd=u.fn.toggle;u.fn.extend({css:function(b,c){p0P.q9();return u.access(this,function(b,c,d){p0P.v9();return d!==g?u.style(b,c,d):u.css(b,c);},b,c,1<arguments.length);},show:function(){p0P.q9();return y(this,!0);},hide:function(){p0P.v9();return y(this);},toggle:function(b,c){var d;d="boolean"==typeof b;return u.isFunction(b)&&u.isFunction(c)?rd.apply(this,arguments):this.each(function(){p0P.q9();(d?b:v(this))?u(this).show():u(this).hide();});}});function B(b,c,d){var f,l,j;f="width"===c?b.offsetWidth:b.offsetHeight,l=!0,j=u.support.boxSizing&&"border-box"===u.css(b,"boxSizing");if(0>=f||null==f){f=Y(b,c);if(0>f||null==f)f=b.style[c];if(Ga.test(f))return f;l=j&&(u.support.boxSizingReliable||f===b.style[c]);f=parseFloat(f)||0;}return f+z(b,c,d||(j?"border":"content"),l)+"px";}function N(b){p0P.q9();return u.isWindow(b)?b:9===b.nodeType?b.defaultView||b.parentWindow:!1;}u.extend({cssHooks:{opacity:{get:function(b,c){var d;if(c){d=Y(b,"opacity");return""===d?"1":d;}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":u.support.cssFloat?"cssFloat":"styleFloat"},style:function(b,c,d,f){var l,j,e,n,q;if(b&&!(3===b.nodeType||8===b.nodeType||!b.style)){n=u.camelCase(c),q=b.style;c=u.cssProps[n]||(u.cssProps[n]=t(q,n));e=u.cssHooks[c]||u.cssHooks[n];if(d===g)return e&&"get"in e&&(l=e.get(b,!1,f))!==g?l:q[c];j=typeof d;"string"===j&&(l=pd.exec(d))&&(d=(l[1]+1)*l[2]+parseFloat(u.css(b,c)),j="number");if(!(null==d||"number"===j&&isNaN(d)))if("number"===j&&!u.cssNumber[n]&&(d+="px"),!e||!("set"in e)||(d=e.set(b,d,f))!==g)try{q[c]=d;}catch(m){}}},css:function(b,c,d,f){var l,j,e,n;n=u.camelCase(c);return c=u.cssProps[n]||(u.cssProps[n]=t(b.style,n)),e=u.cssHooks[c]||u.cssHooks[n],e&&"get"in e&&(l=e.get(b,!0,f)),l===g&&(l=Y(b,c)),"normal"===l&&c in fc&&(l=fc[c]),d||f!==g?(j=parseFloat(l),d||u.isNumeric(j)?j||0:l):l;},swap:function(b,c,d){var f,l;l={};for(f in c)l[f]=b.style[f],b.style[f]=c[f];d=d.call(b);for(f in c)b.style[f]=l[f];return d;}});function l(b,c,d){var M0P=-1802000096,R0P=1276269904,N0P=652532547;if(!(p0P.C9N(18,144512)!==M0P&&p0P.o9N(19,351838)!==R0P&&p0P.C9N(0,900283)!==N0P&&!y4tt.k5P())){var f;c=c||0;if(u.isFunction(c))return u.grep(b,function(b,f){p0P.v9();return!!c.call(b,f,b)===d;});if(c.nodeType)return u.grep(b,function(b){p0P.v9();return b===c===d;});if("string"==typeof c){f=u.grep(b,function(b){var t0P=-2086818967,z0P=-1396075355,A0P=-584281443;if(p0P.C9N(18,189265)===t0P||p0P.C9N(19,257928)===z0P||p0P.o9N(0,679215)===A0P||y4tt.n5P()){p0P.q9();return 1===b.nodeType;}});if(rc.test(c))return u.filter(c,f,!d);c=u.filter(c,f);}return u.grep(b,function(b){var w0P=-898786119,a0P=1969126378,j0P=-1655959253;if(!(p0P.C9N(18,975572)!==w0P&&p0P.o9N(19,707856)!==a0P&&p0P.C9N(0,250626)!==j0P&&!y4tt.k5P())){p0P.q9();return 0<=u.inArray(b,c)===d;}});}}b.getComputedStyle?Y=function(c,d){var f,l,j,e,n,q;n=b.getComputedStyle(c,null),q=c.style;p0P.q9();return n&&(f=n[d],""===f&&!u.contains(c.ownerDocument,c)&&(f=u.style(c,d)),Ga.test(f)&&ec.test(d)&&(l=q.width,j=q.minWidth,e=q.maxWidth,q.minWidth=q.maxWidth=q.width=f,f=n.width,q.width=l,q.minWidth=j,q.maxWidth=e)),f;}:I.documentElement.currentStyle&&(Y=function(b,c){var d,f,l,j;l=b.currentStyle&&b.currentStyle[c],j=b.style;return null==l&&j&&j[c]&&(l=j[c]),Ga.test(l)&&!nd.test(c)&&(d=j.left,f=b.runtimeStyle&&b.runtimeStyle.left,f&&(b.runtimeStyle.left=b.currentStyle.left),j.left="fontSize"===c?"1em":l,l=j.pixelLeft+"px",j.left=d,f&&(b.runtimeStyle.left=f)),""===l?"auto":l;});u.each(["height","width"],function(b,c){p0P.v9();u.cssHooks[c]={get:function(b,d,f){p0P.v9();if(d)return 0===b.offsetWidth&&od.test(Y(b,"display"))?u.swap(b,qd,function(){return B(b,c,f);}):B(b,c,f);},set:function(b,d,f){p0P.q9();return x(b,d,f?z(b,c,f,u.support.boxSizing&&"border-box"===u.css(b,"boxSizing")):0);}};});u.support.opacity||(u.cssHooks.opacity={get:function(b,c){return md.test((c&&b.currentStyle?b.currentStyle.filter:b.style.filter)||"")?0.01*parseFloat(RegExp.$1)+"":c?"1":"";},set:function(b,c){var d,f,l,j;d=b.style,f=b.currentStyle,l=u.isNumeric(c)?"alpha(opacity="+100*c+")":"",j=f&&f.filter||d.filter||"";d.zoom=1;p0P.v9();if(1<=c&&(""===u.trim(j.replace(wb,""))&&d.removeAttribute)&&(d.removeAttribute("filter"),f&&!f.filter))return;d.filter=wb.test(j)?j.replace(wb,l):j+" "+l;}});u(function(){p0P.q9();u.support.reliableMarginRight||(u.cssHooks.marginRight={get:function(b,c){p0P.v9();return u.swap(b,{display:"inline-block"},function(){p0P.q9();if(c)return Y(b,"marginRight");});}});!u.support.pixelPosition&&u.fn.position&&u.each(["top","left"],function(b,c){p0P.q9();u.cssHooks[c]={get:function(b,d){var f;if(d){f=Y(b,c);return Ga.test(f)?u(b).position()[c]+"px":f;}}};});});u.expr&&u.expr.filters&&(u.expr.filters.hidden=function(b){return 0===b.offsetWidth&&0===b.offsetHeight||!u.support.reliableHiddenOffsets&&"none"===(b.style&&b.style.display||Y(b,"display"));},u.expr.filters.visible=function(b){p0P.q9();return!u.expr.filters.hidden(b);});u.each({margin:"",padding:"",border:"Width"},function(b,c){p0P.v9();u.cssHooks[b+c]={expand:function(d){var f,l;f="string"==typeof d?d.split(" "):[d],l={};p0P.q9();for(d=0;4>d;d++)l[b+la[d]+c]=f[d]||f[d-2]||f[0];return l;}};ec.test(b)||(u.cssHooks[b+c].set=x);});sd=/%20/g,tc=/\[\]$/,gc=/\r?\n/g,td=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,ud=/^(?:select|textarea)/i;u.fn.extend({serialize:function(){return u.param(this.serializeArray());},serializeArray:function(){p0P.q9();return this.map(function(){p0P.q9();return this.elements?u.makeArray(this.elements):this;}).filter(function(){p0P.q9();return this.name&&!this.disabled&&(this.checked||ud.test(this.nodeName)||td.test(this.type));}).map(function(b,c){var d;p0P.v9();d=u(this).val();return null==d?null:u.isArray(d)?u.map(d,function(b){return{name:c.name,value:b.replace(gc,"\r\n")};}):{name:c.name,value:d.replace(gc,"\r\n")};}).get();}});u.param=function(b,c){var d,f,l;f=[],l=function(b,c){p0P.v9();c=u.isFunction(c)?c():null==c?"":c;f[f.length]=encodeURIComponent(b)+"="+encodeURIComponent(c);};c===g&&(c=u.ajaxSettings&&u.ajaxSettings.traditional);if(u.isArray(b)||b.jquery&&!u.isPlainObject(b))u.each(b,function(){l(this.name,this.value);});else for(d in b)C(d,b[d],c,l);p0P.v9();return f.join("&").replace(sd,"+");};vd=/#.*$/,wd=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,xd=/^(?:GET|HEAD)$/,yd=/^\/\//,hc=/\?/,zd=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Ad=/([?&])_=[^&]*/,ic=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,jc=u.fn.load,bb={},kc={},lc=["*/"]+["*"];function p(b,c){var d;1===c.nodeType&&(c.clearAttributes&&c.clearAttributes(),c.mergeAttributes&&c.mergeAttributes(b),d=c.nodeName.toLowerCase(),"object"===d?(c.parentNode&&(c.outerHTML=b.outerHTML),u.support.html5Clone&&b.innerHTML&&!u.trim(c.innerHTML)&&(c.innerHTML=b.innerHTML)):"input"===d&&Ab.test(b.type)?(c.defaultChecked=c.checked=b.checked,c.value!==b.value&&(c.value=b.value)):"option"===d?c.selected=b.defaultSelected:"input"===d||"textarea"===d?c.defaultValue=b.defaultValue:"script"===d&&c.text!==b.text&&(c.text=b.text),c.removeAttribute(u.expando));}try{sa=Q.href;}catch(Jd){sa=I.createElement("a"),sa.href="",sa=sa.href;}ya=ic.exec(sa.toLowerCase())||[];u.fn.load=function(b,c,d){var f,l,j,e,n;p0P.q9();if("string"!=typeof b&&jc)return jc.apply(this,arguments);if(!this.length)return this;e=this,n=b.indexOf(" ");return 0<=n&&(f=b.slice(n,b.length),b=b.slice(0,n)),u.isFunction(c)?(d=c,c=g):c&&"object"==typeof c&&(l="POST"),u.ajax({url:b,type:l,dataType:"html",data:c,complete:function(b,c){d&&e.each(d,j||[b.responseText,c,b]);}}).done(function(b){j=arguments;e.html(f?u("<div>").append(b.replace(zd,"")).find(f):b);}),this;};u.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(b,c){p0P.q9();u.fn[c]=function(b){return this.on(c,b);};});u.each(["get","post"],function(b,c){p0P.v9();u[c]=function(b,d,f,l){return u.isFunction(d)&&(l=l||f,f=d,d=g),u.ajax({type:c,url:b,data:d,success:f,dataType:l});};});u.extend({getScript:function(b,c){p0P.q9();return u.get(b,g,c,"script");},getJSON:function(b,c,d){p0P.v9();return u.get(b,c,d,"json");},ajaxSetup:function(b,c){p0P.v9();return c?H(b,u.ajaxSettings):(c=b,b=u.ajaxSettings),H(b,c),b;},ajaxSettings:{url:sa,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(ya[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":lc},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":b.String,"text html":!0,"text json":u.parseJSON,"text xml":u.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:G(bb),ajaxTransport:G(kc),ajax:function(b,c){var f,l,j,e,n,q,m,p,r,s,I,t,y,v,Q,x,z,B,K,C;"object"==typeof b&&(c=b,b=g);c=c||{};r=u.ajaxSetup({},c),s=r.context||r,I=s!==r&&(s.nodeType||s instanceof u)?u(s):u.event,t=u.Deferred(),y=u.Callbacks("once memory"),v=r.statusCode||{},Q={},x={},z=0,B="canceled",K={readyState:0,setRequestHeader:function(b,c){var d;p0P.v9();if(!z){d=b.toLowerCase();b=x[d]=x[d]||b;Q[b]=c;}return this;},getAllResponseHeaders:function(){p0P.q9();return 2===z?l:null;},getResponseHeader:function(b){var c;if(2===z){if(!j)for(j={};c=wd.exec(l);)j[c[1].toLowerCase()]=c[2];c=j[b.toLowerCase()];}return c===g?null:c;},overrideMimeType:function(b){return z||(r.mimeType=b),this;},abort:function(b){return b=b||B,e&&e.abort(b),d(0,b),this;}};t.promise(K);p0P.q9();K.success=K.done;K.error=K.fail;K.complete=y.add;K.statusCode=function(b){var c;p0P.q9();if(b){if(2>z)for(c in b)v[c]=[v[c],b[c]];else c=b[K.status],K.always(c);}return this;};r.url=((b||r.url)+"").replace(vd,"").replace(yd,ya[1]+"//");function d(b,c,j,q){var p,Q,x,B,C,A,R,G,D,H,J,F,Z,E,Fa;p0P.v9();A=c;if(2!==z){z=2;n&&clearTimeout(n);e=g;l=q||"";K.readyState=0<b?4:0;if(j){B=r;q=K;J=B.contents,F=B.dataTypes,Z=B.responseFields;for(G in Z)G in j&&(q[Z[G]]=j[G]);for(;"*"===F[0];)F.shift(),R===g&&(R=B.mimeType||q.getResponseHeader("content-type"));if(R)for(G in J)if(J[G]&&J[G].test(R)){F.unshift(G);break;}if(F[0]in j)D=F[0];else{for(G in j){if(!F[0]||B.converters[G+" "+F[0]]){D=G;break;}H||(H=G);}D=D||H;}j=D?(D!==F[0]&&F.unshift(D),j[D]):void 0;B=j;}if(200<=b&&300>b||304===b)if(r.ifModified&&(C=K.getResponseHeader("Last-Modified"),C&&(u.lastModified[f]=C),C=K.getResponseHeader("Etag"),C&&(u.etag[f]=C)),304===b)A="notmodified",p=!0;else{a:{p=r;Q=B;A=p.dataTypes.slice();j=A[0];R={};G=0;p.dataFilter&&(Q=p.dataFilter(Q,p.dataType));if(A[1])for(E in p.converters)R[E.toLowerCase()]=p.converters[E];for(;x=A[++G];)if("*"!==x){if("*"!==j&&j!==x){E=R[j+" "+x]||R["* "+x];if(!E)for(Fa in R)if(C=Fa.split(" "),C[1]===x&&(E=R[j+" "+C[0]]||R["* "+C[0]])){!0===E?E=R[Fa]:!0!==R[Fa]&&(x=C[0],A.splice(G--,0,x));break;}if(!0!==E)if(E&&p["throws"])Q=E(Q);else try{Q=E(Q);}catch(ba){E={state:"parsererror",error:E?ba:"No conversion from "+j+" to "+x};break a;}}j=x;}E={state:"success",data:Q};}p=E;A=p.state;Q=p.data;x=p.error;p=!x;}else if(x=A,!A||b)A="error",0>b&&(b=0);K.status=b;K.statusText=(c||A)+"";p?t.resolveWith(s,[Q,A,K]):t.rejectWith(s,[K,A,x]);K.statusCode(v);v=g;m&&I.trigger("ajax"+(p?"Success":"Error"),[K,r,p?Q:x]);y.fireWith(s,[K,A]);m&&(I.trigger("ajaxComplete",[K,r]),--u.active||u.event.trigger("ajaxStop"));}}r.dataTypes=u.trim(r.dataType||"*").toLowerCase().split(ma);null==r.crossDomain&&(q=ic.exec(r.url.toLowerCase())||!1,r.crossDomain=q&&q.join(":")+(q[3]?"":"http:"===q[1]?80:443)!==ya.join(":")+(ya[3]?"":"http:"===ya[1]?80:443));r.data&&r.processData&&"string"!=typeof r.data&&(r.data=u.param(r.data,r.traditional));D(bb,r,c,K);if(2===z)return K;m=r.global;r.type=r.type.toUpperCase();r.hasContent=!xd.test(r.type);m&&0===u.active++&&u.event.trigger("ajaxStart");if(!r.hasContent&&(r.data&&(r.url+=(hc.test(r.url)?"&":"?")+r.data,delete r.data),f=r.url,!1===r.cache)){q=u.now();C=r.url.replace(Ad,"$1_="+q);r.url=C+(C===r.url?(hc.test(r.url)?"&":"?")+"_="+q:"");}(r.data&&r.hasContent&&!1!==r.contentType||c.contentType)&&K.setRequestHeader("Content-Type",r.contentType);r.ifModified&&(f=f||r.url,u.lastModified[f]&&K.setRequestHeader("If-Modified-Since",u.lastModified[f]),u.etag[f]&&K.setRequestHeader("If-None-Match",u.etag[f]));K.setRequestHeader("Accept",r.dataTypes[0]&&r.accepts[r.dataTypes[0]]?r.accepts[r.dataTypes[0]]+("*"!==r.dataTypes[0]?", "+lc+"; q=0.01":""):r.accepts["*"]);for(p in r.headers)K.setRequestHeader(p,r.headers[p]);if(!r.beforeSend||!1!==r.beforeSend.call(s,K,r)&&2!==z){B="abort";for(p in{success:1,error:1,complete:1})K[p](r[p]);if(e=D(kc,r,c,K)){K.readyState=1;m&&I.trigger("ajaxSend",[K,r]);r.async&&0<r.timeout&&(n=setTimeout(function(){K.abort("timeout");},r.timeout));try{z=1,e.send(Q,d);}catch(A){if(2>z)d(-1,A);else throw A;}}else d(-1,"No Transport");return K;}return K.abort();},active:0,lastModified:{},etag:{}});mc=[],Bd=/\?/,Za=/(=)\?(?=&|$)|\?\?/,Cd=u.now();u.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var b;b=mc.pop()||u.expando+"_"+Cd++;return this[b]=!0,b;}});u.ajaxPrefilter("json jsonp",function(c,d,f){var l,j,e,n,q,m,p,r;n=c.data,q=c.url,m=!1!==c.jsonp,p=m&&Za.test(q),r=m&&!p&&"string"==typeof n&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&Za.test(n);p0P.q9();if("jsonp"===c.dataTypes[0]||p||r)return l=c.jsonpCallback=u.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,j=b[l],p?c.url=q.replace(Za,"$1"+l):r?c.data=n.replace(Za,"$1"+l):m&&(c.url+=(Bd.test(q)?"&":"?")+c.jsonp+"="+l),c.converters["script json"]=function(){return e||u.error(l+" was not called"),e[0];},c.dataTypes[0]="json",b[l]=function(){p0P.v9();e=arguments;},f.always(function(){b[l]=j;p0P.v9();c[l]&&(c.jsonpCallback=d.jsonpCallback,mc.push(l));e&&u.isFunction(j)&&j(e[0]);e=j=g;}),"script";});u.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(b){p0P.q9();return u.globalEval(b),b;}}});u.ajaxPrefilter("script",function(b){b.cache===g&&(b.cache=!1);b.crossDomain&&(b.type="GET",b.global=!1);});u.ajaxTransport("script",function(b){var c,d;if(b.crossDomain){d=I.head||I.getElementsByTagName("head")[0]||I.documentElement;return{send:function(f,l){c=I.createElement("script");c.async="async";b.scriptCharset&&(c.charset=b.scriptCharset);c.src=b.url;c.onload=c.onreadystatechange=function(b,f){p0P.q9();if(f||!c.readyState||/loaded|complete/.test(c.readyState))c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=g,f||l(200,"success");};p0P.q9();d.insertBefore(c,d.firstChild);},abort:function(){p0P.v9();c&&c.onload(0,1);}};}});xb=b.ActiveXObject?function(){for(var b in za)za[b](0,1);}:!1,Dd=0;u.ajaxSettings.xhr=b.ActiveXObject?function(){var c;if(!(c=!this.isLocal&&J()))a:{try{c=new b.ActiveXObject("Microsoft.XMLHTTP");break a;}catch(d){}c=void 0;}return c;}:J;yb=u.ajaxSettings.xhr();u.extend(u.support,{ajax:!!yb,cors:!!yb&&"withCredentials"in yb});u.support.ajax&&u.ajaxTransport(function(c){var d;if(!c.crossDomain||u.support.cors){return{send:function(f,l){var j,e,n;n=c.xhr();c.username?n.open(c.type,c.url,c.async,c.username,c.password):n.open(c.type,c.url,c.async);if(c.xhrFields)for(e in c.xhrFields)n[e]=c.xhrFields[e];c.mimeType&&n.overrideMimeType&&n.overrideMimeType(c.mimeType);p0P.q9();!c.crossDomain&&!f["X-Requested-With"]&&(f["X-Requested-With"]="XMLHttpRequest");try{for(e in f)n.setRequestHeader(e,f[e]);}catch(q){}n.send(c.hasContent&&c.data||null);d=function(b,f){var e,q,m,p,r;try{if(d&&(f||4===n.readyState))if(d=g,j&&(n.onreadystatechange=u.noop,xb&&delete za[j]),f)4!==n.readyState&&n.abort();else{e=n.status;m=n.getAllResponseHeaders();p={};(r=n.responseXML)&&r.documentElement&&(p.xml=r);try{p.text=n.responseText;}catch(s){}try{q=n.statusText;}catch(I){q="";}!e&&c.isLocal&&!c.crossDomain?e=p.text?200:404:1223===e&&(e=204);}}catch(t){f||l(-1,t);}p0P.q9();p&&l(e,q,p,m);};c.async?4===n.readyState?setTimeout(d,0):(j=++Dd,xb&&(za||(za={},u(b).unload(xb)),za[j]=d),n.onreadystatechange=d):d();},abort:function(){p0P.v9();d&&d(0,1);}};}});Ed=/^(?:toggle|show|hide)$/,Fd=RegExp("^(?:([-+])=|)("+Ja+")([a-z%]*)$","i"),Gd=/queueHooks$/,Ia=[function(b,c,d){var f,l,j,e,n,q,m,p,g,r,s;p0P.v9();m=this,p=b.style,g={},r=[],s=b.nodeType&&v(b);d.queue||(n=u._queueHooks(b,"fx"),null==n.unqueued&&(n.unqueued=0,q=n.empty.fire,n.empty.fire=function(){n.unqueued||q();}),n.unqueued++,m.always(function(){p0P.v9();m.always(function(){n.unqueued--;u.queue(b,"fx").length||n.empty.fire();});}));1===b.nodeType&&("height"in c||"width"in c)&&(d.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===u.css(b,"display")&&"none"===u.css(b,"float")&&(!u.support.inlineBlockNeedsLayout||"inline"===A(b.nodeName)?p.display="inline-block":p.zoom=1));d.overflow&&(p.overflow="hidden",u.support.shrinkWrapBlocks||m.done(function(){p.overflow=d.overflow[0];p.overflowX=d.overflow[1];p.overflowY=d.overflow[2];}));for(f in c)l=c[f],Ed.exec(l)&&(delete c[f],l!==(s?"hide":"show")&&r.push(f));if(l=r.length){j=u._data(b,"fxshow")||u._data(b,"fxshow",{});s?u(b).show():m.done(function(){u(b).hide();});m.done(function(){var c;u.removeData(b,"fxshow",!0);for(c in g)u.style(b,c,g[c]);});for(f=0;f<l;f++)c=r[f],e=m.createTween(c,s?j[c]:0),g[c]=j[c]||u.style(b,c),c in j||(j[c]=e.start,s&&(e.end=e.start,e.start="width"===c||"height"===c?1:0));}}],Aa={"*":[function(b,c){var d,f,l,j,e,n,q,m;l=this.createTween(b,c),j=Fd.exec(c),e=l.cur(),n=+e||0,q=1,m=20;if(j){d=+j[2];f=j[3]||(u.cssNumber[b]?"":"px");if("px"!==f&&n){n=u.css(l.elem,b,!0)||d||1;do q=q||".5",n/=q,u.style(l.elem,b,n+f);while(q!==(q=l.cur()/e)&&1!==q&&--m);}l.unit=f;l.start=n;l.end=j[1]?n+(j[1]+1)*d:d;}p0P.v9();return l;}]};u.Animation=u.extend(O,{tweener:function(b,c){u.isFunction(b)?(c=b,b=["*"]):b=b.split(" ");for(var d,f=0,l=b.length;f<l;f++)d=b[f],Aa[d]=Aa[d]||[],Aa[d].unshift(c);},prefilter:function(b,c){c?Ia.unshift(b):Ia.push(b);}});u.Tween=E;E.prototype={constructor:E,init:function(b,c,d,f,l,j){this.elem=b;p0P.q9();this.prop=d;this.easing=l||"swing";this.options=c;this.start=this.now=this.cur();this.end=f;this.unit=j||(u.cssNumber[d]?"":"px");},cur:function(){var b;p0P.q9();b=E.propHooks[this.prop];return b&&b.get?b.get(this):E.propHooks._default.get(this);},run:function(b){var c,d;p0P.v9();d=E.propHooks[this.prop];return this.options.duration?this.pos=c=u.easing[this.easing](b,this.options.duration*b,0,1,this.options.duration):this.pos=c=b,this.now=(this.end-this.start)*c+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),d&&d.set?d.set(this):E.propHooks._default.set(this),this;}};E.prototype.init.prototype=E.prototype;E.propHooks={_default:{get:function(b){var c;return null==b.elem[b.prop]||b.elem.style&&null!=b.elem.style[b.prop]?(c=u.css(b.elem,b.prop,!1,""),!c||"auto"===c?0:c):b.elem[b.prop];},set:function(b){u.fx.step[b.prop]?u.fx.step[b.prop](b):b.elem.style&&(null!=b.elem.style[u.cssProps[b.prop]]||u.cssHooks[b.prop])?u.style(b.elem,b.prop,b.now+b.unit):b.elem[b.prop]=b.now;}}};E.propHooks.scrollTop=E.propHooks.scrollLeft={set:function(b){p0P.v9();b.elem.nodeType&&b.elem.parentNode&&(b.elem[b.prop]=b.now);}};u.each(["toggle","show","hide"],function(b,c){var d;d=u.fn[c];u.fn[c]=function(f,l,j){p0P.q9();return null==f||"boolean"==typeof f||!b&&u.isFunction(f)&&u.isFunction(l)?d.apply(this,arguments):this.animate(L(c,!0),f,l,j);};});u.fn.extend({fadeTo:function(b,c,d,f){p0P.v9();return this.filter(v).css("opacity",0).show().end().animate({opacity:c},b,d,f);},animate:function(b,c,d,f){var l,j;l=u.isEmptyObject(b),j=u.speed(c,d,f);c=function(){var c;p0P.q9();c=O(this,u.extend({},b),j);l&&c.stop(!0);};return l||!1===j.queue?this.each(c):this.queue(j.queue,c);},stop:function(b,c,d){var f;f=function(b){var c;c=b.stop;p0P.q9();delete b.stop;c(d);};return"string"!=typeof b&&(d=c,c=b,b=g),c&&!1!==b&&this.queue(b||"fx",[]),this.each(function(){var c,l,j,e;c=!0,l=null!=b&&b+"queueHooks",j=u.timers,e=u._data(this);if(l)e[l]&&e[l].stop&&f(e[l]);else for(l in e)e[l]&&e[l].stop&&Gd.test(l)&&f(e[l]);for(l=j.length;l--;)j[l].elem===this&&(null==b||j[l].queue===b)&&(j[l].anim.stop(d),c=!1,j.splice(l,1));(c||!d)&&u.dequeue(this,b);});}});u.each({slideDown:L("show"),slideUp:L("hide"),slideToggle:L("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(b,c){p0P.q9();u.fn[b]=function(b,d,f){p0P.q9();return this.animate(c,b,d,f);};});u.speed=function(b,c,d){var f;p0P.q9();f=b&&"object"==typeof b?u.extend({},b):{complete:d||!d&&c||u.isFunction(b)&&b,duration:b,easing:d&&c||c&&!u.isFunction(c)&&c};f.duration=u.fx.off?0:"number"==typeof f.duration?f.duration:f.duration in u.fx.speeds?u.fx.speeds[f.duration]:u.fx.speeds._default;if(null==f.queue||!0===f.queue)f.queue="fx";return f.old=f.complete,f.complete=function(){u.isFunction(f.old)&&f.old.call(this);f.queue&&u.dequeue(this,f.queue);},f;};u.easing={linear:function(b){p0P.q9();return b;},swing:function(b){p0P.q9();return 0.5-Math.cos(b*Math.PI)/2;}};u.timers=[];u.fx=E.prototype.init;u.fx.tick=function(){for(var b,c=u.timers,d=0;d<c.length;d++)b=c[d],!b()&&c[d]===b&&c.splice(d--,1);c.length||u.fx.stop();};u.fx.timer=function(b){p0P.v9();b()&&u.timers.push(b)&&!$a&&($a=setInterval(u.fx.tick,u.fx.interval));};u.fx.interval=13;u.fx.stop=function(){p0P.q9();clearInterval($a);$a=null;};u.fx.speeds={slow:600,fast:200,_default:400};u.fx.step={};function G(b){p0P.v9();return function(c,d){var f,l,j,e,n;"string"!=typeof c&&(d=c,c="*");j=c.toLowerCase().split(ma),e=0,n=j.length;if(u.isFunction(d))for(;e<n;e++)f=j[e],(l=/^\+/.test(f))&&(f=f.substr(1)||"*"),f=b[f]=b[f]||[],f[l?"unshift":"push"](d);};}u.expr&&u.expr.filters&&(u.expr.filters.animated=function(b){return u.grep(u.timers,function(c){p0P.v9();return b===c.elem;}).length;});nc=/^(?:body|html)$/i;u.fn.offset=function(b){var c,d,f,l,j,e,n,q,m,p;p0P.q9();if(arguments.length)return b===g?this:this.each(function(c){p0P.q9();u.offset.setOffset(this,b,c);});q={top:0,left:0},m=this[0],p=m&&m.ownerDocument;if(p)return(d=p.body)===m?u.offset.bodyOffset(m):(c=p.documentElement,u.contains(c,m)?("undefined"!=typeof m.getBoundingClientRect&&(q=m.getBoundingClientRect()),f=N(p),l=c.clientTop||d.clientTop||0,j=c.clientLeft||d.clientLeft||0,e=f.pageYOffset||c.scrollTop,n=f.pageXOffset||c.scrollLeft,{top:q.top+e-l,left:q.left+n-j}):q);};u.offset={bodyOffset:function(b){var c,d;c=b.offsetTop,d=b.offsetLeft;p0P.q9();return u.support.doesNotIncludeMarginInBodyOffset&&(c+=parseFloat(u.css(b,"marginTop"))||0,d+=parseFloat(u.css(b,"marginLeft"))||0),{top:c,left:d};},setOffset:function(b,c,d){var f,l,j,e,n,q,m,p,g;f=u.css(b,"position");"static"===f&&(b.style.position="relative");l=u(b),j=l.offset(),e=u.css(b,"top"),n=u.css(b,"left"),q={},m={};("absolute"===f||"fixed"===f)&&-1<u.inArray("auto",[e,n])?(m=l.position(),p=m.top,g=m.left):(p=parseFloat(e)||0,g=parseFloat(n)||0);u.isFunction(c)&&(c=c.call(b,d,j));null!=c.top&&(q.top=c.top-j.top+p);null!=c.left&&(q.left=c.left-j.left+g);p0P.q9();"using"in c?c.using.call(b,q):l.css(q);}};function e(b,c,d){if(d===g&&1===b.nodeType)if(d="data-"+c.replace(oc,"-$1").toLowerCase(),d=b.getAttribute(d),"string"==typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:pc.test(d)?u.parseJSON(d):d;}catch(f){}u.data(b,c,d);}else d=g;return d;}function O(b,c,d){var f,l,j,e,n,q,m,p,g,r,s;p0P.q9();l=0,j=Ia.length,e=u.Deferred().always(function(){delete n.elem;}),n=function(){for(var c=Ha||F(),c=Math.max(0,q.startTime+q.duration-c),d=1-(c/q.duration||0),f=0,l=q.tweens.length;f<l;f++)q.tweens[f].run(d);p0P.q9();return e.notifyWith(b,[q,d,c]),1>d&&l?c:(e.resolveWith(b,[q]),!1);},q=e.promise({elem:b,props:u.extend({},c),opts:u.extend(!0,{specialEasing:{}},d),originalProperties:c,originalOptions:d,startTime:Ha||F(),duration:d.duration,tweens:[],createTween:function(c,d){var f;f=u.Tween(b,q.opts,c,d,q.opts.specialEasing[c]||q.opts.easing);return q.tweens.push(f),f;},stop:function(c){for(var d=0,f=c?q.tweens.length:0;d<f;d++)q.tweens[d].run(1);p0P.q9();return c?e.resolveWith(b,[q,c]):e.rejectWith(b,[q,c]),this;}});c=q.props;d=q.opts.specialEasing;for(f in c)if(m=u.camelCase(f),p=d[m],g=c[f],u.isArray(g)&&(p=g[1],g=c[f]=g[0]),f!==m&&(c[m]=g,delete c[f]),(r=u.cssHooks[m])&&"expand"in r)for(f in g=r.expand(g),delete c[m],g)f in c||(c[f]=g[f],d[f]=p);else d[m]=p;for(;l<j;l++)if(f=Ia[l].call(q,b,c,q.opts))return f;s=q;u.each(c,function(b,c){p0P.v9();for(var d=(Aa[b]||[]).concat(Aa["*"]),f=0,l=d.length;f<l&&!d[f].call(s,b,c);f++);});return u.isFunction(q.opts.start)&&q.opts.start.call(b,q),u.fx.timer(u.extend(n,{anim:q,queue:q.opts.queue,elem:b})),q.progress(q.opts.progress).done(q.opts.done,q.opts.complete).fail(q.opts.fail).always(q.opts.always);}u.fn.extend({position:function(){var b,c,d,f;if(this[0]){b=this[0],c=this.offsetParent(),d=this.offset(),f=nc.test(c[0].nodeName)?{top:0,left:0}:c.offset();return d.top-=parseFloat(u.css(b,"marginTop"))||0,d.left-=parseFloat(u.css(b,"marginLeft"))||0,f.top+=parseFloat(u.css(c[0],"borderTopWidth"))||0,f.left+=parseFloat(u.css(c[0],"borderLeftWidth"))||0,{top:d.top-f.top,left:d.left-f.left};}},offsetParent:function(){p0P.v9();return this.map(function(){for(var b=this.offsetParent||I.body;b&&!nc.test(b.nodeName)&&"static"===u.css(b,"position");)b=b.offsetParent;return b||I.body;});}});u.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d;p0P.v9();d=/Y/.test(c);u.fn[b]=function(f){return u.access(this,function(b,f,l){var j;j=N(b);if(l===g)return j?c in j?j[c]:j.document.documentElement[f]:b[f];j?j.scrollTo(d?u(j).scrollLeft():l,d?l:u(j).scrollTop()):b[f]=l;},b,f,arguments.length,null);};});u.each({Height:"height",Width:"width"},function(b,c){p0P.q9();u.each({padding:"inner"+b,content:c,"":"outer"+b},function(d,f){p0P.v9();u.fn[f]=function(f,l){var j,e;p0P.v9();j=arguments.length&&(d||"boolean"!=typeof f),e=d||(!0===f||!0===l?"margin":"border");return u.access(this,function(c,d,f){var l;return u.isWindow(c)?c.document.documentElement["client"+b]:9===c.nodeType?(l=c.documentElement,Math.max(c.body["scroll"+b],l["scroll"+b],c.body["offset"+b],l["offset"+b],l["client"+b])):f===g?u.css(c,d,f,e):u.style(c,d,f,e);},c,j?f:g,j,null);};});});b.jQuery=b.$=u;"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){p0P.v9();return u;});}}(window));HANDJS=HANDJS||{};(function(){function g(b){var c;c=[];y4tt.q9();if(b)for(c.unshift(b);b.parentNode;)c.unshift(b.parentNode),b=b.parentNode;return c;}var q,j,l,n,m,p,r,s,t,v,y,x,z,B,A;function d(b,c,d){y4tt.q9();for(c=e(b,c);b&&b!=c;)b.__handjsGlobalRegisteredEvents&&b.__handjsGlobalRegisteredEvents.pointerleave&&d(b),b=b.parentNode;}y4tt.v9();function c(b,c,d){y4tt.v9();c=e(b,c);for(var f=[];b&&b!=c;)b.__handjsGlobalRegisteredEvents&&b.__handjsGlobalRegisteredEvents.pointerenter&&f.push(b),b=b.parentNode;for(;0<f.length;)d(f.pop());}if(!window.PointerEvent){Array.prototype.indexOf||(Array.prototype.indexOf=function(b){var c,d,f;y4tt.q9();c=Object(this),d=c.length>>>0;if(0===d)return-1;f=0;0<arguments.length&&(f=Number(arguments[1]),f!=f?f=0:0!=f&&(Infinity!=f&&-Infinity!=f)&&(f=(0<f||-1)*Math.floor(Math.abs(f))));if(f>=d)return-1;for(f=0<=f?f:Math.max(d-Math.abs(f),0);f<d;f++)if(f in c&&c[f]===b)return f;return-1;});String.prototype.trim||(String.prototype.trim=function(){y4tt.v9();return this.replace(/^\s+|\s+$/,"");});q="pointerdown pointerup pointermove pointerover pointerout pointercancel pointerenter pointerleave".split(" "),j="PointerDown PointerUp PointerMove PointerOver PointerOut PointerCancel PointerEnter PointerLeave".split(" "),l={},n=function(b,c,d,f){var l,j;document.createEvent?(l=document.createEvent("MouseEvents"),l.initMouseEvent(c,d,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.button,null)):(l=document.createEventObject(),l.screenX=b.screenX,l.screenY=b.screenY,l.clientX=b.clientX,l.clientY=b.clientY,l.ctrlKey=b.ctrlKey,l.altKey=b.altKey,l.shiftKey=b.shiftKey,l.metaKey=b.metaKey,l.button=b.button);void 0===l.offsetX&&(void 0!==b.offsetX?(Object&&void 0!==Object.defineProperty&&(Object.defineProperty(l,"offsetX",{writable:!0}),Object.defineProperty(l,"offsetY",{writable:!0})),l.offsetX=b.offsetX,l.offsetY=b.offsetY):Object&&void 0!==Object.defineProperty?(Object.defineProperty(l,"offsetX",{get:function(){return this.currentTarget&&this.currentTarget.offsetLeft?b.clientX-this.currentTarget.offsetLeft:b.clientX;}}),Object.defineProperty(l,"offsetY",{get:function(){y4tt.q9();return this.currentTarget&&this.currentTarget.offsetTop?b.clientY-this.currentTarget.offsetTop:b.clientY;}})):void 0!==b.layerX&&(l.offsetX=b.layerX-b.currentTarget.offsetLeft,l.offsetY=b.layerY-b.currentTarget.offsetTop));l.isPrimary=void 0!==b.isPrimary?b.isPrimary:!0;b.pressure?l.pressure=b.pressure:(d=0,void 0!==b.which?d=b.which:void 0!==b.button&&(d=b.button),l.pressure=0==d?0:0.5);l.rotation=b.rotation?b.rotation:0;l.hwTimestamp=b.hwTimestamp?b.hwTimestamp:0;y4tt.q9();l.tiltX=b.tiltX?b.tiltX:0;l.tiltY=b.tiltY?b.tiltY:0;l.height=b.height?b.height:0;l.width=b.width?b.width:0;l.preventDefault=function(){void 0!==b.preventDefault&&b.preventDefault();};if(void 0!==l.stopPropagation){j=l.stopPropagation;l.stopPropagation=function(){y4tt.v9();void 0!==b.stopPropagation&&b.stopPropagation();j.call(this);};}l.pointerId=b.pointerId;l.pointerType=b.pointerType;switch(l.pointerType){case 2:l.pointerType="touch";break;case 3:l.pointerType="pen";break;case 4:l.pointerType="mouse";}f?f.dispatchEvent(l):b.target?b.target.dispatchEvent(l):b.srcElement.fireEvent("on"+t(c),l);},m=function(b,c,d,f){b.pointerId=1;b.pointerType="mouse";n(b,c,d,f);},p=function(b,c,d,f,l){c.pointerId=c.identifier+2;c.pointerType="touch";c.currentTarget=d;void 0!==f.preventDefault&&(c.preventDefault=function(){f.preventDefault();});n(c,b,l,d);},r=function(b,c){for(;b&&(!b.__handjsGlobalRegisteredEvents||!b.__handjsGlobalRegisteredEvents[c]);)b=b.parentNode;y4tt.v9();if(b)return b;if(window.__handjsGlobalRegisteredEvents&&window.__handjsGlobalRegisteredEvents[c])return window;},s=function(b,c,d,f,l){y4tt.v9();r(d,b)&&p(b,c,d,f,l);},t=function(b){y4tt.v9();return b.toLowerCase().replace("pointer","mouse");},v=function(b,c,d,f){void 0===b.__handjsRegisteredEvents&&(b.__handjsRegisteredEvents=[]);y4tt.q9();if(f)void 0!==b.__handjsRegisteredEvents[c]?b.__handjsRegisteredEvents[c]++:(b.__handjsRegisteredEvents[c]=1,b.addEventListener(c,d,!1));else{if(-1!==b.__handjsRegisteredEvents.indexOf(c)&&(b.__handjsRegisteredEvents[c]--,0!=b.__handjsRegisteredEvents[c]))return;b.removeEventListener(c,d);b.__handjsRegisteredEvents[c]=0;}},y=function(b,c,d){b.__handjsGlobalRegisteredEvents||(b.__handjsGlobalRegisteredEvents=[]);if(d){if(void 0!==b.__handjsGlobalRegisteredEvents[c]){b.__handjsGlobalRegisteredEvents[c]++;return;}b.__handjsGlobalRegisteredEvents[c]=1;}else void 0!==b.__handjsGlobalRegisteredEvents[c]&&(b.__handjsGlobalRegisteredEvents[c]--,0>b.__handjsGlobalRegisteredEvents[c]&&(b.__handjsGlobalRegisteredEvents[c]=0));y4tt.q9();if(!window.MSPointerEvent)switch(c){case"pointerenter":void 0!==b.onmouseenter&&v(b,"mouseenter",function(b){m(b,c);},d);break;case"pointerleave":void 0!==b.onmouseleave&&v(b,"mouseleave",function(b){m(b,c);},d);}},x=function(b){var c,d;y4tt.q9();c=b.prototype?b.prototype.addEventListener:b.addEventListener,d=function(b,d,f){-1!=q.indexOf(b)&&y(this,b,!0);y4tt.q9();void 0===c?this.attachEvent("on"+t(b),d):c.call(this,b,d,f);};b.prototype?b.prototype.addEventListener=d:b.addEventListener=d;},z=function(b){var c,d;y4tt.q9();c=b.prototype?b.prototype.removeEventListener:b.removeEventListener,d=function(b,d,f){y4tt.q9();-1!=q.indexOf(b)&&y(this,b,!1);void 0===c?this.detachEvent(t(b),d):c.call(this,b,d,f);};b.prototype?b.prototype.removeEventListener=d:b.removeEventListener=d;};x(window);x(window.HTMLElement||window.Element);x(document);x(HTMLBodyElement);x(HTMLDivElement);x(HTMLImageElement);x(HTMLUListElement);x(HTMLAnchorElement);x(HTMLLIElement);x(HTMLTableElement);window.HTMLSpanElement&&x(HTMLSpanElement);window.HTMLCanvasElement&&x(HTMLCanvasElement);window.SVGElement&&x(SVGElement);z(window);z(window.HTMLElement||window.Element);z(document);z(HTMLBodyElement);z(HTMLDivElement);z(HTMLImageElement);z(HTMLUListElement);z(HTMLAnchorElement);z(HTMLLIElement);z(HTMLTableElement);window.HTMLSpanElement&&z(HTMLSpanElement);window.HTMLCanvasElement&&z(HTMLCanvasElement);window.SVGElement&&z(SVGElement);B=!1,A=-1;window.MSPointerEvent?f(function(b){b=q.indexOf(b);return"MS"+j[b];},n):(f(t,m),void 0!==window.ontouchstart&&(window.addEventListener("touchstart",function(d){var j;for(var f=0;f<d.changedTouches.length;++f){j=d.changedTouches[f];l[j.identifier]=j.target;s("pointerover",j,j.target,d,!0);c(j.target,null,function(b){y4tt.v9();p("pointerenter",j,b,d,!1);});s("pointerdown",j,j.target,d,!0);}b();}),window.addEventListener("touchend",function(c){var j,e;for(var f=0;f<c.changedTouches.length;++f){j=c.changedTouches[f],e=l[j.identifier];s("pointerup",j,e,c,!0);s("pointerout",j,e,c,!0);d(e,null,function(b){y4tt.v9();p("pointerleave",j,b,c,!1);});}b();}),window.addEventListener("touchmove",function(f){var e,n,q,m;for(var j=0;j<f.changedTouches.length;++j){e=f.changedTouches[j],n=document.elementFromPoint(e.clientX,e.clientY),q=l[e.identifier];if(m=q){for(m=q;m&&!m.handjs_forcePreventDefault;)m=m.parentNode;m=!0===(!!m||window.handjs_forcePreventDefault);}m&&f.preventDefault();s("pointermove",e,q,f,!0);q!==n&&(q&&(s("pointerout",e,q,f,!0),q.contains(n)||d(q,n,function(b){y4tt.v9();p("pointerleave",e,b,f,!1);})),n&&(s("pointerover",e,n,f,!0),n.contains(q)||c(n,q,function(b){y4tt.q9();p("pointerenter",e,b,f,!1);})),l[e.identifier]=n);}b();}),window.addEventListener("touchcancel",function(b){var d;for(var c=0;c<b.changedTouches.length;++c){d=b.changedTouches[c];s("pointercancel",d,l[d.identifier],b,!0);}})));void 0===navigator.pointerEnabled&&(navigator.pointerEnabled=!0,navigator.msPointerEnabled&&(navigator.maxTouchPoints=navigator.msMaxTouchPoints));document.styleSheets&&document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){var b,c,d,f,j,e,n;if(!(HANDJS.doNotProcessCSS||void 0!==document.body.style.touchAction)){b=/.+?{.*?}/m,c=/.+?{/m,d=function(d){var f,l,j;f=b.exec(d);if(f){f=f[0];d=d.replace(f,"").trim();l=c.exec(f)[0].replace("{","").trim();if(-1!=f.replace(/\s/g,"").indexOf("touch-action:none")){f=document.querySelectorAll(l);for(l=0;l<f.length;l++){j=f[l];void 0!==j.style.msTouchAction?j.style.msTouchAction="none":j.handjs_forcePreventDefault=!0;}}return d;}},f=function(b){y4tt.q9();if(window.setImmediate)b&&setImmediate(f,d(b));else for(;b;)b=d(b);};try{for(var l=0;l<document.styleSheets.length;l++){j=document.styleSheets[l];if(void 0!=j.href){e=new XMLHttpRequest();e.open("get",j.href,!1);e.send();n=e.responseText.replace(/(\n|\r)/g,"");f(n);}}}catch(q){}j=document.getElementsByTagName("style");for(l=0;l<j.length;l++)e=j[l].innerHTML.replace(/(\n|\r)/g,"").trim(),f(e);}},!1);}function f(b,f){["pointerdown","pointermove","pointerup","pointerover","pointerout"].forEach(function(c){y4tt.v9();window.addEventListener(b(c),function(b){!B&&r(b.target,c)&&f(b,c,!0);});});y4tt.v9();void 0===window["on"+b("pointerenter").toLowerCase()]&&window.addEventListener(b("pointerover"),function(b){var d;y4tt.v9();if(!B){d=r(b.target,"pointerenter");d&&d!==window&&(d.contains(b.relatedTarget)||c(d,b.relatedTarget,function(c){y4tt.q9();f(b,"pointerenter",!1,c);}));}});void 0===window["on"+b("pointerleave").toLowerCase()]&&window.addEventListener(b("pointerout"),function(b){var c;y4tt.q9();if(!B){c=r(b.target,"pointerleave");c&&c!==window&&(c.contains(b.relatedTarget)||d(c,b.relatedTarget,function(c){y4tt.q9();f(b,"pointerleave",!1,c);}));}});}function e(b,c){y4tt.v9();for(var d=g(b),f=g(c),l=null;0<d.length&&d[0]==f.shift();)l=d.shift();return l;}function b(){B=!0;clearTimeout(A);A=setTimeout(function(){y4tt.q9();B=!1;},700);}}());function getQueryVariable(b){var c;y4tt.q9();for(var g=window.location.search.substring(1).split("&"),e=0;e<g.length;e++){c=g[e].split("=");if(decodeURIComponent(c[0])==b)return decodeURIComponent(c[1]);}}window.wgl={modules:{}};__decorate=this&&this.__decorate||function(b,g,e,c){var d,f,q;f=arguments.length,q=3>f?g:null===c?c=Object.getOwnPropertyDescriptor(g,e):c;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)q=Reflect.decorate(b,g,e,c);else for(var j=b.length-1;0<=j;j--)(d=b[j])&&(q=(3>f?d(q):3<f?d(g,e,q):d(g,e))||q);return 3<f&&q&&Object.defineProperty(g,e,q),q;},__extends=this&&this.__extends||function(b,g){function e(){this.constructor=b;}y4tt.q9();for(var c in g)g.hasOwnProperty(c)&&(b[c]=g[c]);e.prototype=g.prototype;b.prototype=new e();};!function(b){var g,e,c,d,f,q,j,l,n,m,p,r,s,t,v,y,x,z,B,A,C,G,D,H,J,F,O,E,L,N,P,M;b.ToGammaSpace=1/2.2;b.ToLinearSpace=2.2;b.Epsilon=0.001;e=function(){};g=(e.WithinEpsilon=function(b,c,d){void 0===d&&(d=1.401298E-45);b-=c;return b>=-d&&d>=b;},e.ToHex=function(b){var c;c=b.toString(16);return 15>=b?("0"+c).toUpperCase():c.toUpperCase();},e.Sign=function(b){y4tt.q9();return b=+b,0===b||isNaN(b)?b:0<b?1:-1;},e.Clamp=function(b,c,d){y4tt.q9();return void 0===c&&(c=0),void 0===d&&(d=1),Math.min(d,Math.max(c,b));},e);b.MathTools=g;c=function(b,c,d){void 0===b&&(b=0);void 0===c&&(c=0);void 0===d&&(d=0);this.r=b;y4tt.v9();this.g=c;this.b=d;},e=(c.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}";},c.prototype.getClassName=function(){return"Color3";},c.prototype.getHashCode=function(){var b;b=this.r||0;y4tt.v9();return b=397*b^(this.g||0),397*b^(this.b||0);},c.prototype.toArray=function(b,c){return void 0===c&&(c=0),b[c]=this.r,b[c+1]=this.g,b[c+2]=this.b,this;},c.prototype.toColor4=function(b){y4tt.v9();return void 0===b&&(b=1),new d(this.r,this.g,this.b,b);},c.prototype.asArray=function(){var b;b=[];y4tt.v9();return this.toArray(b,0),b;},c.prototype.toLuminance=function(){y4tt.v9();return 0.3*this.r+0.59*this.g+0.11*this.b;},c.prototype.multiply=function(b){return new c(this.r*b.r,this.g*b.g,this.b*b.b);},c.prototype.multiplyToRef=function(b,c){return c.r=this.r*b.r,c.g=this.g*b.g,c.b=this.b*b.b,this;},c.prototype.equals=function(b){y4tt.v9();return b&&this.r===b.r&&this.g===b.g&&this.b===b.b;},c.prototype.equalsFloats=function(b,c,d){y4tt.v9();return this.r===b&&this.g===c&&this.b===d;},c.prototype.scale=function(b){y4tt.v9();return new c(this.r*b,this.g*b,this.b*b);},c.prototype.scaleToRef=function(b,c){y4tt.v9();return c.r=this.r*b,c.g=this.g*b,c.b=this.b*b,this;},c.prototype.add=function(b){y4tt.q9();return new c(this.r+b.r,this.g+b.g,this.b+b.b);},c.prototype.addToRef=function(b,c){return c.r=this.r+b.r,c.g=this.g+b.g,c.b=this.b+b.b,this;},c.prototype.subtract=function(b){return new c(this.r-b.r,this.g-b.g,this.b-b.b);},c.prototype.subtractToRef=function(b,c){y4tt.q9();return c.r=this.r-b.r,c.g=this.g-b.g,c.b=this.b-b.b,this;},c.prototype.clone=function(){return new c(this.r,this.g,this.b);},c.prototype.copyFrom=function(b){y4tt.v9();return this.r=b.r,this.g=b.g,this.b=b.b,this;},c.prototype.copyFromFloats=function(b,c,d){y4tt.v9();return this.r=b,this.g=c,this.b=d,this;},c.prototype.toHexString=function(){var b,c;y4tt.v9();b=255*this.g|0,c=255*this.b|0;return"#"+g.ToHex(255*this.r|0)+g.ToHex(b)+g.ToHex(c);},c.prototype.toLinearSpace=function(){var b;b=new c();return this.toLinearSpaceToRef(b),b;},c.prototype.toLinearSpaceToRef=function(c){y4tt.v9();return c.r=Math.pow(this.r,b.ToLinearSpace),c.g=Math.pow(this.g,b.ToLinearSpace),c.b=Math.pow(this.b,b.ToLinearSpace),this;},c.prototype.toGammaSpace=function(){var b;b=new c();y4tt.q9();return this.toGammaSpaceToRef(b),b;},c.prototype.toGammaSpaceToRef=function(c){y4tt.q9();return c.r=Math.pow(this.r,b.ToGammaSpace),c.g=Math.pow(this.g,b.ToGammaSpace),c.b=Math.pow(this.b,b.ToGammaSpace),this;},c.FromHexString=function(b){var d,f;if("#"!==b.substring(0,1)||7!==b.length)return new c(0,0,0);y4tt.v9();d=parseInt(b.substring(1,3),16),f=parseInt(b.substring(3,5),16);b=parseInt(b.substring(5,7),16);return c.FromInts(d,f,b);},c.FromArray=function(b,d){y4tt.q9();return void 0===d&&(d=0),new c(b[d],b[d+1],b[d+2]);},c.FromInts=function(b,d,f){y4tt.q9();return new c(b/255,d/255,f/255);},c.Lerp=function(b,d,f){return new c(b.r+(d.r-b.r)*f,b.g+(d.g-b.g)*f,b.b+(d.b-b.b)*f);},c.Red=function(){y4tt.q9();return new c(1,0,0);},c.Green=function(){y4tt.q9();return new c(0,1,0);},c.Blue=function(){return new c(0,0,1);},c.Black=function(){y4tt.v9();return new c(0,0,0);},c.White=function(){return new c(1,1,1);},c.Purple=function(){return new c(0.5,0,0.5);},c.Magenta=function(){return new c(1,0,1);},c.Yellow=function(){return new c(1,1,0);},c.Gray=function(){y4tt.v9();return new c(0.5,0.5,0.5);},c);b.Color3=e;f=function(b,c,d,f){this.r=b;y4tt.q9();this.g=c;this.b=d;this.a=f;};d=(f.prototype.addInPlace=function(b){return this.r+=b.r,this.g+=b.g,this.b+=b.b,this.a+=b.a,this;},f.prototype.asArray=function(){var b;b=[];return this.toArray(b,0),b;},f.prototype.toArray=function(b,c){return void 0===c&&(c=0),b[c]=this.r,b[c+1]=this.g,b[c+2]=this.b,b[c+3]=this.a,this;},f.prototype.add=function(b){y4tt.q9();return new f(this.r+b.r,this.g+b.g,this.b+b.b,this.a+b.a);},f.prototype.subtract=function(b){return new f(this.r-b.r,this.g-b.g,this.b-b.b,this.a-b.a);},f.prototype.subtractToRef=function(b,c){return c.r=this.r-b.r,c.g=this.g-b.g,c.b=this.b-b.b,c.a=this.a-b.a,this;},f.prototype.scale=function(b){return new f(this.r*b,this.g*b,this.b*b,this.a*b);},f.prototype.scaleToRef=function(b,c){y4tt.q9();return c.r=this.r*b,c.g=this.g*b,c.b=this.b*b,c.a=this.a*b,this;},f.prototype.multiply=function(b){return new f(this.r*b.r,this.g*b.g,this.b*b.b,this.a*b.a);},f.prototype.multiplyToRef=function(b,c){return c.r=this.r*b.r,c.g=this.g*b.g,c.b=this.b*b.b,c.a=this.a*b.a,c;},f.prototype.toString=function(){y4tt.q9();return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}";},f.prototype.getClassName=function(){return"Color4";},f.prototype.getHashCode=function(){var b;b=this.r||0;return b=397*b^(this.g||0),b=397*b^(this.b||0),397*b^(this.a||0);},f.prototype.clone=function(){return new f(this.r,this.g,this.b,this.a);},f.prototype.copyFrom=function(b){return this.r=b.r,this.g=b.g,this.b=b.b,this.a=b.a,this;},f.prototype.toHexString=function(){var b,c,d;b=255*this.g|0,c=255*this.b|0,d=255*this.a|0;y4tt.v9();return"#"+g.ToHex(255*this.r|0)+g.ToHex(b)+g.ToHex(c)+g.ToHex(d);},f.FromHexString=function(b){var c,d,l;if("#"!==b.substring(0,1)||9!==b.length)return new f(0,0,0,0);c=parseInt(b.substring(1,3),16),d=parseInt(b.substring(3,5),16),l=parseInt(b.substring(5,7),16);b=parseInt(b.substring(7,9),16);return f.FromInts(c,d,l,b);},f.Lerp=function(b,c,d){var l;l=new f(0,0,0,0);return f.LerpToRef(b,c,d,l),l;},f.LerpToRef=function(b,c,d,f){f.r=b.r+(c.r-b.r)*d;f.g=b.g+(c.g-b.g)*d;f.b=b.b+(c.b-b.b)*d;f.a=b.a+(c.a-b.a)*d;},f.FromArray=function(b,c){y4tt.v9();return void 0===c&&(c=0),new f(b[c],b[c+1],b[c+2],b[c+3]);},f.FromInts=function(b,c,d,l){return new f(b/255,c/255,d/255,l/255);},f.CheckColors4=function(b,c){var l;y4tt.q9();if(b.length===3*c){for(var d=[],f=0;f<b.length;f+=3){l=4*(f/3);d[l]=b[f];d[l+1]=b[f+1];d[l+2]=b[f+2];d[l+3]=1;}return d;}return b;},f);b.Color4=d;j=function(b,c){this.x=b;this.y=c;};q=(j.prototype.toString=function(){y4tt.q9();return"{X: "+this.x+" Y:"+this.y+"}";},j.prototype.getClassName=function(){return"Vector2";},j.prototype.getHashCode=function(){y4tt.v9();return 397*(this.x||0)^(this.y||0);},j.prototype.toArray=function(b,c){y4tt.v9();return void 0===c&&(c=0),b[c]=this.x,b[c+1]=this.y,this;},j.prototype.asArray=function(){var b;y4tt.q9();b=[];return this.toArray(b,0),b;},j.prototype.copyFrom=function(b){return this.x=b.x,this.y=b.y,this;},j.prototype.copyFromFloats=function(b,c){return this.x=b,this.y=c,this;},j.prototype.add=function(b){y4tt.v9();return new j(this.x+b.x,this.y+b.y);},j.prototype.addToRef=function(b,c){y4tt.q9();return c.x=this.x+b.x,c.y=this.y+b.y,this;},j.prototype.addVector3=function(b){return new j(this.x+b.x,this.y+b.y);},j.prototype.subtract=function(b){return new j(this.x-b.x,this.y-b.y);},j.prototype.subtractToRef=function(b,c){return c.x=this.x-b.x,c.y=this.y-b.y,this;},j.prototype.subtractInPlace=function(b){y4tt.q9();return this.x-=b.x,this.y-=b.y,this;},j.prototype.multiplyInPlace=function(b){return this.x*=b.x,this.y*=b.y,this;},j.prototype.multiply=function(b){y4tt.q9();return new j(this.x*b.x,this.y*b.y);},j.prototype.multiplyToRef=function(b,c){y4tt.q9();return c.x=this.x*b.x,c.y=this.y*b.y,this;},j.prototype.multiplyByFloats=function(b,c){return new j(this.x*b,this.y*c);},j.prototype.divide=function(b){y4tt.q9();return new j(this.x/b.x,this.y/b.y);},j.prototype.divideToRef=function(b,c){y4tt.q9();return c.x=this.x/b.x,c.y=this.y/b.y,this;},j.prototype.negate=function(){y4tt.q9();return new j(-this.x,-this.y);},j.prototype.scaleInPlace=function(b){return this.x*=b,this.y*=b,this;},j.prototype.scale=function(b){return new j(this.x*b,this.y*b);},j.prototype.equals=function(b){y4tt.q9();return b&&this.x===b.x&&this.y===b.y;},j.prototype.equalsWithEpsilon=function(c,d){return void 0===d&&(d=b.Epsilon),c&&g.WithinEpsilon(this.x,c.x,d)&&g.WithinEpsilon(this.y,c.y,d);},j.prototype.length=function(){y4tt.q9();return Math.sqrt(this.x*this.x+this.y*this.y);},j.prototype.lengthSquared=function(){y4tt.v9();return this.x*this.x+this.y*this.y;},j.prototype.normalize=function(){var b;b=this.length();if(0===b)return this;b=1/b;return this.x*=b,this.y*=b,this;},j.prototype.clone=function(){return new j(this.x,this.y);},j.Zero=function(){y4tt.q9();return new j(0,0);},j.FromArray=function(b,c){y4tt.v9();return void 0===c&&(c=0),new j(b[c],b[c+1]);},j.FromArrayToRef=function(b,c,d){d.x=b[c];d.y=b[c+1];},j.CatmullRom=function(b,c,d,f,l){var e,n;e=l*l,n=l*e;y4tt.v9();return new j(0.5*(2*c.x+(-b.x+d.x)*l+(2*b.x-5*c.x+4*d.x-f.x)*e+(-b.x+3*c.x-3*d.x+f.x)*n),0.5*(2*c.y+(-b.y+d.y)*l+(2*b.y-5*c.y+4*d.y-f.y)*e+(-b.y+3*c.y-3*d.y+f.y)*n));},j.Clamp=function(b,c,d){var f;f=b.x,f=f>d.x?d.x:f,f=f<c.x?c.x:f;b=b.y;return b=b>d.y?d.y:b,b=b<c.y?c.y:b,new j(f,b);},j.Hermite=function(b,c,d,f,l){var e,n,q,m;e=l*l,n=l*e,q=2*n-3*e+1,m=-2*n+3*e;l=n-2*e+l;y4tt.q9();e=n-e;return new j(b.x*q+d.x*m+c.x*l+f.x*e,b.y*q+d.y*m+c.y*l+f.y*e);},j.Lerp=function(b,c,d){return new j(b.x+(c.x-b.x)*d,b.y+(c.y-b.y)*d);},j.Dot=function(b,c){return b.x*c.x+b.y*c.y;},j.Normalize=function(b){b=b.clone();return b.normalize(),b;},j.Minimize=function(b,c){y4tt.q9();return new j(b.x<c.x?b.x:c.x,b.y<c.y?b.y:c.y);},j.Maximize=function(b,c){y4tt.v9();return new j(b.x>c.x?b.x:c.x,b.y>c.y?b.y:c.y);},j.Transform=function(b,c){var d;d=j.Zero();return j.TransformToRef(b,c,d),d;},j.TransformToRef=function(b,c,d){var f;f=b.x*c.m[1]+b.y*c.m[5]+c.m[13];d.x=b.x*c.m[0]+b.y*c.m[4]+c.m[12];d.y=f;},j.PointInTriangle=function(b,c,d,f){var l,j;l=0.5*(-d.y*f.x+c.y*(-d.x+f.x)+c.x*(d.y-f.y)+d.x*f.y),j=0>l?-1:1;f=(c.y*f.x-c.x*f.y+(f.y-c.y)*b.x+(c.x-f.x)*b.y)*j;b=(c.x*d.y-c.y*d.x+(c.y-d.y)*b.x+(d.x-c.x)*b.y)*j;return 0<f&&0<b&&2*l*j>f+b;},j.Distance=function(b,c){y4tt.v9();return Math.sqrt(j.DistanceSquared(b,c));},j.DistanceSquared=function(b,c){var d,f;d=b.x-c.x,f=b.y-c.y;return d*d+f*f;},j.DistanceOfPointFromSegment=function(b,c,d){var f;f=j.DistanceSquared(c,d);if(0===f)return j.Distance(b,c);d=d.subtract(c);f=Math.max(0,Math.min(1,j.Dot(b.subtract(c),d)/f));y4tt.v9();c=c.add(d.multiplyByFloats(f,f));return j.Distance(b,c);},j);b.Vector2=q;n=function(b,c,d){this.x=b;this.y=c;y4tt.v9();this.z=d;};l=(n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}";},n.prototype.getClassName=function(){return"Vector3";},n.prototype.getHashCode=function(){var b;b=this.x||0;return b=397*b^(this.y||0),397*b^(this.z||0);},n.prototype.asArray=function(){var b;b=[];return this.toArray(b,0),b;},n.prototype.toArray=function(b,c){y4tt.v9();return void 0===c&&(c=0),b[c]=this.x,b[c+1]=this.y,b[c+2]=this.z,this;},n.prototype.toQuaternion=function(){var b,c,d,f,l,j,e;b=new t(0,0,0,1),c=Math.cos(0.5*(this.x+this.z)),d=Math.sin(0.5*(this.x+this.z)),f=Math.cos(0.5*(this.z-this.x)),l=Math.sin(0.5*(this.z-this.x)),j=Math.cos(0.5*this.y),e=Math.sin(0.5*this.y);return b.x=f*e,b.y=-l*e,b.z=d*j,b.w=c*j,b;},n.prototype.addInPlace=function(b){return this.x+=b.x,this.y+=b.y,this.z+=b.z,this;},n.prototype.add=function(b){y4tt.q9();return new n(this.x+b.x,this.y+b.y,this.z+b.z);},n.prototype.addToRef=function(b,c){y4tt.v9();return c.x=this.x+b.x,c.y=this.y+b.y,c.z=this.z+b.z,this;},n.prototype.subtractInPlace=function(b){return this.x-=b.x,this.y-=b.y,this.z-=b.z,this;},n.prototype.subtract=function(b){y4tt.v9();return new n(this.x-b.x,this.y-b.y,this.z-b.z);},n.prototype.subtractToRef=function(b,c){return c.x=this.x-b.x,c.y=this.y-b.y,c.z=this.z-b.z,this;},n.prototype.subtractFromFloats=function(b,c,d){y4tt.v9();return new n(this.x-b,this.y-c,this.z-d);},n.prototype.subtractFromFloatsToRef=function(b,c,d,f){y4tt.q9();return f.x=this.x-b,f.y=this.y-c,f.z=this.z-d,this;},n.prototype.negate=function(){return new n(-this.x,-this.y,-this.z);},n.prototype.scaleInPlace=function(b){return this.x*=b,this.y*=b,this.z*=b,this;},n.prototype.scale=function(b){return new n(this.x*b,this.y*b,this.z*b);},n.prototype.scaleToRef=function(b,c){c.x=this.x*b;c.y=this.y*b;y4tt.q9();c.z=this.z*b;},n.prototype.equals=function(b){y4tt.q9();return b&&this.x===b.x&&this.y===b.y&&this.z===b.z;},n.prototype.equalsWithEpsilon=function(c,d){return void 0===d&&(d=b.Epsilon),c&&g.WithinEpsilon(this.x,c.x,d)&&g.WithinEpsilon(this.y,c.y,d)&&g.WithinEpsilon(this.z,c.z,d);},n.prototype.equalsToFloats=function(b,c,d){y4tt.v9();return this.x===b&&this.y===c&&this.z===d;},n.prototype.multiplyInPlace=function(b){y4tt.v9();return this.x*=b.x,this.y*=b.y,this.z*=b.z,this;},n.prototype.multiply=function(b){return new n(this.x*b.x,this.y*b.y,this.z*b.z);},n.prototype.multiplyToRef=function(b,c){y4tt.v9();return c.x=this.x*b.x,c.y=this.y*b.y,c.z=this.z*b.z,this;},n.prototype.multiplyByFloats=function(b,c,d){y4tt.v9();return new n(this.x*b,this.y*c,this.z*d);},n.prototype.divide=function(b){return new n(this.x/b.x,this.y/b.y,this.z/b.z);},n.prototype.divideToRef=function(b,c){return c.x=this.x/b.x,c.y=this.y/b.y,c.z=this.z/b.z,this;},n.prototype.MinimizeInPlace=function(b){return b.x<this.x&&(this.x=b.x),b.y<this.y&&(this.y=b.y),b.z<this.z&&(this.z=b.z),this;},n.prototype.MaximizeInPlace=function(b){return b.x>this.x&&(this.x=b.x),b.y>this.y&&(this.y=b.y),b.z>this.z&&(this.z=b.z),this;},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);},n.prototype.lengthSquared=function(){y4tt.v9();return this.x*this.x+this.y*this.y+this.z*this.z;},n.prototype.normalize=function(){var b;b=this.length();if(0===b||1===b)return this;b=1/b;y4tt.v9();return this.x*=b,this.y*=b,this.z*=b,this;},n.prototype.clone=function(){return new n(this.x,this.y,this.z);},n.prototype.copyFrom=function(b){y4tt.v9();return this.x=b.x,this.y=b.y,this.z=b.z,this;},n.prototype.copyFromFloats=function(b,c,d){y4tt.q9();return this.x=b,this.y=c,this.z=d,this;},n.GetClipFactor=function(b,c,d,f){b=n.Dot(b,d)-f;y4tt.q9();c=n.Dot(c,d)-f;return b/(b-c);},n.FromArray=function(b,c){return c||(c=0),new n(b[c],b[c+1],b[c+2]);},n.FromFloatArray=function(b,c){return c||(c=0),new n(b[c],b[c+1],b[c+2]);},n.FromArrayToRef=function(b,c,d){d.x=b[c];d.y=b[c+1];y4tt.v9();d.z=b[c+2];},n.FromFloatArrayToRef=function(b,c,d){d.x=b[c];d.y=b[c+1];d.z=b[c+2];},n.FromFloatsToRef=function(b,c,d,f){f.x=b;f.y=c;y4tt.v9();f.z=d;},n.Zero=function(){y4tt.v9();return new n(0,0,0);},n.Up=function(){y4tt.v9();return new n(0,1,0);},n.TransformCoordinates=function(b,c){var d;y4tt.v9();d=n.Zero();return n.TransformCoordinatesToRef(b,c,d),d;},n.TransformCoordinatesToRef=function(b,c,d){var f,l,j;f=b.x*c.m[1]+b.y*c.m[5]+b.z*c.m[9]+c.m[13],l=b.x*c.m[2]+b.y*c.m[6]+b.z*c.m[10]+c.m[14],j=b.x*c.m[3]+b.y*c.m[7]+b.z*c.m[11]+c.m[15];d.x=(b.x*c.m[0]+b.y*c.m[4]+b.z*c.m[8]+c.m[12])/j;d.y=f/j;d.z=l/j;},n.TransformCoordinatesFromFloatsToRef=function(b,c,d,f,l){var j,e,n;j=b*f.m[1]+c*f.m[5]+d*f.m[9]+f.m[13],e=b*f.m[2]+c*f.m[6]+d*f.m[10]+f.m[14],n=b*f.m[3]+c*f.m[7]+d*f.m[11]+f.m[15];y4tt.q9();l.x=(b*f.m[0]+c*f.m[4]+d*f.m[8]+f.m[12])/n;l.y=j/n;l.z=e/n;},n.TransformNormal=function(b,c){var d;d=n.Zero();return n.TransformNormalToRef(b,c,d),d;},n.TransformNormalToRef=function(b,c,d){d.x=b.x*c.m[0]+b.y*c.m[4]+b.z*c.m[8];d.y=b.x*c.m[1]+b.y*c.m[5]+b.z*c.m[9];d.z=b.x*c.m[2]+b.y*c.m[6]+b.z*c.m[10];},n.TransformNormalFromFloatsToRef=function(b,c,d,f,l){l.x=b*f.m[0]+c*f.m[4]+d*f.m[8];l.y=b*f.m[1]+c*f.m[5]+d*f.m[9];l.z=b*f.m[2]+c*f.m[6]+d*f.m[10];},n.CatmullRom=function(b,c,d,f,l){var j,e;y4tt.q9();j=l*l,e=l*j;return new n(0.5*(2*c.x+(-b.x+d.x)*l+(2*b.x-5*c.x+4*d.x-f.x)*j+(-b.x+3*c.x-3*d.x+f.x)*e),0.5*(2*c.y+(-b.y+d.y)*l+(2*b.y-5*c.y+4*d.y-f.y)*j+(-b.y+3*c.y-3*d.y+f.y)*e),0.5*(2*c.z+(-b.z+d.z)*l+(2*b.z-5*c.z+4*d.z-f.z)*j+(-b.z+3*c.z-3*d.z+f.z)*e));},n.Clamp=function(b,c,d){var f,l;f=b.x,f=f>d.x?d.x:f,f=f<c.x?c.x:f,l=b.y,l=l>d.y?d.y:l,l=l<c.y?c.y:l;b=b.z;return b=b>d.z?d.z:b,b=b<c.z?c.z:b,new n(f,l,b);},n.Hermite=function(b,c,d,f,l){var j,e,q,m;j=l*l,e=l*j,q=2*e-3*j+1,m=-2*e+3*j;l=e-2*j+l;y4tt.v9();j=e-j;return new n(b.x*q+d.x*m+c.x*l+f.x*j,b.y*q+d.y*m+c.y*l+f.y*j,b.z*q+d.z*m+c.z*l+f.z*j);},n.Lerp=function(b,c,d){y4tt.q9();return new n(b.x+(c.x-b.x)*d,b.y+(c.y-b.y)*d,b.z+(c.z-b.z)*d);},n.Dot=function(b,c){y4tt.v9();return b.x*c.x+b.y*c.y+b.z*c.z;},n.Cross=function(b,c){var d;d=n.Zero();return n.CrossToRef(b,c,d),d;},n.CrossToRef=function(b,c,d){y4tt.q9();M.Vector3[0].x=b.y*c.z-b.z*c.y;M.Vector3[0].y=b.z*c.x-b.x*c.z;M.Vector3[0].z=b.x*c.y-b.y*c.x;d.copyFrom(M.Vector3[0]);},n.Normalize=function(b){var c;c=n.Zero();y4tt.q9();return n.NormalizeToRef(b,c),c;},n.NormalizeToRef=function(b,c){c.copyFrom(b);c.normalize();},n.Project=function(b,c,d,f){var l,j;l=f.width,j=f.height;f=y.FromValues(l/2,0,0,0,0,-j/2,0,0,0,0,1,0,f.x+l/2,j/2+f.y,0,1);c=c.multiply(d).multiply(f);return n.TransformCoordinates(b,c);},n.UnprojectFromTransform=function(b,c,d,f,l){y4tt.q9();f=f.multiply(l);f.invert();b.x=2*(b.x/c)-1;b.y=-(2*(b.y/d)-1);c=n.TransformCoordinates(b,f);b=b.x*f.m[3]+b.y*f.m[7]+b.z*f.m[11]+f.m[15];return g.WithinEpsilon(b,1)&&(c=c.scale(1/b)),c;},n.Unproject=function(b,c,d,f,l,j){f=f.multiply(l).multiply(j);f.invert();c=new n(2*(b.x/c)-1,-(2*(b.y/d)-1),b.z);y4tt.v9();b=n.TransformCoordinates(c,f);c=c.x*f.m[3]+c.y*f.m[7]+c.z*f.m[11]+f.m[15];return g.WithinEpsilon(c,1)&&(b=b.scale(1/c)),b;},n.Minimize=function(b,c){var d;d=b.clone();return d.MinimizeInPlace(c),d;},n.Maximize=function(b,c){var d;d=b.clone();return d.MaximizeInPlace(c),d;},n.Distance=function(b,c){y4tt.v9();return Math.sqrt(n.DistanceSquared(b,c));},n.DistanceSquared=function(b,c){var d,f,l;y4tt.q9();d=b.x-c.x,f=b.y-c.y,l=b.z-c.z;return d*d+f*f+l*l;},n.Center=function(b,c){var d;y4tt.v9();d=b.add(c);return d.scaleInPlace(0.5),d;},n.RotationFromAxis=function(b,c,d){var f;f=n.Zero();return n.RotationFromAxisToRef(b,c,d,f),f;},n.RotationFromAxisToRef=function(c,d,f,l){var j,e,q,m,p,r,s,t,y,v,x;j=c.normalize();f=f.normalize();c=G.X;d=G.Y;e=0,q=0,m=0,p=q=0,r=0,s=0,e=-1,t=0,y=M.Vector3[0],v=0,x=M.Vector3[1];g.WithinEpsilon(f.z,0,b.Epsilon)?r=1:g.WithinEpsilon(f.x,0,b.Epsilon)?q=1:(s=f.z/f.x,q=-s*Math.sqrt(1/(1+s*s)),r=Math.sqrt(1/(1+s*s)));x.x=q;x.y=p;x.z=r;x.normalize();n.CrossToRef(j,x,y);y.normalize();0>n.Dot(f,y)&&(e=1);v=n.Dot(j,x);v=Math.min(1,Math.max(-1,v));m=Math.acos(v)*e;0>n.Dot(x,c)&&(m=Math.PI+m,x=x.scaleInPlace(-1),t++);v=M.Vector3[2];j=M.Vector3[3];r=p=0;e=-1;g.WithinEpsilon(f.z,0,b.Epsilon)?q=1:(s=x.z/x.x,q=-s*Math.sqrt(1/(1+s*s)),r=Math.sqrt(1/(1+s*s)));v.x=q;v.y=p;v.z=r;v.normalize();n.CrossToRef(v,x,j);j.normalize();n.CrossToRef(f,v,y);y.normalize();0>n.Dot(x,y)&&(e=1);v=n.Dot(f,v);v=Math.min(1,Math.max(-1,v));q=Math.acos(v)*e;0>n.Dot(j,d)&&(q=Math.PI+q,t++);e=-1;n.CrossToRef(c,x,y);y.normalize();0>n.Dot(y,d)&&(e=1);v=n.Dot(x,c);v=Math.min(1,Math.max(-1,v));e*=-Math.acos(v);0>v&&2>t&&(e=Math.PI+e);l.x=q;l.y=e;l.z=m;},n);b.Vector3=l;p=function(b,c,d,f){this.x=b;this.y=c;y4tt.v9();this.z=d;this.w=f;};m=(p.prototype.toString=function(){y4tt.q9();return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"W:"+this.w+"}";},p.prototype.getClassName=function(){y4tt.q9();return"Vector4";},p.prototype.getHashCode=function(){var b;b=this.x||0;return b=397*b^(this.y||0),b=397*b^(this.z||0),397*b^(this.w||0);},p.prototype.asArray=function(){var b;b=[];return this.toArray(b,0),b;},p.prototype.toArray=function(b,c){return void 0===c&&(c=0),b[c]=this.x,b[c+1]=this.y,b[c+2]=this.z,b[c+3]=this.w,this;},p.prototype.addInPlace=function(b){y4tt.v9();return this.x+=b.x,this.y+=b.y,this.z+=b.z,this.w+=b.w,this;},p.prototype.add=function(b){return new p(this.x+b.x,this.y+b.y,this.z+b.z,this.w+b.w);},p.prototype.addToRef=function(b,c){return c.x=this.x+b.x,c.y=this.y+b.y,c.z=this.z+b.z,c.w=this.w+b.w,this;},p.prototype.subtractInPlace=function(b){return this.x-=b.x,this.y-=b.y,this.z-=b.z,this.w-=b.w,this;},p.prototype.subtract=function(b){return new p(this.x-b.x,this.y-b.y,this.z-b.z,this.w-b.w);},p.prototype.subtractToRef=function(b,c){return c.x=this.x-b.x,c.y=this.y-b.y,c.z=this.z-b.z,c.w=this.w-b.w,this;},p.prototype.subtractFromFloats=function(b,c,d,f){y4tt.v9();return new p(this.x-b,this.y-c,this.z-d,this.w-f);},p.prototype.subtractFromFloatsToRef=function(b,c,d,f,l){return l.x=this.x-b,l.y=this.y-c,l.z=this.z-d,l.w=this.w-f,this;},p.prototype.negate=function(){return new p(-this.x,-this.y,-this.z,-this.w);},p.prototype.scaleInPlace=function(b){return this.x*=b,this.y*=b,this.z*=b,this.w*=b,this;},p.prototype.scale=function(b){return new p(this.x*b,this.y*b,this.z*b,this.w*b);},p.prototype.scaleToRef=function(b,c){c.x=this.x*b;c.y=this.y*b;c.z=this.z*b;c.w=this.w*b;},p.prototype.equals=function(b){return b&&this.x===b.x&&this.y===b.y&&this.z===b.z&&this.w===b.w;},p.prototype.equalsWithEpsilon=function(c,d){y4tt.v9();return void 0===d&&(d=b.Epsilon),c&&g.WithinEpsilon(this.x,c.x,d)&&g.WithinEpsilon(this.y,c.y,d)&&g.WithinEpsilon(this.z,c.z,d)&&g.WithinEpsilon(this.w,c.w,d);},p.prototype.equalsToFloats=function(b,c,d,f){return this.x===b&&this.y===c&&this.z===d&&this.w===f;},p.prototype.multiplyInPlace=function(b){return this.x*=b.x,this.y*=b.y,this.z*=b.z,this.w*=b.w,this;},p.prototype.multiply=function(b){return new p(this.x*b.x,this.y*b.y,this.z*b.z,this.w*b.w);},p.prototype.multiplyToRef=function(b,c){y4tt.q9();return c.x=this.x*b.x,c.y=this.y*b.y,c.z=this.z*b.z,c.w=this.w*b.w,this;},p.prototype.multiplyByFloats=function(b,c,d,f){return new p(this.x*b,this.y*c,this.z*d,this.w*f);},p.prototype.divide=function(b){return new p(this.x/b.x,this.y/b.y,this.z/b.z,this.w/b.w);},p.prototype.divideToRef=function(b,c){return c.x=this.x/b.x,c.y=this.y/b.y,c.z=this.z/b.z,c.w=this.w/b.w,this;},p.prototype.MinimizeInPlace=function(b){return b.x<this.x&&(this.x=b.x),b.y<this.y&&(this.y=b.y),b.z<this.z&&(this.z=b.z),b.w<this.w&&(this.w=b.w),this;},p.prototype.MaximizeInPlace=function(b){y4tt.q9();return b.x>this.x&&(this.x=b.x),b.y>this.y&&(this.y=b.y),b.z>this.z&&(this.z=b.z),b.w>this.w&&(this.w=b.w),this;},p.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);},p.prototype.lengthSquared=function(){y4tt.q9();return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;},p.prototype.normalize=function(){var b;b=this.length();if(0===b)return this;b=1/b;y4tt.q9();return this.x*=b,this.y*=b,this.z*=b,this.w*=b,this;},p.prototype.toVector3=function(){y4tt.v9();return new l(this.x,this.y,this.z);},p.prototype.clone=function(){return new p(this.x,this.y,this.z,this.w);},p.prototype.copyFrom=function(b){y4tt.v9();return this.x=b.x,this.y=b.y,this.z=b.z,this.w=b.w,this;},p.prototype.copyFromFloats=function(b,c,d,f){y4tt.q9();return this.x=b,this.y=c,this.z=d,this.w=f,this;},p.FromArray=function(b,c){y4tt.q9();return c||(c=0),new p(b[c],b[c+1],b[c+2],b[c+3]);},p.FromArrayToRef=function(b,c,d){d.x=b[c];d.y=b[c+1];d.z=b[c+2];d.w=b[c+3];},p.FromFloatArrayToRef=function(b,c,d){y4tt.v9();d.x=b[c];d.y=b[c+1];d.z=b[c+2];d.w=b[c+3];},p.FromFloatsToRef=function(b,c,d,f,l){l.x=b;l.y=c;l.z=d;l.w=f;},p.Zero=function(){return new p(0,0,0,0);},p.Normalize=function(b){var c;c=p.Zero();return p.NormalizeToRef(b,c),c;},p.NormalizeToRef=function(b,c){y4tt.v9();c.copyFrom(b);c.normalize();},p.Minimize=function(b,c){var d;y4tt.v9();d=b.clone();return d.MinimizeInPlace(c),d;},p.Maximize=function(b,c){var d;y4tt.v9();d=b.clone();return d.MaximizeInPlace(c),d;},p.Distance=function(b,c){return Math.sqrt(p.DistanceSquared(b,c));},p.DistanceSquared=function(b,c){var d,f,l,j;y4tt.v9();d=b.x-c.x,f=b.y-c.y,l=b.z-c.z,j=b.w-c.w;return d*d+f*f+l*l+j*j;},p.Center=function(b,c){var d;y4tt.q9();d=b.add(c);return d.scaleInPlace(0.5),d;},p);b.Vector4=m;s=function(b,c){this.width=b;this.height=c;};r=(s.prototype.toString=function(){y4tt.v9();return"{W: "+this.width+", H: "+this.height+"}";},s.prototype.getClassName=function(){return"Size";},s.prototype.getHashCode=function(){y4tt.v9();return 397*(this.width||0)^(this.height||0);},s.prototype.copyFrom=function(b){this.width=b.width;y4tt.v9();this.height=b.height;},s.prototype.clone=function(){y4tt.v9();return new s(this.width,this.height);},s.prototype.equals=function(b){y4tt.q9();return b?this.width===b.width&&this.height===b.height:!1;},Object.defineProperty(s.prototype,"surface",{get:function(){y4tt.q9();return this.width*this.height;},enumerable:!0,configurable:!0}),s.Zero=function(){y4tt.q9();return new s(0,0);},s.prototype.add=function(b){y4tt.q9();return new s(this.width+b.width,this.height+b.height);},s.prototype.substract=function(b){return new s(this.width-b.width,this.height-b.height);},s.Lerp=function(b,c,d){y4tt.q9();return new s(b.width+(c.width-b.width)*d,b.height+(c.height-b.height)*d);},s);b.Size=r;v=function(b,c,d,f){void 0===b&&(b=0);void 0===c&&(c=0);void 0===d&&(d=0);void 0===f&&(f=1);this.x=b;this.y=c;this.z=d;this.w=f;};t=(v.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}";},v.prototype.getClassName=function(){return"Quaternion";},v.prototype.getHashCode=function(){var b;b=this.x||0;return b=397*b^(this.y||0),b=397*b^(this.z||0),397*b^(this.w||0);},v.prototype.asArray=function(){y4tt.v9();return[this.x,this.y,this.z,this.w];},v.prototype.equals=function(b){return b&&this.x===b.x&&this.y===b.y&&this.z===b.z&&this.w===b.w;},v.prototype.clone=function(){y4tt.v9();return new v(this.x,this.y,this.z,this.w);},v.prototype.copyFrom=function(b){return this.x=b.x,this.y=b.y,this.z=b.z,this.w=b.w,this;},v.prototype.copyFromFloats=function(b,c,d,f){return this.x=b,this.y=c,this.z=d,this.w=f,this;},v.prototype.add=function(b){return new v(this.x+b.x,this.y+b.y,this.z+b.z,this.w+b.w);},v.prototype.subtract=function(b){y4tt.q9();return new v(this.x-b.x,this.y-b.y,this.z-b.z,this.w-b.w);},v.prototype.scale=function(b){y4tt.v9();return new v(this.x*b,this.y*b,this.z*b,this.w*b);},v.prototype.multiply=function(b){var c;c=new v(0,0,0,1);y4tt.q9();return this.multiplyToRef(b,c),c;},v.prototype.multiplyToRef=function(b,c){return c.copyFromFloats(this.x*b.w+this.y*b.z-this.z*b.y+this.w*b.x,-this.x*b.z+this.y*b.w+this.z*b.x+this.w*b.y,this.x*b.y-this.y*b.x+this.z*b.w+this.w*b.z,-this.x*b.x-this.y*b.y-this.z*b.z+this.w*b.w),this;},v.prototype.multiplyInPlace=function(b){return this.multiplyToRef(b,this),this;},v.prototype.conjugateToRef=function(b){y4tt.v9();return b.copyFromFloats(-this.x,-this.y,-this.z,this.w),this;},v.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this;},v.prototype.conjugate=function(){return new v(-this.x,-this.y,-this.z,this.w);},v.prototype.length=function(){y4tt.q9();return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);},v.prototype.normalize=function(){var b;b=1/this.length();return this.x*=b,this.y*=b,this.z*=b,this.w*=b,this;},v.prototype.toEulerAngles=function(b){var c;void 0===b&&(b="YZX");c=l.Zero();return this.toEulerAnglesToRef(c,b),c;},v.prototype.toEulerAnglesToRef=function(b,c){var d,f,l,j,e,n,q,m,p;y4tt.q9();void 0===c&&(c="YZX");j=this.x,e=this.y,n=this.z,q=this.w;switch(c){case"YZX":m=j*e+n*q;if(0.499<m&&(d=2*Math.atan2(j,q),f=Math.PI/2,l=0),-0.499>m&&(d=-2*Math.atan2(j,q),f=-Math.PI/2,l=0),isNaN(d)){l=j*j;p=n*n;d=Math.atan2(2*e*q-2*j*n,1-2*e*e-2*p);f=Math.asin(2*m);l=Math.atan2(2*j*q-2*e*n,1-2*l-2*p);}break;default:throw Error("Euler order "+c+" not supported yet.");}return b.y=d,b.z=f,b.x=l,this;},v.prototype.toRotationMatrix=function(b){var c,d,f,l,j,e,n,q,m;c=this.x*this.x,d=this.y*this.y,f=this.z*this.z,l=this.x*this.y,j=this.z*this.w,e=this.z*this.x,n=this.y*this.w,q=this.y*this.z,m=this.x*this.w;return b.m[0]=1-2*(d+f),b.m[1]=2*(l+j),b.m[2]=2*(e-n),b.m[3]=0,b.m[4]=2*(l-j),b.m[5]=1-2*(f+c),b.m[6]=2*(q+m),b.m[7]=0,b.m[8]=2*(e+n),b.m[9]=2*(q-m),b.m[10]=1-2*(d+c),b.m[11]=0,b.m[12]=0,b.m[13]=0,b.m[14]=0,b.m[15]=1,this;},v.prototype.fromRotationMatrix=function(b){y4tt.v9();return v.FromRotationMatrixToRef(b,this),this;},v.FromRotationMatrix=function(b){var c;c=new v();y4tt.q9();return v.FromRotationMatrixToRef(b,c),c;},v.FromRotationMatrixToRef=function(b,c){var d,f,l,j,e,n,q,m,p,g,r;f=b.m,l=f[0],j=f[4],e=f[8],n=f[1],q=f[5],m=f[9],p=f[2],g=f[6],f=f[10],r=l+q+f;y4tt.q9();0<r?(d=0.5/Math.sqrt(r+1),c.w=0.25/d,c.x=(g-m)*d,c.y=(e-p)*d,c.z=(n-j)*d):l>q&&l>f?(d=2*Math.sqrt(1+l-q-f),c.w=(g-m)/d,c.x=0.25*d,c.y=(j+n)/d,c.z=(e+p)/d):q>f?(d=2*Math.sqrt(1+q-l-f),c.w=(e-p)/d,c.x=(j+n)/d,c.y=0.25*d,c.z=(m+g)/d):(d=2*Math.sqrt(1+f-l-q),c.w=(n-j)/d,c.x=(e+p)/d,c.y=(m+g)/d,c.z=0.25*d);},v.Inverse=function(b){return new v(-b.x,-b.y,-b.z,b.w);},v.Identity=function(){return new v(0,0,0,1);},v.RotationAxis=function(b,c){var d,f;d=new v(),f=Math.sin(c/2);return b.normalize(),d.w=Math.cos(c/2),d.x=b.x*f,d.y=b.y*f,d.z=b.z*f,d;},v.FromArray=function(b,c){return c||(c=0),new v(b[c],b[c+1],b[c+2],b[c+3]);},v.RotationYawPitchRoll=function(b,c,d){var f;f=new v();return v.RotationYawPitchRollToRef(b,c,d,f),f;},v.RotationYawPitchRollToRef=function(b,c,d,f){var l,j,e;d*=0.5;l=0.5*c;c=0.5*b;b=Math.sin(d);d=Math.cos(d);j=Math.sin(l),l=Math.cos(l),e=Math.sin(c);c=Math.cos(c);f.x=c*j*d+e*l*b;f.y=e*l*d-c*j*b;f.z=c*l*b-e*j*d;f.w=c*l*d+e*j*b;},v.RotationAlphaBetaGamma=function(b,c,d){var f;y4tt.q9();f=new v();return v.RotationAlphaBetaGammaToRef(b,c,d,f),f;},v.RotationAlphaBetaGammaToRef=function(b,c,d,f){var l;l=0.5*(d+b);b=0.5*(d-b);c*=0.5;f.x=Math.cos(b)*Math.sin(c);f.y=Math.sin(b)*Math.sin(c);f.z=Math.sin(l)*Math.cos(c);f.w=Math.cos(l)*Math.cos(c);},v.Slerp=function(b,c,d){var f,l,j,e;y4tt.q9();f=b.x*c.x+b.y*c.y+b.z*c.z+b.w*c.w;l=!1;if(0>f&&(l=!0,f=-f),0.999999<f)f=1-d,d=l?-d:d;else{j=Math.acos(f),e=1/Math.sin(j);f=Math.sin((1-d)*j)*e;d=l?-Math.sin(d*j)*e:Math.sin(d*j)*e;}return new v(f*b.x+d*c.x,f*b.y+d*c.y,f*b.z+d*c.z,f*b.w+d*c.w);},v);b.Quaternion=t;x=function(){y4tt.q9();this.m=new Float32Array(16);};y=(x.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0===this.m[1]&&0===this.m[2]&&0===this.m[3]&&0===this.m[4]&&0===this.m[6]&&0===this.m[7]&&0===this.m[8]&&0===this.m[9]&&0===this.m[11]&&0===this.m[12]&&0===this.m[13]&&0===this.m[14];},x.prototype.determinant=function(){var b,c,d,f,l,j;b=this.m[10]*this.m[15]-this.m[11]*this.m[14],c=this.m[9]*this.m[15]-this.m[11]*this.m[13],d=this.m[9]*this.m[14]-this.m[10]*this.m[13],f=this.m[8]*this.m[15]-this.m[11]*this.m[12],l=this.m[8]*this.m[14]-this.m[10]*this.m[12],j=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*b-this.m[6]*c+this.m[7]*d)-this.m[1]*(this.m[4]*b-this.m[6]*f+this.m[7]*l)+this.m[2]*(this.m[4]*c-this.m[5]*f+this.m[7]*j)-this.m[3]*(this.m[4]*d-this.m[5]*l+this.m[6]*j);},x.prototype.toArray=function(){y4tt.q9();return this.m;},x.prototype.asArray=function(){return this.toArray();},x.prototype.invert=function(){return this.invertToRef(this),this;},x.prototype.reset=function(){for(var b=0;16>b;b++)this.m[b]=0;return this;},x.prototype.add=function(b){var c;y4tt.q9();c=new x();return this.addToRef(b,c),c;},x.prototype.addToRef=function(b,c){y4tt.q9();for(var d=0;16>d;d++)c.m[d]=this.m[d]+b.m[d];return this;},x.prototype.addToSelf=function(b){y4tt.q9();for(var c=0;16>c;c++)this.m[c]+=b.m[c];return this;},x.prototype.invertToRef=function(b){var c,d,f,l,j,e,n,q,m,p,g,r,s,t,y,v,x,z,B,A,C,G,D,F,H,J,E,O,L,N,M,P;c=this.m[0],d=this.m[1],f=this.m[2],l=this.m[3],j=this.m[4],e=this.m[5],n=this.m[6],q=this.m[7],m=this.m[8],p=this.m[9],g=this.m[10],r=this.m[11],s=this.m[12],t=this.m[13],y=this.m[14],v=this.m[15],x=g*v-r*y,z=p*v-r*t,B=p*y-g*t,A=m*v-r*s,C=m*y-g*s,G=m*t-p*s,D=e*x-n*z+q*B,F=-(j*x-n*A+q*C),H=j*z-e*A+q*G,J=-(j*B-e*C+n*G),E=1/(c*D+d*F+f*H+l*J),O=n*v-q*y,L=e*v-q*t,N=e*y-n*t,v=j*v-q*s,y=j*y-n*s,s=j*t-e*s,t=n*r-q*g,M=e*r-q*p,P=e*g-n*p,q=j*r-q*m,n=j*g-n*m,j=j*p-e*m;return b.m[0]=D*E,b.m[4]=F*E,b.m[8]=H*E,b.m[12]=J*E,b.m[1]=-(d*x-f*z+l*B)*E,b.m[5]=(c*x-f*A+l*C)*E,b.m[9]=-(c*z-d*A+l*G)*E,b.m[13]=(c*B-d*C+f*G)*E,b.m[2]=(d*O-f*L+l*N)*E,b.m[6]=-(c*O-f*v+l*y)*E,b.m[10]=(c*L-d*v+l*s)*E,b.m[14]=-(c*N-d*y+f*s)*E,b.m[3]=-(d*t-f*M+l*P)*E,b.m[7]=(c*t-f*q+l*n)*E,b.m[11]=-(c*M-d*q+l*j)*E,b.m[15]=(c*P-d*n+f*j)*E,this;},x.prototype.setTranslation=function(b){return this.m[12]=b.x,this.m[13]=b.y,this.m[14]=b.z,this;},x.prototype.getTranslation=function(){y4tt.q9();return new l(this.m[12],this.m[13],this.m[14]);},x.prototype.multiply=function(b){var c;c=new x();return this.multiplyToRef(b,c),c;},x.prototype.copyFrom=function(b){for(var c=0;16>c;c++)this.m[c]=b.m[c];y4tt.q9();return this;},x.prototype.copyToArray=function(b,c){void 0===c&&(c=0);for(var d=0;16>d;d++)b[c+d]=this.m[d];return this;},x.prototype.multiplyToRef=function(b,c){y4tt.q9();return this.multiplyToArray(b,c.m,0),this;},x.prototype.multiplyToArray=function(b,c,d){var f,l,j,e,n,q,m,p,g,r,s,t,y,v,x,z,B,A,C,G,D,F,H,E,J,O,L,N,M,P,ha;y4tt.q9();f=this.m[0],l=this.m[1],j=this.m[2],e=this.m[3],n=this.m[4],q=this.m[5],m=this.m[6],p=this.m[7],g=this.m[8],r=this.m[9],s=this.m[10],t=this.m[11],y=this.m[12],v=this.m[13],x=this.m[14],z=this.m[15],B=b.m[0],A=b.m[1],C=b.m[2],G=b.m[3],D=b.m[4],F=b.m[5],H=b.m[6],E=b.m[7],J=b.m[8],O=b.m[9],L=b.m[10],N=b.m[11],M=b.m[12],P=b.m[13],ha=b.m[14];b=b.m[15];return c[d]=f*B+l*D+j*J+e*M,c[d+1]=f*A+l*F+j*O+e*P,c[d+2]=f*C+l*H+j*L+e*ha,c[d+3]=f*G+l*E+j*N+e*b,c[d+4]=n*B+q*D+m*J+p*M,c[d+5]=n*A+q*F+m*O+p*P,c[d+6]=n*C+q*H+m*L+p*ha,c[d+7]=n*G+q*E+m*N+p*b,c[d+8]=g*B+r*D+s*J+t*M,c[d+9]=g*A+r*F+s*O+t*P,c[d+10]=g*C+r*H+s*L+t*ha,c[d+11]=g*G+r*E+s*N+t*b,c[d+12]=y*B+v*D+x*J+z*M,c[d+13]=y*A+v*F+x*O+z*P,c[d+14]=y*C+v*H+x*L+z*ha,c[d+15]=y*G+v*E+x*N+z*b,this;},x.prototype.equals=function(b){return b&&this.m[0]===b.m[0]&&this.m[1]===b.m[1]&&this.m[2]===b.m[2]&&this.m[3]===b.m[3]&&this.m[4]===b.m[4]&&this.m[5]===b.m[5]&&this.m[6]===b.m[6]&&this.m[7]===b.m[7]&&this.m[8]===b.m[8]&&this.m[9]===b.m[9]&&this.m[10]===b.m[10]&&this.m[11]===b.m[11]&&this.m[12]===b.m[12]&&this.m[13]===b.m[13]&&this.m[14]===b.m[14]&&this.m[15]===b.m[15];},x.prototype.clone=function(){return x.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15]);},x.prototype.getClassName=function(){return"Matrix";},x.prototype.getHashCode=function(){for(var b=this.m[0]||0,c=1;16>c;c++)b=397*b^(this.m[c]||0);y4tt.v9();return b;},x.prototype.decompose=function(b,c,d){var f,l;d.x=this.m[12];d.y=this.m[13];d.z=this.m[14];d=0>g.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])?-1:1;f=0>g.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])?-1:1,l=0>g.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])?-1:1;if(b.x=d*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),b.y=f*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),b.z=l*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===b.x||0===b.y||0===b.z)return c.x=0,c.y=0,c.z=0,c.w=1,!1;b=x.FromValues(this.m[0]/b.x,this.m[1]/b.x,this.m[2]/b.x,0,this.m[4]/b.y,this.m[5]/b.y,this.m[6]/b.y,0,this.m[8]/b.z,this.m[9]/b.z,this.m[10]/b.z,0,0,0,0,1);y4tt.v9();return t.FromRotationMatrixToRef(b,c),!0;},x.FromArray=function(b,c){var d;y4tt.v9();d=new x();return c||(c=0),x.FromArrayToRef(b,c,d),d;},x.FromArrayToRef=function(b,c,d){for(var f=0;16>f;f++)d.m[f]=b[f+c];},x.FromFloat32ArrayToRefScaled=function(b,c,d,f){y4tt.v9();for(var l=0;16>l;l++)f.m[l]=b[l+c]*d;},x.FromValuesToRef=function(b,c,d,f,l,j,e,n,q,m,p,g,r,s,t,y,v){v.m[0]=b;v.m[1]=c;y4tt.v9();v.m[2]=d;v.m[3]=f;v.m[4]=l;v.m[5]=j;v.m[6]=e;v.m[7]=n;v.m[8]=q;v.m[9]=m;v.m[10]=p;v.m[11]=g;v.m[12]=r;v.m[13]=s;v.m[14]=t;v.m[15]=y;},x.prototype.getRow=function(b){if(0>b||3<b)return null;y4tt.v9();b*=4;return new m(this.m[b+0],this.m[b+1],this.m[b+2],this.m[b+3]);},x.prototype.setRow=function(b,c){var d;y4tt.v9();if(0>b||3<b)return this;d=4*b;return this.m[d+0]=c.x,this.m[d+1]=c.y,this.m[d+2]=c.z,this.m[d+3]=c.w,this;},x.FromValues=function(b,c,d,f,l,j,e,n,q,m,p,g,r,s,t,y){var v;v=new x();y4tt.v9();return v.m[0]=b,v.m[1]=c,v.m[2]=d,v.m[3]=f,v.m[4]=l,v.m[5]=j,v.m[6]=e,v.m[7]=n,v.m[8]=q,v.m[9]=m,v.m[10]=p,v.m[11]=g,v.m[12]=r,v.m[13]=s,v.m[14]=t,v.m[15]=y,v;},x.Compose=function(b,c,d){var f;y4tt.v9();b=x.FromValues(b.x,0,0,0,0,b.y,0,0,0,0,b.z,0,0,0,0,1);f=x.Identity();return c.toRotationMatrix(f),b=b.multiply(f),b.setTranslation(d),b;},x.Identity=function(){return x.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);},x.IdentityToRef=function(b){x.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,b);},x.Zero=function(){y4tt.q9();return x.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);},x.RotationX=function(b){var c;c=new x();return x.RotationXToRef(b,c),c;},x.Invert=function(b){var c;c=new x();return b.invertToRef(c),c;},x.RotationXToRef=function(b,c){var d,f;d=Math.sin(b),f=Math.cos(b);c.m[0]=1;c.m[15]=1;c.m[5]=f;c.m[10]=f;c.m[9]=-d;c.m[6]=d;c.m[1]=0;c.m[2]=0;c.m[3]=0;c.m[4]=0;c.m[7]=0;c.m[8]=0;c.m[11]=0;c.m[12]=0;c.m[13]=0;c.m[14]=0;},x.RotationY=function(b){var c;y4tt.q9();c=new x();return x.RotationYToRef(b,c),c;},x.RotationYToRef=function(b,c){var d,f;d=Math.sin(b),f=Math.cos(b);c.m[5]=1;c.m[15]=1;c.m[0]=f;c.m[2]=-d;c.m[8]=d;c.m[10]=f;c.m[1]=0;c.m[3]=0;c.m[4]=0;c.m[6]=0;c.m[7]=0;c.m[9]=0;c.m[11]=0;c.m[12]=0;c.m[13]=0;c.m[14]=0;},x.RotationZ=function(b){var c;y4tt.q9();c=new x();return x.RotationZToRef(b,c),c;},x.RotationZToRef=function(b,c){var d,f;d=Math.sin(b),f=Math.cos(b);c.m[10]=1;c.m[15]=1;c.m[0]=f;c.m[1]=d;c.m[4]=-d;c.m[5]=f;c.m[2]=0;c.m[3]=0;c.m[6]=0;c.m[7]=0;c.m[8]=0;c.m[9]=0;c.m[11]=0;c.m[12]=0;c.m[13]=0;c.m[14]=0;},x.RotationAxis=function(b,c){var d;d=x.Zero();return x.RotationAxisToRef(b,c,d),d;},x.RotationAxisToRef=function(b,c,d){var f,l;f=Math.sin(-c);c=Math.cos(-c);y4tt.q9();l=1-c;b.normalize();d.m[0]=b.x*b.x*l+c;d.m[1]=b.x*b.y*l-b.z*f;d.m[2]=b.x*b.z*l+b.y*f;d.m[3]=0;d.m[4]=b.y*b.x*l+b.z*f;d.m[5]=b.y*b.y*l+c;d.m[6]=b.y*b.z*l-b.x*f;d.m[7]=0;d.m[8]=b.z*b.x*l-b.y*f;d.m[9]=b.z*b.y*l+b.x*f;d.m[10]=b.z*b.z*l+c;d.m[11]=0;d.m[15]=1;},x.RotationYawPitchRoll=function(b,c,d){var f;f=new x();return x.RotationYawPitchRollToRef(b,c,d,f),f;},x.RotationYawPitchRollToRef=function(b,c,d,f){t.RotationYawPitchRollToRef(b,c,d,this._tempQuaternion);this._tempQuaternion.toRotationMatrix(f);},x.Scaling=function(b,c,d){var f;f=x.Zero();return x.ScalingToRef(b,c,d,f),f;},x.ScalingToRef=function(b,c,d,f){f.m[0]=b;f.m[1]=0;f.m[2]=0;f.m[3]=0;f.m[4]=0;f.m[5]=c;f.m[6]=0;f.m[7]=0;f.m[8]=0;f.m[9]=0;f.m[10]=d;f.m[11]=0;f.m[12]=0;f.m[13]=0;f.m[14]=0;f.m[15]=1;},x.Translation=function(b,c,d){var f;f=x.Identity();return x.TranslationToRef(b,c,d,f),f;},x.TranslationToRef=function(b,c,d,f){y4tt.v9();x.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,b,c,d,1,f);},x.Lerp=function(b,c,d){y4tt.v9();for(var f=x.Zero(),l=0;16>l;l++)f.m[l]=b.m[l]*(1-d)+c.m[l]*d;return f;},x.DecomposeLerp=function(b,c,d){var f,j,e,n,q;f=new l(0,0,0),j=new t(),e=new l(0,0,0);b.decompose(f,j,e);n=new l(0,0,0),q=new t();b=new l(0,0,0);c.decompose(n,q,b);c=l.Lerp(f,n,d);j=t.Slerp(j,q,d);d=l.Lerp(e,b,d);return x.Compose(c,j,d);},x.LookAtLH=function(b,c,d){var f;f=x.Zero();return x.LookAtLHToRef(b,c,d,f),f;},x.LookAtLHToRef=function(b,c,d,f){c.subtractToRef(b,this._zAxis);this._zAxis.normalize();l.CrossToRef(d,this._zAxis,this._xAxis);0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize();l.CrossToRef(this._zAxis,this._xAxis,this._yAxis);this._yAxis.normalize();y4tt.v9();c=-l.Dot(this._xAxis,b);d=-l.Dot(this._yAxis,b);b=-l.Dot(this._zAxis,b);return x.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,c,d,b,1,f);},x.OrthoLH=function(b,c,d,f){var l;l=x.Zero();return x.OrthoLHToRef(b,c,d,f,l),l;},x.OrthoLHToRef=function(b,c,d,f,l){y4tt.v9();x.FromValuesToRef(2/b,0,0,0,0,2/c,0,0,0,0,1/(f-d),0,0,0,d/(d-f),1,l);},x.OrthoOffCenterLH=function(b,c,d,f,l,j){var e;e=x.Zero();y4tt.v9();return x.OrthoOffCenterLHToRef(b,c,d,f,l,j,e),e;},x.OrthoOffCenterLHToRef=function(b,c,d,f,l,j,e){y4tt.q9();e.m[0]=2/(c-b);e.m[1]=e.m[2]=e.m[3]=0;e.m[5]=2/(f-d);e.m[4]=e.m[6]=e.m[7]=0;e.m[10]=-1/(l-j);e.m[8]=e.m[9]=e.m[11]=0;e.m[12]=(b+c)/(b-c);e.m[13]=(f+d)/(d-f);e.m[14]=l/(l-j);e.m[15]=1;},x.PerspectiveLH=function(b,c,d,f){var l;y4tt.v9();l=x.Zero();return l.m[0]=2*d/b,l.m[1]=l.m[2]=l.m[3]=0,l.m[5]=2*d/c,l.m[4]=l.m[6]=l.m[7]=0,l.m[10]=-f/(d-f),l.m[8]=l.m[9]=0,l.m[11]=1,l.m[12]=l.m[13]=l.m[15]=0,l.m[14]=d*f/(d-f),l;},x.PerspectiveFovLH=function(b,c,d,f){var l;l=x.Zero();return x.PerspectiveFovLHToRef(b,c,d,f,l),l;},x.PerspectiveFovLHToRef=function(b,c,d,f,l,j){void 0===j&&(j=!0);b=1/Math.tan(0.5*b);j?l.m[0]=b/c:l.m[0]=b;l.m[1]=l.m[2]=l.m[3]=0;j?l.m[5]=b:l.m[5]=b*c;l.m[4]=l.m[6]=l.m[7]=0;l.m[8]=l.m[9]=0;l.m[10]=-f/(d-f);l.m[11]=1;l.m[12]=l.m[13]=l.m[15]=0;l.m[14]=d*f/(d-f);},x.GetFinalMatrix=function(b,c,d,f,l,j){var e,n;e=b.width,n=b.height;b=x.FromValues(e/2,0,0,0,0,-n/2,0,0,0,0,j-l,0,b.x+e/2,n/2+b.y,l,1);return c.multiply(d).multiply(f).multiply(b);},x.GetAsMatrix2x2=function(b){return new Float32Array([b.m[0],b.m[1],b.m[4],b.m[5]]);},x.GetAsMatrix3x3=function(b){return new Float32Array([b.m[0],b.m[1],b.m[2],b.m[4],b.m[5],b.m[6],b.m[8],b.m[9],b.m[10]]);},x.Transpose=function(b){var c;c=new x();y4tt.q9();return c.m[0]=b.m[0],c.m[1]=b.m[4],c.m[2]=b.m[8],c.m[3]=b.m[12],c.m[4]=b.m[1],c.m[5]=b.m[5],c.m[6]=b.m[9],c.m[7]=b.m[13],c.m[8]=b.m[2],c.m[9]=b.m[6],c.m[10]=b.m[10],c.m[11]=b.m[14],c.m[12]=b.m[3],c.m[13]=b.m[7],c.m[14]=b.m[11],c.m[15]=b.m[15],c;},x.Reflection=function(b){var c;c=new x();return x.ReflectionToRef(b,c),c;},x.ReflectionToRef=function(b,c){var d,f,l,j,e,n;b.normalize();d=b.normal.x,f=b.normal.y,l=b.normal.z,j=-2*d,e=-2*f,n=-2*l;c.m[0]=j*d+1;c.m[1]=e*d;c.m[2]=n*d;c.m[3]=0;c.m[4]=j*f;c.m[5]=e*f+1;c.m[6]=n*f;c.m[7]=0;c.m[8]=j*l;c.m[9]=e*l;c.m[10]=n*l+1;c.m[11]=0;c.m[12]=j*b.d;c.m[13]=e*b.d;c.m[14]=n*b.d;c.m[15]=1;},x._tempQuaternion=new t(),x._xAxis=l.Zero(),x._yAxis=l.Zero(),x._zAxis=l.Zero(),x);b.Matrix=y;B=function(b,c,d,f){y4tt.v9();this.normal=new l(b,c,d);this.d=f;};z=(B.prototype.asArray=function(){y4tt.q9();return[this.normal.x,this.normal.y,this.normal.z,this.d];},B.prototype.clone=function(){return new B(this.normal.x,this.normal.y,this.normal.z,this.d);},B.prototype.getClassName=function(){return"Plane";},B.prototype.getHashCode=function(){y4tt.q9();return 397*this.normal.getHashCode()^(this.d||0);},B.prototype.normalize=function(){var b,c;b=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),c=0;return 0!==b&&(c=1/b),this.normal.x*=c,this.normal.y*=c,this.normal.z*=c,this.d*=c,this;},B.prototype.transform=function(b){var c,d,f,l;y4tt.v9();b=y.Transpose(b);c=this.normal.x,d=this.normal.y,f=this.normal.z,l=this.d;return new B(c*b.m[0]+d*b.m[1]+f*b.m[2]+l*b.m[3],c*b.m[4]+d*b.m[5]+f*b.m[6]+l*b.m[7],c*b.m[8]+d*b.m[9]+f*b.m[10]+l*b.m[11],c*b.m[12]+d*b.m[13]+f*b.m[14]+l*b.m[15]);},B.prototype.dotCoordinate=function(b){y4tt.v9();return this.normal.x*b.x+this.normal.y*b.y+this.normal.z*b.z+this.d;},B.prototype.copyFromPoints=function(b,c,d){var f,l,j,e,n,q;l=c.x-b.x,j=c.y-b.y,e=c.z-b.z;c=d.x-b.x;n=d.y-b.y,q=d.z-b.z;d=j*q-e*n;e=e*c-l*q;l=l*n-j*c;j=Math.sqrt(d*d+e*e+l*l);return f=0!==j?1/j:0,this.normal.x=d*f,this.normal.y=e*f,this.normal.z=l*f,this.d=-(this.normal.x*b.x+this.normal.y*b.y+this.normal.z*b.z),this;},B.prototype.isFrontFacingTo=function(b,c){var d;y4tt.q9();d=l.Dot(this.normal,b);return c>=d;},B.prototype.signedDistanceTo=function(b){return l.Dot(b,this.normal)+this.d;},B.FromArray=function(b){y4tt.q9();return new B(b[0],b[1],b[2],b[3]);},B.FromPoints=function(b,c,d){var f;f=new B(0,0,0,0);return f.copyFromPoints(b,c,d),f;},B.FromPositionAndNormal=function(b,c){var d;d=new B(0,0,0,0);return c.normalize(),d.normal=c,d.d=-(c.x*b.x+c.y*b.y+c.z*b.z),d;},B.SignedDistanceToPlaneFromPositionAndNormal=function(b,c,d){y4tt.q9();b=-(c.x*b.x+c.y*b.y+c.z*b.z);return l.Dot(d,c)+b;},B);b.Plane=z;A=function(b,c,d,f){this.x=b;y4tt.q9();this.y=c;this.width=d;this.height=f;};r=(A.prototype.toGlobal=function(b,c){return new A(this.x*b,this.y*c,this.width*b,this.height*c);},A);b.Viewport=r;C=function(){};r=(C.GetPlanes=function(b){y4tt.q9();for(var c=[],d=0;6>d;d++)c.push(new z(0,0,0,0));return C.GetPlanesToRef(b,c),c;},C.GetPlanesToRef=function(b,c){c[0].normal.x=b.m[3]+b.m[2];c[0].normal.y=b.m[7]+b.m[6];c[0].normal.z=b.m[11]+b.m[10];c[0].d=b.m[15]+b.m[14];c[0].normalize();c[1].normal.x=b.m[3]-b.m[2];c[1].normal.y=b.m[7]-b.m[6];c[1].normal.z=b.m[11]-b.m[10];c[1].d=b.m[15]-b.m[14];c[1].normalize();c[2].normal.x=b.m[3]+b.m[0];c[2].normal.y=b.m[7]+b.m[4];c[2].normal.z=b.m[11]+b.m[8];c[2].d=b.m[15]+b.m[12];c[2].normalize();c[3].normal.x=b.m[3]-b.m[0];c[3].normal.y=b.m[7]-b.m[4];c[3].normal.z=b.m[11]-b.m[8];c[3].d=b.m[15]-b.m[12];c[3].normalize();c[4].normal.x=b.m[3]-b.m[1];c[4].normal.y=b.m[7]-b.m[5];c[4].normal.z=b.m[11]-b.m[9];c[4].d=b.m[15]-b.m[13];y4tt.v9();c[4].normalize();c[5].normal.x=b.m[3]+b.m[1];c[5].normal.y=b.m[7]+b.m[5];c[5].normal.z=b.m[11]+b.m[9];c[5].d=b.m[15]+b.m[13];c[5].normalize();},C);b.Frustum=r;r=b.Space||(b.Space={});r[r.LOCAL=0]="LOCAL";r[r.WORLD=1]="WORLD";b.Space;r=function(){};G=(r.X=new l(1,0,0),r.Y=new l(0,1,0),r.Z=new l(0,0,1),r);b.Axis=G;r=function(){};r=(r.interpolate=function(b,c,d,f,l){var j;j=1-3*f+3*c;f=3*f-6*c;y4tt.v9();c*=3;for(var e=b,n=0;5>n;n++)var q=e*e,e=e-(j*q*e+f*q+c*e-b)*(1/(3*j*q+2*f*e+c)),e=Math.min(1,Math.max(0,e));return 3*Math.pow(1-e,2)*e*d+3*(1-e)*Math.pow(e,2)*l+Math.pow(e,3);},r);b.BezierCurve=r;r=b.Orientation||(b.Orientation={});r[r.CW=0]="CW";r[r.CCW=1]="CCW";D=b.Orientation,J=function(b){var c;c=this;this.degrees=function(){return 180*c._radians/Math.PI;};this.radians=function(){return c._radians;};this._radians=b;0>this._radians&&(this._radians+=2*Math.PI);};H=(J.BetweenTwoPoints=function(b,c){var d;d=c.subtract(b),d=Math.atan2(d.y,d.x);y4tt.q9();return new J(d);},J.FromRadians=function(b){y4tt.q9();return new J(b);},J.FromDegrees=function(b){return new J(b*Math.PI/180);},J);b.Angle=H;F=function(b,c,d){var f,l,j;this.startPoint=b;this.midPoint=c;this.endPoint=d;f=Math.pow(c.x,2)+Math.pow(c.y,2),l=(Math.pow(b.x,2)+Math.pow(b.y,2)-f)/2,f=(f-Math.pow(d.x,2)-Math.pow(d.y,2))/2,j=(b.x-c.x)*(c.y-d.y)-(c.x-d.x)*(b.y-c.y);this.centerPoint=new q((l*(c.y-d.y)-f*(b.y-c.y))/j,((b.x-c.x)*f-(c.x-d.x)*l)/j);this.radius=this.centerPoint.subtract(this.startPoint).length();this.startAngle=H.BetweenTwoPoints(this.centerPoint,this.startPoint);y4tt.q9();b=this.startAngle.degrees();c=H.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees();d=H.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();180<c-b&&(c-=360);-180>c-b&&(c+=360);180<d-c&&(d-=360);-180>d-c&&(d+=360);this.orientation=0>c-b?D.CW:D.CCW;this.angle=H.FromDegrees(this.orientation===D.CW?b-d:d-b);};b.Arc2=F;O=function(b,c){this._points=[];this._length=0;this.closed=!1;this._points.push(new q(b,c));};r=(O.prototype.addLineTo=function(b,c){var d,f;if(closed)return this;d=new q(b,c),f=this._points[this._points.length-1];return this._points.push(d),this._length+=d.subtract(f).length(),this;},O.prototype.addArcTo=function(b,c,d,f,l){var j,e;if(void 0===l&&(l=36),closed)return this;j=this._points[this._points.length-1];y4tt.q9();b=new q(b,c);d=new q(d,f);j=new F(j,b,d);d=j.angle.radians()/l;j.orientation===D.CW&&(d*=-1);f=j.startAngle.radians()+d;for(b=0;l>b;b++){c=Math.cos(f)*j.radius+j.centerPoint.x;e=Math.sin(f)*j.radius+j.centerPoint.y;this.addLineTo(c,e);f+=d;}return this;},O.prototype.close=function(){return this.closed=!0,this;},O.prototype.length=function(){var b;b=this._length;this.closed||(b+=this._points[0].subtract(this._points[this._points.length-1]).length());return b;},O.prototype.getPoints=function(){return this._points;},O.prototype.getPointAtLengthPosition=function(b){var l,j;if(0>b||1<b)return q.Zero();y4tt.v9();for(var c=b*this.length(),d=0,f=0;f<this._points.length;f++){b=this._points[f];l=this._points[(f+1)%this._points.length].subtract(b),j=l.length()+d;if(c>=d&&j>=c)return f=l.normalize(),c-=d,new q(b.x+f.x*c,b.y+f.y*c);d=j;}return q.Zero();},O.StartingAt=function(b,c){return new O(b,c);},O);b.Path2=r;r=function(b,c,d){this.path=b;this._curve=[];this._distances=[];this._tangents=[];this._normals=[];this._binormals=[];for(var f=0;f<b.length;f++)this._curve[f]=b[f].clone();this._raw=d||!1;this._compute(c);};r=(r.prototype.getCurve=function(){y4tt.q9();return this._curve;},r.prototype.getTangents=function(){return this._tangents;},r.prototype.getNormals=function(){y4tt.q9();return this._normals;},r.prototype.getBinormals=function(){return this._binormals;},r.prototype.getDistances=function(){return this._distances;},r.prototype.update=function(b,c){for(var d=0;d<b.length;d++)this._curve[d].x=b[d].x,this._curve[d].y=b[d].y,this._curve[d].z=b[d].z;y4tt.q9();return this._compute(c),this;},r.prototype._compute=function(b){var c,d;c=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0);this._raw||this._tangents[0].normalize();this._tangents[c-1]=this._curve[c-1].subtract(this._curve[c-2]);this._raw||this._tangents[c-1].normalize();d=this._tangents[0];b=this._normalVector(this._curve[0],d,b);this._normals[0]=b;this._raw||this._normals[0].normalize();this._binormals[0]=l.Cross(d,this._normals[0]);this._raw||this._binormals[0].normalize();this._distances[0]=0;for(var f,j,d=1;c>d;d++)b=this._getLastNonNullVector(d),c-1>d&&(f=this._getFirstNonNullVector(d),this._tangents[d]=b.add(f),this._tangents[d].normalize()),this._distances[d]=this._distances[d-1]+b.length(),b=this._tangents[d],j=this._binormals[d-1],this._normals[d]=l.Cross(j,b),this._raw||this._normals[d].normalize(),this._binormals[d]=l.Cross(b,this._normals[d]),this._raw||this._binormals[d].normalize();},r.prototype._getFirstNonNullVector=function(b){for(var c=1,d=this._curve[b+c].subtract(this._curve[b]);0===d.length()&&b+c+1<this._curve.length;)c++,d=this._curve[b+c].subtract(this._curve[b]);return d;},r.prototype._getLastNonNullVector=function(b){for(var c=1,d=this._curve[b].subtract(this._curve[b-c]);0===d.length()&&b>c+1;)c++,d=this._curve[b].subtract(this._curve[b-c]);y4tt.v9();return d;},r.prototype._normalVector=function(c,d,f){var j;if(void 0===f||null===f){g.WithinEpsilon(d.y,1,b.Epsilon)?g.WithinEpsilon(d.x,1,b.Epsilon)?g.WithinEpsilon(d.z,1,b.Epsilon)||(j=new l(0,0,1)):j=new l(1,0,0):j=new l(0,-1,0);c=l.Cross(d,j);}else c=l.Cross(d,f),l.CrossToRef(c,d,c);return c.normalize(),c;},r);b.Path3D=r;E=function(b){y4tt.q9();this._length=0;this._points=b;this._length=this._computeLength(b);};r=(E.CreateQuadraticBezier=function(b,c,d,f){f=2<f?f:3;for(var j=[],e=0;f>=e;e++)j.push(new l((1-e/f)*(1-e/f)*b.x+2*(e/f)*(1-e/f)*c.x+e/f*(e/f)*d.x,(1-e/f)*(1-e/f)*b.y+2*(e/f)*(1-e/f)*c.y+e/f*(e/f)*d.y,(1-e/f)*(1-e/f)*b.z+2*(e/f)*(1-e/f)*c.z+e/f*(e/f)*d.z));return new E(j);},E.CreateCubicBezier=function(b,c,d,f,j){y4tt.v9();j=3<j?j:4;for(var e=[],n=function(b,c,d,f,l){return(1-b)*(1-b)*(1-b)*c+3*b*(1-b)*(1-b)*d+3*b*b*(1-b)*f+b*b*b*l;},q=0;j>=q;q++)e.push(new l(n(q/j,b.x,c.x,d.x,f.x),n(q/j,b.y,c.y,d.y,f.y),n(q/j,b.z,c.z,d.z,f.z)));return new E(e);},E.CreateHermiteSpline=function(b,c,d,f,j){y4tt.v9();for(var e=[],n=1/j,q=0;j>=q;q++)e.push(l.Hermite(b,c,d,f,q*n));return new E(e);},E.prototype.getPoints=function(){return this._points;},E.prototype.length=function(){return this._length;},E.prototype["continue"]=function(b){var c,d;c=this._points[this._points.length-1],d=this._points.slice();b=b.getPoints();for(var f=1;f<b.length;f++)d.push(b[f].subtract(b[0]).add(c));y4tt.q9();return new E(d);},E.prototype._computeLength=function(b){for(var c=0,d=1;d<b.length;d++)c+=b[d].subtract(b[d-1]).length();return c;},E);b.Curve3=r;r=function(){this.L00=l.Zero();this.L1_1=l.Zero();this.L10=l.Zero();this.L11=l.Zero();this.L2_2=l.Zero();this.L2_1=l.Zero();this.L20=l.Zero();this.L21=l.Zero();this.L22=l.Zero();};r=(r.prototype.addLight=function(b,c,d){c=new l(c.r,c.g,c.b).scale(d);this.L00=this.L00.add(c.scale(0.282095));this.L1_1=this.L1_1.add(c.scale(0.488603*b.y));this.L10=this.L10.add(c.scale(0.488603*b.z));this.L11=this.L11.add(c.scale(0.488603*b.x));y4tt.v9();this.L2_2=this.L2_2.add(c.scale(1.092548*b.x*b.y));this.L2_1=this.L2_1.add(c.scale(1.092548*b.y*b.z));this.L21=this.L21.add(c.scale(1.092548*b.x*b.z));this.L20=this.L20.add(c.scale(0.315392*(3*b.z*b.z-1)));this.L22=this.L22.add(c.scale(0.546274*(b.x*b.x-b.y*b.y)));},r.prototype.scale=function(b){this.L00=this.L00.scale(b);this.L1_1=this.L1_1.scale(b);this.L10=this.L10.scale(b);y4tt.v9();this.L11=this.L11.scale(b);this.L2_2=this.L2_2.scale(b);this.L2_1=this.L2_1.scale(b);this.L20=this.L20.scale(b);this.L21=this.L21.scale(b);this.L22=this.L22.scale(b);},r);b.SphericalHarmonics=r;L=function(){y4tt.q9();this.x=l.Zero();this.y=l.Zero();this.z=l.Zero();this.xx=l.Zero();this.yy=l.Zero();this.zz=l.Zero();this.xy=l.Zero();this.yz=l.Zero();this.zx=l.Zero();};r=(L.prototype.addAmbient=function(b){b=new l(b.r,b.g,b.b);this.xx=this.xx.add(b);this.yy=this.yy.add(b);y4tt.v9();this.zz=this.zz.add(b);},L.getSphericalPolynomialFromHarmonics=function(b){var c;c=new L();return c.x=b.L11.scale(1.02333),c.y=b.L1_1.scale(1.02333),c.z=b.L10.scale(1.02333),c.xx=b.L00.scale(0.886277).subtract(b.L20.scale(0.247708)).add(b.L22.scale(0.429043)),c.yy=b.L00.scale(0.886277).subtract(b.L20.scale(0.247708)).subtract(b.L22.scale(0.429043)),c.zz=b.L00.scale(0.886277).add(b.L20.scale(0.495417)),c.yz=b.L2_1.scale(0.858086),c.zx=b.L21.scale(0.858086),c.xy=b.L2_2.scale(0.858086),c;},L);b.SphericalPolynomial=r;N=function(b,c){void 0===b&&(b=l.Zero());y4tt.q9();void 0===c&&(c=l.Up());this.position=b;this.normal=c;};r=(N.prototype.clone=function(){return new N(this.position.clone(),this.normal.clone());},N);b.PositionNormalVertex=r;P=function(b,c,d){void 0===b&&(b=l.Zero());void 0===c&&(c=l.Up());void 0===d&&(d=q.Zero());this.position=b;y4tt.q9();this.normal=c;this.uv=d;};r=(P.prototype.clone=function(){return new P(this.position.clone(),this.normal.clone(),this.uv.clone());},P);b.PositionNormalTextureVertex=r;r=function(){};M=(r.Color3=[e.Black(),e.Black(),e.Black()],r.Vector2=[q.Zero(),q.Zero(),q.Zero()],r.Vector3=[l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero()],r.Vector4=[m.Zero(),m.Zero(),m.Zero()],r.Quaternion=[new t(0,0,0,0)],r.Matrix=[y.Zero(),y.Zero(),y.Zero(),y.Zero(),y.Zero(),y.Zero(),y.Zero(),y.Zero()],r);b.Tmp=M;}(BABYLON||(BABYLON={}));!function(b){var e;b.serialize=function(b){return g(0,b);};function g(b,d){y4tt.v9();return function(f,e){y4tt.v9();f.__serializableMembers||(f.__serializableMembers={});f.__serializableMembers[e]={type:b,sourceName:d};};}b.serializeAsTexture=function(b){y4tt.v9();return g(1,b);};b.serializeAsColor3=function(b){y4tt.v9();return g(2,b);};b.serializeAsFresnelParameters=function(b){return g(3,b);};b.serializeAsVector2=function(b){return g(4,b);};b.serializeAsVector3=function(b){return g(5,b);};b.serializeAsMeshReference=function(b){y4tt.v9();return g(6,b);};b.serializeAsColorCurves=function(b){y4tt.v9();return g(7,b);};e=function(){};e=(e.Serialize=function(c,d){var e,j,l;d||(d={});d.tags=b.Tags.GetTags(c);y4tt.v9();for(var f in c.__serializableMembers){e=c.__serializableMembers[f],j=e.sourceName||f,e=e.type,l=c[f];if(void 0!==l&&null!==l)switch(e){case 0:d[j]=l;break;case 1:d[j]=l.serialize();break;case 2:d[j]=l.asArray();break;case 3:d[j]=l.serialize();break;case 4:d[j]=l.asArray();break;case 5:d[j]=l.asArray();break;case 6:d[j]=l.id;break;case 7:d[j]=l.serialize();}}return d;},e.Parse=function(c,d,f,e){var l,n;y4tt.v9();c=c();b.Tags.AddTagsTo(c,d.tags);for(var j in c.__serializableMembers){l=c.__serializableMembers[j],n=d[l.sourceName||j],l=l.type;if(void 0!==n&&null!==n)switch(l){case 0:c[j]=n;break;case 1:c[j]=b.Texture.Parse(n,f,e);break;case 2:c[j]=b.Color3.FromArray(n);break;case 3:c[j]=b.FresnelParameters.Parse(n);break;case 4:c[j]=b.Vector2.FromArray(n);break;case 5:c[j]=b.Vector3.FromArray(n);break;case 6:c[j]=f.getLastMeshByID(n);break;case 7:c[j]=b.ColorCurves.Parse(n);}}return c;},e.Clone=function(c,d){var f,j,l;f=c();b.Tags.AddTagsTo(f,d.tags);for(var e in f.__serializableMembers){j=d[e],l=f.__serializableMembers[e].type;if(void 0!==j&&null!==j)switch(l){case 0:case 6:f[e]=j;break;case 1:case 2:case 3:case 4:case 5:case 7:f[e]=j.clone();}}return f;},e);y4tt.q9();b.SerializationHelper=e;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d;g=function(b,c){void 0===c&&(c=!1);this.mask=b;this.skipNextObservers=c;};b.EventState=g;e=function(b,c){this.callback=b;this.mask=c;};b.Observer=e;d=function(){this._observers=[];};c=(d.prototype.add=function(b,c,d){if(void 0===c&&(c=-1),void 0===d&&(d=!1),!b)return null;b=new e(b,c);return d?this._observers.unshift(b):this._observers.push(b),b;},d.prototype.remove=function(b){b=this._observers.indexOf(b);y4tt.q9();return-1!==b?(this._observers.splice(b,1),!0):!1;},d.prototype.removeCallback=function(b){for(var c=0;c<this._observers.length;c++)if(this._observers[c].callback===b)return this._observers.splice(c,1),!0;return!1;},d.prototype.notifyObservers=function(b,c){var m;void 0===c&&(c=-1);for(var d=new g(c),l=0,e=this._observers;l<e.length;l++){m=e[l];if(m.mask&c&&m.callback(b,d),d.skipNextObservers)break;}},d.prototype.hasObservers=function(){return 0<this._observers.length;},d.prototype.clear=function(){this._observers=[];},d.prototype.clone=function(){var b;b=new d();y4tt.v9();return b._observers=this._observers.slice(0),b;},d);b.Observable=c;}(BABYLON||(BABYLON={}));!function(b){var g,e;y4tt.q9();e=function(b,d){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;this.callbackManifestChecked=d;this.currentSceneUrl=e.ReturnFullUrlLocation(b);this.db=null;this.enableTexturesOffline=this.enableSceneOffline=!1;this.manifestVersionFound=0;y4tt.v9();this.hasReachedQuota=this.mustUpdateRessources=!1;e.IDBStorageEnabled?this.checkManifestFile():this.callbackManifestChecked(!0);};g=(e.prototype.checkManifestFile=function(){var d,f,e,j,l;y4tt.v9();d=this,f=this,e=!1,j=this.currentSceneUrl+".manifest",l=new XMLHttpRequest();navigator.onLine&&(e=!0,j=j+(null==j.match(/\?/)?"?":"&")+new Date().getTime());function c(){y4tt.q9();f.enableSceneOffline=!1;f.enableTexturesOffline=!1;f.callbackManifestChecked(!1);}l.open("GET",j,!0);l.addEventListener("load",function(){var f;if(200===l.status||b.Tools.ValidateXHRData(l,1))try{f=JSON.parse(l.response);d.enableSceneOffline=f.enableSceneOffline;d.enableTexturesOffline=f.enableTexturesOffline;f.version&&!isNaN(parseInt(f.version))&&(d.manifestVersionFound=f.version);d.callbackManifestChecked&&d.callbackManifestChecked(!0);}catch(j){c();}else c();},!1);l.addEventListener("error",function(){y4tt.q9();e?(e=!1,l.open("GET",d.currentSceneUrl+".manifest",!0),l.send()):c();},!1);try{l.send();}catch(n){b.Tools.Error("Error on XHR send request."),f.callbackManifestChecked(!1);}},e.prototype.openAsync=function(c,d){var e,j,l;e=this,j=this;function f(){j.isSupported=!1;y4tt.v9();d&&d();}if(this.idbFactory&&(this.enableSceneOffline||this.enableTexturesOffline))if(this.db)c&&c();else{this.hasReachedQuota=!1;this.isSupported=!0;l=this.idbFactory.open("babylonjs",1);l.onerror=function(){f();};l.onblocked=function(){b.Tools.Error("IDB request blocked. Please reload the page.");y4tt.v9();f();};l.onsuccess=function(){e.db=l.result;c();};l.onupgradeneeded=function(c){e.db=c.target.result;try{e.db.createObjectStore("scenes",{keyPath:"sceneUrl"}),e.db.createObjectStore("versions",{keyPath:"sceneUrl"}),e.db.createObjectStore("textures",{keyPath:"textureUrl"});}catch(d){b.Tools.Error("Error while creating object stores. Exception: "+d.message),f();}};}else this.isSupported=!1,d&&d();},e.prototype.loadImageFromDB=function(b,d){var f,q,j;f=this,q=e.ReturnFullUrlLocation(b),j=function(){y4tt.q9();f.hasReachedQuota||null===f.db?d.src=b:f._saveImageIntoDBAsync(q,d);};this.mustUpdateRessources?j():this._loadImageFromDBAsync(q,d,j);},e.prototype._loadImageFromDBAsync=function(c,d,f){var e,j;y4tt.v9();if(this.isSupported&&null!==this.db){j=this.db.transaction(["textures"]);j.onabort=function(){y4tt.q9();d.src=c;};j.oncomplete=function(){var l;y4tt.q9();e?(l=(window.URL||window.webkitURL).createObjectURL(e.data,{oneTimeOnly:!0}),d.onerror=function(){b.Tools.Error("Error loading image from blob URL: "+l+" switching back to web url: "+c);y4tt.q9();d.src=c;},d.src=l):f();};j=j.objectStore("textures").get(c);j.onsuccess=function(b){e=b.target.result;};j.onerror=function(){y4tt.v9();b.Tools.Error("Error loading texture "+c+" from DB.");d.src=c;};}else b.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),d.src=c;},e.prototype._saveImageIntoDBAsync=function(c,d){var f,q,j,l;y4tt.v9();f=this;if(this.isSupported){q=function(){var b,c;if(j){c=window.URL||window.webkitURL;try{b=c.createObjectURL(j,{oneTimeOnly:!0});}catch(f){b=c.createObjectURL(j);}}y4tt.v9();d.src=b;};if(e.IsUASupportingBlobStorage){l=new XMLHttpRequest();l.open("GET",c,!0);l.responseType="blob";l.addEventListener("load",function(){var b,m,p;y4tt.v9();if(200===l.status){j=l.response;b=f.db.transaction(["textures"],"readwrite");b.onabort=function(b){try{b.srcElement.error&&"QuotaExceededError"===b.srcElement.error.name&&(this.hasReachedQuota=!0);}catch(c){}y4tt.v9();q();};b.oncomplete=function(){q();};m={textureUrl:c,data:j};try{p=b.objectStore("textures").put(m);p.onsuccess=function(){};p.onerror=function(){y4tt.v9();q();};}catch(g){25===g.code&&(e.IsUASupportingBlobStorage=!1),d.src=c;}}else d.src=c;},!1);l.addEventListener("error",function(){b.Tools.Error("Error in XHR request in BABYLON.Database.");d.src=c;},!1);l.send();}else d.src=c;}else b.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),d.src=c;},e.prototype._checkVersionFromDB=function(b,d){var f;f=this;this._loadVersionFromDBAsync(b,d,function(){f._saveVersionIntoDBAsync(b,d);});},e.prototype._loadVersionFromDBAsync=function(c,d,f){var e,j,l,n;y4tt.q9();e=this;if(this.isSupported){try{l=this.db.transaction(["versions"]);l.oncomplete=function(){y4tt.q9();j?e.manifestVersionFound>j.data?(e.mustUpdateRessources=!0,f()):d(j.data):(e.mustUpdateRessources=!0,f());};l.onabort=function(){y4tt.q9();d(-1);};n=l.objectStore("versions").get(c);n.onsuccess=function(b){y4tt.v9();j=b.target.result;};n.onerror=function(){b.Tools.Error("Error loading version for scene "+c+" from DB.");y4tt.q9();d(-1);};}catch(m){b.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: "+m.message),d(-1);}}else b.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),d(-1);},e.prototype._saveVersionIntoDBAsync=function(c,d){var f,e,j,l;f=this;if(this.isSupported&&!this.hasReachedQuota)try{e=this.db.transaction(["versions"],"readwrite");e.onabort=function(b){try{b.srcElement.error&&"QuotaExceededError"===b.srcElement.error.name&&(f.hasReachedQuota=!0);}catch(c){}d(-1);};e.oncomplete=function(){d(f.manifestVersionFound);};j={sceneUrl:c,data:this.manifestVersionFound},l=e.objectStore("versions").put(j);l.onsuccess=function(){};l.onerror=function(){b.Tools.Error("Error in DB add version request in BABYLON.Database.");};}catch(n){b.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+n.message),d(-1);}else d(-1);},e.prototype.loadFileFromDB=function(b,d,f,q,j){var l,n,m;l=this,n=e.ReturnFullUrlLocation(b),m=function(){y4tt.q9();l._saveFileIntoDBAsync(n,d,f);};this._checkVersionFromDB(n,function(b){-1!==b?l.mustUpdateRessources?l._saveFileIntoDBAsync(n,d,f,j):l._loadFileFromDBAsync(n,d,m,j):q();});},e.prototype._loadFileFromDBAsync=function(c,d,f){var e,j,l;if(this.isSupported){e=-1!==c.indexOf(".babylon")?"scenes":"textures";l=this.db.transaction([e]);l.oncomplete=function(){y4tt.v9();j?d(j.data):f();};l.onabort=function(){y4tt.q9();f();};e=l.objectStore(e).get(c);e.onsuccess=function(b){j=b.target.result;};e.onerror=function(){b.Tools.Error("Error loading file "+c+" from DB.");y4tt.v9();f();};}else b.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),d();},e.prototype._saveFileIntoDBAsync=function(c,d,f,e){var j,l,n,m;j=this;y4tt.q9();if(this.isSupported){l=-1!==c.indexOf(".babylon")?"scenes":"textures";m=new XMLHttpRequest();m.open("GET",c,!0);e&&(m.responseType="arraybuffer");m.onprogress=f;m.addEventListener("load",function(){var f,g,s;y4tt.q9();if(200===m.status||b.Tools.ValidateXHRData(m,e?6:1))if(n=e?m.response:m.responseText,j.hasReachedQuota)d(n);else{f=j.db.transaction([l],"readwrite");f.onabort=function(b){try{b.srcElement.error&&"QuotaExceededError"===b.srcElement.error.name&&(this.hasReachedQuota=!0);}catch(c){}y4tt.q9();d(n);};f.oncomplete=function(){y4tt.v9();d(n);};g="scenes"===l?{sceneUrl:c,data:n,version:j.manifestVersionFound}:{textureUrl:c,data:n};try{s=f.objectStore(l).put(g);s.onsuccess=function(){};s.onerror=function(){b.Tools.Error("Error in DB add file request in BABYLON.Database.");};}catch(t){d(n);}}else d();},!1);m.addEventListener("error",function(){y4tt.v9();b.Tools.Error("error on XHR request.");d();},!1);m.send();}else b.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),d();},e.IsUASupportingBlobStorage=!0,e.IDBStorageEnabled=!0,e.parseURL=function(b){var d;document.createElement("a").href=b;d=b.substring(0,b.lastIndexOf("#")),d=b.substring(d.lastIndexOf("/")+1,b.length);y4tt.v9();return b.substring(0,b.indexOf(d,0));},e.ReturnFullUrlLocation=function(b){y4tt.v9();return-1===b.indexOf("http:/")?e.parseURL(window.location.href)+b:b;},e);b.Database=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;g=b.Internals||(b.Internals={}),c=function(){};e=(c.GetTGAHeader=function(b){var c;c=0;y4tt.v9();return{id_length:b[c++],colormap_type:b[c++],image_type:b[c++],colormap_index:b[c++]|b[c++]<<8,colormap_length:b[c++]|b[c++]<<8,colormap_size:b[c++],origin:[b[c++]|b[c++]<<8,b[c++]|b[c++]<<8],width:b[c++]|b[c++]<<8,height:b[c++]|b[c++]<<8,pixel_size:b[c++],flags:b[c++]};},c.UploadContent=function(d,f){var e,j,l,n,m,p,g,s;if(19>f.length)return void b.Tools.Error("Unable to load TGA file - Not enough data to contain header");e=18,j=c.GetTGAHeader(f);if(j.id_length+e>f.length)return void b.Tools.Error("Unable to load TGA file - Not enough data");e=e+j.id_length,l=!1,n=!1,m=!1;switch(j.image_type){case c._TYPE_RLE_INDEXED:l=!0;case c._TYPE_INDEXED:n=!0;break;case c._TYPE_RLE_RGB:l=!0;case c._TYPE_RGB:break;case c._TYPE_RLE_GREY:l=!0;case c._TYPE_GREY:m=!0;}g=(15&j.flags,j.pixel_size>>3),s=j.width*j.height*g;if(n&&(p=f.subarray(e,e+=j.colormap_length*(j.colormap_size>>3))),l)for(var l=new Uint8Array(s),t,v,y=0,x=new Uint8Array(g);s>e&&s>y;)if(t=f[e++],n=(127&t)+1,128&t){for(v=0;g>v;++v)x[v]=f[e++];for(v=0;n>v;++v)l.set(x,y+v*g);y+=g*n;}else{n*=g;for(v=0;n>v;++v)l[y+v]=f[e++];y+=n;}else l=f.subarray(e,e+(n?j.width*j.height:s));switch((j.flags&c._ORIGIN_MASK)>>c._ORIGIN_SHIFT){default:case c._ORIGIN_UL:e=0;s=1;v=j.width;g=0;t=1;n=j.height;break;case c._ORIGIN_BL:e=0;s=1;v=j.width;g=j.height-1;n=t=-1;break;case c._ORIGIN_UR:e=j.width-1;v=s=-1;g=0;t=1;n=j.height;break;case c._ORIGIN_BR:e=j.width-1,v=s=-1,g=j.height-1,n=t=-1;}m=c["_getImageData"+(m?"Grey":"")+j.pixel_size+"bits"](j,p,l,g,t,n,e,s,v);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,j.width,j.height,0,d.RGBA,d.UNSIGNED_BYTE,m);},c._getImageData8bits=function(b,c,e,j,l,n,m,p,g){var s,t,v,y;v=b.width,y=0;y4tt.v9();b=new Uint8Array(4*v*b.height);for(t=j;t!==n;t+=l)for(s=m;s!==g;s+=p,y++)j=e[y],b[4*(s+v*t)+3]=255,b[4*(s+v*t)+2]=c[3*j+0],b[4*(s+v*t)+1]=c[3*j+1],b[4*(s+v*t)+0]=c[3*j+2];return b;},c._getImageData16bits=function(b,c,e,j,l,n,m,p,g){var s,t,v;c=b.width;v=0;b=new Uint8Array(4*c*b.height);for(t=j;t!==n;t+=l)for(s=m;s!==g;s+=p,v+=2)j=e[v+0]+(e[v+1]<<8),b[4*(s+c*t)+0]=(31744&j)>>7,b[4*(s+c*t)+1]=(992&j)>>2,b[4*(s+c*t)+2]=(31&j)>>3,b[4*(s+c*t)+3]=32768&j?0:255;y4tt.q9();return b;},c._getImageData24bits=function(b,c,e,j,l,n,m,p,g){var s,t;c=b.width;t=0;b=new Uint8Array(4*c*b.height);for(s=j;s!==n;s+=l)for(j=m;j!==g;j+=p,t+=3)b[4*(j+c*s)+3]=255,b[4*(j+c*s)+2]=e[t+0],b[4*(j+c*s)+1]=e[t+1],b[4*(j+c*s)+0]=e[t+2];return b;},c._getImageData32bits=function(b,c,e,j,l,n,m,p,g){var s,t;c=b.width;t=0;b=new Uint8Array(4*c*b.height);y4tt.v9();for(s=j;s!==n;s+=l)for(j=m;j!==g;j+=p,t+=4)b[4*(j+c*s)+2]=e[t+0],b[4*(j+c*s)+1]=e[t+1],b[4*(j+c*s)+0]=e[t+2],b[4*(j+c*s)+3]=e[t+3];return b;},c._getImageDataGrey8bits=function(b,c,e,j,l,n,m,p,g){var s,t,v;c=b.width;v=0;b=new Uint8Array(4*c*b.height);for(t=j;t!==n;t+=l)for(s=m;s!==g;s+=p,v++)j=e[v],b[4*(s+c*t)+0]=j,b[4*(s+c*t)+1]=j,b[4*(s+c*t)+2]=j,b[4*(s+c*t)+3]=255;return b;},c._getImageDataGrey16bits=function(b,c,e,j,l,n,m,p,g){var s,t;y4tt.q9();c=b.width;t=0;b=new Uint8Array(4*c*b.height);for(s=j;s!==n;s+=l)for(j=m;j!==g;j+=p,t+=2)b[4*(j+c*s)+0]=e[t+0],b[4*(j+c*s)+1]=e[t+0],b[4*(j+c*s)+2]=e[t+0],b[4*(j+c*s)+3]=e[t+1];return b;},c._TYPE_NO_DATA=0,c._TYPE_INDEXED=1,c._TYPE_RGB=2,c._TYPE_GREY=3,c._TYPE_RLE_INDEXED=9,c._TYPE_RLE_RGB=10,c._TYPE_RLE_GREY=11,c._ORIGIN_MASK=48,c._ORIGIN_SHIFT=4,c._ORIGIN_BL=0,c._ORIGIN_BR=1,c._ORIGIN_UL=2,c._ORIGIN_UR=3,c);g.TGATools=e;!0;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(b){this._duplicateId=this.length=0;this.data=Array(b);this._id=e._GlobalId++;};g=(e.prototype.push=function(b){this.data[this.length++]=b;this.length>this.data.length&&(this.data.length*=2);b.__smartArrayFlags||(b.__smartArrayFlags={});y4tt.q9();b.__smartArrayFlags[this._id]=this._duplicateId;},e.prototype.pushNoDuplicate=function(b){return b.__smartArrayFlags&&b.__smartArrayFlags[this._id]===this._duplicateId?!1:(this.push(b),!0);},e.prototype.sort=function(b){this.data.sort(b);},e.prototype.reset=function(){this.length=0;this._duplicateId++;},e.prototype.concat=function(b){if(0!==b.length){this.length+b.length>this.data.length&&(this.data.length=2*(this.length+b.length));for(var d=0;d<b.length;d++)this.data[this.length++]=(b.data||b)[d];}},e.prototype.concatWithNoDuplicate=function(b){y4tt.v9();if(0!==b.length){this.length+b.length>this.data.length&&(this.data.length=2*(this.length+b.length));for(var d=0;d<b.length;d++)this.pushNoDuplicate((b.data||b)[d]);}},e.prototype.indexOf=function(b){b=this.data.indexOf(b);return b>=this.length?-1:b;},e._GlobalId=0,e);b.SmartArray=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(){this._count=0;y4tt.q9();this._data={};};g=(g.prototype.get=function(b){b=this._data[b];return void 0!==b?b:void 0;},g.prototype.getOrAddWithFactory=function(b,c){var d;d=this.get(b);return void 0!==d?d:(d=c(b),d&&this.add(b,d),d);},g.prototype.getOrAdd=function(b,c){var d;d=this.get(b);return void 0!==d?d:(this.add(b,c),c);},g.prototype.contains=function(b){y4tt.v9();return void 0!==this._data[b];},g.prototype.add=function(b,c){return void 0!==this._data[b]?!1:(this._data[b]=c,++this._count,!0);},g.prototype.set=function(b,c){y4tt.v9();return void 0===this._data[b]?!1:(this._data[b]=c,!0);},g.prototype.remove=function(b){return this.contains(b)?(delete this._data[b],--this._count,!0):!1;},g.prototype.clear=function(){y4tt.v9();this._data={};this._count=0;},Object.defineProperty(g.prototype,"count",{get:function(){y4tt.q9();return this._count;},enumerable:!0,configurable:!0}),g.prototype.forEach=function(b){for(var c in this._data)b(c,this._data[c]);},g.prototype.first=function(b){var d;for(var c in this._data){d=b(c,this._data[c]);if(d)return d;}return null;},g);y4tt.q9();b.StringDictionary=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f;e=function(c,d){return c?c instanceof b.Mesh?null:c instanceof b.SubMesh?c.clone(d):c.clone?c.clone():null:null;},d=function(){};c=(d.Instantiate=function(b){b=b.split(7800!=(9238,1520)?".":0x1ea);for(var c=window||this,d=0,f=b.length;f>d;d++)c=c[b[d]];y4tt.q9();return"function"!=typeof c?null:c;},d.SetImmediate=function(b){window.setImmediate?window.setImmediate(b):setTimeout(b,1);},d.IsExponentOfTwo=function(b){var c;c=1;do c*=2;while(b>c);return c===b;},d.GetExponentOfTwo=function(b,c){var d;d=1;do d*=2;while(b>d);y4tt.v9();return d>c&&(d=c),d;},d.GetFilename=function(b){var c;c=b.lastIndexOf("/");return 0>c?b:b.substring(c+1);},d.GetDOMTextContent=function(b){var c;c="";for(b=b.firstChild;b;)3===b.nodeType&&(c+=b.textContent),b=b.nextSibling;return c;},d.ToDegrees=function(b){y4tt.v9();return 180*b/Math.PI;},d.ToRadians=function(b){return b*Math.PI/180;},d.EncodeArrayBufferTobase64=function(b){for(var c,d,f,e,p,g="",s=0,t=new Uint8Array(b);s<t.length;)c=t[s++],b=s<t.length?t[s++]:Number.NaN,d=s<t.length?t[s++]:Number.NaN,f=c>>2,c=(3&c)<<4|b>>4,e=(15&b)<<2|d>>6,p=63&d,isNaN(b)?e=p=64:isNaN(d)&&(p=64),g+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p);return"data:image/png;base64,"+g;},d.ExtractMinAndMaxIndexed=function(c,d,f,e,m){void 0===m&&(m=null);for(var p=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),g=new b.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=f;f+e>s;s++)var t=new b.Vector3(c[3*d[s]],c[3*d[s]+1],c[3*d[s]+2]),p=b.Vector3.Minimize(t,p),g=b.Vector3.Maximize(t,g);return m&&(p.x-=p.x*m.x+m.y,p.y-=p.y*m.x+m.y,p.z-=p.z*m.x+m.y,g.x+=g.x*m.x+m.y,g.y+=g.y*m.x+m.y,g.z+=g.z*m.x+m.y),{minimum:p,maximum:g};},d.ExtractMinAndMax=function(c,d,f,e,m){var p,g;void 0===e&&(e=null);p=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),g=new b.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);m||(m=3);for(var s=d;d+f>s;s++)var t=new b.Vector3(c[s*m],c[s*m+1],c[s*m+2]),p=b.Vector3.Minimize(t,p),g=b.Vector3.Maximize(t,g);return e&&(p.x-=p.x*e.x+e.y,p.y-=p.y*e.x+e.y,p.z-=p.z*e.x+e.y,g.x+=g.x*e.x+e.y,g.y+=g.y*e.x+e.y,g.z+=g.z*e.x+e.y),{minimum:p,maximum:g};},d.Vector2ArrayFeeder=function(c){y4tt.v9();return function(d){var f;f=void 0!==c.BYTES_PER_ELEMENT;y4tt.v9();return d>=(f?c.length/2:c.length)?null:f?new b.Vector2(c[2*d+0],c[2*d+1]):c[d];};},d.ExtractMinAndMaxVector2=function(c,d){void 0===d&&(d=null);for(var f=new b.Vector2(Number.MAX_VALUE,Number.MAX_VALUE),e=new b.Vector2(-Number.MAX_VALUE,-Number.MAX_VALUE),m=0,p=c(m++);p;)f=b.Vector2.Minimize(p,f),e=b.Vector2.Maximize(p,e),p=c(m++);return d&&(f.x-=f.x*d.x+d.y,f.y-=f.y*d.x+d.y,e.x+=e.x*d.x+d.y,e.y+=e.y*d.x+d.y),{minimum:f,maximum:e};},d.MakeArray=function(b,c){y4tt.q9();return!0===c||void 0!==b&&null!=b?Array.isArray(b)?b:[b]:void 0;},d.GetPointerPrefix=function(){return"pointer";},d.QueueNewFrame=function(b){y4tt.q9();window.requestAnimationFrame?window.requestAnimationFrame(b):window.msRequestAnimationFrame?window.msRequestAnimationFrame(b):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(b):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(b):window.oRequestAnimationFrame?window.oRequestAnimationFrame(b):window.setTimeout(b,16);},d.RequestFullscreen=function(b,c){var d;d=b.requestFullscreen||b.msRequestFullscreen||b.webkitRequestFullscreen||b.mozRequestFullScreen;d&&d.call(b,c);},d.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen();},d.CleanUrl=function(b){return b.replace(/#/gm,"%23");},d.LoadImage=function(c,f,l,e){var m,p,g,s,t;c instanceof ArrayBuffer&&(c=d.EncodeArrayBufferTobase64(c));c=d.CleanUrl(c);m=new Image();if("data:"!==c.substr(0,5)&&d.CorsBehavior)switch(typeof d.CorsBehavior){case"function":p=d.CorsBehavior(c);p&&(m.crossOrigin=p);break;default:m.crossOrigin=d.CorsBehavior;}m.onload=function(){f(m);};m.onerror=function(){d.Error("Error while trying to load texture: "+c);d.UseFallbackTexture?(m.src="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",f(m)):l();};p=function(){m.src=c;},g=function(){e.loadImageFromDB(c,m);};if("data:"!==c.substr(0,5)&&e&&e.enableTexturesOffline&&b.Database.IsUASupportingBlobStorage)e.openAsync(g,p);else if(-1===c.indexOf("file:"))p();else try{t=c.substring(5).toLowerCase();try{s=URL.createObjectURL(b.FilesInput.FilesTextures[t],{oneTimeOnly:!0});}catch(v){s=URL.createObjectURL(b.FilesInput.FilesTextures[t]);}m.src=s;}catch(y){m.src=null;}return m;},d.LoadFile=function(c,f,l,e,m,p){var g,s;y4tt.v9();c=d.CleanUrl(c);g=function(){var b,e;b=new XMLHttpRequest(),e=d.BaseUrl+c;b.open("GET",e,!0);m&&(b.responseType="arraybuffer");b.onprogress=l;b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status||d.ValidateXHRData(b,m?6:1))f(m?b.response:b.responseText);else{if(!p)throw Error("Error status: "+b.status+" - Unable to load "+e);p();}};b.send(null);},s=function(){e.loadFileFromDB(c,f,l,g,m);};-1!==c.indexOf("file:")?(s=c.substring(5).toLowerCase(),d.ReadFile(b.FilesInput.FilesToLoad[s],f,l,m)):e&&e.enableSceneOffline?e.openAsync(s,g):g();},d.ReadFileAsDataURL=function(b,c,d){var f;f=new FileReader();y4tt.v9();f.onload=function(b){c(b.target.result);};f.onprogress=d;f.readAsDataURL(b);},d.ReadFile=function(b,c,f,e){var m;m=new FileReader();m.onerror=function(){d.Log("Error while reading file: "+b.name);c(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}));};m.onload=function(b){y4tt.v9();c(b.target.result);};m.onprogress=f;e?m.readAsArrayBuffer(b):m.readAsText(b);},d.FileAsURL=function(b){b=new Blob([b]);return(window.URL||window.webkitURL).createObjectURL(b);},d.Format=function(b,c){y4tt.v9();return void 0===c&&(c=2),b.toFixed(c);},d.CheckExtends=function(b,c,d){b.x<c.x&&(c.x=b.x);b.y<c.y&&(c.y=b.y);b.z<c.z&&(c.z=b.z);b.x>d.x&&(d.x=b.x);b.y>d.y&&(d.y=b.y);y4tt.q9();b.z>d.z&&(d.z=b.z);},d.DeepCopy=function(b,c,d,f){var p,g,s;y4tt.q9();for(var m in b)if(("_"!==m[0]||f&&-1!==f.indexOf(m))&&(!d||-1===d.indexOf(m))){p=b[m],g=typeof p;if("function"!==g)if("object"===g)if(p instanceof Array){if(c[m]=[],0<p.length)if("object"==typeof p[0])for(g=0;g<p.length;g++){s=e(p[g],c);-1===c[m].indexOf(s)&&c[m].push(s);}else c[m]=p.slice(0);}else c[m]=e(p,c);else c[m]=p;}},d.IsEmpty=function(b){y4tt.v9();for(var c in b)return!1;return!0;},d.RegisterTopRootEvents=function(b){var d;y4tt.v9();for(var c=0;c<b.length;c++){d=b[c];window.addEventListener(d.name,d.handler,!1);try{window.parent&&window.parent.addEventListener(d.name,d.handler,!1);}catch(f){}}},d.UnregisterTopRootEvents=function(b){var d;for(var c=0;c<b.length;c++){d=b[c];window.removeEventListener(d.name,d.handler);try{window.parent&&window.parent.removeEventListener(d.name,d.handler);}catch(f){}}},d.DumpFramebuffer=function(b,c,d,f){var e,p,t,v,y,x;e=4*b,p=c/2;d=d.readPixels(0,0,b,c);for(var r=0;p>r;r++)for(var s=0;e>s;s++){t=s+r*e,v=s+(c-r-1)*e,y=d[t];d[t]=d[v];d[v]=y;}g||(g=document.createElement("canvas"));g.width=b;g.height=c;e=g.getContext("2d");b=e.createImageData(b,c);b.data.set(d);e.putImageData(b,0,0);b=g.toDataURL();if(f)f(b);else if("download"in document.createElement("a")){x=window.document.createElement("a");x.href=b;f=new Date();f=(f.getFullYear()+"-"+(f.getMonth()+1)).slice(-2)+"-"+f.getDate()+"_"+f.getHours()+"-"+("0"+f.getMinutes()).slice(-2);x.setAttribute("download","screenshot_"+f+".png");window.document.body.appendChild(x);x.addEventListener("click",function(){y4tt.q9();x.parentElement.removeChild(x);});x.click();}else f=window.open(""),c=f.document.createElement("img"),c.src=b,f.document.body.appendChild(c);},d.CreateScreenshot=function(c,f,l,e){var m,p,g,s;if(l.precision)m=Math.round(c.getRenderWidth()*l.precision),p=Math.round(m/c.getAspectRatio(f)),l={width:m,height:p};else if(l.width&&l.height)m=l.width,p=l.height;else if(l.width&&!l.height)m=l.width,p=Math.round(m/c.getAspectRatio(f)),l={width:m,height:p};else if(l.height&&!l.width)p=l.height,m=Math.round(p*c.getAspectRatio(f)),l={width:m,height:p};else{if(isNaN(l))return void d.Error("Invalid 'size' parameter !");m=p=l;}g=f.getScene(),s=null;g.activeCamera!==f&&(s=g.activeCamera,g.activeCamera=f);l=new b.RenderTargetTexture("screenShot",l,g,!1,!1);y4tt.v9();l.renderList=g.meshes;l.onAfterRenderObservable.add(function(){d.DumpFramebuffer(m,p,c,e);});g.incrementRenderId();g.resetCachedMaterial();l.render(!0);l.dispose();s&&(g.activeCamera=s);f.getProjectionMatrix(!0);},d.ValidateXHRData=function(c,d){var f,e;void 0===d&&(d=7);try{if(1&d){if(c.responseText&&0<c.responseText.length)return!0;if(1===d)return!1;}if(2&d){f=b.Internals.TGATools.GetTGAHeader(c.response);if(f.width&&f.height&&0<f.width&&0<f.height)return!0;if(2===d)return!1;}if(4&d){e=new Uint8Array(c.response,0,3);return 68===e[0]&&68===e[1]&&83===e[2];}}catch(m){}return!1;},Object.defineProperty(d,"NoneLogLevel",{get:function(){y4tt.q9();return d._NoneLogLevel;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"MessageLogLevel",{get:function(){y4tt.q9();return d._MessageLogLevel;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"WarningLogLevel",{get:function(){return d._WarningLogLevel;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ErrorLogLevel",{get:function(){return d._ErrorLogLevel;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"AllLogLevel",{get:function(){y4tt.v9();return d._MessageLogLevel|d._WarningLogLevel|d._ErrorLogLevel;},enumerable:!0,configurable:!0}),d._AddLogEntry=function(b){y4tt.q9();d._LogCache=b+d._LogCache;d.OnNewCacheEntry&&d.OnNewCacheEntry(b);},d._FormatMessage=function(b){var c,d;c=function(b){y4tt.q9();return 10>b?"0"+b:""+b;},d=new Date();return"["+c(d.getHours())+":"+c(d.getMinutes())+((1553,1891)!=(6790,3670)?":":"V")+c(d.getSeconds())+"]: "+b;},d._LogDisabled=function(){},d._LogEnabled=function(b){y4tt.v9();b=d._FormatMessage(b);console.log("BJS - "+b);d._AddLogEntry("<div style='color:white'>"+b+"</div><br>");},d._WarnDisabled=function(){},d._WarnEnabled=function(b){b=d._FormatMessage(b);console.warn("BJS - "+b);y4tt.v9();d._AddLogEntry("<div style='color:orange'>"+b+"</div><br>");},d._ErrorDisabled=function(){},d._ErrorEnabled=function(b){d.errorsCount++;b=d._FormatMessage(b);y4tt.v9();console.error("BJS - "+b);d._AddLogEntry("<div style='color:red'>"+b+"</div><br>");},Object.defineProperty(d,"LogCache",{get:function(){y4tt.q9();return d._LogCache;},enumerable:!0,configurable:!0}),d.ClearLogCache=function(){d._LogCache="";y4tt.q9();d.errorsCount=0;},Object.defineProperty(d,"LogLevels",{set:function(b){(b&d.MessageLogLevel)===d.MessageLogLevel?d.Log=d._LogEnabled:d.Log=d._LogDisabled;(b&d.WarningLogLevel)===d.WarningLogLevel?d.Warn=d._WarnEnabled:d.Warn=d._WarnDisabled;y4tt.v9();(b&d.ErrorLogLevel)===d.ErrorLogLevel?d.Error=d._ErrorEnabled:d.Error=d._ErrorDisabled;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"PerformanceNoneLogLevel",{get:function(){y4tt.v9();return d._PerformanceNoneLogLevel;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"PerformanceUserMarkLogLevel",{get:function(){return d._PerformanceUserMarkLogLevel;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"PerformanceConsoleLogLevel",{get:function(){y4tt.v9();return d._PerformanceConsoleLogLevel;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"PerformanceLogLevel",{set:function(b){return(b&d.PerformanceUserMarkLogLevel)===d.PerformanceUserMarkLogLevel?(d.StartPerformanceCounter=d._StartUserMark,void(d.EndPerformanceCounter=d._EndUserMark)):(b&d.PerformanceConsoleLogLevel)===d.PerformanceConsoleLogLevel?(d.StartPerformanceCounter=d._StartPerformanceConsole,void(d.EndPerformanceCounter=d._EndPerformanceConsole)):(d.StartPerformanceCounter=d._StartPerformanceCounterDisabled,void(d.EndPerformanceCounter=d._EndPerformanceCounterDisabled));},enumerable:!0,configurable:!0}),d._StartPerformanceCounterDisabled=function(){},d._EndPerformanceCounterDisabled=function(){},d._StartUserMark=function(b,c){void 0===c&&(c=!0);c&&d._performance.mark&&d._performance.mark(b+"-Begin");},d._EndUserMark=function(b,c){void 0===c&&(c=!0);y4tt.q9();c&&d._performance.mark&&(d._performance.mark(b+"-End"),d._performance.measure(b,b+"-Begin",b+"-End"));},d._StartPerformanceConsole=function(b,c){void 0===c&&(c=!0);c&&(d._StartUserMark(b,c),console.time&&console.time(b));},d._EndPerformanceConsole=function(b,c){void 0===c&&(c=!0);y4tt.q9();c&&(d._EndUserMark(b,c),console.time&&console.timeEnd(b));},Object.defineProperty(d,"Now",{get:function(){y4tt.q9();return window.performance&&window.performance.now?window.performance.now():new Date().getTime();},enumerable:!0,configurable:!0}),d.getClassName=function(b,c){var d;void 0===c&&(c=!1);d=null;!c&&b.getClassName?d=b.getClassName():(b instanceof Object&&(d=(c?b:Object.getPrototypeOf(b)).constructor.__bjsclassName__),d||(d=typeof b));return d;},d.first=function(b,c){var f;y4tt.q9();for(var d=0;d<b.length;d++){f=b[d];if(c(f))return f;}},d.arrayOrStringFeeder=function(b){y4tt.q9();return function(c){if(c>=b.length)return null;c=b.charCodeAt?b.charCodeAt(c):b[c];return c&&c.getHashCode&&(c=c.getHashCode()),"string"==typeof c?d.hashCodeFromStream(d.arrayOrStringFeeder(c)):c;};},d.hashCodeFromStream=function(b){for(var c=0,d=0,f=b(d++);null!=f;)c=(c<<5)-c+f,c|=0,f=b(d++);return c;},d.BaseUrl="",d.CorsBehavior="anonymous",d.UseFallbackTexture=!0,d._NoneLogLevel=0,d._MessageLogLevel=1,d._WarningLogLevel=2,d._ErrorLogLevel=4,d._LogCache="",d.errorsCount=0,d.Log=d._LogEnabled,d.Warn=d._WarnEnabled,d.Error=d._ErrorEnabled,d._PerformanceNoneLogLevel=0,d._PerformanceUserMarkLogLevel=1,d._PerformanceConsoleLogLevel=2,d._performance=window.performance,d.StartPerformanceCounter=d._StartPerformanceCounterDisabled,d.EndPerformanceCounter=d._EndPerformanceCounterDisabled,d);b.Tools=c;b.className=function(b){return function(c){c.__bjsclassName__=b;};};f=function(b,c,d,f){y4tt.v9();void 0===f&&(f=0);this.iterations=b;this._fn=c;this._successCallback=d;this.index=f-1;this._done=!1;};c=(f.prototype.executeNext=function(){y4tt.v9();this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop());},f.prototype.breakLoop=function(){y4tt.v9();this._done=!0;this._successCallback();},f.Run=function(b,c,d,e){void 0===e&&(e=0);b=new f(b,c,d,e);return b.executeNext(),b;},f.SyncAsyncForLoop=function(b,c,d,e,m,p){void 0===p&&(p=0);y4tt.v9();f.Run(Math.ceil(b/c),function(f){y4tt.q9();m&&m()?f.breakLoop():setTimeout(function(){var n;for(var e=0;c>e;++e){n=f.index*c+e;if(n>=b)break;if(d(n),m&&m()){f.breakLoop();break;}}y4tt.q9();f.executeNext();},p);},e);},f);b.AsyncLoop=c;}(BABYLON||(BABYLON={}));!function(b){var g;b=b.Internals||(b.Internals={});g=function(){this._alphaBlend=this._isBlendFunctionParametersDirty=this._isAlphaBlendDirty=!1;y4tt.v9();this._blendFunctionParameters=Array(4);};g=(Object.defineProperty(g.prototype,"isDirty",{get:function(){y4tt.v9();return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"alphaBlend",{get:function(){y4tt.v9();return this._alphaBlend;},set:function(b){y4tt.v9();this._alphaBlend!==b&&(this._alphaBlend=b,this._isAlphaBlendDirty=!0);},enumerable:!0,configurable:!0}),g.prototype.setAlphaBlendFunctionParameters=function(b,c,d,f){this._blendFunctionParameters[0]===b&&this._blendFunctionParameters[1]===c&&this._blendFunctionParameters[2]===d&&this._blendFunctionParameters[3]===f||(this._blendFunctionParameters[0]=b,this._blendFunctionParameters[1]=c,this._blendFunctionParameters[2]=d,this._blendFunctionParameters[3]=f,this._isBlendFunctionParametersDirty=!0);},g.prototype.reset=function(){this._alphaBlend=!1;y4tt.q9();this._blendFunctionParameters[0]=null;this._blendFunctionParameters[1]=null;this._blendFunctionParameters[2]=null;this._blendFunctionParameters[3]=null;this._isAlphaBlendDirty=!0;this._isBlendFunctionParametersDirty=!1;},g.prototype.apply=function(b){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?b.enable(b.BLEND):b.disable(b.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(b.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1));},g);y4tt.q9();b._AlphaState=g;!0;}(BABYLON||(BABYLON={}));!function(b){var g;b=b.Internals||(b.Internals={});g=function(){y4tt.q9();this._isZOffsetDirty=this._isCullDirty=this._isCullFaceDirty=this._isDepthFuncDirty=this._isDepthMaskDirty=this._isDepthTestDirty=!1;};g=(Object.defineProperty(g.prototype,"isDirty",{get:function(){y4tt.q9();return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"zOffset",{get:function(){return this._zOffset;},set:function(b){this._zOffset!==b&&(this._zOffset=b,this._isZOffsetDirty=!0);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"cullFace",{get:function(){y4tt.q9();return this._cullFace;},set:function(b){y4tt.q9();this._cullFace!==b&&(this._cullFace=b,this._isCullFaceDirty=!0);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"cull",{get:function(){y4tt.q9();return this._cull;},set:function(b){y4tt.q9();this._cull!==b&&(this._cull=b,this._isCullDirty=!0);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"depthFunc",{get:function(){y4tt.v9();return this._depthFunc;},set:function(b){y4tt.v9();this._depthFunc!==b&&(this._depthFunc=b,this._isDepthFuncDirty=!0);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"depthMask",{get:function(){y4tt.q9();return this._depthMask;},set:function(b){this._depthMask!==b&&(this._depthMask=b,this._isDepthMaskDirty=!0);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"depthTest",{get:function(){y4tt.v9();return this._depthTest;},set:function(b){y4tt.v9();this._depthTest!==b&&(this._depthTest=b,this._isDepthTestDirty=!0);},enumerable:!0,configurable:!0}),g.prototype.reset=function(){this._depthTest=this._depthMask=!0;this._cull=this._cullFace=this._depthFunc=null;this._zOffset=0;this._isDepthMaskDirty=this._isDepthTestDirty=!0;this._isZOffsetDirty=this._isCullDirty=this._isCullFaceDirty=this._isDepthFuncDirty=!1;},g.prototype.apply=function(b){this.isDirty&&(this._isCullDirty&&(this.cull?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(b.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(b.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(b.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(b.enable(b.POLYGON_OFFSET_FILL),b.polygonOffset(this.zOffset,0)):b.disable(b.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1));},g);b._DepthCullingState=g;!0;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j,l;g=function(b,c,d,f){d=b.createShader("vertex"===d?b.VERTEX_SHADER:b.FRAGMENT_SHADER);if(b.shaderSource(d,(f?f+"\n":"")+c),b.compileShader(d),!b.getShaderParameter(d,b.COMPILE_STATUS))throw Error(b.getShaderInfoLog(d));return d;},e=function(b,c){var d;d=b.UNSIGNED_BYTE;return c===j.TEXTURETYPE_FLOAT&&(d=b.FLOAT),d;},c=function(c,d,f){var l,j;l=f.NEAREST,j=f.NEAREST;return c===b.Texture.BILINEAR_SAMPLINGMODE?(l=f.LINEAR,j=d?f.LINEAR_MIPMAP_NEAREST:f.LINEAR):c===b.Texture.TRILINEAR_SAMPLINGMODE?(l=f.LINEAR,j=d?f.LINEAR_MIPMAP_LINEAR:f.LINEAR):c===b.Texture.NEAREST_SAMPLINGMODE&&(l=f.NEAREST,j=d?f.NEAREST_MIPMAP_LINEAR:f.NEAREST),{min:j,mag:l};},d=function(d,f,l,j,e,q,g,y,x,z,B){var A,C,G;void 0===B&&(B=b.Texture.TRILINEAR_SAMPLINGMODE);A=l.getEngine(),C=b.Tools.GetExponentOfTwo(j,A.getCaps().maxTextureSize),G=b.Tools.GetExponentOfTwo(e,A.getCaps().maxTextureSize);f.bindTexture(f.TEXTURE_2D,d);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,void 0===q?1:q?1:0);d._baseWidth=j;d._baseHeight=e;d._width=C;d._height=G;d.isReady=!0;x(C,G);j=c(B,!g,f);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,j.mag);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,j.min);g||y||f.generateMipmap(f.TEXTURE_2D);f.bindTexture(f.TEXTURE_2D,null);y4tt.q9();A.resetTextureCache();l._removePendingData(d);z&&z();},f=function(c,d,f,l,j){var e;e=b.Tools.LoadImage(c,function(){y4tt.q9();f[d]=e;f._internalCount++;l._removePendingData(e);6===f._internalCount&&j(f);},function(){y4tt.v9();l._removePendingData(e);},l.database);l._addPendingData(e);};b.InstancingAttributeInfo=function(){};q=function(){};b.EngineCapabilities=q;l=function(c,d,f,j){var e;e=this;if(void 0===j&&(j=!0),this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.enableOfflineSupport=!0,this.scenes=[],this._windowIsBackground=!1,this._webGLVersion="1.0",this._drawCalls=0,this._renderingQueueLaunched=!1,this._activeRenderLoops=[],this.fpsRange=60,this.previousFramesDuration=[],this.fps=60,this.deltaTime=0,this._depthCullingState=new b.Internals._DepthCullingState(),this._alphaState=new b.Internals._AlphaState(),this._alphaMode=l.ALPHA_DISABLE,this._loadedTexturesCache=[],this._maxTextureChannels=16,this._activeTexturesCache=Array(this._maxTextureChannels),this._compiledEffects={},this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=[],this._currentInstanceLocations=[],this._currentInstanceBuffers=[],this._renderingCanvas=c,this._externalData=new b.StringDictionary(),f=f||{},f.antialias=d,void 0===f.preserveDrawingBuffer&&(f.preserveDrawingBuffer=!1),!this._gl)try{this._gl=c.getContext("webgl",f)||c.getContext("experimental-webgl",f);}catch(g){throw Error("WebGL not supported");}if(!this._gl)throw Error("WebGL not supported");this._onBlur=function(){e._windowIsBackground=!0;};this._onFocus=function(){y4tt.v9();e._windowIsBackground=!1;};window.addEventListener("blur",this._onBlur);window.addEventListener("focus",this._onFocus);d=f.limitDeviceRatio||window.devicePixelRatio||1;this._hardwareScalingLevel=j?1/Math.min(d,window.devicePixelRatio||1):1;this.resize();this._caps=new q();this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS);this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE);this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE);this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE);this._glVersion=this._gl.getParameter(this._gl.VERSION);j=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=j&&(this._glRenderer=this._gl.getParameter(j.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(j.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._caps.standardDerivatives=null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc"),this._caps.textureFloat=null!==this._gl.getExtension("OES_texture_float"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.instancedArrays=this._gl.getExtension("ANGLE_instanced_arrays"),this._caps.uintIndices=null!==this._gl.getExtension("OES_element_index_uint"),this._caps.fragmentDepthSupported=null!==this._gl.getExtension("EXT_frag_depth"),this._caps.highPrecisionShaderSupported=!0,this._caps.drawBuffersExtension=this._gl.getExtension("WEBGL_draw_buffers"),this._caps.textureFloatLinearFiltering=this._gl.getExtension("OES_texture_float_linear"),this._caps.textureLOD=this._gl.getExtension("EXT_shader_texture_lod"),this._gl.getShaderPrecisionFormat)j=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT),this._caps.highPrecisionShaderSupported=0!==j.precision;this.setDepthBuffer(!0);this.setDepthFunctionToLessOrEqual();this.setDepthWrite(!0);this._onFullscreenChange=function(){void 0!==document.fullscreen?e.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?e.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?e.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(e.isFullscreen=document.msIsFullScreen);e.isFullscreen&&e._pointerLockRequested&&(c.requestPointerLock=c.requestPointerLock||c.msRequestPointerLock||c.mozRequestPointerLock||c.webkitRequestPointerLock,c.requestPointerLock&&c.requestPointerLock());};document.addEventListener("fullscreenchange",this._onFullscreenChange,!1);document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1);document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1);document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1);this._onPointerLockChange=function(){y4tt.q9();e.isPointerLock=document.mozPointerLockElement===c||document.webkitPointerLockElement===c||document.msPointerLockElement===c||document.pointerLockElement===c;};document.addEventListener("pointerlockchange",this._onPointerLockChange,!1);document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1);document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1);document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1);b.AudioEngine&&!l.audioEngine&&(l.audioEngine=new b.AudioEngine());this._loadingScreen=new b.DefaultLoadingScreen(this._renderingCanvas);b.Tools.Log("Babylon.js engine (v"+l.Version+") launched");};j=(Object.defineProperty(l,"ALPHA_DISABLE",{get:function(){return l._ALPHA_DISABLE;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"ALPHA_ONEONE",{get:function(){return l._ALPHA_ONEONE;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"ALPHA_ADD",{get:function(){return l._ALPHA_ADD;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"ALPHA_COMBINE",{get:function(){return l._ALPHA_COMBINE;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"ALPHA_SUBTRACT",{get:function(){y4tt.q9();return l._ALPHA_SUBTRACT;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"ALPHA_MULTIPLY",{get:function(){return l._ALPHA_MULTIPLY;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"ALPHA_MAXIMIZED",{get:function(){y4tt.q9();return l._ALPHA_MAXIMIZED;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"DELAYLOADSTATE_NONE",{get:function(){return l._DELAYLOADSTATE_NONE;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"DELAYLOADSTATE_LOADED",{get:function(){y4tt.q9();return l._DELAYLOADSTATE_LOADED;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"DELAYLOADSTATE_LOADING",{get:function(){y4tt.v9();return l._DELAYLOADSTATE_LOADING;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"DELAYLOADSTATE_NOTLOADED",{get:function(){return l._DELAYLOADSTATE_NOTLOADED;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"TEXTUREFORMAT_ALPHA",{get:function(){return l._TEXTUREFORMAT_ALPHA;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"TEXTUREFORMAT_LUMINANCE",{get:function(){return l._TEXTUREFORMAT_LUMINANCE;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"TEXTUREFORMAT_LUMINANCE_ALPHA",{get:function(){y4tt.q9();return l._TEXTUREFORMAT_LUMINANCE_ALPHA;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"TEXTUREFORMAT_RGB",{get:function(){return l._TEXTUREFORMAT_RGB;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"TEXTUREFORMAT_RGBA",{get:function(){y4tt.q9();return l._TEXTUREFORMAT_RGBA;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"TEXTURETYPE_UNSIGNED_INT",{get:function(){return l._TEXTURETYPE_UNSIGNED_INT;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"TEXTURETYPE_FLOAT",{get:function(){return l._TEXTURETYPE_FLOAT;},enumerable:!0,configurable:!0}),Object.defineProperty(l,"Version",{get:function(){return"2.4.0";},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"webGLVersion",{get:function(){y4tt.q9();return this._webGLVersion;},enumerable:!0,configurable:!0}),l.prototype._prepareWorkingCanvas=function(){this._workingCanvas||(this._workingCanvas=document.createElement("canvas"),this._workingContext=this._workingCanvas.getContext("2d"));},l.prototype.resetTextureCache=function(){for(var b=0;b<this._maxTextureChannels;b++)this._activeTexturesCache[b]=null;},l.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion};},l.prototype.getAspectRatio=function(b,c){var d;y4tt.v9();void 0===c&&(c=!1);d=b.viewport;return this.getRenderWidth(c)*d.width/(this.getRenderHeight(c)*d.height);},l.prototype.getRenderWidth=function(b){return void 0===b&&(b=!1),!b&&this._currentRenderTarget?this._currentRenderTarget._width:this._renderingCanvas.width;},l.prototype.getRenderHeight=function(b){return void 0===b&&(b=!1),!b&&this._currentRenderTarget?this._currentRenderTarget._height:this._renderingCanvas.height;},l.prototype.getRenderingCanvas=function(){y4tt.q9();return this._renderingCanvas;},l.prototype.getRenderingCanvasClientRect=function(){y4tt.v9();return this._renderingCanvas.getBoundingClientRect();},l.prototype.setHardwareScalingLevel=function(b){this._hardwareScalingLevel=b;this.resize();},l.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel;},l.prototype.getLoadedTexturesCache=function(){return this._loadedTexturesCache;},l.prototype.getCaps=function(){y4tt.q9();return this._caps;},Object.defineProperty(l.prototype,"drawCalls",{get:function(){y4tt.v9();return this._drawCalls;},enumerable:!0,configurable:!0}),l.prototype.resetDrawCalls=function(){this._drawCalls=0;},l.prototype.getDepthFunction=function(){y4tt.v9();return this._depthCullingState.depthFunc;},l.prototype.setDepthFunction=function(b){y4tt.q9();this._depthCullingState.depthFunc=b;},l.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER;},l.prototype.setDepthFunctionToGreaterOrEqual=function(){y4tt.v9();this._depthCullingState.depthFunc=this._gl.GEQUAL;},l.prototype.setDepthFunctionToLess=function(){y4tt.q9();this._depthCullingState.depthFunc=this._gl.LESS;},l.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL;},l.prototype.stopRenderLoop=function(b){if(!b)return void(this._activeRenderLoops=[]);b=this._activeRenderLoops.indexOf(b);0<=b&&this._activeRenderLoops.splice(b,1);},l.prototype._renderLoop=function(){this.beginFrame();for(var c=0;c<this._activeRenderLoops.length;c++)(0,this._activeRenderLoops[c])();this.endFrame();0<this._activeRenderLoops.length?b.Tools.QueueNewFrame(this._bindedRenderFunction):this._renderingQueueLaunched=!1;},l.prototype.runRenderLoop=function(c){-1===this._activeRenderLoops.indexOf(c)&&(this._activeRenderLoops.push(c),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=this._renderLoop.bind(this),b.Tools.QueueNewFrame(this._bindedRenderFunction)));},l.prototype.switchFullscreen=function(c,d){this.isFullscreen?b.Tools.ExitFullscreen():(this._pointerLockRequested=c,b.Tools.RequestFullscreen(this._renderingCanvas,d));},l.prototype.clear=function(b,c,d){this.applyStates();c&&this._gl.clearColor(b.r,b.g,b.b,void 0!==b.a?b.a:1);d&&this._depthCullingState.depthMask&&this._gl.clearDepth(1);b=0;y4tt.q9();c&&(b|=this._gl.COLOR_BUFFER_BIT);d&&this._depthCullingState.depthMask&&(b|=this._gl.DEPTH_BUFFER_BIT);this._gl.clear(b);},l.prototype.scissorClear=function(b,c,d,f,l){var j,e,q;j=this._gl,e=j.getParameter(j.SCISSOR_TEST),q=j.getParameter(j.SCISSOR_BOX);j.enable(j.SCISSOR_TEST);j.scissor(b,c,d,f);this.clear(l,!0,!0);j.scissor(q[0],q[1],q[2],q[3]);!0===e?j.enable(j.SCISSOR_TEST):j.disable(j.SCISSOR_TEST);},l.prototype.setViewport=function(b,c,d){var f,l;c=c||(navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.width);d=d||(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.height);f=b.x||0,l=b.y||0;this._cachedViewport=b;this._gl.viewport(f*c,l*d,c*b.width,d*b.height);},l.prototype.setDirectViewport=function(b,c,d,f){var l;l=this._cachedViewport;return this._cachedViewport=null,this._gl.viewport(b,c,d,f),l;},l.prototype.beginFrame=function(){this._measureFps();},l.prototype.endFrame=function(){},l.prototype.resize=function(){var c;this.setSize((navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.clientWidth)/this._hardwareScalingLevel,(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.clientHeight)/this._hardwareScalingLevel);for(var b=0;b<this.scenes.length;b++){c=this.scenes[b];c.debugLayer.isVisible()&&c.debugLayer._syncPositions();}},l.prototype.setSize=function(b,c){this._renderingCanvas.width=b;this._renderingCanvas.height=c;for(var d=0;d<this.scenes.length;d++)for(var f=this.scenes[d],l=0;l<f.cameras.length;l++)f.cameras[l]._currentRenderId=0;},l.prototype.bindFramebuffer=function(b,c,d,f){var l;this._currentRenderTarget=b;l=this._gl;l.bindFramebuffer(l.FRAMEBUFFER,b._framebuffer);b.isCube?l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_CUBE_MAP_POSITIVE_X+c,b,0):l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,b,0);this._gl.viewport(0,0,d||b._width,f||b._height);this.wipeCaches();},l.prototype.unBindFramebuffer=function(b,c){var d;if(void 0===c&&(c=!1),this._currentRenderTarget=null,b.generateMipMaps&&!c){d=this._gl;d.bindTexture(d.TEXTURE_2D,b);d.generateMipmap(d.TEXTURE_2D);d.bindTexture(d.TEXTURE_2D,null);}y4tt.v9();this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null);},l.prototype.generateMipMapsForCubemap=function(b){var c;if(b.generateMipMaps){c=this._gl;c.bindTexture(c.TEXTURE_CUBE_MAP,b);c.generateMipmap(c.TEXTURE_CUBE_MAP);c.bindTexture(c.TEXTURE_CUBE_MAP,null);}},l.prototype.flushFramebuffer=function(){this._gl.flush();},l.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget=null;this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null);y4tt.q9();this.setViewport(this._cachedViewport);this.wipeCaches();},l.prototype._resetVertexBufferBinding=function(){this.bindBuffer(null,this._gl.ARRAY_BUFFER);this._cachedVertexBuffers=null;},l.prototype.createVertexBuffer=function(b){var c;y4tt.v9();c=this._gl.createBuffer();return this.bindBuffer(c,this._gl.ARRAY_BUFFER),b instanceof Float32Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,b,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(b),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),c.references=1,c;},l.prototype.createDynamicVertexBuffer=function(b){var c;c=this._gl.createBuffer();y4tt.q9();return this.bindBuffer(c,this._gl.ARRAY_BUFFER),b instanceof Float32Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,b,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(b),this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),c.references=1,c;},l.prototype.updateDynamicVertexBuffer=function(b,c,d,f){this.bindBuffer(b,this._gl.ARRAY_BUFFER);void 0===d&&(d=0);void 0===f?c instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,d,c):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,d,new Float32Array(c)):c instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,c.subarray(d,d+f)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(c).subarray(d,d+f));this._resetVertexBufferBinding();},l.prototype._resetIndexBufferBinding=function(){this.bindBuffer(null,this._gl.ELEMENT_ARRAY_BUFFER);this._cachedIndexBuffer=null;},l.prototype.createIndexBuffer=function(b){var c,d;c=this._gl.createBuffer();this.bindBuffer(c,this._gl.ELEMENT_ARRAY_BUFFER);d=!1;if(this._caps.uintIndices){for(var f=0;f<b.length;f++)if(65535<b[f]){d=!0;break;}b=d?new Uint32Array(b):new Uint16Array(b);}else b=new Uint16Array(b);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,b,this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),c.references=1,c.is32Bits=d,c;},l.prototype.bindArrayBuffer=function(b){this.bindBuffer(b,this._gl.ARRAY_BUFFER);},l.prototype.updateArrayBuffer=function(b){y4tt.q9();this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,b);},l.prototype.bindBuffer=function(b,c){this._currentBoundBuffer[c]!==b&&(this._gl.bindBuffer(c,b),this._currentBoundBuffer[c]=b);},l.prototype.bindBuffersDirectly=function(b,c,d,f,l){var e;y4tt.v9();if(this._cachedVertexBuffers!==b||this._cachedEffectForVertexBuffers!==l){this._cachedVertexBuffers=b;this._cachedEffectForVertexBuffers=l;this.bindBuffer(b,this._gl.ARRAY_BUFFER);for(var j=b=0;j<d.length;j++){e=l.getAttributeLocation(j);0<=e&&this._gl.vertexAttribPointer(e,d[j],this._gl.FLOAT,!1,f,b);b+=4*d[j];}}this._cachedIndexBuffer!==c&&(this._cachedIndexBuffer=c,this.bindBuffer(c,this._gl.ELEMENT_ARRAY_BUFFER),this._uintIndicesCurrentlySet=c.is32Bits);},l.prototype.bindBuffers=function(b,c,d){var j,e,q;if(this._cachedVertexBuffers!==b||this._cachedEffectForVertexBuffers!==d){this._cachedVertexBuffers=b;this._cachedEffectForVertexBuffers=d;for(var f=d.getAttributesNames(),l=0;l<f.length;l++){j=d.getAttributeLocation(l);if(0<=j){e=b[f[l]];if(e){q=e.getBuffer();this.bindBuffer(q,this._gl.ARRAY_BUFFER);this._gl.vertexAttribPointer(j,e.getSize(),this._gl.FLOAT,!1,4*e.getStrideSize(),4*e.getOffset());e.getIsInstanced()&&(this._caps.instancedArrays.vertexAttribDivisorANGLE(j,1),this._currentInstanceLocations.push(j),this._currentInstanceBuffers.push(q));}}}}y4tt.v9();null!=c&&this._cachedIndexBuffer!==c&&(this._cachedIndexBuffer=c,this.bindBuffer(c,this._gl.ELEMENT_ARRAY_BUFFER),this._uintIndicesCurrentlySet=c.is32Bits);},l.prototype.unbindInstanceAttributes=function(){var f;for(var b,c=0,d=this._currentInstanceLocations.length;d>c;c++){f=this._currentInstanceBuffers[c];b!=f&&(b=f,this.bindBuffer(f,this._gl.ARRAY_BUFFER));this._caps.instancedArrays.vertexAttribDivisorANGLE(this._currentInstanceLocations[c],0);}this._currentInstanceBuffers.length=0;y4tt.q9();this._currentInstanceLocations.length=0;},l.prototype._releaseBuffer=function(b){y4tt.q9();return b.references--,0===b.references?(this._gl.deleteBuffer(b),!0):!1;},l.prototype.createInstancesBuffer=function(b){var c;c=this._gl.createBuffer();return c.capacity=b,this.bindBuffer(c,this._gl.ARRAY_BUFFER),this._gl.bufferData(this._gl.ARRAY_BUFFER,b,this._gl.DYNAMIC_DRAW),c;},l.prototype.deleteInstancesBuffer=function(b){this._gl.deleteBuffer(b);},l.prototype.updateAndBindInstancesBuffer=function(b,c,d){var l;y4tt.v9();if(this.bindBuffer(b,this._gl.ARRAY_BUFFER),c&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,c),void 0!==d[0].index){for(var f=c=0;f<d.length;f++){l=d[f];c+=4*l.attributeSize;}for(f=0;f<d.length;f++)l=d[f],this._gl.enableVertexAttribArray(l.index),this._gl.vertexAttribPointer(l.index,l.attributeSize,l.attribyteType||this._gl.FLOAT,l.normalized||!1,c,l.offset),this._caps.instancedArrays.vertexAttribDivisorANGLE(l.index,1),this._currentInstanceLocations.push(l.index),this._currentInstanceBuffers.push(b);}else for(c=0;4>c;c++)f=d[c],this._gl.enableVertexAttribArray(f),this._gl.vertexAttribPointer(f,4,this._gl.FLOAT,!1,64,16*c),this._caps.instancedArrays.vertexAttribDivisorANGLE(f,1),this._currentInstanceLocations.push(f),this._currentInstanceBuffers.push(b);},l.prototype.applyStates=function(){this._depthCullingState.apply(this._gl);this._alphaState.apply(this._gl);},l.prototype.draw=function(b,c,d,f){var l,j;this.applyStates();this._drawCalls++;l=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,j=this._uintIndicesCurrentlySet?4:2;return f?void this._caps.instancedArrays.drawElementsInstancedANGLE(b?this._gl.TRIANGLES:this._gl.LINES,d,l,c*j,f):void this._gl.drawElements(b?this._gl.TRIANGLES:this._gl.LINES,d,l,c*j);},l.prototype.drawPointClouds=function(b,c,d){y4tt.q9();return this.applyStates(),this._drawCalls++,d?void this._caps.instancedArrays.drawArraysInstancedANGLE(this._gl.POINTS,b,c,d):void this._gl.drawArrays(this._gl.POINTS,b,c);},l.prototype.drawUnIndexed=function(b,c,d,f){return this.applyStates(),this._drawCalls++,f?void this._caps.instancedArrays.drawArraysInstancedANGLE(b?this._gl.TRIANGLES:this._gl.LINES,c,d,f):void this._gl.drawArrays(b?this._gl.TRIANGLES:this._gl.LINES,c,d);},l.prototype._releaseEffect=function(b){y4tt.v9();this._compiledEffects[b._key]&&(delete this._compiledEffects[b._key],b.getProgram()&&this._gl.deleteProgram(b.getProgram()));},l.prototype.createEffect=function(c,d,f,l,j,e,q,g,x){var z;z=(c.vertexElement||c.vertex||c)+"+"+(c.fragmentElement||c.fragment||c)+"@"+j;if(this._compiledEffects[z])return this._compiledEffects[z];y4tt.q9();c=new b.Effect(c,d,f,l,this,j,e,q,g,x);return c._key=z,this._compiledEffects[z]=c,c;},l.prototype.createEffectForParticles=function(b,c,d,f,l,j,e){return void 0===c&&(c=[]),void 0===d&&(d=[]),void 0===f&&(f=""),this.createEffect({vertex:"particles",fragmentElement:b},["position","color","options"],["view","projection"].concat(c),["diffuseSampler"].concat(d),f,l,j,e);},l.prototype.createShaderProgram=function(b,c,d){var f;b=g(this._gl,b,"vertex",d);c=g(this._gl,c,"fragment",d);d=this._gl.createProgram();this._gl.attachShader(d,b);this._gl.attachShader(d,c);this._gl.linkProgram(d);if(!this._gl.getProgramParameter(d,this._gl.LINK_STATUS)){f=this._gl.getProgramInfoLog(d);if(f)throw Error(f);}return this._gl.deleteShader(b),this._gl.deleteShader(c),d;},l.prototype.getUniforms=function(b,c){for(var d=[],f=0;f<c.length;f++)d.push(this._gl.getUniformLocation(b,c[f]));return d;},l.prototype.getAttributes=function(b,c){for(var d=[],f=0;f<c.length;f++)try{d.push(this._gl.getAttribLocation(b,c[f]));}catch(l){d.push(-1);}y4tt.v9();return d;},l.prototype.enableEffect=function(b){var c,d,f;if(!b||!b.getAttributesCount()||this._currentEffect===b)return void(b&&b.onBind&&b.onBind(b));this._vertexAttribArraysToUse=this._vertexAttribArraysToUse||[];y4tt.v9();this._vertexAttribArraysEnabled=this._vertexAttribArraysEnabled||[];this._gl.useProgram(b.getProgram());c=0;for(d=this._vertexAttribArraysToUse.length;d>c;c++)this._vertexAttribArraysToUse[c]=!1;d=b.getAttributesCount();for(c=0;d>c;c++){f=b.getAttributeLocation(c);0<=f&&(this._vertexAttribArraysToUse[f]=!0);}c=0;for(d=this._vertexAttribArraysEnabled.length;d>c;c++)c>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArraysEnabled[c]||this._vertexAttribArraysToUse[c]||(this._vertexAttribArraysEnabled[c]=!1,this._gl.disableVertexAttribArray(c));c=0;for(d=this._vertexAttribArraysToUse.length;d>c;c++)this._vertexAttribArraysToUse[c]&&!this._vertexAttribArraysEnabled[c]&&(this._vertexAttribArraysEnabled[c]=!0,this._gl.enableVertexAttribArray(c));this._currentEffect=b;b.onBind&&b.onBind(b);},l.prototype.setArray=function(b,c){b&&this._gl.uniform1fv(b,c);},l.prototype.setArray2=function(b,c){y4tt.q9();b&&0===c.length%2&&this._gl.uniform2fv(b,c);},l.prototype.setArray3=function(b,c){b&&0===c.length%3&&this._gl.uniform3fv(b,c);},l.prototype.setArray4=function(b,c){b&&0===c.length%4&&this._gl.uniform4fv(b,c);},l.prototype.setMatrices=function(b,c){y4tt.v9();b&&this._gl.uniformMatrix4fv(b,!1,c);},l.prototype.setMatrix=function(b,c){y4tt.v9();b&&this._gl.uniformMatrix4fv(b,!1,c.toArray());},l.prototype.setMatrix3x3=function(b,c){y4tt.v9();b&&this._gl.uniformMatrix3fv(b,!1,c);},l.prototype.setMatrix2x2=function(b,c){b&&this._gl.uniformMatrix2fv(b,!1,c);},l.prototype.setFloat=function(b,c){b&&this._gl.uniform1f(b,c);},l.prototype.setFloat2=function(b,c,d){b&&this._gl.uniform2f(b,c,d);},l.prototype.setFloat3=function(b,c,d,f){b&&this._gl.uniform3f(b,c,d,f);},l.prototype.setBool=function(b,c){y4tt.v9();b&&this._gl.uniform1i(b,c);},l.prototype.setFloat4=function(b,c,d,f,l){b&&this._gl.uniform4f(b,c,d,f,l);},l.prototype.setColor3=function(b,c){y4tt.q9();b&&this._gl.uniform3f(b,c.r,c.g,c.b);},l.prototype.setColor4=function(b,c,d){b&&this._gl.uniform4f(b,c.r,c.g,c.b,d);},l.prototype.setState=function(b,c,d,f){var l;void 0===c&&(c=0);void 0===f&&(f=!1);l=f?this._gl.FRONT:this._gl.BACK;f=f?this._gl.BACK:this._gl.FRONT;l=this.cullBackFaces?l:f;(this._depthCullingState.cull!==b||d||this._depthCullingState.cullFace!==l)&&(b?(this._depthCullingState.cullFace=l,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1);this._depthCullingState.zOffset=c;},l.prototype.setDepthBuffer=function(b){this._depthCullingState.depthTest=b;},l.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask;},l.prototype.setDepthWrite=function(b){y4tt.v9();this._depthCullingState.depthMask=b;},l.prototype.setColorWrite=function(b){y4tt.q9();this._gl.colorMask(b,b,b,b);},l.prototype.setAlphaMode=function(b,c){if(void 0===c&&(c=!1),this._alphaMode!==b){switch(b){case l.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case l.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case l.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case l.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case l.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case l.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case l.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;}c||this.setDepthWrite(b===l.ALPHA_DISABLE);this._alphaMode=b;}},l.prototype.getAlphaMode=function(){y4tt.q9();return this._alphaMode;},l.prototype.setAlphaTesting=function(b){this._alphaTest=b;},l.prototype.getAlphaTesting=function(){y4tt.v9();return this._alphaTest;},l.prototype.wipeCaches=function(){this.resetTextureCache();this._currentEffect=null;this._depthCullingState.reset();this.setDepthFunctionToLessOrEqual();this._alphaState.reset();this._cachedEffectForVertexBuffers=this._cachedIndexBuffer=this._cachedVertexBuffers=null;},l.prototype.setSamplingMode=function(c,d){var f,l,j;f=this._gl;f.bindTexture(f.TEXTURE_2D,c);y4tt.v9();l=f.NEAREST,j=f.NEAREST;d===b.Texture.BILINEAR_SAMPLINGMODE?(l=f.LINEAR,j=f.LINEAR):d===b.Texture.TRILINEAR_SAMPLINGMODE&&(l=f.LINEAR,j=f.LINEAR_MIPMAP_LINEAR);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,l);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,j);f.bindTexture(f.TEXTURE_2D,null);c.samplingMode=d;},l.prototype.createTexture=function(c,f,l,j,e,q,g,y){var x,z,B,A,C,G,D;x=this;void 0===e&&(e=b.Texture.TRILINEAR_SAMPLINGMODE);void 0===q&&(q=null);void 0===g&&(g=null);void 0===y&&(y=null);B=this._gl.createTexture(),A=!1;("data:"===c.substr(0,5)&&(A=!0),A)?(A=c.split(":"),z=A[1].substr(A[1].length-4,4).toLowerCase()):z=c.substr(c.length-4,4).toLowerCase();C=this.getCaps().s3tc&&".dds"===z,G=".tga"===z;j._addPendingData(B);B.url=c;B.noMipmap=f;B.references=1;B.samplingMode=e;this._loadedTexturesCache.push(B);y4tt.v9();z=function(){j._removePendingData(B);y4tt.q9();g&&g();};G?(D=function(c){var n;n=new Uint8Array(c);c=b.Internals.TGATools.GetTGAHeader(n);y4tt.q9();d(B,x._gl,j,c.width,c.height,l,f,!1,function(){b.Internals.TGATools.UploadContent(x._gl,n);},q,e);},A instanceof Array?D(y):b.Tools.LoadFile(c,function(b){D(b);},z,j.database,!0)):C?(D=function(c){var n,g;n=b.Internals.DDSTools.GetDDSInfo(c),g=(n.isRGB||n.isLuminance||1<n.mipmapCount)&&!f&&1===n.width>>n.mipmapCount-1;d(B,x._gl,j,n.width,n.height,l,!g,n.isFourCC,function(){b.Internals.DDSTools.UploadDDSLevels(x._gl,x.getCaps().s3tc,c,n,g,1);},q,e);},A instanceof Array?D(y):b.Tools.LoadFile(c,function(b){y4tt.v9();D(b);},z,j.database,!0)):(C=function(c){y4tt.v9();d(B,x._gl,j,c.width,c.height,l,f,!1,function(d,f){var l;y4tt.v9();l=c.width===d&&c.height===f;l||(x._prepareWorkingCanvas(),x._workingCanvas.width=d,x._workingCanvas.height=f,e===b.Texture.NEAREST_SAMPLINGMODE&&(x._workingContext.imageSmoothingEnabled=!1,x._workingContext.mozImageSmoothingEnabled=!1,x._workingContext.oImageSmoothingEnabled=!1,x._workingContext.webkitImageSmoothingEnabled=!1,x._workingContext.msImageSmoothingEnabled=!1),x._workingContext.drawImage(c,0,0,c.width,c.height,0,0,d,f),e===b.Texture.NEAREST_SAMPLINGMODE&&(x._workingContext.imageSmoothingEnabled=!0,x._workingContext.mozImageSmoothingEnabled=!0,x._workingContext.oImageSmoothingEnabled=!0,x._workingContext.webkitImageSmoothingEnabled=!0,x._workingContext.msImageSmoothingEnabled=!0));x._gl.texImage2D(x._gl.TEXTURE_2D,0,x._gl.RGBA,x._gl.RGBA,x._gl.UNSIGNED_BYTE,l?c:x._workingCanvas);},q,e);},A instanceof Array?b.Tools.LoadImage(y,C,z,j.database):b.Tools.LoadImage(c,C,z,j.database));return B;},l.prototype._getInternalFormat=function(b){var c;y4tt.q9();c=this._gl.RGBA;switch(b){case l.TEXTUREFORMAT_ALPHA:c=this._gl.ALPHA;break;case l.TEXTUREFORMAT_LUMINANCE:c=this._gl.LUMINANCE;break;case l.TEXTUREFORMAT_LUMINANCE_ALPHA:c=this._gl.LUMINANCE_ALPHA;break;case l.TEXTUREFORMAT_RGB:c=this._gl.RGB;break;case l.TEXTUREFORMAT_RGBA:c=this._gl.RGBA;}return c;},l.prototype.updateRawTexture=function(b,c,d,f,l){void 0===l&&(l=null);d=this._getInternalFormat(d);this._gl.bindTexture(this._gl.TEXTURE_2D,b);this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===f?1:f?1:0);0!==b._width%4&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1);l?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[l],b._width,b._height,0,c):this._gl.texImage2D(this._gl.TEXTURE_2D,0,d,b._width,b._height,0,d,this._gl.UNSIGNED_BYTE,c);b.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D);this._gl.bindTexture(this._gl.TEXTURE_2D,null);y4tt.q9();this.resetTextureCache();b.isReady=!0;},l.prototype.createRawTexture=function(b,d,f,l,j,e,q,g){var x;void 0===g&&(g=null);x=this._gl.createTexture();x._baseWidth=d;y4tt.q9();x._baseHeight=f;x._width=d;x._height=f;x.references=1;this.updateRawTexture(x,b,l,e,g);this._gl.bindTexture(this._gl.TEXTURE_2D,x);b=c(q,j,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,b.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,b.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null),x.samplingMode=q,this._loadedTexturesCache.push(x),x;},l.prototype.createDynamicTexture=function(c,d,f,l){var j;j=this._gl.createTexture();y4tt.v9();return j._baseWidth=c,j._baseHeight=d,f&&(c=b.Tools.GetExponentOfTwo(c,this._caps.maxTextureSize),d=b.Tools.GetExponentOfTwo(d,this._caps.maxTextureSize)),this.resetTextureCache(),j._width=c,j._height=d,j.isReady=!1,j.generateMipMaps=f,j.references=1,j.samplingMode=l,this.updateTextureSamplingMode(l,j),this._loadedTexturesCache.push(j),j;},l.prototype.updateTextureSamplingMode=function(b,d){var f;y4tt.v9();f=c(b,d.generateMipMaps,this._gl);d.isCube?(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,d),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,f.mag),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,f.min),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null)):(this._gl.bindTexture(this._gl.TEXTURE_2D,d),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,f.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,f.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null));},l.prototype.updateDynamicTexture=function(b,c,d,f){void 0===f&&(f=!1);this._gl.bindTexture(this._gl.TEXTURE_2D,b);this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,d?1:0);f&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c);b.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D);this._gl.bindTexture(this._gl.TEXTURE_2D,null);this.resetTextureCache();b.isReady=!0;},l.prototype.updateVideoTexture=function(b,c,d){y4tt.v9();if(!b._isDisabled){this._gl.bindTexture(this._gl.TEXTURE_2D,b);this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,d?0:1);try{void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported?this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c):(b._workingCanvas||(b._workingCanvas=document.createElement("canvas"),b._workingContext=b._workingCanvas.getContext("2d"),b._workingCanvas.width=b._width,b._workingCanvas.height=b._height),b._workingContext.drawImage(c,0,0,c.videoWidth,c.videoHeight,0,0,b._width,b._height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,b._workingCanvas)),b.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this.resetTextureCache(),b.isReady=!0;}catch(f){b._isDisabled=!0;}}},l.prototype.createRenderTargetTexture=function(d,f){var j,q,g,t,v,y,x,z,B,A;j=!1,q=!0,g=l.TEXTURETYPE_UNSIGNED_INT,t=b.Texture.TRILINEAR_SAMPLINGMODE;void 0!==f&&(j=void 0===f.generateMipMaps?f:f.generateMipMaps,q=void 0===f.generateDepthBuffer?!0:f.generateDepthBuffer,g=void 0===f.type?g:f.type,void 0!==f.samplingMode&&(t=f.samplingMode),g===l.TEXTURETYPE_FLOAT&&(t=b.Texture.NEAREST_SAMPLINGMODE));v=this._gl,y=v.createTexture();v.bindTexture(v.TEXTURE_2D,y);x=d.width||d,z=d.height||d,B=c(t,j,v);g!==l.TEXTURETYPE_FLOAT||this._caps.textureFloat||(g=l.TEXTURETYPE_UNSIGNED_INT,b.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,B.mag);v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,B.min);v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE);v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE);v.texImage2D(v.TEXTURE_2D,0,v.RGBA,x,z,0,v.RGBA,e(v,g),null);y4tt.q9();q&&(A=v.createRenderbuffer(),v.bindRenderbuffer(v.RENDERBUFFER,A),v.renderbufferStorage(v.RENDERBUFFER,v.DEPTH_COMPONENT16,x,z));g=v.createFramebuffer();return v.bindFramebuffer(v.FRAMEBUFFER,g),q&&v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,v.RENDERBUFFER,A),j&&this._gl.generateMipmap(this._gl.TEXTURE_2D),v.bindTexture(v.TEXTURE_2D,null),v.bindRenderbuffer(v.RENDERBUFFER,null),v.bindFramebuffer(v.FRAMEBUFFER,null),y._framebuffer=g,q&&(y._depthBuffer=A),y._baseWidth=x,y._baseHeight=z,y._width=x,y._height=z,y.isReady=!0,y.generateMipMaps=j,y.references=1,y.samplingMode=t,this.resetTextureCache(),this._loadedTexturesCache.push(y),y;},l.prototype.createRenderTargetCubeTexture=function(d,f){var l,j,e,q;l=this._gl,j=l.createTexture(),e=!0,q=b.Texture.TRILINEAR_SAMPLINGMODE;void 0!==f&&(e=void 0===f.generateMipMaps?f:f.generateMipMaps,void 0!==f.samplingMode&&(q=f.samplingMode));j.isCube=!0;j.references=1;j.generateMipMaps=e;j.references=1;j.samplingMode=q;e=c(q,e,l);l.bindTexture(l.TEXTURE_CUBE_MAP,j);for(q=0;6>q;q++)l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+q,0,l.RGBA,d,d,0,l.RGBA,l.UNSIGNED_BYTE,null);l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,e.mag);l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,e.min);l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE);l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE);e=l.createRenderbuffer();l.bindRenderbuffer(l.RENDERBUFFER,e);l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,d,d);q=l.createFramebuffer();return l.bindFramebuffer(l.FRAMEBUFFER,q),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,e),j.generateMipMaps&&(l.bindTexture(l.TEXTURE_CUBE_MAP,j),l.generateMipmap(l.TEXTURE_CUBE_MAP)),l.bindTexture(l.TEXTURE_CUBE_MAP,null),l.bindRenderbuffer(l.RENDERBUFFER,null),l.bindFramebuffer(l.FRAMEBUFFER,null),j._framebuffer=q,j._depthBuffer=e,this.resetTextureCache(),j._width=d,j._height=d,j.isReady=!0,j;},l.prototype.createCubeTexture=function(c,d,l,j){var e,q,g,y;e=this,q=this._gl,g=q.createTexture();g.isCube=!0;g.url=c;g.references=1;y=c.substr(c.length-4,4).toLowerCase();if(this.getCaps().s3tc&&".dds"===y)b.Tools.LoadFile(c,function(c){var d,f;d=b.Internals.DDSTools.GetDDSInfo(c),f=(d.isRGB||d.isLuminance||1<d.mipmapCount)&&!j;q.bindTexture(q.TEXTURE_CUBE_MAP,g);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,1);b.Internals.DDSTools.UploadDDSLevels(e._gl,e.getCaps().s3tc,c,d,f,6);j||d.isFourCC||1!==d.mipmapCount||q.generateMipmap(q.TEXTURE_CUBE_MAP);q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,f?q.LINEAR_MIPMAP_LINEAR:q.LINEAR);q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);q.bindTexture(q.TEXTURE_CUBE_MAP,null);e.resetTextureCache();g._width=d.width;g._height=d.height;g.isReady=!0;},null,null,!0);else{c=function(c){var d,f;d=b.Tools.GetExponentOfTwo(c[0].width,e._caps.maxCubemapTextureSize);e._prepareWorkingCanvas();e._workingCanvas.width=d;e._workingCanvas.height=d;f=[q.TEXTURE_CUBE_MAP_POSITIVE_X,q.TEXTURE_CUBE_MAP_POSITIVE_Y,q.TEXTURE_CUBE_MAP_POSITIVE_Z,q.TEXTURE_CUBE_MAP_NEGATIVE_X,q.TEXTURE_CUBE_MAP_NEGATIVE_Y,q.TEXTURE_CUBE_MAP_NEGATIVE_Z];q.bindTexture(q.TEXTURE_CUBE_MAP,g);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,0);for(var l=0;l<f.length;l++)e._workingContext.drawImage(c[l],0,0,c[l].width,c[l].height,0,0,d,d),q.texImage2D(f[l],0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,e._workingCanvas);j||q.generateMipmap(q.TEXTURE_CUBE_MAP);q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,j?q.LINEAR:q.LINEAR_MIPMAP_LINEAR);q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);q.bindTexture(q.TEXTURE_CUBE_MAP,null);e.resetTextureCache();g._width=d;g._height=d;g.isReady=!0;};for(var y=[],x=y._internalCount=0;6>x;x++)f(l[x],x,y,d,c);}return g;},l.prototype.updateTextureSize=function(b,c,d){b._width=c;b._height=d;b._size=c*d;b._baseWidth=c;b._baseHeight=d;},l.prototype.createRawCubeTexture=function(c,d,f,j,e,q,g,y){var x,z,B,A,C,G,D,H;x=this,z=this._gl,B=z.createTexture();d._addPendingData(B);B.isCube=!0;B.references=1;B.url=c;A=this._getInternalFormat(j),C=z.UNSIGNED_BYTE;e===l.TEXTURETYPE_FLOAT&&(C=z.FLOAT);G=f,D=G,H=b.Tools.IsExponentOfTwo(G)&&b.Tools.IsExponentOfTwo(D);B._width=G;B._height=D;return b.Tools.LoadFile(c,function(c){var f,l,j,r,s;f=g(c);c=[z.TEXTURE_CUBE_MAP_POSITIVE_X,z.TEXTURE_CUBE_MAP_POSITIVE_Y,z.TEXTURE_CUBE_MAP_POSITIVE_Z,z.TEXTURE_CUBE_MAP_NEGATIVE_X,z.TEXTURE_CUBE_MAP_NEGATIVE_Y,z.TEXTURE_CUBE_MAP_NEGATIVE_Z];if(G=B._width,D=B._height,H=b.Tools.IsExponentOfTwo(G)&&b.Tools.IsExponentOfTwo(D),z.bindTexture(z.TEXTURE_CUBE_MAP,B),z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,0),!q&&H)if(y){l=[];l.push(f[0]);l.push(f[3]);l.push(f[1]);l.push(f[4]);l.push(f[2]);l.push(f[5]);f=y(l);for(l=0;l<f.length;l++){j=G>>l;z.texImage2D(c[0],l,A,j,j,0,A,C,f[l][0]);z.texImage2D(c[1],l,A,j,j,0,A,C,f[l][2]);z.texImage2D(c[2],l,A,j,j,0,A,C,f[l][4]);z.texImage2D(c[3],l,A,j,j,0,A,C,f[l][1]);z.texImage2D(c[4],l,A,j,j,0,A,C,f[l][3]);z.texImage2D(c[5],l,A,j,j,0,A,C,f[l][5]);}}else{for(l=0;l<c.length;l++)j=f[l],z.texImage2D(c[l],0,A,G,D,0,A,C,j);if(z.generateMipmap(z.TEXTURE_CUBE_MAP),C===z.FLOAT&&A===z.RGB&&1282===z.getError()){b.Tools.Log("RGB32F not renderable on Firefox, trying fallback to RGBA32F.");for(l=0;l<c.length;l++){for(var j=f[l],e=new Float32Array(4*G*D),n=0;G>n;n++)for(var p=0;D>p;p++){r=3*(p*G+n),s=4*(p*G+n);e[s+0]=j[r+0];e[s+1]=j[r+1];e[s+2]=j[r+2];e[s+3]=1;}z.texImage2D(c[l],0,z.RGBA,G,D,0,z.RGBA,C,e);}z.generateMipmap(z.TEXTURE_CUBE_MAP);}}else q=!0;C!==z.FLOAT||x._caps.textureFloatLinearFiltering?(z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MAG_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MIN_FILTER,q?z.LINEAR:z.LINEAR_MIPMAP_LINEAR)):(z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MAG_FILTER,z.NEAREST),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MIN_FILTER,z.NEAREST));z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE);z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE);z.bindTexture(z.TEXTURE_CUBE_MAP,null);B.isReady=!0;x.resetTextureCache();d._removePendingData(B);},function(){d._removePendingData(B);},d.database,!0),B;},l.prototype._releaseTexture=function(b){var c;c=this._gl;b._framebuffer&&c.deleteFramebuffer(b._framebuffer);b._depthBuffer&&c.deleteRenderbuffer(b._depthBuffer);y4tt.v9();c.deleteTexture(b);this.unbindAllTextures();b=this._loadedTexturesCache.indexOf(b);-1!==b&&this._loadedTexturesCache.splice(b,1);},l.prototype.bindSamplers=function(b){var f;this._gl.useProgram(b.getProgram());for(var c=b.getSamplers(),d=0;d<c.length;d++){f=b.getUniform(c[d]);this._gl.uniform1i(f,d);}y4tt.q9();this._currentEffect=null;},l.prototype._bindTexture=function(b,c){y4tt.v9();0>b||(this._gl.activeTexture(this._gl["TEXTURE"+b]),this._gl.bindTexture(this._gl.TEXTURE_2D,c),this._activeTexturesCache[b]=null);},l.prototype.setTextureFromPostProcess=function(b,c){y4tt.q9();this._bindTexture(b,c._textures.data[c._currentRenderTextureInd]);},l.prototype.unbindAllTextures=function(){y4tt.q9();for(var b=0;b<this._caps.maxTexturesImageUnits;b++)this._gl.activeTexture(this._gl["TEXTURE"+b]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[b]=null;},l.prototype.setTexture=function(c,d){var f,j;y4tt.q9();if(!(0>c)){if(!d||!d.isReady())return void(null!=this._activeTexturesCache[c]&&(this._gl.activeTexture(this._gl["TEXTURE"+c]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[c]=null));f=!1;if(d instanceof b.VideoTexture)this._gl.activeTexture(this._gl["TEXTURE"+c]),f=!0,d.update();else if(d.delayLoadState===l.DELAYLOADSTATE_NOTLOADED)return void d.delayLoad();if(this._activeTexturesCache[c]!==d){this._activeTexturesCache[c]=d;j=d.getInternalTexture();if(f||this._gl.activeTexture(this._gl["TEXTURE"+c]),j.isCube){if(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,j),j._cachedCoordinatesMode!==d.coordinatesMode)j._cachedCoordinatesMode=d.coordinatesMode,f=d.coordinatesMode!==b.Texture.CUBIC_MODE&&d.coordinatesMode!==b.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE,this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,f),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,f);this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,d);}else{if(this._gl.bindTexture(this._gl.TEXTURE_2D,j),j._cachedWrapU!==d.wrapU)switch(j._cachedWrapU=d.wrapU,d.wrapU){case b.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case b.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case b.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT);}if(j._cachedWrapV!==d.wrapV)switch(j._cachedWrapV=d.wrapV,d.wrapV){case b.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case b.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case b.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT);}this._setAnisotropicLevel(this._gl.TEXTURE_2D,d);}}}},l.prototype._setAnisotropicLevel=function(c,d){var f,l;f=this._caps.textureAnisotropicFilterExtension,l=d.anisotropicFilteringLevel;d.getInternalTexture().samplingMode===b.Texture.NEAREST_SAMPLINGMODE&&(l=1);f&&d._cachedAnisotropicFilteringLevel!==l&&(this._gl.texParameterf(c,f.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(l,this._caps.maxAnisotropy)),d._cachedAnisotropicFilteringLevel=l);},l.prototype.readPixels=function(b,c,d,f){var l;l=new Uint8Array(4*f*d);return this._gl.readPixels(b,c,d,f,this._gl.RGBA,this._gl.UNSIGNED_BYTE,l),l;},l.prototype.addExternalData=function(b,c){y4tt.v9();return this._externalData.add(b,c);},l.prototype.getExternalData=function(b){return this._externalData.get(b);},l.prototype.getOrAddExternalDataWithFactory=function(b,c){return this._externalData.getOrAddWithFactory(b,c);},l.prototype.removeExternalData=function(b){y4tt.q9();return this._externalData.remove(b);},l.prototype.releaseInternalTexture=function(b){var c,d;if(b&&(b.references--,0===b.references)){c=this.getLoadedTexturesCache(),d=c.indexOf(b);-1<d&&c.splice(d,1);this._releaseTexture(b);}},l.prototype.dispose=function(){this.hideLoadingUI();y4tt.v9();for(this.stopRenderLoop();this.scenes.length;)this.scenes[0].dispose();l.audioEngine.dispose();for(var b in this._compiledEffects)this._gl.deleteProgram(this._compiledEffects[b]._program);if(this._vertexAttribArraysEnabled){b=0;for(var c=this._vertexAttribArraysEnabled.length;c>b;b++)b>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArraysEnabled[b]||this._gl.disableVertexAttribArray(b);}this._gl=null;window.removeEventListener("blur",this._onBlur);window.removeEventListener("focus",this._onFocus);document.removeEventListener("fullscreenchange",this._onFullscreenChange);document.removeEventListener("mozfullscreenchange",this._onFullscreenChange);document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange);document.removeEventListener("msfullscreenchange",this._onFullscreenChange);document.removeEventListener("pointerlockchange",this._onPointerLockChange);document.removeEventListener("mspointerlockchange",this._onPointerLockChange);document.removeEventListener("mozpointerlockchange",this._onPointerLockChange);document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange);},l.prototype.displayLoadingUI=function(){this._loadingScreen.displayLoadingUI();},l.prototype.hideLoadingUI=function(){this._loadingScreen.hideLoadingUI();},Object.defineProperty(l.prototype,"loadingScreen",{get:function(){return this._loadingScreen;},set:function(b){y4tt.q9();this._loadingScreen=b;},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"loadingUIText",{set:function(b){y4tt.v9();this._loadingScreen.loadingUIText=b;},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"loadingUIBackgroundColor",{set:function(b){y4tt.v9();this._loadingScreen.loadingUIBackgroundColor=b;},enumerable:!0,configurable:!0}),l.prototype.getFps=function(){return this.fps;},l.prototype.getDeltaTime=function(){return this.deltaTime;},l.prototype._measureFps=function(){var c;y4tt.q9();this.previousFramesDuration.push(b.Tools.Now);c=this.previousFramesDuration.length;if(2<=c&&(this.deltaTime=this.previousFramesDuration[c-1]-this.previousFramesDuration[c-2]),c>=this.fpsRange){c>this.fpsRange&&(this.previousFramesDuration.splice(0,1),c=this.previousFramesDuration.length);for(var d=0,f=0;c-1>f;f++)d+=this.previousFramesDuration[f+1]-this.previousFramesDuration[f];this.fps=1E3/(d/(c-1));}},l.isSupported=function(){var b;try{if(navigator.isCocoonJS)return!0;b=document.createElement("canvas");return null!=(b.getContext("webgl")||b.getContext("experimental-webgl"))&&!!window.WebGLRenderingContext;}catch(c){return!1;}},l._ALPHA_DISABLE=0,l._ALPHA_ADD=1,l._ALPHA_COMBINE=2,l._ALPHA_SUBTRACT=3,l._ALPHA_MULTIPLY=4,l._ALPHA_MAXIMIZED=5,l._ALPHA_ONEONE=6,l._DELAYLOADSTATE_NONE=0,l._DELAYLOADSTATE_LOADED=1,l._DELAYLOADSTATE_LOADING=2,l._DELAYLOADSTATE_NOTLOADED=4,l._TEXTUREFORMAT_ALPHA=0,l._TEXTUREFORMAT_LUMINANCE=1,l._TEXTUREFORMAT_LUMINANCE_ALPHA=2,l._TEXTUREFORMAT_RGB=4,l._TEXTUREFORMAT_RGBA=5,l._TEXTURETYPE_UNSIGNED_INT=0,l._TEXTURETYPE_FLOAT=1,l.CollisionsEpsilon=0.001,l.CodeRepository="src/",l.ShadersRepository="src/Shaders/",l);b.Engine=j;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(b,c){this.state="";this.animations=[];y4tt.q9();this._ranges={};this._childrenFlag=-1;this._isReady=this._isEnabled=!0;this._parentRenderId=this._currentRenderId=-1;this.id=this.name=b;this._scene=c;this._initCache();};g=(Object.defineProperty(g.prototype,"parent",{get:function(){return this._parentNode;},set:function(b){var c;y4tt.v9();if(this._parentNode!==b){if(this._parentNode){c=this._parentNode._children.indexOf(this);-1!==c&&this._parentNode._children.splice(c,1);}(this._parentNode=b)&&(this._parentNode._children||(this._parentNode._children=[]),this._parentNode._children.push(this));}},enumerable:!0,configurable:!0}),g.prototype.getScene=function(){return this._scene;},g.prototype.getEngine=function(){y4tt.v9();return this._scene.getEngine();},g.prototype.getWorldMatrix=function(){y4tt.v9();return b.Matrix.Identity();},g.prototype._initCache=function(){this._cache={};y4tt.v9();this._cache.parent=void 0;},g.prototype.updateCache=function(b){y4tt.v9();!b&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache());},g.prototype._updateCache=function(){},g.prototype._isSynchronized=function(){return!0;},g.prototype._markSyncedWithParent=function(){this._parentRenderId=this.parent._currentRenderId;},g.prototype.isSynchronizedWithParent=function(){return this.parent?this._parentRenderId!==this.parent._currentRenderId?!1:this.parent.isSynchronized():!0;},g.prototype.isSynchronized=function(b){var c;c=this.hasNewParent();y4tt.v9();return c=c||!this.isSynchronizedWithParent(),c=c||!this._isSynchronized(),b&&this.updateCache(!0),!c;},g.prototype.hasNewParent=function(b){y4tt.q9();return this._cache.parent===this.parent?!1:(b&&(this._cache.parent=this.parent),!0);},g.prototype.isReady=function(){return this._isReady;},g.prototype.isEnabled=function(){return this._isEnabled?this.parent?this.parent.isEnabled():!0:!1;},g.prototype.setEnabled=function(b){y4tt.v9();this._isEnabled=b;},g.prototype.isDescendantOf=function(b){y4tt.v9();return this.parent?this.parent===b?!0:this.parent.isDescendantOf(b):!1;},g.prototype._getDescendants=function(b,c,d){var q;y4tt.v9();if(void 0===c&&(c=!1),this._children)for(var f=0;f<this._children.length;f++){q=this._children[f];d&&!d(q)||b.push(q);c||q._getDescendants(b,!1,d);}},g.prototype.getDescendants=function(b,c){var d;d=[];return this._getDescendants(d,b,c),d;},g.prototype.getChildren=function(b){y4tt.v9();return this.getDescendants(!0,b);},g.prototype.getChildMeshes=function(e,c){var d;y4tt.q9();d=[];return this._getDescendants(d,e,function(d){y4tt.v9();return(!c||c(d))&&d instanceof b.AbstractMesh;}),d;},g.prototype._setReady=function(b){if(b!==this._isReady){if(!b)return void(this._isReady=!1);this._isReady=!0;this.onReady&&this.onReady(this);}},g.prototype.getAnimationByName=function(b){var d;y4tt.q9();for(var c=0;c<this.animations.length;c++){d=this.animations[c];if(d.name===b)return d;}return null;},g.prototype.createAnimationRange=function(e,c,d){y4tt.q9();if(!this._ranges[e]){this._ranges[e]=new b.AnimationRange(e,c,d);for(var f=0,q=this.animations.length;q>f;f++)this.animations[f]&&this.animations[f].createRange(e,c,d);}},g.prototype.deleteAnimationRange=function(b,c){void 0===c&&(c=!0);for(var d=0,f=this.animations.length;f>d;d++)this.animations[d]&&this.animations[d].deleteRange(b,c);this._ranges[b]=void 0;},g.prototype.getAnimationRange=function(b){y4tt.q9();return this._ranges[b];},g.prototype.beginAnimation=function(b,c,d,f){return(b=this.getAnimationRange(b))?void this._scene.beginAnimation(this,b.from,b.to,c,d,f):null;},g.prototype.serializeAnimationRanges=function(){var b,c,d;y4tt.q9();b=[];for(c in this._ranges){d={};d.name=c;d.from=this._ranges[c].from;d.to=this._ranges[c].to;b.push(d);}return b;},g.prototype.dispose=function(){this.parent=null;},g.ParseAnimationRanges=function(b,c){var f;if(c.ranges)for(var d=0;d<c.ranges.length;d++){f=c.ranges[d];b.createAnimationRange(f.name,f.from,f.to);}},__decorate([b.serialize()],g.prototype,"name",void 0),__decorate([b.serialize()],g.prototype,"id",void 0),__decorate([b.serialize()],g.prototype,"uniqueId",void 0),__decorate([b.serialize()],g.prototype,"state",void 0),g);y4tt.q9();b.Node=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(b,d,f,e,j,l,n,g){this._engine=b;this._canvas=f;this._currentScene=d;this._sceneLoadedCallback=e;y4tt.v9();this._progressCallback=j;this._additionnalRenderLoopLogicCallback=l;this._textureLoadingCallback=n;this._startingProcessingFilesCallback=g;};g=(e.prototype.monitorElementForDragNDrop=function(b){var d;d=this;b&&(this._elementToMonitor=b,this._elementToMonitor.addEventListener("dragenter",function(b){d.drag(b);},!1),this._elementToMonitor.addEventListener("dragover",function(b){y4tt.q9();d.drag(b);},!1),this._elementToMonitor.addEventListener("drop",function(b){y4tt.q9();d.drop(b);},!1));},e.prototype.renderFunction=function(){var b;if(this._additionnalRenderLoopLogicCallback&&this._additionnalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){b=this._currentScene.getWaitingItemsCount();0<b&&this._textureLoadingCallback(b);}this._currentScene.render();}},e.prototype.drag=function(b){b.stopPropagation();y4tt.v9();b.preventDefault();},e.prototype.drop=function(b){b.stopPropagation();b.preventDefault();this.loadFiles(b);},e.prototype.loadFiles=function(b){if(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(),b&&b.dataTransfer&&b.dataTransfer.files&&(this._filesToLoad=b.dataTransfer.files),b&&b.target&&b.target.files&&(this._filesToLoad=b.target.files),this._filesToLoad&&0<this._filesToLoad.length){for(b=0;b<this._filesToLoad.length;b++)switch(this._filesToLoad[b].type){case"image/jpeg":case"image/png":case"image/bmp":e.FilesTextures[this._filesToLoad[b].name.toLowerCase()]=this._filesToLoad[b];break;case"image/targa":case"image/vnd.ms-dds":case"audio/wav":case"audio/x-wav":case"audio/mp3":case"audio/mpeg":case"audio/mpeg3":case"audio/x-mpeg-3":case"audio/ogg":e.FilesToLoad[this._filesToLoad[b].name.toLowerCase()]=this._filesToLoad[b];break;default:-1!==this._filesToLoad[b].name.indexOf(".mtl")?e.FilesToLoad[this._filesToLoad[b].name.toLowerCase()]=this._filesToLoad[b]:-1===this._filesToLoad[b].name.indexOf(".babylon")&&-1===this._filesToLoad[b].name.indexOf(".stl")&&-1===this._filesToLoad[b].name.indexOf(".obj")||-1!==this._filesToLoad[b].name.indexOf(".manifest")||-1!==this._filesToLoad[b].name.indexOf(".incremental")||-1!==this._filesToLoad[b].name.indexOf(".babylonmeshdata")||-1!==this._filesToLoad[b].name.indexOf(".babylongeometrydata")||-1!==this._filesToLoad[b].name.indexOf(".babylonbinarymeshdata")||-1!==this._filesToLoad[b].name.indexOf(".binary.babylon")||(this._sceneFileToLoad=this._filesToLoad[b]);}this.reload();}},e.prototype.reload=function(){var c,d;c=this,d=this;this._sceneFileToLoad?(this._currentScene&&(0<b.Tools.errorsCount&&(b.Tools.ClearLogCache(),b.Tools.Log("Babylon.js engine (v"+b.Engine.Version+") launched")),this._engine.stopRenderLoop(),this._currentScene.dispose()),b.SceneLoader.Load("file:",this._sceneFileToLoad,this._engine,function(b){d._currentScene=b;d._currentScene.executeWhenReady(function(){d._currentScene.activeCamera&&0!==d._currentScene.lights.length||d._currentScene.createDefaultCameraOrLight();d._currentScene.activeCamera.attachControl(d._canvas);d._sceneLoadedCallback&&d._sceneLoadedCallback(c._sceneFileToLoad,d._currentScene);d._engine.runRenderLoop(function(){d.renderFunction();});});},function(b){y4tt.v9();c._progressCallback&&c._progressCallback(b);})):b.Tools.Error("Please provide a valid .babylon file.");},e.FilesTextures=[],e.FilesToLoad=[],e);b.FilesInput=g;}(BABYLON||(BABYLON={}));!function(b){var g;b.IntersectionInfo=function(b,c,d){this.bu=b;this.bv=c;this.distance=d;this.subMeshId=this.faceId=0;};g=function(){this.hit=!1;this.distance=0;this.pickedMesh=this.pickedPoint=null;this.bv=this.bu=0;this.faceId=-1;this.subMeshId=0;y4tt.q9();this.pickedSprite=null;};g=(g.prototype.getNormal=function(e,c){var d,f,q,j;if(void 0===e&&(e=!1),void 0===c&&(c=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(b.VertexBuffer.NormalKind))return null;d=this.pickedMesh.getIndices();if(c){f=this.pickedMesh.getVerticesData(b.VertexBuffer.NormalKind),q=b.Vector3.FromArray(f,3*d[3*this.faceId]),j=b.Vector3.FromArray(f,3*d[3*this.faceId+1]);d=b.Vector3.FromArray(f,3*d[3*this.faceId+2]);q=q.scale(this.bu);j=j.scale(this.bv);d=d.scale(1-this.bu-this.bv);d=new b.Vector3(q.x+j.x+d.x,q.y+j.y+d.y,q.z+j.z+d.z);}else f=this.pickedMesh.getVerticesData(b.VertexBuffer.PositionKind),j=b.Vector3.FromArray(f,3*d[3*this.faceId]),q=b.Vector3.FromArray(f,3*d[3*this.faceId+1]),d=b.Vector3.FromArray(f,3*d[3*this.faceId+2]),j=j.subtract(q),d=d.subtract(q),d=b.Vector3.Cross(j,d);return e&&(d=b.Vector3.TransformNormal(d,this.pickedMesh.getWorldMatrix())),b.Vector3.Normalize(d);},g.prototype.getTextureCoordinates=function(){var e,c,d,f;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(b.VertexBuffer.UVKind))return null;e=this.pickedMesh.getIndices(),c=this.pickedMesh.getVerticesData(b.VertexBuffer.UVKind),d=b.Vector2.FromArray(c,2*e[3*this.faceId]),f=b.Vector2.FromArray(c,2*e[3*this.faceId+1]),e=b.Vector2.FromArray(c,2*e[3*this.faceId+2]);return d=d.scale(1-this.bu-this.bv),f=f.scale(this.bu),e=e.scale(this.bv),new b.Vector2(d.x+f.x+e.x,d.y+f.y+e.y);},g);b.PickingInfo=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(e,c){var d;this.minimum=e;this.maximum=c;this._tempRadiusVector=b.Vector3.Zero();y4tt.v9();d=b.Vector3.Distance(e,c);this.center=b.Vector3.Lerp(e,c,0.5);this.radius=0.5*d;this.centerWorld=b.Vector3.Zero();this._update(b.Matrix.Identity());};g=(g.prototype._update=function(e){b.Vector3.TransformCoordinatesToRef(this.center,e,this.centerWorld);y4tt.q9();b.Vector3.TransformNormalFromFloatsToRef(1,1,1,e,this._tempRadiusVector);this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),Math.abs(this._tempRadiusVector.z))*this.radius;},g.prototype.isInFrustum=function(b){for(var c=0;6>c;c++)if(b[c].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0;},g.prototype.intersectsPoint=function(e){var c,d;c=this.centerWorld.x-e.x,d=this.centerWorld.y-e.y;e=this.centerWorld.z-e.z;c=Math.sqrt(c*c+d*d+e*e);y4tt.v9();return!(Math.abs(this.radiusWorld-c)<b.Epsilon);},g.Intersects=function(b,c){var d,f,q;y4tt.v9();d=b.centerWorld.x-c.centerWorld.x,f=b.centerWorld.y-c.centerWorld.y,q=b.centerWorld.z-c.centerWorld.z,d=Math.sqrt(d*d+f*f+q*q);return!(b.radiusWorld+c.radiusWorld<d);},g);b.BoundingSphere=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(c,d){this.minimum=c;this.maximum=d;this.vectors=[];this.vectorsWorld=[];this.vectors.push(this.minimum.clone());this.vectors.push(this.maximum.clone());this.vectors.push(this.minimum.clone());this.vectors[2].x=this.maximum.x;this.vectors.push(this.minimum.clone());this.vectors[3].y=this.maximum.y;this.vectors.push(this.minimum.clone());this.vectors[4].z=this.maximum.z;this.vectors.push(this.maximum.clone());this.vectors[5].z=this.minimum.z;this.vectors.push(this.maximum.clone());this.vectors[6].x=this.minimum.x;this.vectors.push(this.maximum.clone());this.vectors[7].y=this.minimum.y;this.center=this.maximum.add(this.minimum).scale(0.5);this.extendSize=this.maximum.subtract(this.minimum).scale(0.5);this.directions=[b.Vector3.Zero(),b.Vector3.Zero(),b.Vector3.Zero()];for(var f=0;f<this.vectors.length;f++)this.vectorsWorld[f]=b.Vector3.Zero();this.minimumWorld=b.Vector3.Zero();this.maximumWorld=b.Vector3.Zero();this._update(b.Matrix.Identity());};g=(e.prototype.getWorldMatrix=function(){y4tt.v9();return this._worldMatrix;},e.prototype.setWorldMatrix=function(b){return this._worldMatrix.copyFrom(b),this;},e.prototype._update=function(c){var f;b.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld);b.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var d=0;d<this.vectors.length;d++){f=this.vectorsWorld[d];b.Vector3.TransformCoordinatesToRef(this.vectors[d],c,f);f.x<this.minimumWorld.x&&(this.minimumWorld.x=f.x);f.y<this.minimumWorld.y&&(this.minimumWorld.y=f.y);f.z<this.minimumWorld.z&&(this.minimumWorld.z=f.z);f.x>this.maximumWorld.x&&(this.maximumWorld.x=f.x);f.y>this.maximumWorld.y&&(this.maximumWorld.y=f.y);f.z>this.maximumWorld.z&&(this.maximumWorld.z=f.z);}this.maximumWorld.addToRef(this.minimumWorld,this.center);this.center.scaleInPlace(0.5);b.Vector3.FromFloatArrayToRef(c.m,0,this.directions[0]);b.Vector3.FromFloatArrayToRef(c.m,4,this.directions[1]);b.Vector3.FromFloatArrayToRef(c.m,8,this.directions[2]);this._worldMatrix=c;},e.prototype.isInFrustum=function(b){y4tt.q9();return e.IsInFrustum(this.vectorsWorld,b);},e.prototype.isCompletelyInFrustum=function(b){y4tt.q9();return e.IsCompletelyInFrustum(this.vectorsWorld,b);},e.prototype.intersectsPoint=function(c){var d;y4tt.v9();d=-b.Epsilon;return this.maximumWorld.x-c.x<d||d>c.x-this.minimumWorld.x?!1:this.maximumWorld.y-c.y<d||d>c.y-this.minimumWorld.y?!1:!(this.maximumWorld.z-c.z<d||d>c.z-this.minimumWorld.z);},e.prototype.intersectsSphere=function(b){return e.IntersectsSphere(this.minimumWorld,this.maximumWorld,b.centerWorld,b.radiusWorld);},e.prototype.intersectsMinMax=function(b,d){y4tt.v9();return this.maximumWorld.x<b.x||this.minimumWorld.x>d.x?!1:this.maximumWorld.y<b.y||this.minimumWorld.y>d.y?!1:!(this.maximumWorld.z<b.z||this.minimumWorld.z>d.z);},e.Intersects=function(b,d){y4tt.v9();return b.maximumWorld.x<d.minimumWorld.x||b.minimumWorld.x>d.maximumWorld.x?!1:b.maximumWorld.y<d.minimumWorld.y||b.minimumWorld.y>d.maximumWorld.y?!1:!(b.maximumWorld.z<d.minimumWorld.z||b.minimumWorld.z>d.maximumWorld.z);},e.IntersectsSphere=function(c,d,f,e){c=b.Vector3.Clamp(f,c,d);f=b.Vector3.DistanceSquared(f,c);return e*e>=f;},e.IsCompletelyInFrustum=function(b,d){for(var f=0;6>f;f++)for(var e=0;8>e;e++)if(0>d[f].dotCoordinate(b[e]))return!1;return!0;},e.IsInFrustum=function(b,d){for(var f=0;6>f;f++){for(var e=8,j=0;8>j&&0>d[f].dotCoordinate(b[j]);j++)--e;if(0===e)return!1;}return!0;},e);b.BoundingBox=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;g=function(c,f){var e,j,l,n;e=b.Vector3.Dot(f.center,c),j=Math.abs(b.Vector3.Dot(f.directions[0],c))*f.extendSize.x,l=Math.abs(b.Vector3.Dot(f.directions[1],c))*f.extendSize.y,n=Math.abs(b.Vector3.Dot(f.directions[2],c))*f.extendSize.z,j=j+l+n;y4tt.q9();return{min:e-j,max:e+j};},e=function(b,c,e){c=g(b,c);b=g(b,e);return!(c.min>b.max||b.min>c.max);};y4tt.q9();c=function(c,f){this.minimum=c;this.maximum=f;this._isLocked=!1;this.boundingBox=new b.BoundingBox(c,f);this.boundingSphere=new b.BoundingSphere(c,f);};c=(Object.defineProperty(c.prototype,"isLocked",{get:function(){y4tt.q9();return this._isLocked;},set:function(b){this._isLocked=b;},enumerable:!0,configurable:!0}),c.prototype.update=function(b){y4tt.v9();this._isLocked||(this.boundingBox._update(b),this.boundingSphere._update(b));},c.prototype.isInFrustum=function(b){y4tt.v9();return this.boundingSphere.isInFrustum(b)?this.boundingBox.isInFrustum(b):!1;},c.prototype.isCompletelyInFrustum=function(b){return this.boundingBox.isCompletelyInFrustum(b);},c.prototype._checkCollision=function(b){y4tt.v9();return b._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld);},c.prototype.intersectsPoint=function(b){y4tt.q9();return this.boundingSphere.centerWorld&&this.boundingSphere.intersectsPoint(b)?!!this.boundingBox.intersectsPoint(b):!1;},c.prototype.intersects=function(c,f){var q,j;if(!this.boundingSphere.centerWorld||!c.boundingSphere.centerWorld||!b.BoundingSphere.Intersects(this.boundingSphere,c.boundingSphere)||!b.BoundingBox.Intersects(this.boundingBox,c.boundingBox))return!1;if(!f)return!0;q=this.boundingBox,j=c.boundingBox;y4tt.v9();return e(q.directions[0],q,j)&&e(q.directions[1],q,j)&&e(q.directions[2],q,j)&&e(j.directions[0],q,j)&&e(j.directions[1],q,j)&&e(j.directions[2],q,j)&&e(b.Vector3.Cross(q.directions[0],j.directions[0]),q,j)&&e(b.Vector3.Cross(q.directions[0],j.directions[1]),q,j)&&e(b.Vector3.Cross(q.directions[0],j.directions[2]),q,j)&&e(b.Vector3.Cross(q.directions[1],j.directions[0]),q,j)&&e(b.Vector3.Cross(q.directions[1],j.directions[1]),q,j)&&e(b.Vector3.Cross(q.directions[1],j.directions[2]),q,j)&&e(b.Vector3.Cross(q.directions[2],j.directions[0]),q,j)&&e(b.Vector3.Cross(q.directions[2],j.directions[1]),q,j)?!!e(b.Vector3.Cross(q.directions[2],j.directions[2]),q,j):!1;},c);b.BoundingInfo=c;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(b,d,f){void 0===f&&(f=Number.MAX_VALUE);y4tt.v9();this.origin=b;this.direction=d;this.length=f;};g=(e.prototype.intersectsBoxMinMax=function(b,d){var f,e,j,l,n,g;n=0,g=Number.MAX_VALUE;if(1E-7>Math.abs(this.direction.x)){if(this.origin.x<b.x||this.origin.x>d.x)return!1;}else if(f=1/this.direction.x,e=(b.x-this.origin.x)*f,j=(d.x-this.origin.x)*f,j===-(1/0)&&(j=1/0),e>j&&(l=e,e=j,j=l),n=Math.max(e,n),g=Math.min(j,g),n>g)return!1;if(1E-7>Math.abs(this.direction.y)){if(this.origin.y<b.y||this.origin.y>d.y)return!1;}else if(f=1/this.direction.y,e=(b.y-this.origin.y)*f,j=(d.y-this.origin.y)*f,j===-(1/0)&&(j=1/0),e>j&&(l=e,e=j,j=l),n=Math.max(e,n),g=Math.min(j,g),n>g)return!1;if(1E-7>Math.abs(this.direction.z)){if(this.origin.z<b.z||this.origin.z>d.z)return!1;}else if(f=1/this.direction.z,e=(b.z-this.origin.z)*f,j=(d.z-this.origin.z)*f,j===-(1/0)&&(j=1/0),e>j&&(l=e,e=j,j=l),n=Math.max(e,n),g=Math.min(j,g),n>g)return!1;return!0;},e.prototype.intersectsBox=function(b){y4tt.q9();return this.intersectsBoxMinMax(b.minimum,b.maximum);},e.prototype.intersectsSphere=function(b){var d,f,e,j;d=b.center.x-this.origin.x,f=b.center.y-this.origin.y,e=b.center.z-this.origin.z,j=d*d+f*f+e*e;b=b.radius*b.radius;if(b>=j)return!0;d=d*this.direction.x+f*this.direction.y+e*this.direction.z;return 0>d?!1:b>=j-d*d;},e.prototype.intersectsTriangle=function(c,d,f){this._edge1||(this._edge1=b.Vector3.Zero(),this._edge2=b.Vector3.Zero(),this._pvec=b.Vector3.Zero(),this._tvec=b.Vector3.Zero(),this._qvec=b.Vector3.Zero());d.subtractToRef(c,this._edge1);f.subtractToRef(c,this._edge2);b.Vector3.CrossToRef(this.direction,this._edge2,this._pvec);d=b.Vector3.Dot(this._edge1,this._pvec);if(0===d)return null;y4tt.v9();d=1/d;this.origin.subtractToRef(c,this._tvec);c=b.Vector3.Dot(this._tvec,this._pvec)*d;if(0>c||1<c)return null;b.Vector3.CrossToRef(this._tvec,this._edge1,this._qvec);f=b.Vector3.Dot(this.direction,this._qvec)*d;if(0>f||1<c+f)return null;d*=b.Vector3.Dot(this._edge2,this._qvec);return d>this.length?null:new b.IntersectionInfo(c,f,d);},e.prototype.intersectsPlane=function(c){var d,f,e;y4tt.q9();f=b.Vector3.Dot(c.normal,this.direction);if(9.99999997475243E-7>Math.abs(f))return null;e=b.Vector3.Dot(c.normal,this.origin);return d=(-c.d-e)/f,0>d?-9.99999997475243E-7>d?null:0:d;},e.prototype.intersectionSegment=function(c,d,f){var q,j,l,n,g,p,r,s,t,v,y;l=this.origin.add(this.direction.multiplyByFloats(e.rayl,e.rayl,e.rayl));d=d.subtract(c);l=l.subtract(this.origin);c=c.subtract(this.origin);n=b.Vector3.Dot(d,d),g=b.Vector3.Dot(d,l),p=b.Vector3.Dot(l,l),r=b.Vector3.Dot(d,c),s=b.Vector3.Dot(l,c),t=n*p-g*g,v=t,y=t;t<e.smallnum?(q=0,v=1,j=s,y=p):(q=g*s-p*r,j=n*s-g*r,0>q?(q=0,j=s,y=p):q>v&&(q=v,j=s+g,y=p));0>j?(j=0,0>-r?q=0:-r>n?q=v:(q=-r,v=n)):j>y&&(j=y,0>-r+g?q=0:-r+g>n?q=v:(q=-r+g,v=n));q=Math.abs(q)<e.smallnum?0:q/v;y4tt.q9();j=Math.abs(j)<e.smallnum?0:j/y;l=l.multiplyByFloats(j,j,j);d=c.add(d.multiplyByFloats(q,q,q)).subtract(l);return 0<j&&j<=this.length&&d.lengthSquared()<f*f?l.length():-1;},e.CreateNew=function(c,d,f,q,j,l,n){var g;y4tt.v9();g=b.Vector3.Unproject(new b.Vector3(c,d,0),f,q,j,l,n);c=b.Vector3.Unproject(new b.Vector3(c,d,1),f,q,j,l,n).subtract(g);return c.normalize(),new e(g,c);},e.CreateNewFromTo=function(c,d,f){var q;void 0===f&&(f=b.Matrix.Identity());d=d.subtract(c);q=Math.sqrt(d.x*d.x+d.y*d.y+d.z*d.z);return d.normalize(),e.Transform(new e(c,d,q),f);},e.Transform=function(c,d){var f,q;y4tt.v9();f=b.Vector3.TransformCoordinates(c.origin,d),q=b.Vector3.TransformNormal(c.direction,d);return q.normalize(),new e(f,q,c.length);},e.smallnum=1E-8,e.rayl=1E9,e);b.Ray=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;y4tt.q9();e=b.Node,c=function(d,f){var q;q=this;e.call(this,d,f);this.onDisposeObservable=new b.Observable();this.onCollideObservable=new b.Observable();this.onCollisionPositionChangeObservable=new b.Observable();this.onAfterWorldMatrixUpdateObservable=new b.Observable();this.definedFacingForward=!0;this.position=new b.Vector3(0,0,0);this._rotation=new b.Vector3(0,0,0);y4tt.v9();this._scaling=new b.Vector3(1,1,1);this.billboardMode=c.BILLBOARDMODE_NONE;this.visibility=1;this.alphaIndex=Number.MAX_VALUE;this.infiniteDistance=!1;this.isPickable=this.isVisible=!0;this.isBlocker=this.showSubMeshesBoundingBox=this.showBoundingBox=!1;this.renderingGroupId=0;this.renderOutline=this.receiveShadows=!1;this.outlineColor=b.Color3.Red();this.outlineWidth=0.02;this.renderOverlay=!1;this.overlayColor=b.Color3.Red();this.overlayAlpha=0.5;this.hasVertexAlpha=!1;this.computeBonesUsingShaders=this.applyFog=this.useVertexColors=!0;this.scalingDeterminant=1;this.numBoneInfluencers=4;this.useOctreeForCollisions=this.useOctreeForPicking=this.useOctreeForRenderingSelection=!0;this.layerMask=268435455;this._checkCollisions=this.alwaysSelectAsActiveMesh=!1;this.ellipsoid=new b.Vector3(0.5,1,0.5);this.ellipsoidOffset=new b.Vector3(0,0,0);this._collider=new b.Collider();this._oldPositionForCollisions=new b.Vector3(0,0,0);this._diffPositionForCollisions=new b.Vector3(0,0,0);this._newPositionForCollisions=new b.Vector3(0,0,0);this.edgesWidth=1;this.edgesColor=new b.Color4(1,0,0,1);this._localWorld=b.Matrix.Zero();this._worldMatrix=b.Matrix.Zero();this._rotateYByPI=b.Matrix.RotationY(Math.PI);this._absolutePosition=b.Vector3.Zero();this._collisionsTransformMatrix=b.Matrix.Zero();this._collisionsScalingMatrix=b.Matrix.Zero();this._isDirty=!1;this._pivotMatrix=b.Matrix.Identity();this._isDisposed=!1;this._renderId=0;this._intersectionsInProgress=[];this._unIndexed=this._isWorldMatrixFrozen=!1;this._onCollisionPositionChange=function(c,d,f){void 0===f&&(f=null);q.getScene().workerCollisions&&d.multiplyInPlace(q._collider.radius);d.subtractToRef(q._oldPositionForCollisions,q._diffPositionForCollisions);y4tt.q9();q._diffPositionForCollisions.length()>b.Engine.CollisionsEpsilon&&q.position.addInPlace(q._diffPositionForCollisions);f&&q.onCollideObservable.notifyObservers(f);q.onCollisionPositionChangeObservable.notifyObservers(q.position);};f.addMesh(this);};g=(__extends(c,e),Object.defineProperty(c,"BILLBOARDMODE_NONE",{get:function(){return c._BILLBOARDMODE_NONE;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"BILLBOARDMODE_X",{get:function(){y4tt.v9();return c._BILLBOARDMODE_X;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"BILLBOARDMODE_Y",{get:function(){y4tt.v9();return c._BILLBOARDMODE_Y;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"BILLBOARDMODE_Z",{get:function(){return c._BILLBOARDMODE_Z;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"BILLBOARDMODE_ALL",{get:function(){return c._BILLBOARDMODE_ALL;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onCollide",{set:function(b){this._onCollideObserver&&this.onCollideObservable.remove(this._onCollideObserver);this._onCollideObserver=this.onCollideObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onCollisionPositionChange",{set:function(b){y4tt.q9();this._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._onCollisionPositionChangeObserver);this._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"skeleton",{get:function(){return this._skeleton;},set:function(b){this._skeleton&&this._skeleton.needInitialSkinMatrix&&this._skeleton._unregisterMeshWithPoseMatrix(this);y4tt.v9();b&&b.needInitialSkinMatrix&&b._registerMeshWithPoseMatrix(this);(this._skeleton=b)||(this._bonesTransformMatrices=null);},enumerable:!0,configurable:!0}),c.prototype.toString=function(c){var f;f="Name: "+this.name+", isInstance: "+(this instanceof b.InstancedMesh?"YES":"NO");return f+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0),this._skeleton&&(f+=", skeleton: "+this._skeleton.name),c&&(f+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],f+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingFreezeWorldMatrix?"YES":"NO")),f;},Object.defineProperty(c.prototype,"rotation",{get:function(){return this._rotation;},set:function(b){this._rotation=b;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scaling",{get:function(){return this._scaling;},set:function(b){y4tt.q9();this._scaling=b;this.physicsImpostor&&this.physicsImpostor.forceUpdate();},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotationQuaternion",{get:function(){y4tt.v9();return this._rotationQuaternion;},set:function(b){y4tt.v9();(this._rotationQuaternion=b)&&this.rotation.length()&&this.rotation.copyFromFloats(0,0,0);},enumerable:!0,configurable:!0}),c.prototype.updatePoseMatrix=function(b){y4tt.q9();this._poseMatrix.copyFrom(b);},c.prototype.getPoseMatrix=function(){return this._poseMatrix;},c.prototype.disableEdgesRendering=function(){y4tt.q9();void 0!==this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=void 0);},c.prototype.enableEdgesRendering=function(c,f){void 0===c&&(c=0.95);void 0===f&&(f=!1);y4tt.q9();this.disableEdgesRendering();this._edgesRenderer=new b.EdgesRenderer(this,c,f);},Object.defineProperty(c.prototype,"isBlocked",{get:function(){return!1;},enumerable:!0,configurable:!0}),c.prototype.getLOD=function(){return this;},c.prototype.getTotalVertices=function(){return 0;},c.prototype.getIndices=function(){y4tt.v9();return null;},c.prototype.getVerticesData=function(){return null;},c.prototype.isVerticesDataPresent=function(){return!1;},c.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo);},Object.defineProperty(c.prototype,"useBones",{get:function(){y4tt.v9();return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(b.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(b.VertexBuffer.MatricesWeightsKind);},enumerable:!0,configurable:!0}),c.prototype._preActivate=function(){},c.prototype._preActivateForIntermediateRendering=function(){},c.prototype._activate=function(b){this._renderId=b;},c.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():(this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix);},Object.defineProperty(c.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"absolutePosition",{get:function(){y4tt.q9();return this._absolutePosition;},enumerable:!0,configurable:!0}),c.prototype.freezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1;y4tt.v9();this.computeWorldMatrix(!0);this._isWorldMatrixFrozen=!0;},c.prototype.unfreezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1;y4tt.q9();this.computeWorldMatrix(!0);},Object.defineProperty(c.prototype,"isWorldMatrixFrozen",{get:function(){y4tt.q9();return this._isWorldMatrixFrozen;},enumerable:!0,configurable:!0}),c.prototype.rotate=function(c,f,e){c.normalize();this.rotationQuaternion||(this.rotationQuaternion=b.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=b.Vector3.Zero());y4tt.v9();e&&e!==b.Space.LOCAL?(this.parent&&(e=this.parent.getWorldMatrix().clone(),e.invert(),c=b.Vector3.TransformNormal(c,e)),c=b.Quaternion.RotationAxis(c,f),this.rotationQuaternion=c.multiply(this.rotationQuaternion)):(c=b.Quaternion.RotationAxis(c,f),this.rotationQuaternion=this.rotationQuaternion.multiply(c));},c.prototype.translate=function(c,f,e){c=c.scale(f);e&&e!==b.Space.LOCAL?this.setAbsolutePosition(this.getAbsolutePosition().add(c)):(e=this.getPositionExpressedInLocalSpace().add(c),this.setPositionWithLocalVector(e));},c.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition;},c.prototype.setAbsolutePosition=function(c){var f,e,j,l;if(c){if(void 0===c.x){if(3>arguments.length)return;f=arguments[0];e=arguments[1];j=arguments[2];}else f=c.x,e=c.y,j=c.z;if(this.parent){l=this.parent.getWorldMatrix().clone();l.invert();f=new b.Vector3(f,e,j);this.position=b.Vector3.TransformCoordinates(f,l);}else this.position.x=f,this.position.y=e,this.position.z=j;}},c.prototype.movePOV=function(b,c,e){y4tt.q9();this.position.addInPlace(this.calcMovePOV(b,c,e));},c.prototype.calcMovePOV=function(c,f,e){var j,l,n;j=new b.Matrix();(this.rotationQuaternion?this.rotationQuaternion:b.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(j);l=b.Vector3.Zero(),n=this.definedFacingForward?-1:1;return b.Vector3.TransformCoordinatesFromFloatsToRef(c*n,f,e*n,j,l),l;},c.prototype.rotatePOV=function(b,c,e){y4tt.q9();this.rotation.addInPlace(this.calcRotatePOV(b,c,e));},c.prototype.calcRotatePOV=function(c,f,e){var j;y4tt.v9();j=this.definedFacingForward?1:-1;return new b.Vector3(c*j,f,e*j);},c.prototype.setPivotMatrix=function(b){this._pivotMatrix=b;y4tt.v9();this._cache.pivotMatrixUpdated=!0;},c.prototype.getPivotMatrix=function(){y4tt.v9();return this._pivotMatrix;},c.prototype._isSynchronized=function(){if(this._isDirty||(this.billboardMode!==this._cache.billboardMode||this.billboardMode!==c.BILLBOARDMODE_NONE)||this._cache.pivotMatrixUpdated||this.infiniteDistance||!this._cache.position.equals(this.position))return!1;if(this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1;}else if(!this._cache.rotation.equals(this.rotation))return!1;y4tt.q9();return!!this._cache.scaling.equals(this.scaling);},c.prototype._initCache=function(){e.prototype._initCache.call(this);this._cache.localMatrixUpdated=!1;this._cache.position=b.Vector3.Zero();this._cache.scaling=b.Vector3.Zero();this._cache.rotation=b.Vector3.Zero();this._cache.rotationQuaternion=new b.Quaternion(0,0,0,0);this._cache.billboardMode=-1;},c.prototype.markAsDirty=function(b){"rotation"===b&&(this.rotationQuaternion=null);this._currentRenderId=Number.MAX_VALUE;this._isDirty=!0;},c.prototype._updateBoundingInfo=function(){this._boundingInfo=this._boundingInfo||new b.BoundingInfo(this.absolutePosition,this.absolutePosition);this._boundingInfo.update(this.worldMatrixFromCache);this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache);},c.prototype._updateSubMeshesBoundingInfo=function(b){var e;if(this.subMeshes)for(var c=0;c<this.subMeshes.length;c++){e=this.subMeshes[c];e.IsGlobal||e.updateBoundingInfo(b);}},c.prototype.computeWorldMatrix=function(d){var f;if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!d&&(this._currentRenderId===this.getScene().getRenderId()||this.isSynchronized(!0)))return this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._cache.billboardMode=this.billboardMode,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,b.Matrix.ScalingToRef(this.scaling.x*this.scalingDeterminant,this.scaling.y*this.scalingDeterminant,this.scaling.z*this.scalingDeterminant,b.Tmp.Matrix[1]),this.rotationQuaternion)this.rotation.length()&&(this.rotationQuaternion.multiplyInPlace(b.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)),this.rotation.copyFromFloats(0,0,0));if(this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(b.Tmp.Matrix[0]),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(b.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,b.Tmp.Matrix[0]),this._cache.rotation.copyFrom(this.rotation)),this.infiniteDistance&&!this.parent){if(d=this.getScene().activeCamera)d=d.getWorldMatrix(),d=new b.Vector3(d.m[12],d.m[13],d.m[14]),b.Matrix.TranslationToRef(this.position.x+d.x,this.position.y+d.y,this.position.z+d.z,b.Tmp.Matrix[2]);}else b.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,b.Tmp.Matrix[2]);if(this._pivotMatrix.multiplyToRef(b.Tmp.Matrix[1],b.Tmp.Matrix[4]),b.Tmp.Matrix[4].multiplyToRef(b.Tmp.Matrix[0],b.Tmp.Matrix[5]),this.billboardMode!==c.BILLBOARDMODE_NONE&&this.getScene().activeCamera){b.Tmp.Vector3[0].copyFrom(this.position);d=b.Tmp.Vector3[0];if(this.parent&&this.parent.getWorldMatrix){this._markSyncedWithParent();this._meshToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._meshToBoneReferal.getWorldMatrix(),b.Tmp.Matrix[6]),f=b.Tmp.Matrix[6]):f=this.parent.getWorldMatrix();b.Vector3.TransformNormalToRef(d,f,b.Tmp.Vector3[1]);d=b.Tmp.Vector3[1];}f=this.getScene().activeCamera.globalPosition.clone();this.parent&&this.parent.position&&(d.addInPlace(this.parent.position),b.Matrix.TranslationToRef(d.x,d.y,d.z,b.Tmp.Matrix[2]));(this.billboardMode&c.BILLBOARDMODE_ALL)!==c.BILLBOARDMODE_ALL&&(this.billboardMode&c.BILLBOARDMODE_X&&(f.x=d.x+b.Epsilon),this.billboardMode&c.BILLBOARDMODE_Y&&(f.y=d.y+b.Epsilon),this.billboardMode&c.BILLBOARDMODE_Z&&(f.z=d.z+b.Epsilon));b.Matrix.LookAtLHToRef(d,f,b.Vector3.Up(),b.Tmp.Matrix[3]);b.Tmp.Matrix[3].m[12]=b.Tmp.Matrix[3].m[13]=b.Tmp.Matrix[3].m[14]=0;b.Tmp.Matrix[3].invert();b.Tmp.Matrix[5].multiplyToRef(b.Tmp.Matrix[3],this._localWorld);this._rotateYByPI.multiplyToRef(this._localWorld,b.Tmp.Matrix[5]);}return b.Tmp.Matrix[5].multiplyToRef(b.Tmp.Matrix[2],this._localWorld),this.parent&&this.parent.getWorldMatrix&&this.billboardMode===c.BILLBOARDMODE_NONE?(this._markSyncedWithParent(),this._meshToBoneReferal?(this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),b.Tmp.Matrix[6]),b.Tmp.Matrix[6].multiplyToRef(this._meshToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix)):this._worldMatrix.copyFrom(this._localWorld),this._updateBoundingInfo(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=b.Matrix.Invert(this._worldMatrix)),this._worldMatrix;},c.prototype.registerAfterWorldMatrixUpdate=function(b){this.onAfterWorldMatrixUpdateObservable.add(b);},c.prototype.unregisterAfterWorldMatrixUpdate=function(b){y4tt.v9();this.onAfterWorldMatrixUpdateObservable.removeCallback(b);},c.prototype.setPositionWithLocalVector=function(c){this.computeWorldMatrix();this.position=b.Vector3.TransformNormal(c,this._localWorld);},c.prototype.getPositionExpressedInLocalSpace=function(){var c;this.computeWorldMatrix();c=this._localWorld.clone();return c.invert(),b.Vector3.TransformNormal(this.position,c);},c.prototype.locallyTranslate=function(c){this.computeWorldMatrix(!0);this.position=b.Vector3.TransformCoordinates(c,this._localWorld);},c.prototype.lookAt=function(c,f,e,j){var l,n;y4tt.q9();f=f||0;e=e||0;j=j||0;l=c.subtract(this.position);c=-Math.atan2(l.z,l.x)-Math.PI/2;n=Math.sqrt(l.x*l.x+l.z*l.z),l=Math.atan2(l.y,n);this.rotationQuaternion=b.Quaternion.RotationYawPitchRoll(c+f,l+e,j);},c.prototype.attachToBone=function(b,c){this._meshToBoneReferal=c;y4tt.v9();this.parent=b;0>b.getWorldMatrix().determinant()&&(this.scalingDeterminant*=-1);},c.prototype.detachFromBone=function(){y4tt.q9();0>this.parent.getWorldMatrix().determinant()&&(this.scalingDeterminant*=-1);this.parent=this._meshToBoneReferal=null;},c.prototype.isInFrustum=function(b){y4tt.v9();return this._boundingInfo.isInFrustum(b);},c.prototype.isCompletelyInFrustum=function(c){c||(c=this.getScene().activeCamera);c=c.getViewMatrix().multiply(c.getProjectionMatrix());y4tt.q9();return!!this._boundingInfo.isCompletelyInFrustum(b.Frustum.GetPlanes(c));},c.prototype.intersectsMesh=function(b,c){return this._boundingInfo&&b._boundingInfo?this._boundingInfo.intersects(b._boundingInfo,c):!1;},c.prototype.intersectsPoint=function(b){y4tt.v9();return this._boundingInfo?this._boundingInfo.intersectsPoint(b):!1;},c.prototype.setPhysicsState=function(c,f){y4tt.q9();return c.impostor&&(f=c,c=c.impostor),this.physicsImpostor=new b.PhysicsImpostor(this,c,f,this.getScene()),this.physicsImpostor.physicsBody;},c.prototype.getPhysicsImpostor=function(){return this.physicsImpostor;},c.prototype.getPhysicsMass=function(){y4tt.v9();return this.physicsImpostor.getParam("mass");},c.prototype.getPhysicsFriction=function(){return this.physicsImpostor.getParam("friction");},c.prototype.getPhysicsRestitution=function(){y4tt.v9();return this.physicsImpostor.getParam("resitution");},c.prototype.getPositionInCameraSpace=function(c){y4tt.q9();return c||(c=this.getScene().activeCamera),b.Vector3.TransformCoordinates(this.absolutePosition,c.getViewMatrix());},c.prototype.getDistanceToCamera=function(b){return b||(b=this.getScene().activeCamera),this.absolutePosition.subtract(b.position).length();},c.prototype.applyImpulse=function(b,c){this.physicsImpostor&&this.physicsImpostor.applyImpulse(b,c);},c.prototype.setPhysicsLinkWith=function(c,f,e,j){this.physicsImpostor&&c.physicsImpostor&&this.physicsImpostor.createJoint(c.physicsImpostor,b.PhysicsJoint.HingeJoint,{mainPivot:f,connectedPivot:e,nativeParams:j});},c.prototype.updatePhysicsBodyPosition=function(){y4tt.v9();b.Tools.Warn("updatePhysicsBodyPosition() is deprecated, please use updatePhysicsBody()");this.updatePhysicsBody();},c.prototype.updatePhysicsBody=function(){},Object.defineProperty(c.prototype,"checkCollisions",{get:function(){return this._checkCollisions;},set:function(b){this._checkCollisions=b;this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this);},enumerable:!0,configurable:!0}),c.prototype.moveWithCollisions=function(b){this.getAbsolutePosition().subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions);this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset);this._collider.radius=this.ellipsoid;this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,b,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId);},c.prototype.createOrUpdateSubmeshesOctree=function(c,f){var e;void 0===c&&(c=64);void 0===f&&(f=2);this._submeshesOctree||(this._submeshesOctree=new b.Octree(b.Octree.CreationFuncForSubMeshes,c,f));this.computeWorldMatrix(!0);e=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(e.minimumWorld,e.maximumWorld,this.subMeshes),this._submeshesOctree;},c.prototype._collideForSubMesh=function(c,f,e){if(this._generatePointsArray(),!c._lastColliderWorldVertices||!c._lastColliderTransformMatrix.equals(f)){c._lastColliderTransformMatrix=f.clone();c._lastColliderWorldVertices=[];c._trianglePlanes=[];for(var j=c.verticesStart+c.verticesCount,l=c.verticesStart;j>l;l++)c._lastColliderWorldVertices.push(b.Vector3.TransformCoordinates(this._positions[l],f));}e._collide(c._trianglePlanes,c._lastColliderWorldVertices,this.getIndices(),c.indexStart,c.indexStart+c.indexCount,c.verticesStart,!!c.getMaterial());e.collisionFound&&(e.collidedMesh=this);},c.prototype._processCollisionsForSubMeshes=function(b,c){var e,j,n;this._submeshesOctree&&this.useOctreeForCollisions?(j=b.velocityWorldLength+Math.max(b.radius.x,b.radius.y,b.radius.z),e=this._submeshesOctree.intersects(b.basePointWorld,j),j=e.length,e=e.data):(e=this.subMeshes,j=e.length);for(var l=0;j>l;l++){n=e[l];1<j&&!n._checkCollision(b)||this._collideForSubMesh(n,c,b);}},c.prototype._checkCollision=function(c){y4tt.v9();this._boundingInfo._checkCollision(c)&&(b.Matrix.ScalingToRef(1/c.radius.x,1/c.radius.y,1/c.radius.z,this._collisionsScalingMatrix),this.worldMatrixFromCache.multiplyToRef(this._collisionsScalingMatrix,this._collisionsTransformMatrix),this._processCollisionsForSubMeshes(c,this._collisionsTransformMatrix));},c.prototype._generatePointsArray=function(){y4tt.q9();return!1;},c.prototype.intersects=function(c,f){var e,j,l,n,p;e=new b.PickingInfo();if(!this.subMeshes||(!this._boundingInfo||!c.intersectsSphere(this._boundingInfo.boundingSphere)||!c.intersectsBox(this._boundingInfo.boundingBox))||!this._generatePointsArray())return e;n=null;this._submeshesOctree&&this.useOctreeForPicking?(l=b.Ray.Transform(c,this.getWorldMatrix()),j=this._submeshesOctree.intersectsRay(l),l=j.length,j=j.data):(j=this.subMeshes,l=j.length);for(var g=0;l>g;g++){p=j[g];if(!(1<l)||p.canIntersects(c))if((p=p.intersects(c,this._positions,this.getIndices(),f))&&(f||!n||p.distance<n.distance)&&(n=p,n.subMeshId=g,f))break;}return n?(j=this.getWorldMatrix(),l=b.Vector3.TransformCoordinates(c.origin,j),g=c.direction.clone(),g=g.scale(n.distance),j=b.Vector3.TransformNormal(g,j),j=l.add(j),e.hit=!0,e.distance=b.Vector3.Distance(l,j),e.pickedPoint=j,e.pickedMesh=this,e.bu=n.bu,e.bv=n.bv,e.faceId=n.faceId,e.subMeshId=n.subMeshId,e):e;},c.prototype.clone=function(){return null;},c.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=[];},c.prototype.dispose=function(b){var c,q,j,l;q=this;this.actionManager&&(this.actionManager.dispose(),this.actionManager=null);this.skeleton=null;this.getScene().stopAnimation(this);this.physicsImpostor&&this.physicsImpostor.dispose();for(c=0;c<this._intersectionsInProgress.length;c++){j=this._intersectionsInProgress[c],l=j._intersectionsInProgress.indexOf(this);j._intersectionsInProgress.splice(l,1);}this._intersectionsInProgress=[];if(this.getScene().lights.forEach(function(b){var c;c=b.includedOnlyMeshes.indexOf(q);-1!==c&&b.includedOnlyMeshes.splice(c,1);y4tt.q9();c=b.excludedMeshes.indexOf(q);-1!==c&&b.excludedMeshes.splice(c,1);}),this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this.releaseSubMeshes(),this.getScene().removeMesh(this),b){b=this.getChildMeshes(!0);for(c=0;c<b.length;c++)j=b[c],j.parent=null,j.computeWorldMatrix(!0);}else{for(c=0;c<this.getScene().particleSystems.length;c++)this.getScene().particleSystems[c].emitter===this&&(this.getScene().particleSystems[c].dispose(),c--);b=this.getDescendants(!0);for(c=0;c<b.length;c++)b[c].dispose();}e.prototype.dispose.call(this);this.onAfterWorldMatrixUpdateObservable.clear();this.onCollideObservable.clear();this.onCollisionPositionChangeObservable.clear();this._isDisposed=!0;this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();},c._BILLBOARDMODE_NONE=0,c._BILLBOARDMODE_X=1,c._BILLBOARDMODE_Y=2,c._BILLBOARDMODE_Z=4,c._BILLBOARDMODE_ALL=7,c);b.AbstractMesh=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.Node,c=function(c,f){e.call(this,c,f);this.diffuse=new b.Color3(1,1,1);this.specular=new b.Color3(1,1,1);this.intensity=1;this.range=Number.MAX_VALUE;this.includeOnlyWithLayerMask=0;this.includedOnlyMeshes=[];this.excludedMeshes=[];this.excludeWithLayerMask=0;y4tt.q9();this.radius=1E-5;this._excludedMeshesIds=[];this._includedOnlyMeshesIds=[];f.addLight(this);};g=(__extends(c,e),c.prototype.toString=function(b){var c;y4tt.v9();c="Name: "+this.name;if(c+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var e=0;e<this.animations.length;e++)c+=", animation[0]: "+this.animations[e].toString(b);return c;},c.prototype.getShadowGenerator=function(){y4tt.v9();return this._shadowGenerator;},c.prototype.getAbsolutePosition=function(){return b.Vector3.Zero();},c.prototype.transferToEffect=function(){},c.prototype._getWorldMatrix=function(){return b.Matrix.Identity();},c.prototype.canAffectMesh=function(b){return b?0<this.includedOnlyMeshes.length&&-1===this.includedOnlyMeshes.indexOf(b)?!1:0<this.excludedMeshes.length&&-1!==this.excludedMeshes.indexOf(b)?!1:0!==this.includeOnlyWithLayerMask&&0===(this.includeOnlyWithLayerMask&b.layerMask)?!1:!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&b.layerMask):!0;},c.prototype.getWorldMatrix=function(){var c;this._currentRenderId=this.getScene().getRenderId();c=this._getWorldMatrix();return this.parent&&this.parent.getWorldMatrix?(this._parentedWorldMatrix||(this._parentedWorldMatrix=b.Matrix.Identity()),c.multiplyToRef(this.parent.getWorldMatrix(),this._parentedWorldMatrix),this._markSyncedWithParent(),this._parentedWorldMatrix):c;},c.prototype.dispose=function(){this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null);y4tt.v9();this.getScene().stopAnimation(this);this.getScene().removeLight(this);e.prototype.dispose.call(this);},c.prototype.getTypeID=function(){y4tt.v9();return 0;},c.prototype.clone=function(d){return b.SerializationHelper.Clone(c.GetConstructorFromName(this.getTypeID(),d,this.getScene()),this);},c.prototype.serialize=function(){var c;y4tt.v9();c=b.SerializationHelper.Serialize(this);return c.type=this.getTypeID(),this.parent&&(c.parentId=this.parent.id),0<this.excludedMeshes.length&&(c.excludedMeshesIds=[],this.excludedMeshes.forEach(function(b){y4tt.q9();c.excludedMeshesIds.push(b.id);})),0<this.includedOnlyMeshes.length&&(c.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(b){c.includedOnlyMeshesIds.push(b.id);})),b.Animation.AppendSerializedAnimations(this,c),c.ranges=this.serializeAnimationRanges(),c;},c.GetConstructorFromName=function(c,f,e){switch(c){case 0:return function(){return new b.PointLight(f,b.Vector3.Zero(),e);};case 1:return function(){y4tt.v9();return new b.DirectionalLight(f,b.Vector3.Zero(),e);};case 2:return function(){y4tt.q9();return new b.SpotLight(f,b.Vector3.Zero(),b.Vector3.Zero(),0,0,e);};case 3:return function(){return new b.HemisphericLight(f,b.Vector3.Zero(),e);};}},c.Parse=function(d,f){var e;e=b.SerializationHelper.Parse(c.GetConstructorFromName(d.type,d.name,f),d,f);if(d.excludedMeshesIds&&(e._excludedMeshesIds=d.excludedMeshesIds),d.includedOnlyMeshesIds&&(e._includedOnlyMeshesIds=d.includedOnlyMeshesIds),d.parentId&&(e._waitingParentId=d.parentId),d.animations){for(var j=0;j<d.animations.length;j++)e.animations.push(b.Animation.Parse(d.animations[j]));b.Node.ParseAnimationRanges(e,d,f);}return d.autoAnimate&&f.beginAnimation(e,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1),e;},__decorate([b.serializeAsColor3()],c.prototype,"diffuse",void 0),__decorate([b.serializeAsColor3()],c.prototype,"specular",void 0),__decorate([b.serialize()],c.prototype,"intensity",void 0),__decorate([b.serialize()],c.prototype,"range",void 0),__decorate([b.serialize()],c.prototype,"includeOnlyWithLayerMask",void 0),__decorate([b.serialize()],c.prototype,"excludeWithLayerMask",void 0),__decorate([b.serialize()],c.prototype,"radius",void 0),c);b.Light=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.Light;g=function(b,d,f){e.call(this,b,f);this.position=d;};g=(__extends(g,e),g.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position;},g.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=b.Vector3.Zero()),b.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1;},g.prototype.transferToEffect=function(b,d){y4tt.v9();return this.parent&&this.parent.getWorldMatrix?(this.computeTransformedPosition(),void b.setFloat4(d,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0)):void b.setFloat4(d,this.position.x,this.position.y,this.position.z,0);},g.prototype.needCube=function(){y4tt.v9();return!0;},g.prototype.supportsVSM=function(){y4tt.v9();return!1;},g.prototype.needRefreshPerFrame=function(){y4tt.v9();return!1;},g.prototype.getShadowDirection=function(c){y4tt.v9();switch(c){case 0:return new b.Vector3(1,0,0);case 1:return new b.Vector3(-1,0,0);case 2:return new b.Vector3(0,-1,0);case 3:return new b.Vector3(0,1,0);case 4:return new b.Vector3(0,0,1);case 5:return new b.Vector3(0,0,-1);}return b.Vector3.Zero();},g.prototype.setShadowProjectionMatrix=function(c){var d;y4tt.q9();d=this.getScene().activeCamera;b.Matrix.PerspectiveFovLHToRef(Math.PI/2,1,d.minZ,d.maxZ,c);},g.prototype._getWorldMatrix=function(){y4tt.v9();return this._worldMatrix||(this._worldMatrix=b.Matrix.Identity()),b.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix;},g.prototype.getTypeID=function(){y4tt.v9();return 0;},__decorate([b.serializeAsVector3()],g.prototype,"position",void 0),g);b.PointLight=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.Light;g=function(b,d,f,q,j,l){e.call(this,b,l);this.position=d;this.direction=f;this.angle=q;this.exponent=j;};g=(__extends(g,e),g.prototype.getAbsolutePosition=function(){y4tt.v9();return this.transformedPosition?this.transformedPosition:this.position;},g.prototype.setShadowProjectionMatrix=function(c){var d;d=this.getScene().activeCamera;y4tt.v9();b.Matrix.PerspectiveFovLHToRef(this.angle,1,d.minZ,d.maxZ,c);},g.prototype.needCube=function(){y4tt.q9();return!1;},g.prototype.supportsVSM=function(){return!0;},g.prototype.needRefreshPerFrame=function(){y4tt.v9();return!1;},g.prototype.getShadowDirection=function(){y4tt.v9();return this.direction;},g.prototype.setDirectionToTarget=function(c){return this.direction=b.Vector3.Normalize(c.subtract(this.position)),this.direction;},g.prototype.computeTransformedPosition=function(){y4tt.q9();return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=b.Vector3.Zero()),b.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1;},g.prototype.transferToEffect=function(c,d,f){var e;this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=b.Vector3.Zero()),this.computeTransformedPosition(),b.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),c.setFloat4(d,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent),e=b.Vector3.Normalize(this._transformedDirection)):(c.setFloat4(d,this.position.x,this.position.y,this.position.z,this.exponent),e=b.Vector3.Normalize(this.direction));c.setFloat4(f,e.x,e.y,e.z,Math.cos(0.5*this.angle));},g.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=b.Matrix.Identity()),b.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix;},g.prototype.getTypeID=function(){return 2;},__decorate([b.serializeAsVector3()],g.prototype,"position",void 0),__decorate([b.serializeAsVector3()],g.prototype,"direction",void 0),__decorate([b.serialize()],g.prototype,"angle",void 0),__decorate([b.serialize()],g.prototype,"exponent",void 0),g);b.SpotLight=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.Light;g=function(c,d,f){e.call(this,c,f);this.groundColor=new b.Color3(0,0,0);this.direction=d;};g=(__extends(g,e),g.prototype.setDirectionToTarget=function(c){y4tt.v9();return this.direction=b.Vector3.Normalize(c.subtract(b.Vector3.Zero())),this.direction;},g.prototype.getShadowGenerator=function(){y4tt.q9();return null;},g.prototype.transferToEffect=function(c,d,f){var e;e=b.Vector3.Normalize(this.direction);y4tt.q9();c.setFloat4(d,e.x,e.y,e.z,0);c.setColor3(f,this.groundColor.scale(this.intensity));},g.prototype._getWorldMatrix=function(){y4tt.v9();return this._worldMatrix||(this._worldMatrix=b.Matrix.Identity()),this._worldMatrix;},g.prototype.getTypeID=function(){return 3;},__decorate([b.serializeAsColor3()],g.prototype,"groundColor",void 0),__decorate([b.serializeAsVector3()],g.prototype,"direction",void 0),g);b.HemisphericLight=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.Light;g=function(b,d,f){e.call(this,b,f);this.shadowOrthoScale=0.5;this.autoUpdateExtends=!0;this._orthoLeft=Number.MAX_VALUE;this._orthoTop=this._orthoRight=Number.MIN_VALUE;this._orthoBottom=Number.MAX_VALUE;y4tt.v9();this.position=d.scale(-1);this.direction=d;};g=(__extends(g,e),g.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position;},g.prototype.setDirectionToTarget=function(c){y4tt.q9();return this.direction=b.Vector3.Normalize(c.subtract(this.position)),this.direction;},g.prototype.setShadowProjectionMatrix=function(c,d,f){var e,j,n;e=this.getScene().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){j=b.Vector3.Zero();this._orthoLeft=Number.MAX_VALUE;this._orthoTop=this._orthoRight=Number.MIN_VALUE;this._orthoBottom=Number.MAX_VALUE;for(var l=0;l<f.length;l++){n=f[l];if(n&&(n=n.getBoundingInfo()))for(var n=n.boundingBox,g=0;g<n.vectorsWorld.length;g++)b.Vector3.TransformCoordinatesToRef(n.vectorsWorld[g],d,j),j.x<this._orthoLeft&&(this._orthoLeft=j.x),j.y<this._orthoBottom&&(this._orthoBottom=j.y),j.x>this._orthoRight&&(this._orthoRight=j.x),j.y>this._orthoTop&&(this._orthoTop=j.y);}}d=this._orthoRight-this._orthoLeft;f=this._orthoTop-this._orthoBottom;b.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-d*this.shadowOrthoScale,this._orthoRight+d*this.shadowOrthoScale,this._orthoBottom-f*this.shadowOrthoScale,this._orthoTop+f*this.shadowOrthoScale,-e.maxZ,e.maxZ,c);},g.prototype.supportsVSM=function(){return!0;},g.prototype.needRefreshPerFrame=function(){return!0;},g.prototype.needCube=function(){return!1;},g.prototype.getShadowDirection=function(){return this.direction;},g.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=b.Vector3.Zero()),b.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1;},g.prototype.transferToEffect=function(c,d){return this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=b.Vector3.Zero()),b.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),void c.setFloat4(d,this._transformedDirection.x,this._transformedDirection.y,this._transformedDirection.z,1)):void c.setFloat4(d,this.direction.x,this.direction.y,this.direction.z,1);},g.prototype._getWorldMatrix=function(){y4tt.q9();return this._worldMatrix||(this._worldMatrix=b.Matrix.Identity()),b.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix;},g.prototype.getTypeID=function(){y4tt.q9();return 1;},__decorate([b.serializeAsVector3()],g.prototype,"position",void 0),__decorate([b.serializeAsVector3()],g.prototype,"direction",void 0),__decorate([b.serialize()],g.prototype,"shadowOrthoScale",void 0),__decorate([b.serialize()],g.prototype,"autoUpdateExtends",void 0),g);y4tt.v9();b.DirectionalLight=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(c,d){var f,q;f=this;this._filter=e.FILTER_NONE;this.blurScale=2;this._blurBoxOffset=0;this._bias=5E-5;this._lightDirection=b.Vector3.Zero();this.forceBackFacesOnly=!1;this._darkness=0;this._transparencyShadow=!1;this._viewMatrix=b.Matrix.Zero();this._projectionMatrix=b.Matrix.Zero();this._transformMatrix=b.Matrix.Zero();this._worldViewProjection=b.Matrix.Zero();this._currentFaceIndexCache=this._currentFaceIndex=0;this._light=d;this._scene=d.getScene();this._mapSize=c;d._shadowGenerator=this;this._shadowMap=new b.RenderTargetTexture(d.name+"_shadowMap",c,this._scene,!1,!0,b.Engine.TEXTURETYPE_UNSIGNED_INT,d.needCube());this._shadowMap.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._shadowMap.wrapV=b.Texture.CLAMP_ADDRESSMODE;this._shadowMap.anisotropicFilteringLevel=1;this._shadowMap.updateSamplingMode(b.Texture.NEAREST_SAMPLINGMODE);this._shadowMap.renderParticles=!1;this._shadowMap.onBeforeRenderObservable.add(function(b){f._currentFaceIndex=b;});this._shadowMap.onAfterUnbindObservable.add(function(){y4tt.q9();f.useBlurVarianceShadowMap&&(f._shadowMap2||(f._shadowMap2=new b.RenderTargetTexture(d.name+"_shadowMap",c,f._scene,!1),f._shadowMap2.wrapU=b.Texture.CLAMP_ADDRESSMODE,f._shadowMap2.wrapV=b.Texture.CLAMP_ADDRESSMODE,f._shadowMap2.updateSamplingMode(b.Texture.TRILINEAR_SAMPLINGMODE),f._downSamplePostprocess=new b.PassPostProcess("downScale",1/f.blurScale,null,b.Texture.BILINEAR_SAMPLINGMODE,f._scene.getEngine()),f._downSamplePostprocess.onApplyObservable.add(function(b){b.setTexture("textureSampler",f._shadowMap);}),f.blurBoxOffset=1),f._scene.postProcessManager.directRender([f._downSamplePostprocess,f._boxBlurPostprocess],f._shadowMap2.getInternalTexture()));});q=function(c){var d,e,q,g,r,s;d=c.getRenderingMesh(),e=f._scene,q=e.getEngine();q.setState(c.getMaterial().backFaceCulling);y4tt.v9();g=d._getInstancesRenderList(c._id);if(!g.mustReturn){r=null!==q.getCaps().instancedArrays&&null!==g.visibleInstances[c._id]&&void 0!==g.visibleInstances[c._id];if(f.isReady(c,r)){q.enableEffect(f._effect);d._bind(c,f._effect,b.Material.TriangleFillMode);s=c.getMaterial();if(f._effect.setMatrix("viewProjection",f.getTransformMatrix()),f._effect.setVector3("lightPosition",f.getLight().position),f.getLight().needCube()&&f._effect.setFloat2("depthValues",e.activeCamera.minZ,e.activeCamera.maxZ),s&&s.needAlphaTesting())e=s.getAlphaTestTexture(),f._effect.setTexture("diffuseSampler",e),f._effect.setMatrix("diffuseMatrix",e.getTextureMatrix());d.useBones&&d.computeBonesUsingShaders&&f._effect.setMatrices("mBones",d.skeleton.getTransformMatrices(d));f.forceBackFacesOnly&&q.setState(!0,0,!1,!0);d._processRendering(c,f._effect,b.Material.TriangleFillMode,g,r,function(b,c){return f._effect.setMatrix("world",c);});f.forceBackFacesOnly&&q.setState(!0,0,!1,!1);}else f._shadowMap.resetRefreshCounter();}};this._shadowMap.customRenderFunction=function(b,c,d){var e;for(e=0;e<b.length;e++)q(b.data[e]);for(e=0;e<c.length;e++)q(c.data[e]);y4tt.q9();if(f._transparencyShadow)for(e=0;e<d.length;e++)q(d.data[e]);};this._shadowMap.onClearObservable.add(function(c){f.useBlurVarianceShadowMap||f.useVarianceShadowMap?c.clear(new b.Color4(0,0,0,0),!0,!0):c.clear(new b.Color4(1,1,1,1),!0,!0);});};y4tt.q9();g=(Object.defineProperty(e,"FILTER_NONE",{get:function(){y4tt.q9();return e._FILTER_NONE;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FILTER_VARIANCESHADOWMAP",{get:function(){y4tt.v9();return e._FILTER_VARIANCESHADOWMAP;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FILTER_POISSONSAMPLING",{get:function(){return e._FILTER_POISSONSAMPLING;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FILTER_BLURVARIANCESHADOWMAP",{get:function(){return e._FILTER_BLURVARIANCESHADOWMAP;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bias",{get:function(){y4tt.v9();return this._bias;},set:function(b){y4tt.v9();this._bias=b;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurBoxOffset",{get:function(){y4tt.v9();return this._blurBoxOffset;},set:function(c){var d;d=this;this._blurBoxOffset!==c&&(this._blurBoxOffset=c,this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=new b.PostProcess("DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1/this.blurScale,null,b.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define OFFSET "+c),this._boxBlurPostprocess.onApplyObservable.add(function(b){y4tt.q9();b.setFloat2("screenSize",d._mapSize/d.blurScale,d._mapSize/d.blurScale);}));},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filter",{get:function(){y4tt.v9();return this._filter;},set:function(c){y4tt.q9();this._filter!==c&&(this._filter=c,this.useVarianceShadowMap||this.useBlurVarianceShadowMap||this.usePoissonSampling?(this._shadowMap.anisotropicFilteringLevel=16,this._shadowMap.updateSamplingMode(b.Texture.BILINEAR_SAMPLINGMODE)):(this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(b.Texture.NEAREST_SAMPLINGMODE)));},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useVarianceShadowMap",{get:function(){return this.filter===e.FILTER_VARIANCESHADOWMAP&&this._light.supportsVSM();},set:function(b){y4tt.q9();this.filter=b?e.FILTER_VARIANCESHADOWMAP:e.FILTER_NONE;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePoissonSampling",{get:function(){y4tt.v9();return this.filter===e.FILTER_POISSONSAMPLING||!this._light.supportsVSM()&&(this.filter===e.FILTER_VARIANCESHADOWMAP||this.filter===e.FILTER_BLURVARIANCESHADOWMAP);},set:function(b){this.filter=b?e.FILTER_POISSONSAMPLING:e.FILTER_NONE;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurVarianceShadowMap",{get:function(){y4tt.q9();return this.filter===e.FILTER_BLURVARIANCESHADOWMAP&&this._light.supportsVSM();},set:function(b){this.filter=b?e.FILTER_BLURVARIANCESHADOWMAP:e.FILTER_NONE;},enumerable:!0,configurable:!0}),e.prototype.isReady=function(c,d){var f,e,j,l;f=[];(this.useVarianceShadowMap||this.useBlurVarianceShadowMap)&&f.push("#define VSM");this.getLight().needCube()&&f.push("#define CUBEMAP");e=[b.VertexBuffer.PositionKind],j=c.getMesh(),l=c.getMaterial();l&&l.needAlphaTesting()&&(f.push("#define ALPHATEST"),j.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(e.push(b.VertexBuffer.UVKind),f.push("#define UV1")),j.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(e.push(b.VertexBuffer.UV2Kind),f.push("#define UV2")));y4tt.q9();j.useBones&&j.computeBonesUsingShaders?(e.push(b.VertexBuffer.MatricesIndicesKind),e.push(b.VertexBuffer.MatricesWeightsKind),4<j.numBoneInfluencers&&(e.push(b.VertexBuffer.MatricesIndicesExtraKind),e.push(b.VertexBuffer.MatricesWeightsExtraKind)),f.push("#define NUM_BONE_INFLUENCERS "+j.numBoneInfluencers),f.push("#define BonesPerMesh "+(j.skeleton.bones.length+1))):f.push("#define NUM_BONE_INFLUENCERS 0");d&&(f.push("#define INSTANCES"),e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"));f=f.join("\n");return this._cachedDefines!==f&&(this._cachedDefines=f,this._effect=this._scene.getEngine().createEffect("shadowMap",e,"world mBones viewProjection diffuseMatrix lightPosition depthValues".split(7108>(3990,4421)?" ":0x6d0),["diffuseSampler"],f)),this._effect.isReady();},e.prototype.getShadowMap=function(){y4tt.q9();return this._shadowMap;},e.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap;},e.prototype.getLight=function(){return this._light;},e.prototype.getTransformMatrix=function(){var c;c=this._scene;if(this._currentRenderID===c.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=c.getRenderId();this._currentFaceIndexCache=this._currentFaceIndex;c=this._light.position;return b.Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(b.Vector3.Dot(this._lightDirection,b.Vector3.Up()))&&(this._lightDirection.z=1E-13),this._light.computeTransformedPosition()&&(c=this._light.transformedPosition),!this._light.needRefreshPerFrame()&&this._cachedPosition&&this._cachedDirection&&c.equals(this._cachedPosition)&&this._lightDirection.equals(this._cachedDirection)||(this._cachedPosition=c.clone(),this._cachedDirection=this._lightDirection.clone(),b.Matrix.LookAtLHToRef(c,c.add(this._lightDirection),b.Vector3.Up(),this._viewMatrix),this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,this.getShadowMap().renderList),this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)),this._transformMatrix;},e.prototype.getDarkness=function(){y4tt.q9();return this._darkness;},e.prototype.setDarkness=function(b){1<=b?this._darkness=1:0>=b?this._darkness=0:this._darkness=b;},e.prototype.setTransparencyShadow=function(b){this._transparencyShadow=b;},e.prototype._packHalf=function(c){var d;d=255*c,d=d-Math.floor(d);y4tt.v9();return new b.Vector2(c-d/255,d);},e.prototype.dispose=function(){this._shadowMap.dispose();this._shadowMap2&&this._shadowMap2.dispose();this._downSamplePostprocess&&this._downSamplePostprocess.dispose();this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose();},e.prototype.serialize=function(){var b,f;b={};b.lightId=this._light.id;b.mapSize=this.getShadowMap().getRenderSize();b.useVarianceShadowMap=this.useVarianceShadowMap;b.usePoissonSampling=this.usePoissonSampling;b.forceBackFacesOnly=this.forceBackFacesOnly;b.renderList=[];for(var d=0;d<this.getShadowMap().renderList.length;d++){f=this.getShadowMap().renderList[d];b.renderList.push(f.id);}return b;},e.Parse=function(b,d){y4tt.q9();for(var f=d.getLightByID(b.lightId),q=new e(b.mapSize,f),f=0;f<b.renderList.length;f++)d.getMeshesByID(b.renderList[f]).forEach(function(b){q.getShadowMap().renderList.push(b);});return b.usePoissonSampling?q.usePoissonSampling=!0:b.useVarianceShadowMap?q.useVarianceShadowMap=!0:b.useBlurVarianceShadowMap&&(q.useBlurVarianceShadowMap=!0,b.blurScale&&(q.blurScale=b.blurScale),b.blurBoxOffset&&(q.blurBoxOffset=b.blurBoxOffset)),void 0!==b.bias&&(q.bias=b.bias),q.forceBackFacesOnly=b.forceBackFacesOnly,q;},e._FILTER_NONE=0,e._FILTER_VARIANCESHADOWMAP=1,e._FILTER_POISSONSAMPLING=2,e._FILTER_BLURVARIANCESHADOWMAP=3,e);b.ShadowGenerator=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;g=function(b,d,f,e){var j,l;j=d*d-4*b*f;f={root:0,found:!1};y4tt.q9();if(0>j)return f;l=Math.sqrt(j),j=(-d-l)/(2*b);b=(-d+l)/(2*b);j>b&&(d=b,b=j,j=d);return 0<j&&e>j?(f.root=j,f.found=!0,f):0<b&&e>b?(f.root=b,f.found=!0,f):f;};e=function(){this.radius=new b.Vector3(1,1,1);this.retry=0;this.basePointWorld=b.Vector3.Zero();this.velocityWorld=b.Vector3.Zero();this.normalizedVelocity=b.Vector3.Zero();this._collisionPoint=b.Vector3.Zero();this._planeIntersectionPoint=b.Vector3.Zero();this._tempVector=b.Vector3.Zero();this._tempVector2=b.Vector3.Zero();this._tempVector3=b.Vector3.Zero();this._tempVector4=b.Vector3.Zero();this._edge=b.Vector3.Zero();this._baseToVertex=b.Vector3.Zero();this._destinationPoint=b.Vector3.Zero();this._slidePlaneNormal=b.Vector3.Zero();this._displacementVector=b.Vector3.Zero();};e=(e.prototype._initialize=function(c,d,f){this.velocity=d;b.Vector3.NormalizeToRef(d,this.normalizedVelocity);this.basePoint=c;c.multiplyToRef(this.radius,this.basePointWorld);d.multiplyToRef(this.radius,this.velocityWorld);this.velocityWorldLength=this.velocityWorld.length();this.epsilon=f;this.collisionFound=!1;},e.prototype._checkPointInTriangle=function(c,d,f,e,j){d.subtractToRef(c,this._tempVector);f.subtractToRef(c,this._tempVector2);b.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);d=b.Vector3.Dot(this._tempVector4,j);return 0>d?!1:(e.subtractToRef(c,this._tempVector3),b.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),d=b.Vector3.Dot(this._tempVector4,j),0>d?!1:(b.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),d=b.Vector3.Dot(this._tempVector4,j),0<=d));},e.prototype._canDoCollision=function(c,d,f,e){var j;c=b.Vector3.Distance(this.basePointWorld,c);j=Math.max(this.radius.x,this.radius.y,this.radius.z);y4tt.v9();return c>this.velocityWorldLength+j+d?!1:!!(f.x>this.basePointWorld.x+(this.velocityWorldLength+j)?0:this.basePointWorld.x-(this.velocityWorldLength+j)>e.x?0:f.y>this.basePointWorld.y+(this.velocityWorldLength+j)?0:this.basePointWorld.y-(this.velocityWorldLength+j)>e.y?0:f.z>this.basePointWorld.z+(this.velocityWorldLength+j)?0:!(this.basePointWorld.z-(this.velocityWorldLength+j)>e.z));},e.prototype._testTriangle=function(c,d,f,e,j,l){var n,m,p,r,s,t,v,y;m=!1;d||(d=[]);d[c]||(d[c]=new b.Plane(0,0,0,0),d[c].copyFromPoints(f,e,j));y4tt.v9();d=d[c];if(l||d.isFrontFacingTo(this.normalizedVelocity,0)){l=d.signedDistanceTo(this.basePoint);c=b.Vector3.Dot(d.normal,this.velocity);if(0==c){if(1<=Math.abs(l))return;m=!0;n=0;}else{n=(-1-l)/c;l=(1-l)/c;n>l&&(c=l,l=n,n=c);if(1<n||0>l)return;0>n&&(n=0);1<n&&(n=1);}this._collisionPoint.copyFromFloats(0,0,0);l=!1;c=1;if(m||(this.basePoint.subtractToRef(d.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(n,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,f,e,j,d.normal)&&(l=!0,c=n,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!l){d=m=this.velocity.lengthSquared();this.basePoint.subtractToRef(f,this._tempVector);n=2*b.Vector3.Dot(this.velocity,this._tempVector);p=this._tempVector.lengthSquared()-1,r=g(d,n,p,c);r.found&&(c=r.root,l=!0,this._collisionPoint.copyFrom(f));this.basePoint.subtractToRef(e,this._tempVector);n=2*b.Vector3.Dot(this.velocity,this._tempVector);p=this._tempVector.lengthSquared()-1;r=g(d,n,p,c);r.found&&(c=r.root,l=!0,this._collisionPoint.copyFrom(e));this.basePoint.subtractToRef(j,this._tempVector);n=2*b.Vector3.Dot(this.velocity,this._tempVector);p=this._tempVector.lengthSquared()-1;r=g(d,n,p,c);r.found&&(c=r.root,l=!0,this._collisionPoint.copyFrom(j));e.subtractToRef(f,this._edge);f.subtractToRef(this.basePoint,this._baseToVertex);s=this._edge.lengthSquared(),t=b.Vector3.Dot(this._edge,this.velocity),v=b.Vector3.Dot(this._edge,this._baseToVertex);if(d=s*-m+t*t,n=s*2*b.Vector3.Dot(this.velocity,this._baseToVertex)-2*t*v,p=s*(1-this._baseToVertex.lengthSquared())+v*v,r=g(d,n,p,c),r.found){y=(t*r.root-v)/s;0<=y&&1>=y&&(c=r.root,l=!0,this._edge.scaleInPlace(y),f.addToRef(this._edge,this._collisionPoint));}j.subtractToRef(e,this._edge);e.subtractToRef(this.basePoint,this._baseToVertex);s=this._edge.lengthSquared();t=b.Vector3.Dot(this._edge,this.velocity);v=b.Vector3.Dot(this._edge,this._baseToVertex);d=s*-m+t*t;n=s*2*b.Vector3.Dot(this.velocity,this._baseToVertex)-2*t*v;p=s*(1-this._baseToVertex.lengthSquared())+v*v;r=g(d,n,p,c);r.found&&(y=(t*r.root-v)/s,0<=y&&1>=y&&(c=r.root,l=!0,this._edge.scaleInPlace(y),e.addToRef(this._edge,this._collisionPoint)));f.subtractToRef(j,this._edge);j.subtractToRef(this.basePoint,this._baseToVertex);s=this._edge.lengthSquared();t=b.Vector3.Dot(this._edge,this.velocity);v=b.Vector3.Dot(this._edge,this._baseToVertex);d=s*-m+t*t;n=s*2*b.Vector3.Dot(this.velocity,this._baseToVertex)-2*t*v;p=s*(1-this._baseToVertex.lengthSquared())+v*v;r=g(d,n,p,c);r.found&&(y=(t*r.root-v)/s,0<=y&&1>=y&&(c=r.root,l=!0,this._edge.scaleInPlace(y),j.addToRef(this._edge,this._collisionPoint)));}l&&(f=c*this.velocity.length(),(!this.collisionFound||f<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=f,this.collisionFound=!0));}},e.prototype._collide=function(b,d,f,e,j,l,n){for(;j>e;e+=3)this._testTriangle(e,b,d[f[e+2]-l],d[f[e+1]-l],d[f[e]-l],n);},e.prototype._getResponse=function(c,d){c.addToRef(d,this._destinationPoint);d.scaleInPlace(this.nearestDistance/d.length());this.basePoint.addToRef(d,c);c.subtractToRef(this.intersectionPoint,this._slidePlaneNormal);this._slidePlaneNormal.normalize();this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector);c.addInPlace(this._displacementVector);this.intersectionPoint.addInPlace(this._displacementVector);this._slidePlaneNormal.scaleInPlace(b.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint));this._destinationPoint.subtractInPlace(this._slidePlaneNormal);this._destinationPoint.subtractToRef(this.intersectionPoint,d);},e);y4tt.v9();b.Collider=e;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d;b.CollisionWorker="";g=b.WorkerTaskType||(b.WorkerTaskType={});g[g.INIT=0]="INIT";g[g.UPDATE=1]="UPDATE";g[g.COLLIDE=2]="COLLIDE";e=b.WorkerTaskType,g=b.WorkerReplyType||(b.WorkerReplyType={});g[g.SUCCESS=0]="SUCCESS";g[g.UNKNOWN_ERROR=1]="UNKNOWN_ERROR";!0;c=b.WorkerReplyType,d=function(){var f;f=this;this._scaledPosition=b.Vector3.Zero();this._scaledVelocity=b.Vector3.Zero();this.onMeshUpdated=function(b){f._addUpdateMeshesList[b.uniqueId]=d.SerializeMesh(b);};y4tt.q9();this.onGeometryUpdated=function(b){f._addUpdateGeometriesList[b.id]=d.SerializeGeometry(b);};this._afterRender=function(){var b,c,d,n;if(f._init&&!(0==f._toRemoveGeometryArray.length&&0==f._toRemoveMeshesArray.length&&0==Object.keys(f._addUpdateGeometriesList).length&&0==Object.keys(f._addUpdateMeshesList).length||4<f._runningUpdated)){++f._runningUpdated;b={updatedMeshes:f._addUpdateMeshesList,updatedGeometries:f._addUpdateGeometriesList,removedGeometries:f._toRemoveGeometryArray,removedMeshes:f._toRemoveMeshesArray},c={payload:b,taskType:e.UPDATE},d=[];for(n in b.updatedGeometries)b.updatedGeometries.hasOwnProperty(n)&&(d.push(c.payload.updatedGeometries[n].indices.buffer),d.push(c.payload.updatedGeometries[n].normals.buffer),d.push(c.payload.updatedGeometries[n].positions.buffer));f._worker.postMessage(c,d);f._addUpdateMeshesList={};f._addUpdateGeometriesList={};f._toRemoveGeometryArray=[];f._toRemoveMeshesArray=[];}};this._onMessageFromWorker=function(d){d=d.data;if(d.error!=c.SUCCESS)return void b.Tools.Warn("error returned from worker!");switch(d.taskType){case e.INIT:f._init=!0;f._scene.meshes.forEach(function(b){y4tt.q9();f.onMeshAdded(b);});f._scene.getGeometries().forEach(function(b){f.onGeometryAdded(b);});break;case e.UPDATE:f._runningUpdated--;break;case e.COLLIDE:f._runningCollisionTask=!1;d=d.payload;if(!f._collisionsCallbackArray[d.collisionId])break;f._collisionsCallbackArray[d.collisionId](d.collisionId,b.Vector3.FromArray(d.newPosition),f._scene.getMeshByUniqueID(d.collidedMeshUniqueId));f._collisionsCallbackArray[d.collisionId]=void 0;}};this._collisionsCallbackArray=[];this._init=!1;this._runningUpdated=0;this._runningCollisionTask=!1;this._addUpdateMeshesList={};this._addUpdateGeometriesList={};this._toRemoveGeometryArray=[];this._toRemoveMeshesArray=[];},g=(d.prototype.getNewPosition=function(b,c,d,l,n,g,p){y4tt.q9();this._init&&(!this._collisionsCallbackArray[p]&&!this._collisionsCallbackArray[p+1E5])&&(b.divideToRef(d.radius,this._scaledPosition),c.divideToRef(d.radius,this._scaledVelocity),this._collisionsCallbackArray[p]=g,b={payload:{collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:d.radius.asArray()},collisionId:p,excludedMeshUniqueId:n?n.uniqueId:null,maximumRetry:l},taskType:e.COLLIDE},this._worker.postMessage(b));},d.prototype.init=function(c){y4tt.v9();this._scene=c;this._scene.registerAfterRender(this._afterRender);c=b.WorkerIncluded?b.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([b.CollisionWorker],{type:"application/javascript"}));this._worker=new Worker(c);this._worker.onmessage=this._onMessageFromWorker;this._worker.postMessage({payload:{},taskType:e.INIT});},d.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender);this._worker.terminate();},d.prototype.onMeshAdded=function(b){b.registerAfterWorldMatrixUpdate(this.onMeshUpdated);this.onMeshUpdated(b);},d.prototype.onMeshRemoved=function(b){this._toRemoveMeshesArray.push(b.uniqueId);},d.prototype.onGeometryAdded=function(b){y4tt.v9();b.onGeometryUpdated=this.onGeometryUpdated;this.onGeometryUpdated(b);},d.prototype.onGeometryDeleted=function(b){y4tt.v9();this._toRemoveGeometryArray.push(b.id);},d.SerializeMesh=function(b){var c;c=[];b.subMeshes&&(c=b.subMeshes.map(function(b,c){return{position:c,verticesStart:b.verticesStart,verticesCount:b.verticesCount,indexStart:b.indexStart,indexCount:b.indexCount,hasMaterial:!!b.getMaterial(),sphereCenter:b.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:b.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:b.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:b.getBoundingInfo().boundingBox.maximumWorld.asArray()};}));return{uniqueId:b.uniqueId,id:b.id,name:b.name,geometryId:null,sphereCenter:b.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:b.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:b.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:b.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:b.worldMatrixFromCache.asArray(),subMeshes:c,checkCollisions:b.checkCollisions};},d.SerializeGeometry=function(c){y4tt.q9();return{id:c.id,positions:new Float32Array(c.getVerticesData(b.VertexBuffer.PositionKind)||[]),normals:new Float32Array(c.getVerticesData(b.VertexBuffer.NormalKind)||[]),indices:new Int32Array(c.getIndices()||[])};},d);b.CollisionCoordinatorWorker=g;g=function(){y4tt.q9();this._scaledPosition=b.Vector3.Zero();this._scaledVelocity=b.Vector3.Zero();this._finalPosition=b.Vector3.Zero();};g=(g.prototype.getNewPosition=function(b,c,d,l,e,g,p){b.divideToRef(d.radius,this._scaledPosition);c.divideToRef(d.radius,this._scaledVelocity);d.collidedMesh=null;d.retry=0;y4tt.q9();d.initialVelocity=this._scaledVelocity;d.initialPosition=this._scaledPosition;this._collideWithWorld(this._scaledPosition,this._scaledVelocity,d,l,this._finalPosition,e);this._finalPosition.multiplyInPlace(d.radius);g(p,this._finalPosition,d.collidedMesh);},g.prototype.init=function(b){this._scene=b;},g.prototype.destroy=function(){},g.prototype.onMeshAdded=function(){},g.prototype.onMeshUpdated=function(){},g.prototype.onMeshRemoved=function(){},g.prototype.onGeometryAdded=function(){},g.prototype.onGeometryUpdated=function(){},g.prototype.onGeometryDeleted=function(){},g.prototype._collideWithWorld=function(c,d,e,l,n,g){var p,s;void 0===g&&(g=null);p=10*b.Engine.CollisionsEpsilon;if(e.retry>=l)return void n.copyFrom(c);e._initialize(c,d,p);for(var r=0;r<this._scene.meshes.length;r++){s=this._scene.meshes[r];s.isEnabled()&&s.checkCollisions&&s.subMeshes&&s!==g&&s._checkCollision(e);}y4tt.q9();return e.collisionFound?(0===d.x&&0===d.y&&0===d.z||e._getResponse(c,d),d.length()<=p?void n.copyFrom(c):(e.retry++,void this._collideWithWorld(c,d,e,l,n,g))):void c.addToRef(d,n);},g);b.CollisionCoordinatorLegacy=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.Node,c=function(d,f,q){e.call(this,d,q);this.upVector=b.Vector3.Up();this.orthoTop=this.orthoBottom=this.orthoRight=this.orthoLeft=null;this.fov=0.8;this.minZ=1;this.maxZ=1E4;this.inertia=0.9;this.mode=c.PERSPECTIVE_CAMERA;this.isIntermediate=!1;this.viewport=new b.Viewport(0,0,1,1);this.layerMask=268435455;this.fovMode=c.FOVMODE_VERTICAL_FIXED;this.cameraRigMode=c.RIG_MODE_NONE;this._rigCameras=[];this._computedViewMatrix=b.Matrix.Identity();this._projectionMatrix=new b.Matrix();this._postProcesses=[];this._activeMeshes=new b.SmartArray(256);this._globalPosition=b.Vector3.Zero();q.addCamera(this);q.activeCamera||(q.activeCamera=this);this.position=f;};g=(__extends(c,e),Object.defineProperty(c,"PERSPECTIVE_CAMERA",{get:function(){y4tt.v9();return c._PERSPECTIVE_CAMERA;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ORTHOGRAPHIC_CAMERA",{get:function(){y4tt.q9();return c._ORTHOGRAPHIC_CAMERA;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"FOVMODE_VERTICAL_FIXED",{get:function(){return c._FOVMODE_VERTICAL_FIXED;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"FOVMODE_HORIZONTAL_FIXED",{get:function(){return c._FOVMODE_HORIZONTAL_FIXED;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_NONE",{get:function(){return c._RIG_MODE_NONE;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_STEREOSCOPIC_ANAGLYPH",{get:function(){return c._RIG_MODE_STEREOSCOPIC_ANAGLYPH;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL",{get:function(){return c._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED",{get:function(){y4tt.v9();return c._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_STEREOSCOPIC_OVERUNDER",{get:function(){y4tt.v9();return c._RIG_MODE_STEREOSCOPIC_OVERUNDER;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_VR",{get:function(){return c._RIG_MODE_VR;},enumerable:!0,configurable:!0}),c.prototype.toString=function(b){var c;c="Name: "+this.name;if(c+=", type: "+this.getTypeName(),this.animations)for(var e=0;e<this.animations.length;e++)c+=", animation[0]: "+this.animations[e].toString(b);y4tt.q9();return c;},Object.defineProperty(c.prototype,"globalPosition",{get:function(){return this._globalPosition;},enumerable:!0,configurable:!0}),c.prototype.getActiveMeshes=function(){return this._activeMeshes;},c.prototype.isActiveMesh=function(b){return-1!==this._activeMeshes.indexOf(b);},c.prototype._initCache=function(){e.prototype._initCache.call(this);this._cache.position=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);y4tt.q9();this._cache.upVector=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.mode=void 0;this._cache.minZ=void 0;this._cache.maxZ=void 0;this._cache.fov=void 0;this._cache.aspectRatio=void 0;this._cache.orthoLeft=void 0;this._cache.orthoRight=void 0;this._cache.orthoBottom=void 0;this._cache.orthoTop=void 0;this._cache.renderWidth=void 0;this._cache.renderHeight=void 0;},c.prototype._updateCache=function(b){b||e.prototype._updateCache.call(this);b=this.getEngine();this._cache.position.copyFrom(this.position);this._cache.upVector.copyFrom(this.upVector);this._cache.mode=this.mode;this._cache.minZ=this.minZ;this._cache.maxZ=this.maxZ;this._cache.fov=this.fov;this._cache.aspectRatio=b.getAspectRatio(this);this._cache.orthoLeft=this.orthoLeft;this._cache.orthoRight=this.orthoRight;this._cache.orthoBottom=this.orthoBottom;this._cache.orthoTop=this.orthoTop;this._cache.renderWidth=b.getRenderWidth();this._cache.renderHeight=b.getRenderHeight();},c.prototype._updateFromScene=function(){y4tt.v9();this.updateCache();this._update();},c.prototype._isSynchronized=function(){y4tt.q9();return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix();},c.prototype._isSynchronizedViewMatrix=function(){y4tt.q9();return e.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1;},c.prototype._isSynchronizedProjectionMatrix=function(){var b;if(!(this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ))return!1;b=this.getEngine();return this.mode===c.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.aspectRatio===b.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===b.getRenderWidth()&&this._cache.renderHeight===b.getRenderHeight();},c.prototype.attachControl=function(){},c.prototype.detachControl=function(){},c.prototype._update=function(){y4tt.q9();this.cameraRigMode!==c.RIG_MODE_NONE&&this._updateRigCameras();this._checkInputs();},c.prototype._checkInputs=function(){},c.prototype._cascadePostProcessesToRigCams=function(){var e,j;0<this._postProcesses.length&&this._postProcesses[0].markTextureDirty();y4tt.q9();for(var c=0,f=this._rigCameras.length;f>c;c++){e=this._rigCameras[c],j=e._rigPostProcess;j?(j instanceof b.PassPostProcess&&(e.isIntermediate=0===this._postProcesses.length),e._postProcesses=this._postProcesses.slice(0).concat(j),j.markTextureDirty()):e._postProcesses=this._postProcesses.slice(0);}},c.prototype.attachPostProcess=function(c,f){return void 0===f&&(f=null),!c.isReusable()&&-1<this._postProcesses.indexOf(c)?(b.Tools.Error("You're trying to reuse a post process not defined as reusable."),0):(null==f||0>f?this._postProcesses.push(c):this._postProcesses.splice(f,0,c),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(c));},c.prototype.detachPostProcess=function(b,c){var e,j;void 0===c&&(c=null);j=[];if(c){c=c instanceof Array?c:[c];for(e=c.length-1;0<=e;e--)this._postProcesses[c[e]]===b?this._postProcesses.splice(void 0,1):j.push(e);}else e=this._postProcesses.indexOf(b),-1!==e&&this._postProcesses.splice(e,1);return this._cascadePostProcessesToRigCams(),j;},c.prototype.getWorldMatrix=function(){this._worldMatrix||(this._worldMatrix=b.Matrix.Identity());return this.getViewMatrix().invertToRef(this._worldMatrix),this._worldMatrix;},c.prototype._getViewMatrix=function(){return b.Matrix.Identity();},c.prototype.getViewMatrix=function(c){return this._computedViewMatrix=this._computeViewMatrix(c),!c&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.parent&&this.parent.getWorldMatrix?(this._worldMatrix||(this._worldMatrix=b.Matrix.Identity()),this._computedViewMatrix.invertToRef(this._worldMatrix),this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._computedViewMatrix),this._globalPosition.copyFromFloats(this._computedViewMatrix.m[12],this._computedViewMatrix.m[13],this._computedViewMatrix.m[14]),this._computedViewMatrix.invert(),this._markSyncedWithParent()):this._globalPosition.copyFrom(this.position),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix);},c.prototype._computeViewMatrix=function(b){y4tt.q9();return!b&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix);},c.prototype.getProjectionMatrix=function(d){var f;if(!d&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;f=this.getEngine();if(this.mode===c.PERSPECTIVE_CAMERA)return 0>=this.minZ&&(this.minZ=0.1),b.Matrix.PerspectiveFovLHToRef(this.fov,f.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===c.FOVMODE_VERTICAL_FIXED),this._projectionMatrix;d=f.getRenderWidth()/2;f=f.getRenderHeight()/2;return b.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-d,this.orthoRight||d,this.orthoBottom||-f,this.orthoTop||f,this.minZ,this.maxZ,this._projectionMatrix),this._projectionMatrix;},c.prototype.dispose=function(){this.getScene().stopAnimation(this);for(this.getScene().removeCamera(this);0<this._rigCameras.length;)this._rigCameras.pop().dispose();for(var b=0;b<this._postProcesses.length;++b)this._postProcesses[b].dispose(this);e.prototype.dispose.call(this);},c.prototype.setCameraRigMode=function(d,f){var e;for(;0<this._rigCameras.length;)this._rigCameras.pop().dispose();switch(this.cameraRigMode=d,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=f.interaxialDistance||0.0637,this._cameraRigParams.stereoHalfAngle=b.Tools.ToRadians(this._cameraRigParams.interaxialDistance/0.0637),this.cameraRigMode!==c.RIG_MODE_NONE&&(this._rigCameras.push(this.createRigCamera(this.name+"_L",0)),this._rigCameras.push(this.createRigCamera(this.name+"_R",1))),this.cameraRigMode){case c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:this._rigCameras[0]._rigPostProcess=new b.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]);this._rigCameras[1]._rigPostProcess=new b.AnaglyphPostProcess(this.name+"_anaglyph",1,this._rigCameras);break;case c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case c.RIG_MODE_STEREOSCOPIC_OVERUNDER:e=this.cameraRigMode===c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||this.cameraRigMode===c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;this._rigCameras[0]._rigPostProcess=new b.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]);this._rigCameras[1]._rigPostProcess=new b.StereoscopicInterlacePostProcess(this.name+"_stereoInterlace",this._rigCameras,e);break;case c.RIG_MODE_VR:e=f.vrCameraMetrics||b.VRCameraMetrics.GetDefault(),this._rigCameras[0]._cameraRigParams.vrMetrics=e,this._rigCameras[0].viewport=new b.Viewport(0,0,0.5,1),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new b.Matrix(),this._rigCameras[0]._cameraRigParams.vrHMatrix=e.leftHMatrix,this._rigCameras[0]._cameraRigParams.vrPreViewMatrix=e.leftPreViewMatrix,this._rigCameras[0].getProjectionMatrix=this._rigCameras[0]._getVRProjectionMatrix,this._rigCameras[1]._cameraRigParams.vrMetrics=e,this._rigCameras[1].viewport=new b.Viewport(0.5,0,0.5,1),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new b.Matrix(),this._rigCameras[1]._cameraRigParams.vrHMatrix=e.rightHMatrix,this._rigCameras[1]._cameraRigParams.vrPreViewMatrix=e.rightPreViewMatrix,this._rigCameras[1].getProjectionMatrix=this._rigCameras[1]._getVRProjectionMatrix,e.compensateDistortion&&(this._rigCameras[0]._rigPostProcess=new b.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Left",this._rigCameras[0],!1,e),this._rigCameras[1]._rigPostProcess=new b.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Right",this._rigCameras[1],!0,e));}this._cascadePostProcessesToRigCams();this._update();},c.prototype._getVRProjectionMatrix=function(){y4tt.q9();return b.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix;},c.prototype.setCameraRigParameter=function(c,f){this._cameraRigParams||(this._cameraRigParams={});y4tt.v9();this._cameraRigParams[c]=f;"interaxialDistance"===c&&(this._cameraRigParams.stereoHalfAngle=b.Tools.ToRadians(f/0.0637));},c.prototype.createRigCamera=function(){return null;},c.prototype._updateRigCameras=function(){for(var b=0;b<this._rigCameras.length;b++)this._rigCameras[b].minZ=this.minZ,this._rigCameras[b].maxZ=this.maxZ,this._rigCameras[b].fov=this.fov;this.cameraRigMode===c.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport);},c.prototype._setupInputs=function(){},c.prototype.serialize=function(){var c;c=b.SerializationHelper.Serialize(this);y4tt.q9();return c.type=this.getTypeName(),this.parent&&(c.parentId=this.parent.id),this.inputs&&this.inputs.serialize(c),b.Animation.AppendSerializedAnimations(this,c),c.ranges=this.serializeAnimationRanges(),c;},c.prototype.getTypeName=function(){return"Camera";},c.prototype.clone=function(d){return b.SerializationHelper.Clone(c.GetConstructorFromName(this.getTypeName(),d,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);},c.GetConstructorFromName=function(c,f,e,j,l){switch(void 0===j&&(j=0),void 0===l&&(l=!0),c){case"ArcRotateCamera":return function(){y4tt.q9();return new b.ArcRotateCamera(f,0,0,1,b.Vector3.Zero(),e);};case"DeviceOrientationCamera":return function(){return new b.DeviceOrientationCamera(f,b.Vector3.Zero(),e);};case"FollowCamera":return function(){y4tt.v9();return new b.FollowCamera(f,b.Vector3.Zero(),e);};case"ArcFollowCamera":return function(){y4tt.q9();return new b.ArcFollowCamera(f,0,0,1,null,e);};case"GamepadCamera":return function(){return new b.GamepadCamera(f,b.Vector3.Zero(),e);};case"TouchCamera":return function(){return new b.TouchCamera(f,b.Vector3.Zero(),e);};case"VirtualJoysticksCamera":return function(){return new b.VirtualJoysticksCamera(f,b.Vector3.Zero(),e);};case"WebVRFreeCamera":return function(){return new b.WebVRFreeCamera(f,b.Vector3.Zero(),e);};case"VRDeviceOrientationFreeCamera":return function(){y4tt.v9();return new b.VRDeviceOrientationFreeCamera(f,b.Vector3.Zero(),e);};case"AnaglyphArcRotateCamera":return function(){y4tt.v9();return new b.AnaglyphArcRotateCamera(f,0,0,1,b.Vector3.Zero(),j,e);};case"AnaglyphFreeCamera":return function(){y4tt.q9();return new b.AnaglyphFreeCamera(f,b.Vector3.Zero(),j,e);};case"AnaglyphGamepadCamera":return function(){y4tt.q9();return new b.AnaglyphGamepadCamera(f,b.Vector3.Zero(),j,e);};case"AnaglyphUniversalCamera":return function(){y4tt.q9();return new b.AnaglyphUniversalCamera(f,b.Vector3.Zero(),j,e);};case"StereoscopicArcRotateCamera":return function(){return new b.StereoscopicArcRotateCamera(f,0,0,1,b.Vector3.Zero(),j,l,e);};case"StereoscopicFreeCamera":return function(){y4tt.v9();return new b.StereoscopicFreeCamera(f,b.Vector3.Zero(),j,l,e);};case"StereoscopicGamepadCamera":return function(){return new b.StereoscopicGamepadCamera(f,b.Vector3.Zero(),j,l,e);};case"StereoscopicUniversalCamera":return function(){y4tt.v9();return new b.StereoscopicUniversalCamera(f,b.Vector3.Zero(),j,l,e);};case"FreeCamera":return function(){y4tt.q9();return new b.UniversalCamera(f,b.Vector3.Zero(),e);};default:return function(){return new b.UniversalCamera(f,b.Vector3.Zero(),e);};}},c.Parse=function(d,f){var e;e=c.GetConstructorFromName(d.type,d.name,f,d.interaxial_distance,d.isStereoscopicSideBySide),e=b.SerializationHelper.Parse(e,d,f);if(d.parentId&&(e._waitingParentId=d.parentId),e.inputs&&(e.inputs.parse(d),e._setupInputs()),d.target&&e.setTarget&&e.setTarget(b.Vector3.FromArray(d.target)),d.cameraRigMode)e.setCameraRigMode(d.cameraRigMode,d.interaxial_distance?{interaxialDistance:d.interaxial_distance}:{});y4tt.q9();if(d.animations){for(var j=0;j<d.animations.length;j++)e.animations.push(b.Animation.Parse(d.animations[j]));b.Node.ParseAnimationRanges(e,d,f);}return d.autoAnimate&&f.beginAnimation(e,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1),e;},c._PERSPECTIVE_CAMERA=0,c._ORTHOGRAPHIC_CAMERA=1,c._FOVMODE_VERTICAL_FIXED=0,c._FOVMODE_HORIZONTAL_FIXED=1,c._RIG_MODE_NONE=0,c._RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,c._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,c._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,c._RIG_MODE_STEREOSCOPIC_OVERUNDER=13,c._RIG_MODE_VR=20,c.ForceAttachControlToAlwaysPreventDefault=!1,__decorate([b.serializeAsVector3()],c.prototype,"position",void 0),__decorate([b.serializeAsVector3()],c.prototype,"upVector",void 0),__decorate([b.serialize()],c.prototype,"orthoLeft",void 0),__decorate([b.serialize()],c.prototype,"orthoRight",void 0),__decorate([b.serialize()],c.prototype,"orthoBottom",void 0),__decorate([b.serialize()],c.prototype,"orthoTop",void 0),__decorate([b.serialize()],c.prototype,"fov",void 0),__decorate([b.serialize()],c.prototype,"minZ",void 0),__decorate([b.serialize()],c.prototype,"maxZ",void 0),__decorate([b.serialize()],c.prototype,"inertia",void 0),__decorate([b.serialize()],c.prototype,"mode",void 0),__decorate([b.serialize()],c.prototype,"layerMask",void 0),__decorate([b.serialize()],c.prototype,"fovMode",void 0),__decorate([b.serialize()],c.prototype,"cameraRigMode",void 0),__decorate([b.serialize()],c.prototype,"interaxialDistance",void 0),__decorate([b.serialize()],c.prototype,"isStereoscopicSideBySide",void 0),c);b.Camera=g;}(BABYLON||(BABYLON={}));!function(b){var g;y4tt.q9();b.CameraInputTypes={};g=function(b){this.attached={};this.camera=b;this.checkInputs=function(){};};g=(g.prototype.add=function(e){var c;c=e.getSimpleName();y4tt.q9();return this.attached[c]?void b.Tools.Warn("camera input of type "+c+" already exists on camera"):(this.attached[c]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),void(this.attachedElement&&e.attachControl(this.attachedElement)));},g.prototype.remove=function(b){var d;for(var c in this.attached){d=this.attached[c];d===b&&(d.detachControl(this.attachedElement),delete this.attached[c],this.rebuildInputCheck());}},g.prototype.removeByType=function(b){var d;for(var c in this.attached){d=this.attached[c];d.getTypeName()===b&&(d.detachControl(this.attachedElement),delete this.attached[c],this.rebuildInputCheck());}},g.prototype._addCheckInputs=function(b){var c;y4tt.q9();c=this.checkInputs;return function(){c();b();};},g.prototype.attachInput=function(b){b.attachControl(this.attachedElement,this.noPreventDefault);},g.prototype.attachElement=function(e,c){y4tt.v9();if(!this.attachedElement){c=b.Camera.ForceAttachControlToAlwaysPreventDefault?!1:c;this.attachedElement=e;this.noPreventDefault=c;for(var d in this.attached)this.attached[d],this.attached[d].attachControl(e,c);}},g.prototype.detachElement=function(b){y4tt.v9();if(this.attachedElement===b){for(var c in this.attached)this.attached[c],this.attached[c].detachControl(b);this.attachedElement=null;}},g.prototype.rebuildInputCheck=function(){var c;this.checkInputs=function(){};for(var b in this.attached){c=this.attached[b];c.checkInputs&&(this.checkInputs=this._addCheckInputs(c.checkInputs.bind(c)));}},g.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement);this.attached={};this.attachedElement=null;this.checkInputs=function(){};},g.prototype.serialize=function(e){var c,d,f,q;c={};for(d in this.attached){f=this.attached[d],q=b.SerializationHelper.Serialize(f);c[f.getTypeName()]=q;}y4tt.v9();e.inputsmgr=c;},g.prototype.parse=function(e){var c,f,q;c=e.inputsmgr;y4tt.v9();if(c){this.clear();for(var d in c){f=b.CameraInputTypes[d];if(f){q=b.SerializationHelper.Parse(function(){return new f();},c[d],null);this.add(q);}}}else for(d in this.attached)if(f=b.CameraInputTypes[this.attached[d].getTypeName()])q=b.SerializationHelper.Parse(function(){y4tt.q9();return new f();},e,null),this.remove(this.attached[d]),this.add(q);},g);b.CameraInputsManager=g;}(BABYLON||(BABYLON={}));!function(b){var g;y4tt.v9();g=function(b){void 0===b&&(b=!0);this.touchEnabled=b;this.angularSensibility=2E3;};g=(g.prototype.attachControl=function(e,c){var d,f,q;y4tt.v9();d=this;if(!this._pointerInput){f=this.camera,q=this.camera.getEngine();this._pointerInput=function(e){var l,p,r;l=e.event;y4tt.q9();if(d.touchEnabled||"touch"!==l.pointerType)if(e.type===b.PointerEventTypes.POINTERDOWN){try{l.srcElement.setPointerCapture(l.pointerId);}catch(n){}d.previousPosition={x:l.clientX,y:l.clientY};c||l.preventDefault();}else if(e.type===b.PointerEventTypes.POINTERUP){try{l.srcElement.releasePointerCapture(l.pointerId);}catch(g){}d.previousPosition=null;c||l.preventDefault();}else if(e.type===b.PointerEventTypes.POINTERMOVE&&(d.previousPosition||q.isPointerLock)){q.isPointerLock?(p=l.movementX||l.mozMovementX||l.webkitMovementX||l.msMovementX||0,r=l.movementY||l.mozMovementY||l.webkitMovementY||l.msMovementY||0):(p=l.clientX-d.previousPosition.x,r=l.clientY-d.previousPosition.y);f.cameraRotation.y+=p/d.angularSensibility;f.cameraRotation.x+=r/d.angularSensibility;d.previousPosition={x:l.clientX,y:l.clientY};c||l.preventDefault();}};}this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,b.PointerEventTypes.POINTERDOWN|b.PointerEventTypes.POINTERUP|b.PointerEventTypes.POINTERMOVE);},g.prototype.detachControl=function(b){y4tt.v9();this._observer&&b&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.previousPosition=null);},g.prototype.getTypeName=function(){y4tt.v9();return"FreeCameraMouseInput";},g.prototype.getSimpleName=function(){y4tt.q9();return"mouse";},__decorate([b.serialize()],g.prototype,"angularSensibility",void 0),g);b.FreeCameraMouseInput=g;b.CameraInputTypes.FreeCameraMouseInput=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(){this._keys=[];this.keysUp=[38];this.keysDown=[40];this.keysLeft=[37];y4tt.q9();this.keysRight=[39];};g=(g.prototype.attachControl=function(e,c){var d;d=this;y4tt.v9();this._onKeyDown||(this._onKeyDown=function(b){if(-1!==d.keysUp.indexOf(b.keyCode)||-1!==d.keysDown.indexOf(b.keyCode)||-1!==d.keysLeft.indexOf(b.keyCode)||-1!==d.keysRight.indexOf(b.keyCode))-1===d._keys.indexOf(b.keyCode)&&d._keys.push(b.keyCode),c||b.preventDefault();},this._onKeyUp=function(b){var e;if(-1!==d.keysUp.indexOf(b.keyCode)||-1!==d.keysDown.indexOf(b.keyCode)||-1!==d.keysLeft.indexOf(b.keyCode)||-1!==d.keysRight.indexOf(b.keyCode)){e=d._keys.indexOf(b.keyCode);0<=e&&d._keys.splice(e,1);c||b.preventDefault();}},b.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]));},g.prototype.detachControl=function(){this._onKeyDown&&(b.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]),this._keys=[],this._onKeyDown=null,this._onKeyUp=null);},g.prototype.checkInputs=function(){var d,f;y4tt.v9();if(this._onKeyDown)for(var e=this.camera,c=0;c<this._keys.length;c++){d=this._keys[c],f=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(d)?e._localDirection.copyFromFloats(-f,0,0):-1!==this.keysUp.indexOf(d)?e._localDirection.copyFromFloats(0,0,f):-1!==this.keysRight.indexOf(d)?e._localDirection.copyFromFloats(f,0,0):-1!==this.keysDown.indexOf(d)&&e._localDirection.copyFromFloats(0,0,-f);e.getViewMatrix().invertToRef(e._cameraTransformMatrix);b.Vector3.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection);e.cameraDirection.addInPlace(e._transformedDirection);}},g.prototype.getTypeName=function(){y4tt.v9();return"FreeCameraKeyboardMoveInput";},g.prototype._onLostFocus=function(){y4tt.q9();this._keys=[];},g.prototype.getSimpleName=function(){y4tt.v9();return"keyboard";},__decorate([b.serialize()],g.prototype,"keysUp",void 0),__decorate([b.serialize()],g.prototype,"keysDown",void 0),__decorate([b.serialize()],g.prototype,"keysLeft",void 0),__decorate([b.serialize()],g.prototype,"keysRight",void 0),g);b.FreeCameraKeyboardMoveInput=g;b.CameraInputTypes.FreeCameraKeyboardMoveInput=g;}(BABYLON||(BABYLON={}));!function(b){var g;y4tt.v9();g=function(){this._offsetY=this._offsetX=null;this._pointerCount=0;this._pointerPressed=[];this.touchAngularSensibility=2E5;this.touchMoveSensibility=250;};g=(g.prototype.attachControl=function(e,c){var d,f;f=this;void 0===this._pointerInput&&(this._onLostFocus=function(){f._offsetX=null;f._offsetY=null;},this._pointerInput=function(e){var j;j=e.event;if("mouse"!==j.pointerType)if(e.type===b.PointerEventTypes.POINTERDOWN){if(!(c||j.preventDefault(),f._pointerPressed.push(j.pointerId),1!==f._pointerPressed.length))d={x:j.clientX,y:j.clientY};}else if(e.type===b.PointerEventTypes.POINTERUP){if(c||j.preventDefault(),e=f._pointerPressed.indexOf(j.pointerId),-1!==e&&!(f._pointerPressed.splice(e,1),0!=e))d=null,f._offsetX=null,f._offsetY=null;}else if(e.type===b.PointerEventTypes.POINTERMOVE&&!(c||j.preventDefault(),!d))e=f._pointerPressed.indexOf(j.pointerId),0==e&&(f._offsetX=j.clientX-d.x,f._offsetY=-(j.clientY-d.y));});this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,b.PointerEventTypes.POINTERDOWN|b.PointerEventTypes.POINTERUP|b.PointerEventTypes.POINTERMOVE);y4tt.v9();e.addEventListener("blur",this._onLostFocus);},g.prototype.detachControl=function(b){y4tt.v9();this._pointerInput&&b&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,b.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null,this._pointerPressed=[],this._offsetX=null,this._offsetY=null,this._pointerCount=0);},g.prototype.checkInputs=function(){var e,c;if(this._offsetX){e=this.camera;if(e.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,1<this._pointerPressed.length)e.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{c=e._computeLocalCameraSpeed(),c=new b.Vector3(0,0,c*this._offsetY/this.touchMoveSensibility);b.Matrix.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix);e.cameraDirection.addInPlace(b.Vector3.TransformCoordinates(c,e._cameraRotationMatrix));}}},g.prototype.getTypeName=function(){y4tt.v9();return"FreeCameraTouchInput";},g.prototype.getSimpleName=function(){return"touch";},__decorate([b.serialize()],g.prototype,"touchAngularSensibility",void 0),__decorate([b.serialize()],g.prototype,"touchMoveSensibility",void 0),g);b.FreeCameraTouchInput=g;b.CameraInputTypes.FreeCameraTouchInput=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(){var e;e=this;this._screenOrientationAngle=0;this._screenQuaternion=new b.Quaternion();this._gamma=this._beta=this._alpha=0;y4tt.v9();this._orientationChanged=function(){e._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0;e._screenOrientationAngle=-b.Tools.ToRadians(e._screenOrientationAngle/2);y4tt.v9();e._screenQuaternion.copyFromFloats(0,Math.sin(e._screenOrientationAngle),0,Math.cos(e._screenOrientationAngle));};this._deviceOrientation=function(b){e._alpha=b.alpha;e._beta=b.beta;y4tt.q9();e._gamma=b.gamma;};this._constantTranform=new b.Quaternion(-Math.sqrt(0.5),0,0,Math.sqrt(0.5));this._orientationChanged();};g=(Object.defineProperty(g.prototype,"camera",{get:function(){y4tt.q9();return this._camera;},set:function(e){this._camera=e;this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new b.Quaternion());},enumerable:!0,configurable:!0}),g.prototype.attachControl=function(){window.addEventListener("orientationchange",this._orientationChanged);y4tt.q9();window.addEventListener("deviceorientation",this._deviceOrientation);},g.prototype.detachControl=function(){window.removeEventListener("orientationchange",this._orientationChanged);window.removeEventListener("deviceorientation",this._deviceOrientation);},g.prototype.checkInputs=function(){b.Quaternion.RotationYawPitchRollToRef(b.Tools.ToRadians(this._alpha),b.Tools.ToRadians(this._beta),-b.Tools.ToRadians(this._gamma),this.camera.rotationQuaternion);this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion);this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform);this._camera.rotationQuaternion.z*=-1;this._camera.rotationQuaternion.w*=-1;},g.prototype.getTypeName=function(){return"FreeCameraDeviceOrientationInput";},g.prototype.getSimpleName=function(){return"deviceOrientation";},g);b.FreeCameraDeviceOrientationInput=g;b.CameraInputTypes.FreeCameraDeviceOrientationInput=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(){this.gammaCorrection=this.betaCorrection=this.alphaCorrection=1;this._gamma=this._beta=this._alpha=0;this._dirty=!1;this._deviceOrientationHandler=this._onOrientationEvent.bind(this);};g=(g.prototype.attachControl=function(){window.addEventListener("deviceorientation",this._deviceOrientationHandler);},g.prototype._onOrientationEvent=function(b){this.camera;this._alpha=b.alpha;this._beta=b.beta;this._gamma=b.gamma;this._dirty=!0;},g.prototype.checkInputs=function(){var b;y4tt.v9();if(this._dirty){this._dirty=!1;b=this._gamma;this.camera.rotation.x=this.gammaCorrection*(0>b?90+b:270-b)/180*Math.PI;this.camera.rotation.y=this.alphaCorrection*-this._alpha/180*Math.PI;this.camera.rotation.z=this.betaCorrection*this._beta/180*Math.PI;}},g.prototype.detachControl=function(){window.removeEventListener("deviceorientation",this._deviceOrientationHandler);},g.prototype.getTypeName=function(){return"FreeCameraVRDeviceOrientationInput";},g.prototype.getSimpleName=function(){y4tt.q9();return"VRDeviceOrientation";},g);b.FreeCameraVRDeviceOrientationInput=g;b.CameraInputTypes.FreeCameraVRDeviceOrientationInput=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(){this.gamepadAngularSensibility=200;this.gamepadMoveSensibility=40;};g=(g.prototype.attachControl=function(){var e;e=this;y4tt.q9();this._gamepads=new b.Gamepads(function(b){y4tt.v9();e._onNewGameConnected(b);});},g.prototype.detachControl=function(){this._gamepads&&this._gamepads.dispose();this.gamepad=null;},g.prototype.checkInputs=function(){var e,c,d,f,q;if(this.gamepad){e=this.camera,c=this.gamepad.leftStick,d=c.x/this.gamepadMoveSensibility,f=c.y/this.gamepadMoveSensibility;c.x=0.005<Math.abs(d)?0+d:0;c.y=0.005<Math.abs(f)?0+f:0;d=this.gamepad.rightStick,f=d.x/this.gamepadAngularSensibility,q=d.y/this.gamepadAngularSensibility;d.x=0.001<Math.abs(f)?0+f:0;d.y=0.001<Math.abs(q)?0+q:0;f=b.Matrix.RotationYawPitchRoll(e.rotation.y,e.rotation.x,0);q=50*e._computeLocalCameraSpeed();c=b.Vector3.TransformCoordinates(new b.Vector3(c.x*q,0,-c.y*q),f);e.cameraDirection=e.cameraDirection.add(c);e.cameraRotation=e.cameraRotation.add(new b.Vector2(d.y,d.x));}},g.prototype._onNewGameConnected=function(b){0===b.index&&(this.gamepad=b);},g.prototype.getTypeName=function(){return"FreeCameraGamepadInput";},g.prototype.getSimpleName=function(){return"gamepad";},__decorate([b.serialize()],g.prototype,"gamepadAngularSensibility",void 0),__decorate([b.serialize()],g.prototype,"gamepadMoveSensibility",void 0),g);b.FreeCameraGamepadInput=g;b.CameraInputTypes.FreeCameraGamepadInput=g;}(BABYLON||(BABYLON={}));!function(b){var g;y4tt.v9();g=function(){this._keys=[];this.keysUp=[38];this.keysDown=[40];this.keysLeft=[37];y4tt.v9();this.keysRight=[39];};g=(g.prototype.attachControl=function(e,c){var d;d=this;this._onKeyDown=function(b){if(-1!==d.keysUp.indexOf(b.keyCode)||-1!==d.keysDown.indexOf(b.keyCode)||-1!==d.keysLeft.indexOf(b.keyCode)||-1!==d.keysRight.indexOf(b.keyCode))-1===d._keys.indexOf(b.keyCode)&&d._keys.push(b.keyCode),b.preventDefault&&(c||b.preventDefault());};this._onKeyUp=function(b){var e;y4tt.q9();if(-1!==d.keysUp.indexOf(b.keyCode)||-1!==d.keysDown.indexOf(b.keyCode)||-1!==d.keysLeft.indexOf(b.keyCode)||-1!==d.keysRight.indexOf(b.keyCode)){e=d._keys.indexOf(b.keyCode);0<=e&&d._keys.splice(e,1);b.preventDefault&&(c||b.preventDefault());}};this._onLostFocus=function(){y4tt.v9();d._keys=[];};b.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]);},g.prototype.detachControl=function(){b.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]);y4tt.q9();this._keys=[];this._onLostFocus=this._onKeyUp=this._onKeyDown=null;},g.prototype.checkInputs=function(){var d;if(this._onKeyDown)for(var b=this.camera,c=0;c<this._keys.length;c++){d=this._keys[c];-1!==this.keysLeft.indexOf(d)?b.inertialAlphaOffset-=0.01:-1!==this.keysUp.indexOf(d)?b.inertialBetaOffset-=0.01:-1!==this.keysRight.indexOf(d)?b.inertialAlphaOffset+=0.01:-1!==this.keysDown.indexOf(d)&&(b.inertialBetaOffset+=0.01);}},g.prototype.getTypeName=function(){y4tt.q9();return"ArcRotateCameraKeyboardMoveInput";},g.prototype.getSimpleName=function(){y4tt.q9();return"keyboard";},__decorate([b.serialize()],g.prototype,"keysUp",void 0),__decorate([b.serialize()],g.prototype,"keysDown",void 0),__decorate([b.serialize()],g.prototype,"keysLeft",void 0),__decorate([b.serialize()],g.prototype,"keysRight",void 0),g);b.ArcRotateCameraKeyboardMoveInput=g;b.CameraInputTypes.ArcRotateCameraKeyboardMoveInput=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(){y4tt.v9();this.wheelPrecision=3;};g=(g.prototype.attachControl=function(e,c){var d;d=this;this._wheel=function(f){var e;if(f.type===b.PointerEventTypes.POINTERWHEEL){f=f.event;e=0;f.wheelDelta?e=f.wheelDelta/(40*d.wheelPrecision):f.detail&&(e=-f.detail/d.wheelPrecision);e&&(d.camera.inertialRadiusOffset+=e);f.preventDefault&&(c||f.preventDefault());}};y4tt.v9();this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,b.PointerEventTypes.POINTERWHEEL);},g.prototype.detachControl=function(b){y4tt.q9();this._observer&&b&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null);},g.prototype.getTypeName=function(){y4tt.q9();return"ArcRotateCameraMouseWheelInput";},g.prototype.getSimpleName=function(){y4tt.q9();return"mousewheel";},__decorate([b.serialize()],g.prototype,"wheelPrecision",void 0),g);b.ArcRotateCameraMouseWheelInput=g;b.CameraInputTypes.ArcRotateCameraMouseWheelInput=g;}(BABYLON||(BABYLON={}));!function(b){var g;y4tt.v9();b.Tools.GetPointerPrefix();g=function(){this.angularSensibilityY=this.angularSensibilityX=1E3;this.pinchPrecision=6;this.panningSensibility=50;this._isCtrlPushed=this._isRightClick=!1;this.pinchInwards=!0;},g=(g.prototype.attachControl=function(e,c){var d,f,q,j,l,n;j=this,l=this.camera.getEngine(),n=0;this._pointerInput=function(l){var e,t;e=l.event;y4tt.v9();if(l.type===b.PointerEventTypes.POINTERDOWN){try{e.srcElement.setPointerCapture(e.pointerId);}catch(g){}j._isRightClick=2===e.button;d={x:e.clientX,y:e.clientY,pointerId:e.pointerId,type:e.pointerType};void 0===f?f=d:void 0===q&&(q=d);c||e.preventDefault();}else if(l.type===b.PointerEventTypes.POINTERUP){try{e.srcElement.releasePointerCapture(e.pointerId);}catch(s){}d=null;n=0;f=q=void 0;c||e.preventDefault();}else if(l.type===b.PointerEventTypes.POINTERMOVE)if(c||e.preventDefault(),f&&void 0===q)0!==j.panningSensibility&&(j._isCtrlPushed&&j.camera._useCtrlForPanning||!j.camera._useCtrlForPanning&&j._isRightClick)?(j.camera.inertialPanningX+=-(e.clientX-d.x)/j.panningSensibility,j.camera.inertialPanningY+=(e.clientY-d.y)/j.panningSensibility):(l=e.clientY-d.y,j.camera.inertialAlphaOffset-=(e.clientX-d.x)/j.angularSensibilityX,j.camera.inertialBetaOffset-=l/j.angularSensibilityY),d.x=e.clientX,d.y=e.clientY;else if(f&&q){l=f.pointerId===e.pointerId?f:q;l.x=e.clientX;l.y=e.clientY;e=j.pinchInwards?1:-1;l=f.x-q.x;t=f.y-q.y;l=l*l+t*t;if(0===n)return void(n=l);l!==n&&(j.camera.inertialRadiusOffset+=(l-n)/(j.pinchPrecision*((j.angularSensibilityX+j.angularSensibilityY)/2)*e),n=l);}};this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,b.PointerEventTypes.POINTERDOWN|b.PointerEventTypes.POINTERUP|b.PointerEventTypes.POINTERMOVE);this._onContextMenu=function(b){b.preventDefault();};this.camera._useCtrlForPanning||e.addEventListener("contextmenu",this._onContextMenu,!1);this._onLostFocus=function(){y4tt.q9();f=q=void 0;n=0;d=null;};this._onKeyDown=function(b){j._isCtrlPushed=b.ctrlKey;};this._onKeyUp=function(b){y4tt.q9();j._isCtrlPushed=b.ctrlKey;};this._onMouseMove=function(b){var d;y4tt.q9();if(l.isPointerLock){d=b.movementY||b.mozMovementY||b.webkitMovementY||b.msMovementY||0;j.camera.inertialAlphaOffset-=(b.movementX||b.mozMovementX||b.webkitMovementX||b.msMovementX||0)/j.angularSensibilityX;j.camera.inertialBetaOffset-=d/j.angularSensibilityY;c||b.preventDefault();}};this._onGestureStart=function(b){y4tt.q9();void 0!==window.MSGesture&&(j._MSGestureHandler||(j._MSGestureHandler=new MSGesture(),j._MSGestureHandler.target=e),j._MSGestureHandler.addPointer(b.pointerId));};this._onGesture=function(b){j.camera.radius*=b.scale;b.preventDefault&&(c||(b.stopPropagation(),b.preventDefault()));};e.addEventListener("mousemove",this._onMouseMove,!1);e.addEventListener("MSPointerDown",this._onGestureStart,!1);e.addEventListener("MSGestureChange",this._onGesture,!1);b.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]);},g.prototype.detachControl=function(e){e&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,e.removeEventListener("contextmenu",this._onContextMenu),e.removeEventListener("mousemove",this._onMouseMove),e.removeEventListener("MSPointerDown",this._onGestureStart),e.removeEventListener("MSGestureChange",this._onGesture),this._isRightClick=!1,this._isCtrlPushed=!1,this.pinchInwards=!0,this._onKeyDown=null,this._onKeyUp=null,this._onMouseMove=null,this._onGestureStart=null,this._onGesture=null,this._MSGestureHandler=null,this._onLostFocus=null,this._onContextMenu=null);b.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]);},g.prototype.getTypeName=function(){return"ArcRotateCameraPointersInput";},g.prototype.getSimpleName=function(){return"pointers";},__decorate([b.serialize()],g.prototype,"angularSensibilityX",void 0),__decorate([b.serialize()],g.prototype,"angularSensibilityY",void 0),__decorate([b.serialize()],g.prototype,"pinchPrecision",void 0),__decorate([b.serialize()],g.prototype,"panningSensibility",void 0),g);b.ArcRotateCameraPointersInput=g;b.CameraInputTypes.ArcRotateCameraPointersInput=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(){this.gamepadRotationSensibility=80;this.gamepadMoveSensibility=40;};g=(g.prototype.attachControl=function(){var e;e=this;y4tt.q9();this._gamepads=new b.Gamepads(function(b){e._onNewGameConnected(b);});},g.prototype.detachControl=function(){this._gamepads&&this._gamepads.dispose();this.gamepad=null;},g.prototype.checkInputs=function(){var b,c,d;if(this.gamepad){b=this.camera,c=this.gamepad.rightStick;if(0!=c.x){d=c.x/this.gamepadRotationSensibility;0!=d&&0.005<Math.abs(d)&&(b.inertialAlphaOffset+=d);}0!=c.y&&(c=c.y/this.gamepadRotationSensibility,0!=c&&0.005<Math.abs(c)&&(b.inertialBetaOffset+=c));b=this.gamepad.leftStick;0!=b.y&&(b=b.y/this.gamepadMoveSensibility,0!=b&&0.005<Math.abs(b)&&(this.camera.inertialRadiusOffset-=b));}},g.prototype._onNewGameConnected=function(b){0===b.index&&(this.gamepad=b);},g.prototype.getTypeName=function(){return"ArcRotateCameraGamepadInput";},g.prototype.getSimpleName=function(){return"gamepad";},__decorate([b.serialize()],g.prototype,"gamepadRotationSensibility",void 0),__decorate([b.serialize()],g.prototype,"gamepadMoveSensibility",void 0),g);b.ArcRotateCameraGamepadInput=g;b.CameraInputTypes.ArcRotateCameraGamepadInput=g;}(BABYLON||(BABYLON={}));!function(b){var g;y4tt.v9();g=function(){this.gammaCorrection=this.betaCorrection=this.alphaCorrection=1;this._gamma=this._beta=this._alpha=0;y4tt.q9();this._dirty=!1;this._deviceOrientationHandler=this._onOrientationEvent.bind(this);};g=(g.prototype.attachControl=function(b,c){this.camera.attachControl(b,c);y4tt.v9();window.addEventListener("deviceorientation",this._deviceOrientationHandler);},g.prototype._onOrientationEvent=function(b){this.camera;y4tt.v9();this._alpha=0|+b.alpha;this._beta=0|+b.beta;this._gamma=0|+b.gamma;this._dirty=!0;},g.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,0>this._gamma&&(this._gamma=180+this._gamma),this.camera.alpha=2*(-this._alpha/180*Math.PI%Math.PI),this.camera.beta=this._gamma/180*Math.PI);},g.prototype.detachControl=function(){window.removeEventListener("deviceorientation",this._deviceOrientationHandler);},g.prototype.getTypeName=function(){return"ArcRotateCameraVRDeviceOrientationInput";},g.prototype.getSimpleName=function(){return"VRDeviceOrientation";},g);b.ArcRotateCameraVRDeviceOrientationInput=g;b.CameraInputTypes.ArcRotateCameraVRDeviceOrientationInput=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.Camera,c=function(c,f,q){e.call(this,c,f,q);this.cameraDirection=new b.Vector3(0,0,0);this.cameraRotation=new b.Vector2(0,0);this.rotation=new b.Vector3(0,0,0);this.speed=2;this.noRotationConstraint=!1;this.lockedTarget=null;this._currentTarget=b.Vector3.Zero();this._viewMatrix=b.Matrix.Zero();this._camMatrix=b.Matrix.Zero();this._cameraTransformMatrix=b.Matrix.Zero();this._cameraRotationMatrix=b.Matrix.Zero();this._referencePoint=new b.Vector3(0,0,1);this._defaultUpVector=new b.Vector3(0,1,0);this._transformedReferencePoint=b.Vector3.Zero();y4tt.q9();this._lookAtTemp=b.Matrix.Zero();this._tempMatrix=b.Matrix.Zero();};g=(__extends(c,e),c.prototype.getFrontPosition=function(b){var c;y4tt.q9();c=this.getTarget().subtract(this.position);return c.normalize(),c.scaleInPlace(b),this.globalPosition.add(c);},c.prototype._getLockedTargetPosition=function(){return this.lockedTarget?this.lockedTarget.position||this.lockedTarget:null;},c.prototype._initCache=function(){e.prototype._initCache.call(this);y4tt.v9();this._cache.lockedTarget=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.rotation=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.rotationQuaternion=new b.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);},c.prototype._updateCache=function(b){b||e.prototype._updateCache.call(this);(b=this._getLockedTargetPosition())?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(b):this._cache.lockedTarget=b.clone():this._cache.lockedTarget=null;this._cache.rotation.copyFrom(this.rotation);this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion);},c.prototype._isSynchronizedViewMatrix=function(){var b;if(!e.prototype._isSynchronizedViewMatrix.call(this))return!1;b=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(b):!b)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation));},c.prototype._computeLocalCameraSpeed=function(){var b;b=this.getEngine();return this.speed*(b.getDeltaTime()/(10*b.getFps()));},c.prototype.setTarget=function(c){this.upVector.normalize();b.Matrix.LookAtLHToRef(this.position,c,this._defaultUpVector,this._camMatrix);this._camMatrix.invert();this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);c=c.subtract(this.position);y4tt.v9();0<=c.x?this.rotation.y=-Math.atan(c.z/c.x)+Math.PI/2:this.rotation.y=-Math.atan(c.z/c.x)-Math.PI/2;this.rotation.z=0;isNaN(this.rotation.x)&&(this.rotation.x=0);isNaN(this.rotation.y)&&(this.rotation.y=0);isNaN(this.rotation.z)&&(this.rotation.z=0);this.rotationQuaternion&&b.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion);},c.prototype.getTarget=function(){y4tt.v9();return this._currentTarget;},c.prototype._decideIfNeedsToMove=function(){return 0<Math.abs(this.cameraDirection.x)||0<Math.abs(this.cameraDirection.y)||0<Math.abs(this.cameraDirection.z);},c.prototype._updatePosition=function(){this.position.addInPlace(this.cameraDirection);},c.prototype._checkInputs=function(){var c,f,q;c=this._decideIfNeedsToMove(),f=0<Math.abs(this.cameraRotation.x)||0<Math.abs(this.cameraRotation.y);y4tt.v9();if(c&&this._updatePosition(),f&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,!this.noRotationConstraint)){q=0.95*(Math.PI/2);this.rotation.x>q&&(this.rotation.x=q);this.rotation.x<-q&&(this.rotation.x=-q);}c&&(Math.abs(this.cameraDirection.x)<b.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<b.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<b.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia));f&&(Math.abs(this.cameraRotation.x)<b.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<b.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia));e.prototype._checkInputs.call(this);},c.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix),b.Vector3.TransformNormalToRef(this._defaultUpVector,this._cameraRotationMatrix,this.upVector)):b.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix);},c.prototype._getViewMatrix=function(){return this.lockedTarget?this._currentTarget.copyFrom(this._getLockedTargetPosition()):(this._updateCameraRotationMatrix(),b.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget)),b.Matrix.LookAtLHToRef(this.position,this._currentTarget,this.upVector,this._viewMatrix),this._viewMatrix;},c.prototype.createRigCamera=function(d){return this.cameraRigMode!==b.Camera.RIG_MODE_NONE?(d=new c(d,this.position.clone(),this.getScene()),this.cameraRigMode===b.Camera.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new b.Quaternion()),d._cameraRigParams={},d.rotationQuaternion=new b.Quaternion()),d):null;},c.prototype._updateRigCameras=function(){var c,f,q;c=this._rigCameras[0],f=this._rigCameras[1];switch(this.cameraRigMode){case b.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case b.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:q=this.cameraRigMode===b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*(this.cameraRigMode===b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1),c.position);this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*q,f.position);c.setTarget(this.getTarget());f.setTarget(this.getTarget());break;case b.Camera.RIG_MODE_VR:c.rotationQuaternion.copyFrom(this.rotationQuaternion),f.rotationQuaternion.copyFrom(this.rotationQuaternion),c.position.copyFrom(this.position),f.position.copyFrom(this.position);}y4tt.q9();e.prototype._updateRigCameras.call(this);},c.prototype._getRigCamPosition=function(c,f){var e;this._rigCamTransformMatrix||(this._rigCamTransformMatrix=new b.Matrix());e=this.getTarget();b.Matrix.Translation(-e.x,-e.y,-e.z).multiplyToRef(b.Matrix.RotationY(c),this._rigCamTransformMatrix);y4tt.q9();this._rigCamTransformMatrix=this._rigCamTransformMatrix.multiply(b.Matrix.Translation(e.x,e.y,e.z));b.Vector3.TransformCoordinatesToRef(this.position,this._rigCamTransformMatrix,f);},c.prototype.getTypeName=function(){return"TargetCamera";},__decorate([b.serializeAsVector3()],c.prototype,"rotation",void 0),__decorate([b.serialize()],c.prototype,"speed",void 0),__decorate([b.serializeAsMeshReference("lockedTargetId")],c.prototype,"lockedTarget",void 0),c);y4tt.q9();b.TargetCamera=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;y4tt.v9();e=b.TargetCamera;g=function(c,d,f){var q;q=this;e.call(this,c,d,f);this.ellipsoid=new b.Vector3(0.5,1,0.5);this.applyGravity=this.checkCollisions=!1;this._collider=new b.Collider();this._needMoveForGravity=!1;this._oldPosition=b.Vector3.Zero();this._diffPosition=b.Vector3.Zero();this._newPosition=b.Vector3.Zero();this._onCollisionPositionChange=function(c,d,f){void 0===f&&(f=null);q.getScene().workerCollisions&&d.multiplyInPlace(q._collider.radius);y4tt.q9();q._newPosition.copyFrom(d);q._newPosition.subtractToRef(q._oldPosition,q._diffPosition);q.position.clone();q._diffPosition.length()>b.Engine.CollisionsEpsilon&&(q.position.addInPlace(q._diffPosition),q.onCollide&&f&&q.onCollide(f));};this.inputs=new b.FreeCameraInputsManager(this);this.inputs.addKeyboard().addMouse();};g=(__extends(g,e),Object.defineProperty(g.prototype,"angularSensibility",{get:function(){var b;b=this.inputs.attached.mouse;return b?b.angularSensibility:void 0;},set:function(b){var d;d=this.inputs.attached.mouse;y4tt.v9();d&&(d.angularSensibility=b);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"keysUp",{get:function(){var b;b=this.inputs.attached.keyboard;return b?b.keysUp:void 0;},set:function(b){var d;d=this.inputs.attached.keyboard;d&&(d.keysUp=b);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"keysDown",{get:function(){var b;b=this.inputs.attached.keyboard;return b?b.keysDown:void 0;},set:function(b){var d;y4tt.q9();d=this.inputs.attached.keyboard;d&&(d.keysDown=b);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"keysLeft",{get:function(){var b;b=this.inputs.attached.keyboard;return b?b.keysLeft:void 0;},set:function(b){var d;d=this.inputs.attached.keyboard;y4tt.q9();d&&(d.keysLeft=b);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"keysRight",{get:function(){var b;y4tt.q9();b=this.inputs.attached.keyboard;return b?b.keysRight:void 0;},set:function(b){var d;y4tt.v9();d=this.inputs.attached.keyboard;d&&(d.keysRight=b);},enumerable:!0,configurable:!0}),g.prototype.attachControl=function(b,d){this.inputs.attachElement(b,d);},g.prototype.detachControl=function(c){y4tt.v9();this.inputs.detachElement(c);this.cameraDirection=new b.Vector3(0,0,0);this.cameraRotation=new b.Vector2(0,0);},g.prototype._collideWithWorld=function(c){var d;(this.parent?b.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition);this._collider.radius=this.ellipsoid;d=c;this.applyGravity&&(d=c.add(this.getScene().gravity));y4tt.v9();this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,d,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId);},g.prototype._checkInputs=function(){this._localDirection||(this._localDirection=b.Vector3.Zero(),this._transformedDirection=b.Vector3.Zero());this.inputs.checkInputs();y4tt.v9();e.prototype._checkInputs.call(this);},g.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||0<Math.abs(this.cameraDirection.x)||0<Math.abs(this.cameraDirection.y)||0<Math.abs(this.cameraDirection.z);},g.prototype._updatePosition=function(){y4tt.v9();this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):this.position.addInPlace(this.cameraDirection);},g.prototype.dispose=function(){this.inputs.clear();e.prototype.dispose.call(this);},g.prototype.getTypeName=function(){return"FreeCamera";},__decorate([b.serializeAsVector3()],g.prototype,"ellipsoid",void 0),__decorate([b.serialize()],g.prototype,"checkCollisions",void 0),__decorate([b.serialize()],g.prototype,"applyGravity",void 0),g);b.FreeCamera=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.CameraInputsManager;y4tt.q9();g=function(b){y4tt.v9();e.call(this,b);};g=(__extends(g,e),g.prototype.addKeyboard=function(){return this.add(new b.FreeCameraKeyboardMoveInput()),this;},g.prototype.addMouse=function(c){y4tt.q9();return void 0===c&&(c=!0),this.add(new b.FreeCameraMouseInput(c)),this;},g.prototype.addGamepad=function(){y4tt.v9();return this.add(new b.FreeCameraGamepadInput()),this;},g.prototype.addDeviceOrientation=function(){y4tt.q9();return this.add(new b.FreeCameraDeviceOrientationInput()),this;},g.prototype.addVRDeviceOrientation=function(){y4tt.q9();return this.add(new b.FreeCameraVRDeviceOrientationInput()),this;},g.prototype.addTouch=function(){return this.add(new b.FreeCameraTouchInput()),this;},g.prototype.addVirtualJoystick=function(){y4tt.q9();return this.add(new b.FreeCameraVirtualJoystickInput()),this;},g);b.FreeCameraInputsManager=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.TargetCamera;g=function(b,c,q,j){e.call(this,b,c,q);this.radius=12;this.rotationOffset=0;this.heightOffset=4;this.cameraAcceleration=0.05;this.maxCameraSpeed=20;this.target=j;};g=(__extends(g,e),g.prototype.getRadians=function(b){return b*Math.PI/180;},g.prototype.follow=function(c){var f,e,j;y4tt.v9();if(c){c.rotationQuaternion?(f=new b.Matrix(),c.rotationQuaternion.toRotationMatrix(f),f=Math.atan2(f.m[8],f.m[10])):f=c.rotation.y;f=this.getRadians(this.rotationOffset)+f;e=c.position.x+Math.sin(f)*this.radius;f=c.position.z+Math.cos(f)*this.radius;e=2*(e-this.position.x)*this.cameraAcceleration,j=(c.position.y+this.heightOffset-this.position.y)*this.cameraAcceleration;f=2*(f-this.position.z)*this.cameraAcceleration;(e>this.maxCameraSpeed||e<-this.maxCameraSpeed)&&(e=1>e?-this.maxCameraSpeed:this.maxCameraSpeed);(j>this.maxCameraSpeed||j<-this.maxCameraSpeed)&&(j=1>j?-this.maxCameraSpeed:this.maxCameraSpeed);(f>this.maxCameraSpeed||f<-this.maxCameraSpeed)&&(f=1>f?-this.maxCameraSpeed:this.maxCameraSpeed);this.position=new b.Vector3(this.position.x+e,this.position.y+j,this.position.z+f);this.setTarget(c.position);}},g.prototype._checkInputs=function(){e.prototype._checkInputs.call(this);y4tt.q9();this.follow(this.target);},g.prototype.getTypeName=function(){y4tt.v9();return"FollowCamera";},__decorate([b.serialize()],g.prototype,"radius",void 0),__decorate([b.serialize()],g.prototype,"rotationOffset",void 0),__decorate([b.serialize()],g.prototype,"heightOffset",void 0),__decorate([b.serialize()],g.prototype,"cameraAcceleration",void 0),__decorate([b.serialize()],g.prototype,"maxCameraSpeed",void 0),__decorate([b.serializeAsMeshReference("lockedTargetId")],g.prototype,"target",void 0),g);b.FollowCamera=g;c=b.TargetCamera;g=function(d,f,e,j,l,n){c.call(this,d,b.Vector3.Zero(),n);this.alpha=f;this.beta=e;this.radius=j;y4tt.v9();this.target=l;this._cartesianCoordinates=b.Vector3.Zero();this.follow();};g=(__extends(g,c),g.prototype.follow=function(){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta);this._cartesianCoordinates.y=this.radius*Math.sin(this.beta);this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);this.position=this.target.position.add(this._cartesianCoordinates);this.setTarget(this.target.position);},g.prototype._checkInputs=function(){y4tt.v9();c.prototype._checkInputs.call(this);this.follow();},g.prototype.getTypeName=function(){y4tt.v9();return"ArcFollowCamera";},g);y4tt.q9();b.ArcFollowCamera=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.FreeCamera;g=function(b,d,f){y4tt.q9();e.call(this,b,d,f);this.inputs.addTouch();this._setupInputs();};g=(__extends(g,e),Object.defineProperty(g.prototype,"touchAngularSensibility",{get:function(){var b;b=this.inputs.attached.touch;return b?b.touchAngularSensibility:void 0;},set:function(b){var d;d=this.inputs.attached.touch;d&&(d.touchAngularSensibility=b);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"touchMoveSensibility",{get:function(){var b;b=this.inputs.attached.touch;return b?b.touchMoveSensibility:void 0;},set:function(b){var d;d=this.inputs.attached.touch;d&&(d.touchMoveSensibility=b);},enumerable:!0,configurable:!0}),g.prototype.getTypeName=function(){return"TouchCamera";},g.prototype._setupInputs=function(){var b;b=this.inputs.attached.mouse;b&&(b.touchEnabled=!1);},g);y4tt.q9();b.TouchCamera=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.TargetCamera,c=function(c,f,g,j,l,n){var m;m=this;e.call(this,c,b.Vector3.Zero(),n);this.inertialRadiusOffset=this.inertialBetaOffset=this.inertialAlphaOffset=0;this.upperAlphaLimit=this.lowerAlphaLimit=null;this.lowerBetaLimit=0.01;this.upperBetaLimit=Math.PI;this.upperRadiusLimit=this.lowerRadiusLimit=null;this.inertialPanningY=this.inertialPanningX=0;this.zoomOnFactor=1;this.targetScreenOffset=b.Vector2.Zero();this.allowUpsideDown=!0;this._viewMatrix=new b.Matrix();this.panningAxis=new b.Vector3(1,1,0);this.checkCollisions=!1;this.collisionRadius=new b.Vector3(0.5,0.5,0.5);this._collider=new b.Collider();this._previousPosition=b.Vector3.Zero();this._collisionVelocity=b.Vector3.Zero();this._newPosition=b.Vector3.Zero();this._onCollisionPositionChange=function(c,d,f){var l,e;void 0===f&&(f=null);m.getScene().workerCollisions&&m.checkCollisions&&d.multiplyInPlace(m._collider.radius);f?(m.setPosition(d),m.onCollide&&m.onCollide(f)):m._previousPosition.copyFrom(m.position);d=Math.cos(m.alpha);f=Math.sin(m.alpha);l=Math.cos(m.beta),e=Math.sin(m.beta);0===e&&(e=1E-4);c=m._getTargetPosition();c.addToRef(new b.Vector3(m.radius*d*e,m.radius*l,m.radius*f*e),m._newPosition);m.position.copyFrom(m._newPosition);d=m.upVector;m.allowUpsideDown&&0>m.beta&&(d=d.clone(),d=d.negate());b.Matrix.LookAtLHToRef(m.position,c,d,m._viewMatrix);m._viewMatrix.m[12]+=m.targetScreenOffset.x;m._viewMatrix.m[13]+=m.targetScreenOffset.y;m._collisionTriggered=!1;};l?this.target=l:this.target=b.Vector3.Zero();this.alpha=f;this.beta=g;this.radius=j;this.getViewMatrix();this.inputs=new b.ArcRotateCameraInputsManager(this);this.inputs.addKeyboard().addMouseWheel().addPointers().addGamepad();};g=(__extends(c,e),Object.defineProperty(c.prototype,"angularSensibilityX",{get:function(){var b;y4tt.q9();b=this.inputs.attached.pointers;return b?b.angularSensibilityX:void 0;},set:function(b){var c;c=this.inputs.attached.pointers;c&&(c.angularSensibilityX=b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"angularSensibilityY",{get:function(){var b;y4tt.q9();b=this.inputs.attached.pointers;return b?b.angularSensibilityY:void 0;},set:function(b){var c;c=this.inputs.attached.pointers;c&&(c.angularSensibilityY=b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"pinchPrecision",{get:function(){var b;b=this.inputs.attached.pointers;return b?b.pinchPrecision:void 0;},set:function(b){var c;c=this.inputs.attached.pointers;c&&(c.pinchPrecision=b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"panningSensibility",{get:function(){var b;y4tt.v9();b=this.inputs.attached.pointers;return b?b.panningSensibility:void 0;},set:function(b){var c;c=this.inputs.attached.pointers;c&&(c.panningSensibility=b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysUp",{get:function(){var b;b=this.inputs.attached.keyboard;return b?b.keysUp:void 0;},set:function(b){var c;y4tt.v9();c=this.inputs.attached.keyboard;c&&(c.keysUp=b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysDown",{get:function(){var b;b=this.inputs.attached.keyboard;return b?b.keysDown:void 0;},set:function(b){var c;y4tt.v9();c=this.inputs.attached.keyboard;c&&(c.keysDown=b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysLeft",{get:function(){var b;b=this.inputs.attached.keyboard;return b?b.keysLeft:void 0;},set:function(b){var c;y4tt.v9();c=this.inputs.attached.keyboard;c&&(c.keysLeft=b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysRight",{get:function(){var b;b=this.inputs.attached.keyboard;y4tt.v9();return b?b.keysRight:void 0;},set:function(b){var c;c=this.inputs.attached.keyboard;y4tt.v9();c&&(c.keysRight=b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"wheelPrecision",{get:function(){var b;y4tt.q9();b=this.inputs.attached.mousewheel;return b?b.wheelPrecision:void 0;},set:function(b){var c;y4tt.v9();c=this.inputs.attached.mousewheel;c&&(c.wheelPrecision=b);},enumerable:!0,configurable:!0}),c.prototype._initCache=function(){e.prototype._initCache.call(this);this._cache.target=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.alpha=void 0;this._cache.beta=void 0;this._cache.radius=void 0;this._cache.targetScreenOffset=b.Vector2.Zero();},c.prototype._updateCache=function(b){b||e.prototype._updateCache.call(this);y4tt.v9();this._cache.target.copyFrom(this._getTargetPosition());this._cache.alpha=this.alpha;this._cache.beta=this.beta;this._cache.radius=this.radius;this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset);},c.prototype._getTargetPosition=function(){return this.target.getAbsolutePosition?this.target.getAbsolutePosition():this.target;},c.prototype._isSynchronizedViewMatrix=function(){y4tt.q9();return e.prototype._isSynchronizedViewMatrix.call(this)?this._cache.target.equals(this.target)&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset):!1;},c.prototype.attachControl=function(b,c,e){var j;j=this;void 0===e&&(e=!0);this._useCtrlForPanning=e;y4tt.v9();this.inputs.attachElement(b,c);this._reset=function(){j.inertialAlphaOffset=0;j.inertialBetaOffset=0;j.inertialRadiusOffset=0;};},c.prototype.detachControl=function(b){this.inputs.detachElement(b);y4tt.v9();this._reset&&this._reset();},c.prototype._checkInputs=function(){this._collisionTriggered||(this.inputs.checkInputs(),0===this.inertialAlphaOffset&&0===this.inertialBetaOffset&&0===this.inertialRadiusOffset||(this.alpha+=0>=this.beta?-this.inertialAlphaOffset:this.inertialAlphaOffset,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<b.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<b.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<b.Epsilon&&(this.inertialRadiusOffset=0)),0===this.inertialPanningX&&0===this.inertialPanningY||(this._localDirection||(this._localDirection=b.Vector3.Zero(),this._transformedDirection=b.Vector3.Zero()),this.inertialPanningX*=this.inertia,this.inertialPanningY*=this.inertia,Math.abs(this.inertialPanningX)<b.Epsilon&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<b.Epsilon&&(this.inertialPanningY=0),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),b.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),this.target.getAbsolutePosition||this.target.addInPlace(this._transformedDirection)),this._checkLimits(),e.prototype._checkInputs.call(this));},c.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta-=2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit);null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta+=2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit);this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit);y4tt.v9();this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit);this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit);this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit);},c.prototype.rebuildAnglesAndRadius=function(){var b;b=this.position.subtract(this._getTargetPosition());this.radius=b.length();this.alpha=Math.acos(b.x/Math.sqrt(Math.pow(b.x,2)+Math.pow(b.z,2)));0>b.z&&(this.alpha=2*Math.PI-this.alpha);this.beta=Math.acos(b.y/this.radius);this._checkLimits();},c.prototype.setPosition=function(b){this.position.equals(b)||(this.position=b,this.rebuildAnglesAndRadius());},c.prototype.setTarget=function(b){this._getTargetPosition().equals(b)||(this.target=b,this.rebuildAnglesAndRadius());},c.prototype._getViewMatrix=function(){var c,f,e,j,l;c=Math.cos(this.alpha),f=Math.sin(this.alpha),e=Math.cos(this.beta),j=Math.sin(this.beta);0===j&&(j=1E-4);l=this._getTargetPosition();(l.addToRef(new b.Vector3(this.radius*c*j,this.radius*e,this.radius*f*j),this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions)?(this._collider.radius=this.collisionRadius,this._newPosition.subtractToRef(this.position,this._collisionVelocity),this._collisionTriggered=!0,this.getScene().collisionCoordinator.getNewPosition(this.position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)):(this.position.copyFrom(this._newPosition),c=this.upVector,this.allowUpsideDown&&0>this.beta&&(c=c.clone(),c=c.negate()),b.Matrix.LookAtLHToRef(this.position,l,c,this._viewMatrix),this._viewMatrix.m[12]+=this.targetScreenOffset.x,this._viewMatrix.m[13]+=this.targetScreenOffset.y);return this._viewMatrix;},c.prototype.zoomOn=function(c,f){var e,j;void 0===f&&(f=!1);c=c||this.getScene().meshes;e=b.Mesh.MinMax(c),j=b.Vector3.Distance(e.min,e.max);this.radius=j*this.zoomOnFactor;this.focusOn({min:e.min,max:e.max,distance:j},f);},c.prototype.focusOn=function(c,f){var e,j;void 0===f&&(f=!1);void 0===c.min?(e=c||this.getScene().meshes,e=b.Mesh.MinMax(e),j=b.Vector3.Distance(e.min,e.max)):(e=c,j=c.distance);this.target=b.Mesh.Center(e);f||(this.maxZ=2*j);},c.prototype.createRigCamera=function(d,f){var e;switch(this.cameraRigMode){case b.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case b.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case b.Camera.RIG_MODE_VR:e=this._cameraRigParams.stereoHalfAngle*(0===f?1:-1);break;case b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e=this._cameraRigParams.stereoHalfAngle*(0===f?-1:1);}e=new c(d,this.alpha+e,this.beta,this.radius,this.target,this.getScene());y4tt.v9();return e._cameraRigParams={},e;},c.prototype._updateRigCameras=function(){var c,f;c=this._rigCameras[0],f=this._rigCameras[1];switch(c.beta=f.beta=this.beta,c.radius=f.radius=this.radius,this.cameraRigMode){case b.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case b.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case b.Camera.RIG_MODE_VR:c.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle;f.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:c.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,f.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle;}e.prototype._updateRigCameras.call(this);},c.prototype.dispose=function(){this.inputs.clear();e.prototype.dispose.call(this);},c.prototype.getTypeName=function(){y4tt.v9();return"ArcRotateCamera";},__decorate([b.serialize()],c.prototype,"alpha",void 0),__decorate([b.serialize()],c.prototype,"beta",void 0),__decorate([b.serialize()],c.prototype,"radius",void 0),__decorate([b.serializeAsVector3()],c.prototype,"target",void 0),__decorate([b.serialize()],c.prototype,"inertialAlphaOffset",void 0),__decorate([b.serialize()],c.prototype,"inertialBetaOffset",void 0),__decorate([b.serialize()],c.prototype,"inertialRadiusOffset",void 0),__decorate([b.serialize()],c.prototype,"lowerAlphaLimit",void 0),__decorate([b.serialize()],c.prototype,"upperAlphaLimit",void 0),__decorate([b.serialize()],c.prototype,"lowerBetaLimit",void 0),__decorate([b.serialize()],c.prototype,"upperBetaLimit",void 0),__decorate([b.serialize()],c.prototype,"lowerRadiusLimit",void 0),__decorate([b.serialize()],c.prototype,"upperRadiusLimit",void 0),__decorate([b.serialize()],c.prototype,"inertialPanningX",void 0),__decorate([b.serialize()],c.prototype,"inertialPanningY",void 0),__decorate([b.serialize()],c.prototype,"zoomOnFactor",void 0),__decorate([b.serialize()],c.prototype,"allowUpsideDown",void 0),c);b.ArcRotateCamera=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.CameraInputsManager;g=function(b){y4tt.q9();e.call(this,b);};g=(__extends(g,e),g.prototype.addMouseWheel=function(){return this.add(new b.ArcRotateCameraMouseWheelInput()),this;},g.prototype.addPointers=function(){return this.add(new b.ArcRotateCameraPointersInput()),this;},g.prototype.addKeyboard=function(){y4tt.v9();return this.add(new b.ArcRotateCameraKeyboardMoveInput()),this;},g.prototype.addGamepad=function(){return this.add(new b.ArcRotateCameraGamepadInput()),this;},g.prototype.addVRDeviceOrientation=function(){return this.add(new b.ArcRotateCameraVRDeviceOrientationInput()),this;},g);b.ArcRotateCameraInputsManager=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(b){y4tt.q9();this._renderingGroups=[];this._scene=b;};g=(e.prototype._renderParticles=function(c,d){var l;if(0!==this._scene._activeParticleSystems.length){for(var f=this._scene.activeCamera,e=b.Tools.Now,j=0;j<this._scene._activeParticleSystems.length;j++){l=this._scene._activeParticleSystems.data[j];l.renderingGroupId===c&&0!==(f.layerMask&l.layerMask)&&(this._clearDepthBuffer(),l.emitter.position&&d&&-1===d.indexOf(l.emitter)||(this._scene._activeParticles+=l.render()));}this._scene._particlesDuration+=b.Tools.Now-e;}},e.prototype._renderSprites=function(c){var j;if(this._scene.spritesEnabled&&0!==this._scene.spriteManagers.length){for(var d=this._scene.activeCamera,f=b.Tools.Now,e=0;e<this._scene.spriteManagers.length;e++){j=this._scene.spriteManagers[e];j.renderingGroupId===c&&0!==(d.layerMask&j.layerMask)&&(this._clearDepthBuffer(),j.render());}this._scene._spritesDuration+=b.Tools.Now-f;}},e.prototype._clearDepthBuffer=function(){this._depthBufferAlreadyCleaned||(this._scene.getEngine().clear(0,!1,!0),this._depthBufferAlreadyCleaned=!0);},e.prototype._renderSpritesAndParticles=function(){this._currentRenderSprites&&this._renderSprites(this._currentIndex);this._currentRenderParticles&&this._renderParticles(this._currentIndex,this._currentActiveMeshes);},e.prototype.render=function(b,d,f,g){this._currentActiveMeshes=d;y4tt.q9();this._currentRenderParticles=f;this._currentRenderSprites=g;for(d=0;d<e.MAX_RENDERINGGROUPS;d++)this._depthBufferAlreadyCleaned=0==d,f=this._renderingGroups[d],g=!1,this._currentIndex=d,f?(this._clearDepthBuffer(),f.onBeforeTransparentRendering||(f.onBeforeTransparentRendering=this._renderSpritesAndParticles.bind(this)),f.render(b)||(this._renderingGroups.splice(d,1),g=!0,this._renderSpritesAndParticles())):this._renderSpritesAndParticles(),g&&d--;},e.prototype.reset=function(){y4tt.q9();this._renderingGroups.forEach(function(b){y4tt.v9();b&&b.prepare();});},e.prototype.dispatch=function(c){var d;d=c.getMesh().renderingGroupId||0;y4tt.q9();this._renderingGroups[d]||(this._renderingGroups[d]=new b.RenderingGroup(d,this._scene));this._renderingGroups[d].dispatch(c);},e.MAX_RENDERINGGROUPS=4,e);y4tt.q9();b.RenderingManager=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(e,c){this.index=e;this._opaqueSubMeshes=new b.SmartArray(256);this._transparentSubMeshes=new b.SmartArray(256);this._alphaTestSubMeshes=new b.SmartArray(256);this._scene=c;};g=(g.prototype.render=function(e){var c,d,f;if(e)return e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes),!0;if(0===this._opaqueSubMeshes.length&&0===this._alphaTestSubMeshes.length&&0===this._transparentSubMeshes.length)return this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),!1;d=this._scene.getEngine();for(e=0;e<this._opaqueSubMeshes.length;e++)c=this._opaqueSubMeshes.data[e],c.render(!1);d.setAlphaTesting(!0);for(e=0;e<this._alphaTestSubMeshes.length;e++)c=this._alphaTestSubMeshes.data[e],c.render(!1);if(d.setAlphaTesting(!1),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length){for(e=0;e<this._transparentSubMeshes.length;e++)c=this._transparentSubMeshes.data[e],c._alphaIndex=c.getMesh().alphaIndex,c._distanceToCamera=c.getBoundingInfo().boundingSphere.centerWorld.subtract(this._scene.activeCamera.globalPosition).length();f=this._transparentSubMeshes.data.slice(0,this._transparentSubMeshes.length);f.sort(function(b,c){return b._alphaIndex>c._alphaIndex?1:b._alphaIndex<c._alphaIndex?-1:b._distanceToCamera<c._distanceToCamera?1:b._distanceToCamera>c._distanceToCamera?-1:0;});for(e=0;e<f.length;e++)c=f[e],c.render(!0);d.setAlphaMode(b.Engine.ALPHA_DISABLE);}return!0;},g.prototype.prepare=function(){y4tt.q9();this._opaqueSubMeshes.reset();this._transparentSubMeshes.reset();this._alphaTestSubMeshes.reset();},g.prototype.dispatch=function(b){var c,d;y4tt.q9();c=b.getMaterial(),d=b.getMesh();c.needAlphaBlending()||1>d.visibility||d.hasVertexAlpha?this._transparentSubMeshes.push(b):c.needAlphaTesting()?this._alphaTestSubMeshes.push(b):this._opaqueSubMeshes.push(b);},g);b.RenderingGroup=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j;e=function(){};g=(Object.defineProperty(e,"POINTERDOWN",{get:function(){y4tt.v9();return e._POINTERDOWN;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERUP",{get:function(){return e._POINTERUP;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERMOVE",{get:function(){y4tt.q9();return e._POINTERMOVE;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERWHEEL",{get:function(){y4tt.q9();return e._POINTERWHEEL;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERPICK",{get:function(){y4tt.q9();return e._POINTERPICK;},enumerable:!0,configurable:!0}),e._POINTERDOWN=1,e._POINTERUP=2,e._POINTERMOVE=4,e._POINTERWHEEL=8,e._POINTERPICK=16,e);b.PointerEventTypes=g;y4tt.q9();c=function(b,c){this.type=b;this.event=c;};b.PointerInfoBase=c;f=function(d,f,e,j){c.call(this,d,f);this.skipOnPointerObservable=!1;this.localPosition=new b.Vector2(e,j);};d=(__extends(f,c),f);b.PointerInfoPre=d;f=function(b,d,f){c.call(this,b,d);y4tt.v9();this.pickInfo=f;};q=(__extends(f,c),f);b.PointerInfo=q;j=function(c){this.autoClear=!0;this.clearColor=new b.Color3(0.2,0.2,0.3);this.ambientColor=new b.Color3(0,0,0);this.forceShowBoundingBoxes=this.forcePointsCloud=this.forceWireframe=!1;this.animationsEnabled=!0;this.constantlyUpdateMeshUnderPointer=!1;this.onDisposeObservable=new b.Observable();this.onBeforeRenderObservable=new b.Observable();this.onAfterRenderObservable=new b.Observable();this.onReadyObservable=new b.Observable();this.onBeforeCameraRenderObservable=new b.Observable();this.onAfterCameraRenderObservable=new b.Observable();this.onNewCameraAddedObservable=new b.Observable();this.onCameraRemovedObservable=new b.Observable();this.onNewLightAddedObservable=new b.Observable();this.onLightRemovedObservable=new b.Observable();this.onNewGeometryAddedObservable=new b.Observable();this.onGeometryRemovedObservable=new b.Observable();this.onNewMeshAddedObservable=new b.Observable();this.onMeshRemovedObservable=new b.Observable();this.animations=[];this.onPrePointerObservable=new b.Observable();this.onPointerObservable=new b.Observable();this.cameraToUseForPointers=null;this._startingPointerPosition=new b.Vector2(0,0);this._startingPointerTime=0;this.fogEnabled=!0;this.fogMode=j.FOGMODE_NONE;this.fogColor=new b.Color3(0.2,0.2,0.3);this.fogDensity=0.1;this.fogStart=0;this.fogEnd=1E3;this.lightsEnabled=this.shadowsEnabled=!0;this.lights=[];this.cameras=[];this.activeCameras=[];this.meshes=[];this._geometries=[];this.materials=[];this.multiMaterials=[];this.defaultMaterial=new b.StandardMaterial("default material",this);this.texturesEnabled=!0;this.textures=[];this.particlesEnabled=!0;this.particleSystems=[];this.spritesEnabled=!0;this.spriteManagers=[];this.layers=[];this.skeletonsEnabled=!0;this.skeletons=[];this.lensFlaresEnabled=!0;this.lensFlareSystems=[];this.collisionsEnabled=!0;this.gravity=new b.Vector3(0,-9.807,0);this.renderTargetsEnabled=this.postProcessesEnabled=!0;this.dumpNextRenderTargets=!1;this.customRenderTargets=[];this.importedMeshesFiles=[];this.probesEnabled=!0;this.reflectionProbes=[];this._actionManagers=[];this._meshesForIntersections=new b.SmartArray(256);this.proceduralTexturesEnabled=!0;this._proceduralTextures=[];this.soundTracks=[];this._audioEnabled=!0;this._headphone=!1;this._renderId=this._animationRatio=this._spritesDuration=this._renderDuration=this._particlesDuration=this._renderTargetsDuration=this._evaluateActiveMeshesDuration=this._lastFrameDuration=this._activeParticles=this._activeIndices=this._totalVertices=0;this._executeWhenReadyTimeoutId=-1;this._intermediateRendering=!1;this._toBeDisposed=new b.SmartArray(256);this._pendingData=[];this._activeMeshes=new b.SmartArray(256);this._processedMaterials=new b.SmartArray(256);this._renderTargets=new b.SmartArray(256);this._activeParticleSystems=new b.SmartArray(256);this._activeSkeletons=new b.SmartArray(32);this._softwareSkinnedMeshes=new b.SmartArray(32);this._activeBones=0;this._activeAnimatables=[];this._transformMatrix=b.Matrix.Zero();this._edgesRenderers=new b.SmartArray(16);this._uniqueIdCounter=0;this._engine=c;c.scenes.push(this);this._renderingManager=new b.RenderingManager(this);this.postProcessManager=new b.PostProcessManager(this);this.postProcessRenderPipelineManager=new b.PostProcessRenderPipelineManager();this._boundingBoxRenderer=new b.BoundingBoxRenderer(this);b.OutlineRenderer&&(this._outlineRenderer=new b.OutlineRenderer(this));this.attachControl();b.SoundTrack&&(this.mainSoundTrack=new b.SoundTrack(this,{mainTrack:!0}));b.SimplificationQueue&&(this.simplificationQueue=new b.SimplificationQueue());this.workerCollisions=!1;},f=(Object.defineProperty(j,"FOGMODE_NONE",{get:function(){y4tt.q9();return j._FOGMODE_NONE;},enumerable:!0,configurable:!0}),Object.defineProperty(j,"FOGMODE_EXP",{get:function(){y4tt.v9();return j._FOGMODE_EXP;},enumerable:!0,configurable:!0}),Object.defineProperty(j,"FOGMODE_EXP2",{get:function(){return j._FOGMODE_EXP2;},enumerable:!0,configurable:!0}),Object.defineProperty(j,"FOGMODE_LINEAR",{get:function(){return j._FOGMODE_LINEAR;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"onDispose",{set:function(b){y4tt.q9();this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"beforeRender",{set:function(b){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);y4tt.q9();this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"afterRender",{set:function(b){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver);y4tt.q9();this._onAfterRenderObserver=this.onAfterRenderObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"beforeCameraRender",{set:function(b){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver);this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"afterCameraRender",{set:function(b){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver);this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"unTranslatedPointer",{get:function(){y4tt.q9();return new b.Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY);},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new b.DebugLayer(this)),this._debugLayer;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"workerCollisions",{get:function(){return this._workerCollisions;},set:function(c){y4tt.q9();this._workerCollisions=c=c&&!!Worker;this.collisionCoordinator&&this.collisionCoordinator.destroy();this.collisionCoordinator=c?new b.CollisionCoordinatorWorker():new b.CollisionCoordinatorLegacy();this.collisionCoordinator.init(this);},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"SelectionOctree",{get:function(){return this._selectionOctree;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"meshUnderPointer",{get:function(){y4tt.v9();return this._pointerOverMesh;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"pointerX",{get:function(){return this._pointerX;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"pointerY",{get:function(){return this._pointerY;},enumerable:!0,configurable:!0}),j.prototype.getCachedMaterial=function(){return this._cachedMaterial;},j.prototype.getBoundingBoxRenderer=function(){y4tt.q9();return this._boundingBoxRenderer;},j.prototype.getOutlineRenderer=function(){y4tt.v9();return this._outlineRenderer;},j.prototype.getEngine=function(){y4tt.q9();return this._engine;},j.prototype.getTotalVertices=function(){return this._totalVertices;},j.prototype.getActiveIndices=function(){return this._activeIndices;},j.prototype.getActiveParticles=function(){return this._activeParticles;},j.prototype.getActiveBones=function(){y4tt.v9();return this._activeBones;},j.prototype.getLastFrameDuration=function(){y4tt.v9();return this._lastFrameDuration;},j.prototype.getEvaluateActiveMeshesDuration=function(){return this._evaluateActiveMeshesDuration;},j.prototype.getActiveMeshes=function(){y4tt.v9();return this._activeMeshes;},j.prototype.getRenderTargetsDuration=function(){y4tt.v9();return this._renderTargetsDuration;},j.prototype.getRenderDuration=function(){y4tt.q9();return this._renderDuration;},j.prototype.getParticlesDuration=function(){y4tt.q9();return this._particlesDuration;},j.prototype.getSpritesDuration=function(){y4tt.q9();return this._spritesDuration;},j.prototype.getAnimationRatio=function(){return this._animationRatio;},j.prototype.getRenderId=function(){return this._renderId;},j.prototype.incrementRenderId=function(){y4tt.q9();this._renderId++;},j.prototype._updatePointerPosition=function(b){var c;c=this._engine.getRenderingCanvasClientRect();this._pointerX=b.clientX-c.left;this._pointerY=b.clientY-c.top;this._unTranslatedPointerX=this._pointerX;this._unTranslatedPointerY=this._pointerY;this.cameraToUseForPointers&&(this._pointerX-=this.cameraToUseForPointers.viewport.x*this._engine.getRenderWidth(),this._pointerY-=this.cameraToUseForPointers.viewport.y*this._engine.getRenderHeight());},j.prototype.attachControl=function(c,f,e){var j,r,s;y4tt.v9();j=this;void 0===c&&(c=!0);void 0===f&&(f=!0);void 0===e&&(e=!0);r=function(b){return b.isPickable&&b.actionManager&&b.actionManager.hasPointerTriggers;};this._onPointerMove=function(b){var c,f;y4tt.q9();if(j._updatePointerPosition(b),j.onPrePointerObservable.hasObservers()){c="mousewheel"===b.type||"DOMMouseScroll"===b.type?g.POINTERWHEEL:g.POINTERMOVE,f=new d(c,b,j._unTranslatedPointerX,j._unTranslatedPointerY);if(j.onPrePointerObservable.notifyObservers(f,c),f.skipOnPointerObservable)return;}if(j.cameraToUseForPointers||j.activeCamera)if(c=j._engine.getRenderingCanvas(),j.pointerMovePredicate||(j.pointerMovePredicate=function(b){return b.isPickable&&b.isVisible&&b.isReady()&&(j.constantlyUpdateMeshUnderPointer||null!==b.actionManager&&void 0!==b.actionManager);}),f=j.pick(j._unTranslatedPointerX,j._unTranslatedPointerY,j.pointerMovePredicate,!1,j.cameraToUseForPointers),f.hit&&f.pickedMesh?(j.setPointerOverSprite(null),j.setPointerOverMesh(f.pickedMesh),j._pointerOverMesh.actionManager&&j._pointerOverMesh.actionManager.hasPointerTriggers?c.style.cursor="pointer":c.style.cursor=""):(j.setPointerOverMesh(null),f=j.pickSprite(j._unTranslatedPointerX,j._unTranslatedPointerY,r,!1,j.cameraToUseForPointers),f.hit&&f.pickedSprite?(c.style.cursor="pointer",j.setPointerOverSprite(f.pickedSprite)):(j.setPointerOverSprite(null),c.style.cursor="")),j.onPointerMove&&j.onPointerMove(b,f),j.onPointerObservable.hasObservers())c="mousewheel"===b.type||"DOMMouseScroll"===b.type?g.POINTERWHEEL:g.POINTERMOVE,f=new q(c,b,f),j.onPointerObservable.notifyObservers(f,c);};this._onPointerDown=function(c){var f,l,e;y4tt.v9();if(j._updatePointerPosition(c),j.onPrePointerObservable.hasObservers()){f=g.POINTERDOWN,l=new d(f,c,j._unTranslatedPointerX,j._unTranslatedPointerY);if(j.onPrePointerObservable.notifyObservers(l,f),l.skipOnPointerObservable)return;}if(j.cameraToUseForPointers||j.activeCamera){j._startingPointerPosition.x=j._pointerX;j._startingPointerPosition.y=j._pointerY;j._startingPointerTime=new Date().getTime();j.pointerDownPredicate||(j.pointerDownPredicate=function(b){return b.isPickable&&b.isVisible&&b.isReady()&&(!b.actionManager||b.actionManager.hasPointerTriggers);});j._pickedDownMesh=null;e=j.pick(j._unTranslatedPointerX,j._unTranslatedPointerY,j.pointerDownPredicate,!1,j.cameraToUseForPointers);if(e.hit&&e.pickedMesh&&e.pickedMesh.actionManager){if(j._pickedDownMesh=e.pickedMesh,e.pickedMesh.actionManager.hasPickTriggers){switch(c.button){case 0:e.pickedMesh.actionManager.processTrigger(b.ActionManager.OnLeftPickTrigger,b.ActionEvent.CreateNew(e.pickedMesh,c));break;case 1:e.pickedMesh.actionManager.processTrigger(b.ActionManager.OnCenterPickTrigger,b.ActionEvent.CreateNew(e.pickedMesh,c));break;case 2:e.pickedMesh.actionManager.processTrigger(b.ActionManager.OnRightPickTrigger,b.ActionEvent.CreateNew(e.pickedMesh,c));}e.pickedMesh.actionManager.processTrigger(b.ActionManager.OnPickDownTrigger,b.ActionEvent.CreateNew(e.pickedMesh,c));}e.pickedMesh.actionManager.hasSpecificTrigger(b.ActionManager.OnLongPressTrigger)&&window.setTimeout(function(){var d;d=j.pick(j._unTranslatedPointerX,j._unTranslatedPointerY,function(c){y4tt.q9();return c.isPickable&&c.isVisible&&c.isReady()&&c.actionManager&&c.actionManager.hasSpecificTrigger(b.ActionManager.OnLongPressTrigger);},!1,j.cameraToUseForPointers);d.hit&&d.pickedMesh&&d.pickedMesh.actionManager&&0!==j._startingPointerTime&&new Date().getTime()-j._startingPointerTime>b.ActionManager.LongPressDelay&&Math.abs(j._startingPointerPosition.x-j._pointerX)<b.ActionManager.DragMovementThreshold&&Math.abs(j._startingPointerPosition.y-j._pointerY)<b.ActionManager.DragMovementThreshold&&(j._startingPointerTime=0,d.pickedMesh.actionManager.processTrigger(b.ActionManager.OnLongPressTrigger,b.ActionEvent.CreateNew(d.pickedMesh,c)));},b.ActionManager.LongPressDelay);}if(j.onPointerDown&&j.onPointerDown(c,e),j.onPointerObservable.hasObservers())f=g.POINTERDOWN,l=new q(f,c,e),j.onPointerObservable.notifyObservers(l,f);if(j._pickedDownSprite=null,0<j.spriteManagers.length&&(e=j.pickSprite(j._unTranslatedPointerX,j._unTranslatedPointerY,r,!1,j.cameraToUseForPointers),e.hit&&e.pickedSprite&&e.pickedSprite.actionManager)){switch(j._pickedDownSprite=e.pickedSprite,c.button){case 0:e.pickedSprite.actionManager.processTrigger(b.ActionManager.OnLeftPickTrigger,b.ActionEvent.CreateNewFromSprite(e.pickedSprite,j,c));break;case 1:e.pickedSprite.actionManager.processTrigger(b.ActionManager.OnCenterPickTrigger,b.ActionEvent.CreateNewFromSprite(e.pickedSprite,j,c));break;case 2:e.pickedSprite.actionManager.processTrigger(b.ActionManager.OnRightPickTrigger,b.ActionEvent.CreateNewFromSprite(e.pickedSprite,j,c));}e.pickedSprite.actionManager.processTrigger(b.ActionManager.OnPickDownTrigger,b.ActionEvent.CreateNewFromSprite(e.pickedSprite,j,c));}}};this._onPointerUp=function(c){var f,l,e;if(j._updatePointerPosition(c),j.onPrePointerObservable.hasObservers()){f=g.POINTERUP,l=new d(f,c,j._unTranslatedPointerX,j._unTranslatedPointerY);if(j.onPrePointerObservable.notifyObservers(l,f),l.skipOnPointerObservable)return;}y4tt.v9();if(j.cameraToUseForPointers||j.activeCamera){j.pointerUpPredicate||(j.pointerUpPredicate=function(c){return c.isPickable&&c.isVisible&&c.isReady()&&(!c.actionManager||c.actionManager.hasPickTriggers||c.actionManager.hasSpecificTrigger(b.ActionManager.OnLongPressTrigger));});e=j.pick(j._unTranslatedPointerX,j._unTranslatedPointerY,j.pointerUpPredicate,!1,j.cameraToUseForPointers);if(e.hit&&e.pickedMesh){if(null!=j._pickedDownMesh&&e.pickedMesh==j._pickedDownMesh&&(j.onPointerPick&&j.onPointerPick(c,e),j.onPointerObservable.hasObservers()))f=g.POINTERPICK,l=new q(f,c,e),j.onPointerObservable.notifyObservers(l,f);e.pickedMesh.actionManager&&(e.pickedMesh.actionManager.processTrigger(b.ActionManager.OnPickUpTrigger,b.ActionEvent.CreateNew(e.pickedMesh,c)),Math.abs(j._startingPointerPosition.x-j._pointerX)<b.ActionManager.DragMovementThreshold&&Math.abs(j._startingPointerPosition.y-j._pointerY)<b.ActionManager.DragMovementThreshold&&e.pickedMesh.actionManager.processTrigger(b.ActionManager.OnPickTrigger,b.ActionEvent.CreateNew(e.pickedMesh,c)));}if(j._pickedDownMesh&&j._pickedDownMesh!==e.pickedMesh&&j._pickedDownMesh.actionManager.processTrigger(b.ActionManager.OnPickOutTrigger,b.ActionEvent.CreateNew(j._pickedDownMesh,c)),j.onPointerUp&&j.onPointerUp(c,e),j.onPointerObservable.hasObservers())f=g.POINTERUP,l=new q(f,c,e),j.onPointerObservable.notifyObservers(l,f);j._startingPointerTime=0;0<j.spriteManagers.length&&(e=j.pickSprite(j._unTranslatedPointerX,j._unTranslatedPointerY,r,!1,j.cameraToUseForPointers),e.hit&&e.pickedSprite&&e.pickedSprite.actionManager&&(e.pickedSprite.actionManager.processTrigger(b.ActionManager.OnPickUpTrigger,b.ActionEvent.CreateNewFromSprite(e.pickedSprite,j,c)),Math.abs(j._startingPointerPosition.x-j._pointerX)<b.ActionManager.DragMovementThreshold&&Math.abs(j._startingPointerPosition.y-j._pointerY)<b.ActionManager.DragMovementThreshold&&e.pickedSprite.actionManager.processTrigger(b.ActionManager.OnPickTrigger,b.ActionEvent.CreateNewFromSprite(e.pickedSprite,j,c))),j._pickedDownSprite&&j._pickedDownSprite!==e.pickedSprite&&j._pickedDownSprite.actionManager.processTrigger(b.ActionManager.OnPickOutTrigger,b.ActionEvent.CreateNewFromSprite(j._pickedDownSprite,j,c)));}};this._onKeyDown=function(c){j.actionManager&&j.actionManager.processTrigger(b.ActionManager.OnKeyDownTrigger,b.ActionEvent.CreateNewFromScene(j,c));};this._onKeyUp=function(c){y4tt.q9();j.actionManager&&j.actionManager.processTrigger(b.ActionManager.OnKeyUpTrigger,b.ActionEvent.CreateNewFromScene(j,c));};s=b.Tools.GetPointerPrefix();e&&(this._engine.getRenderingCanvas().addEventListener(s+"move",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener("mousewheel",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener("DOMMouseScroll",this._onPointerMove,!1));f&&this._engine.getRenderingCanvas().addEventListener(s+"down",this._onPointerDown,!1);c&&this._engine.getRenderingCanvas().addEventListener(s+"up",this._onPointerUp,!1);b.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp}]);},j.prototype.detachControl=function(){var c;c=b.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().removeEventListener(c+"move",this._onPointerMove);this._engine.getRenderingCanvas().removeEventListener(c+"down",this._onPointerDown);this._engine.getRenderingCanvas().removeEventListener(c+"up",this._onPointerUp);y4tt.v9();this._engine.getRenderingCanvas().removeEventListener("mousewheel",this._onPointerMove);this._engine.getRenderingCanvas().removeEventListener("DOMMouseScroll",this._onPointerMove);b.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp}]);},j.prototype.isReady=function(){var c,d,f;if(0<this._pendingData.length)return!1;for(c=0;c<this._geometries.length;c++)if(this._geometries[c].delayLoadState===b.Engine.DELAYLOADSTATE_LOADING)return!1;for(c=0;c<this.meshes.length;c++){d=this.meshes[c];if(!d.isReady())return!1;f=d.material;if(f&&!f.isReady(d))return!1;}return!0;},j.prototype.resetCachedMaterial=function(){y4tt.v9();this._cachedMaterial=null;},j.prototype.registerBeforeRender=function(b){y4tt.v9();this.onBeforeRenderObservable.add(b);},j.prototype.unregisterBeforeRender=function(b){y4tt.v9();this.onBeforeRenderObservable.removeCallback(b);},j.prototype.registerAfterRender=function(b){this.onAfterRenderObservable.add(b);},j.prototype.unregisterAfterRender=function(b){y4tt.v9();this.onAfterRenderObservable.removeCallback(b);},j.prototype._addPendingData=function(b){this._pendingData.push(b);},j.prototype._removePendingData=function(b){b=this._pendingData.indexOf(b);-1!==b&&this._pendingData.splice(b,1);},j.prototype.getWaitingItemsCount=function(){return this._pendingData.length;},j.prototype.executeWhenReady=function(b){var c;c=this;y4tt.v9();this.onReadyObservable.add(b);-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){c._checkIsReady();},150));},j.prototype._checkIsReady=function(){var b;b=this;y4tt.q9();return this.isReady()?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){y4tt.v9();b._checkIsReady();},150));},j.prototype.beginAnimation=function(c,d,f,e,j,g,q){if(void 0===j&&(j=1),this.stopAnimation(c),q||(q=new b.Animatable(this,c,d,f,e,j,g)),c.animations&&q.appendAnimations(c,c.animations),c.getAnimatables){c=c.getAnimatables();for(var v=0;v<c.length;v++)this.beginAnimation(c[v],d,f,e,j,g,q);}y4tt.v9();return q.reset(),q;},j.prototype.beginDirectAnimation=function(c,d,f,e,j,g,q){void 0===g&&(g=1);return new b.Animatable(this,c,f,e,j,g,q,d);},j.prototype.getAnimatableByTarget=function(b){for(var c=0;c<this._activeAnimatables.length;c++)if(this._activeAnimatables[c].target===b)return this._activeAnimatables[c];y4tt.v9();return null;},Object.defineProperty(j.prototype,"Animatables",{get:function(){y4tt.q9();return this._activeAnimatables;},enumerable:!0,configurable:!0}),j.prototype.stopAnimation=function(b){(b=this.getAnimatableByTarget(b))&&b.stop();},j.prototype._animate=function(){if(this.animationsEnabled&&0!==this._activeAnimatables.length){if(!this._animationStartDate){if(0<this._pendingData.length)return;this._animationStartDate=b.Tools.Now;}for(var c=b.Tools.Now-this._animationStartDate,d=0;d<this._activeAnimatables.length;d++)this._activeAnimatables[d]._animate(c);}},j.prototype.getViewMatrix=function(){return this._viewMatrix;},j.prototype.getProjectionMatrix=function(){return this._projectionMatrix;},j.prototype.getTransformMatrix=function(){return this._transformMatrix;},j.prototype.setTransformMatrix=function(b,c){this._viewMatrix=b;this._projectionMatrix=c;this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix);},j.prototype.addMesh=function(b){b.uniqueId=this._uniqueIdCounter++;this.meshes.push(b);this.collisionCoordinator.onMeshAdded(b);this.onNewMeshAddedObservable.notifyObservers(b);},j.prototype.removeMesh=function(b){var c;y4tt.q9();c=this.meshes.indexOf(b);return-1!==c&&this.meshes.splice(c,1),this.collisionCoordinator.onMeshRemoved(b),this.onMeshRemovedObservable.notifyObservers(b),c;},j.prototype.removeSkeleton=function(b){b=this.skeletons.indexOf(b);y4tt.v9();return-1!==b&&this.skeletons.splice(b,1),b;},j.prototype.removeLight=function(b){var c;c=this.lights.indexOf(b);return-1!==c&&this.lights.splice(c,1),this.onLightRemovedObservable.notifyObservers(b),c;},j.prototype.removeCamera=function(b){var c,d;c=this.cameras.indexOf(b);-1!==c&&this.cameras.splice(c,1);d=this.activeCameras.indexOf(b);y4tt.q9();return-1!==d&&this.activeCameras.splice(d,1),this.activeCamera===b&&(0<this.cameras.length?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(b),c;},j.prototype.addLight=function(b){b.uniqueId=this._uniqueIdCounter++;y4tt.q9();this.lights.push(b);this.onNewLightAddedObservable.notifyObservers(b);},j.prototype.addCamera=function(b){b.uniqueId=this._uniqueIdCounter++;this.cameras.push(b);this.onNewCameraAddedObservable.notifyObservers(b);},j.prototype.swithActiveCamera=function(b,c){var d;void 0===c&&(c=!0);d=this._engine.getRenderingCanvas();this.activeCamera.detachControl(d);this.activeCamera=b;c&&b.attachControl(d);},j.prototype.setActiveCameraByID=function(b){return(b=this.getCameraByID(b))?(this.activeCamera=b,b):null;},j.prototype.setActiveCameraByName=function(b){return(b=this.getCameraByName(b))?(this.activeCamera=b,b):null;},j.prototype.getMaterialByID=function(b){for(var c=0;c<this.materials.length;c++)if(this.materials[c].id===b)return this.materials[c];return null;},j.prototype.getMaterialByName=function(b){for(var c=0;c<this.materials.length;c++)if(this.materials[c].name===b)return this.materials[c];y4tt.q9();return null;},j.prototype.getLensFlareSystemByName=function(b){y4tt.v9();for(var c=0;c<this.lensFlareSystems.length;c++)if(this.lensFlareSystems[c].name===b)return this.lensFlareSystems[c];return null;},j.prototype.getLensFlareSystemByID=function(b){for(var c=0;c<this.lensFlareSystems.length;c++)if(this.lensFlareSystems[c].id===b)return this.lensFlareSystems[c];return null;},j.prototype.getCameraByID=function(b){for(var c=0;c<this.cameras.length;c++)if(this.cameras[c].id===b)return this.cameras[c];return null;},j.prototype.getCameraByUniqueID=function(b){y4tt.v9();for(var c=0;c<this.cameras.length;c++)if(this.cameras[c].uniqueId===b)return this.cameras[c];return null;},j.prototype.getCameraByName=function(b){for(var c=0;c<this.cameras.length;c++)if(this.cameras[c].name===b)return this.cameras[c];return null;},j.prototype.getBoneByID=function(b){for(var c=0;c<this.skeletons.length;c++)for(var d=this.skeletons[c],f=0;f<d.bones.length;f++)if(d.bones[f].id===b)return d.bones[f];return null;},j.prototype.getBoneByName=function(b){for(var c=0;c<this.skeletons.length;c++)for(var d=this.skeletons[c],f=0;f<d.bones.length;f++)if(d.bones[f].name===b)return d.bones[f];return null;},j.prototype.getLightByName=function(b){for(var c=0;c<this.lights.length;c++)if(this.lights[c].name===b)return this.lights[c];return null;},j.prototype.getLightByID=function(b){for(var c=0;c<this.lights.length;c++)if(this.lights[c].id===b)return this.lights[c];return null;},j.prototype.getLightByUniqueID=function(b){for(var c=0;c<this.lights.length;c++)if(this.lights[c].uniqueId===b)return this.lights[c];return null;},j.prototype.getParticleSystemByID=function(b){for(var c=0;c<this.particleSystems.length;c++)if(this.particleSystems[c].id===b)return this.particleSystems[c];return null;},j.prototype.getGeometryByID=function(b){for(var c=0;c<this._geometries.length;c++)if(this._geometries[c].id===b)return this._geometries[c];return null;},j.prototype.pushGeometry=function(b,c){y4tt.v9();return!c&&this.getGeometryByID(b.id)?!1:(this._geometries.push(b),this.collisionCoordinator.onGeometryAdded(b),this.onNewGeometryAddedObservable.notifyObservers(b),!0);},j.prototype.removeGeometry=function(b){var c;y4tt.v9();c=this._geometries.indexOf(b);return-1<c?(this._geometries.splice(c,1),this.collisionCoordinator.onGeometryDeleted(b),this.onGeometryRemovedObservable.notifyObservers(b),!0):!1;},j.prototype.getGeometries=function(){return this._geometries;},j.prototype.getMeshByID=function(b){for(var c=0;c<this.meshes.length;c++)if(this.meshes[c].id===b)return this.meshes[c];return null;},j.prototype.getMeshesByID=function(b){return this.meshes.filter(function(c){return c.id===b;});},j.prototype.getMeshByUniqueID=function(b){y4tt.q9();for(var c=0;c<this.meshes.length;c++)if(this.meshes[c].uniqueId===b)return this.meshes[c];return null;},j.prototype.getLastMeshByID=function(b){for(var c=this.meshes.length-1;0<=c;c--)if(this.meshes[c].id===b)return this.meshes[c];y4tt.q9();return null;},j.prototype.getLastEntryByID=function(b){var c;for(c=this.meshes.length-1;0<=c;c--)if(this.meshes[c].id===b)return this.meshes[c];for(c=this.cameras.length-1;0<=c;c--)if(this.cameras[c].id===b)return this.cameras[c];for(c=this.lights.length-1;0<=c;c--)if(this.lights[c].id===b)return this.lights[c];return null;},j.prototype.getNodeByID=function(b){var c;c=this.getMeshByID(b);return c||(c=this.getLightByID(b))?c:(c=this.getCameraByID(b))?c:this.getBoneByID(b);},j.prototype.getNodeByName=function(b){var c;c=this.getMeshByName(b);return c||(c=this.getLightByName(b))?c:(c=this.getCameraByName(b))?c:this.getBoneByName(b);},j.prototype.getMeshByName=function(b){y4tt.q9();for(var c=0;c<this.meshes.length;c++)if(this.meshes[c].name===b)return this.meshes[c];return null;},j.prototype.getSoundByName=function(c){var d;y4tt.v9();if(b.AudioEngine){for(d=0;d<this.mainSoundTrack.soundCollection.length;d++)if(this.mainSoundTrack.soundCollection[d].name===c)return this.mainSoundTrack.soundCollection[d];for(var f=0;f<this.soundTracks.length;f++)for(d=0;d<this.soundTracks[f].soundCollection.length;d++)if(this.soundTracks[f].soundCollection[d].name===c)return this.soundTracks[f].soundCollection[d];}return null;},j.prototype.getLastSkeletonByID=function(b){y4tt.q9();for(var c=this.skeletons.length-1;0<=c;c--)if(this.skeletons[c].id===b)return this.skeletons[c];return null;},j.prototype.getSkeletonById=function(b){for(var c=0;c<this.skeletons.length;c++)if(this.skeletons[c].id===b)return this.skeletons[c];return null;},j.prototype.getSkeletonByName=function(b){y4tt.v9();for(var c=0;c<this.skeletons.length;c++)if(this.skeletons[c].name===b)return this.skeletons[c];return null;},j.prototype.isActiveMesh=function(b){y4tt.q9();return-1!==this._activeMeshes.indexOf(b);},j.prototype._evaluateSubMesh=function(b,c){var d;if(c.alwaysSelectAsActiveMesh||1===c.subMeshes.length||b.isInFrustum(this._frustumPlanes)){d=b.getMaterial();c.showSubMeshesBoundingBox&&this._boundingBoxRenderer.renderList.push(b.getBoundingInfo().boundingBox);d&&(d.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(d)&&(this._processedMaterials.push(d),this._renderTargets.concatWithNoDuplicate(d.getRenderTargetTextures())),this._activeIndices+=b.indexCount,this._renderingManager.dispatch(b));}},j.prototype._isInIntermediateRendering=function(){return this._intermediateRendering;},j.prototype._evaluateActiveMeshes=function(){var c,d,e,j;this.activeCamera._activeMeshes.reset();this._activeMeshes.reset();this._renderingManager.reset();this._processedMaterials.reset();this._activeParticleSystems.reset();this._activeSkeletons.reset();this._softwareSkinnedMeshes.reset();this._boundingBoxRenderer.reset();this._edgesRenderers.reset();this._frustumPlanes?b.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=b.Frustum.GetPlanes(this._transformMatrix);this._selectionOctree?(d=this._selectionOctree.select(this._frustumPlanes),c=d.data,d=d.length):(d=this.meshes.length,c=this.meshes);for(var f=0;d>f;f++){e=c[f];if(!e.isBlocked&&(this._totalVertices+=e.getTotalVertices(),e.isReady()&&e.isEnabled())){e.computeWorldMatrix();e.actionManager&&e.actionManager.hasSpecificTriggers([b.ActionManager.OnIntersectionEnterTrigger,b.ActionManager.OnIntersectionExitTrigger])&&this._meshesForIntersections.pushNoDuplicate(e);j=e.getLOD(this.activeCamera);j&&(e._preActivate(),(e.alwaysSelectAsActiveMesh||e.isVisible&&0<e.visibility&&0!==(e.layerMask&this.activeCamera.layerMask)&&e.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(e),this.activeCamera._activeMeshes.push(e),e._activate(this._renderId),this._activeMesh(j)));}}c=b.Tools.Now;if(this.particlesEnabled){b.Tools.StartPerformanceCounter("Particles",0<this.particleSystems.length);for(d=0;d<this.particleSystems.length;d++)f=this.particleSystems[d],f.isStarted()&&(!f.emitter.position||f.emitter&&f.emitter.isEnabled())&&(this._activeParticleSystems.push(f),f.animate());b.Tools.EndPerformanceCounter("Particles",0<this.particleSystems.length);}this._particlesDuration+=b.Tools.Now-c;},j.prototype._activeMesh=function(b){var c,d;y4tt.q9();if(b.skeleton&&this.skeletonsEnabled&&(this._activeSkeletons.pushNoDuplicate(b.skeleton)&&b.skeleton.prepare(),b.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(b)),(b.showBoundingBox||this.forceShowBoundingBoxes)&&this._boundingBoxRenderer.renderList.push(b.getBoundingInfo().boundingBox),b._edgesRenderer&&this._edgesRenderers.push(b._edgesRenderer),b&&b.subMeshes){b._submeshesOctree&&b.useOctreeForRenderingSelection?(d=b._submeshesOctree.select(this._frustumPlanes),c=d.length,d=d.data):(d=b.subMeshes,c=d.length);for(var f=0;c>f;f++)this._evaluateSubMesh(d[f],b);}},j.prototype.updateTransformMatrix=function(b){y4tt.v9();this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(b));},j.prototype._renderForCamera=function(c){var d,f,e,j;d=this._engine;if(this.activeCamera=c,!this.activeCamera)throw Error("Active camera not set");b.Tools.StartPerformanceCounter("Rendering camera "+this.activeCamera.name);d.setViewport(this.activeCamera.viewport);this.resetCachedMaterial();this._renderId++;this.updateTransformMatrix();this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera);f=b.Tools.Now;b.Tools.StartPerformanceCounter("Active meshes evaluation");this._evaluateActiveMeshes();this._evaluateActiveMeshesDuration+=b.Tools.Now-f;b.Tools.EndPerformanceCounter("Active meshes evaluation");y4tt.q9();for(f=0;f<this._softwareSkinnedMeshes.length;f++){e=this._softwareSkinnedMeshes.data[f];e.applySkeleton(e.skeleton);}f=b.Tools.Now;if(this.renderTargetsEnabled&&0<this._renderTargets.length){this._intermediateRendering=!0;b.Tools.StartPerformanceCounter("Render targets",0<this._renderTargets.length);for(e=0;e<this._renderTargets.length;e++){j=this._renderTargets.data[e];j._shouldRender()&&(this._renderId++,j.render(j.activeCamera&&j.activeCamera!==this.activeCamera,this.dumpNextRenderTargets));}b.Tools.EndPerformanceCounter("Render targets",0<this._renderTargets.length);this._intermediateRendering=!1;this._renderId++;d.restoreDefaultFramebuffer();}this._renderTargetsDuration+=b.Tools.Now-f;this.postProcessManager._prepareFrame();f=b.Tools.Now;if(this.layers.length){d.setDepthBuffer(!1);for(e=0;e<this.layers.length;e++)j=this.layers[e],j.isBackground&&j.render();d.setDepthBuffer(!0);}b.Tools.StartPerformanceCounter("Main render");this._renderingManager.render(null,null,!0,!0);b.Tools.EndPerformanceCounter("Main render");this._boundingBoxRenderer.render();for(e=0;e<this._edgesRenderers.length;e++)this._edgesRenderers.data[e].render();if(this.lensFlaresEnabled){b.Tools.StartPerformanceCounter("Lens flares",0<this.lensFlareSystems.length);for(e=0;e<this.lensFlareSystems.length;e++)j=this.lensFlareSystems[e],0!==(c.layerMask&j.layerMask)&&j.render();b.Tools.EndPerformanceCounter("Lens flares",0<this.lensFlareSystems.length);}if(this.layers.length){d.setDepthBuffer(!1);for(e=0;e<this.layers.length;e++)j=this.layers[e],j.isBackground||j.render();d.setDepthBuffer(!0);}this._renderDuration+=b.Tools.Now-f;this.postProcessManager._finalizeFrame(c.isIntermediate);this.activeCamera._updateFromScene();this._renderTargets.reset();this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera);b.Tools.EndPerformanceCounter("Rendering camera "+this.activeCamera.name);},j.prototype._processSubCameras=function(c){if(c.cameraRigMode===b.Camera.RIG_MODE_NONE)return void this._renderForCamera(c);for(var d=0;d<c._rigCameras.length;d++)this._renderForCamera(c._rigCameras[d]);this.activeCamera=c;this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix());this.activeCamera._updateFromScene();},j.prototype._checkIntersections=function(){var e,j,g,q;y4tt.v9();for(var c=0;c<this._meshesForIntersections.length;c++)for(var d=this._meshesForIntersections.data[c],f=0;f<d.actionManager.actions.length;f++){e=d.actionManager.actions[f];if(e.trigger===b.ActionManager.OnIntersectionEnterTrigger||e.trigger===b.ActionManager.OnIntersectionExitTrigger){j=e.getTriggerParameter(),g=j instanceof b.AbstractMesh?j:j.mesh,j=g.intersectsMesh(d,j.usePreciseIntersection),q=d._intersectionsInProgress.indexOf(g);j&&-1===q?e.trigger===b.ActionManager.OnIntersectionEnterTrigger?(e._executeCurrent(b.ActionEvent.CreateNew(d,null,g)),d._intersectionsInProgress.push(g)):e.trigger===b.ActionManager.OnIntersectionExitTrigger&&d._intersectionsInProgress.push(g):!j&&-1<q&&(e.trigger===b.ActionManager.OnIntersectionExitTrigger&&e._executeCurrent(b.ActionEvent.CreateNew(d,null,g)),d.actionManager.hasSpecificTrigger(b.ActionManager.OnIntersectionExitTrigger)&&e.trigger!==b.ActionManager.OnIntersectionExitTrigger||d._intersectionsInProgress.splice(q,1));}}},j.prototype.render=function(){var c,d,f,e,q;c=b.Tools.Now;this._activeBones=this._activeIndices=this._totalVertices=this._evaluateActiveMeshesDuration=this._renderTargetsDuration=this._renderDuration=this._activeParticles=this._spritesDuration=this._particlesDuration=0;this.getEngine().resetDrawCalls();this._meshesForIntersections.reset();this.resetCachedMaterial();b.Tools.StartPerformanceCounter("Scene rendering");this.actionManager&&this.actionManager.processTrigger(b.ActionManager.OnEveryFrameTrigger,null);this.simplificationQueue&&!this.simplificationQueue.running&&this.simplificationQueue.executeNext();d=Math.max(j.MinDeltaTime,Math.min(this._engine.getDeltaTime(),j.MaxDeltaTime));this._animationRatio=0.06*d;this._animate();this._physicsEngine&&(b.Tools.StartPerformanceCounter("Physics"),this._physicsEngine._step(d/1E3),b.Tools.EndPerformanceCounter("Physics"));this.onBeforeRenderObservable.notifyObservers(this);d=b.Tools.Now,f=this.getEngine(),e=this.activeCamera;if(this.renderTargetsEnabled){b.Tools.StartPerformanceCounter("Custom render targets",0<this.customRenderTargets.length);for(var g=0;g<this.customRenderTargets.length;g++){q=this.customRenderTargets[g];if(q._shouldRender()){if(this._renderId++,this.activeCamera=q.activeCamera||this.activeCamera,!this.activeCamera)throw Error("Active camera not set");f.setViewport(this.activeCamera.viewport);this.updateTransformMatrix();q.render(e!==this.activeCamera,this.dumpNextRenderTargets);}}b.Tools.EndPerformanceCounter("Custom render targets",0<this.customRenderTargets.length);this._renderId++;}if(0<this.customRenderTargets.length&&f.restoreDefaultFramebuffer(),this._renderTargetsDuration+=b.Tools.Now-d,this.activeCamera=e,this.proceduralTexturesEnabled){b.Tools.StartPerformanceCounter("Procedural textures",0<this._proceduralTextures.length);for(d=0;d<this._proceduralTextures.length;d++)f=this._proceduralTextures[d],f._shouldRender()&&f.render();b.Tools.EndPerformanceCounter("Procedural textures",0<this._proceduralTextures.length);}if(this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,!0),this.shadowsEnabled)for(d=0;d<this.lights.length;d++)f=this.lights[d],e=f.getShadowGenerator(),f.isEnabled()&&e&&-1!==e.getShadowMap().getScene().textures.indexOf(e.getShadowMap())&&this._renderTargets.push(e.getShadowMap());if(this._depthRenderer&&this._renderTargets.push(this._depthRenderer.getDepthMap()),this.postProcessRenderPipelineManager.update(),0<this.activeCameras.length){d=this._renderId;for(f=0;f<this.activeCameras.length;f++)this._renderId=d,0<f&&this._engine.clear(0,!1,!0),this._processSubCameras(this.activeCameras[f]);}else{if(!this.activeCamera)throw Error("No camera defined");this._processSubCameras(this.activeCamera);}this._checkIntersections();b.AudioEngine&&this._updateAudioParameters();this.afterRender&&this.afterRender();this.onAfterRenderObservable.notifyObservers(this);y4tt.q9();for(d=0;d<this._toBeDisposed.length;d++)this._toBeDisposed.data[d].dispose(),this._toBeDisposed[d]=null;this._toBeDisposed.reset();this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1);b.Tools.EndPerformanceCounter("Scene rendering");this._lastFrameDuration=b.Tools.Now-c;},j.prototype._updateAudioParameters=function(){var c,d;y4tt.q9();if(this.audioEnabled&&(0!==this.mainSoundTrack.soundCollection.length||1!==this.soundTracks.length)){d=b.Engine.audioEngine;if(c=0<this.activeCameras.length?this.activeCameras[0]:this.activeCamera,c&&d.canUseWebAudio){d.audioContext.listener.setPosition(c.position.x,c.position.y,c.position.z);c=b.Matrix.Invert(c.getViewMatrix());c=b.Vector3.TransformNormal(new b.Vector3(0,0,-1),c);c.normalize();d.audioContext.listener.setOrientation(c.x,c.y,c.z,0,1,0);for(d=0;d<this.mainSoundTrack.soundCollection.length;d++)c=this.mainSoundTrack.soundCollection[d],c.useCustomAttenuation&&c.updateDistanceFromListener();for(d=0;d<this.soundTracks.length;d++)for(var f=0;f<this.soundTracks[d].soundCollection.length;f++)c=this.soundTracks[d].soundCollection[f],c.useCustomAttenuation&&c.updateDistanceFromListener();}}},Object.defineProperty(j.prototype,"audioEnabled",{get:function(){return this._audioEnabled;},set:function(c){this._audioEnabled=c;b.AudioEngine&&(this._audioEnabled?this._enableAudio():this._disableAudio());},enumerable:!0,configurable:!0}),j.prototype._disableAudio=function(){var b;y4tt.q9();for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)this.mainSoundTrack.soundCollection[b].pause();for(b=0;b<this.soundTracks.length;b++)for(var c=0;c<this.soundTracks[b].soundCollection.length;c++)this.soundTracks[b].soundCollection[c].pause();},j.prototype._enableAudio=function(){var b;y4tt.q9();for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)this.mainSoundTrack.soundCollection[b].isPaused&&this.mainSoundTrack.soundCollection[b].play();for(b=0;b<this.soundTracks.length;b++)for(var c=0;c<this.soundTracks[b].soundCollection.length;c++)this.soundTracks[b].soundCollection[c].isPaused&&this.soundTracks[b].soundCollection[c].play();},Object.defineProperty(j.prototype,"headphone",{get:function(){return this._headphone;},set:function(c){this._headphone=c;b.AudioEngine&&(this._headphone?this._switchAudioModeForHeadphones():this._switchAudioModeForNormalSpeakers());},enumerable:!0,configurable:!0}),j.prototype._switchAudioModeForHeadphones=function(){this.mainSoundTrack.switchPanningModelToHRTF();y4tt.q9();for(var b=0;b<this.soundTracks.length;b++)this.soundTracks[b].switchPanningModelToHRTF();},j.prototype._switchAudioModeForNormalSpeakers=function(){this.mainSoundTrack.switchPanningModelToEqualPower();for(var b=0;b<this.soundTracks.length;b++)this.soundTracks[b].switchPanningModelToEqualPower();},j.prototype.enableDepthRenderer=function(){y4tt.q9();return this._depthRenderer?this._depthRenderer:(this._depthRenderer=new b.DepthRenderer(this),this._depthRenderer);},j.prototype.disableDepthRenderer=function(){y4tt.q9();this._depthRenderer&&(this._depthRenderer.dispose(),this._depthRenderer=null);},j.prototype.freezeMaterials=function(){y4tt.q9();for(var b=0;b<this.materials.length;b++)this.materials[b].freeze();},j.prototype.unfreezeMaterials=function(){y4tt.q9();for(var b=0;b<this.materials.length;b++)this.materials[b].unfreeze();},j.prototype.dispose=function(){var c,d;this.afterRender=this.beforeRender=null;this.skeletons=[];this._boundingBoxRenderer.dispose();this._depthRenderer&&this._depthRenderer.dispose();this._debugLayer&&this._debugLayer.hide();this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();this.onBeforeRenderObservable.clear();this.onAfterRenderObservable.clear();this.detachControl();b.AudioEngine&&this.disposeSounds();d=this._engine.getRenderingCanvas();y4tt.v9();for(c=0;c<this.cameras.length;c++)this.cameras[c].detachControl(d);for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.spriteManagers.length;)this.spriteManagers[0].dispose();for(;this.layers.length;)this.layers[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this.postProcessManager.dispose();this._physicsEngine&&this.disablePhysicsEngine();c=this._engine.scenes.indexOf(this);-1<c&&this._engine.scenes.splice(c,1);this._engine.wipeCaches();},j.prototype.disposeSounds=function(){this.mainSoundTrack.dispose();for(var b=0;b<this.soundTracks.length;b++)this.soundTracks[b].dispose();},j.prototype.getWorldExtends=function(){var e,j;for(var c=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),d=new b.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),f=0;f<this.meshes.length;f++){e=this.meshes[f];e.computeWorldMatrix(!0);j=e.getBoundingInfo().boundingBox.minimumWorld,e=e.getBoundingInfo().boundingBox.maximumWorld;b.Tools.CheckExtends(j,c,d);b.Tools.CheckExtends(e,c,d);}y4tt.q9();return{min:c,max:d};},j.prototype.createOrUpdateSelectionOctree=function(c,d){var f;void 0===c&&(c=64);void 0===d&&(d=2);this._selectionOctree||(this._selectionOctree=new b.Octree(b.Octree.CreationFuncForMeshes,c,d));f=this.getWorldExtends();return this._selectionOctree.update(f.min,f.max,this.meshes),this._selectionOctree;},j.prototype.createPickingRay=function(c,d,f,e,j){var g;void 0===j&&(j=!1);g=this._engine;if(!e){if(!this.activeCamera)throw Error("Active camera not set");e=this.activeCamera;}y4tt.v9();g=e.viewport.toGlobal(g.getRenderWidth(),g.getRenderHeight());return c=c/this._engine.getHardwareScalingLevel()-g.x,d=d/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-g.y-g.height),b.Ray.CreateNew(c,d,g.width,g.height,f?f:b.Matrix.Identity(),j?b.Matrix.Identity():e.getViewMatrix(),e.getProjectionMatrix());},j.prototype.createPickingRayInCameraSpace=function(c,d,f){var e,j;y4tt.v9();e=this._engine;if(!f){if(!this.activeCamera)throw Error("Active camera not set");f=this.activeCamera;}e=f.viewport.toGlobal(e.getRenderWidth(),e.getRenderHeight()),j=b.Matrix.Identity();return c=c/this._engine.getHardwareScalingLevel()-e.x,d=d/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-e.y-e.height),b.Ray.CreateNew(c,d,e.width,e.height,j,j,f.getProjectionMatrix());},j.prototype._internalPick=function(c,d,f){var g,q;for(var e=null,j=0;j<this.meshes.length;j++){g=this.meshes[j];if(d){if(!d(g))continue;}else if(!g.isEnabled()||!g.isVisible||!g.isPickable)continue;q=g.getWorldMatrix(),q=c(q);if((g=g.intersects(q,f))&&g.hit&&(f||null==e||!(g.distance>=e.distance))&&(e=g,f))break;}return e||new b.PickingInfo();},j.prototype._internalPickSprites=function(c,d,f,e){var j,q;j=null;if(e=e||this.activeCamera,0<this.spriteManagers.length)for(var g=0;g<this.spriteManagers.length;g++){q=this.spriteManagers[g];if(q.isPickable&&(q=q.intersects(c,e,d,f))&&q.hit&&(f||null==j||!(q.distance>=j.distance))&&(j=q,f))break;}return j||new b.PickingInfo();},j.prototype.pick=function(b,c,d,f,e){var j;j=this;return this._internalPick(function(d){y4tt.q9();return j.createPickingRay(b,c,d,e);},d,f);},j.prototype.pickSprite=function(b,c,d,f,e){return this._internalPickSprites(this.createPickingRayInCameraSpace(b,c,e),d,f,e);},j.prototype.pickWithRay=function(c,d,f){var e;y4tt.v9();e=this;return this._internalPick(function(d){y4tt.q9();return e._pickWithRayInverseMatrix||(e._pickWithRayInverseMatrix=b.Matrix.Identity()),d.invertToRef(e._pickWithRayInverseMatrix),b.Ray.Transform(c,e._pickWithRayInverseMatrix);},d,f);},j.prototype.setPointerOverMesh=function(c){y4tt.v9();this._pointerOverMesh!==c&&(this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(b.ActionManager.OnPointerOutTrigger,b.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=c,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(b.ActionManager.OnPointerOverTrigger,b.ActionEvent.CreateNew(this._pointerOverMesh)));},j.prototype.getPointerOverMesh=function(){return this._pointerOverMesh;},j.prototype.setPointerOverSprite=function(c){y4tt.q9();this._pointerOverSprite!==c&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(b.ActionManager.OnPointerOutTrigger,b.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=c,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(b.ActionManager.OnPointerOverTrigger,b.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)));},j.prototype.getPointerOverSprite=function(){y4tt.q9();return this._pointerOverSprite;},j.prototype.getPhysicsEngine=function(){return this._physicsEngine;},j.prototype.enablePhysics=function(c,d){y4tt.v9();if(this._physicsEngine)return!0;try{return this._physicsEngine=new b.PhysicsEngine(c,d),!0;}catch(f){return b.Tools.Error(f.message),!1;}},j.prototype.disablePhysicsEngine=function(){y4tt.q9();this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=void 0);},j.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine;},j.prototype.setGravity=function(c){b.Tools.Warn("Deprecated, please use 'scene.getPhysicsEngine().setGravity()'");this._physicsEngine&&this._physicsEngine.setGravity(c);},j.prototype.createCompoundImpostor=function(c,d){var f,j;b.Tools.Warn("Scene.createCompoundImpostor is deprecated. Please use PhysicsImpostor parent/child");c.parts&&(d=c,c=c.parts);f=c[0].mesh;f.physicsImpostor=new b.PhysicsImpostor(f,c[0].impostor,d,this);for(var e=1;e<c.length;e++){j=c[e].mesh;j.parent!==f&&(j.position=j.position.subtract(f.position),j.parent=f);j.physicsImpostor=new b.PhysicsImpostor(j,c[e].impostor,d,this);}f.physicsImpostor.forceUpdate();},j.prototype.deleteCompoundImpostor=function(b){b=b.parts[0].mesh;b.physicsImpostor.dispose();b.physicsImpostor=null;},j.prototype.createDefaultCameraOrLight=function(){var c,d,f;y4tt.v9();if(0===this.lights.length&&new b.HemisphericLight("default light",b.Vector3.Up(),this),!this.activeCamera){c=new b.FreeCamera("default camera",b.Vector3.Zero(),this),d=this.getWorldExtends(),f=d.min.add(d.max.subtract(d.min).scale(0.5));c.position=new b.Vector3(f.x,f.y,d.min.z-(d.max.z-d.min.z));c.setTarget(f);this.activeCamera=c;}},j.prototype._getByTags=function(c,d,f){var e,g;if(void 0===d)return c;e=[];f=f||function(){};for(var j in c){g=c[j];b.Tags.MatchesQuery(g,d)&&(e.push(g),f(g));}return e;},j.prototype.getMeshesByTags=function(b,c){return this._getByTags(this.meshes,b,c);},j.prototype.getCamerasByTags=function(b,c){return this._getByTags(this.cameras,b,c);},j.prototype.getLightsByTags=function(b,c){return this._getByTags(this.lights,b,c);},j.prototype.getMaterialByTags=function(b,c){y4tt.v9();return this._getByTags(this.materials,b,c).concat(this._getByTags(this.multiMaterials,b,c));},j._FOGMODE_NONE=0,j._FOGMODE_EXP=1,j._FOGMODE_EXP2=2,j._FOGMODE_LINEAR=3,j.MinDeltaTime=1,j.MaxDeltaTime=1E3,j);b.Scene=f;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(e,c,d,f,g,j){e instanceof b.Mesh?this._engine=e.getScene().getEngine():this._engine=e;y4tt.v9();this._updatable=d;this._data=c;this._strideSize=f;g||this.create();this._instanced=j;};g=(g.prototype.createVertexBuffer=function(e,c,d,f){return new b.VertexBuffer(this._engine,this,e,this._updatable,!0,f?f:this._strideSize,this._instanced,c,d);},g.prototype.isUpdatable=function(){return this._updatable;},g.prototype.getData=function(){y4tt.q9();return this._data;},g.prototype.getBuffer=function(){return this._buffer;},g.prototype.getStrideSize=function(){return this._strideSize;},g.prototype.getIsInstanced=function(){return this._instanced;},g.prototype.create=function(b){!b&&this._buffer||(b=b||this._data,this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,b),this._data=b):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(b),this._data=b):this._buffer=this._engine.createVertexBuffer(b));},g.prototype.update=function(b){this.create(b);},g.prototype.updateDirectly=function(b,c,d){y4tt.v9();this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,b,c,d?d*this.getStrideSize():void 0),this._data=null);},g.prototype.dispose=function(){y4tt.v9();this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null);},g);b.Buffer=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(c,d,f,g,j,l,n,m,p){if(!l)switch(f){case e.PositionKind:l=3;break;case e.NormalKind:l=3;break;case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:l=2;break;case e.ColorKind:l=4;break;case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:l=4;break;case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:l=4;}d instanceof b.Buffer?(l||(l=d.getStrideSize()),this._buffer=d,this._ownsBuffer=!1):(this._buffer=new b.Buffer(c,d,g,l,j,n),this._ownsBuffer=!0);this._stride=l;this._offset=m?m:0;this._size=p?p:l;this._kind=f;};y4tt.q9();g=(e.prototype.getKind=function(){return this._kind;},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable();},e.prototype.getData=function(){y4tt.v9();return this._buffer.getData();},e.prototype.getBuffer=function(){y4tt.v9();return this._buffer.getBuffer();},e.prototype.getStrideSize=function(){y4tt.v9();return this._stride;},e.prototype.getOffset=function(){y4tt.v9();return this._offset;},e.prototype.getSize=function(){y4tt.q9();return this._size;},e.prototype.getIsInstanced=function(){return this._buffer.getIsInstanced();},e.prototype.create=function(b){return this._buffer.create(b);},e.prototype.update=function(b){return this._buffer.update(b);},e.prototype.updateDirectly=function(b,d){return this._buffer.updateDirectly(b,d);},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose();},Object.defineProperty(e,"PositionKind",{get:function(){return e._PositionKind;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"NormalKind",{get:function(){return e._NormalKind;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UVKind",{get:function(){y4tt.q9();return e._UVKind;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV2Kind",{get:function(){y4tt.q9();return e._UV2Kind;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV3Kind",{get:function(){return e._UV3Kind;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV4Kind",{get:function(){return e._UV4Kind;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV5Kind",{get:function(){y4tt.v9();return e._UV5Kind;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV6Kind",{get:function(){return e._UV6Kind;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ColorKind",{get:function(){return e._ColorKind;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MatricesIndicesKind",{get:function(){y4tt.q9();return e._MatricesIndicesKind;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MatricesWeightsKind",{get:function(){return e._MatricesWeightsKind;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MatricesIndicesExtraKind",{get:function(){return e._MatricesIndicesExtraKind;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MatricesWeightsExtraKind",{get:function(){y4tt.q9();return e._MatricesWeightsExtraKind;},enumerable:!0,configurable:!0}),e._PositionKind="position",e._NormalKind="normal",e._UVKind="uv",e._UV2Kind="uv2",e._UV3Kind="uv3",e._UV4Kind="uv4",e._UV5Kind="uv5",e._UV6Kind="uv6",e._ColorKind="color",e._MatricesIndicesKind="matricesIndices",e._MatricesWeightsKind="matricesWeights",e._MatricesIndicesExtraKind="matricesIndicesExtra",e._MatricesWeightsExtraKind="matricesWeightsExtra",e);b.VertexBuffer=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.AbstractMesh;y4tt.v9();g=function(b,d){e.call(this,b,d.getScene());d.instances.push(this);this._sourceMesh=d;this.position.copyFrom(d.position);this.rotation.copyFrom(d.rotation);this.scaling.copyFrom(d.scaling);d.rotationQuaternion&&(this.rotationQuaternion=d.rotationQuaternion.clone());this.infiniteDistance=d.infiniteDistance;this.setPivotMatrix(d.getPivotMatrix());this.refreshBoundingInfo();this._syncSubMeshes();};g=(__extends(g,e),Object.defineProperty(g.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"material",{get:function(){return this._sourceMesh.material;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"visibility",{get:function(){return this._sourceMesh.visibility;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"renderingGroupId",{get:function(){y4tt.v9();return this._sourceMesh.renderingGroupId;},enumerable:!0,configurable:!0}),g.prototype.getTotalVertices=function(){y4tt.q9();return this._sourceMesh.getTotalVertices();},Object.defineProperty(g.prototype,"sourceMesh",{get:function(){y4tt.v9();return this._sourceMesh;},enumerable:!0,configurable:!0}),g.prototype.getVerticesData=function(b,d){y4tt.v9();return this._sourceMesh.getVerticesData(b,d);},g.prototype.isVerticesDataPresent=function(b){return this._sourceMesh.isVerticesDataPresent(b);},g.prototype.getIndices=function(){y4tt.v9();return this._sourceMesh.getIndices();},Object.defineProperty(g.prototype,"_positions",{get:function(){return this._sourceMesh._positions;},enumerable:!0,configurable:!0}),g.prototype.refreshBoundingInfo=function(){var c;c=this._sourceMesh.getBoundingInfo();this._boundingInfo=new b.BoundingInfo(c.minimum.clone(),c.maximum.clone());this._updateBoundingInfo();},g.prototype._preActivate=function(){y4tt.v9();this._currentLOD&&this._currentLOD._preActivate();},g.prototype._activate=function(b){this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,b);},g.prototype.getLOD=function(){return this._currentLOD=this.sourceMesh.getLOD(this.getScene().activeCamera,this.getBoundingInfo().boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD;},g.prototype._syncSubMeshes=function(){y4tt.v9();if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var b=0;b<this._sourceMesh.subMeshes.length;b++)this._sourceMesh.subMeshes[b].clone(this,this._sourceMesh);},g.prototype._generatePointsArray=function(){y4tt.v9();return this._sourceMesh._generatePointsArray();},g.prototype.clone=function(c,d,f){c=this._sourceMesh.createInstance(c);if(b.Tools.DeepCopy(this,c,["name","subMeshes"],[]),this.refreshBoundingInfo(),d&&(c.parent=d),!f)for(d=0;d<this.getScene().meshes.length;d++)f=this.getScene().meshes[d],f.parent===this&&f.clone(f.name,c);return c.computeWorldMatrix(!0),c;},g.prototype.dispose=function(b){var d;d=this._sourceMesh.instances.indexOf(this);this._sourceMesh.instances.splice(d,1);e.prototype.dispose.call(this,b);},g);b.InstancedMesh=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d;g=function(){this.mustReturn=!1;this.visibleInstances=[];this.renderSelf=[];};y4tt.v9();b._InstancesBatch=g;c=b.AbstractMesh,d=function(f,e,j,l,n,m){var p,r;y4tt.q9();if(void 0===j&&(j=null),void 0===m&&(m=!0),c.call(this,f,e),this.onBeforeRenderObservable=new b.Observable(),this.onAfterRenderObservable=new b.Observable(),this.onBeforeDrawObservable=new b.Observable(),this.delayLoadState=b.Engine.DELAYLOADSTATE_NONE,this.instances=[],this._LODLevels=[],this._visibleInstances={},this._renderIdForInstances=[],this._batchCache=new g(),this._instancesBufferSize=2048,this._sideOrientation=d._DEFAULTSIDE,this._areNormalsFrozen=!1,l){l._geometry&&l._geometry.applyToMesh(this);b.Tools.DeepCopy(l,this,["name","material","skeleton","instances"],["_poseMatrix"]);this.setPivotMatrix(l.getPivotMatrix());this.id=f+"."+l.id;this.material=l.material;if(!n)for(p=0;p<e.meshes.length;p++){r=e.meshes[p];r.parent===l&&r.clone(f+"."+r.name,this,n);}p=this.getScene().getPhysicsEngine();m&&p&&(m=p.getImpostorForPhysicsObject(l))&&(this.physicsImpostor=m.clone(this));for(p=0;p<e.particleSystems.length;p++)m=e.particleSystems[p],m.emitter===l&&m.clone(m.name,this);this.computeWorldMatrix(!0);}null!==j&&(this.parent=j);};e=(__extends(d,c),Object.defineProperty(d,"FRONTSIDE",{get:function(){y4tt.v9();return d._FRONTSIDE;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"BACKSIDE",{get:function(){y4tt.q9();return d._BACKSIDE;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"DOUBLESIDE",{get:function(){return d._DOUBLESIDE;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"DEFAULTSIDE",{get:function(){return d._DEFAULTSIDE;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"NO_CAP",{get:function(){y4tt.q9();return d._NO_CAP;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"CAP_START",{get:function(){y4tt.q9();return d._CAP_START;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"CAP_END",{get:function(){y4tt.v9();return d._CAP_END;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"CAP_ALL",{get:function(){y4tt.q9();return d._CAP_ALL;},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"onBeforeDraw",{set:function(b){y4tt.v9();this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver);this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(b);},enumerable:!0,configurable:!0}),d.prototype.toString=function(d){var e;e=c.prototype.toString.call(this,d);if(e+=", n vertices: "+this.getTotalVertices(),e+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var j=0;j<this.animations.length;j++)e+=", animation[0]: "+this.animations[j].toString(d);return d&&(e+=", flat shading: "+(this._geometry?this.getVerticesData(b.VertexBuffer.PositionKind).length/3===this.getIndices().length?"YES":"NO":"UNKNOWN")),e;},Object.defineProperty(d.prototype,"hasLODLevels",{get:function(){return 0<this._LODLevels.length;},enumerable:!0,configurable:!0}),d.prototype._sortLODLevels=function(){this._LODLevels.sort(function(b,c){return b.distance<c.distance?1:b.distance>c.distance?-1:0;});},d.prototype.addLODLevel=function(c,d){var e;if(d&&d._masterMesh)return b.Tools.Warn("You cannot use a mesh as LOD level twice"),this;e=new b.Internals.MeshLODLevel(c,d);return this._LODLevels.push(e),d&&(d._masterMesh=this),this._sortLODLevels(),this;},d.prototype.getLODLevelAtDistance=function(b){var d;for(var c=0;c<this._LODLevels.length;c++){d=this._LODLevels[c];if(d.distance===b)return d.mesh;}y4tt.q9();return null;},d.prototype.removeLODLevel=function(b){y4tt.v9();for(var c=0;c<this._LODLevels.length;c++)this._LODLevels[c].mesh===b&&(this._LODLevels.splice(c,1),b&&(b._masterMesh=null));return this._sortLODLevels(),this;},d.prototype.getLOD=function(b,c){var d,e;if(!this._LODLevels||0===this._LODLevels.length)return this;d=(c?c:this.getBoundingInfo().boundingSphere).centerWorld.subtract(b.globalPosition).length();if(this._LODLevels[this._LODLevels.length-1].distance>d)return this.onLODLevelSelection&&this.onLODLevelSelection(d,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var l=0;l<this._LODLevels.length;l++){e=this._LODLevels[l];if(e.distance<d)return e.mesh&&(e.mesh._preActivate(),e.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(d,this,e.mesh),e.mesh;}return this.onLODLevelSelection&&this.onLODLevelSelection(d,this,this),this;},Object.defineProperty(d.prototype,"geometry",{get:function(){y4tt.q9();return this._geometry;},enumerable:!0,configurable:!0}),d.prototype.getTotalVertices=function(){return this._geometry?this._geometry.getTotalVertices():0;},d.prototype.getVerticesData=function(b,c){y4tt.q9();return this._geometry?this._geometry.getVerticesData(b,c):null;},d.prototype.getVertexBuffer=function(b){return this._geometry?this._geometry.getVertexBuffer(b):void 0;},d.prototype.isVerticesDataPresent=function(b){return this._geometry?this._geometry.isVerticesDataPresent(b):this._delayInfo?-1!==this._delayInfo.indexOf(b):!1;},d.prototype.getVerticesDataKinds=function(){var b;if(!this._geometry){b=[];if(this._delayInfo)for(var c in this._delayInfo)b.push(c);return b;}return this._geometry.getVerticesDataKinds();},d.prototype.getTotalIndices=function(){y4tt.v9();return this._geometry?this._geometry.getTotalIndices():0;},d.prototype.getIndices=function(b){y4tt.v9();return this._geometry?this._geometry.getIndices(b):[];},Object.defineProperty(d.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh;},enumerable:!0,configurable:!0}),d.prototype.isReady=function(){y4tt.v9();return this.delayLoadState===b.Engine.DELAYLOADSTATE_LOADING?!1:c.prototype.isReady.call(this);},d.prototype.isDisposed=function(){return this._isDisposed;},Object.defineProperty(d.prototype,"sideOrientation",{get:function(){y4tt.q9();return this._sideOrientation;},set:function(b){this._sideOrientation=b;},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"areNormalsFrozen",{get:function(){return this._areNormalsFrozen;},enumerable:!0,configurable:!0}),d.prototype.freezeNormals=function(){y4tt.q9();this._areNormalsFrozen=!0;},d.prototype.unfreezeNormals=function(){y4tt.v9();this._areNormalsFrozen=!1;},Object.defineProperty(d.prototype,"overridenInstanceCount",{set:function(b){y4tt.q9();this._overridenInstanceCount=b;},enumerable:!0,configurable:!0}),d.prototype._preActivate=function(){var b;y4tt.q9();b=this.getScene().getRenderId();this._preActivateId!==b&&(this._preActivateId=b,this._visibleInstances=null);},d.prototype._preActivateForIntermediateRendering=function(b){y4tt.q9();this._visibleInstances&&(this._visibleInstances.intermediateDefaultRenderId=b);},d.prototype._registerInstanceForRenderId=function(b,c){this._visibleInstances||(this._visibleInstances={},this._visibleInstances.defaultRenderId=c,this._visibleInstances.selfDefaultRenderId=this._renderId);this._visibleInstances[c]||(this._visibleInstances[c]=[]);y4tt.v9();this._visibleInstances[c].push(b);},d.prototype.refreshBoundingInfo=function(){var c;y4tt.v9();if(!this._boundingInfo.isLocked){c=this.getVerticesData(b.VertexBuffer.PositionKind);c&&(c=b.Tools.ExtractMinAndMax(c,0,this.getTotalVertices()),this._boundingInfo=new b.BoundingInfo(c.minimum,c.maximum));if(this.subMeshes)for(c=0;c<this.subMeshes.length;c++)this.subMeshes[c].refreshBoundingInfo();this._updateBoundingInfo();}},d.prototype._createGlobalSubMesh=function(){var c;c=this.getTotalVertices();return c&&this.getIndices()?(this.releaseSubMeshes(),new b.SubMesh(0,0,c,0,this.getTotalIndices(),this)):null;},d.prototype.subdivide=function(c){if(!(1>c)){for(var d=this.getTotalIndices(),e=d/c|0,l=0;0!==e%3;)e++;this.releaseSubMeshes();for(var g=0;c>g&&!(l>=d);g++)b.SubMesh.CreateFromIndices(0,l,Math.min(e,d-l),this),l+=e;this.synchronizeInstances();}},d.prototype.setVerticesData=function(c,d,e,l){y4tt.q9();this._geometry?this._geometry.setVerticesData(c,d,e,l):(l=new b.VertexData(),l.set(d,c),c=this.getScene(),new b.Geometry(b.Geometry.RandomId(),c,l,e,this));},d.prototype.setVerticesBuffer=function(c){var d;if(!this._geometry){d=this.getScene();new b.Geometry(b.Geometry.RandomId(),d).applyToMesh(this);}y4tt.v9();this._geometry.setVerticesBuffer(c);},d.prototype.updateVerticesData=function(b,c,d,l){this._geometry&&(l?(this.makeGeometryUnique(),this.updateVerticesData(b,c,d,!1)):this._geometry.updateVerticesData(b,c,d));},d.prototype.updateVerticesDataDirectly=function(c,d,e,l){b.Tools.Warn("Mesh.updateVerticesDataDirectly deprecated since 2.3.");this._geometry&&(l?(this.makeGeometryUnique(),this.updateVerticesDataDirectly(c,d,e,!1)):this._geometry.updateVerticesDataDirectly(c,d,e));},d.prototype.updateMeshPositions=function(c,d){var e,l,g;void 0===d&&(d=!0);e=this.getVerticesData(b.VertexBuffer.PositionKind);if(c(e),this.updateVerticesData(b.VertexBuffer.PositionKind,e,!1,!1),d){l=this.getIndices(),g=this.getVerticesData(b.VertexBuffer.NormalKind);b.VertexData.ComputeNormals(e,l,g);this.updateVerticesData(b.VertexBuffer.NormalKind,g,!1,!1);}},d.prototype.makeGeometryUnique=function(){y4tt.v9();this._geometry&&this._geometry.copy(b.Geometry.RandomId()).applyToMesh(this);},d.prototype.setIndices=function(c,d){var e,l;if(this._geometry)this._geometry.setIndices(c,d);else{e=new b.VertexData();e.indices=c;l=this.getScene();new b.Geometry(b.Geometry.RandomId(),l,e,!1,this);}},d.prototype.toLeftHanded=function(){y4tt.q9();this._geometry&&this._geometry.toLeftHanded();},d.prototype._bind=function(c,d,e){var l;l=this.getScene().getEngine();if(this._unIndexed)c=null;else switch(e){case b.Material.PointFillMode:c=null;break;case b.Material.WireFrameFillMode:c=c.getLinesIndexBuffer(this.getIndices(),l);break;default:case b.Material.TriangleFillMode:c=this._unIndexed?null:this._geometry.getIndexBuffer();}y4tt.v9();l.bindBuffers(this._geometry.getVertexBuffers(),c,d);},d.prototype._draw=function(c,d,e){var l;if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){this.onBeforeDrawObservable.notifyObservers(this);l=this.getScene().getEngine();switch(d){case b.Material.PointFillMode:l.drawPointClouds(c.verticesStart,c.verticesCount,e);break;case b.Material.WireFrameFillMode:this._unIndexed?l.drawUnIndexed(!1,c.verticesStart,c.verticesCount,e):l.draw(!1,0,0<e?c.linesIndexCount/2:c.linesIndexCount,e);break;default:this._unIndexed?l.drawUnIndexed(!0,c.verticesStart,c.verticesCount,e):l.draw(!0,c.indexStart,c.indexCount,e);}}},d.prototype.registerBeforeRender=function(b){this.onBeforeRenderObservable.add(b);},d.prototype.unregisterBeforeRender=function(b){y4tt.q9();this.onBeforeRenderObservable.removeCallback(b);},d.prototype.registerAfterRender=function(b){y4tt.q9();this.onAfterRenderObservable.add(b);},d.prototype.unregisterAfterRender=function(b){y4tt.v9();this.onAfterRenderObservable.removeCallback(b);},d.prototype._getInstancesRenderList=function(b){var c,d,l;y4tt.q9();c=this.getScene();if(this._batchCache.mustReturn=!1,this._batchCache.renderSelf[b]=this.isEnabled()&&this.isVisible,this._batchCache.visibleInstances[b]=null,this._visibleInstances){d=c.getRenderId(),c=c._isInIntermediateRendering()?this._visibleInstances.intermediateDefaultRenderId:this._visibleInstances.defaultRenderId;this._batchCache.visibleInstances[b]=this._visibleInstances[d];l=this._renderId;if(!this._batchCache.visibleInstances[b]&&c&&(this._batchCache.visibleInstances[b]=this._visibleInstances[c],d=Math.max(c,d),l=Math.max(this._visibleInstances.selfDefaultRenderId,d)),this._batchCache.visibleInstances[b]&&this._batchCache.visibleInstances[b].length){if(this._renderIdForInstances[b]===d)return this._batchCache.mustReturn=!0,this._batchCache;d!==l&&(this._batchCache.renderSelf[b]=!1);}this._renderIdForInstances[b]=d;}return this._batchCache;},d.prototype._renderWithInstances=function(c,d,e,l,g){var t,v;for(var m=e.visibleInstances[c._id],p=64*(m.length+1),r=this._instancesBufferSize,s=this._instancesBuffer;this._instancesBufferSize<p;)this._instancesBufferSize*=2;this._instancesData&&r==this._instancesBufferSize||(this._instancesData=new Float32Array(this._instancesBufferSize/4));t=p=0,v=this.getWorldMatrix();if(e.renderSelf[c._id]&&(v.copyToArray(this._instancesData,p),p+=16,t++),m)for(e=0;e<m.length;e++)m[e].getWorldMatrix().copyToArray(this._instancesData,p),p+=16,t++;s&&r==this._instancesBufferSize?s.updateDirectly(this._instancesData,0,t):(s&&s.dispose(),s=new b.Buffer(g,this._instancesData,!0,16,!1,!0),this._instancesBuffer=s,this.setVerticesBuffer(s.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(s.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(s.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(s.createVertexBuffer("world3",12,4)));g.bindBuffers(this.geometry.getVertexBuffers(),this.geometry.getIndexBuffer(),l);this._draw(c,d,t);g.unbindInstanceAttributes();},d.prototype._processRendering=function(b,c,d,l,e,g){var p;y4tt.q9();p=this.getScene().getEngine();if(e)this._renderWithInstances(b,d,l,c,p);else if(l.renderSelf[b._id]&&(g&&g(!1,this.getWorldMatrix()),this._draw(b,d,this._overridenInstanceCount)),l.visibleInstances[b._id])for(c=0;c<l.visibleInstances[b._id].length;c++)e=l.visibleInstances[b._id][c].getWorldMatrix(),g&&g(!0,e),this._draw(b,d);},d.prototype.render=function(c,d){var e,l,g,m,p,r,s,t,v;y4tt.q9();e=this.getScene(),l=this._getInstancesRenderList(c._id);if(!l.mustReturn&&this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){this.onBeforeRenderObservable.notifyObservers(this);g=e.getEngine(),m=null!==g.getCaps().instancedArrays&&null!==l.visibleInstances[c._id]&&void 0!==l.visibleInstances[c._id],p=c.getMaterial();if(p&&p.isReady(this,m)){r=g.getDepthWrite();this.renderOutline&&(g.setDepthWrite(!1),e.getOutlineRenderer().render(c,l),g.setDepthWrite(r));p._preBind();s=p.getEffect(),t=e.forcePointsCloud?b.Material.PointFillMode:e.forceWireframe?b.Material.WireFrameFillMode:p.fillMode;this._bind(c,s,t);v=this.getWorldMatrix();if(p.bind(v,this),d&&g.setAlphaMode(p.alphaMode),this._processRendering(c,s,t,l,m,function(b,c){b&&p.bindOnlyWorldMatrix(c);}),p.unbind(),this.renderOutline&&r&&(g.setDepthWrite(!0),g.setColorWrite(!1),e.getOutlineRenderer().render(c,l),g.setColorWrite(!0)),this.renderOverlay)m=g.getAlphaMode(),g.setAlphaMode(b.Engine.ALPHA_COMBINE),e.getOutlineRenderer().render(c,l,!0),g.setAlphaMode(m);this.onAfterRenderObservable.notifyObservers(this);}}},d.prototype.getEmittedParticleSystems=function(){var d;for(var b=[],c=0;c<this.getScene().particleSystems.length;c++){d=this.getScene().particleSystems[c];d.emitter===this&&b.push(d);}return b;},d.prototype.getHierarchyEmittedParticleSystems=function(){var b,c,l;b=[],c=this.getDescendants();c.push(this);for(var d=0;d<this.getScene().particleSystems.length;d++){l=this.getScene().particleSystems[d];-1!==c.indexOf(l.emitter)&&b.push(l);}return b;},d.prototype._checkDelayState=function(){var c,d,e;c=this,d=this.getScene();if(this._geometry)this._geometry.load(d);else if(this.delayLoadState===b.Engine.DELAYLOADSTATE_NOTLOADED){this.delayLoadState=b.Engine.DELAYLOADSTATE_LOADING;d._addPendingData(this);e=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");b.Tools.LoadFile(this.delayLoadingFile,function(l){l instanceof ArrayBuffer?c._delayLoadingFunction(l,c):c._delayLoadingFunction(JSON.parse(l),c);c.delayLoadState=b.Engine.DELAYLOADSTATE_LOADED;y4tt.q9();d._removePendingData(c);},function(){},d.database,e);}},d.prototype.isInFrustum=function(d){return this.delayLoadState===b.Engine.DELAYLOADSTATE_LOADING?!1:c.prototype.isInFrustum.call(this,d)?(this._checkDelayState(),!0):!1;},d.prototype.setMaterialByID=function(b){var c,d;y4tt.v9();d=this.getScene().materials;for(c=0;c<d.length;c++)if(d[c].id===b)return void(this.material=d[c]);d=this.getScene().multiMaterials;for(c=0;c<d.length;c++)if(d[c].id===b)return void(this.material=d[c]);},d.prototype.getAnimatables=function(){var b;b=[];y4tt.v9();return this.material&&b.push(this.material),this.skeleton&&b.push(this.skeleton),b;},d.prototype.bakeTransformIntoVertices=function(c){var d,e,l,g;if(this.isVerticesDataPresent(b.VertexBuffer.PositionKind)){d=this.subMeshes.splice(0);this._resetPointsArrayCache();l=this.getVerticesData(b.VertexBuffer.PositionKind),g=[];for(e=0;e<l.length;e+=3)b.Vector3.TransformCoordinates(b.Vector3.FromArray(l,e),c).toArray(g,e);if(this.setVerticesData(b.VertexBuffer.PositionKind,g,this.getVertexBuffer(b.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(b.VertexBuffer.NormalKind)){l=this.getVerticesData(b.VertexBuffer.NormalKind);g=[];for(e=0;e<l.length;e+=3)b.Vector3.TransformNormal(b.Vector3.FromArray(l,e),c).normalize().toArray(g,e);this.setVerticesData(b.VertexBuffer.NormalKind,g,this.getVertexBuffer(b.VertexBuffer.NormalKind).isUpdatable());0>c.m[0]*c.m[5]*c.m[10]&&this.flipFaces();this.releaseSubMeshes();this.subMeshes=d;}}},d.prototype.bakeCurrentTransformIntoVertices=function(){y4tt.v9();this.bakeTransformIntoVertices(this.computeWorldMatrix(!0));this.scaling.copyFromFloats(1,1,1);this.position.copyFromFloats(0,0,0);this.rotation.copyFromFloats(0,0,0);this.rotationQuaternion&&(this.rotationQuaternion=b.Quaternion.Identity());this._worldMatrix=b.Matrix.Identity();},d.prototype._resetPointsArrayCache=function(){y4tt.q9();this._positions=null;},d.prototype._generatePointsArray=function(){var c;if(this._positions)return!0;this._positions=[];y4tt.q9();c=this.getVerticesData(b.VertexBuffer.PositionKind);if(!c)return!1;for(var d=0;d<c.length;d+=3)this._positions.push(b.Vector3.FromArray(c,d));return!0;},d.prototype.clone=function(b,c,e,l){y4tt.q9();return void 0===l&&(l=!0),new d(b,this.getScene(),c,this,e,l);},d.prototype.dispose=function(b){y4tt.v9();this._geometry&&this._geometry.releaseForMesh(this,!0);for(this._instancesBuffer&&(this._instancesBuffer.dispose(),this._instancesBuffer=null);this.instances.length;)this.instances[0].dispose();c.prototype.dispose.call(this,b);},d.prototype.applyDisplacementMap=function(c,d,e,l){var g,m;y4tt.q9();g=this,m=this.getScene();b.Tools.LoadImage(c,function(b){var c,f,m,v;y4tt.q9();c=document.createElement("canvas"),f=c.getContext("2d"),m=b.width,v=b.height;c.width=m;c.height=v;f.drawImage(b,0,0);b=f.getImageData(0,0,m,v).data;g.applyDisplacementMapFromBuffer(b,m,v,d,e);l&&l(g);},function(){},m.database);},d.prototype.applyDisplacementMapFromBuffer=function(c,d,e,l,g){var x,z;if(!this.isVerticesDataPresent(b.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(b.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(b.VertexBuffer.UVKind))return void b.Tools.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing");for(var m=this.getVerticesData(b.VertexBuffer.PositionKind),p=this.getVerticesData(b.VertexBuffer.NormalKind),r=this.getVerticesData(b.VertexBuffer.UVKind),s=b.Vector3.Zero(),t=b.Vector3.Zero(),v=b.Vector2.Zero(),y=0;y<m.length;y+=3){b.Vector3.FromArrayToRef(m,y,s);b.Vector3.FromArrayToRef(p,y,t);b.Vector2.FromArrayToRef(r,2*(y/3),v);x=Math.abs(v.x)*d%d|0,z=Math.abs(v.y)*e%e|0,x=4*(x+z*d),x=0.3*(c[x]/255)+0.59*(c[x+1]/255)+0.11*(c[x+2]/255);t.normalize();t.scaleInPlace(l+(g-l)*x);s=s.add(t);s.toArray(m,y);}b.VertexData.ComputeNormals(m,this.getIndices(),p);this.updateVerticesData(b.VertexBuffer.PositionKind,m);this.updateVerticesData(b.VertexBuffer.NormalKind,p);},d.prototype.convertToFlatShadedMesh=function(){var c,d,e,l,g,m,p,r,s,t,v,y;e=this.getVerticesDataKinds(),l=[],g=[],m=[],p=!1;for(c=0;c<e.length;c++){d=e[c];r=this.getVertexBuffer(d);d!==b.VertexBuffer.NormalKind?(l[d]=r,g[d]=l[d].getData(),m[d]=[]):(p=r.isUpdatable(),e.splice(c,1),c--);}r=this.subMeshes.slice(0),t=this.getIndices(),v=this.getTotalIndices();for(s=0;v>s;s++){y=t[s];for(c=0;c<e.length;c++){d=e[c];for(var x=l[d].getStrideSize(),z=0;x>z;z++)m[d].push(g[d][y*x+z]);}}c=[];d=m[b.VertexBuffer.PositionKind];for(s=0;v>s;s+=3){t[s]=s;t[s+1]=s+1;t[s+2]=s+2;x=b.Vector3.FromArray(d,3*s);g=b.Vector3.FromArray(d,3*(s+1));y=b.Vector3.FromArray(d,3*(s+2));x=x.subtract(g);g=y.subtract(g);g=b.Vector3.Normalize(b.Vector3.Cross(x,g));for(y=0;3>y;y++)c.push(g.x),c.push(g.y),c.push(g.z);}this.setIndices(t);this.setVerticesData(b.VertexBuffer.NormalKind,c,p);for(c=0;c<e.length;c++)d=e[c],this.setVerticesData(d,m[d],l[d].isUpdatable());this.releaseSubMeshes();for(e=0;e<r.length;e++)l=r[e],new b.SubMesh(l.materialIndex,l.indexStart,l.indexCount,l.indexStart,l.indexCount,this);this.synchronizeInstances();},d.prototype.convertToUnIndexedMesh=function(){var c,d,e,l,g,m,p,r,s,t,v;e=this.getVerticesDataKinds(),l=[],g=[],m=[];for(c=0;c<e.length;c++){d=e[c];p=this.getVertexBuffer(d);l[d]=p;g[d]=l[d].getData();m[d]=[];}p=this.subMeshes.slice(0),s=this.getIndices(),t=this.getTotalIndices();for(r=0;t>r;r++){v=s[r];for(c=0;c<e.length;c++){d=e[c];for(var y=l[d].getStrideSize(),x=0;y>x;x++)m[d].push(g[d][v*y+x]);}}for(r=0;t>r;r+=3)s[r]=r,s[r+1]=r+1,s[r+2]=r+2;this.setIndices(s);y4tt.v9();for(c=0;c<e.length;c++)d=e[c],this.setVerticesData(d,m[d],l[d].isUpdatable());this.releaseSubMeshes();for(c=0;c<p.length;c++)d=p[c],new b.SubMesh(d.materialIndex,d.indexStart,d.indexCount,d.indexStart,d.indexCount,this);this._unIndexed=!0;this.synchronizeInstances();},d.prototype.flipFaces=function(c){var d,e;y4tt.q9();void 0===c&&(c=!1);d=b.VertexData.ExtractFromMesh(this);if(c&&this.isVerticesDataPresent(b.VertexBuffer.NormalKind))for(c=0;c<d.normals.length;c++)d.normals[c]*=-1;for(c=0;c<d.indices.length;c+=3)e=d.indices[c+1],d.indices[c+1]=d.indices[c+2],d.indices[c+2]=e;d.applyToMesh(this);},d.prototype.createInstance=function(c){y4tt.v9();return new b.InstancedMesh(c,this);},d.prototype.synchronizeInstances=function(){for(var b=0;b<this.instances.length;b++)this.instances[b]._syncSubMeshes();},d.prototype.simplify=function(c,d,e,l){void 0===d&&(d=!0);void 0===e&&(e=b.SimplificationType.QUADRATIC);y4tt.v9();this.getScene().simplificationQueue.addTask({settings:c,parallelProcessing:d,mesh:this,simplificationType:e,successCallback:l});},d.prototype.optimizeIndices=function(c){var p;for(var d=this,e=this.getIndices(),l=this.getVerticesData(b.VertexBuffer.PositionKind),g=[],m=0;m<l.length;m+=3)g.push(b.Vector3.FromArray(l,m));p=[];y4tt.q9();b.AsyncLoop.SyncAsyncForLoop(g.length,40,function(b){y4tt.v9();b=g.length-1-b;for(var c=g[b],d=0;b>d;++d)if(c.equals(g[d])){p[b]=d;break;}},function(){for(var b=0;b<e.length;++b)e[b]=p[e[b]]||e[b];b=d.subMeshes.slice(0);d.setIndices(e);y4tt.q9();d.subMeshes=b;c&&c(d);});},d.Parse=function(c,e,j){var l,m,g,p;y4tt.v9();l=new d(c.name,e);if(l.id=c.id,b.Tags.AddTagsTo(l,c.tags),l.position=b.Vector3.FromArray(c.position),c.rotationQuaternion?l.rotationQuaternion=b.Quaternion.FromArray(c.rotationQuaternion):c.rotation&&(l.rotation=b.Vector3.FromArray(c.rotation)),l.scaling=b.Vector3.FromArray(c.scaling),c.localMatrix?l.setPivotMatrix(b.Matrix.FromArray(c.localMatrix)):c.pivotMatrix&&l.setPivotMatrix(b.Matrix.FromArray(c.pivotMatrix)),l.setEnabled(c.isEnabled),l.isVisible=c.isVisible,l.infiniteDistance=c.infiniteDistance,l.showBoundingBox=c.showBoundingBox,l.showSubMeshesBoundingBox=c.showSubMeshesBoundingBox,void 0!==c.applyFog&&(l.applyFog=c.applyFog),void 0!==c.pickable&&(l.isPickable=c.pickable),void 0!==c.alphaIndex&&(l.alphaIndex=c.alphaIndex),l.receiveShadows=c.receiveShadows,l.billboardMode=c.billboardMode,void 0!==c.visibility&&(l.visibility=c.visibility),l.checkCollisions=c.checkCollisions,l._shouldGenerateFlatShading=c.useFlatShading,c.freezeWorldMatrix&&(l._waitingFreezeWorldMatrix=c.freezeWorldMatrix),c.parentId&&(l._waitingParentId=c.parentId),void 0!==c.actions&&(l._waitingActions=c.actions),l.hasVertexAlpha=c.hasVertexAlpha,c.delayLoadingFile?(l.delayLoadState=b.Engine.DELAYLOADSTATE_NOTLOADED,l.delayLoadingFile=j+c.delayLoadingFile,l._boundingInfo=new b.BoundingInfo(b.Vector3.FromArray(c.boundingBoxMinimum),b.Vector3.FromArray(c.boundingBoxMaximum)),c._binaryInfo&&(l._binaryInfo=c._binaryInfo),l._delayInfo=[],c.hasUVs&&l._delayInfo.push(b.VertexBuffer.UVKind),c.hasUVs2&&l._delayInfo.push(b.VertexBuffer.UV2Kind),c.hasUVs3&&l._delayInfo.push(b.VertexBuffer.UV3Kind),c.hasUVs4&&l._delayInfo.push(b.VertexBuffer.UV4Kind),c.hasUVs5&&l._delayInfo.push(b.VertexBuffer.UV5Kind),c.hasUVs6&&l._delayInfo.push(b.VertexBuffer.UV6Kind),c.hasColors&&l._delayInfo.push(b.VertexBuffer.ColorKind),c.hasMatricesIndices&&l._delayInfo.push(b.VertexBuffer.MatricesIndicesKind),c.hasMatricesWeights&&l._delayInfo.push(b.VertexBuffer.MatricesWeightsKind),l._delayLoadingFunction=b.Geometry.ImportGeometry,b.SceneLoader.ForceFullSceneLoadingForIncremental&&l._checkDelayState()):b.Geometry.ImportGeometry(c,l),c.materialId?l.setMaterialByID(c.materialId):l.material=null,-1<c.skeletonId&&(l.skeleton=e.getLastSkeletonByID(c.skeletonId),c.numBoneInfluencers&&(l.numBoneInfluencers=c.numBoneInfluencers)),c.animations){for(var g=0;g<c.animations.length;g++){m=c.animations[g];l.animations.push(b.Animation.Parse(m));}b.Node.ParseAnimationRanges(l,c,e);}if(c.autoAnimate&&e.beginAnimation(l,c.autoAnimateFrom,c.autoAnimateTo,c.autoAnimateLoop,c.autoAnimateSpeed||1),c.layerMask&&!isNaN(c.layerMask)?l.layerMask=Math.abs(parseInt(c.layerMask)):l.layerMask=268435455,c.physicsImpostor&&(l.physicsImpostor=new b.PhysicsImpostor(l,c.physicsImpostor,{mass:c.physicsMass,friction:c.physicsFriction,restitution:c.physicsRestitution},e)),c.instances)for(j=0;j<c.instances.length;j++){g=c.instances[j],p=l.createInstance(g.name);if(b.Tags.AddTagsTo(p,g.tags),p.position=b.Vector3.FromArray(g.position),g.rotationQuaternion?p.rotationQuaternion=b.Quaternion.FromArray(g.rotationQuaternion):g.rotation&&(p.rotation=b.Vector3.FromArray(g.rotation)),p.scaling=b.Vector3.FromArray(g.scaling),p.checkCollisions=l.checkCollisions,c.animations){for(g=0;g<c.animations.length;g++)m=c.animations[g],p.animations.push(b.Animation.Parse(m));b.Node.ParseAnimationRanges(p,c,e);}}return l;},d.CreateRibbon=function(c,d,e,l,g,m,p,r,s){y4tt.q9();return b.MeshBuilder.CreateRibbon(c,{pathArray:d,closeArray:e,closePath:l,offset:g,updatable:p,sideOrientation:r,instance:s},m);},d.CreateDisc=function(c,d,e,l,g,m){y4tt.q9();return b.MeshBuilder.CreateDisc(c,{radius:d,tessellation:e,sideOrientation:m,updatable:g},l);},d.CreateBox=function(c,d,e,l,g){y4tt.q9();return b.MeshBuilder.CreateBox(c,{size:d,sideOrientation:g,updatable:l},e);},d.CreateSphere=function(c,d,e,l,g,m){y4tt.v9();return b.MeshBuilder.CreateSphere(c,{segments:d,diameterX:e,diameterY:e,diameterZ:e,sideOrientation:m,updatable:g},l);},d.CreateCylinder=function(c,e,j,l,g,m,p,r,s){y4tt.q9();void 0!==p&&p instanceof b.Scene||(void 0!==p&&(s=r||d.DEFAULTSIDE,r=p),p=m,m=1);return b.MeshBuilder.CreateCylinder(c,{height:e,diameterTop:j,diameterBottom:l,tessellation:g,subdivisions:m,sideOrientation:s,updatable:r},p);},d.CreateTorus=function(c,d,e,l,g,m,p){return b.MeshBuilder.CreateTorus(c,{diameter:d,thickness:e,tessellation:l,sideOrientation:p,updatable:m},g);},d.CreateTorusKnot=function(c,d,e,l,g,m,p,r,s,t){return b.MeshBuilder.CreateTorusKnot(c,{radius:d,tube:e,radialSegments:l,tubularSegments:g,p:m,q:p,sideOrientation:t,updatable:s},r);},d.CreateLines=function(c,d,e,l,g){return b.MeshBuilder.CreateLines(c,{points:d,updatable:l,instance:g},e);},d.CreateDashedLines=function(c,d,e,l,g,m,p){y4tt.q9();return b.MeshBuilder.CreateDashedLines(c,{points:d,dashSize:e,gapSize:l,dashNb:g,updatable:p},m);},d.ExtrudeShape=function(c,e,j,l,g,m,p,r,s,t){return b.MeshBuilder.ExtrudeShape(c,{shape:e,path:j,scale:l,rotation:g,cap:0===m?0:m||d.NO_CAP,sideOrientation:s,instance:t,updatable:r},p);},d.ExtrudeShapeCustom=function(c,e,j,l,g,m,p,r,s,t,v,y){y4tt.q9();return b.MeshBuilder.ExtrudeShapeCustom(c,{shape:e,path:j,scaleFunction:l,rotationFunction:g,ribbonCloseArray:m,ribbonClosePath:p,cap:0===r?0:r||d.NO_CAP,sideOrientation:v,instance:y,updatable:t},s);},d.CreateLathe=function(c,d,e,l,g,m,p){y4tt.v9();return b.MeshBuilder.CreateLathe(c,{shape:d,radius:e,tessellation:l,sideOrientation:p,updatable:m},g);},d.CreatePlane=function(c,d,e,l,g){return b.MeshBuilder.CreatePlane(c,{size:d,width:d,height:d,sideOrientation:g,updatable:l},e);},d.CreateGround=function(c,d,e,l,g,m){return b.MeshBuilder.CreateGround(c,{width:d,height:e,subdivisions:l,updatable:m},g);},d.CreateTiledGround=function(c,d,e,l,g,m,p,r,s){y4tt.v9();return b.MeshBuilder.CreateTiledGround(c,{xmin:d,zmin:e,xmax:l,zmax:g,subdivisions:m,precision:p,updatable:s},r);},d.CreateGroundFromHeightMap=function(c,d,e,l,g,m,p,r,s,t){return b.MeshBuilder.CreateGroundFromHeightMap(c,d,{width:e,height:l,subdivisions:g,minHeight:m,maxHeight:p,updatable:s,onReady:t},r);},d.CreateTube=function(c,d,e,l,g,m,p,r,s,t){return b.MeshBuilder.CreateTube(c,{path:d,radius:e,tessellation:l,radiusFunction:g,arc:1,cap:m,updatable:r,sideOrientation:s,instance:t},p);},d.CreatePolyhedron=function(c,d,e){y4tt.v9();return b.MeshBuilder.CreatePolyhedron(c,d,e);},d.CreateIcoSphere=function(c,d,e){y4tt.q9();return b.MeshBuilder.CreateIcoSphere(c,d,e);},d.CreateDecal=function(c,d,e,l,g,m){y4tt.q9();return b.MeshBuilder.CreateDecal(c,d,{position:e,normal:l,size:g,angle:m});},d.prototype.setPositionsForCPUSkinning=function(){var c;return this._sourcePositions||(c=this.getVerticesData(b.VertexBuffer.PositionKind),this._sourcePositions=new Float32Array(c),this.getVertexBuffer(b.VertexBuffer.PositionKind).isUpdatable()||this.setVerticesData(b.VertexBuffer.PositionKind,c,!0)),this._sourcePositions;},d.prototype.setNormalsForCPUSkinning=function(){var c;return this._sourceNormals||(c=this.getVerticesData(b.VertexBuffer.NormalKind),this._sourceNormals=new Float32Array(c),this.getVertexBuffer(b.VertexBuffer.NormalKind).isUpdatable()||this.setVerticesData(b.VertexBuffer.NormalKind,c,!0)),this._sourceNormals;},d.prototype.applySkeleton=function(c){var d,e,B;if(this.geometry&&this.geometry._softwareSkinningRenderId!=this.getScene().getRenderId()){if((this.geometry._softwareSkinningRenderId=this.getScene().getRenderId(),!this.isVerticesDataPresent(b.VertexBuffer.PositionKind))||!this.isVerticesDataPresent(b.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(b.VertexBuffer.MatricesIndicesKind)||!this.isVerticesDataPresent(b.VertexBuffer.MatricesWeightsKind))return this;this._sourcePositions||this.setPositionsForCPUSkinning();this._sourceNormals||this.setNormalsForCPUSkinning();d=this.getVerticesData(b.VertexBuffer.PositionKind);d instanceof Float32Array||(d=new Float32Array(d));e=this.getVerticesData(b.VertexBuffer.NormalKind);e instanceof Float32Array||(e=new Float32Array(e));for(var l=this.getVerticesData(b.VertexBuffer.MatricesIndicesKind),g=this.getVerticesData(b.VertexBuffer.MatricesWeightsKind),m=4<this.numBoneInfluencers,p=m?this.getVerticesData(b.VertexBuffer.MatricesIndicesExtraKind):null,r=m?this.getVerticesData(b.VertexBuffer.MatricesWeightsExtraKind):null,s=c.getTransformMatrices(this),t=b.Vector3.Zero(),v=new b.Matrix(),y=new b.Matrix(),x=0,z=0;z<d.length;z+=3,x+=4){for(c=0;4>c&&(B=g[x+c],0<B);c++)b.Matrix.FromFloat32ArrayToRefScaled(s,16*l[x+c],B,y),v.addToSelf(y);if(m)for(c=0;4>c&&(B=r[x+c],0<B);c++)b.Matrix.FromFloat32ArrayToRefScaled(s,16*p[x+c],B,y),v.addToSelf(y);b.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[z],this._sourcePositions[z+1],this._sourcePositions[z+2],v,t);t.toArray(d,z);b.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[z],this._sourceNormals[z+1],this._sourceNormals[z+2],v,t);t.toArray(e,z);v.reset();}return this.updateVerticesData(b.VertexBuffer.PositionKind,d),this.updateVerticesData(b.VertexBuffer.NormalKind,e),this;}},d.MinMax=function(b){var c,d,l,e;c=null,d=null;y4tt.v9();for(l in b){e=b[l].getBoundingInfo().boundingBox;c?(c.MinimizeInPlace(e.minimumWorld),d.MaximizeInPlace(e.maximumWorld)):(c=e.minimumWorld,d=e.maximumWorld);}return{min:c,max:d};},d.Center=function(c){c=void 0!==c.min?c:d.MinMax(c);return b.Vector3.Center(c.min,c.max);},d.MergeMeshes=function(c,e,j,l){var g,m,p,r;void 0===e&&(e=!0);if(!j){g=0;for(j=0;j<c.length;j++)if(c[j]&&(g+=c[j].getTotalVertices(),65536<g))return b.Tools.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null;}y4tt.v9();for(j=0;j<c.length;j++)c[j]&&(c[j].computeWorldMatrix(!0),p=b.VertexData.ExtractFromMesh(c[j],!0),p.transform(c[j].getWorldMatrix()),m?m.merge(p):(m=p,r=c[j]));if(l||(l=new d(r.name+"_merged",r.getScene())),m.applyToMesh(l),l.material=r.material,l.checkCollisions=r.checkCollisions,e)for(j=0;j<c.length;j++)c[j]&&c[j].dispose();return l;},d._FRONTSIDE=0,d._BACKSIDE=1,d._DOUBLESIDE=2,d._DEFAULTSIDE=0,d._NO_CAP=0,d._CAP_START=1,d._CAP_END=2,d._CAP_ALL=3,d);b.Mesh=e;}(BABYLON||(BABYLON={}));!function(b){var g,e;y4tt.v9();e=function(b,d,f,e,j,l,g,m){void 0===m&&(m=!0);this.materialIndex=b;this.verticesStart=d;this.verticesCount=f;this.indexStart=e;this.indexCount=j;this._renderId=0;this._mesh=l;this._renderingMesh=g||l;l.subMeshes.push(this);this._trianglePlanes=[];this._id=l.subMeshes.length-1;m&&(this.refreshBoundingInfo(),l.computeWorldMatrix(!0));};g=(Object.defineProperty(e.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount==this._mesh.getTotalVertices();},enumerable:!0,configurable:!0}),e.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo;},e.prototype.getMesh=function(){y4tt.v9();return this._mesh;},e.prototype.getRenderingMesh=function(){y4tt.v9();return this._renderingMesh;},e.prototype.getMaterial=function(){var c;y4tt.q9();c=this._renderingMesh.material;return c&&c instanceof b.MultiMaterial?c.getSubMaterial(this.materialIndex):c?c:this._mesh.getScene().defaultMaterial;},e.prototype.refreshBoundingInfo=function(){var c,d;y4tt.q9();if(this._lastColliderWorldVertices=null,!this.IsGlobal){c=this._renderingMesh.getVerticesData(b.VertexBuffer.PositionKind);if(!c)return void(this._boundingInfo=this._mesh._boundingInfo);d=this._renderingMesh.getIndices(),c=0===this.indexStart&&this.indexCount===d.length?{minimum:this._renderingMesh.getBoundingInfo().minimum.clone(),maximum:this._renderingMesh.getBoundingInfo().maximum.clone()}:b.Tools.ExtractMinAndMaxIndexed(c,d,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);this._boundingInfo=new b.BoundingInfo(c.minimum,c.maximum);}},e.prototype._checkCollision=function(b){return this.getBoundingInfo()._checkCollision(b);},e.prototype.updateBoundingInfo=function(b){this.getBoundingInfo()||this.refreshBoundingInfo();this.getBoundingInfo().update(b);},e.prototype.isInFrustum=function(b){y4tt.v9();return this.getBoundingInfo().isInFrustum(b);},e.prototype.render=function(b){this._renderingMesh.render(this,b);},e.prototype.getLinesIndexBuffer=function(b,d){if(!this._linesIndexBuffer){for(var f=[],e=this.indexStart;e<this.indexStart+this.indexCount;e+=3)f.push(b[e],b[e+1],b[e+1],b[e+2],b[e+2],b[e]);this._linesIndexBuffer=d.createIndexBuffer(f);this.linesIndexCount=f.length;}return this._linesIndexBuffer;},e.prototype.canIntersects=function(b){return b.intersectsBox(this.getBoundingInfo().boundingBox);},e.prototype.intersects=function(c,d,f,e){var j,m,p;j=null;if(this._mesh instanceof b.LinesMesh)for(var l=this._mesh,g=this.indexStart;g<this.indexStart+this.indexCount;g+=2){m=d[f[g]],p=d[f[g+1]],m=c.intersectionSegment(m,p,l.intersectionThreshold);if(!(0>m)&&(e||!j||m<j.distance)&&(j=new b.IntersectionInfo(null,null,m),e))break;}else for(g=this.indexStart;g<this.indexStart+this.indexCount&&!(m=d[f[g]],p=d[f[g+1]],(l=c.intersectsTriangle(m,p,d[f[g+2]]))&&!(0>l.distance)&&(e||!j||l.distance<j.distance)&&(j=l,j.faceId=g/3,e));g+=3);return j;},e.prototype.clone=function(c,d){var f;f=new e(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,c,d,!1);return this.IsGlobal||(f._boundingInfo=new b.BoundingInfo(this.getBoundingInfo().minimum,this.getBoundingInfo().maximum)),f;},e.prototype.dispose=function(){var b;this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);b=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(b,1);},e.CreateFromIndices=function(b,d,f,g,j){var l,n,r;l=Number.MAX_VALUE,n=-Number.MAX_VALUE;j=j||g;for(var m=j.getIndices(),p=d;d+f>p;p++){r=m[p];l>r&&(l=r);r>n&&(n=r);}return new e(b,l,n-l+1,d,f,g,j);},e);b.SubMesh=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(){};g=(e.CreateBox=function(c,d,f){y4tt.v9();c=new b.Mesh(c,f);return b.VertexData.CreateBox(d).applyToMesh(c,d.updatable),c;},e.CreateSphere=function(c,d,f){c=new b.Mesh(c,f);return b.VertexData.CreateSphere(d).applyToMesh(c,d.updatable),c;},e.CreateDisc=function(c,d,f){y4tt.v9();c=new b.Mesh(c,f);return b.VertexData.CreateDisc(d).applyToMesh(c,d.updatable),c;},e.CreateIcoSphere=function(c,d,f){c=new b.Mesh(c,f);return b.VertexData.CreateIcoSphere(d).applyToMesh(c,d.updatable),c;},e.CreateRibbon=function(c,d,f){var e,j,l,g,m,p;e=d.pathArray,j=d.closeArray,l=d.closePath,g=(d.offset,d.sideOrientation),m=d.instance,p=d.updatable;if(m){j=m.getVerticesData(b.VertexBuffer.PositionKind);l=e[0].length;p=0;d=m.sideOrientation===b.Mesh.DOUBLESIDE?2:1;for(g=1;d>=g;g++)for(c=0;c<e.length;c++){f=e[c];for(var r=f.length,l=r>l?l:r,r=0;l>r;)j[p]=f[r].x,j[p+1]=f[r].y,j[p+2]=f[r].z,r++,p+=3;m._closePath&&(j[p]=f[0].x,j[p+1]=f[0].y,j[p+2]=f[0].z,p+=3);}if(m.updateVerticesData(b.VertexBuffer.PositionKind,j,!1,!1),!m.areNormalsFrozen){p=m.getIndices();l=m.getVerticesData(b.VertexBuffer.NormalKind);if(b.VertexData.ComputeNormals(j,p,l),m._closePath)for(d=p=j=0;d<e.length;d++)j=3*m._idx[d],p=d+1<e.length?3*(m._idx[d+1]-1):l.length-3,l[j]=0.5*(l[j]+l[p]),l[j+1]=0.5*(l[j+1]+l[p+1]),l[j+2]=0.5*(l[j+2]+l[p+2]),l[p]=l[j],l[p+1]=l[j+1],l[p+2]=l[j+2];m.updateVerticesData(b.VertexBuffer.NormalKind,l,!1,!1);}return m;}e=new b.Mesh(c,f);e.sideOrientation=g;m=b.VertexData.CreateRibbon(d);return l&&(e._idx=m._idx),e._closePath=l,e._closeArray=j,m.applyToMesh(e,p),e;},e.CreateCylinder=function(c,d,f){c=new b.Mesh(c,f);y4tt.q9();return b.VertexData.CreateCylinder(d).applyToMesh(c,d.updatable),c;},e.CreateTorus=function(c,d,f){y4tt.q9();c=new b.Mesh(c,f);return b.VertexData.CreateTorus(d).applyToMesh(c,d.updatable),c;},e.CreateTorusKnot=function(c,d,f){c=new b.Mesh(c,f);return b.VertexData.CreateTorusKnot(d).applyToMesh(c,d.updatable),c;},e.CreateLineSystem=function(c,d,f){var e,j;e=d.instance,j=d.lines;y4tt.v9();if(e)return e.updateMeshPositions(function(b){for(var c=0,d=0;d<j.length;d++)for(var f=j[d],e=0;e<f.length;e++)b[c]=f[e].x,b[c+1]=f[e].y,b[c+2]=f[e].z,c+=3;},!1),e;c=new b.LinesMesh(c,f);return b.VertexData.CreateLineSystem(d).applyToMesh(c,d.updatable),c;},e.CreateLines=function(b,d,f){y4tt.q9();return e.CreateLineSystem(b,{lines:[d.points],updatable:d.updatable,instance:d.instance},f);},e.CreateDashedLines=function(c,d,f){var e,j,l,g;e=d.points,j=d.instance,l=d.gapSize,g=(d.dashNb,d.dashSize);if(j)return j.updateMeshPositions(function(c){for(var d=b.Vector3.Zero(),f=c.length/6,l=0,g=0,n=0,y=0,x=0,z=0,B=0,A=0,B=0;B<e.length-1;B++)e[B+1].subtractToRef(e[B],d),l+=d.length();n=l/f;y=j.dashSize*n/(j.dashSize+j.gapSize);for(B=0;B<e.length-1;B++){e[B+1].subtractToRef(e[B],d);g=Math.floor(d.length()/n);d.normalize();for(A=0;g>A&&z<c.length;)x=n*A,c[z]=e[B].x+x*d.x,c[z+1]=e[B].y+x*d.y,c[z+2]=e[B].z+x*d.z,c[z+3]=e[B].x+(x+y)*d.x,c[z+4]=e[B].y+(x+y)*d.y,c[z+5]=e[B].z+(x+y)*d.z,z+=6,A++;}for(;z<c.length;)c[z]=e[B].x,c[z+1]=e[B].y,c[z+2]=e[B].z,z+=3;},!1),j;c=new b.LinesMesh(c,f);y4tt.v9();return b.VertexData.CreateDashedLines(d).applyToMesh(c,d.updatable),c.dashSize=g,c.gapSize=l,c;},e.ExtrudeShape=function(c,d,f){y4tt.q9();return e._ExtrudeShapeGeneric(c,d.shape,d.path,d.scale||1,d.rotation||0,null,null,!1,!1,0===d.cap?0:d.cap||b.Mesh.NO_CAP,!1,f,d.updatable,0===d.sideOrientation?0:d.sideOrientation||b.Mesh.DEFAULTSIDE,d.instance);},e.ExtrudeShapeCustom=function(c,d,f){return e._ExtrudeShapeGeneric(c,d.shape,d.path,null,null,d.scaleFunction||function(){y4tt.v9();return 1;},d.rotationFunction||function(){return 0;},d.ribbonCloseArray||!1,d.ribbonClosePath||!1,0===d.cap?0:d.cap||b.Mesh.NO_CAP,!0,f,d.updatable,0===d.sideOrientation?0:d.sideOrientation||b.Mesh.DEFAULTSIDE,d.instance);},e.CreateLathe=function(c,d,f){for(var g=void 0===d.closed?!0:d.closed,j=d.shape,l=d.radius||1,n=d.tessellation||64,m=d.updatable,p=0===d.sideOrientation?0:d.sideOrientation||b.Mesh.DEFAULTSIDE,r=d.cap||b.Mesh.NO_CAP,s=[],t=0,v=0,y=2*Math.PI/n*(0>=d.arc||1<d.arc?1:d.arc||1),x=[],t=0;n>=t;t++){x=[];r!=b.Mesh.CAP_START&&r!=b.Mesh.CAP_ALL||(x.push(new b.Vector3(0,j[0].y,0)),x.push(new b.Vector3(Math.cos(t*y)*j[0].x*l,j[0].y,Math.sin(t*y)*j[0].x*l)));for(v=0;v<j.length;v++)d=new b.Vector3(Math.cos(t*y)*j[v].x*l,j[v].y,Math.sin(t*y)*j[v].x*l),x.push(d);r!=b.Mesh.CAP_END&&r!=b.Mesh.CAP_ALL||(x.push(new b.Vector3(Math.cos(t*y)*j[j.length-1].x*l,j[j.length-1].y,Math.sin(t*y)*j[j.length-1].x*l)),x.push(new b.Vector3(0,j[j.length-1].y,0)));s.push(x);}y4tt.v9();return e.CreateRibbon(c,{pathArray:s,closeArray:g,sideOrientation:p,updatable:m},f);},e.CreatePlane=function(c,d,f){y4tt.v9();c=new b.Mesh(c,f);if(b.VertexData.CreatePlane(d).applyToMesh(c,d.updatable),d.sourcePlane)c.translate(d.sourcePlane.normal,d.sourcePlane.d),f=Math.acos(b.Vector3.Dot(d.sourcePlane.normal,b.Axis.Z)),d=b.Vector3.Cross(b.Axis.Z,d.sourcePlane.normal),c.rotate(d,f);return c;},e.CreateGround=function(c,d,f){c=new b.GroundMesh(c,f);c._setReady(!1);c._subdivisions=d.subdivisions||1;c._width=d.width||1;c._height=d.height||1;c._maxX=c._width/2;c._maxZ=c._height/2;c._minX=-c._maxX;y4tt.v9();c._minZ=-c._maxZ;return b.VertexData.CreateGround(d).applyToMesh(c,d.updatable),c._setReady(!0),c;},e.CreateTiledGround=function(c,d,f){c=new b.Mesh(c,f);return b.VertexData.CreateTiledGround(d).applyToMesh(c,d.updatable),c;},e.CreateGroundFromHeightMap=function(c,d,f,e){var j,l,g,m,p,r,s,t;j=f.width||10,l=f.height||10,g=f.subdivisions||1,m=f.minHeight,p=f.maxHeight||10,r=f.updatable,s=f.onReady,t=new b.GroundMesh(c,e);t._subdivisions=g;t._width=j;t._height=l;t._maxX=t._width/2;t._maxZ=t._height/2;t._minX=-t._maxX;t._minZ=-t._maxZ;t._setReady(!1);return b.Tools.LoadImage(d,function(c){var d,f,e,q;d=document.createElement("canvas"),f=d.getContext("2d"),e=c.width,q=c.height;d.width=e;y4tt.v9();d.height=q;f.drawImage(c,0,0);c=f.getImageData(0,0,e,q).data;b.VertexData.CreateGroundFromHeightMap({width:j,height:l,subdivisions:g,minHeight:m,maxHeight:p,buffer:c,bufferWidth:e,bufferHeight:q}).applyToMesh(t,r);t._setReady(!0);s&&s(t);},function(){},e.database),t;},e.CreateTube=function(c,d,f){var g,j,l,n,m,p,r,s,t,v,y;g=d.path,j=d.radius||1,l=d.tessellation||64,n=d.radiusFunction,m=d.cap||b.Mesh.NO_CAP,p=d.updatable,r=d.sideOrientation||b.Mesh.DEFAULTSIDE,s=d.instance;d.arc=0>=d.arc||1<d.arc?1:d.arc||1;y=function(c,d,f,l,e,j,g,q){var n,m,p,r,s,t,y,v;s=d.getTangents(),t=d.getNormals();d=d.getDistances();q*=2*Math.PI/e;y=j||function(){y4tt.q9();return l;},v=b.Tmp.Matrix[0];j=g===b.Mesh._NO_CAP||g===b.Mesh.CAP_END?0:2;for(var I=0;I<c.length;I++){m=y(I,d[I]);n=[];p=t[I];for(var Q=0;e>Q;Q++)b.Matrix.RotationAxisToRef(s[I],q*Q,v),r=n[Q]?n[Q]:b.Vector3.Zero(),b.Vector3.TransformCoordinatesToRef(p,v,r),r.scaleInPlace(m).addInPlace(c[I]),n[Q]=r;f[j]=n;j++;}s=function(b,d){y4tt.v9();for(var f=[],l=0;b>l;l++)f.push(c[d]);return f;};switch(g){case b.Mesh.CAP_START:f[0]=s(e,0);f[1]=f[2].slice(0);break;case b.Mesh.CAP_END:f[j]=f[j-1].slice(0);f[j+1]=s(e,c.length-1);break;case b.Mesh.CAP_ALL:f[0]=s(e,0),f[1]=f[2].slice(0),f[j]=f[j-1].slice(0),f[j+1]=s(e,c.length-1);}y4tt.q9();return f;};if(s)return d=d.arc||s.arc,t=s.path3D.update(g),v=y(g,t,s.pathArray,j,s.tessellation,n,s.cap,d),s=e.CreateRibbon(null,{pathArray:v,instance:s}),s.path3D=t,s.pathArray=v,s.arc=d,s;t=new b.Path3D(g);m=0>m||3<m?0:m;v=y(g,t,[],j,l,n,m,d.arc);g=e.CreateRibbon(c,{pathArray:v,closePath:!0,closeArray:!1,updatable:p,sideOrientation:r},f);return g.pathArray=v,g.path3D=t,g.tessellation=l,g.cap=m,g.arc=d.arc,g;},e.CreatePolyhedron=function(c,d,f){c=new b.Mesh(c,f);return b.VertexData.CreatePolyhedron(d).applyToMesh(c,d.updatable),c;},e.CreateDecal=function(c,d,f){var e,j,l,g,m,p,r,s,t,B,C;e=d.getIndices(),j=d.getVerticesData(b.VertexBuffer.PositionKind),l=d.getVerticesData(b.VertexBuffer.NormalKind),g=f.position||b.Vector3.Zero(),m=f.normal||b.Vector3.Up(),p=f.size||new b.Vector3(1,1,1);f=f.angle||0;if(!m)m=new b.Vector3(0,0,1),r=d.getScene().activeCamera,m=b.Vector3.TransformCoordinates(m,r.getWorldMatrix()),m=r.globalPosition.subtract(m);r=-Math.atan2(m.z,m.x)-Math.PI/2,s=Math.sqrt(m.x*m.x+m.z*m.z),m=Math.atan2(m.y,s),s=b.Matrix.RotationYawPitchRoll(r,m,f).multiply(b.Matrix.Translation(g.x,g.y,g.z)),s=b.Matrix.Invert(s),t=d.getWorldMatrix().multiply(s),s=new b.VertexData();s.indices=[];s.positions=[];s.normals=[];s.uvs=[];for(var v=0,y=function(c){var d;c=e[c];d=new b.PositionNormalVertex();return d.position=new b.Vector3(j[3*c],j[3*c+1],j[3*c+2]),d.position=b.Vector3.TransformCoordinates(d.position,t),d.normal=new b.Vector3(l[3*c],l[3*c+1],l[3*c+2]),d;},x=function(c,d){var g,q,n,m,r,s,t,y,v,x;y4tt.q9();if(0===c.length)return c;for(var f=0.5*Math.abs(b.Vector3.Dot(p,d)),l=function(c,l){var e;e=b.Vector3.GetClipFactor(c.position,l.position,d,f);return new b.PositionNormalVertex(b.Vector3.Lerp(c.position,l.position,e),b.Vector3.Lerp(c.normal,l.normal,e));},e=[],j=0;j<c.length;j+=3){y=b.Vector3.Dot(c[j].position,d)-f,v=b.Vector3.Dot(c[j+1].position,d)-f,x=b.Vector3.Dot(c[j+2].position,d)-f;switch(g=0<y,q=0<v,n=0<x,(g?1:0)+(q?1:0)+(n?1:0)){case 0:e.push(c[j]);e.push(c[j+1]);e.push(c[j+2]);break;case 1:if(g&&(m=c[j+1],r=c[j+2],s=l(c[j],m),t=l(c[j],r)),q){m=c[j];r=c[j+2];s=l(c[j+1],m);t=l(c[j+1],r);e.push(s);e.push(r.clone());e.push(m.clone());e.push(r.clone());e.push(s.clone());e.push(t);break;}n&&(m=c[j],r=c[j+1],s=l(c[j+2],m),t=l(c[j+2],r));e.push(m.clone());e.push(r.clone());e.push(s);e.push(t);e.push(s.clone());e.push(r.clone());break;case 2:g||(m=c[j].clone(),r=l(m,c[j+1]),s=l(m,c[j+2]),e.push(m),e.push(r),e.push(s)),q||(m=c[j+1].clone(),r=l(m,c[j+2]),s=l(m,c[j]),e.push(m),e.push(r),e.push(s)),n||(m=c[j+2].clone(),r=l(m,c[j]),s=l(m,c[j+1]),e.push(m),e.push(r),e.push(s));}}return e;},z=0;z<e.length;z+=3){B=[];if(B.push(y(z)),B.push(y(z+1)),B.push(y(z+2)),B=x(B,new b.Vector3(1,0,0)),B=x(B,new b.Vector3(-1,0,0)),B=x(B,new b.Vector3(0,1,0)),B=x(B,new b.Vector3(0,-1,0)),B=x(B,new b.Vector3(0,0,1)),B=x(B,new b.Vector3(0,0,-1)),0!==B.length)for(var A=0;A<B.length;A++){C=B[A];s.indices.push(v);C.position.toArray(s.positions,3*v);C.normal.toArray(s.normals,3*v);s.uvs.push(0.5+C.position.x/p.x);s.uvs.push(0.5+C.position.y/p.y);v++;}}c=new b.Mesh(c,d.getScene());return s.applyToMesh(c),c.position=g.clone(),c.rotation=new b.Vector3(m,r,f),c;},e._ExtrudeShapeGeneric=function(c,d,f,e,j,l,g,m,p,r,s,t,v,y,x){var z,B,A;A=function(c,d,f,l,e,j,g,q,n,m){var p,r,s,t,cb,na;p=f.getTangents(),r=f.getNormals(),s=f.getBinormals();y4tt.v9();f=f.getDistances();t=0;q=m?q:function(){y4tt.q9();return j;};m=m?g:function(){return e;};g=n===b.Mesh.NO_CAP||n===b.Mesh.CAP_END?0:2;for(var y=b.Tmp.Matrix[0],v=0;v<d.length;v++){for(var x=[],z=q(v,f[v]),B=m(v,f[v]),A=0;A<c.length;A++){b.Matrix.RotationAxisToRef(p[v],t,y);cb=p[v].scale(c[A].z).add(r[v].scale(c[A].x)).add(s[v].scale(c[A].y)),na=x[A]?x[A]:b.Vector3.Zero();b.Vector3.TransformCoordinatesToRef(cb,y,na);na.scaleInPlace(B).addInPlace(d[v]);x[A]=na;}l[g]=x;t+=z;g++;}c=function(c){var d,f,l;y4tt.v9();f=[],l=b.Vector3.Zero();for(d=0;d<c.length;d++)l.addInPlace(c[d]);l.scaleInPlace(1/c.length);for(d=0;d<c.length;d++)f.push(l);return f;};switch(n){case b.Mesh.CAP_START:l[0]=c(l[2]);l[1]=l[2].slice(0);break;case b.Mesh.CAP_END:l[g]=l[g-1];l[g+1]=c(l[g-1]);break;case b.Mesh.CAP_ALL:l[0]=c(l[2]),l[1]=l[2].slice(0),l[g]=l[g-1],l[g+1]=c(l[g-1]);}return l;};if(x)return z=x.path3D.update(f),B=A(d,f,x.path3D,x.pathArray,e,j,l,g,x.cap,s),x=b.Mesh.CreateRibbon(null,B,null,null,null,null,null,null,x);z=new b.Path3D(f);r=0>r||3<r?0:r;B=A(d,f,z,[],e,j,l,g,r,s);c=b.Mesh.CreateRibbon(c,B,m,p,0,t,v,y);return c.pathArray=B,c.path3D=z,c.cap=r,c;},e);b.MeshBuilder=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(e){this.getAlphaFromRGB=this.hasAlpha=!1;this.level=1;this.coordinatesIndex=0;this.coordinatesMode=b.Texture.EXPLICIT_MODE;this.wrapV=this.wrapU=b.Texture.WRAP_ADDRESSMODE;this.anisotropicFilteringLevel=4;this.isRenderTarget=this.isCube=!1;this.animations=[];this.onDisposeObservable=new b.Observable();this.delayLoadState=b.Engine.DELAYLOADSTATE_NONE;y4tt.v9();this._scene=e;this._scene.textures.push(this);};g=(g.prototype.toString=function(){y4tt.v9();return this.name;},Object.defineProperty(g.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);y4tt.v9();this._onDisposeObserver=this.onDisposeObservable.add(b);},enumerable:!0,configurable:!0}),g.prototype.getScene=function(){y4tt.q9();return this._scene;},g.prototype.getTextureMatrix=function(){return null;},g.prototype.getReflectionTextureMatrix=function(){return null;},g.prototype.getInternalTexture=function(){y4tt.q9();return this._texture;},g.prototype.isReady=function(){return this.delayLoadState===b.Engine.DELAYLOADSTATE_NOTLOADED?!0:this._texture?this._texture.isReady:!1;},g.prototype.getSize=function(){return this._texture._width?{width:this._texture._width,height:this._texture._height}:this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:0,height:0};},g.prototype.getBaseSize=function(){y4tt.v9();return this.isReady()&&this._texture?this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:this._texture._baseWidth,height:this._texture._baseHeight}:{width:0,height:0};},g.prototype.scale=function(){},Object.defineProperty(g.prototype,"canRescale",{get:function(){return!1;},enumerable:!0,configurable:!0}),g.prototype._removeFromCache=function(b,c){var g;for(var d=this._scene.getEngine().getLoadedTexturesCache(),f=0;f<d.length;f++){g=d[f];if(g.url===b&&g.noMipmap===c)return void d.splice(f,1);}},g.prototype._getFromCache=function(b,c,d){var j;y4tt.v9();for(var f=this._scene.getEngine().getLoadedTexturesCache(),g=0;g<f.length;g++){j=f[g];if(j.url===b&&j.noMipmap===c&&(!d||d===j.samplingMode))return j.references++,j;}return null;},g.prototype.delayLoad=function(){},g.prototype.clone=function(){y4tt.q9();return null;},g.prototype.releaseInternalTexture=function(){this._texture&&(this._scene.getEngine().releaseInternalTexture(this._texture),delete this._texture);},g.prototype.dispose=function(){var b;this.getScene().stopAnimation(this);b=this._scene.textures.indexOf(this);y4tt.v9();0<=b&&this._scene.textures.splice(b,1);void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear());},g.prototype.serialize=function(){var e;if(!this.name)return null;e=b.SerializationHelper.Serialize(this);y4tt.q9();return b.Animation.AppendSerializedAnimations(this,e),e;},__decorate([b.serialize()],g.prototype,"name",void 0),__decorate([b.serialize()],g.prototype,"hasAlpha",void 0),__decorate([b.serialize()],g.prototype,"getAlphaFromRGB",void 0),__decorate([b.serialize()],g.prototype,"level",void 0),__decorate([b.serialize()],g.prototype,"coordinatesIndex",void 0),__decorate([b.serialize()],g.prototype,"coordinatesMode",void 0),__decorate([b.serialize()],g.prototype,"wrapU",void 0),__decorate([b.serialize()],g.prototype,"wrapV",void 0),__decorate([b.serialize()],g.prototype,"anisotropicFilteringLevel",void 0),__decorate([b.serialize()],g.prototype,"isCube",void 0),__decorate([b.serialize()],g.prototype,"isRenderTarget",void 0),g);b.BaseTexture=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.BaseTexture,c=function(d,f,g,j,l,n,m,p,r){y4tt.q9();void 0===l&&(l=c.TRILINEAR_SAMPLINGMODE);void 0===n&&(n=null);void 0===m&&(m=null);void 0===p&&(p=null);void 0===r&&(r=!1);e.call(this,f);this.vOffset=this.uOffset=0;this.vScale=this.uScale=1;this.wAng=this.vAng=this.uAng=0;this.url=this.name=d;this._noMipmap=g;this._invertY=j;this._samplingMode=l;this._buffer=p;this._deleteBuffer=r;d&&(this._texture=this._getFromCache(d,g,l),this._texture?b.Tools.SetImmediate(function(){y4tt.q9();n&&n();}):f.useDelayedTextureLoading?(this.delayLoadState=b.Engine.DELAYLOADSTATE_NOTLOADED,this._delayedOnLoad=n,this._delayedOnError=m):(this._texture=f.getEngine().createTexture(d,g,j,f,this._samplingMode,n,m,this._buffer),r&&delete this._buffer));};g=(__extends(c,e),Object.defineProperty(c.prototype,"noMipmap",{get:function(){y4tt.q9();return this._noMipmap;},enumerable:!0,configurable:!0}),c.prototype.delayLoad=function(){y4tt.v9();this.delayLoadState===b.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=b.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this._samplingMode),this._texture||(this._texture=this.getScene().getEngine().createTexture(this.url,this._noMipmap,this._invertY,this.getScene(),this._samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer),this._deleteBuffer&&delete this._buffer));},c.prototype.updateSamplingMode=function(b){this._texture&&(this._samplingMode=b,this.getScene().getEngine().updateTextureSamplingMode(b,this._texture));},c.prototype._prepareRowForTextureGeneration=function(c,f,e,j){c*=this.uScale;f*=this.vScale;c-=0.5*this.uScale;f-=0.5*this.vScale;b.Vector3.TransformCoordinatesFromFloatsToRef(c,f,e-0.5,this._rowGenerationMatrix,j);j.x+=0.5*this.uScale+this.uOffset;j.y+=0.5*this.vScale+this.vOffset;j.z+=0.5;},c.prototype.getTextureMatrix=function(){y4tt.q9();return this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng?this._cachedTextureMatrix:(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=b.Matrix.Zero(),this._rowGenerationMatrix=new b.Matrix(),this._t0=b.Vector3.Zero(),this._t1=b.Vector3.Zero(),this._t2=b.Vector3.Zero()),b.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),b.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix.m[0]=this._t1.x,this._cachedTextureMatrix.m[1]=this._t1.y,this._cachedTextureMatrix.m[2]=this._t1.z,this._cachedTextureMatrix.m[4]=this._t2.x,this._cachedTextureMatrix.m[5]=this._t2.y,this._cachedTextureMatrix.m[6]=this._t2.z,this._cachedTextureMatrix.m[8]=this._t0.x,this._cachedTextureMatrix.m[9]=this._t0.y,this._cachedTextureMatrix.m[10]=this._t0.z,this._cachedTextureMatrix);},c.prototype.getReflectionTextureMatrix=function(){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode)return this._cachedTextureMatrix;switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=b.Matrix.Zero(),this._projectionModeMatrix=b.Matrix.Zero()),this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case c.PLANAR_MODE:b.Matrix.IdentityToRef(this._cachedTextureMatrix);this._cachedTextureMatrix[0]=this.uScale;this._cachedTextureMatrix[5]=this.vScale;this._cachedTextureMatrix[12]=this.uOffset;this._cachedTextureMatrix[13]=this.vOffset;break;case c.PROJECTION_MODE:b.Matrix.IdentityToRef(this._projectionModeMatrix);this._projectionModeMatrix.m[0]=0.5;this._projectionModeMatrix.m[5]=-0.5;this._projectionModeMatrix.m[10]=0;this._projectionModeMatrix.m[12]=0.5;this._projectionModeMatrix.m[13]=0.5;this._projectionModeMatrix.m[14]=1;this._projectionModeMatrix.m[15]=1;this.getScene().getProjectionMatrix().multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:b.Matrix.IdentityToRef(this._cachedTextureMatrix);}return this._cachedTextureMatrix;},c.prototype.clone=function(){var d;d=this;return b.SerializationHelper.Clone(function(){y4tt.v9();return new c(d._texture.url,d.getScene(),d._noMipmap,d._invertY,d._samplingMode);},this);},c.CreateFromBase64String=function(b,f,e,j,l,g,m,p){y4tt.v9();return void 0===g&&(g=c.TRILINEAR_SAMPLINGMODE),void 0===m&&(m=null),void 0===p&&(p=null),new c("data:"+f,e,j,l,g,m,p,b);},c.Parse=function(d,f,e){var j;if(d.isCube)return b.CubeTexture.Parse(d,f,e);if(!d.name&&!d.isRenderTarget)return null;j=b.SerializationHelper.Parse(function(){var l;y4tt.q9();if(d.mirrorPlane){l=new b.MirrorTexture(d.name,d.renderTargetSize,f);return l._waitingRenderList=d.renderList,l.mirrorPlane=b.Plane.FromArray(d.mirrorPlane),l;}return d.isRenderTarget?(l=new b.RenderTargetTexture(d.name,d.renderTargetSize,f),l._waitingRenderList=d.renderList,l):d.base64String?c.CreateFromBase64String(d.base64String,d.name,f):new c(e+d.name,f);},d,f);if(d.animations)for(var l=0;l<d.animations.length;l++)j.animations.push(b.Animation.Parse(d.animations[l]));return j;},c.NEAREST_SAMPLINGMODE=1,c.BILINEAR_SAMPLINGMODE=2,c.TRILINEAR_SAMPLINGMODE=3,c.EXPLICIT_MODE=0,c.SPHERICAL_MODE=1,c.PLANAR_MODE=2,c.CUBIC_MODE=3,c.PROJECTION_MODE=4,c.SKYBOX_MODE=5,c.INVCUBIC_MODE=6,c.EQUIRECTANGULAR_MODE=7,c.FIXED_EQUIRECTANGULAR_MODE=8,c.CLAMP_ADDRESSMODE=0,c.WRAP_ADDRESSMODE=1,c.MIRROR_ADDRESSMODE=2,__decorate([b.serialize()],c.prototype,"url",void 0),__decorate([b.serialize()],c.prototype,"uOffset",void 0),__decorate([b.serialize()],c.prototype,"vOffset",void 0),__decorate([b.serialize()],c.prototype,"uScale",void 0),__decorate([b.serialize()],c.prototype,"vScale",void 0),__decorate([b.serialize()],c.prototype,"uAng",void 0),__decorate([b.serialize()],c.prototype,"vAng",void 0),__decorate([b.serialize()],c.prototype,"wAng",void 0),c);y4tt.v9();b.Texture=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;y4tt.v9();e=b.BaseTexture,c=function(c,f,g,j,l){if(e.call(this,f),this.coordinatesMode=b.Texture.CUBIC_MODE,this.name=c,this.url=c,this._noMipmap=j,this.hasAlpha=!1,c||l){if(this._texture=this._getFromCache(c,j),!l){g||(g="_px.jpg _py.jpg _pz.jpg _nx.jpg _ny.jpg _nz.jpg".split(" "));l=[];for(var n=0;n<g.length;n++)l.push(c+g[n]);this._extensions=g;}this._files=l;this._texture||(f.useDelayedTextureLoading?this.delayLoadState=b.Engine.DELAYLOADSTATE_NOTLOADED:this._texture=f.getEngine().createCubeTexture(c,f,l,j));this.isCube=!0;this._textureMatrix=b.Matrix.Identity();}};g=(__extends(c,e),c.CreateFromImages=function(b,f,e){y4tt.q9();return new c("",f,null,e,b);},c.prototype.delayLoad=function(){this.delayLoadState===b.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=b.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._texture=this.getScene().getEngine().createCubeTexture(this.url,this.getScene(),this._extensions)));},c.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix;},c.Parse=function(c,f,e){var j;j=b.SerializationHelper.Parse(function(){return new b.CubeTexture(e+c.name,f,c.extensions);},c,f);if(c.animations)for(var l=0;l<c.animations.length;l++)j.animations.push(b.Animation.Parse(c.animations[l]));return j;},c.prototype.clone=function(){var d;d=this;return b.SerializationHelper.Clone(function(){y4tt.v9();return new c(d.url,d.getScene(),d._extensions,d._noMipmap,d._files);},this);},c);b.CubeTexture=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;y4tt.q9();e=b.Texture,c=function(c,f,g,j,l,n,m,p){void 0===l&&(l=!0);void 0===n&&(n=b.Engine.TEXTURETYPE_UNSIGNED_INT);void 0===m&&(m=!1);y4tt.v9();void 0===p&&(p=b.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,g,!j);this.isCube=m;this.renderList=[];this.renderParticles=!0;this.renderSprites=!1;this.coordinatesMode=b.Texture.PROJECTION_MODE;this.onAfterUnbindObservable=new b.Observable();this.onBeforeRenderObservable=new b.Observable();this.onAfterRenderObservable=new b.Observable();this.onClearObservable=new b.Observable();this._currentRefreshId=-1;this._refreshRate=1;this.name=c;this.isRenderTarget=!0;this._size=f;this._generateMipMaps=j;this._doNotChangeAspectRatio=l;p===b.Texture.NEAREST_SAMPLINGMODE&&(this.wrapU=b.Texture.CLAMP_ADDRESSMODE,this.wrapV=b.Texture.CLAMP_ADDRESSMODE);m?(this._texture=g.getEngine().createRenderTargetCubeTexture(f,{generateMipMaps:j,samplingMode:p}),this.coordinatesMode=b.Texture.INVCUBIC_MODE,this._textureMatrix=b.Matrix.Identity()):this._texture=g.getEngine().createRenderTargetTexture(f,{generateMipMaps:j,type:n,samplingMode:p});this._renderingManager=new b.RenderingManager(g);};g=(__extends(c,e),Object.defineProperty(c,"REFRESHRATE_RENDER_ONCE",{get:function(){y4tt.q9();return c._REFRESHRATE_RENDER_ONCE;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"REFRESHRATE_RENDER_ONEVERYFRAME",{get:function(){return c._REFRESHRATE_RENDER_ONEVERYFRAME;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"REFRESHRATE_RENDER_ONEVERYTWOFRAMES",{get:function(){y4tt.v9();return c._REFRESHRATE_RENDER_ONEVERYTWOFRAMES;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onAfterUnbind",{set:function(b){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver);this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onBeforeRender",{set:function(b){y4tt.v9();this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onAfterRender",{set:function(b){y4tt.v9();this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver);this._onAfterRenderObserver=this.onAfterRenderObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onClear",{set:function(b){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver);this._onClearObserver=this.onClearObservable.add(b);},enumerable:!0,configurable:!0}),c.prototype.resetRefreshCounter=function(){y4tt.v9();this._currentRefreshId=-1;},Object.defineProperty(c.prototype,"refreshRate",{get:function(){y4tt.v9();return this._refreshRate;},set:function(b){this._refreshRate=b;this.resetRefreshCounter();},enumerable:!0,configurable:!0}),c.prototype._shouldRender=function(){y4tt.q9();return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1);},c.prototype.isReady=function(){y4tt.v9();return this.getScene().renderTargetsEnabled?e.prototype.isReady.call(this):!1;},c.prototype.getRenderSize=function(){return this._size;},Object.defineProperty(c.prototype,"canRescale",{get:function(){return!0;},enumerable:!0,configurable:!0}),c.prototype.scale=function(b){y4tt.q9();this.resize(this._size*b,this._generateMipMaps);},c.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:e.prototype.getReflectionTextureMatrix.call(this);},c.prototype.resize=function(b,c){y4tt.q9();this.releaseInternalTexture();this.isCube?this._texture=this.getScene().getEngine().createRenderTargetCubeTexture(b):this._texture=this.getScene().getEngine().createRenderTargetTexture(b,c);},c.prototype.render=function(b,c){var e,g,r;e=this.getScene();if(void 0!==this.useCameraPostProcesses&&(b=this.useCameraPostProcesses),this.activeCamera&&this.activeCamera!==e.activeCamera&&e.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0)),this._waitingRenderList){this.renderList=[];for(var j=0;j<this._waitingRenderList.length;j++)this.renderList.push(e.getMeshByID(this._waitingRenderList[j]));delete this._waitingRenderList;}y4tt.v9();if(this.renderListPredicate){this.renderList.splice(0);for(var l=this.getScene().meshes,j=0;j<l.length;j++){g=l[j];this.renderListPredicate(g)&&this.renderList.push(g);}}if(!this.renderList||0!==this.renderList.length){this._renderingManager.reset();for(var j=this.renderList?this.renderList:e.getActiveMeshes().data,l=e.getRenderId(),m=0;m<j.length;m++)if(g=j[m])if(g.isReady()){if(g._preActivateForIntermediateRendering(l),g.isEnabled()&&g.isVisible&&g.subMeshes&&0!==(g.layerMask&e.activeCamera.layerMask)){g._activate(l);for(var p=0;p<g.subMeshes.length;p++){r=g.subMeshes[p];e._activeIndices+=r.indexCount;this._renderingManager.dispatch(r);}}}else this.resetRefreshCounter();if(this.isCube)for(g=0;6>g;g++)this.renderToTarget(g,j,b,c),e.incrementRenderId(),e.resetCachedMaterial();else this.renderToTarget(0,j,b,c);this.onAfterUnbindObservable.notifyObservers(this);this.activeCamera&&this.activeCamera!==e.activeCamera&&e.setTransformMatrix(e.activeCamera.getViewMatrix(),e.activeCamera.getProjectionMatrix(!0));e.resetCachedMaterial();}},c.prototype.renderToTarget=function(c,f,e,j){var l,g;l=this.getScene(),g=l.getEngine();e&&l.postProcessManager._prepareFrame(this._texture)||(this.isCube?g.bindFramebuffer(this._texture,c):g.bindFramebuffer(this._texture));this.onBeforeRenderObservable.notifyObservers(c);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(g):g.clear(l.clearColor,!0,!0);this._doNotChangeAspectRatio||l.updateTransformMatrix(!0);this._renderingManager.render(this.customRenderFunction,f,this.renderParticles,this.renderSprites);e&&l.postProcessManager._finalizeFrame(!1,this._texture,c);this._doNotChangeAspectRatio||l.updateTransformMatrix(!0);this.onAfterRenderObservable.notifyObservers(c);y4tt.q9();j&&b.Tools.DumpFramebuffer(this._size,this._size,g);this.isCube&&5!==c||(this.isCube&&5===c&&g.generateMipMapsForCubemap(this._texture),g.unBindFramebuffer(this._texture,this.isCube));},c.prototype.clone=function(){var b;b=this.getSize(),b=new c(this.name,b.width,this.getScene(),this._generateMipMaps);y4tt.v9();return b.hasAlpha=this.hasAlpha,b.level=this.level,b.coordinatesMode=this.coordinatesMode,b.renderList=this.renderList.slice(0),b;},c.prototype.serialize=function(){var b;if(!this.name)return null;b=e.prototype.serialize.call(this);b.renderTargetSize=this.getRenderSize();b.renderList=[];y4tt.q9();for(var c=0;c<this.renderList.length;c++)b.renderList.push(this.renderList[c].id);return b;},c._REFRESHRATE_RENDER_ONCE=0,c._REFRESHRATE_RENDER_ONEVERYFRAME=1,c._REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,c);b.RenderTargetTexture=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.Texture,c=function(c,f,g,j,l,n,m){void 0===n&&(n=!0);void 0===m&&(m=!1);e.call(this,null,j,!n);this.isCube=m;this.isEnabled=!0;this._currentRefreshId=-1;this._refreshRate=1;this._vertexBuffers={};this._uniforms=[];this._samplers=[];this._textures=[];this._floats=[];this._floatsArrays={};this._colors3=[];this._colors4=[];this._vectors2=[];this._vectors3=[];this._matrices=[];this._fallbackTextureUsed=!1;j._proceduralTextures.push(this);this.name=c;this.isRenderTarget=!0;this._size=f;this._generateMipMaps=n;this.setFragment(g);this._fallbackTexture=l;c=j.getEngine();m?(this._texture=c.createRenderTargetCubeTexture(f,{generateMipMaps:n}),this.setFloat("face",0)):this._texture=c.createRenderTargetTexture(f,n);f=[];f.push(1,1);f.push(-1,1);f.push(-1,-1);f.push(1,-1);this._vertexBuffers[b.VertexBuffer.PositionKind]=new b.VertexBuffer(c,f,b.VertexBuffer.PositionKind,!1,!1,2);f=[];f.push(0);f.push(1);f.push(2);f.push(0);f.push(2);f.push(3);this._indexBuffer=c.createIndexBuffer(f);};y4tt.v9();g=(__extends(c,e),c.prototype.reset=function(){y4tt.q9();void 0!==this._effect&&this.getScene().getEngine()._releaseEffect(this._effect);},c.prototype.isReady=function(){var c,f,e;f=this,e=this.getScene().getEngine();y4tt.q9();return this._fragment?this._fallbackTextureUsed?!0:(c=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._effect=e.createEffect(c,[b.VertexBuffer.PositionKind],this._uniforms,this._samplers,"",null,null,function(){y4tt.v9();f.releaseInternalTexture();f._fallbackTexture&&(f._texture=f._fallbackTexture._texture,f._texture.references++);f._fallbackTextureUsed=!0;}),this._effect.isReady()):!1;},c.prototype.resetRefreshCounter=function(){y4tt.q9();this._currentRefreshId=-1;},c.prototype.setFragment=function(b){this._fragment=b;},Object.defineProperty(c.prototype,"refreshRate",{get:function(){return this._refreshRate;},set:function(b){this._refreshRate=b;this.resetRefreshCounter();},enumerable:!0,configurable:!0}),c.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?this._fallbackTextureUsed?!1:-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1):!1;},c.prototype.getRenderSize=function(){y4tt.v9();return this._size;},c.prototype.resize=function(b,c){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this.getScene().getEngine().createRenderTargetTexture(b,c));},c.prototype._checkUniform=function(b){y4tt.v9();-1===this._uniforms.indexOf(b)&&this._uniforms.push(b);},c.prototype.setTexture=function(b,c){y4tt.q9();return-1===this._samplers.indexOf(b)&&this._samplers.push(b),this._textures[b]=c,this;},c.prototype.setFloat=function(b,c){y4tt.q9();return this._checkUniform(b),this._floats[b]=c,this;},c.prototype.setFloats=function(b,c){return this._checkUniform(b),this._floatsArrays[b]=c,this;},c.prototype.setColor3=function(b,c){return this._checkUniform(b),this._colors3[b]=c,this;},c.prototype.setColor4=function(b,c){return this._checkUniform(b),this._colors4[b]=c,this;},c.prototype.setVector2=function(b,c){return this._checkUniform(b),this._vectors2[b]=c,this;},c.prototype.setVector3=function(b,c){y4tt.q9();return this._checkUniform(b),this._vectors3[b]=c,this;},c.prototype.setMatrix=function(b,c){y4tt.v9();return this._checkUniform(b),this._matrices[b]=c,this;},c.prototype.render=function(){var b,c,j;b=this.getScene(),c=b.getEngine();c.enableEffect(this._effect);c.setState(!1);for(var e in this._textures)this._effect.setTexture(e,this._textures[e]);for(e in this._floats)this._effect.setFloat(e,this._floats[e]);for(e in this._floatsArrays)this._effect.setArray(e,this._floatsArrays[e]);for(e in this._colors3)this._effect.setColor3(e,this._colors3[e]);for(e in this._colors4){j=this._colors4[e];this._effect.setFloat4(e,j.r,j.g,j.b,j.a);}for(e in this._vectors2)this._effect.setVector2(e,this._vectors2[e]);for(e in this._vectors3)this._effect.setVector3(e,this._vectors3[e]);for(e in this._matrices)this._effect.setMatrix(e,this._matrices[e]);if(c.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.isCube)for(e=0;6>e;e++)c.bindFramebuffer(this._texture,e),this._effect.setFloat("face",e),c.clear(b.clearColor,!0,!0),c.draw(!0,0,6),5===e&&c.generateMipMapsForCubemap(this._texture);else c.bindFramebuffer(this._texture),c.clear(b.clearColor,!0,!0),c.draw(!0,0,6);c.unBindFramebuffer(this._texture,this.isCube);y4tt.v9();this.onGenerated&&this.onGenerated();},c.prototype.clone=function(){var b;b=this.getSize(),b=new c(this.name,b.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);y4tt.v9();return b.hasAlpha=this.hasAlpha,b.level=this.level,b.coordinatesMode=this.coordinatesMode,b;},c.prototype.dispose=function(){var c;c=this.getScene()._proceduralTextures.indexOf(this);0<=c&&this.getScene()._proceduralTextures.splice(c,1);y4tt.v9();(c=this._vertexBuffers[b.VertexBuffer.PositionKind])&&(c.dispose(),this._vertexBuffers[b.VertexBuffer.PositionKind]=null);this._indexBuffer&&this.getScene().getEngine()._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null);e.prototype.dispose.call(this);},c);b.ProceduralTexture=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.RenderTargetTexture,c=function(c,f,g,j){var l;l=this;e.call(this,c,f,g,j,!0);this.mirrorPlane=new b.Plane(0,1,0,1);this._transformMatrix=b.Matrix.Zero();y4tt.v9();this._mirrorMatrix=b.Matrix.Zero();this.onBeforeRenderObservable.add(function(){b.Matrix.ReflectionToRef(l.mirrorPlane,l._mirrorMatrix);l._savedViewMatrix=g.getViewMatrix();l._mirrorMatrix.multiplyToRef(l._savedViewMatrix,l._transformMatrix);g.setTransformMatrix(l._transformMatrix,g.getProjectionMatrix());g.clipPlane=l.mirrorPlane;g.getEngine().cullBackFaces=!1;g._mirroredCameraPosition=b.Vector3.TransformCoordinates(g.activeCamera.position,l._mirrorMatrix);});this.onAfterRenderObservable.add(function(){g.setTransformMatrix(l._savedViewMatrix,g.getProjectionMatrix());g.getEngine().cullBackFaces=!0;g._mirroredCameraPosition=null;y4tt.q9();delete g.clipPlane;});};g=(__extends(c,e),c.prototype.clone=function(){var b;b=this.getSize(),b=new c(this.name,b.width,this.getScene(),this._generateMipMaps);return b.hasAlpha=this.hasAlpha,b.level=this.level,b.mirrorPlane=this.mirrorPlane.clone(),b.renderList=this.renderList.slice(0),b;},c.prototype.serialize=function(){var b;if(!this.name)return null;y4tt.v9();b=e.prototype.serialize.call(this);return b.mirrorPlane=this.mirrorPlane.asArray(),b;},c);b.MirrorTexture=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.RenderTargetTexture,c=function(c,f,g,j){var l;l=this;e.call(this,c,f,g,j,!0);this.refractionPlane=new b.Plane(0,1,0,1);this.depth=2;this.onBeforeRenderObservable.add(function(){y4tt.v9();g.clipPlane=l.refractionPlane;});this.onAfterRenderObservable.add(function(){y4tt.q9();delete g.clipPlane;});};y4tt.v9();g=(__extends(c,e),c.prototype.clone=function(){var b;b=this.getSize(),b=new c(this.name,b.width,this.getScene(),this._generateMipMaps);y4tt.v9();return b.hasAlpha=this.hasAlpha,b.level=this.level,b.refractionPlane=this.refractionPlane.clone(),b.renderList=this.renderList.slice(0),b.depth=this.depth,b;},c.prototype.serialize=function(){var b;if(!this.name)return null;y4tt.q9();b=e.prototype.serialize.call(this);return b.mirrorPlane=this.refractionPlane.asArray(),b.depth=this.depth,b;},c);b.RefractionTexture=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.Texture,c=function(c,f,g,j,l){void 0===l&&(l=b.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,g,!j);this.name=c;this.wrapV=this.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._generateMipMaps=j;f.getContext?(this._canvas=f,this._texture=g.getEngine().createDynamicTexture(f.width,f.height,j,l)):(this._canvas=document.createElement("canvas"),f.width?this._texture=g.getEngine().createDynamicTexture(f.width,f.height,j,l):this._texture=g.getEngine().createDynamicTexture(f,f,j,l));c=this.getSize();this._canvas.width=c.width;this._canvas.height=c.height;this._context=this._canvas.getContext("2d");};y4tt.q9();g=(__extends(c,e),Object.defineProperty(c.prototype,"canRescale",{get:function(){return!0;},enumerable:!0,configurable:!0}),c.prototype.scale=function(b){var c;c=this.getSize();c.width*=b;c.height*=b;this._canvas.width=c.width;this._canvas.height=c.height;this.releaseInternalTexture();this._texture=this.getScene().getEngine().createDynamicTexture(c.width,c.height,this._generateMipMaps,this._samplingMode);},c.prototype.getContext=function(){y4tt.q9();return this._context;},c.prototype.clear=function(){var b;b=this.getSize();this._context.fillRect(0,0,b.width,b.height);},c.prototype.update=function(b){y4tt.q9();this.getScene().getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===b?!0:b);},c.prototype.drawText=function(b,c,e,j,l,g,m,p){var r;void 0===p&&(p=!0);r=this.getSize();if(g&&(this._context.fillStyle=g,this._context.fillRect(0,0,r.width,r.height)),this._context.font=j,null===c)c=this._context.measureText(b),c=(r.width-c.width)/2;this._context.fillStyle=l;this._context.fillText(b,c,e);p&&this.update(m);},c.prototype.clone=function(){var b;b=this.getSize(),b=new c(this.name,b,this.getScene(),this._generateMipMaps);y4tt.q9();return b.hasAlpha=this.hasAlpha,b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b;},c);b.DynamicTexture=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.Texture;g=function(c,d,f,g,j,l){var n,m;y4tt.v9();n=this;void 0===g&&(g=!1);void 0===j&&(j=!1);void 0===l&&(l=b.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,f,!g,j);this._autoLaunch=!0;this.name=c;d instanceof HTMLVideoElement?this.video=d:(m=d,this.video=document.createElement("video"),this.video.autoplay=!1,this.video.loop=!0);this._generateMipMaps=g;this._samplingMode=l;b.Tools.IsExponentOfTwo(this.video.videoWidth)&&b.Tools.IsExponentOfTwo(this.video.videoHeight)?(this.wrapU=b.Texture.WRAP_ADDRESSMODE,this.wrapV=b.Texture.WRAP_ADDRESSMODE):(this.wrapU=b.Texture.CLAMP_ADDRESSMODE,this.wrapV=b.Texture.CLAMP_ADDRESSMODE,this._generateMipMaps=!1);m?(this.video.addEventListener("canplaythrough",function(){y4tt.v9();n._createTexture();}),m.forEach(function(b){var c;c=document.createElement("source");c.src=b;y4tt.v9();n.video.appendChild(c);})):this._createTexture();this._lastUpdate=b.Tools.Now;};g=(__extends(g,e),g.prototype._createTexture=function(){this._texture=this.getScene().getEngine().createDynamicTexture(this.video.videoWidth,this.video.videoHeight,this._generateMipMaps,this._samplingMode);this._texture.isReady=!0;},g.prototype.update=function(){var c;this._autoLaunch&&(this._autoLaunch=!1,this.video.play());c=b.Tools.Now;return 15>c-this._lastUpdate||this.video.readyState!==this.video.HAVE_ENOUGH_DATA?!1:(this._lastUpdate=c,this.getScene().getEngine().updateVideoTexture(this._texture,this.video,this._invertY),!0);},g);b.VideoTexture=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.ProceduralTexture;g=function(b,d,f,g,j,l){e.call(this,b,f,null,g,j,l);this._animate=!0;this._time=0;this._texturePath=d;this.loadJson(d);this.refreshRate=1;};g=(__extends(g,e),g.prototype.loadJson=function(c){var f,e,j;f=this,e=this,j=new XMLHttpRequest();function d(){b.Tools.Log("No config file found in "+c+" trying to use ShadersStore or DOM element");try{e.setFragment(e._texturePath);}catch(d){b.Tools.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture");}}j.open("GET",c+"/config.json",!0);j.addEventListener("load",function(){y4tt.v9();if(200===j.status||b.Tools.ValidateXHRData(j,1))try{f._config=JSON.parse(j.response),f.updateShaderUniforms(),f.updateTextures(),f.setFragment(f._texturePath+"/custom"),f._animate=f._config.animate,f.refreshRate=f._config.refreshrate;}catch(c){d();}else d();},!1);j.addEventListener("error",function(){y4tt.q9();d();},!1);try{j.send();}catch(l){b.Tools.Error("CustomProceduralTexture: Error on XHR send request.");}},g.prototype.isReady=function(){if(!e.prototype.isReady.call(this))return!1;for(var b in this._textures)if(!this._textures[b].isReady())return!1;return!0;},g.prototype.render=function(b){this._animate&&(this._time+=0.03*this.getScene().getAnimationRatio(),this.updateShaderUniforms());y4tt.q9();e.prototype.render.call(this,b);},g.prototype.updateTextures=function(){y4tt.v9();for(var c=0;c<this._config.sampler2Ds.length;c++)this.setTexture(this._config.sampler2Ds[c].sample2Dname,new b.Texture(this._texturePath+"/"+this._config.sampler2Ds[c].textureRelativeUrl,this.getScene()));},g.prototype.updateShaderUniforms=function(){var d;if(this._config)for(var c=0;c<this._config.uniforms.length;c++){d=this._config.uniforms[c];switch(d.type){case"float":this.setFloat(d.name,d.value);break;case"color3":this.setColor3(d.name,new b.Color3(d.r,d.g,d.b));break;case"color4":this.setColor4(d.name,new b.Color4(d.r,d.g,d.b,d.a));break;case"vector2":this.setVector2(d.name,new b.Vector2(d.x,d.y));break;case"vector3":this.setVector3(d.name,new b.Vector3(d.x,d.y,d.z));}}this.setFloat("time",this._time);},Object.defineProperty(g.prototype,"animate",{get:function(){y4tt.q9();return this._animate;},set:function(b){this._animate=b;},enumerable:!0,configurable:!0}),g);b.CustomProceduralTexture=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;g=function(){this._defines={};y4tt.q9();this._currentRank=32;this._maxRank=-1;};g=(g.prototype.addFallback=function(b,d){this._defines[b]||(b<this._currentRank&&(this._currentRank=b),b>this._maxRank&&(this._maxRank=b),this._defines[b]=[]);this._defines[b].push(d);},g.prototype.addCPUSkinningFallback=function(b,d){this._meshRank=b;this._mesh=d;b>this._maxRank&&(this._maxRank=b);},Object.defineProperty(g.prototype,"isMoreFallbacks",{get:function(){y4tt.q9();return this._currentRank<=this._maxRank;},enumerable:!0,configurable:!0}),g.prototype.reduce=function(c){for(var d=this._defines[this._currentRank],f=0;f<d.length;f++)c=c.replace("#define "+d[f],"");return this._mesh&&this._currentRank===this._meshRank&&(this._mesh.computeBonesUsingShaders=!1,c=c.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),b.Tools.Log("Falling back to CPU skinning for "+this._mesh.name)),this._currentRank++,c;},g);b.EffectFallbacks=g;e=function(b,d,f,e,j,l,g,m,p,r){var s,t,v;s=this;this._isReady=!1;this._compilationError="";this._valueCache=[];this._engine=j;this.name=b;this.defines=l;this._uniformsNames=f.concat(e);this._samplers=e;this._attributesNames=d;this.onError=p;this.onCompiled=m;this._indexParameters=r;b.vertexElement?(t=document.getElementById(b.vertexElement),t||(t=b.vertexElement)):t=b.vertex||b;b.fragmentElement?(v=document.getElementById(b.fragmentElement),v||(v=b.fragmentElement)):v=b.fragment||b;this._loadVertexShader(t,function(b){y4tt.q9();s._processIncludes(b,function(b){y4tt.v9();s._loadFragmentShader(v,function(c){y4tt.q9();s._processIncludes(c,function(c){y4tt.q9();s._prepareEffect(b,c,d,l,g);});});});});};g=(e.prototype.isReady=function(){return this._isReady;},e.prototype.getProgram=function(){return this._program;},e.prototype.getAttributesNames=function(){return this._attributesNames;},e.prototype.getAttributeLocation=function(b){y4tt.v9();return this._attributes[b];},e.prototype.getAttributeLocationByName=function(b){b=this._attributesNames.indexOf(b);return this._attributes[b];},e.prototype.getAttributesCount=function(){y4tt.q9();return this._attributes.length;},e.prototype.getUniformIndex=function(b){y4tt.v9();return this._uniformsNames.indexOf(b);},e.prototype.getUniform=function(b){return this._uniforms[this._uniformsNames.indexOf(b)];},e.prototype.getSamplers=function(){y4tt.v9();return this._samplers;},e.prototype.getCompilationError=function(){y4tt.q9();return this._compilationError;},e.prototype._loadVertexShader=function(c,d){var f;y4tt.q9();if(c instanceof HTMLElement){f=b.Tools.GetDOMTextContent(c);return void d(f);}if(e.ShadersStore[c+"VertexShader"])return void d(e.ShadersStore[c+"VertexShader"]);f="."===c[0]||"/"===c[0]||-1<c.indexOf("http")?c:b.Engine.ShadersRepository+c;b.Tools.LoadFile(f+".vertex.fx",d);},e.prototype._loadFragmentShader=function(c,d){var f;if(c instanceof HTMLElement){f=b.Tools.GetDOMTextContent(c);return void d(f);}if(e.ShadersStore[c+"PixelShader"])return void d(e.ShadersStore[c+"PixelShader"]);if(e.ShadersStore[c+"FragmentShader"])return void d(e.ShadersStore[c+"FragmentShader"]);f="."===c[0]||"/"===c[0]||-1<c.indexOf("http")?c:b.Engine.ShadersRepository+c;b.Tools.LoadFile(f+".fragment.fx",d);},e.prototype._dumpShadersName=function(){y4tt.q9();this.name.vertexElement?(b.Tools.Error("Vertex shader:"+this.name.vertexElement),b.Tools.Error("Fragment shader:"+this.name.fragmentElement)):this.name.vertex?(b.Tools.Error("Vertex shader:"+this.name.vertex),b.Tools.Error("Fragment shader:"+this.name.fragment)):(b.Tools.Error("Vertex shader:"+this.name),b.Tools.Error("Fragment shader:"+this.name));},e.prototype._processIncludes=function(c,d){var n,m,s,t,p,r;for(var f=this,g=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,j=g.exec(c),l=new String(c);null!=j;){n=j[1];if(!e.IncludesShadersStore[n])return void b.Tools.LoadFile(b.Engine.ShadersRepository+"ShadersInclude/"+n+".fx",function(b){e.IncludesShadersStore[n]=b;f._processIncludes(l,d);});m=e.IncludesShadersStore[n];if(j[2])for(var p=j[3].split(","),r=0;r<p.length;r+=2)m=m.replace(RegExp(p[r],6399<(3780,8130)?"g":9.79e+3),p[r+1]);if(j[4])if(p=j[5],-1!==p.indexOf("..")){s=p.split(".."),t=parseInt(s[0]),p=parseInt(s[1]),r=m.slice(0),m="";isNaN(p)&&(p=this._indexParameters[s[1]]);for(s=t;p>=s;s++)m+=r.replace(/\{X\}/g,s)+"\n";}else m=m.replace(/\{X\}/g,p);l=l.replace(j[0],m);j=g.exec(c);}d(l);},e.prototype._processPrecision=function(b){y4tt.v9();return-1===b.indexOf("precision highp float")?b=this._engine.getCaps().highPrecisionShaderSupported?"precision highp float;\n"+b:"precision mediump float;\n"+b:this._engine.getCaps().highPrecisionShaderSupported||(b=b.replace("precision highp float","precision mediump float")),b;},e.prototype._prepareEffect=function(c,d,f,e,j){var l;y4tt.v9();try{l=this._engine;c=this._processPrecision(c);d=this._processPrecision(d);this._program=l.createShaderProgram(c,d,e);this._uniforms=l.getUniforms(this._program,this._uniformsNames);this._attributes=l.getAttributes(this._program,f);for(var g=0;g<this._samplers.length;g++)null==this.getUniform(this._samplers[g])&&(this._samplers.splice(g,1),g--);l.bindSamplers(this);this._isReady=!0;this.onCompiled&&this.onCompiled(this);}catch(m){if(-1!==m.message.indexOf("highp"))return c=c.replace("precision highp float","precision mediump float"),d=d.replace("precision highp float","precision mediump float"),void this._prepareEffect(c,d,f,e,j);j&&j.isMoreFallbacks?(b.Tools.Error("Unable to compile effect with current defines. Trying next fallback."),this._dumpShadersName(),e=j.reduce(e),this._prepareEffect(c,d,f,e,j)):(b.Tools.Error("Unable to compile effect: "),this._dumpShadersName(),b.Tools.Error("Defines: "+e),b.Tools.Error("Error: "+m.message),this._compilationError=m.message,this.onError&&this.onError(this,this._compilationError));}},Object.defineProperty(e.prototype,"isSupported",{get:function(){y4tt.q9();return""===this._compilationError;},enumerable:!0,configurable:!0}),e.prototype._bindTexture=function(b,d){y4tt.q9();this._engine._bindTexture(this._samplers.indexOf(b),d);},e.prototype.setTexture=function(b,d){this._engine.setTexture(this._samplers.indexOf(b),d);},e.prototype.setTextureFromPostProcess=function(b,d){this._engine.setTextureFromPostProcess(this._samplers.indexOf(b),d);},e.prototype._cacheMatrix=function(c,d){this._valueCache[c]||(this._valueCache[c]=new b.Matrix());y4tt.v9();for(var f=0;16>f;f++)this._valueCache[c].m[f]=d.m[f];},e.prototype._cacheFloat2=function(b,d,f){y4tt.v9();return this._valueCache[b]?(this._valueCache[b][0]=d,void(this._valueCache[b][1]=f)):void(this._valueCache[b]=[d,f]);},e.prototype._cacheFloat3=function(b,d,f,e){return this._valueCache[b]?(this._valueCache[b][0]=d,this._valueCache[b][1]=f,void(this._valueCache[b][2]=e)):void(this._valueCache[b]=[d,f,e]);},e.prototype._cacheFloat4=function(b,d,f,e,j){y4tt.q9();return this._valueCache[b]?(this._valueCache[b][0]=d,this._valueCache[b][1]=f,this._valueCache[b][2]=e,void(this._valueCache[b][3]=j)):void(this._valueCache[b]=[d,f,e,j]);},e.prototype.setArray=function(b,d){return this._engine.setArray(this.getUniform(b),d),this;},e.prototype.setArray2=function(b,d){return this._engine.setArray2(this.getUniform(b),d),this;},e.prototype.setArray3=function(b,d){return this._engine.setArray3(this.getUniform(b),d),this;},e.prototype.setArray4=function(b,d){y4tt.v9();return this._engine.setArray4(this.getUniform(b),d),this;},e.prototype.setMatrices=function(b,d){y4tt.q9();return this._engine.setMatrices(this.getUniform(b),d),this;},e.prototype.setMatrix=function(b,d){y4tt.v9();return this._engine.setMatrix(this.getUniform(b),d),this;},e.prototype.setMatrix3x3=function(b,d){return this._engine.setMatrix3x3(this.getUniform(b),d),this;},e.prototype.setMatrix2x2=function(b,d){return this._engine.setMatrix2x2(this.getUniform(b),d),this;},e.prototype.setFloat=function(b,d){y4tt.q9();return this._valueCache[b]&&this._valueCache[b]===d?this:(this._valueCache[b]=d,this._engine.setFloat(this.getUniform(b),d),this);},e.prototype.setBool=function(b,d){return this._valueCache[b]&&this._valueCache[b]===d?this:(this._valueCache[b]=d,this._engine.setBool(this.getUniform(b),d?1:0),this);},e.prototype.setVector2=function(b,d){return this._valueCache[b]&&this._valueCache[b][0]===d.x&&this._valueCache[b][1]===d.y?this:(this._cacheFloat2(b,d.x,d.y),this._engine.setFloat2(this.getUniform(b),d.x,d.y),this);},e.prototype.setFloat2=function(b,d,f){return this._valueCache[b]&&this._valueCache[b][0]===d&&this._valueCache[b][1]===f?this:(this._cacheFloat2(b,d,f),this._engine.setFloat2(this.getUniform(b),d,f),this);},e.prototype.setVector3=function(b,d){y4tt.v9();return this._valueCache[b]&&this._valueCache[b][0]===d.x&&this._valueCache[b][1]===d.y&&this._valueCache[b][2]===d.z?this:(this._cacheFloat3(b,d.x,d.y,d.z),this._engine.setFloat3(this.getUniform(b),d.x,d.y,d.z),this);},e.prototype.setFloat3=function(b,d,f,e){y4tt.q9();return this._valueCache[b]&&this._valueCache[b][0]===d&&this._valueCache[b][1]===f&&this._valueCache[b][2]===e?this:(this._cacheFloat3(b,d,f,e),this._engine.setFloat3(this.getUniform(b),d,f,e),this);},e.prototype.setVector4=function(b,d){return this._valueCache[b]&&this._valueCache[b][0]===d.x&&this._valueCache[b][1]===d.y&&this._valueCache[b][2]===d.z&&this._valueCache[b][3]===d.w?this:(this._cacheFloat4(b,d.x,d.y,d.z,d.w),this._engine.setFloat4(this.getUniform(b),d.x,d.y,d.z,d.w),this);},e.prototype.setFloat4=function(b,d,f,e,j){y4tt.q9();return this._valueCache[b]&&this._valueCache[b][0]===d&&this._valueCache[b][1]===f&&this._valueCache[b][2]===e&&this._valueCache[b][3]===j?this:(this._cacheFloat4(b,d,f,e,j),this._engine.setFloat4(this.getUniform(b),d,f,e,j),this);},e.prototype.setColor3=function(b,d){y4tt.q9();return this._valueCache[b]&&this._valueCache[b][0]===d.r&&this._valueCache[b][1]===d.g&&this._valueCache[b][2]===d.b?this:(this._cacheFloat3(b,d.r,d.g,d.b),this._engine.setColor3(this.getUniform(b),d),this);},e.prototype.setColor4=function(b,d,f){return this._valueCache[b]&&this._valueCache[b][0]===d.r&&this._valueCache[b][1]===d.g&&this._valueCache[b][2]===d.b&&this._valueCache[b][3]===f?this:(this._cacheFloat4(b,d.r,d.g,d.b,f),this._engine.setColor4(this.getUniform(b),d,f),this);},e.ShadersStore={},e.IncludesShadersStore={},e);y4tt.v9();b.Effect=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(){};g=(e.PrepareDefinesForLights=function(c,d,f,e){var p,s,t;y4tt.v9();void 0===e&&(e=4);for(var j=0,l=!1,g=!1,m=0;m<c.lights.length;m++){p=c.lights[m];if(p.isEnabled()){if(0<p._excludedMeshesIds.length){for(var r=0;r<p._excludedMeshesIds.length;r++){s=c.getMeshByID(p._excludedMeshesIds[r]);s&&p.excludedMeshes.push(s);}p._excludedMeshesIds=[];}if(0<p._includedOnlyMeshesIds.length){for(r=0;r<p._includedOnlyMeshesIds.length;r++)(s=c.getMeshByID(p._includedOnlyMeshesIds[r]))&&p.includedOnlyMeshes.push(s);p._includedOnlyMeshesIds=[];}if(p.canAffectMesh(d)){l=!0;void 0===f["LIGHT"+j]&&(g=!0);f["LIGHT"+j]=!0;if(t=p instanceof b.SpotLight?"SPOTLIGHT"+j:p instanceof b.HemisphericLight?"HEMILIGHT"+j:p instanceof b.PointLight?"POINTLIGHT"+j:"DIRLIGHT"+j,void 0===f[t]&&(g=!0),f[t]=!0,p.specular.equalsFloats(0,0,0)||void 0===f.SPECULARTERM||(f.SPECULARTERM=!0),c.shadowsEnabled)p=p.getShadowGenerator(),d&&d.receiveShadows&&p&&(void 0===f["SHADOW"+j]&&(g=!0),f["SHADOW"+j]=!0,f.SHADOWS=!0,(p.useVarianceShadowMap||p.useBlurVarianceShadowMap)&&(void 0===f["SHADOWVSM"+j]&&(g=!0),f["SHADOWVSM"+j]=!0),p.usePoissonSampling&&(void 0===f["SHADOWPCF"+j]&&(g=!0),f["SHADOWPCF"+j]=!0));if(j++,j===e)break;}}}return g&&f.rebuild(),l;},e.PrepareUniformsAndSamplersList=function(b,d,f,e){void 0===e&&(e=4);for(var j=0;e>j&&f["LIGHT"+j];j++)b.push("vLightData"+j,"vLightDiffuse"+j,"vLightSpecular"+j,"vLightDirection"+j,"vLightGround"+j,"lightMatrix"+j,"shadowsInfo"+j),d.push("shadowSampler"+j);},e.HandleFallbacksForShadows=function(b,d,f){void 0===f&&(f=4);for(var e=0;f>e&&b["LIGHT"+e];e++)0<e&&d.addFallback(e,"LIGHT"+e),b["SHADOW"+e]&&d.addFallback(0,"SHADOW"+e),b["SHADOWPCF"+e]&&d.addFallback(0,"SHADOWPCF"+e),b["SHADOWVSM"+e]&&d.addFallback(0,"SHADOWVSM"+e);},e.PrepareAttributesForBones=function(c,d,f,e){0<f.NUM_BONE_INFLUENCERS&&(e.addCPUSkinningFallback(0,d),c.push(b.VertexBuffer.MatricesIndicesKind),c.push(b.VertexBuffer.MatricesWeightsKind),4<f.NUM_BONE_INFLUENCERS&&(c.push(b.VertexBuffer.MatricesIndicesExtraKind),c.push(b.VertexBuffer.MatricesWeightsExtraKind)));},e.PrepareAttributesForInstances=function(b,d){d.INSTANCES&&(b.push("world0"),b.push("world1"),b.push("world2"),b.push("world3"));},e.BindLightShadow=function(b,d,f,e,j,l){var g;y4tt.q9();g=b.getShadowGenerator();return f.receiveShadows&&g&&(b.needCube()?l||(l=!0,j.setFloat2("depthValues",d.activeCamera.minZ,d.activeCamera.maxZ)):j.setMatrix("lightMatrix"+e,g.getTransformMatrix()),j.setTexture("shadowSampler"+e,g.getShadowMapForRendering()),j.setFloat3("shadowsInfo"+e,g.getDarkness(),g.blurScale/g.getShadowMap().getSize().width,g.bias)),l;},e.BindLightProperties=function(c,d,f){y4tt.v9();c instanceof b.PointLight?c.transferToEffect(d,"vLightData"+f):c instanceof b.DirectionalLight?c.transferToEffect(d,"vLightData"+f):c instanceof b.SpotLight?c.transferToEffect(d,"vLightData"+f,"vLightDirection"+f):c instanceof b.HemisphericLight&&c.transferToEffect(d,"vLightData"+f,"vLightGround"+f);},e.BindLights=function(c,d,f,g,j){var p;y4tt.q9();void 0===j&&(j=4);for(var l=0,n=!1,m=0;m<c.lights.length;m++){p=c.lights[m];if(p.isEnabled()&&p.canAffectMesh(d)&&(e.BindLightProperties(p,f,l),p.diffuse.scaleToRef(p.intensity,b.Tmp.Color3[0]),f.setColor4("vLightDiffuse"+l,b.Tmp.Color3[0],p.range),g.SPECULARTERM&&(p.specular.scaleToRef(p.intensity,b.Tmp.Color3[1]),f.setColor3("vLightSpecular"+l,b.Tmp.Color3[1])),c.shadowsEnabled&&(n=this.BindLightShadow(p,c,d,l,f,n)),l++,l===j))break;}},e.BindFogParameters=function(c,d,f){c.fogEnabled&&d.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&(f.setFloat4("vFogInfos",c.fogMode,c.fogStart,c.fogEnd,c.fogDensity),f.setColor3("vFogColor",c.fogColor));},e.BindBonesParameters=function(b,d){b&&b.useBones&&b.computeBonesUsingShaders&&d.setMatrices("mBones",b.skeleton.getTransformMatrices(b));},e.BindLogDepth=function(b,d,f){b.LOGARITHMICDEPTH&&d.setFloat("logarithmicDepthConstant",2/(Math.log(f.activeCamera.maxZ+1)/Math.LN2));},e.BindClipPlane=function(b,d){var f;if(d.clipPlane){f=d.clipPlane;b.setFloat4("vClipPlane",f.normal.x,f.normal.y,f.normal.z,f.d);}},e);b.MaterialHelper=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(){this.isEnabled=!0;this.leftColor=b.Color3.White();this.rightColor=b.Color3.Black();this.bias=0;this.power=1;};g=(e.prototype.clone=function(){var c;y4tt.v9();c=new e();return b.Tools.DeepCopy(this,c),new e();},e.prototype.serialize=function(){var b;y4tt.v9();b={};return b.isEnabled=this.isEnabled,b.leftColor=this.leftColor,b.rightColor=this.rightColor,b.bias=this.bias,b.power=this.power,b;},e.Parse=function(c){var d;d=new e();return d.isEnabled=c.isEnabled,d.leftColor=b.Color3.FromArray(c.leftColor),d.rightColor=b.Color3.FromArray(c.rightColor),d.bias=c.bias,d.power=c.power||1,d;},e);b.FresnelParameters=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;g=function(){};g=(g.prototype.rebuild=function(){this._keys&&delete this._keys;this._keys=Object.keys(this);},g.prototype.isEqual=function(b){var f;if(this._keys.length!==b._keys.length)return!1;for(var d=0;d<this._keys.length;d++){f=this._keys[d];if(this[f]!==b[f])return!1;}return!0;},g.prototype.cloneTo=function(b){var f;this._keys.length!==b._keys.length&&(b._keys=this._keys.slice(0));for(var d=0;d<this._keys.length;d++){f=this._keys[d];b[f]=this[f];}},g.prototype.reset=function(){var d;for(var b=0;b<this._keys.length;b++){d=this._keys[b];"number"==typeof this[d]?this[d]=0:this[d]=!1;}},g.prototype.toString=function(){var f;y4tt.q9();for(var b="",d=0;d<this._keys.length;d++){f=this._keys[d];"number"==typeof this[f]?b+="#define "+f+" "+this[f]+"\n":this[f]&&(b+="#define "+f+"\n");}return b;},g);b.MaterialDefines=g;e=function(c,d,f){this.name=c;this.checkReadyOnlyOnce=this.checkReadyOnEveryCall=!1;this.state="";this.alpha=1;this.backFaceCulling=!0;this.sideOrientation=e.CounterClockWiseSideOrientation;this.onDisposeObservable=new b.Observable();this.onBindObservable=new b.Observable();this.alphaMode=b.Engine.ALPHA_COMBINE;this.disableDepthWrite=!1;this.fogEnabled=!0;this.pointSize=1;this.zOffset=0;this._wasPreviouslyReady=!1;this._fillMode=e.TriangleFillMode;this.id=c;this._scene=d;f||d.materials.push(this);};g=(Object.defineProperty(e,"TriangleFillMode",{get:function(){return e._TriangleFillMode;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WireFrameFillMode",{get:function(){y4tt.v9();return e._WireFrameFillMode;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PointFillMode",{get:function(){y4tt.q9();return e._PointFillMode;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ClockWiseSideOrientation",{get:function(){return e._ClockWiseSideOrientation;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CounterClockWiseSideOrientation",{get:function(){return e._CounterClockWiseSideOrientation;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBind",{set:function(b){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver);y4tt.q9();this._onBindObserver=this.onBindObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wireframe",{get:function(){y4tt.q9();return this._fillMode===e.WireFrameFillMode;},set:function(b){y4tt.v9();this._fillMode=b?e.WireFrameFillMode:e.TriangleFillMode;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointsCloud",{get:function(){y4tt.v9();return this._fillMode===e.PointFillMode;},set:function(b){this._fillMode=b?e.PointFillMode:e.TriangleFillMode;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillMode",{get:function(){return this._fillMode;},set:function(b){y4tt.q9();this._fillMode=b;},enumerable:!0,configurable:!0}),e.prototype.toString=function(){y4tt.v9();return"Name: "+this.name;},Object.defineProperty(e.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce;},enumerable:!0,configurable:!0}),e.prototype.freeze=function(){this.checkReadyOnlyOnce=!0;},e.prototype.unfreeze=function(){y4tt.v9();this.checkReadyOnlyOnce=!1;},e.prototype.isReady=function(){y4tt.v9();return!0;},e.prototype.getEffect=function(){y4tt.v9();return this._effect;},e.prototype.getScene=function(){y4tt.q9();return this._scene;},e.prototype.needAlphaBlending=function(){return 1>this.alpha;},e.prototype.needAlphaTesting=function(){y4tt.q9();return!1;},e.prototype.getAlphaTestTexture=function(){return null;},e.prototype.markDirty=function(){this._wasPreviouslyReady=!1;},e.prototype._preBind=function(){var b;b=this._scene.getEngine();b.enableEffect(this._effect);b.setState(this.backFaceCulling,this.zOffset,!1,this.sideOrientation===e.ClockWiseSideOrientation);},e.prototype.bind=function(b,d){var f;if(this._scene._cachedMaterial=this,this.onBindObservable.notifyObservers(d),this.disableDepthWrite){f=this._scene.getEngine();this._cachedDepthWriteState=f.getDepthWrite();f.setDepthWrite(!1);}},e.prototype.bindOnlyWorldMatrix=function(){},e.prototype.unbind=function(){y4tt.q9();this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState);},e.prototype.clone=function(){y4tt.v9();return null;},e.prototype.getBindedMeshes=function(){var f;for(var b=[],d=0;d<this._scene.meshes.length;d++){f=this._scene.meshes[d];f.material===this&&b.push(f);}y4tt.q9();return b;},e.prototype.dispose=function(b){var d;this.getScene().stopAnimation(this);d=this._scene.materials.indexOf(this);0<=d&&this._scene.materials.splice(d,1);b&&this._effect&&(this._scene.getEngine()._releaseEffect(this._effect),this._effect=null);for(d=0;d<this._scene.meshes.length;d++)b=this._scene.meshes[d],b.material===this&&(b.material=null);this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();this.onBindObservable.clear();},e.prototype.serialize=function(){return b.SerializationHelper.Serialize(this);},e.ParseMultiMaterial=function(c,d){var f,j;f=new b.MultiMaterial(c.name,d);f.id=c.id;b.Tags.AddTagsTo(f,c.tags);for(var e=0;e<c.materials.length;e++){j=c.materials[e];j?f.subMaterials.push(d.getMaterialByID(j)):f.subMaterials.push(null);}return f;},e.Parse=function(c,d,f){y4tt.v9();return!c.customType?b.StandardMaterial.Parse(c,d,f):b.Tools.Instantiate(c.customType).Parse(c,d,f);},e._TriangleFillMode=0,e._WireFrameFillMode=1,e._PointFillMode=2,e._ClockWiseSideOrientation=0,e._CounterClockWiseSideOrientation=1,__decorate([b.serialize()],e.prototype,"id",void 0),__decorate([b.serialize()],e.prototype,"checkReadyOnEveryCall",void 0),__decorate([b.serialize()],e.prototype,"checkReadyOnlyOnce",void 0),__decorate([b.serialize()],e.prototype,"state",void 0),__decorate([b.serialize()],e.prototype,"alpha",void 0),__decorate([b.serialize()],e.prototype,"backFaceCulling",void 0),__decorate([b.serialize()],e.prototype,"sideOrientation",void 0),__decorate([b.serialize()],e.prototype,"alphaMode",void 0),__decorate([b.serialize()],e.prototype,"disableDepthWrite",void 0),__decorate([b.serialize()],e.prototype,"fogEnabled",void 0),__decorate([b.serialize()],e.prototype,"pointSize",void 0),__decorate([b.serialize()],e.prototype,"zOffset",void 0),__decorate([b.serialize()],e.prototype,"wireframe",null),__decorate([b.serialize()],e.prototype,"pointsCloud",null),__decorate([b.serialize()],e.prototype,"fillMode",null),e);b.Material=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f;y4tt.v9();e=b.MaterialDefines,c=function(){e.call(this);this.VERTEXALPHA=this.VERTEXCOLOR=this.UV2=this.UV1=this.NORMAL=this.FRESNEL=this.EMISSIVEFRESNEL=this.REFRACTIONFRESNEL=this.REFLECTIONFRESNEL=this.OPACITYFRESNEL=this.DIFFUSEFRESNEL=this.SPECULARTERM=this.FOG=this.POINTSIZE=this.ALPHAFROMDIFFUSE=this.ALPHATEST=this.CLIPPLANE=this.SPECULAROVERALPHA=this.PARALLAXOCCLUSION=this.PARALLAX=this.BUMP=this.SPECULAR=this.EMISSIVE=this.REFLECTION=this.OPACITYRGB=this.OPACITY=this.AMBIENT=this.DIFFUSE=!1;this.BonesPerMesh=this.NUM_BONE_INFLUENCERS=0;this.INVERTNORMALMAPY=this.INVERTNORMALMAPX=this.REFLECTIONOVERALPHA=this.REFRACTIONMAP_3D=this.REFRACTION=this.LOGARITHMICDEPTH=this.INVERTCUBICMAP=this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=this.REFLECTIONMAP_EQUIRECTANGULAR=this.REFLECTIONMAP_EXPLICIT=this.REFLECTIONMAP_SKYBOX=this.REFLECTIONMAP_PROJECTION=this.REFLECTIONMAP_CUBIC=this.REFLECTIONMAP_PLANAR=this.REFLECTIONMAP_SPHERICAL=this.REFLECTIONMAP_3D=this.USELIGHTMAPASSHADOWMAP=this.LIGHTMAP=this.REFLECTIONFRESNELFROMSPECULAR=this.LINKEMISSIVEWITHDIFFUSE=this.EMISSIVEASILLUMINATION=this.ROUGHNESS=this.GLOSSINESS=this.INSTANCES=!1;this.rebuild();};g=(__extends(c,e),c);d=b.Material,f=function(c,f){var e;e=this;d.call(this,c,f);this.ambientColor=new b.Color3(0,0,0);this.diffuseColor=new b.Color3(1,1,1);this.specularColor=new b.Color3(1,1,1);this.emissiveColor=new b.Color3(0,0,0);y4tt.v9();this.specularPower=64;this.useParallaxOcclusion=this.useParallax=this.disableLighting=this.useReflectionOverAlpha=this.useSpecularOverAlpha=this.useReflectionFresnelFromSpecular=this.linkEmissiveWithDiffuse=this.useEmissiveAsIllumination=this.useAlphaFromDiffuseTexture=!1;this.parallaxScaleBias=0.05;this.roughness=0;this.indexOfRefraction=0.98;this.invertRefractionY=!0;this.useGlossinessFromSpecularMapAlpha=this.useLightmapAsShadowmap=!1;this.maxSimultaneousLights=4;this.invertNormalMapY=this.invertNormalMapX=!1;this._renderTargets=new b.SmartArray(16);this._worldViewProjectionMatrix=b.Matrix.Zero();this._globalAmbientColor=new b.Color3(0,0,0);this._defines=new g();this._cachedDefines=new g();this._cachedDefines.BonesPerMesh=-1;this.getRenderTargetTextures=function(){y4tt.v9();return e._renderTargets.reset(),e.reflectionTexture&&e.reflectionTexture.isRenderTarget&&e._renderTargets.push(e.reflectionTexture),e.refractionTexture&&e.refractionTexture.isRenderTarget&&e._renderTargets.push(e.refractionTexture),e._renderTargets;};},c=(__extends(f,d),Object.defineProperty(f.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth;},set:function(b){this._useLogarithmicDepth=b&&this.getScene().getEngine().getCaps().fragmentDepthSupported;},enumerable:!0,configurable:!0}),f.prototype.needAlphaBlending=function(){y4tt.v9();return 1>this.alpha||null!=this.opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled;},f.prototype.needAlphaTesting=function(){y4tt.q9();return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha;},f.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha&&this.useAlphaFromDiffuseTexture;},f.prototype.getAlphaTestTexture=function(){y4tt.q9();return this.diffuseTexture;},f.prototype._checkCache=function(b,c,d){return c?this._defines.INSTANCES!==d?!1:!(!c._materialDefines||!c._materialDefines.isEqual(this._defines)):!0;},f.prototype.isReady=function(c,d){var e,n,m,p,r,s,t;if(this.isFrozen&&this._wasPreviouslyReady)return!0;e=this.getScene();if(!this.checkReadyOnEveryCall&&this._renderId===e.getRenderId()&&this._checkCache(e,c,d))return!0;n=e.getEngine(),m=!1,p=!1;if(this._defines.reset(),e.texturesEnabled){if(this.diffuseTexture&&f.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;p=!0;this._defines.DIFFUSE=!0;}if(this.ambientTexture&&f.AmbientTextureEnabled){if(!this.ambientTexture.isReady())return!1;p=!0;this._defines.AMBIENT=!0;}if(this.opacityTexture&&f.OpacityTextureEnabled){if(!this.opacityTexture.isReady())return!1;p=!0;this._defines.OPACITY=!0;this.opacityTexture.getAlphaFromRGB&&(this._defines.OPACITYRGB=!0);}if(this.reflectionTexture&&f.ReflectionTextureEnabled){if(!this.reflectionTexture.isReady())return!1;switch(m=!0,this._defines.REFLECTION=!0,0<this.roughness&&(this._defines.ROUGHNESS=!0),this.useReflectionOverAlpha&&(this._defines.REFLECTIONOVERALPHA=!0),this.reflectionTexture.coordinatesMode===b.Texture.INVCUBIC_MODE&&(this._defines.INVERTCUBICMAP=!0),this._defines.REFLECTIONMAP_3D=this.reflectionTexture.isCube,this.reflectionTexture.coordinatesMode){case b.Texture.CUBIC_MODE:case b.Texture.INVCUBIC_MODE:this._defines.REFLECTIONMAP_CUBIC=!0;break;case b.Texture.EXPLICIT_MODE:this._defines.REFLECTIONMAP_EXPLICIT=!0;break;case b.Texture.PLANAR_MODE:this._defines.REFLECTIONMAP_PLANAR=!0;break;case b.Texture.PROJECTION_MODE:this._defines.REFLECTIONMAP_PROJECTION=!0;break;case b.Texture.SKYBOX_MODE:this._defines.REFLECTIONMAP_SKYBOX=!0;break;case b.Texture.SPHERICAL_MODE:this._defines.REFLECTIONMAP_SPHERICAL=!0;break;case b.Texture.EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case b.Texture.FIXED_EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;}}if(this.emissiveTexture&&f.EmissiveTextureEnabled){if(!this.emissiveTexture.isReady())return!1;p=!0;this._defines.EMISSIVE=!0;}if(this.lightmapTexture&&f.LightmapTextureEnabled){if(!this.lightmapTexture.isReady())return!1;p=!0;this._defines.LIGHTMAP=!0;this._defines.USELIGHTMAPASSHADOWMAP=this.useLightmapAsShadowmap;}if(this.specularTexture&&f.SpecularTextureEnabled){if(!this.specularTexture.isReady())return!1;p=!0;this._defines.SPECULAR=!0;this._defines.GLOSSINESS=this.useGlossinessFromSpecularMapAlpha;}if(e.getEngine().getCaps().standardDerivatives&&this.bumpTexture&&f.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;p=!0;this._defines.BUMP=!0;this.useParallax&&(this._defines.PARALLAX=!0,this.useParallaxOcclusion&&(this._defines.PARALLAXOCCLUSION=!0));this.invertNormalMapX&&(this._defines.INVERTNORMALMAPX=!0);this.invertNormalMapY&&(this._defines.INVERTNORMALMAPY=!0);}if(this.refractionTexture&&f.RefractionTextureEnabled){if(!this.refractionTexture.isReady())return!1;p=!0;this._defines.REFRACTION=!0;this._defines.REFRACTIONMAP_3D=this.refractionTexture.isCube;}}if(e.clipPlane&&(this._defines.CLIPPLANE=!0),n.getAlphaTesting()&&(this._defines.ALPHATEST=!0),this._shouldUseAlphaFromDiffuseTexture()&&(this._defines.ALPHAFROMDIFFUSE=!0),this.useEmissiveAsIllumination&&(this._defines.EMISSIVEASILLUMINATION=!0),this.linkEmissiveWithDiffuse&&(this._defines.LINKEMISSIVEWITHDIFFUSE=!0),this.useLogarithmicDepth&&(this._defines.LOGARITHMICDEPTH=!0),(this.pointsCloud||e.forcePointsCloud)&&(this._defines.POINTSIZE=!0),e.fogEnabled&&c&&c.applyFog&&e.fogMode!==b.Scene.FOGMODE_NONE&&this.fogEnabled&&(this._defines.FOG=!0),e.lightsEnabled&&!this.disableLighting&&(m=b.MaterialHelper.PrepareDefinesForLights(e,c,this._defines,this.maxSimultaneousLights)),f.FresnelEnabled&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled||this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled||this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled||this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled)&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._defines.DIFFUSEFRESNEL=!0),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&(this._defines.OPACITYFRESNEL=!0),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._defines.REFLECTIONFRESNEL=!0,this.useReflectionFresnelFromSpecular&&(this._defines.REFLECTIONFRESNELFROMSPECULAR=!0)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(this._defines.REFRACTIONFRESNEL=!0),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._defines.EMISSIVEFRESNEL=!0),m=!0,this._defines.FRESNEL=!0),this._defines.SPECULARTERM&&this.useSpecularOverAlpha&&(this._defines.SPECULAROVERALPHA=!0),c&&(m&&c.isVerticesDataPresent(b.VertexBuffer.NormalKind)&&(this._defines.NORMAL=!0),p&&(c.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(this._defines.UV1=!0),c.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(this._defines.UV2=!0)),c.useVertexColors&&c.isVerticesDataPresent(b.VertexBuffer.ColorKind)&&(this._defines.VERTEXCOLOR=!0,c.hasVertexAlpha&&(this._defines.VERTEXALPHA=!0)),c.useBones&&c.computeBonesUsingShaders&&(this._defines.NUM_BONE_INFLUENCERS=c.numBoneInfluencers,this._defines.BonesPerMesh=c.skeleton.bones.length+1),d&&(this._defines.INSTANCES=!0)),!this._defines.isEqual(this._cachedDefines)){this._defines.cloneTo(this._cachedDefines);e.resetCachedMaterial();n=new b.EffectFallbacks();this._defines.REFLECTION&&n.addFallback(0,"REFLECTION");this._defines.SPECULAR&&n.addFallback(0,"SPECULAR");this._defines.BUMP&&n.addFallback(0,"BUMP");this._defines.PARALLAX&&n.addFallback(1,"PARALLAX");this._defines.PARALLAXOCCLUSION&&n.addFallback(0,"PARALLAXOCCLUSION");this._defines.SPECULAROVERALPHA&&n.addFallback(0,"SPECULAROVERALPHA");this._defines.FOG&&n.addFallback(1,"FOG");this._defines.POINTSIZE&&n.addFallback(0,"POINTSIZE");this._defines.LOGARITHMICDEPTH&&n.addFallback(0,"LOGARITHMICDEPTH");b.MaterialHelper.HandleFallbacksForShadows(this._defines,n,this.maxSimultaneousLights);this._defines.SPECULARTERM&&n.addFallback(0,"SPECULARTERM");this._defines.DIFFUSEFRESNEL&&n.addFallback(1,"DIFFUSEFRESNEL");this._defines.OPACITYFRESNEL&&n.addFallback(2,"OPACITYFRESNEL");this._defines.REFLECTIONFRESNEL&&n.addFallback(3,"REFLECTIONFRESNEL");this._defines.EMISSIVEFRESNEL&&n.addFallback(4,"EMISSIVEFRESNEL");this._defines.FRESNEL&&n.addFallback(4,"FRESNEL");m=[b.VertexBuffer.PositionKind];this._defines.NORMAL&&m.push(b.VertexBuffer.NormalKind);this._defines.UV1&&m.push(b.VertexBuffer.UVKind);this._defines.UV2&&m.push(b.VertexBuffer.UV2Kind);this._defines.VERTEXCOLOR&&m.push(b.VertexBuffer.ColorKind);b.MaterialHelper.PrepareAttributesForBones(m,c,this._defines,n);b.MaterialHelper.PrepareAttributesForInstances(m,this._defines);p="default";e.getEngine().getCaps().standardDerivatives||(p="legacydefault");r=this._defines.toString(),s="world view viewProjection vEyePosition vLightsType vAmbientColor vDiffuseColor vSpecularColor vEmissiveColor vFogInfos vFogColor pointSize vDiffuseInfos vAmbientInfos vOpacityInfos vReflectionInfos vEmissiveInfos vSpecularInfos vBumpInfos vLightmapInfos vRefractionInfos mBones vClipPlane diffuseMatrix ambientMatrix opacityMatrix reflectionMatrix emissiveMatrix specularMatrix bumpMatrix lightmapMatrix refractionMatrix depthValues diffuseLeftColor diffuseRightColor opacityParts reflectionLeftColor reflectionRightColor emissiveLeftColor emissiveRightColor refractionLeftColor refractionRightColor logarithmicDepthConstant".split(" "),t="diffuseSampler ambientSampler opacitySampler reflectionCubeSampler reflection2DSampler emissiveSampler specularSampler bumpSampler lightmapSampler refractionCubeSampler refraction2DSampler".split(" ");b.MaterialHelper.PrepareUniformsAndSamplersList(s,t,this._defines,this.maxSimultaneousLights);this._effect=e.getEngine().createEffect(p,m,s,t,r,n,this.onCompiled,this.onError,{maxSimultaneousLights:this.maxSimultaneousLights-1});}return this._effect.isReady()?(this._renderId=e.getRenderId(),this._wasPreviouslyReady=!0,c&&(c._materialDefines||(c._materialDefines=new g()),this._defines.cloneTo(c._materialDefines)),!0):!1;},f.prototype.unbind=function(){this.reflectionTexture&&this.reflectionTexture.isRenderTarget&&this._effect.setTexture("reflection2DSampler",null);this.refractionTexture&&this.refractionTexture.isRenderTarget&&this._effect.setTexture("refraction2DSampler",null);d.prototype.unbind.call(this);},f.prototype.bindOnlyWorldMatrix=function(b){y4tt.q9();this._effect.setMatrix("world",b);},f.prototype.bind=function(c,e){var l,g;y4tt.v9();l=this.getScene();if(this.bindOnlyWorldMatrix(c),b.MaterialHelper.BindBonesParameters(e,this._effect),l.getCachedMaterial()!==this){if(this._effect.setMatrix("viewProjection",l.getTransformMatrix()),f.FresnelEnabled&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._effect.setColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),this._effect.setColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._effect.setColor4("opacityParts",new b.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._effect.setColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),this._effect.setColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(this._effect.setColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),this._effect.setColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._effect.setColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._effect.setColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),l.texturesEnabled&&(this.diffuseTexture&&f.DiffuseTextureEnabled&&(this._effect.setTexture("diffuseSampler",this.diffuseTexture),this._effect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._effect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),this.ambientTexture&&f.AmbientTextureEnabled&&(this._effect.setTexture("ambientSampler",this.ambientTexture),this._effect.setFloat2("vAmbientInfos",this.ambientTexture.coordinatesIndex,this.ambientTexture.level),this._effect.setMatrix("ambientMatrix",this.ambientTexture.getTextureMatrix())),this.opacityTexture&&f.OpacityTextureEnabled&&(this._effect.setTexture("opacitySampler",this.opacityTexture),this._effect.setFloat2("vOpacityInfos",this.opacityTexture.coordinatesIndex,this.opacityTexture.level),this._effect.setMatrix("opacityMatrix",this.opacityTexture.getTextureMatrix())),this.reflectionTexture&&f.ReflectionTextureEnabled&&(this.reflectionTexture.isCube?this._effect.setTexture("reflectionCubeSampler",this.reflectionTexture):this._effect.setTexture("reflection2DSampler",this.reflectionTexture),this._effect.setMatrix("reflectionMatrix",this.reflectionTexture.getReflectionTextureMatrix()),this._effect.setFloat2("vReflectionInfos",this.reflectionTexture.level,this.roughness)),this.emissiveTexture&&f.EmissiveTextureEnabled&&(this._effect.setTexture("emissiveSampler",this.emissiveTexture),this._effect.setFloat2("vEmissiveInfos",this.emissiveTexture.coordinatesIndex,this.emissiveTexture.level),this._effect.setMatrix("emissiveMatrix",this.emissiveTexture.getTextureMatrix())),this.lightmapTexture&&f.LightmapTextureEnabled&&(this._effect.setTexture("lightmapSampler",this.lightmapTexture),this._effect.setFloat2("vLightmapInfos",this.lightmapTexture.coordinatesIndex,this.lightmapTexture.level),this._effect.setMatrix("lightmapMatrix",this.lightmapTexture.getTextureMatrix())),this.specularTexture&&f.SpecularTextureEnabled&&(this._effect.setTexture("specularSampler",this.specularTexture),this._effect.setFloat2("vSpecularInfos",this.specularTexture.coordinatesIndex,this.specularTexture.level),this._effect.setMatrix("specularMatrix",this.specularTexture.getTextureMatrix())),this.bumpTexture&&l.getEngine().getCaps().standardDerivatives&&f.BumpTextureEnabled&&(this._effect.setTexture("bumpSampler",this.bumpTexture),this._effect.setFloat3("vBumpInfos",this.bumpTexture.coordinatesIndex,1/this.bumpTexture.level,this.parallaxScaleBias),this._effect.setMatrix("bumpMatrix",this.bumpTexture.getTextureMatrix())),this.refractionTexture&&f.RefractionTextureEnabled)){g=1;this.refractionTexture.isCube?this._effect.setTexture("refractionCubeSampler",this.refractionTexture):(this._effect.setTexture("refraction2DSampler",this.refractionTexture),this._effect.setMatrix("refractionMatrix",this.refractionTexture.getReflectionTextureMatrix()),this.refractionTexture.depth&&(g=this.refractionTexture.depth));this._effect.setFloat4("vRefractionInfos",this.refractionTexture.level,this.indexOfRefraction,g,this.invertRefractionY?-1:1);}b.MaterialHelper.BindClipPlane(this._effect,l);this.pointsCloud&&this._effect.setFloat("pointSize",this.pointSize);l.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor);this._effect.setVector3("vEyePosition",l._mirroredCameraPosition?l._mirroredCameraPosition:l.activeCamera.position);this._effect.setColor3("vAmbientColor",this._globalAmbientColor);this._defines.SPECULARTERM&&this._effect.setColor4("vSpecularColor",this.specularColor,this.specularPower);this._effect.setColor3("vEmissiveColor",this.emissiveColor);}l.getCachedMaterial()===this&&this.isFrozen||(this._effect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),l.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(l,e,this._effect,this._defines,this.maxSimultaneousLights),(l.fogEnabled&&e.applyFog&&l.fogMode!==b.Scene.FOGMODE_NONE||this.reflectionTexture||this.refractionTexture)&&this._effect.setMatrix("view",l.getViewMatrix()),b.MaterialHelper.BindFogParameters(l,e,this._effect),b.MaterialHelper.BindLogDepth(this._defines,this._effect,l));d.prototype.bind.call(this,c,e);},f.prototype.getAnimatables=function(){var b;b=[];y4tt.v9();return this.diffuseTexture&&this.diffuseTexture.animations&&0<this.diffuseTexture.animations.length&&b.push(this.diffuseTexture),this.ambientTexture&&this.ambientTexture.animations&&0<this.ambientTexture.animations.length&&b.push(this.ambientTexture),this.opacityTexture&&this.opacityTexture.animations&&0<this.opacityTexture.animations.length&&b.push(this.opacityTexture),this.reflectionTexture&&this.reflectionTexture.animations&&0<this.reflectionTexture.animations.length&&b.push(this.reflectionTexture),this.emissiveTexture&&this.emissiveTexture.animations&&0<this.emissiveTexture.animations.length&&b.push(this.emissiveTexture),this.specularTexture&&this.specularTexture.animations&&0<this.specularTexture.animations.length&&b.push(this.specularTexture),this.bumpTexture&&this.bumpTexture.animations&&0<this.bumpTexture.animations.length&&b.push(this.bumpTexture),this.lightmapTexture&&this.lightmapTexture.animations&&0<this.lightmapTexture.animations.length&&b.push(this.lightmapTexture),this.refractionTexture&&this.refractionTexture.animations&&0<this.refractionTexture.animations.length&&b.push(this.refractionTexture),b;},f.prototype.dispose=function(b,c){c&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.ambientTexture&&this.ambientTexture.dispose(),this.opacityTexture&&this.opacityTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose(),this.emissiveTexture&&this.emissiveTexture.dispose(),this.specularTexture&&this.specularTexture.dispose(),this.bumpTexture&&this.bumpTexture.dispose(),this.lightmapTexture&&this.lightmapTexture.dispose(),this.refractionTexture&&this.refractionTexture.dispose());d.prototype.dispose.call(this,b,c);},f.prototype.clone=function(c){var d;d=this;return b.SerializationHelper.Clone(function(){return new f(c,d.getScene());},this);},f.prototype.serialize=function(){y4tt.q9();return b.SerializationHelper.Serialize(this);},f.Parse=function(c,d,e){return b.SerializationHelper.Parse(function(){y4tt.q9();return new f(c.name,d);},c,d,e);},f.DiffuseTextureEnabled=!0,f.AmbientTextureEnabled=!0,f.OpacityTextureEnabled=!0,f.ReflectionTextureEnabled=!0,f.EmissiveTextureEnabled=!0,f.SpecularTextureEnabled=!0,f.BumpTextureEnabled=!0,f.FresnelEnabled=!0,f.LightmapTextureEnabled=!0,f.RefractionTextureEnabled=!0,__decorate([b.serializeAsTexture()],f.prototype,"diffuseTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"ambientTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"opacityTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"reflectionTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"emissiveTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"specularTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"bumpTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"lightmapTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"refractionTexture",void 0),__decorate([b.serializeAsColor3("ambient")],f.prototype,"ambientColor",void 0),__decorate([b.serializeAsColor3("diffuse")],f.prototype,"diffuseColor",void 0),__decorate([b.serializeAsColor3("specular")],f.prototype,"specularColor",void 0),__decorate([b.serializeAsColor3("emissive")],f.prototype,"emissiveColor",void 0),__decorate([b.serialize()],f.prototype,"specularPower",void 0),__decorate([b.serialize()],f.prototype,"useAlphaFromDiffuseTexture",void 0),__decorate([b.serialize()],f.prototype,"useEmissiveAsIllumination",void 0),__decorate([b.serialize()],f.prototype,"linkEmissiveWithDiffuse",void 0),__decorate([b.serialize()],f.prototype,"useReflectionFresnelFromSpecular",void 0),__decorate([b.serialize()],f.prototype,"useSpecularOverAlpha",void 0),__decorate([b.serialize()],f.prototype,"useReflectionOverAlpha",void 0),__decorate([b.serialize()],f.prototype,"disableLighting",void 0),__decorate([b.serialize()],f.prototype,"useParallax",void 0),__decorate([b.serialize()],f.prototype,"useParallaxOcclusion",void 0),__decorate([b.serialize()],f.prototype,"parallaxScaleBias",void 0),__decorate([b.serialize()],f.prototype,"roughness",void 0),__decorate([b.serialize()],f.prototype,"indexOfRefraction",void 0),__decorate([b.serialize()],f.prototype,"invertRefractionY",void 0),__decorate([b.serialize()],f.prototype,"useLightmapAsShadowmap",void 0),__decorate([b.serializeAsFresnelParameters()],f.prototype,"diffuseFresnelParameters",void 0),__decorate([b.serializeAsFresnelParameters()],f.prototype,"opacityFresnelParameters",void 0),__decorate([b.serializeAsFresnelParameters()],f.prototype,"reflectionFresnelParameters",void 0),__decorate([b.serializeAsFresnelParameters()],f.prototype,"refractionFresnelParameters",void 0),__decorate([b.serializeAsFresnelParameters()],f.prototype,"emissiveFresnelParameters",void 0),__decorate([b.serialize()],f.prototype,"useGlossinessFromSpecularMapAlpha",void 0),__decorate([b.serialize()],f.prototype,"maxSimultaneousLights",void 0),__decorate([b.serialize()],f.prototype,"invertNormalMapX",void 0),__decorate([b.serialize()],f.prototype,"invertNormalMapY",void 0),__decorate([b.serialize()],f.prototype,"useLogarithmicDepth",null),f);b.StandardMaterial=c;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.Material,c=function(b,c){e.call(this,b,c,!0);this.subMaterials=[];y4tt.q9();c.multiMaterials.push(this);};g=(__extends(c,e),c.prototype.getSubMaterial=function(b){return 0>b||b>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[b];},c.prototype.isReady=function(b){for(var c=0;c<this.subMaterials.length;c++)if(this.subMaterials[c]&&!this.subMaterials[c].isReady(b))return!1;return!0;},c.prototype.clone=function(b,f){var l;y4tt.q9();for(var e=new c(b,this.getScene()),j=0;j<this.subMaterials.length;j++){l=null,l=f?this.subMaterials[j].clone(b+"-"+this.subMaterials[j].name):this.subMaterials[j];e.subMaterials.push(l);}return e;},c.prototype.serialize=function(){var c,e;c={};c.name=this.name;c.id=this.id;c.tags=b.Tags.GetTags(this);c.materials=[];for(var f=0;f<this.subMaterials.length;f++){e=this.subMaterials[f];e?c.materials.push(e.id):c.materials.push(null);}return c;},c);b.MultiMaterial=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(){};g=(Object.defineProperty(e,"NO_LOGGING",{get:function(){return 0;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MINIMAL_LOGGING",{get:function(){y4tt.v9();return 1;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SUMMARY_LOGGING",{get:function(){y4tt.v9();return 2;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DETAILED_LOGGING",{get:function(){return 3;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return e._ForceFullSceneLoadingForIncremental;},set:function(b){y4tt.v9();e._ForceFullSceneLoadingForIncremental=b;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return e._ShowLoadingScreen;},set:function(b){y4tt.v9();e._ShowLoadingScreen=b;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return e._loggingLevel;},set:function(b){y4tt.v9();e._loggingLevel=b;},enumerable:!0,configurable:!0}),e._getPluginForFilename=function(b){var d,f;y4tt.q9();d=b.lastIndexOf("."),f=b.indexOf("?");-1===f&&(f=b.length);b=b.substring(d,f).toLowerCase();for(d=0;d<this._registeredPlugins.length;d++)if(f=this._registeredPlugins[d],-1!==f.extensions.indexOf(b))return f;return this._registeredPlugins[0];},e.GetPluginForExtension=function(b){var f;for(var d=0;d<this._registeredPlugins.length;d++){f=this._registeredPlugins[d];if(-1!==f.extensions.indexOf(b))return f;}y4tt.q9();return null;},e.RegisterPlugin=function(b){b.extensions=b.extensions.toLowerCase();y4tt.q9();e._registeredPlugins.push(b);},e.ImportMesh=function(c,d,f,g,j,l,n){var m,p,r;if(f.substr&&"/"===f.substr(0,1)||f.substr&&"/"===f.substr(0,1))return void b.Tools.Error("Wrong sceneFilename parameter");m={};g._addPendingData(m);y4tt.v9();p=function(){var p,t;g.database=r;p=e._getPluginForFilename(f),t=function(b){var e,l,r;e=[],l=[],r=[];try{if(p.importMesh){if(!p.importMesh(c,g,b,d,e,l,r))return n&&n(g,"Unable to import meshes from "+d+f),void g._removePendingData(m);j&&(g.importedMeshesFiles.push(d+f),j(e,l,r),g._removePendingData(m));}else p.importMeshAsync(c,g,b,d,function(b,c,e){y4tt.q9();j&&(g.importedMeshesFiles.push(d+f),j(b,c,e),g._removePendingData(m));},function(){n&&n(g,"Unable to import meshes from "+d+f);y4tt.v9();g._removePendingData(m);});}catch(t){n&&n(g,"Unable to import meshes from "+d+f,t),g._removePendingData(m);}};return f.substr&&"data:"===f.substr(0,5)?void t(f.substr(5)):void b.Tools.LoadFile(d+f,function(b){t(b);},l,r);};if(!g.getEngine().enableOfflineSupport||f.substr&&"data:"===f.substr(0,5))p(!0);else r=new b.Database(d+f,p);},e.Load=function(c,d,f,g,j,l){e.Append(c,d,new b.Scene(f),g,j,l);},e.Append=function(c,d,f,g,j,l){var n,m,p,r,s;if(d.substr&&"/"===d.substr(0,1))return void b.Tools.Error("Wrong sceneFilename parameter");m=this._getPluginForFilename(d.name||d),p={};f._addPendingData(p);e.ShowLoadingScreen&&f.getEngine().displayLoadingUI();r=function(b){if(f.database=n,m.load){if(!m.load(f,b,c))return l&&l(f),f._removePendingData(p),void f.getEngine().hideLoadingUI();g&&g(f);f._removePendingData(p);}else m.loadAsync(f,b,c,function(){y4tt.v9();g&&g(f);},function(){l&&l(f);f._removePendingData(p);f.getEngine().hideLoadingUI();});e.ShowLoadingScreen&&f.executeWhenReady(function(){f.getEngine().hideLoadingUI();});},s=function(){y4tt.v9();b.Tools.LoadFile(c+d,r,j,n);};return d.substr&&"data:"===d.substr(0,5)?void r(d.substr(5)):void(-1===c.indexOf("file:")?f.getEngine().enableOfflineSupport?n=new b.Database(c+d,s):s(!0):b.Tools.ReadFile(d,r,j));},e._ForceFullSceneLoadingForIncremental=!1,e._ShowLoadingScreen=!0,e._loggingLevel=e.NO_LOGGING,e._registeredPlugins=[],e);b.SceneLoader=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;y4tt.q9();b.Internals||(b.Internals={});g=function(c,d,f,e){var g;y4tt.q9();for(var j=0,l=d.materials.length;l>j;j++){g=d.materials[j];if(g.id===c)return b.Material.Parse(g,f,e);}return null;},e=function(b,d){return b+" of "+(d?d.file+" from "+d.name+" version: "+d.version+", exporter version: "+d.exporter_version:"unknown");};b.SceneLoader.RegisterPlugin({extensions:".babylon",importMesh:function(c,d,f,q,j,l,n){var m,p,r,s,t,v,y,x,z,B,A,C,G,D,H,F,E,L,N,M,I,Q,K,R;m="importMesh has failed JSON parse";try{p=JSON.parse(f),m="",t=b.SceneLoader.loggingLevel===b.SceneLoader.DETAILED_LOGGING;f=[];v=[],y=[];r=0;for(s=p.meshes.length;s>r;r++){x=p.meshes[r];if(!(z=!c))a:{B=x,A=c,C=y,A=A instanceof Array?A:[A],G=void 0;for(G in A)if(B.name===A[G]){z=(C.push(B.id),!0);break a;}z=B.parentId&&-1!==C.indexOf(B.parentId)?(C.push(B.id),!0):!1;}if(z){if(c instanceof Array&&delete c[c.indexOf(x.name)],x.geometryId&&p.geometries){D=!1;"boxes spheres cylinders toruses grounds planes torusKnots vertexData".split(" ").forEach(function(c){y4tt.v9();!D&&p.geometries[c]&&p.geometries[c]instanceof Array&&p.geometries[c].forEach(function(f){y4tt.v9();if(f.id===x.geometryId){switch(c){case"boxes":b.Geometry.Primitives.Box.Parse(f,d);break;case"spheres":b.Geometry.Primitives.Sphere.Parse(f,d);break;case"cylinders":b.Geometry.Primitives.Cylinder.Parse(f,d);break;case"toruses":b.Geometry.Primitives.Torus.Parse(f,d);break;case"grounds":b.Geometry.Primitives.Ground.Parse(f,d);break;case"planes":b.Geometry.Primitives.Plane.Parse(f,d);break;case"torusKnots":b.Geometry.Primitives.TorusKnot.Parse(f,d);break;case"vertexData":b.Geometry.Parse(f,d,q);}D=!0;}});});D||b.Tools.Warn("Geometry not found for mesh "+x.id);}if(x.materialId){H=-1!==v.indexOf(x.materialId);if(!H&&p.multiMaterials)for(var B=0,J=p.multiMaterials.length;J>B;B++){F=p.multiMaterials[B];if(F.id===x.materialId){for(var B=0,O=F.materials.length;O>B;B++){E=F.materials[B];v.push(E);L=g(E,p,d,q),m=m+("\n\tMaterial "+L.toString(t));}v.push(F.id);N=b.Material.ParseMultiMaterial(F,d),H=!0,m=m+("\n\tMulti-Material "+N.toString(t));break;}}H||(v.push(x.materialId),(L=g(x.materialId,p,d,q))?m+="\n\tMaterial "+L.toString(t):b.Tools.Warn("Material not found for mesh "+x.id));}if(-1<x.skeletonId&&d.skeletons&&!(-1<f.indexOf(x.skeletonId)))for(var B=0,P=p.skeletons.length;P>B;B++){M=p.skeletons[B];if(M.id===x.skeletonId){I=b.Skeleton.Parse(M,d);n.push(I);f.push(M.id);m+="\n\tSkeleton "+I.toString(t);}}Q=b.Mesh.Parse(x,d,q);j.push(Q);m+="\n\tMesh "+Q.toString(t);}}r=0;for(s=d.meshes.length;s>r;r++)K=d.meshes[r],K._waitingParentId&&(K.parent=d.getLastEntryByID(K._waitingParentId),K._waitingParentId=void 0);r=0;for(s=d.meshes.length;s>r;r++)K=d.meshes[r],K._waitingFreezeWorldMatrix?(K.freezeWorldMatrix(),K._waitingFreezeWorldMatrix=void 0):K.computeWorldMatrix(!0);if(p.particleSystems){r=0;for(s=p.particleSystems.length;s>r;r++){R=p.particleSystems[r];-1!==y.indexOf(R.emitterId)&&l.push(b.ParticleSystem.Parse(R,d,q));}}return!0;}catch(Z){throw b.Tools.Log(e("importMesh",p.producer)+m),m=null,Z;}finally{null!==m&&b.SceneLoader.loggingLevel!==b.SceneLoader.NO_LOGGING&&b.Tools.Log(e("importMesh",p.producer)+(b.SceneLoader.loggingLevel!==b.SceneLoader.MINIMAL_LOGGING?m:""));}},load:function(c,d,f){var g,j,l,n,m,p,r,t,z,B,A,C,G,D,H,J,F,L,N,P;y4tt.v9();g="importScene has failed JSON parse";try{j=JSON.parse(d),g="",l=b.SceneLoader.loggingLevel===b.SceneLoader.DETAILED_LOGGING;if(c.useDelayedTextureLoading=j.useDelayedTextureLoading&&!b.SceneLoader.ForceFullSceneLoadingForIncremental,c.autoClear=j.autoClear,c.clearColor=b.Color4.FromArray(j.clearColor),c.ambientColor=b.Color3.FromArray(j.ambientColor),j.gravity&&(c.gravity=b.Vector3.FromArray(j.gravity)),j.fogMode&&0!==j.fogMode)switch(c.fogMode=j.fogMode,c.fogColor=b.Color3.FromArray(j.fogColor),c.fogStart=j.fogStart,c.fogEnd=j.fogEnd,c.fogDensity=j.fogDensity,g+="\tFog mode for scene:  ",c.fogMode){case 1:g+="exp\n";break;case 2:g+="exp2\n";break;case 3:g+="linear\n";}if(j.physicsEnabled){"cannon"===j.physicsEngine?n=new b.CannonJSPlugin():"oimo"===j.physicsEngine&&(n=new b.OimoJSPlugin());g="\tPhysics engine "+(j.physicsEngine?j.physicsEngine:"oimo")+" enabled\n",m=j.physicsGravity?b.Vector3.FromArray(j.physicsGravity):null;c.enablePhysics(m,n);}void 0!=j.collisionsEnabled&&(c.collisionsEnabled=j.collisionsEnabled);c.workerCollisions=!!j.workerCollisions;p=0;for(r=j.lights.length;r>p;p++)var s=b.Light.Parse(j.lights[p],c),g=g+(0===p?"\n\tLights:":""),g=g+("\n\t\t"+s.toString(l));if(j.animations){p=0;for(r=j.animations.length;r>p;p++){t=b.Animation.Parse(j.animations[p]);c.animations.push(t);g+=0===p?"\n\tAnimations:":"";g+="\n\t\t"+t.toString(l);}}if(j.autoAnimate&&c.beginAnimation(c,j.autoAnimateFrom,j.autoAnimateTo,j.autoAnimateLoop,j.autoAnimateSpeed||1),j.materials){p=0;for(r=j.materials.length;r>p;p++)var v=b.Material.Parse(j.materials[p],c,f),g=g+(0===p?"\n\tMaterials:":""),g=g+("\n\t\t"+v.toString(l));}if(j.multiMaterials){p=0;for(r=j.multiMaterials.length;r>p;p++)var y=b.Material.ParseMultiMaterial(j.multiMaterials[p],c),g=g+(0===p?"\n\tMultiMaterials:":""),g=g+("\n\t\t"+y.toString(l));}if(j.skeletons){p=0;for(r=j.skeletons.length;r>p;p++)var x=b.Skeleton.Parse(j.skeletons[p],c),g=g+(0===p?"\n\tSkeletons:":""),g=g+("\n\t\t"+x.toString(l));}z=j.geometries;if(z){B=z.boxes;if(B){p=0;for(r=B.length;r>p;p++)b.Geometry.Primitives.Box.Parse(B[p],c);}A=z.spheres;if(A){p=0;for(r=A.length;r>p;p++)b.Geometry.Primitives.Sphere.Parse(A[p],c);}C=z.cylinders;if(C){p=0;for(r=C.length;r>p;p++)b.Geometry.Primitives.Cylinder.Parse(C[p],c);}G=z.toruses;if(G){p=0;for(r=G.length;r>p;p++)b.Geometry.Primitives.Torus.Parse(G[p],c);}D=z.grounds;if(D){p=0;for(r=D.length;r>p;p++)b.Geometry.Primitives.Ground.Parse(D[p],c);}H=z.planes;if(H){p=0;for(r=H.length;r>p;p++)b.Geometry.Primitives.Plane.Parse(H[p],c);}J=z.torusKnots;if(J){p=0;for(r=J.length;r>p;p++)b.Geometry.Primitives.TorusKnot.Parse(J[p],c);}F=z.vertexData;if(F){p=0;for(r=F.length;r>p;p++)b.Geometry.Parse(F[p],c,f);}}p=0;for(r=j.meshes.length;r>p;p++)var O=b.Mesh.Parse(j.meshes[p],c,f),g=g+(0===p?"\n\tMeshes:":""),g=g+("\n\t\t"+O.toString(l));p=0;for(r=j.cameras.length;r>p;p++)var E=b.Camera.Parse(j.cameras[p],c),g=g+(0===p?"\n\tCameras:":""),g=g+("\n\t\t"+E.toString(l));j.activeCameraID&&c.setActiveCameraByID(j.activeCameraID);p=0;for(r=c.cameras.length;r>p;p++)E=c.cameras[p],E._waitingParentId&&(E.parent=c.getLastEntryByID(E._waitingParentId),E._waitingParentId=void 0);p=0;for(r=c.lights.length;r>p;p++)s=c.lights[p],s._waitingParentId&&(s.parent=c.getLastEntryByID(s._waitingParentId),s._waitingParentId=void 0);d=[];if(b.AudioEngine&&j.sounds){p=0;for(r=j.sounds.length;r>p;p++){N=j.sounds[p];b.Engine.audioEngine.canUseWebAudio?(N.url||(N.url=N.name),d[N.url]?b.Sound.Parse(N,c,f,d[N.url]):(L=b.Sound.Parse(N,c,f),d[N.url]=L)):new b.Sound(N.name,null,c);}}p=0;for(r=c.meshes.length;r>p;p++)O=c.meshes[p],O._waitingParentId&&(O.parent=c.getLastEntryByID(O._waitingParentId),O._waitingParentId=void 0),O._waitingActions&&(b.ActionManager.Parse(O._waitingActions,O,c),O._waitingActions=void 0);p=0;for(r=c.meshes.length;r>p;p++){P=c.meshes[p];P._waitingFreezeWorldMatrix?(P.freezeWorldMatrix(),P._waitingFreezeWorldMatrix=void 0):P.computeWorldMatrix(!0);}if(j.particleSystems){p=0;for(r=j.particleSystems.length;r>p;p++)b.ParticleSystem.Parse(j.particleSystems[p],c,f);}if(j.lensFlareSystems){p=0;for(r=j.lensFlareSystems.length;r>p;p++)b.LensFlareSystem.Parse(j.lensFlareSystems[p],c,f);}if(j.shadowGenerators){p=0;for(r=j.shadowGenerators.length;r>p;p++)b.ShadowGenerator.Parse(j.shadowGenerators[p],c);}return j.actions&&b.ActionManager.Parse(j.actions,null,c),!0;}catch(M){throw b.Tools.Log(e("importScene",j.producer)+g),M;}finally{null!==g&&b.SceneLoader.loggingLevel!==b.SceneLoader.NO_LOGGING&&b.Tools.Log(e("importScene",j.producer)+(b.SceneLoader.loggingLevel!==b.SceneLoader.MINIMAL_LOGGING?g:""));}}});!0;}(BABYLON||(BABYLON={}));!function(b){var g;y4tt.v9();g=function(e,c,d,f,g,j,l){void 0===l&&(l=b.Texture.TRILINEAR_SAMPLINGMODE);this.name=e;this.cellSize=f;this.sprites=[];this.renderingGroupId=0;this.layerMask=268435455;this.fogEnabled=!0;this.isPickable=!1;this.onDisposeObservable=new b.Observable();this._vertexBuffers={};this._capacity=d;this._spriteTexture=new b.Texture(c,g,!0,!1,l);this._spriteTexture.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._spriteTexture.wrapV=b.Texture.CLAMP_ADDRESSMODE;this._epsilon=void 0===j?0.01:j;this._scene=g;this._scene.spriteManagers.push(this);e=[];for(f=c=0;d>f;f++)e.push(c),e.push(c+1),e.push(c+2),e.push(c),e.push(c+2),e.push(c+3),c+=4;this._indexBuffer=g.getEngine().createIndexBuffer(e);this._vertexData=new Float32Array(64*d);this._buffer=new b.Buffer(g.getEngine(),this._vertexData,!0,16);d=this._buffer.createVertexBuffer(b.VertexBuffer.PositionKind,0,4);g=this._buffer.createVertexBuffer("options",4,4);e=this._buffer.createVertexBuffer("cellInfo",8,4);c=this._buffer.createVertexBuffer(b.VertexBuffer.ColorKind,12,4);this._vertexBuffers[b.VertexBuffer.PositionKind]=d;this._vertexBuffers.options=g;this._vertexBuffers.cellInfo=e;this._vertexBuffers[b.VertexBuffer.ColorKind]=c;this._effectBase=this._scene.getEngine().createEffect("sprites",[b.VertexBuffer.PositionKind,"options","cellInfo",b.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],"");this._effectFog=this._scene.getEngine().createEffect("sprites",[b.VertexBuffer.PositionKind,"options","cellInfo",b.VertexBuffer.ColorKind],"view projection textureInfos alphaTest vFogInfos vFogColor".split(" "),["diffuseSampler"],"#define FOG");};g=(Object.defineProperty(g.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);y4tt.v9();this._onDisposeObserver=this.onDisposeObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"texture",{get:function(){y4tt.v9();return this._spriteTexture;},set:function(b){y4tt.q9();this._spriteTexture=b;},enumerable:!0,configurable:!0}),g.prototype._appendSpriteVertex=function(b,c,d,f,g){b*=16;0===d?d=this._epsilon:1===d&&(d=1-this._epsilon);0===f?f=this._epsilon:1===f&&(f=1-this._epsilon);this._vertexData[b]=c.position.x;this._vertexData[b+1]=c.position.y;this._vertexData[b+2]=c.position.z;this._vertexData[b+3]=c.angle;this._vertexData[b+4]=c.width;this._vertexData[b+5]=c.height;this._vertexData[b+6]=d;this._vertexData[b+7]=f;this._vertexData[b+8]=c.invertU?1:0;this._vertexData[b+9]=c.invertV?1:0;d=c.cellIndex/g>>0;this._vertexData[b+10]=c.cellIndex-d*g;this._vertexData[b+11]=d;this._vertexData[b+12]=c.color.r;this._vertexData[b+13]=c.color.g;this._vertexData[b+14]=c.color.b;this._vertexData[b+15]=c.color.a;},g.prototype.intersects=function(e,c,d,f){var g,j,l,n,m,p,s,t;y4tt.q9();j=Math.min(this._capacity,this.sprites.length),l=b.Vector3.Zero(),n=b.Vector3.Zero(),m=Number.MAX_VALUE,p=b.Vector3.Zero();c=c.getViewMatrix();for(var r=0;j>r;r++){s=this.sprites[r];if(s){if(d){if(!d(s))continue;}else if(!s.isPickable)continue;if(b.Vector3.TransformCoordinatesToRef(s.position,c,p),l.copyFromFloats(p.x-s.width/2,p.y-s.height/2,p.z),n.copyFromFloats(p.x+s.width/2,p.y+s.height/2,p.z),e.intersectsBoxMinMax(l,n)){t=b.Vector3.Distance(p,e.origin);if(m>t&&(m=t,g=s,f))break;}}}return g?(e=new b.PickingInfo(),e.hit=!0,e.pickedSprite=g,e.distance=m,e):null;},g.prototype.render=function(){var n;y4tt.q9();if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()){for(var e=this._scene.getEngine(),c=this._spriteTexture.getBaseSize(),d=e.getDeltaTime(),f=Math.min(this._capacity,this.sprites.length),g=c.width/this.cellSize,j=0,l=0;f>l;l++){n=this.sprites[l];n&&(n._animate(d),this._appendSpriteVertex(j++,n,0,0,g),this._appendSpriteVertex(j++,n,1,0,g),this._appendSpriteVertex(j++,n,1,1,g),this._appendSpriteVertex(j++,n,0,1,g));}this._buffer.update(this._vertexData);d=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==b.Scene.FOGMODE_NONE&&this.fogEnabled&&(d=this._effectFog);e.enableEffect(d);g=this._scene.getViewMatrix();d.setTexture("diffuseSampler",this._spriteTexture);d.setMatrix("view",g);d.setMatrix("projection",this._scene.getProjectionMatrix());d.setFloat2("textureInfos",this.cellSize/c.width,this.cellSize/c.height);this._scene.fogEnabled&&this._scene.fogMode!==b.Scene.FOGMODE_NONE&&this.fogEnabled&&(d.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),d.setColor3("vFogColor",this._scene.fogColor));e.bindBuffers(this._vertexBuffers,this._indexBuffer,d);e.setDepthFunctionToLessOrEqual();d.setBool("alphaTest",!0);e.setColorWrite(!1);e.draw(!0,0,6*f);e.setColorWrite(!0);d.setBool("alphaTest",!1);e.setAlphaMode(b.Engine.ALPHA_COMBINE);e.draw(!0,0,6*f);e.setAlphaMode(b.Engine.ALPHA_DISABLE);}},g.prototype.dispose=function(){var b;this._buffer&&(this._buffer.dispose(),this._buffer=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);b=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(b,1);this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();},g);b.SpriteManager=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(e,c){this.name=e;this.color=new b.Color4(1,1,1,1);this.height=this.width=1;this.invertV=this.invertU=this.cellIndex=this.angle=0;this.animations=[];this._loopAnimation=this._animationStarted=this.isPickable=!1;this._delay=this._toIndex=this._fromIndex=0;this._direction=1;this._time=this._frameCount=0;this._manager=c;y4tt.v9();this._manager.sprites.push(this);this.position=b.Vector3.Zero();};g=(Object.defineProperty(g.prototype,"size",{get:function(){return this.width;},set:function(b){this.height=this.width=b;},enumerable:!0,configurable:!0}),g.prototype.playAnimation=function(b,c,d,f){this._fromIndex=b;this._toIndex=c;this._loopAnimation=d;this._delay=f;this._animationStarted=!0;y4tt.q9();this._direction=c>b?1:-1;this.cellIndex=b;this._time=0;},g.prototype.stopAnimation=function(){this._animationStarted=!1;},g.prototype._animate=function(b){y4tt.v9();this._animationStarted&&(this._time+=b,this._time>this._delay&&(this._time%=this._delay,this.cellIndex+=this._direction,this.cellIndex==this._toIndex&&(this._loopAnimation?this.cellIndex=this._fromIndex:(this._animationStarted=!1,this.disposeWhenFinishedAnimating&&this.dispose()))));},g.prototype.dispose=function(){y4tt.v9();for(var b=0;b<this._manager.sprites.length;b++)this._manager.sprites[b]==this&&this._manager.sprites.splice(b,1);},g);b.Sprite=g;}(BABYLON||(BABYLON={}));!function(b){var g;y4tt.q9();g=function(e,c,d,f,g){this.name=e;this.scale=new b.Vector2(1,1);this.offset=new b.Vector2(0,0);this.alphaBlendingMode=b.Engine.ALPHA_COMBINE;this._vertexBuffers={};this.onDisposeObservable=new b.Observable();this.onBeforeRenderObservable=new b.Observable();this.onAfterRenderObservable=new b.Observable();this.texture=c?new b.Texture(c,d,!0):null;this.isBackground=void 0===f?!0:f;this.color=void 0===g?new b.Color4(1,1,1,1):g;this._scene=d;this._scene.layers.push(this);e=d.getEngine();c=[];c.push(1,1);c.push(-1,1);c.push(-1,-1);c.push(1,-1);c=new b.VertexBuffer(e,c,b.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[b.VertexBuffer.PositionKind]=c;c=[];c.push(0);c.push(1);c.push(2);c.push(0);c.push(2);c.push(3);this._indexBuffer=e.createIndexBuffer(c);this._effect=e.createEffect("layer",[b.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],"");this._alphaTestEffect=e.createEffect("layer",[b.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],"#define ALPHATEST");};g=(Object.defineProperty(g.prototype,"onDispose",{set:function(b){y4tt.v9();this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"onBeforeRender",{set:function(b){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);y4tt.q9();this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"onAfterRender",{set:function(b){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver);this._onAfterRenderObserver=this.onAfterRenderObservable.add(b);},enumerable:!0,configurable:!0}),g.prototype.render=function(){var e,c;e=this.alphaTest?this._alphaTestEffect:this._effect;if(e.isReady()&&this.texture&&this.texture.isReady()){c=this._scene.getEngine();this.onBeforeRenderObservable.notifyObservers(this);c.enableEffect(e);c.setState(!1);e.setTexture("textureSampler",this.texture);e.setMatrix("textureMatrix",this.texture.getTextureMatrix());e.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a);e.setVector2("offset",this.offset);e.setVector2("scale",this.scale);c.bindBuffers(this._vertexBuffers,this._indexBuffer,e);this._alphaTestEffect?c.draw(!0,0,6):(c.setAlphaMode(this.alphaBlendingMode),c.draw(!0,0,6),c.setAlphaMode(b.Engine.ALPHA_DISABLE));this.onAfterRenderObservable.notifyObservers(this);}},g.prototype.dispose=function(){var e;e=this._vertexBuffers[b.VertexBuffer.PositionKind];e&&(e.dispose(),this._vertexBuffers[b.VertexBuffer.PositionKind]=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.texture&&(this.texture.dispose(),this.texture=null);e=this._scene.layers.indexOf(this);this._scene.layers.splice(e,1);this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();this.onAfterRenderObservable.clear();this.onBeforeRenderObservable.clear();},g);b.Layer=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(){this.position=b.Vector3.Zero();this.direction=b.Vector3.Zero();this.color=new b.Color4(0,0,0,0);this.colorStep=new b.Color4(0,0,0,0);this.lifeTime=1;this.angularSpeed=this.angle=this.size=this.age=0;};g=(g.prototype.copyTo=function(b){b.position.copyFrom(this.position);y4tt.q9();b.direction.copyFrom(this.direction);b.color.copyFrom(this.color);b.colorStep.copyFrom(this.colorStep);b.lifeTime=this.lifeTime;b.age=this.age;b.size=this.size;b.angle=this.angle;b.angularSpeed=this.angularSpeed;},g);y4tt.q9();b.Particle=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;g=function(b,c){return b===c?b:Math.random()*(c-b)+b;},c=function(d,f,e,j){var l;l=this;this.name=d;this.animations=[];this.renderingGroupId=0;this.emitter=null;this.emitRate=10;this.manualEmitCount=-1;this.updateSpeed=0.01;this.targetStopDuration=0;this.disposeOnStop=!1;this.maxSize=this.minSize=this.maxLifeTime=this.minLifeTime=this.maxEmitPower=this.minEmitPower=1;this.maxAngularSpeed=this.minAngularSpeed=0;this.layerMask=268435455;this.onDisposeObservable=new b.Observable();this.blendMode=c.BLENDMODE_ONEONE;this.forceDepthWrite=!1;this.gravity=b.Vector3.Zero();this.direction1=new b.Vector3(0,1,0);this.direction2=new b.Vector3(0,1,0);this.minEmitBox=new b.Vector3(-0.5,-0.5,-0.5);this.maxEmitBox=new b.Vector3(0.5,0.5,0.5);this.color1=new b.Color4(1,1,1,1);this.color2=new b.Color4(1,1,1,1);this.colorDead=new b.Color4(0,0,0,1);this.textureMask=new b.Color4(1,1,1,1);this.particles=[];this._stockParticles=[];this._newPartsExcess=0;this._vertexBuffers={};this._scaledColorStep=new b.Color4(0,0,0,0);this._colorDiff=new b.Color4(0,0,0,0);this._scaledDirection=b.Vector3.Zero();this._scaledGravity=b.Vector3.Zero();this._currentRenderId=-1;this._stopped=this._started=!1;this._actualFrame=0;this.id=d;this._capacity=f;this._scene=e;this._customEffect=j;e.particleSystems.push(this);d=[];for(var n=j=0;f>n;n++)d.push(j),d.push(j+1),d.push(j+2),d.push(j),d.push(j+2),d.push(j+3),j+=4;this._indexBuffer=e.getEngine().createIndexBuffer(d);this._vertexData=new Float32Array(44*f);this._vertexBuffer=new b.Buffer(e.getEngine(),this._vertexData,!0,11);f=this._vertexBuffer.createVertexBuffer(b.VertexBuffer.PositionKind,0,3);e=this._vertexBuffer.createVertexBuffer(b.VertexBuffer.ColorKind,3,4);d=this._vertexBuffer.createVertexBuffer("options",7,4);this._vertexBuffers[b.VertexBuffer.PositionKind]=f;this._vertexBuffers[b.VertexBuffer.ColorKind]=e;this._vertexBuffers.options=d;this.startDirectionFunction=function(c,d,f){var e,j,n;e=g(l.direction1.x,l.direction2.x),j=g(l.direction1.y,l.direction2.y),n=g(l.direction1.z,l.direction2.z);b.Vector3.TransformNormalFromFloatsToRef(e*c,j*c,n*c,d,f);};this.startPositionFunction=function(c,d){var f,e,j;y4tt.v9();f=g(l.minEmitBox.x,l.maxEmitBox.x),e=g(l.minEmitBox.y,l.maxEmitBox.y),j=g(l.minEmitBox.z,l.maxEmitBox.z);b.Vector3.TransformCoordinatesFromFloatsToRef(f,e,j,c,d);};y4tt.v9();this.updateFunction=function(b){var d;for(var c=0;c<b.length;c++){d=b[c];d.age+=l._scaledUpdateSpeed;d.age>=d.lifeTime?(l.recycleParticle(d),c--):(d.colorStep.scaleToRef(l._scaledUpdateSpeed,l._scaledColorStep),d.color.addInPlace(l._scaledColorStep),0>d.color.a&&(d.color.a=0),d.angle+=d.angularSpeed*l._scaledUpdateSpeed,d.direction.scaleToRef(l._scaledUpdateSpeed,l._scaledDirection),d.position.addInPlace(l._scaledDirection),l.gravity.scaleToRef(l._scaledUpdateSpeed,l._scaledGravity),d.direction.addInPlace(l._scaledGravity));}};};y4tt.v9();e=(Object.defineProperty(c.prototype,"onDispose",{set:function(b){y4tt.q9();this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(b);},enumerable:!0,configurable:!0}),c.prototype.recycleParticle=function(b){var c;c=this.particles.pop();c!==b&&(c.copyTo(b),this._stockParticles.push(c));},c.prototype.getCapacity=function(){return this._capacity;},c.prototype.isAlive=function(){y4tt.v9();return this._alive;},c.prototype.isStarted=function(){return this._started;},c.prototype.start=function(){this._started=!0;y4tt.v9();this._stopped=!1;this._actualFrame=0;},c.prototype.stop=function(){y4tt.v9();this._stopped=!0;},c.prototype._appendParticleVertex=function(b,c,e,j){b*=11;this._vertexData[b]=c.position.x;this._vertexData[b+1]=c.position.y;this._vertexData[b+2]=c.position.z;this._vertexData[b+3]=c.color.r;this._vertexData[b+4]=c.color.g;this._vertexData[b+5]=c.color.b;this._vertexData[b+6]=c.color.a;this._vertexData[b+7]=c.angle;this._vertexData[b+8]=c.size;this._vertexData[b+9]=e;this._vertexData[b+10]=j;},c.prototype._update=function(c){var f,l;this._alive=0<this.particles.length;this.updateFunction(this.particles);f=this.emitter.position?this.emitter.getWorldMatrix():b.Matrix.Translation(this.emitter.x,this.emitter.y,this.emitter.z);for(var e,j=0;c>j&&this.particles.length!==this._capacity;j++){0!==this._stockParticles.length?(e=this._stockParticles.pop(),e.age=0):e=new b.Particle();this.particles.push(e);l=g(this.minEmitPower,this.maxEmitPower);this.startDirectionFunction(l,f,e.direction,e);e.lifeTime=g(this.minLifeTime,this.maxLifeTime);e.size=g(this.minSize,this.maxSize);e.angularSpeed=g(this.minAngularSpeed,this.maxAngularSpeed);this.startPositionFunction(f,e.position,e);l=g(0,1);b.Color4.LerpToRef(this.color1,this.color2,l,e.color);this.colorDead.subtractToRef(e.color,this._colorDiff);this._colorDiff.scaleToRef(1/e.lifeTime,e.colorStep);}},c.prototype._getEffect=function(){var c;if(this._customEffect)return this._customEffect;c=[];this._scene.clipPlane&&c.push("#define CLIPPLANE");c=c.join("\n");return this._cachedDefines!==c&&(this._cachedDefines=c,this._effect=this._scene.getEngine().createEffect("particles",[b.VertexBuffer.PositionKind,b.VertexBuffer.ColorKind,"options"],["invView","view","projection","vClipPlane","textureMask"],["diffuseSampler"],c)),this._effect;},c.prototype.animate=function(){var b,c,e;y4tt.q9();if(this._started){b=this._getEffect();if(this.emitter&&b.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this._currentRenderId!==this._scene.getRenderId()){this._currentRenderId=this._scene.getRenderId();this._scaledUpdateSpeed=this.updateSpeed*this._scene.getAnimationRatio();-1<this.manualEmitCount?(c=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0):(c=this.emitRate*this._scaledUpdateSpeed>>0,this._newPartsExcess+=this.emitRate*this._scaledUpdateSpeed-c);1<this._newPartsExcess&&(c+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0);this._alive=!1;this._stopped?c=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop());this._update(c);this._stopped&&(this._alive||(this._started=!1,this.disposeOnStop&&this._scene._toBeDisposed.push(this)));for(c=b=0;c<this.particles.length;c++){e=this.particles[c];this._appendParticleVertex(b++,e,0,0);this._appendParticleVertex(b++,e,1,0);this._appendParticleVertex(b++,e,1,1);this._appendParticleVertex(b++,e,0,1);}this._vertexBuffer.update(this._vertexData);}}},c.prototype.render=function(){var d,f,e,j;y4tt.v9();d=this._getEffect();if(!this.emitter||!d.isReady()||!this.particleTexture||!this.particleTexture.isReady()||!this.particles.length)return 0;f=this._scene.getEngine();f.enableEffect(d);f.setState(!1);e=this._scene.getViewMatrix();if(d.setTexture("diffuseSampler",this.particleTexture),d.setMatrix("view",e),d.setMatrix("projection",this._scene.getProjectionMatrix()),d.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._scene.clipPlane){j=this._scene.clipPlane,e=e.clone();e.invert();d.setMatrix("invView",e);d.setFloat4("vClipPlane",j.normal.x,j.normal.y,j.normal.z,j.d);}return f.bindBuffers(this._vertexBuffers,this._indexBuffer,d),this.blendMode===c.BLENDMODE_ONEONE?f.setAlphaMode(b.Engine.ALPHA_ONEONE):f.setAlphaMode(b.Engine.ALPHA_COMBINE),this.forceDepthWrite&&f.setDepthWrite(!0),f.draw(!0,0,6*this.particles.length),f.setAlphaMode(b.Engine.ALPHA_DISABLE),this.particles.length;},c.prototype.dispose=function(){var b;this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null);b=this._scene.particleSystems.indexOf(this);this._scene.particleSystems.splice(b,1);y4tt.q9();this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();},c.prototype.clone=function(d,f){var e;e=new c(d,this._capacity,this._scene);y4tt.v9();return b.Tools.DeepCopy(this,e,["particles"]),void 0===f&&(f=this.emitter),e.emitter=f,this.particleTexture&&(e.particleTexture=new b.Texture(this.particleTexture.url,this._scene)),e.start(),e;},c.prototype.serialize=function(){var c;c={};y4tt.q9();return c.name=this.name,c.id=this.id,this.emitter.position?c.emitterId=this.emitter.id:c.emitter=this.emitter.asArray(),c.capacity=this.getCapacity(),this.particleTexture&&(c.textureName=this.particleTexture.name),b.Animation.AppendSerializedAnimations(this,c),c.minAngularSpeed=this.minAngularSpeed,c.maxAngularSpeed=this.maxAngularSpeed,c.minSize=this.minSize,c.maxSize=this.maxSize,c.minEmitPower=this.minEmitPower,c.maxEmitPower=this.maxEmitPower,c.minLifeTime=this.minLifeTime,c.maxLifeTime=this.maxLifeTime,c.emitRate=this.emitRate,c.minEmitBox=this.minEmitBox.asArray(),c.maxEmitBox=this.maxEmitBox.asArray(),c.gravity=this.gravity.asArray(),c.direction1=this.direction1.asArray(),c.direction2=this.direction2.asArray(),c.color1=this.color1.asArray(),c.color2=this.color2.asArray(),c.colorDead=this.colorDead.asArray(),c.updateSpeed=this.updateSpeed,c.targetStopDuration=this.targetStopDuration,c.textureMask=this.textureMask.asArray(),c.blendMode=this.blendMode,c;},c.Parse=function(d,f,e){var j;j=new c(d.name,d.capacity,f);y4tt.v9();if(d.id&&(j.id=d.id),d.textureName&&(j.particleTexture=new b.Texture(e+d.textureName,f),j.particleTexture.name=d.textureName),d.emitterId?j.emitter=f.getLastMeshByID(d.emitterId):j.emitter=b.Vector3.FromArray(d.emitter),d.animations)for(e=0;e<d.animations.length;e++)j.animations.push(b.Animation.Parse(d.animations[e]));return d.autoAnimate&&f.beginAnimation(j,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1),j.minAngularSpeed=d.minAngularSpeed,j.maxAngularSpeed=d.maxAngularSpeed,j.minSize=d.minSize,j.maxSize=d.maxSize,j.minLifeTime=d.minLifeTime,j.maxLifeTime=d.maxLifeTime,j.minEmitPower=d.minEmitPower,j.maxEmitPower=d.maxEmitPower,j.emitRate=d.emitRate,j.minEmitBox=b.Vector3.FromArray(d.minEmitBox),j.maxEmitBox=b.Vector3.FromArray(d.maxEmitBox),j.gravity=b.Vector3.FromArray(d.gravity),j.direction1=b.Vector3.FromArray(d.direction1),j.direction2=b.Vector3.FromArray(d.direction2),j.color1=b.Color4.FromArray(d.color1),j.color2=b.Color4.FromArray(d.color2),j.colorDead=b.Color4.FromArray(d.colorDead),j.updateSpeed=d.updateSpeed,j.targetStopDuration=d.targetStopDuration,j.textureMask=b.Color4.FromArray(d.textureMask),j.blendMode=d.blendMode,d.preventAutoStart||j.start(),j;},c.BLENDMODE_ONEONE=0,c.BLENDMODE_STANDARD=1,c);b.ParticleSystem=e;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d;e=function(b,c,d){this.name=b;this.from=c;this.to=d;};g=(e.prototype.clone=function(){return new e(this.name,this.from,this.to);},e);b.AnimationRange=g;b.AnimationEvent=function(b,c,d){this.frame=b;this.action=c;this.onlyOnce=d;this.isDone=!1;};c=function(b){this.path=b;this._onchange=[];this.value=0;this.animations=[];};c=(c.prototype.getPoint=function(){var c;y4tt.v9();c=this.path.getPointAtLengthPosition(this.value);return new b.Vector3(c.x,0,c.y);},c.prototype.moveAhead=function(b){return void 0===b&&(b=0.002),this.move(b),this;},c.prototype.moveBack=function(b){y4tt.q9();return void 0===b&&(b=0.002),this.move(-b),this;},c.prototype.move=function(b){if(1<Math.abs(b))throw"step size should be less than 1.";y4tt.v9();return this.value+=b,this.ensureLimits(),this.raiseOnChange(),this;},c.prototype.ensureLimits=function(){for(;1<this.value;)this.value-=1;y4tt.q9();for(;0>this.value;)this.value+=1;return this;},c.prototype.markAsDirty=function(){return this.ensureLimits(),this.raiseOnChange(),this;},c.prototype.raiseOnChange=function(){var b;y4tt.v9();b=this;return this._onchange.forEach(function(c){return c(b);}),this;},c.prototype.onchange=function(b){y4tt.v9();return this._onchange.push(b),this;},c);b.PathCursor=c;d=function(b,c,e,l,g,m){this.name=b;this.targetProperty=c;this.framePerSecond=e;this.dataType=l;this.loopMode=g;this.enableBlending=m;this._offsetsCache={};this._highLimitsCache={};this._stopped=!1;this._blendingFactor=0;this._events=[];this.allowMatricesInterpolation=!1;this.blendingSpeed=0.01;y4tt.v9();this._ranges={};this.targetPropertyPath=c.split(".");this.dataType=l;this.loopMode=void 0===g?d.ANIMATIONLOOPMODE_CYCLE:g;};c=(d._PrepareAnimation=function(c,e,j,l,g,m,p,r){var s;s=void 0;if(!isNaN(parseFloat(g))&&isFinite(g)?s=d.ANIMATIONTYPE_FLOAT:g instanceof b.Quaternion?s=d.ANIMATIONTYPE_QUATERNION:g instanceof b.Vector3?s=d.ANIMATIONTYPE_VECTOR3:g instanceof b.Vector2?s=d.ANIMATIONTYPE_VECTOR2:g instanceof b.Color3?s=d.ANIMATIONTYPE_COLOR3:g instanceof b.Size&&(s=d.ANIMATIONTYPE_SIZE),void 0==s)return null;c=new d(c,e,j,s,p);e=[];return e.push({frame:0,value:g}),e.push({frame:l,value:m}),c.setKeys(e),void 0!==r&&c.setEasingFunction(r),c;},d.CreateAndStartAnimation=function(b,c,e,l,g,m,p,r,s,t){b=d._PrepareAnimation(b,e,l,g,m,p,r,s);return c.getScene().beginDirectAnimation(c,[b],0,g,1===b.loopMode,1,t);},d.CreateMergeAndStartAnimation=function(b,c,e,l,g,m,p,r,s,t){b=d._PrepareAnimation(b,e,l,g,m,p,r,s);return c.animations.push(b),c.getScene().beginAnimation(c,0,g,1===b.loopMode,1,t);},d.prototype.toString=function(b){var c;c="Name: "+this.name+", property: "+this.targetProperty;if(c+=", datatype: "+"Float Vector3 Quaternion Matrix Color3 Vector2".split(" ")[this.dataType],c+=", nKeys: "+(this._keys?this._keys.length:"none"),c+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),b){c+=", Ranges: {";b=!0;for(var d in this._ranges)b&&(c+=", ",b=!1),c+=d;c+="}";}return c;},d.prototype.addEvent=function(b){y4tt.v9();this._events.push(b);},d.prototype.removeEvents=function(b){y4tt.q9();for(var c=0;c<this._events.length;c++)this._events[c].frame===b&&(this._events.splice(c,1),c--);},d.prototype.createRange=function(b,c,d){y4tt.q9();this._ranges[b]||(this._ranges[b]=new g(b,c,d));},d.prototype.deleteRange=function(b,c){y4tt.q9();if(void 0===c&&(c=!0),this._ranges[b]){if(c)for(var d=this._ranges[b].from,e=this._ranges[b].to,g=this._keys.length-1;0<=g;g--)this._keys[g].frame>=d&&this._keys[g].frame<=e&&this._keys.splice(g,1);this._ranges[b]=void 0;}},d.prototype.getRange=function(b){return this._ranges[b];},d.prototype.reset=function(){this._offsetsCache={};this._highLimitsCache={};this._blendingFactor=this.currentFrame=0;this._originalBlendValue=null;},d.prototype.isStopped=function(){return this._stopped;},d.prototype.getKeys=function(){return this._keys;},d.prototype.getHighestFrame=function(){for(var b=0,c=0,d=this._keys.length;d>c;c++)b<this._keys[c].frame&&(b=this._keys[c].frame);return b;},d.prototype.getEasingFunction=function(){y4tt.v9();return this._easingFunction;},d.prototype.setEasingFunction=function(b){this._easingFunction=b;},d.prototype.floatInterpolateFunction=function(b,c,d){y4tt.q9();return b+(c-b)*d;},d.prototype.quaternionInterpolateFunction=function(c,d,e){return b.Quaternion.Slerp(c,d,e);},d.prototype.vector3InterpolateFunction=function(c,d,e){return b.Vector3.Lerp(c,d,e);},d.prototype.vector2InterpolateFunction=function(c,d,e){y4tt.q9();return b.Vector2.Lerp(c,d,e);},d.prototype.sizeInterpolateFunction=function(c,d,e){return b.Size.Lerp(c,d,e);},d.prototype.color3InterpolateFunction=function(c,d,e){return b.Color3.Lerp(c,d,e);},d.prototype.matrixInterpolateFunction=function(c,d,e){return b.Matrix.Lerp(c,d,e);},d.prototype.clone=function(){var b;b=new d(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(this._keys&&b.setKeys(this._keys),this._ranges){b._ranges={};for(var c in this._ranges)b._ranges[c]=this._ranges[c].clone();}return b;},d.prototype.setKeys=function(b){this._keys=b.slice(0);this._offsetsCache={};this._highLimitsCache={};},d.prototype._getKeyValue=function(b){y4tt.q9();return"function"==typeof b?b():b;},d.prototype._interpolate=function(b,c,e,l,g){var p;if(e===d.ANIMATIONLOOPMODE_CONSTANT&&0<c)return g.clone?g.clone():g;this.currentFrame=b;g=Math.max(0,Math.min(this._keys.length-1,Math.floor(this._keys.length*(b-this._keys[0].frame)/(this._keys[this._keys.length-1].frame-this._keys[0].frame))-1));if(this._keys[g].frame>=b)for(;0<=g-1&&this._keys[g].frame>=b;)g--;for(var m=g;m<this._keys.length;m++)if(this._keys[m+1].frame>=b){g=this._getKeyValue(this._keys[m].value);p=this._getKeyValue(this._keys[m+1].value);b=(b-this._keys[m].frame)/(this._keys[m+1].frame-this._keys[m].frame);switch(null!=this._easingFunction&&(b=this._easingFunction.ease(b)),this.dataType){case d.ANIMATIONTYPE_FLOAT:switch(e){case d.ANIMATIONLOOPMODE_CYCLE:case d.ANIMATIONLOOPMODE_CONSTANT:return this.floatInterpolateFunction(g,p,b);case d.ANIMATIONLOOPMODE_RELATIVE:return l*c+this.floatInterpolateFunction(g,p,b);}break;case d.ANIMATIONTYPE_QUATERNION:m=null;switch(e){case d.ANIMATIONLOOPMODE_CYCLE:case d.ANIMATIONLOOPMODE_CONSTANT:m=this.quaternionInterpolateFunction(g,p,b);break;case d.ANIMATIONLOOPMODE_RELATIVE:m=this.quaternionInterpolateFunction(g,p,b).add(l.scale(c));}return m;case d.ANIMATIONTYPE_VECTOR3:switch(e){case d.ANIMATIONLOOPMODE_CYCLE:case d.ANIMATIONLOOPMODE_CONSTANT:return this.vector3InterpolateFunction(g,p,b);case d.ANIMATIONLOOPMODE_RELATIVE:return this.vector3InterpolateFunction(g,p,b).add(l.scale(c));}case d.ANIMATIONTYPE_VECTOR2:switch(e){case d.ANIMATIONLOOPMODE_CYCLE:case d.ANIMATIONLOOPMODE_CONSTANT:return this.vector2InterpolateFunction(g,p,b);case d.ANIMATIONLOOPMODE_RELATIVE:return this.vector2InterpolateFunction(g,p,b).add(l.scale(c));}case d.ANIMATIONTYPE_SIZE:switch(e){case d.ANIMATIONLOOPMODE_CYCLE:case d.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(g,p,b);case d.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(g,p,b).add(l.scale(c));}case d.ANIMATIONTYPE_COLOR3:switch(e){case d.ANIMATIONLOOPMODE_CYCLE:case d.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(g,p,b);case d.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(g,p,b).add(l.scale(c));}case d.ANIMATIONTYPE_MATRIX:switch(e){case d.ANIMATIONLOOPMODE_CYCLE:case d.ANIMATIONLOOPMODE_CONSTANT:if(this.allowMatricesInterpolation)return this.matrixInterpolateFunction(g,p,b);case d.ANIMATIONLOOPMODE_RELATIVE:return g;}}break;}return this._getKeyValue(this._keys[this._keys.length-1].value);},d.prototype.setValue=function(c){var d,e;if(1<this.targetPropertyPath.length){e=this._target[this.targetPropertyPath[0]];for(d=1;d<this.targetPropertyPath.length-1;d++)e=e[this.targetPropertyPath[d]];d=this.targetPropertyPath[this.targetPropertyPath.length-1];}else d=this.targetPropertyPath[0],e=this._target;this.enableBlending&&1>=this._blendingFactor?(this._originalBlendValue||(e[d].clone?this._originalBlendValue=e[d].clone():this._originalBlendValue=e[d]),this._originalBlendValue.prototype?this._originalBlendValue.prototype.Lerp?e[d]=this._originalBlendValue.construtor.prototype.Lerp(c,this._originalBlendValue,this._blendingFactor):e[d]=c:this._originalBlendValue.m?e[d]=b.Matrix.Lerp(this._originalBlendValue,c,this._blendingFactor):e[d]=this._originalBlendValue*(1-this._blendingFactor)+this._blendingFactor*c,this._blendingFactor+=this.blendingSpeed):e[d]=c;this._target.markAsDirty&&this._target.markAsDirty(this.targetProperty);},d.prototype.goToFrame=function(b){b<this._keys[0].frame?b=this._keys[0].frame:b>this._keys[this._keys.length-1].frame&&(b=this._keys[this._keys.length-1].frame);b=this._interpolate(b,0,this.loopMode);y4tt.v9();this.setValue(b);},d.prototype.animate=function(c,e,j,l,g){var m,p,r;if(!this.targetPropertyPath||1>this.targetPropertyPath.length)return this._stopped=!0,!1;m=!0;0!==this._keys[0].frame&&this._keys.splice(0,0,{frame:0,value:this._keys[0].value});(e<this._keys[0].frame||e>this._keys[this._keys.length-1].frame)&&(e=this._keys[0].frame);(j<this._keys[0].frame||j>this._keys[this._keys.length-1].frame)&&(j=this._keys[this._keys.length-1].frame);r=j-e;c=c*this.framePerSecond*g/1E3;g=0;if(c>r&&!l)m=!1,g=this._getKeyValue(this._keys[this._keys.length-1].value);else if(this.loopMode!==d.ANIMATIONLOOPMODE_CYCLE){p=j.toString()+e.toString();if(!this._offsetsCache[p]){l=this._interpolate(e,0,d.ANIMATIONLOOPMODE_CYCLE);g=this._interpolate(j,0,d.ANIMATIONLOOPMODE_CYCLE);switch(this.dataType){case d.ANIMATIONTYPE_FLOAT:this._offsetsCache[p]=g-l;break;case d.ANIMATIONTYPE_QUATERNION:this._offsetsCache[p]=g.subtract(l);break;case d.ANIMATIONTYPE_VECTOR3:this._offsetsCache[p]=g.subtract(l);case d.ANIMATIONTYPE_VECTOR2:this._offsetsCache[p]=g.subtract(l);case d.ANIMATIONTYPE_SIZE:this._offsetsCache[p]=g.subtract(l);case d.ANIMATIONTYPE_COLOR3:this._offsetsCache[p]=g.subtract(l);}this._highLimitsCache[p]=g;}g=this._highLimitsCache[p];p=this._offsetsCache[p];}if(void 0===p)switch(this.dataType){case d.ANIMATIONTYPE_FLOAT:p=0;break;case d.ANIMATIONTYPE_QUATERNION:p=new b.Quaternion(0,0,0,0);break;case d.ANIMATIONTYPE_VECTOR3:p=b.Vector3.Zero();break;case d.ANIMATIONTYPE_VECTOR2:p=b.Vector2.Zero();break;case d.ANIMATIONTYPE_SIZE:p=b.Size.Zero();break;case d.ANIMATIONTYPE_COLOR3:p=b.Color3.Black();}e=m?e+c%r:j;r=this._interpolate(e,c/r>>0,this.loopMode,p,g);this.setValue(r);for(r=0;r<this._events.length;r++)e>=this._events[r].frame?(j=this._events[r],j.isDone||(j.onlyOnce&&(this._events.splice(r,1),r--),j.isDone=!0,j.action())):this._events[r].isDone&&!this._events[r].onlyOnce&&(this._events[r].isDone=!1);return m||(this._stopped=!0),m;},d.prototype.serialize=function(){var b,c,g,m;b={};b.name=this.name;b.property=this.targetProperty;b.framePerSecond=this.framePerSecond;b.dataType=this.dataType;b.loopBehavior=this.loopMode;c=this.dataType;b.keys=[];for(var e=this.getKeys(),l=0;l<e.length;l++){g=e[l],m={};switch(m.frame=g.frame,c){case d.ANIMATIONTYPE_FLOAT:m.values=[g.value];break;case d.ANIMATIONTYPE_QUATERNION:case d.ANIMATIONTYPE_MATRIX:case d.ANIMATIONTYPE_VECTOR3:case d.ANIMATIONTYPE_COLOR3:m.values=g.value.asArray();}b.keys.push(m);}b.ranges=[];for(var p in this._ranges)c={},c.name=p,c.from=this._ranges[p].from,c.to=this._ranges[p].to,b.ranges.push(c);return b;},Object.defineProperty(d,"ANIMATIONTYPE_FLOAT",{get:function(){return d._ANIMATIONTYPE_FLOAT;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONTYPE_VECTOR3",{get:function(){y4tt.q9();return d._ANIMATIONTYPE_VECTOR3;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONTYPE_VECTOR2",{get:function(){return d._ANIMATIONTYPE_VECTOR2;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONTYPE_SIZE",{get:function(){return d._ANIMATIONTYPE_SIZE;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONTYPE_QUATERNION",{get:function(){y4tt.q9();return d._ANIMATIONTYPE_QUATERNION;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONTYPE_MATRIX",{get:function(){y4tt.v9();return d._ANIMATIONTYPE_MATRIX;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONTYPE_COLOR3",{get:function(){y4tt.v9();return d._ANIMATIONTYPE_COLOR3;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){y4tt.v9();return d._ANIMATIONLOOPMODE_RELATIVE;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return d._ANIMATIONLOOPMODE_CYCLE;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){y4tt.q9();return d._ANIMATIONLOOPMODE_CONSTANT;},enumerable:!0,configurable:!0}),d.Parse=function(c){var e,j,l,g,m,p;l=new d(c.name,c.property,c.framePerSecond,c.dataType,c.loopBehavior),g=c.dataType,m=[];for(j=0;j<c.keys.length;j++){p=c.keys[j];switch(g){case d.ANIMATIONTYPE_FLOAT:e=p.values[0];break;case d.ANIMATIONTYPE_QUATERNION:e=b.Quaternion.FromArray(p.values);break;case d.ANIMATIONTYPE_MATRIX:e=b.Matrix.FromArray(p.values);break;case d.ANIMATIONTYPE_COLOR3:e=b.Color3.FromArray(p.values);break;default:e=b.Vector3.FromArray(p.values);}m.push({frame:p.frame,value:e});}if(l.setKeys(m),c.ranges)for(j=0;j<c.ranges.length;j++)e=c.ranges[j],l.createRange(e.name,e.from,e.to);return l;},d.AppendSerializedAnimations=function(b,c){y4tt.q9();if(b.animations){c.animations=[];for(var d=0;d<b.animations.length;d++)c.animations.push(b.animations[d].serialize());}},d._ANIMATIONTYPE_FLOAT=0,d._ANIMATIONTYPE_VECTOR3=1,d._ANIMATIONTYPE_QUATERNION=2,d._ANIMATIONTYPE_MATRIX=3,d._ANIMATIONTYPE_COLOR3=4,d._ANIMATIONTYPE_VECTOR2=5,d._ANIMATIONTYPE_SIZE=6,d._ANIMATIONLOOPMODE_RELATIVE=0,d._ANIMATIONLOOPMODE_CYCLE=1,d._ANIMATIONLOOPMODE_CONSTANT=2,d);b.Animation=c;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(b,c,d,f,g,j,l,n){void 0===d&&(d=0);void 0===f&&(f=100);void 0===g&&(g=!1);void 0===j&&(j=1);this.target=c;this.fromFrame=d;this.toFrame=f;this.loopAnimation=g;this.speedRatio=j;this.onAnimationEnd=l;this._animations=[];this.animationStarted=this._paused=!1;n&&this.appendAnimations(c,n);this._scene=b;b._activeAnimatables.push(this);};g=(g.prototype.getAnimations=function(){return this._animations;},g.prototype.appendAnimations=function(b,c){var f;for(var d=0;d<c.length;d++){f=c[d];f._target=b;this._animations.push(f);}},g.prototype.getAnimationByTargetProperty=function(b){for(var c=this._animations,d=0;d<c.length;d++)if(c[d].targetProperty===b)return c[d];return null;},g.prototype.reset=function(){for(var b=this._animations,c=0;c<b.length;c++)b[c].reset();this._pausedDelay=this._localDelayOffset=null;},g.prototype.enableBlending=function(b){y4tt.q9();for(var c=this._animations,d=0;d<c.length;d++)c[d].enableBlending=!0,c[d].blendingSpeed=b;},g.prototype.disableBlending=function(){y4tt.q9();for(var b=this._animations,c=0;c<b.length;c++)b[c].enableBlending=!1;},g.prototype.goToFrame=function(b){y4tt.q9();for(var c=this._animations,d=0;d<c.length;d++)c[d].goToFrame(b);},g.prototype.pause=function(){y4tt.q9();this._paused||(this._paused=!0);},g.prototype.restart=function(){this._paused=!1;},g.prototype.stop=function(){var b;y4tt.v9();b=this._scene._activeAnimatables.indexOf(this);if(-1<b){this._scene._activeAnimatables.splice(b,1);for(var c=this._animations,b=0;b<c.length;b++)c[b].reset();this.onAnimationEnd&&this.onAnimationEnd();}},g.prototype._animate=function(b){var c,d,f;if(this._paused)return this.animationStarted=!1,this._pausedDelay||(this._pausedDelay=b),!0;this._localDelayOffset?this._pausedDelay&&(this._localDelayOffset+=b-this._pausedDelay,this._pausedDelay=null):this._localDelayOffset=b;d=!1,f=this._animations;for(c=0;c<f.length;c++)var g=f[c].animate(b-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this.speedRatio),d=d||g;return this.animationStarted=d,d||(c=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(c,1)),!d&&this.onAnimationEnd&&(this.onAnimationEnd(),this.onAnimationEnd=null),d;},g);b.Animatable=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=function(){this._easingMode=e.EASINGMODE_EASEIN;};g=(Object.defineProperty(e,"EASINGMODE_EASEIN",{get:function(){y4tt.q9();return e._EASINGMODE_EASEIN;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EASINGMODE_EASEOUT",{get:function(){y4tt.q9();return e._EASINGMODE_EASEOUT;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EASINGMODE_EASEINOUT",{get:function(){return e._EASINGMODE_EASEINOUT;},enumerable:!0,configurable:!0}),e.prototype.setEasingMode=function(b){y4tt.v9();this._easingMode=Math.min(Math.max(b,0),2);},e.prototype.getEasingMode=function(){y4tt.v9();return this._easingMode;},e.prototype.easeInCore=function(){throw Error("You must implement this method");},e.prototype.ease=function(b){y4tt.v9();switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(b);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-b);}return 0.5<=b?0.5*(1-this.easeInCore(2*(1-b)))+0.5:0.5*this.easeInCore(2*b);},e._EASINGMODE_EASEIN=0,e._EASINGMODE_EASEOUT=1,e._EASINGMODE_EASEINOUT=2,e);b.EasingFunction=g;c=function(){g.apply(this,arguments);};c=(__extends(c,g),c.prototype.easeInCore=function(b){y4tt.v9();return b=Math.max(0,Math.min(1,b)),1-Math.sqrt(1-b*b);},c);b.CircleEase=c;c=function(b){void 0===b&&(b=1);y4tt.v9();g.call(this);this.amplitude=b;};c=(__extends(c,g),c.prototype.easeInCore=function(b){var c;c=Math.max(0,this.amplitude);return Math.pow(b,3)-b*c*Math.sin(3.141592653589793*b);},c);b.BackEase=c;c=function(b,c){y4tt.q9();void 0===b&&(b=3);void 0===c&&(c=2);g.call(this);this.bounces=b;this.bounciness=c;};c=(__extends(c,g),c.prototype.easeInCore=function(b){var c,e,j,l,g,m,p;c=Math.max(0,this.bounces),e=this.bounciness;y4tt.q9();1>=e&&(e=1.001);j=Math.pow(e,c),l=1-e,g=(1-j)/l+0.5*j,j=Math.log(-(b*g)*(1-e)+1)/Math.log(e),j=Math.floor(j),m=j+1,p=(1-Math.pow(e,j))/(l*g),l=(1-Math.pow(e,m))/(l*g),l=0.5*(p+l);b-=l;p=l-p;return-Math.pow(1/e,c-j)/(p*p)*(b-p)*(b+p);},c);b.BounceEase=c;c=function(){y4tt.v9();g.apply(this,arguments);};c=(__extends(c,g),c.prototype.easeInCore=function(b){y4tt.v9();return b*b*b;},c);b.CubicEase=c;c=function(b,c){void 0===b&&(b=3);void 0===c&&(c=3);g.call(this);this.oscillations=b;y4tt.v9();this.springiness=c;};c=(__extends(c,g),c.prototype.easeInCore=function(b){var c,e,j;e=Math.max(0,this.oscillations),j=Math.max(0,this.springiness);return c=0==j?b:(Math.exp(j*b)-1)/(Math.exp(j)-1),c*Math.sin((6.283185307179586*e+1.5707963267948966)*b);},c);b.ElasticEase=c;c=function(b){void 0===b&&(b=2);g.call(this);this.exponent=b;};c=(__extends(c,g),c.prototype.easeInCore=function(b){y4tt.v9();return 0>=this.exponent?b:(Math.exp(this.exponent*b)-1)/(Math.exp(this.exponent)-1);},c);b.ExponentialEase=c;c=function(b){void 0===b&&(b=2);g.call(this);y4tt.v9();this.power=b;};c=(__extends(c,g),c.prototype.easeInCore=function(b){var c;y4tt.q9();c=Math.max(0,this.power);return Math.pow(b,c);},c);b.PowerEase=c;c=function(){g.apply(this,arguments);};c=(__extends(c,g),c.prototype.easeInCore=function(b){y4tt.v9();return b*b;},c);b.QuadraticEase=c;c=function(){g.apply(this,arguments);};c=(__extends(c,g),c.prototype.easeInCore=function(b){return b*b*b*b;},c);b.QuarticEase=c;c=function(){y4tt.q9();g.apply(this,arguments);};c=(__extends(c,g),c.prototype.easeInCore=function(b){y4tt.v9();return b*b*b*b*b;},c);b.QuinticEase=c;c=function(){g.apply(this,arguments);};c=(__extends(c,g),c.prototype.easeInCore=function(b){y4tt.q9();return 1-Math.sin(1.5707963267948966*(1-b));},c);b.SineEase=c;c=function(b,c,e,j){void 0===b&&(b=0);void 0===c&&(c=0);void 0===e&&(e=1);void 0===j&&(j=1);g.call(this);this.x1=b;this.y1=c;y4tt.v9();this.x2=e;this.y2=j;};c=(__extends(c,g),c.prototype.easeInCore=function(c){return b.BezierCurve.interpolate(c,this.x1,this.y1,this.x2,this.y2);},c);y4tt.q9();b.BezierCurveEase=c;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.Node;g=function(c,d,f,g,j){e.call(this,c,d.getScene());this.name=c;this.children=[];this.animations=[];this._worldTransform=new b.Matrix();this._absoluteTransform=new b.Matrix();this._invertedAbsoluteTransform=new b.Matrix();this._skeleton=d;this._baseMatrix=this._matrix=g;this._restPose=j?j:g.clone();d.bones.push(this);f?(this._parent=f,f.children.push(this)):this._parent=null;this._updateDifferenceMatrix();};g=(__extends(g,e),g.prototype.getParent=function(){return this._parent;},g.prototype.getLocalMatrix=function(){y4tt.q9();return this._matrix;},g.prototype.getBaseMatrix=function(){return this._baseMatrix;},g.prototype.getRestPose=function(){y4tt.v9();return this._restPose;},g.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone());},g.prototype.getWorldMatrix=function(){return this._worldTransform;},g.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform;},g.prototype.getAbsoluteTransform=function(){return this._absoluteTransform;},g.prototype.updateMatrix=function(b){this._baseMatrix=b.clone();this._matrix=b.clone();this._skeleton._markAsDirty();this._updateDifferenceMatrix();},g.prototype._updateDifferenceMatrix=function(b){b||(b=this._baseMatrix);y4tt.q9();this._parent?b.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(b);this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform);for(b=0;b<this.children.length;b++)this.children[b]._updateDifferenceMatrix();},g.prototype.markAsDirty=function(){this._currentRenderId++;this._skeleton._markAsDirty();},g.prototype.copyAnimationRange=function(c,d,f,e,j){var l,g,m,p,r,s,t;y4tt.q9();void 0===e&&(e=!1);void 0===j&&(j=null);0===this.animations.length&&(this.animations.push(new b.Animation(this.name,"_matrix",c.animations[0].framePerSecond,b.Animation.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));l=c.animations[0].getRange(d);if(!l)return!1;r=l.from,l=l.to,s=c.animations[0].getKeys(),t=c.length;c=c.getParent();g=this.getParent();c=(t=e&&c&&t&&this.length&&t!==this.length)?g.length/c.length:null;for(var v=e&&!g&&j&&(1!==j.x||1!==j.y||1!==j.z),y=this.animations[0].getKeys(),x=0,z=s.length;z>x;x++)g=s[x],g.frame>=r&&g.frame<=l&&(e?(p=g.value.clone(),t?(m=p.getTranslation(),p.setTranslation(m.scaleInPlace(c))):v?(m=p.getTranslation(),p.setTranslation(m.multiplyInPlace(j))):p=g.value):p=g.value,y.push({frame:g.frame+f,value:p}));return this.animations[0].createRange(d,r+f,l+f),!0;},g);b.Bone=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(c,d,f){this.name=c;this.id=d;this.bones=[];this.needInitialSkinMatrix=!1;this._isDirty=!0;this._meshesWithPoseMatrix=[];this._identity=b.Matrix.Identity();this._ranges={};this.bones=[];this._scene=f;f.skeletons.push(this);this._isDirty=!0;};g=(e.prototype.getTransformMatrices=function(b){return this.needInitialSkinMatrix&&b._bonesTransformMatrices?b._bonesTransformMatrices:this._transformMatrices;},e.prototype.getScene=function(){y4tt.v9();return this._scene;},e.prototype.toString=function(b){var d;d="Name: "+this.name+", nBones: "+this.bones.length;if(d+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),b){d+=", Ranges: {";b=!0;for(var f in this._ranges)b&&(d+=", ",b=!1),d+=f;d+="}";}return d;},e.prototype.getBoneIndexByName=function(b){for(var d=0,f=this.bones.length;f>d;d++)if(this.bones[d].name===b)return d;y4tt.q9();return-1;},e.prototype.createAnimationRange=function(c,d,f){y4tt.q9();if(!this._ranges[c]){this._ranges[c]=new b.AnimationRange(c,d,f);for(var e=0,j=this.bones.length;j>e;e++)this.bones[e].animations[0]&&this.bones[e].animations[0].createRange(c,d,f);}},e.prototype.deleteAnimationRange=function(b,d){y4tt.v9();void 0===d&&(d=!0);for(var f=0,e=this.bones.length;e>f;f++)this.bones[f].animations[0]&&this.bones[f].animations[0].deleteRange(b,d);this._ranges[b]=void 0;},e.prototype.getAnimationRange=function(b){return this._ranges[b];},e.prototype.getAnimationRanges=function(){var b,d,f;d=[],f=0;for(b in this._ranges)d[f]=this._ranges[b],f++;return d;},e.prototype.copyAnimationRange=function(c,d,f){var e,j,l,g,m,p,r,s;if(void 0===f&&(f=!1),this._ranges[d]||!c.getAnimationRange(d))return!1;l=!0,g=this._getHighestAnimationFrame()+1,m={},p=c.bones;j=0;for(e=p.length;e>j;j++)m[p[j].name]=p[j];this.bones.length!==p.length&&(b.Tools.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+p.length),l=!1);p=f&&this.dimensionsAtRest&&c.dimensionsAtRest?this.dimensionsAtRest.divide(c.dimensionsAtRest):null;j=0;for(e=this.bones.length;e>j;j++){r=this.bones[j].name,s=m[r];s?l=l&&this.bones[j].copyAnimationRange(s,d,g,f,p):(b.Tools.Warn("copyAnimationRange: not same rig, missing source bone "+r),l=!1);}c=c.getAnimationRange(d);return this._ranges[d]=new b.AnimationRange(d,c.from+g,c.to+g),l;},e.prototype.returnToRest=function(){y4tt.q9();for(var b=0;b<this.bones.length;b++)this.bones[b].returnToRest();},e.prototype._getHighestAnimationFrame=function(){var e;y4tt.q9();for(var b=0,d=0,f=this.bones.length;f>d;d++)if(this.bones[d].animations[0]){e=this.bones[d].animations[0].getHighestFrame();e>b&&(b=e);}return b;},e.prototype.beginAnimation=function(b,d,f,e){return(b=this.getAnimationRange(b))?this._scene.beginAnimation(this,b.from,b.to,d,f,e):null;},e.prototype._markAsDirty=function(){y4tt.q9();this._isDirty=!0;},e.prototype._registerMeshWithPoseMatrix=function(b){y4tt.q9();this._meshesWithPoseMatrix.push(b);},e.prototype._unregisterMeshWithPoseMatrix=function(b){b=this._meshesWithPoseMatrix.indexOf(b);y4tt.v9();-1<b&&this._meshesWithPoseMatrix.splice(b,1);},e.prototype._computeTransformMatrices=function(b,d){var e,j;for(var f=0;f<this.bones.length;f++){e=this.bones[f],j=e.getParent();j?e.getLocalMatrix().multiplyToRef(j.getWorldMatrix(),e.getWorldMatrix()):d?e.getLocalMatrix().multiplyToRef(d,e.getWorldMatrix()):e.getWorldMatrix().copyFrom(e.getLocalMatrix());e.getInvertedAbsoluteTransform().multiplyToArray(e.getWorldMatrix(),b,16*f);}this._identity.copyToArray(b,16*this.bones.length);},e.prototype.prepare=function(){var d,j;if(this._isDirty){if(this.needInitialSkinMatrix)for(var c=0;c<this._meshesWithPoseMatrix.length;c++){d=this._meshesWithPoseMatrix[c];d._bonesTransformMatrices&&d._bonesTransformMatrices.length===16*(this.bones.length+1)||(d._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)));for(var f=d.getPoseMatrix(),e=0;e<this.bones.length;e++){j=this.bones[e];j.getParent()||(j.getBaseMatrix().multiplyToRef(f,b.Tmp.Matrix[0]),j._updateDifferenceMatrix(b.Tmp.Matrix[0]));}this._computeTransformMatrices(d._bonesTransformMatrices,f);}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1))),this._computeTransformMatrices(this._transformMatrices,null);this._isDirty=!1;this._scene._activeBones+=this.bones.length;}},e.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var b=0;b<this.bones.length;b++)this._animatables.push(this.bones[b]);}return this._animatables;},e.prototype.clone=function(c,d){var f,j,l;f=new e(c,d||c,this._scene);y4tt.q9();f.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var g=0;g<this.bones.length;g++){j=this.bones[g],l=null;j.getParent()&&(l=this.bones.indexOf(j.getParent()),l=f.bones[l]);l=new b.Bone(j.name,f,l,j.getBaseMatrix().clone(),j.getRestPose().clone());b.Tools.DeepCopy(j.animations,l.animations);}if(this._ranges){f._ranges={};for(var n in this._ranges)f._ranges[n]=this._ranges[n].clone();}return this._isDirty=!0,f;},e.prototype.enableBlending=function(b){void 0===b&&(b=0.01);this.bones.forEach(function(d){y4tt.v9();d.animations.forEach(function(d){d.enableBlending=!0;y4tt.v9();d.blendingSpeed=b;});});},e.prototype.dispose=function(){this._meshesWithPoseMatrix=[];this.getScene().stopAnimation(this);this.getScene().removeSkeleton(this);},e.prototype.serialize=function(){var b,f,e;b={};b.name=this.name;b.id=this.id;y4tt.q9();b.dimensionsAtRest=this.dimensionsAtRest;b.bones=[];b.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var d=0;d<this.bones.length;d++){f=this.bones[d],e={parentBoneIndex:f.getParent()?this.bones.indexOf(f.getParent()):-1,name:f.name,matrix:f.getLocalMatrix().toArray(),rest:f.getRestPose().toArray()};b.bones.push(e);f.length&&(e.length=f.length);f.animations&&0<f.animations.length&&(e.animation=f.animations[0].serialize());b.ranges=[];for(var j in this._ranges)f={},f.name=j,f.from=this._ranges[j].from,f.to=this._ranges[j].to,b.ranges.push(f);}return b;},e.Parse=function(c,d){var f,g,j,l,n;f=new e(c.name,c.id,d);c.dimensionsAtRest&&(f.dimensionsAtRest=b.Vector3.FromArray(c.dimensionsAtRest));f.needInitialSkinMatrix=c.needInitialSkinMatrix;for(g=0;g<c.bones.length;g++){j=c.bones[g],l=null;-1<j.parentBoneIndex&&(l=f.bones[j.parentBoneIndex]);n=j.rest?b.Matrix.FromArray(j.rest):null,l=new b.Bone(j.name,f,l,b.Matrix.FromArray(j.matrix),n);j.length&&(l.length=j.length);j.animation&&l.animations.push(b.Animation.Parse(j.animation));}if(c.ranges)for(g=0;g<c.ranges.length;g++)j=c.ranges[g],f.createAnimationRange(j.name,j.from,j.to);return f;},e);y4tt.v9();b.Skeleton=g;}(BABYLON||(BABYLON={}));!function(b){var g;y4tt.q9();g=function(e,c,d,f,g,j,l,n,m,p,r){void 0===l&&(l=b.Texture.NEAREST_SAMPLINGMODE);void 0===r&&(r=b.Engine.TEXTURETYPE_UNSIGNED_INT);this.name=e;this.height=this.width=-1;this._reusable=this.enablePixelPerfectMode=!1;this._textures=new b.SmartArray(2);this._currentRenderTextureInd=0;this._scaleRatio=new b.Vector2(1,1);this.onActivateObservable=new b.Observable();this.onSizeChangedObservable=new b.Observable();this.onApplyObservable=new b.Observable();this.onBeforeRenderObservable=new b.Observable();this.onAfterRenderObservable=new b.Observable();null!=j?(this._camera=j,this._scene=j.getScene(),j.attachPostProcess(this),this._engine=this._scene.getEngine()):this._engine=n;this._options=g;this.renderTargetSamplingMode=l?l:b.Texture.NEAREST_SAMPLINGMODE;this._reusable=m||!1;this._textureType=r;this._samplers=f||[];this._samplers.push("textureSampler");this._fragmentUrl=c;this._parameters=d||[];this._parameters.push("scale");this.updateEffect(p);};g=(Object.defineProperty(g.prototype,"onActivate",{set:function(b){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver);y4tt.q9();this._onActivateObserver=this.onActivateObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"onSizeChanged",{set:function(b){y4tt.q9();this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver);this._onSizeChangedObserver=this.onSizeChangedObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"onApply",{set:function(b){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver);this._onApplyObserver=this.onApplyObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"onBeforeRender",{set:function(b){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(b);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"onAfterRender",{set:function(b){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver);this._onAfterRenderObserver=this.onAfterRenderObservable.add(b);},enumerable:!0,configurable:!0}),g.prototype.updateEffect=function(b){this._effect=this._engine.createEffect({vertex:"postprocess",fragment:this._fragmentUrl},["position"],this._parameters,this._samplers,void 0!==b?b:"");},g.prototype.isReusable=function(){y4tt.q9();return this._reusable;},g.prototype.markTextureDirty=function(){this.width=-1;},g.prototype.activate=function(e,c){var d,f,g,j,l,n;e=e||this._camera;d=e.getScene(),f=e.getEngine().getCaps().maxTextureSize,g=(c?c._width:this._engine.getRenderingCanvas().width)*this._options|0,j=(c?c._height:this._engine.getRenderingCanvas().height)*this._options|0,l=this._options.width||g,n=this._options.height||j;if(this.renderTargetSamplingMode!==b.Texture.NEAREST_SAMPLINGMODE&&(this._options.width||(l=b.Tools.GetExponentOfTwo(l,f)),this._options.height||(n=b.Tools.GetExponentOfTwo(n,f))),this.width!==l||this.height!==n){if(0<this._textures.length){for(f=0;f<this._textures.length;f++)this._engine._releaseTexture(this._textures.data[f]);this._textures.reset();}this.width=l;this.height=n;this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:0===e._postProcesses.indexOf(this),samplingMode:this.renderTargetSamplingMode,type:this._textureType}));this._reusable&&this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:0===e._postProcesses.indexOf(this),samplingMode:this.renderTargetSamplingMode,type:this._textureType}));this.onSizeChangedObservable.notifyObservers(this);}this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(g/l,j/n),this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd],0,g,j)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd]));this.onActivateObservable.notifyObservers(e);y4tt.q9();this.clearColor?this._engine.clear(this.clearColor,!0,!0):this._engine.clear(d.clearColor,d.autoClear||d.forceWireframe,!0);this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2);},Object.defineProperty(g.prototype,"isSupported",{get:function(){return this._effect.isSupported;},enumerable:!0,configurable:!0}),g.prototype.apply=function(){return this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setAlphaMode(b.Engine.ALPHA_DISABLE),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._effect._bindTexture("textureSampler",this._textures.data[this._currentRenderTextureInd]),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null;},g.prototype.dispose=function(b){y4tt.q9();if(b=b||this._camera,0<this._textures.length){for(var c=0;c<this._textures.length;c++)this._engine._releaseTexture(this._textures.data[c]);this._textures.reset();}b&&(b.detachPostProcess(this),0===b._postProcesses.indexOf(this)&&0<b._postProcesses.length&&this._camera._postProcesses[0].markTextureDirty(),this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear());},g);b.PostProcess=g;}(BABYLON||(BABYLON={}));!function(b){var g;y4tt.q9();g=function(b){this._vertexBuffers={};this._scene=b;};g=(g.prototype._prepareBuffers=function(){var e;if(!this._vertexBuffers[b.VertexBuffer.PositionKind]){e=[];e.push(1,1);e.push(-1,1);e.push(-1,-1);e.push(1,-1);this._vertexBuffers[b.VertexBuffer.PositionKind]=new b.VertexBuffer(this._scene.getEngine(),e,b.VertexBuffer.PositionKind,!1,!1,2);e=[];e.push(0);e.push(1);e.push(2);e.push(0);e.push(2);e.push(3);this._indexBuffer=this._scene.getEngine().createIndexBuffer(e);}},g.prototype._prepareFrame=function(b){var c;y4tt.v9();c=this._scene.activeCamera._postProcesses;return 0!==c.length&&this._scene.postProcessesEnabled?(c[0].activate(this._scene.activeCamera,b),!0):!1;},g.prototype.directRender=function(b,c){var g,j;for(var d=this._scene.getEngine(),f=0;f<b.length;f++){f<b.length-1?b[f+1].activate(this._scene.activeCamera,c):c?d.bindFramebuffer(c):d.restoreDefaultFramebuffer();g=b[f],j=g.apply();j&&(g.onBeforeRenderObservable.notifyObservers(j),this._prepareBuffers(),d.bindBuffers(this._vertexBuffers,this._indexBuffer,j),d.draw(!0,0,6),g.onAfterRenderObservable.notifyObservers(j));}d.setDepthBuffer(!0);d.setDepthWrite(!0);},g.prototype._finalizeFrame=function(b,c,d,f){var n,m;y4tt.v9();if(f=f||this._scene.activeCamera._postProcesses,0!==f.length&&this._scene.postProcessesEnabled){for(var g=this._scene.getEngine(),j=0,l=f.length;l>j&&(l-1>j?f[j+1].activate(this._scene.activeCamera,c):c?g.bindFramebuffer(c,d):g.restoreDefaultFramebuffer(),!b);j++){n=f[j],m=n.apply();m&&(n.onBeforeRenderObservable.notifyObservers(m),this._prepareBuffers(),g.bindBuffers(this._vertexBuffers,this._indexBuffer,m),g.draw(!0,0,6),n.onAfterRenderObservable.notifyObservers(m));}g.setDepthBuffer(!0);g.setDepthWrite(!0);}},g.prototype.dispose=function(){var e;e=this._vertexBuffers[b.VertexBuffer.PositionKind];y4tt.v9();e&&(e.dispose(),this._vertexBuffers[b.VertexBuffer.PositionKind]=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);},g);b.PostProcessManager=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.PostProcess;g=function(b,d,f,g,j,l){e.call(this,b,"pass",null,null,d,f,g,j,l);};g=(__extends(g,e),g);b.PassPostProcess=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=function(b,c){y4tt.v9();this.type=b;this.jointData=c;c.nativeParams=c.nativeParams||{};};g=(Object.defineProperty(e.prototype,"physicsJoint",{get:function(){y4tt.q9();return this._physicsJoint;},set:function(b){this._physicsJoint;y4tt.q9();this._physicsJoint=b;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsPlugin",{set:function(b){this._physicsPlugin=b;},enumerable:!0,configurable:!0}),e.prototype.executeNativeFunction=function(b){b(this._physicsPlugin.world,this._physicsJoint);},e.DistanceJoint=0,e.HingeJoint=1,e.BallAndSocketJoint=2,e.WheelJoint=3,e.SliderJoint=4,e.PrismaticJoint=5,e.UniversalJoint=6,e.Hinge2Joint=e.WheelJoint,e.PointToPointJoint=8,e.SpringJoint=9,e.LockJoint=10,e);y4tt.v9();b.PhysicsJoint=g;e=function(b){y4tt.q9();g.call(this,g.DistanceJoint,b);};e=(__extends(e,g),e.prototype.updateDistance=function(b,c){this._physicsPlugin.updateDistanceJoint(this,b,c);},e);b.DistanceJoint=e;e=function(b,c){g.call(this,b,c);};c=(__extends(e,g),e.prototype.setMotor=function(b,c){this._physicsPlugin.setMotor(this,b,c);},e.prototype.setLimit=function(b,c){this._physicsPlugin.setLimit(this,b,c);},e);b.MotorEnabledJoint=c;e=function(b){c.call(this,g.HingeJoint,b);};e=(__extends(e,c),e.prototype.setMotor=function(b,c){y4tt.q9();this._physicsPlugin.setMotor(this,b,c);},e.prototype.setLimit=function(b,c){y4tt.q9();this._physicsPlugin.setLimit(this,b,c);},e);b.HingeJoint=e;e=function(b){y4tt.v9();c.call(this,g.Hinge2Joint,b);};e=(__extends(e,c),e.prototype.setMotor=function(b,c,e){void 0===e&&(e=0);y4tt.q9();this._physicsPlugin.setMotor(this,b,c,e);},e.prototype.setLimit=function(b,c,e){void 0===e&&(e=0);this._physicsPlugin.setLimit(this,b,c,e);},e);b.Hinge2Joint=e;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(c,d,f,e){var j;j=this;y4tt.q9();return void 0===f&&(f={mass:0}),this.object=c,this.type=d,this._options=f,this._scene=e,this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=[],this._onAfterPhysicsStepCallbacks=[],this._onPhysicsCollideCallbacks=[],this._deltaPosition=b.Vector3.Zero(),this._tmpPositionWithDelta=b.Vector3.Zero(),this._tmpRotationWithDelta=new b.Quaternion(),this.beforeStep=function(){y4tt.v9();j.object.position.subtractToRef(j._deltaPosition,j._tmpPositionWithDelta);j._deltaRotationConjugated?j.object.rotationQuaternion.multiplyToRef(j._deltaRotationConjugated,j._tmpRotationWithDelta):j._tmpRotationWithDelta.copyFrom(j.object.rotationQuaternion);j._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(j,j._tmpPositionWithDelta,j._tmpRotationWithDelta);j._onBeforePhysicsStepCallbacks.forEach(function(b){y4tt.v9();b(j);});},this.afterStep=function(){j._onAfterPhysicsStepCallbacks.forEach(function(b){y4tt.q9();b(j);});j._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(j);j.object.position.addInPlace(j._deltaPosition);j._deltaRotation&&j.object.rotationQuaternion.multiplyInPlace(j._deltaRotation);},this.onCollide=function(b){var c;if(j._onPhysicsCollideCallbacks.length){c=j._physicsEngine.getImpostorWithPhysicsBody(b.body);c&&j._onPhysicsCollideCallbacks.filter(function(b){return-1!==b.otherImpostors.indexOf(c);}).forEach(function(b){y4tt.v9();b.callback(j,c);});}},this.object?(!this._scene&&c.getScene&&(this._scene=c.getScene()),this._physicsEngine=this._scene.getPhysicsEngine(),void(this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=b.Quaternion.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new b.Quaternion()),this._options.mass=void 0===f.mass?0:f.mass,this._options.friction=void 0===f.friction?0.2:f.friction,this._options.restitution=void 0===f.restitution?0.2:f.restitution,this._joints=[],this.object.parent||this._init()):b.Tools.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):void b.Tools.Error("No object was provided. A physics object is obligatory");};g=(e.prototype._init=function(){y4tt.q9();this._physicsEngine.removeImpostor(this);this.physicsBody=null;this._parent=this._parent||this._getPhysicsParent();this.parent||this._physicsEngine.addImpostor(this);},e.prototype._getPhysicsParent=function(){if(this.object.parent instanceof b.AbstractMesh)return this.object.parent.physicsImpostor;},e.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent;},e.prototype.setScalingUpdated=function(){y4tt.v9();this.forceUpdate();},e.prototype.forceUpdate=function(){this._init();this.parent&&this.parent.forceUpdate();},Object.defineProperty(e.prototype,"physicsBody",{get:function(){return this._parent?this._parent.physicsBody:this._physicsBody;},set:function(b){this._physicsBody&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this);this._physicsBody=b;y4tt.q9();this.resetUpdateFlags();},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){y4tt.q9();return this._parent;},enumerable:!0,configurable:!0}),e.prototype.resetUpdateFlags=function(){y4tt.q9();this._bodyUpdateRequired=!1;},e.prototype.getObjectExtendSize=function(){y4tt.v9();return this.object.getBoundingInfo?(this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),this.object.getBoundingInfo().boundingBox.extendSize.scale(2).multiply(this.object.scaling)):e.DEFAULT_OBJECT_SIZE;},e.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.center:this.object.position;},e.prototype.getParam=function(b){y4tt.q9();return this._options[b];},e.prototype.setParam=function(b,d){this._options[b]=d;y4tt.v9();this._bodyUpdateRequired=!0;},e.prototype.setMass=function(b){this.getParam("mass")!==b&&this.setParam("mass",b);this._physicsEngine.getPhysicsPlugin().setBodyMass(this,b);},e.prototype.getLinearVelocity=function(){return this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this);},e.prototype.setLinearVelocity=function(b){this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,b);},e.prototype.getAngularVelocity=function(){return this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this);},e.prototype.setAngularVelocity=function(b){y4tt.q9();this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,b);},e.prototype.executeNativeFunction=function(b){y4tt.q9();b(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody);},e.prototype.registerBeforePhysicsStep=function(b){this._onBeforePhysicsStepCallbacks.push(b);},e.prototype.unregisterBeforePhysicsStep=function(c){c=this._onBeforePhysicsStepCallbacks.indexOf(c);-1<c?this._onBeforePhysicsStepCallbacks.splice(c,1):b.Tools.Warn("Function to remove was not found");},e.prototype.registerAfterPhysicsStep=function(b){y4tt.v9();this._onAfterPhysicsStepCallbacks.push(b);},e.prototype.unregisterAfterPhysicsStep=function(c){c=this._onAfterPhysicsStepCallbacks.indexOf(c);-1<c?this._onAfterPhysicsStepCallbacks.splice(c,1):b.Tools.Warn("Function to remove was not found");},e.prototype.registerOnPhysicsCollide=function(b,d){this._onPhysicsCollideCallbacks.push({callback:d,otherImpostors:b instanceof Array?b:[b]});},e.prototype.unregisterOnPhysicsCollide=function(c,d){var f;f=this._onPhysicsCollideCallbacks.indexOf({callback:d,otherImpostors:c instanceof Array?c:[c]});-1<f?this._onPhysicsCollideCallbacks.splice(f,1):b.Tools.Warn("Function to remove was not found");},e.prototype.applyForce=function(b,d){y4tt.v9();this._physicsEngine.getPhysicsPlugin().applyForce(this,b,d);},e.prototype.applyImpulse=function(b,d){y4tt.v9();this._physicsEngine.getPhysicsPlugin().applyImpulse(this,b,d);},e.prototype.createJoint=function(c,d,f){d=new b.PhysicsJoint(d,f);this.addJoint(c,d);},e.prototype.addJoint=function(b,d){this._joints.push({otherImpostor:b,joint:d});this._physicsEngine.addJoint(this,b,d);},e.prototype.sleep=function(){y4tt.v9();this._physicsEngine.getPhysicsPlugin().sleepBody(this);},e.prototype.wakeUp=function(){y4tt.q9();this._physicsEngine.getPhysicsPlugin().wakeUpBody(this);},e.prototype.clone=function(b){y4tt.q9();return b?new e(b,this.type,this._options,this._scene):null;},e.prototype.dispose=function(){var b;b=this;this._physicsEngine&&(this._joints.forEach(function(d){b._physicsEngine.removeJoint(b,d.otherImpostor,d.joint);}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate());},e.prototype.setDeltaPosition=function(b){this._deltaPosition.copyFrom(b);},e.prototype.setDeltaRotation=function(c){y4tt.q9();this._deltaRotation||(this._deltaRotation=new b.Quaternion());this._deltaRotation.copyFrom(c);this._deltaRotationConjugated=this._deltaRotation.conjugate();},e.DEFAULT_OBJECT_SIZE=new b.Vector3(1,1,1),e.NoImpostor=0,e.SphereImpostor=1,e.BoxImpostor=2,e.PlaneImpostor=3,e.MeshImpostor=4,e.CylinderImpostor=7,e.ParticleImpostor=8,e.HeightmapImpostor=9,e);b.PhysicsImpostor=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(e,c){if(void 0===c&&(c=new b.CannonJSPlugin()),this._physicsPlugin=c,this._impostors=[],this._joints=[],!this._physicsPlugin.isSupported())throw Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");e=e||new b.Vector3(0,-9.807,0);this.setGravity(e);this.setTimeStep();};g=(g.prototype.setGravity=function(b){y4tt.q9();this.gravity=b;this._physicsPlugin.setGravity(this.gravity);},g.prototype.setTimeStep=function(b){void 0===b&&(b=1/60);this._physicsPlugin.setTimeStep(b);},g.prototype.dispose=function(){this._impostors.forEach(function(b){y4tt.q9();b.dispose();});this._physicsPlugin.dispose();},g.prototype.getPhysicsPluginName=function(){y4tt.v9();return this._physicsPlugin.name;},g.prototype.addImpostor=function(b){y4tt.v9();b.uniqueId=this._impostors.push(b);b.parent||this._physicsPlugin.generatePhysicsBody(b);},g.prototype.removeImpostor=function(b){b=this._impostors.indexOf(b);y4tt.q9();-1<b&&(b=this._impostors.splice(b,1),b.length&&(b[0].physicsBody=null));},g.prototype.addJoint=function(b,c,d){b={mainImpostor:b,connectedImpostor:c,joint:d};y4tt.q9();d.physicsPlugin=this._physicsPlugin;this._joints.push(b);this._physicsPlugin.generateJoint(b);},g.prototype.removeJoint=function(b,c,d){var f;f=this._joints.filter(function(f){y4tt.q9();return f.connectedImpostor===c&&f.joint===d&&f.mainImpostor===b;});f.length&&this._physicsPlugin.removeJoint(f[0]);},g.prototype._step=function(b){var c;c=this;this._impostors.forEach(function(b){y4tt.v9();b.isBodyInitRequired()&&c._physicsPlugin.generatePhysicsBody(b);});0.1<b?b=0.1:0>=b&&(b=1/60);this._physicsPlugin.executeStep(b,this._impostors);},g.prototype.getPhysicsPlugin=function(){return this._physicsPlugin;},g.prototype.getImpostorForPhysicsObject=function(b){y4tt.q9();for(var c=0;c<this._impostors.length;++c)if(this._impostors[c].object===b)return this._impostors[c];},g.prototype.getImpostorWithPhysicsBody=function(b){for(var c=0;c<this._impostors.length;++c)if(this._impostors[c].physicsBody===b)return this._impostors[c];},g.NoImpostor=b.PhysicsImpostor.NoImpostor,g.SphereImpostor=b.PhysicsImpostor.SphereImpostor,g.BoxImpostor=b.PhysicsImpostor.BoxImpostor,g.PlaneImpostor=b.PhysicsImpostor.PlaneImpostor,g.MeshImpostor=b.PhysicsImpostor.MeshImpostor,g.CylinderImpostor=b.PhysicsImpostor.CylinderImpostor,g.HeightmapImpostor=b.PhysicsImpostor.HeightmapImpostor,g.CapsuleImpostor=-1,g.ConeImpostor=-1,g.ConvexHullImpostor=-1,g.Epsilon=0.001,g);y4tt.v9();b.PhysicsEngine=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(){};y4tt.v9();g=(e.prototype.set=function(c,d){switch(d){case b.VertexBuffer.PositionKind:this.positions=c;break;case b.VertexBuffer.NormalKind:this.normals=c;break;case b.VertexBuffer.UVKind:this.uvs=c;break;case b.VertexBuffer.UV2Kind:this.uvs2=c;break;case b.VertexBuffer.UV3Kind:this.uvs3=c;break;case b.VertexBuffer.UV4Kind:this.uvs4=c;break;case b.VertexBuffer.UV5Kind:this.uvs5=c;break;case b.VertexBuffer.UV6Kind:this.uvs6=c;break;case b.VertexBuffer.ColorKind:this.colors=c;break;case b.VertexBuffer.MatricesIndicesKind:this.matricesIndices=c;break;case b.VertexBuffer.MatricesWeightsKind:this.matricesWeights=c;break;case b.VertexBuffer.MatricesIndicesExtraKind:this.matricesIndicesExtra=c;break;case b.VertexBuffer.MatricesWeightsExtraKind:this.matricesWeightsExtra=c;}},e.prototype.applyToMesh=function(b,d){this._applyTo(b,d);},e.prototype.applyToGeometry=function(b,d){y4tt.v9();this._applyTo(b,d);},e.prototype.updateMesh=function(b){y4tt.v9();this._update(b);},e.prototype.updateGeometry=function(b){this._update(b);},e.prototype._applyTo=function(c,d){this.positions&&c.setVerticesData(b.VertexBuffer.PositionKind,this.positions,d);this.normals&&c.setVerticesData(b.VertexBuffer.NormalKind,this.normals,d);this.uvs&&c.setVerticesData(b.VertexBuffer.UVKind,this.uvs,d);this.uvs2&&c.setVerticesData(b.VertexBuffer.UV2Kind,this.uvs2,d);this.uvs3&&c.setVerticesData(b.VertexBuffer.UV3Kind,this.uvs3,d);this.uvs4&&c.setVerticesData(b.VertexBuffer.UV4Kind,this.uvs4,d);this.uvs5&&c.setVerticesData(b.VertexBuffer.UV5Kind,this.uvs5,d);this.uvs6&&c.setVerticesData(b.VertexBuffer.UV6Kind,this.uvs6,d);this.colors&&c.setVerticesData(b.VertexBuffer.ColorKind,this.colors,d);this.matricesIndices&&c.setVerticesData(b.VertexBuffer.MatricesIndicesKind,this.matricesIndices,d);this.matricesWeights&&c.setVerticesData(b.VertexBuffer.MatricesWeightsKind,this.matricesWeights,d);this.matricesIndicesExtra&&c.setVerticesData(b.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,d);this.matricesWeightsExtra&&c.setVerticesData(b.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,d);this.indices&&c.setIndices(this.indices);},e.prototype._update=function(c,d,f){this.positions&&c.updateVerticesData(b.VertexBuffer.PositionKind,this.positions,d,f);y4tt.q9();this.normals&&c.updateVerticesData(b.VertexBuffer.NormalKind,this.normals,d,f);this.uvs&&c.updateVerticesData(b.VertexBuffer.UVKind,this.uvs,d,f);this.uvs2&&c.updateVerticesData(b.VertexBuffer.UV2Kind,this.uvs2,d,f);this.uvs3&&c.updateVerticesData(b.VertexBuffer.UV3Kind,this.uvs3,d,f);this.uvs4&&c.updateVerticesData(b.VertexBuffer.UV4Kind,this.uvs4,d,f);this.uvs5&&c.updateVerticesData(b.VertexBuffer.UV5Kind,this.uvs5,d,f);this.uvs6&&c.updateVerticesData(b.VertexBuffer.UV6Kind,this.uvs6,d,f);this.colors&&c.updateVerticesData(b.VertexBuffer.ColorKind,this.colors,d,f);this.matricesIndices&&c.updateVerticesData(b.VertexBuffer.MatricesIndicesKind,this.matricesIndices,d,f);this.matricesWeights&&c.updateVerticesData(b.VertexBuffer.MatricesWeightsKind,this.matricesWeights,d,f);this.matricesIndicesExtra&&c.updateVerticesData(b.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,d,f);this.matricesWeightsExtra&&c.updateVerticesData(b.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,d,f);this.indices&&c.setIndices(this.indices);},e.prototype.transform=function(c){var d,f,e;f=b.Vector3.Zero();if(this.positions){e=b.Vector3.Zero();for(d=0;d<this.positions.length;d+=3)b.Vector3.FromArrayToRef(this.positions,d,e),b.Vector3.TransformCoordinatesToRef(e,c,f),this.positions[d]=f.x,this.positions[d+1]=f.y,this.positions[d+2]=f.z;}if(this.normals){e=b.Vector3.Zero();for(d=0;d<this.normals.length;d+=3)b.Vector3.FromArrayToRef(this.normals,d,e),b.Vector3.TransformNormalToRef(e,c,f),this.normals[d]=f.x,this.normals[d+1]=f.y,this.normals[d+2]=f.z;}},e.prototype.merge=function(b){if(b.indices){this.indices||(this.indices=[]);for(var d=this.positions?this.positions.length/3:0,f=0;f<b.indices.length;f++)this.indices.push(b.indices[f]+d);}y4tt.q9();this.positions=this._mergeElement(this.positions,b.positions);this.normals=this._mergeElement(this.normals,b.normals);this.uvs=this._mergeElement(this.uvs,b.uvs);this.uvs2=this._mergeElement(this.uvs2,b.uvs2);this.uvs3=this._mergeElement(this.uvs3,b.uvs3);this.uvs4=this._mergeElement(this.uvs4,b.uvs4);this.uvs5=this._mergeElement(this.uvs5,b.uvs5);this.uvs6=this._mergeElement(this.uvs6,b.uvs6);this.colors=this._mergeElement(this.colors,b.colors);this.matricesIndices=this._mergeElement(this.matricesIndices,b.matricesIndices);this.matricesWeights=this._mergeElement(this.matricesWeights,b.matricesWeights);this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,b.matricesIndicesExtra);this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,b.matricesWeightsExtra);},e.prototype._mergeElement=function(b,d){var f,e;if(!d)return b;y4tt.q9();if(!b)return d;f=d.length+b.length,e=d instanceof Float32Array;if(b instanceof Float32Array)return f=new Float32Array(f),f.set(b),f.set(d,b.length),f;if(e){for(var e=b.slice(0),j=0,f=d.length;f>j;j++)e.push(d[j]);return e;}return b.concat(d);},e.prototype.serialize=function(){var b;b=this.serialize();return this.positions&&(b.positions=this.positions),this.normals&&(b.normals=this.normals),this.uvs&&(b.uvs=this.uvs),this.uvs2&&(b.uvs2=this.uvs2),this.uvs3&&(b.uvs3=this.uvs3),this.uvs4&&(b.uvs4=this.uvs4),this.uvs5&&(b.uvs5=this.uvs5),this.uvs6&&(b.uvs6=this.uvs6),this.colors&&(b.colors=this.colors),this.matricesIndices&&(b.matricesIndices=this.matricesIndices,b.matricesIndices._isExpanded=!0),this.matricesWeights&&(b.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(b.matricesIndicesExtra=this.matricesIndicesExtra,b.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(b.matricesWeightsExtra=this.matricesWeightsExtra),b.indices=this.indices,b;},e.ExtractFromMesh=function(b,d){return e._ExtractFrom(b,d);},e.ExtractFromGeometry=function(b,d){return e._ExtractFrom(b,d);},e._ExtractFrom=function(c,d){var f;y4tt.v9();f=new e();return c.isVerticesDataPresent(b.VertexBuffer.PositionKind)&&(f.positions=c.getVerticesData(b.VertexBuffer.PositionKind,d)),c.isVerticesDataPresent(b.VertexBuffer.NormalKind)&&(f.normals=c.getVerticesData(b.VertexBuffer.NormalKind,d)),c.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(f.uvs=c.getVerticesData(b.VertexBuffer.UVKind,d)),c.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(f.uvs2=c.getVerticesData(b.VertexBuffer.UV2Kind,d)),c.isVerticesDataPresent(b.VertexBuffer.UV3Kind)&&(f.uvs3=c.getVerticesData(b.VertexBuffer.UV3Kind,d)),c.isVerticesDataPresent(b.VertexBuffer.UV4Kind)&&(f.uvs4=c.getVerticesData(b.VertexBuffer.UV4Kind,d)),c.isVerticesDataPresent(b.VertexBuffer.UV5Kind)&&(f.uvs5=c.getVerticesData(b.VertexBuffer.UV5Kind,d)),c.isVerticesDataPresent(b.VertexBuffer.UV6Kind)&&(f.uvs6=c.getVerticesData(b.VertexBuffer.UV6Kind,d)),c.isVerticesDataPresent(b.VertexBuffer.ColorKind)&&(f.colors=c.getVerticesData(b.VertexBuffer.ColorKind,d)),c.isVerticesDataPresent(b.VertexBuffer.MatricesIndicesKind)&&(f.matricesIndices=c.getVerticesData(b.VertexBuffer.MatricesIndicesKind,d)),c.isVerticesDataPresent(b.VertexBuffer.MatricesWeightsKind)&&(f.matricesWeights=c.getVerticesData(b.VertexBuffer.MatricesWeightsKind,d)),c.isVerticesDataPresent(b.VertexBuffer.MatricesIndicesExtraKind)&&(f.matricesIndicesExtra=c.getVerticesData(b.VertexBuffer.MatricesIndicesExtraKind,d)),c.isVerticesDataPresent(b.VertexBuffer.MatricesWeightsExtraKind)&&(f.matricesWeightsExtra=c.getVerticesData(b.VertexBuffer.MatricesWeightsExtraKind,d)),f.indices=c.getIndices(d),f;},e.CreateRibbon=function(c){var d,f,g,j,l,n,m,p,r,s,t,v,y,x,z,B,A,C,G,D,F,O,E;d=c.pathArray,f=c.closeArray||!1,g=c.closePath||!1,j=Math.floor(d[0].length/2),l=c.offset||j,l=l>j?j:Math.floor(l),p=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE;c=[];j=[],r=[],s=[],t=[],v=[],y=[],x=[],z=[],B=[];if(2>d.length){n=[];A=[];for(m=0;m<d[0].length-l;m++)n.push(d[0][m]),A.push(d[0][m+l]);d=[n,A];}D=0,A=g?1:0;n=d[0].length;for(var H,J,l=0;l<d.length;l++){y[l]=0;t[l]=[0];C=d[l];G=C.length;n=G>n?n:G;for(m=0;G>m;)c.push(C[m].x,C[m].y,C[m].z),0<m&&(H=C[m].subtract(C[m-1]).length(),J=H+y[l],t[l].push(J),y[l]=J),m++;g&&(m--,c.push(C[0].x,C[0].y,C[0].z),H=C[m].subtract(C[0]).length(),J=H+y[l],t[l].push(J),y[l]=J);z[l]=G+A;B[l]=D;D+=G+A;}for(m=0;n+A>m;m++){x[m]=0;v[m]=[0];for(l=0;l<d.length-1;l++)H=d[l],F=d[l+1],m===n?(O=H[0],E=F[0]):(O=H[m],E=F[m]),H=E.subtract(O).length(),J=H+x[m],v[m].push(J),x[m]=J;f&&(F=d[0],m===n&&(E=F[0]),H=E.subtract(O).length(),J=H+x[m],x[m]=J);}for(l=0;l<d.length;l++)for(m=0;n+A>m;m++)F=t[l][m]/y[l],O=v[m][l]/x[m],s.push(F,O);t=l=0;v=z[l]-1;y=z[l+1]-1;x=y>v?v:y;F=B[1]-B[0];for(f=f?z.length:z.length-1;x>=t&&f>l;)j.push(t,t+F,t+1),j.push(t+F+1,t+1,t+F),t+=1,t===x&&(l++,l===z.length-1?(F=B[0]-B[l],v=z[l]-1,y=z[0]-1):(F=B[l+1]-B[l],v=z[l]-1,y=z[l+1]-1),t=B[l],x=y>v?v+t:y+t);y4tt.v9();if(e.ComputeNormals(c,j,r),g)for(l=z=f=0;l<d.length;l++)f=3*B[l],z=l+1<d.length?3*(B[l+1]-1):r.length-3,r[f]=0.5*(r[f]+r[z]),r[f+1]=0.5*(r[f+1]+r[z+1]),r[f+2]=0.5*(r[f+2]+r[z+2]),r[z]=r[f],r[z+1]=r[f+1],r[z+2]=r[f+2];e._ComputeSides(p,c,j,r,s);d=new e();return d.indices=j,d.positions=c,d.normals=r,d.uvs=s,g&&(d._idx=B),d;},e.CreateBox=function(c){var d,f,g,j,l,n,m,p,r,s,v,y,x;d=[new b.Vector3(0,0,1),new b.Vector3(0,0,-1),new b.Vector3(1,0,0),new b.Vector3(-1,0,0),new b.Vector3(0,1,0),new b.Vector3(0,-1,0)],f=[],g=[],j=[],l=[],n=c.width||c.size||1,m=c.height||c.size||1,p=c.depth||c.size||1,r=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE,s=c.faceUV||Array(6);c=c.faceColors;for(var t=[],v=0;6>v;v++)void 0===s[v]&&(s[v]=new b.Vector4(0,0,1,1)),c&&void 0===c[v]&&(c[v]=new b.Color4(1,1,1,1));n=new b.Vector3(n/2,m/2,p/2);for(m=0;m<d.length;m++){p=d[m],v=new b.Vector3(p.y,p.z,p.x),y=b.Vector3.Cross(p,v),x=g.length/3;f.push(x);f.push(x+1);f.push(x+2);f.push(x);f.push(x+2);f.push(x+3);x=p.subtract(v).subtract(y).multiply(n);g.push(x.x,x.y,x.z);j.push(p.x,p.y,p.z);l.push(s[m].z,s[m].w);c&&t.push(c[m].r,c[m].g,c[m].b,c[m].a);x=p.subtract(v).add(y).multiply(n);g.push(x.x,x.y,x.z);j.push(p.x,p.y,p.z);l.push(s[m].x,s[m].w);c&&t.push(c[m].r,c[m].g,c[m].b,c[m].a);x=p.add(v).add(y).multiply(n);g.push(x.x,x.y,x.z);j.push(p.x,p.y,p.z);l.push(s[m].x,s[m].y);c&&t.push(c[m].r,c[m].g,c[m].b,c[m].a);x=p.add(v).subtract(y).multiply(n);g.push(x.x,x.y,x.z);j.push(p.x,p.y,p.z);l.push(s[m].z,s[m].y);c&&t.push(c[m].r,c[m].g,c[m].b,c[m].a);}e._ComputeSides(r,g,f,j,l);d=new e();if(d.indices=f,d.positions=g,d.normals=j,d.uvs=l,c)f=r===b.Mesh.DOUBLESIDE?t.concat(t):t,d.colors=f;return d;},e.CreateSphere=function(c){var d,f,g,j,x,z,B;d=c.segments||32,f=0>=c.arc||1<c.arc?1:c.arc||1,g=0>=c.slice?1:c.slice||1,j=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE;c=new b.Vector3((c.diameterX||c.diameter||1)/2,(c.diameterY||c.diameter||1)/2,(c.diameterZ||c.diameter||1)/2);for(var l=2+d,n=2*l,d=[],m=[],p=[],r=[],s=0;l>=s;s++){for(var t=s/l,v=t*Math.PI*g,y=0;n>=y;y++){x=y/n,z=2*(x*Math.PI)*f,B=b.Matrix.RotationZ(-v),z=b.Matrix.RotationY(z),B=b.Vector3.TransformCoordinates(b.Vector3.Up(),B),z=b.Vector3.TransformCoordinates(B,z),B=z.multiply(c),z=z.divide(c).normalize();m.push(B.x,B.y,B.z);p.push(z.x,z.y,z.z);r.push(x,t);}if(0<s){t=m.length/3;for(v=t-2*(n+1);t>v+n+2;v++)d.push(v),d.push(v+1),d.push(v+n+1),d.push(v+n+1),d.push(v+1),d.push(v+n+2);}}e._ComputeSides(j,m,d,p,r);f=new e();return f.indices=d,f.positions=m,f.normals=p,f.uvs=r,f;},e.CreateCylinder=function(c){var d,f,g,j,l,n,m,p,r,s,t,v,y,x,z,B,A,C,G,D,H,J,F,O,E,L,N,P,M,I,Q,K,R,Z,ba,X,va;d=c.height||2,f=0===c.diameterTop?0:c.diameterTop||c.diameter||1,g=c.diameterBottom||c.diameter||1,j=c.tessellation||24,l=c.subdivisions||1,n=c.hasRings,m=c.enclose,p=0>=c.arc||1<c.arc?1:c.arc||1,r=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE,s=c.faceUV||Array(3),t=c.faceColors,v=2+(1+(1!==p&&m?2:0))*(n?l:1);for(c=0;v>c;c++)t&&void 0===t[c]&&(t[c]=new b.Color4(1,1,1,1));for(c=0;v>c;c++)s&&void 0===s[c]&&(s[c]=new b.Vector4(0,0,1,1));C=[],G=[],D=[],H=[],J=[],F=2*Math.PI*p/j,O=(g-f)/2/d,E=b.Vector3.Zero(),L=b.Vector3.Zero(),N=b.Vector3.Zero(),P=b.Vector3.Zero(),M=b.Vector3.Zero(),I=b.Axis.Y,Q=1,K=1,R=0;for(c=y=0;l>=c;c++){x=c/l;z=(x*(f-g)+g)/2;Q=n&&0!==c&&c!==l?2:1;for(A=0;Q>A;A++){n&&(K+=A);m&&(K+=2*A);for(B=0;j>=B;B++)y=B*F,E.x=Math.cos(-y)*z,E.y=-d/2+x*d,E.z=Math.sin(-y)*z,0===f&&c===l?(L.x=D[D.length-3*(j+1)],L.y=D[D.length-3*(j+1)+1],L.z=D[D.length-3*(j+1)+2]):(L.x=E.x,L.z=E.z,L.y=Math.sqrt(L.x*L.x+L.z*L.z)*O,L.normalize()),0===B&&(N.copyFrom(E),P.copyFrom(L)),G.push(E.x,E.y,E.z),D.push(L.x,L.y,L.z),y=n?R!==K?s[K].y:s[K].w:s[K].y+(s[K].w-s[K].y)*x,H.push(s[K].x+(s[K].z-s[K].x)*B/j,y),t&&J.push(t[K].r,t[K].g,t[K].b,t[K].a);1!==p&&m&&(G.push(E.x,E.y,E.z),G.push(0,E.y,0),G.push(0,E.y,0),G.push(N.x,N.y,N.z),b.Vector3.CrossToRef(I,L,M),M.normalize(),D.push(M.x,M.y,M.z,M.x,M.y,M.z),b.Vector3.CrossToRef(P,I,M),M.normalize(),D.push(M.x,M.y,M.z,M.x,M.y,M.z),y=n?R!==K?s[K+1].y:s[K+1].w:s[K+1].y+(s[K+1].w-s[K+1].y)*x,H.push(s[K+1].x,y),H.push(s[K+1].z,y),y=n?R!==K?s[K+2].y:s[K+2].w:s[K+2].y+(s[K+2].w-s[K+2].y)*x,H.push(s[K+2].x,y),H.push(s[K+2].z,y),t&&(J.push(t[K+1].r,t[K+1].g,t[K+1].b,t[K+1].a),J.push(t[K+1].r,t[K+1].g,t[K+1].b,t[K+1].a),J.push(t[K+2].r,t[K+2].g,t[K+2].b,t[K+2].a),J.push(t[K+2].r,t[K+2].g,t[K+2].b,t[K+2].a)));R!==K&&(R=K);}}x=1!==p&&m?j+4:j;for(K=c=0;l>K;K++){for(B=0;j>B;B++){Z=c*(x+1)+B,ba=(c+1)*(x+1)+B,X=c*(x+1)+(B+1),va=(c+1)*(x+1)+(B+1);C.push(Z,ba,X);C.push(va,X,ba);}1!==p&&m&&(C.push(Z+2,ba+2,X+2),C.push(va+2,X+2,ba+2),C.push(Z+4,ba+4,X+4),C.push(va+4,X+4,ba+4));c=n?c+2:c+1;}l=function(c){var e,l,m,n,r,y,x,z,B,A;y4tt.q9();e=c?f/2:g/2;if(0!==e){r=c?s[v-1]:s[0];t&&(n=c?t[v-1]:t[0]);y=G.length/3,x=c?d/2:-d/2;m=new b.Vector3(0,x,0);G.push(m.x,m.y,m.z);D.push(0,c?1:-1,0);H.push(r.x+0.5*(r.z-r.x),r.y+0.5*(r.w-r.y));t&&J.push(n.r,n.g,n.b,n.a);z=new b.Vector2(0.5,0.5);for(m=0;j>=m;m++){l=2*Math.PI*m*p/j;B=Math.cos(-l),A=Math.sin(-l);l=new b.Vector3(B*e,x,A*e);B=new b.Vector2(B*z.x+0.5,A*z.y+0.5);G.push(l.x,l.y,l.z);D.push(0,c?1:-1,0);H.push(r.x+(r.z-r.x)*B.x,r.y+(r.w-r.y)*B.y);t&&J.push(n.r,n.g,n.b,n.a);}for(m=0;j>m;m++)c?(C.push(y),C.push(y+(m+2)),C.push(y+(m+1))):(C.push(y),C.push(y+(m+1)),C.push(y+(m+2)));}};l(!1);l(!0);e._ComputeSides(r,G,C,D,H);r=new e();return r.indices=C,r.positions=G,r.normals=D,r.uvs=H,t&&(r.colors=J),r;},e.CreateTorus=function(c){var d,f,g,j,l,n,m,y,x,z;d=[],f=[],g=[],j=[],l=c.diameter||1,n=c.thickness||0.5,m=c.tessellation||16;c=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE;for(var p=m+1,r=0;m>=r;r++)for(var s=r/m,t=2*r*Math.PI/m-Math.PI/2,t=b.Matrix.Translation(l/2,0,0).multiply(b.Matrix.RotationY(t)),v=0;m>=v;v++){y=1-v/m,x=2*v*Math.PI/m+Math.PI,z=Math.cos(x),x=Math.sin(x),z=new b.Vector3(z,x,0),x=z.scale(n/2),y=new b.Vector2(s,y),x=b.Vector3.TransformCoordinates(x,t),z=b.Vector3.TransformNormal(z,t);f.push(x.x,x.y,x.z);g.push(z.x,z.y,z.z);j.push(y.x,y.y);y=(r+1)%p;z=(v+1)%p;d.push(r*p+v);d.push(r*p+z);d.push(y*p+v);d.push(r*p+z);d.push(y*p+z);d.push(y*p+v);}e._ComputeSides(c,f,d,g,j);y4tt.q9();l=new e();return l.indices=d,l.positions=f,l.normals=g,l.uvs=j,l;},e.CreateLineSystem=function(b){var d,f;y4tt.v9();d=[],f=[];b=b.lines;for(var g=0,j=0;j<b.length;j++)for(var l=b[j],n=0;n<l.length;n++)f.push(l[n].x,l[n].y,l[n].z),0<n&&(d.push(g-1),d.push(g)),g++;b=new e();return b.indices=d,b.positions=f,b;},e.CreateDashedLines=function(c){var d,f,g,j;d=c.dashSize||3,f=c.gapSize||1,g=c.dashNb||200,j=c.points;c=[];for(var l=[],n=b.Vector3.Zero(),m=0,p=0,r=0,s=0,t=0,v=0,y=0,y=0;y<j.length-1;y++)j[y+1].subtractToRef(j[y],n),m+=n.length();r=m/g;s=d*r/(d+f);y4tt.q9();for(y=0;y<j.length-1;y++){j[y+1].subtractToRef(j[y],n);p=Math.floor(n.length()/r);n.normalize();for(d=0;p>d;d++)t=r*d,c.push(j[y].x+t*n.x,j[y].y+t*n.y,j[y].z+t*n.z),c.push(j[y].x+(t+s)*n.x,j[y].y+(t+s)*n.y,j[y].z+(t+s)*n.z),l.push(v,v+1),v+=2;}d=new e();return d.positions=c,d.indices=l,d;},e.CreateGround=function(c){var d,f,g,j,l,n,m,p,r,s;f=[],g=[],j=[],l=[],n=c.width||1,m=c.height||1,p=c.subdivisions||1;for(c=0;p>=c;c++)for(d=0;p>=d;d++){r=new b.Vector3(d*n/p-n/2,0,(p-c)*m/p-m/2),s=new b.Vector3(0,1,0);g.push(r.x,r.y,r.z);j.push(s.x,s.y,s.z);l.push(d/p,1-c/p);}for(c=0;p>c;c++)for(d=0;p>d;d++)f.push(d+1+(c+1)*(p+1)),f.push(d+1+c*(p+1)),f.push(d+c*(p+1)),f.push(d+(c+1)*(p+1)),f.push(d+1+(c+1)*(p+1)),f.push(d+c*(p+1));n=new e();return n.indices=f,n.positions=g,n.normals=j,n.uvs=l,n;},e.CreateTiledGround=function(c){var d,f,g,j,l,n,m,p,r,s,t,v,y,x,z,B,A,C,G,D;l=c.xmin,n=c.zmin,m=c.xmax;d=c.zmax;p=c.subdivisions||{w:1,h:1},r=c.precision||{w:1,h:1};c=[];s=[],t=[],v=[];p.h=1>p.w?1:p.h;p.w=1>p.w?1:p.w;r.w=1>r.w?1:r.w;r.h=1>r.h?1:r.h;m=(m-l)/p.w,y=(d-n)/p.h;for(g=0;g<p.h;g++)for(j=0;j<p.w;j++){x=l+j*m,z=n+g*y,B=l+(j+1)*m,A=n+(g+1)*y,C=s.length/3,G=r.w+1;for(d=0;d<r.h;d++)for(f=0;f<r.w;f++){D=[C+f+d*G,C+(f+1)+d*G,C+(f+1)+(d+1)*G,C+f+(d+1)*G];c.push(D[1]);c.push(D[2]);c.push(D[3]);c.push(D[0]);c.push(D[1]);c.push(D[3]);}C=b.Vector3.Zero();G=new b.Vector3(0,1,0);for(d=0;d<=r.h;d++){C.z=d*(A-z)/r.h+z;for(f=0;f<=r.w;f++)C.x=f*(B-x)/r.w+x,C.y=0,s.push(C.x,C.y,C.z),t.push(G.x,G.y,G.z),v.push(f/r.w,d/r.h);}}l=new e();return l.indices=c,l.positions=s,l.normals=t,l.uvs=v,l;},e.CreateGroundFromHeightMap=function(c){var d,f,g,j,l,n,m,p;g=[],j=[],l=[],n=[];for(d=0;d<=c.subdivisions;d++)for(f=0;f<=c.subdivisions;f++){m=new b.Vector3(f*c.width/c.subdivisions-c.width/2,0,(c.subdivisions-d)*c.height/c.subdivisions-c.height/2),p=4*(((m.x+c.width/2)/c.width*(c.bufferWidth-1)|0)+((1-(m.z+c.height/2)/c.height)*(c.bufferHeight-1)|0)*c.bufferWidth);m.y=c.minHeight+(c.maxHeight-c.minHeight)*(0.3*(c.buffer[p]/255)+0.59*(c.buffer[p+1]/255)+0.11*(c.buffer[p+2]/255));j.push(m.x,m.y,m.z);l.push(0,0,0);n.push(f/c.subdivisions,1-d/c.subdivisions);}for(d=0;d<c.subdivisions;d++)for(f=0;f<c.subdivisions;f++)g.push(f+1+(d+1)*(c.subdivisions+1)),g.push(f+1+d*(c.subdivisions+1)),g.push(f+d*(c.subdivisions+1)),g.push(f+(d+1)*(c.subdivisions+1)),g.push(f+1+(d+1)*(c.subdivisions+1)),g.push(f+d*(c.subdivisions+1));e.ComputeNormals(j,g,l);y4tt.q9();c=new e();return c.indices=g,c.positions=j,c.normals=l,c.uvs=n,c;},e.CreatePlane=function(c){var d,f,g,j,l,n;d=[],f=[],g=[],j=[],l=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE,n=(c.width||c.size||1)/2;c=(c.height||c.size||1)/2;f.push(-n,-c,0);g.push(0,0,-1);j.push(0,0);y4tt.q9();f.push(n,-c,0);g.push(0,0,-1);j.push(1,0);f.push(n,c,0);g.push(0,0,-1);j.push(1,1);f.push(-n,c,0);g.push(0,0,-1);j.push(0,1);d.push(0);d.push(1);d.push(2);d.push(0);d.push(2);d.push(3);e._ComputeSides(l,f,d,g,j);l=new e();return l.indices=d,l.positions=f,l.normals=g,l.uvs=j,l;},e.CreateDisc=function(c){var d,f,g,j,l,n,m,s,t,v,y;d=[],f=[],g=[],j=[],l=c.radius||0.5,n=c.tessellation||64,m=0>=c.arc||1<c.arc?1:c.arc||1;c=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE;d.push(0,0,0);j.push(0.5,0.5);for(var p=2*Math.PI*m,n=p/n,r=0;p>r;r+=n){s=Math.cos(r),t=Math.sin(r),v=(s+1)/2,y=(1-t)/2;d.push(l*s,l*t,0);j.push(v,y);}1===m&&(d.push(d[3],d[4],d[5]),j.push(j[2],j[3]));l=d.length/3;for(m=1;l-1>m;m++)f.push(m+1,0,m);e.ComputeNormals(d,f,g);e._ComputeSides(c,d,f,g,j);c=new e();return c.indices=f,c.positions=d,c.normals=g,c.uvs=j,c;},e.CreateIcoSphere=function(c){var d,f,g,j,l,n,m,p,r,s,t,v,y,x,z,B,A,C,G,H;f=c.sideOrientation||b.Mesh.DEFAULTSIDE,g=c.radius||1,j=void 0===c.flat?!0:c.flat,l=c.subdivisions||4,n=c.radiusX||g,m=c.radiusY||g,p=c.radiusZ||g;c=(1+Math.sqrt(5))/2;c=[-1,c,-0,1,c,0,-1,-c,0,1,-c,0,0,-1,-c,0,1,-c,0,-1,c,0,1,c,c,0,1,c,0,-1,-c,0,1,-c,0,-1];r=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],s=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],t=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],v=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],y=[],x=[],z=[],B=[],A=0,C=Array(3),G=Array(3);for(d=0;3>d;d++)C[d]=b.Vector3.Zero(),G[d]=b.Vector2.Zero();for(var D=0;20>D;D++){for(d=0;3>d;d++){H=r[3*D+d];C[d].copyFromFloats(c[3*s[H]],c[3*s[H]+1],c[3*s[H]+2]);C[d].normalize().scaleInPlace(g);G[d].copyFromFloats(0.134765625*t[2*H]+0.05859375+-0.0390625*v[D],0.2333984375*t[2*H+1]+0.025390625+0.01953125*v[D]);}d=function(c,d,f,e){var g,q,r;g=b.Vector3.Lerp(C[0],C[2],d/l),q=b.Vector3.Lerp(C[1],C[2],d/l),g=l===d?C[2]:b.Vector3.Lerp(g,q,c/(l-d));g.normalize();if(j){q=b.Vector3.Lerp(C[0],C[2],e/l),r=b.Vector3.Lerp(C[1],C[2],e/l);f=b.Vector3.Lerp(q,r,f/(l-e));}else f=new b.Vector3(g.x,g.y,g.z);f.x/=n;f.y/=m;f.z/=p;f.normalize();e=b.Vector2.Lerp(G[0],G[2],d/l);q=b.Vector2.Lerp(G[1],G[2],d/l);c=l===d?G[2]:b.Vector2.Lerp(e,q,c/(l-d));x.push(g.x*n,g.y*m,g.z*p);z.push(f.x,f.y,f.z);B.push(c.x,c.y);y.push(A);A++;};for(H=0;l>H;H++)for(var J=0;l>J+H;J++)d(J,H,J+1/3,H+1/3),d(J+1,H,J+1/3,H+1/3),d(J,H+1,J+1/3,H+1/3),l>J+H+1&&(d(J+1,H,J+2/3,H+2/3),d(J+1,H+1,J+2/3,H+2/3),d(J,H+1,J+2/3,H+2/3));}e._ComputeSides(f,x,y,z,B);f=new e();return f.indices=y,f.positions=x,f.normals=z,f.uvs=B,f;},e.CreatePolyhedron=function(c){var d,f,g,j,l,n,m,p,r,s,t,v,y,x,z,B,A,C,G,D,H,J,F,O;d=[{vertex:[[0,0,1.732051],[1.632993,0,-0.5773503],[-0.8164966,1.414214,-0.5773503],[-0.8164966,-1.414214,-0.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},{vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},{vertex:[[0,0,1.070466],[0.7136442,0,0.7978784],[-0.3568221,0.618034,0.7978784],[-0.3568221,-0.618034,0.7978784],[0.7978784,0.618034,0.3568221],[0.7978784,-0.618034,0.3568221],[-0.9341724,0.381966,0.3568221],[0.1362939,1,0.3568221],[0.1362939,-1,0.3568221],[-0.9341724,-0.381966,0.3568221],[0.9341724,0.381966,-0.3568221],[0.9341724,-0.381966,-0.3568221],[-0.7978784,0.618034,-0.3568221],[-0.1362939,1,-0.3568221],[-0.1362939,-1,-0.3568221],[-0.7978784,-0.618034,-0.3568221],[0.3568221,0.618034,-0.7978784],[0.3568221,-0.618034,-0.7978784],[-0.7136442,0,-0.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},{vertex:[[0,0,1.175571],[1.051462,0,0.5257311],[0.3249197,1,0.5257311],[-0.8506508,0.618034,0.5257311],[-0.8506508,-0.618034,0.5257311],[0.3249197,-1,0.5257311],[0.8506508,0.618034,-0.5257311],[0.8506508,-0.618034,-0.5257311],[-0.3249197,1,-0.5257311],[-1.051462,0,-0.5257311],[-0.3249197,-1,-0.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},{vertex:[[0,0,1.070722],[0.7148135,0,0.7971752],[-0.104682,0.7071068,0.7971752],[-0.6841528,0.2071068,0.7971752],[-0.104682,-0.7071068,0.7971752],[0.6101315,0.7071068,0.5236279],[1.04156,0.2071068,0.1367736],[0.6101315,-0.7071068,0.5236279],[-0.3574067,1,0.1367736],[-0.7888348,-0.5,0.5236279],[-0.9368776,0.5,0.1367736],[-0.3574067,-1,0.1367736],[0.3574067,1,-0.1367736],[0.9368776,-0.5,-0.1367736],[0.7888348,0.5,-0.5236279],[0.3574067,-1,-0.1367736],[-0.6101315,0.7071068,-0.5236279],[-1.04156,-0.2071068,-0.1367736],[-0.6101315,-0.7071068,-0.5236279],[0.104682,0.7071068,-0.7971752],[0.6841528,-0.2071068,-0.7971752],[0.104682,-0.7071068,-0.7971752],[-0.7148135,0,-0.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},{vertex:[[0,0,1.322876],[1.309307,0,0.1889822],[-0.9819805,0.8660254,0.1889822],[0.1636634,-1.299038,0.1889822],[0.3273268,0.8660254,-0.9449112],[-0.8183171,-0.4330127,-0.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},{vertex:[[0,0,1.159953],[1.013464,0,0.5642542],[-0.3501431,0.9510565,0.5642542],[-0.7715208,-0.6571639,0.5642542],[0.6633206,0.9510565,-0.03144481],[0.8682979,-0.6571639,-0.3996071],[-1.121664,0.2938926,-0.03144481],[-0.2348831,-1.063314,-0.3996071],[0.5181548,0.2938926,-0.9953061],[-0.5850262,-0.112257,-0.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},{vertex:[[0,0,1.118034],[0.8944272,0,0.6708204],[-0.2236068,0.8660254,0.6708204],[-0.7826238,-0.4330127,0.6708204],[0.6708204,0.8660254,0.2236068],[1.006231,-0.4330127,-0.2236068],[-1.006231,0.4330127,0.2236068],[-0.6708204,-0.8660254,-0.2236068],[0.7826238,0.4330127,-0.6708204],[0.2236068,-0.8660254,-0.6708204],[-0.8944272,0,-0.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},{vertex:[[-0.729665,0.670121,0.319155],[-0.655235,-0.29213,-0.754096],[-0.093922,-0.607123,0.537818],[0.702196,0.595691,0.485187],[0.776626,-0.36656,-0.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},{vertex:[[-0.868849,-0.100041,0.61257],[-0.329458,0.976099,0.28078],[-0.26629,-0.013796,-0.477654],[-0.13392,-1.034115,0.229829],[0.738834,0.707117,-0.307018],[0.859683,-0.535264,-0.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},{vertex:[[-0.610389,0.243975,0.531213],[-0.187812,-0.48795,-0.664016],[-0.187812,0.9759,-0.664016],[0.187812,-0.9759,0.664016],[0.798201,0.243975,0.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},{vertex:[[-1.028778,0.392027,-0.048786],[-0.640503,-0.646161,0.621837],[-0.125162,-0.395663,-0.540059],[0.004683,0.888447,-0.651988],[0.125161,0.395663,0.540059],[0.632925,-0.791376,0.433102],[1.031672,0.157063,-0.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},{vertex:[[-0.669867,0.334933,-0.529576],[-0.669867,0.334933,0.529577],[-0.4043,1.212901,0],[-0.334933,-0.669867,-0.529576],[-0.334933,-0.669867,0.529577],[0.334933,0.669867,-0.529576],[0.334933,0.669867,0.529577],[0.4043,-1.212901,0],[0.669867,-0.334933,-0.529576],[0.669867,-0.334933,0.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},{vertex:[[-0.931836,0.219976,-0.264632],[-0.636706,0.318353,0.692816],[-0.613483,-0.735083,-0.264632],[-0.326545,0.979634,0],[-0.318353,-0.636706,0.692816],[-0.159176,0.477529,-0.856368],[0.159176,-0.477529,-0.856368],[0.318353,0.636706,0.692816],[0.326545,-0.979634,0],[0.613482,0.735082,-0.264632],[0.636706,-0.318353,0.692816],[0.931835,-0.219977,-0.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},{vertex:[[-0.93465,0.300459,-0.271185],[-0.838689,-0.260219,-0.516017],[-0.711319,0.717591,0.128359],[-0.710334,-0.156922,0.080946],[-0.599799,0.556003,-0.725148],[-0.503838,-0.004675,-0.969981],[-0.487004,0.26021,0.48049],[-0.460089,-0.750282,-0.512622],[-0.376468,0.973135,-0.325605],[-0.331735,-0.646985,0.084342],[-0.254001,0.831847,0.530001],[-0.125239,-0.494738,-0.966586],[0.029622,0.027949,0.730817],[0.056536,-0.982543,-0.262295],[0.08085,1.087391,0.076037],[0.125583,-0.532729,0.485984],[0.262625,0.599586,0.780328],[0.391387,-0.726999,-0.716259],[0.513854,-0.868287,0.139347],[0.597475,0.85513,0.326364],[0.641224,0.109523,0.783723],[0.737185,-0.451155,0.538891],[0.848705,-0.612742,-0.314616],[0.976075,0.365067,0.32976],[1.072036,-0.19561,0.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]}],m=0>c.type||c.type>=d.length?0:c.type||0,p=c.size,r=c.sizeX||p||1,s=c.sizeY||p||1,p=c.sizeZ||p||1,t=c.custom||d[m],v=t.face.length,y=c.faceUV||Array(v),d=c.faceColors,m=void 0===c.flat?!0:c.flat,x=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE;c=[];z=[],B=[],A=[],C=[],G=0,D=0,H=[],J=0,F=0;if(m)for(F=0;v>F;F++)d&&void 0===d[F]&&(d[F]=new b.Color4(1,1,1,1)),y&&void 0===y[F]&&(y[F]=new b.Vector4(0,0,1,1));if(m)for(F=0;v>F;F++){O=t.face[F].length;j=2*Math.PI/O;l=0.5*Math.tan(j/2);n=0.5;for(J=0;O>J;J++)c.push(t.vertex[t.face[F][J]][0]*r,t.vertex[t.face[F][J]][1]*s,t.vertex[t.face[F][J]][2]*p),H.push(G),G++,f=y[F].x+(y[F].z-y[F].x)*(0.5+l),g=y[F].y+(y[F].w-y[F].y)*(n-0.5),A.push(f,g),f=l*Math.cos(j)-n*Math.sin(j),n=l*Math.sin(j)+n*Math.cos(j),l=f,d&&C.push(d[F].r,d[F].g,d[F].b,d[F].a);for(J=0;O-2>J;J++)z.push(H[0+D],H[J+2+D],H[J+1+D]);D+=O;}else{for(J=0;J<t.vertex.length;J++)c.push(t.vertex[J][0]*r,t.vertex[J][1]*s,t.vertex[J][2]*p),A.push(0,0);for(F=0;v>F;F++)for(J=0;J<t.face[F].length-2;J++)z.push(t.face[F][0],t.face[F][J+2],t.face[F][J+1]);}e.ComputeNormals(c,z,B);e._ComputeSides(x,c,z,B,A);r=new e();return r.positions=c,r.indices=z,r.normals=B,r.uvs=A,d&&m&&(r.colors=C),r;},e.CreateTorusKnot=function(c){var d,f,g,j,l,n,m,p,r,s,t,v,y,x,z,B,A,C;f=[],g=[],j=[],l=[],n=c.radius||2,m=c.tube||0.5,p=c.radialSegments||32,r=c.tubularSegments||32,s=c.p||2,t=c.q||3,v=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE,y=function(c){var d,f,e;d=Math.cos(c),f=Math.sin(c);c*=t/s;y4tt.q9();e=Math.cos(c),d=0.5*(n*(2+e))*d,f=0.5*n*(2+e)*f;c=0.5*n*Math.sin(c);return new b.Vector3(d,f,c);};for(c=0;p>=c;c++){d=2*(c%p/p)*s*Math.PI;x=y(d),z=y(d+0.01);d=z.subtract(x);z=z.add(x),B=b.Vector3.Cross(d,z),z=b.Vector3.Cross(B,d);B.normalize();z.normalize();for(d=0;r>d;d++){A=2*(d%r/r)*Math.PI,C=-m*Math.cos(A),A=m*Math.sin(A);g.push(x.x+C*z.x+A*B.x);g.push(x.y+C*z.y+A*B.y);g.push(x.z+C*z.z+A*B.z);l.push(c/p);l.push(d/r);}}for(c=0;p>c;c++)for(d=0;r>d;d++)z=(d+1)%r,m=c*r+d,y=(c+1)*r+d,x=(c+1)*r+z,z=c*r+z,f.push(z),f.push(y),f.push(m),f.push(z),f.push(x),f.push(y);e.ComputeNormals(g,f,j);e._ComputeSides(v,g,f,j,l);p=new e();return p.indices=f,p.positions=g,p.normals=j,p.uvs=l,p;},e.ComputeNormals=function(b,d,f){for(var e=0,j=0,l=0,g=0,m=0,p=0,r=0,s=0,t=l=j=g=0,v=0,y=0,e=0;e<b.length;e++)f[e]=0;for(var x=d.length/3,e=0;x>e;e++)t=d[3*e],v=d[3*e+1],y=d[3*e+2],j=b[3*t]-b[3*v],l=b[3*t+1]-b[3*v+1],g=b[3*t+2]-b[3*v+2],m=b[3*y]-b[3*v],p=b[3*y+1]-b[3*v+1],r=b[3*y+2]-b[3*v+2],s=l*r-g*p,g=g*m-j*r,j=j*p-l*m,l=Math.sqrt(s*s+g*g+j*j),l=0===l?1:l,s/=l,g/=l,j/=l,f[3*t]+=s,f[3*t+1]+=g,f[3*t+2]+=j,f[3*v]+=s,f[3*v+1]+=g,f[3*v+2]+=j,f[3*y]+=s,f[3*y+1]+=g,f[3*y+2]+=j;for(e=0;e<f.length/3;e++)s=f[3*e],g=f[3*e+1],j=f[3*e+2],l=Math.sqrt(s*s+g*g+j*j),l=0===l?1:l,s/=l,g/=l,j/=l,f[3*e]=s,f[3*e+1]=g,f[3*e+2]=j;},e._ComputeSides=function(c,d,f,e,j){var l,g,m;y4tt.v9();l=f.length,g=e.length;switch(c||b.Mesh.DEFAULTSIDE){case b.Mesh.BACKSIDE:for(d=0;l>d;d+=3)j=f[d],f[d]=f[d+2],f[d+2]=j;for(f=0;g>f;f++)e[f]=-e[f];break;case b.Mesh.DOUBLESIDE:m=d.length;c=m/3;for(var p=0;m>p;p++)d[m+p]=d[p];for(d=0;l>d;d+=3)f[d+l]=f[d+2]+c,f[d+1+l]=f[d+1]+c,f[d+2+l]=f[d]+c;for(f=0;g>f;f++)e[g+f]=-e[f];e=j.length;for(g=0;e>g;g++)j[g+e]=j[g];}},e.ImportVertexData=function(c,d){var f,g,j;f=new e(),g=c.positions;g&&f.set(g,b.VertexBuffer.PositionKind);j=c.normals;j&&f.set(j,b.VertexBuffer.NormalKind);(j=c.uvs)&&f.set(j,b.VertexBuffer.UVKind);(j=c.uv2s)&&f.set(j,b.VertexBuffer.UV2Kind);(j=c.uv3s)&&f.set(j,b.VertexBuffer.UV3Kind);(j=c.uv4s)&&f.set(j,b.VertexBuffer.UV4Kind);(j=c.uv5s)&&f.set(j,b.VertexBuffer.UV5Kind);(j=c.uv6s)&&f.set(j,b.VertexBuffer.UV6Kind);(j=c.colors)&&f.set(b.Color4.CheckColors4(j,g.length/3),b.VertexBuffer.ColorKind);(g=c.matricesIndices)&&f.set(g,b.VertexBuffer.MatricesIndicesKind);(g=c.matricesWeights)&&f.set(g,b.VertexBuffer.MatricesWeightsKind);(g=c.indices)&&(f.indices=g);d.setAllVerticesData(f,c.updatable);},e);b.VertexData=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(){};g=(e.EnableFor=function(b){b._tags=b._tags||{};b.hasTags=function(){return e.HasTags(b);};b.addTags=function(d){y4tt.q9();return e.AddTagsTo(b,d);};b.removeTags=function(d){y4tt.q9();return e.RemoveTagsFrom(b,d);};y4tt.v9();b.matchesTagsQuery=function(d){y4tt.q9();return e.MatchesQuery(b,d);};},e.DisableFor=function(b){delete b._tags;delete b.hasTags;delete b.addTags;delete b.removeTags;delete b.matchesTagsQuery;},e.HasTags=function(c){y4tt.v9();return c._tags?!b.Tools.IsEmpty(c._tags):!1;},e.GetTags=function(b,d){var f,e;y4tt.q9();if(void 0===d&&(d=!0),!b._tags)return null;if(d){f=[];for(e in b._tags)b._tags.hasOwnProperty(e)&&!0===b._tags[e]&&f.push(e);return f.join(" ");}return b._tags;},e.AddTagsTo=function(b,d){var f,g;y4tt.q9();if(d&&"string"==typeof d){f=d.split(" ");for(g in f)e._AddTagTo(b,f[g]);}},e._AddTagTo=function(b,d){y4tt.q9();d=d.trim();""!==d&&"true"!==d&&"false"!==d&&(d.match(/[\s]/)||d.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(b),b._tags[d]=!0));},e.RemoveTagsFrom=function(b,d){var f,g;if(e.HasTags(b)){f=d.split(" ");for(g in f)e._RemoveTagFrom(b,f[g]);}},e._RemoveTagFrom=function(b,d){y4tt.q9();delete b._tags[d];},e.MatchesQuery=function(c,d){return void 0===d?!0:""===d?e.HasTags(c):b.Internals.AndOrNotEvaluator.Eval(d,function(b){return e.HasTags(c)&&c._tags[b];});},e);b.Tags=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;y4tt.v9();b=b.Internals||(b.Internals={});e=function(){};g=(e.Eval=function(b,d){y4tt.q9();return b=b.match(/\([^\(\)]*\)/g)?b.replace(/\([^\(\)]*\)/g,function(b){y4tt.q9();return b=b.slice(1,b.length-1),e._HandleParenthesisContent(b,d);}):e._HandleParenthesisContent(b,d),"true"===b?!0:"false"===b?!1:e.Eval(b,d);},e._HandleParenthesisContent=function(b,d){var f,g,j,l,n,p;d=d||function(b){y4tt.q9();return"true"===b;};g=b.split("||");for(j in g){l=e._SimplifyNegation(g[j].trim()),n=l.split("&&");if(1<n.length)for(var m=0;m<n.length;++m){p=e._SimplifyNegation(n[m].trim());if(f="true"!==p&&"false"!==p?"!"===p[0]?!d(p.substring(1)):d(p):"true"===p,!f){l="false";break;}}if(f||"true"===l){f=!0;break;}f="true"!==l&&"false"!==l?"!"===l[0]?!d(l.substring(1)):d(l):"true"===l;}return f?"true":"false";},e._SimplifyNegation=function(b){return b=b.replace(/^[\s!]+/,function(b){return b=b.replace(/[\s]/g,function(){return"";}),b.length%2?"!":"";}),b=b.trim(),"!true"===b?b="false":"!false"===b&&(b="true"),b;},e);b.AndOrNotEvaluator=g;!0;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(e,c,d,f,g,j){this._enabled=!0;this._refCount=0;this._name=c;this._renderTexture=new b.RenderTargetTexture(c,d,e);this.setRenderList(f);this._renderTexture.onBeforeRenderObservable.add(g);this._renderTexture.onAfterRenderObservable.add(j);y4tt.v9();this._scene=e;this._renderList=f;};g=(g.prototype._incRefCount=function(){y4tt.q9();return 0===this._refCount&&this._scene.customRenderTargets.push(this._renderTexture),++this._refCount;},g.prototype._decRefCount=function(){y4tt.q9();return this._refCount--,0>=this._refCount&&this._scene.customRenderTargets.splice(this._scene.customRenderTargets.indexOf(this._renderTexture),1),this._refCount;},g.prototype._update=function(){this.setRenderList(this._renderList);},g.prototype.setRenderList=function(b){y4tt.v9();this._renderTexture.renderList=b;},g.prototype.getRenderTexture=function(){y4tt.q9();return this._renderTexture;},g);b.PostProcessRenderPass=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(b,c,d,f){this._engine=b;this._name=c;this._singleInstance=f||!0;this._getPostProcess=d;this._cameras=[];this._indicesForCamera=[];this._postProcesses={};y4tt.v9();this._renderPasses={};this._renderEffectAsPasses={};};g=(Object.defineProperty(g.prototype,"isSupported",{get:function(){for(var b in this._postProcesses)if(!this._postProcesses[b].isSupported)return!1;return!0;},enumerable:!0,configurable:!0}),g.prototype._update=function(){y4tt.v9();for(var b in this._renderPasses)this._renderPasses[b]._update();},g.prototype.addPass=function(b){this._renderPasses[b._name]=b;this._linkParameters();},g.prototype.removePass=function(b){y4tt.q9();delete this._renderPasses[b._name];this._linkParameters();},g.prototype.addRenderEffectAsPass=function(b){this._renderEffectAsPasses[b._name]=b;y4tt.q9();this._linkParameters();},g.prototype.getPass=function(b){y4tt.v9();for(var c in this._renderPasses)if(c===b)return this._renderPasses[b];},g.prototype.emptyPasses=function(){this._renderPasses={};y4tt.q9();this._linkParameters();},g.prototype._attachCameras=function(e){var c,f,g;y4tt.q9();e=b.Tools.MakeArray(e||this._cameras);for(var d=0;d<e.length;d++){f=e[d],g=f.name;c=this._singleInstance?0:g;this._postProcesses[c]=this._postProcesses[c]||this._getPostProcess();c=f.attachPostProcess(this._postProcesses[c]);this._indicesForCamera[g]||(this._indicesForCamera[g]=[]);this._indicesForCamera[g].push(c);-1===this._cameras.indexOf(f)&&(this._cameras[g]=f);for(var j in this._renderPasses)this._renderPasses[j]._incRefCount();}this._linkParameters();},g.prototype._detachCameras=function(e){var d,f;e=b.Tools.MakeArray(e||this._cameras);y4tt.v9();for(var c=0;c<e.length;c++){d=e[c],f=d.name;d.detachPostProcess(this._postProcesses[this._singleInstance?0:f],this._indicesForCamera[f]);d=this._cameras.indexOf(f);this._indicesForCamera.splice(d,1);this._cameras.splice(d,1);for(var g in this._renderPasses)this._renderPasses[g]._decRefCount();}},g.prototype._enable=function(e){y4tt.v9();for(var c=b.Tools.MakeArray(e||this._cameras),d=0;d<c.length;d++){for(var f=c[d],g=f.name,j=0;j<this._indicesForCamera[g].length;j++)void 0===f._postProcesses[this._indicesForCamera[g][j]]&&e[d].attachPostProcess(this._postProcesses[this._singleInstance?0:g],this._indicesForCamera[g][j]);for(var l in this._renderPasses)this._renderPasses[l]._incRefCount();}},g.prototype._disable=function(e){var d,f;y4tt.q9();e=b.Tools.MakeArray(e||this._cameras);for(var c=0;c<e.length;c++){d=e[c],f=d.Name;d.detachPostProcess(this._postProcesses[this._singleInstance?0:f],this._indicesForCamera[f]);for(var g in this._renderPasses)this._renderPasses[g]._decRefCount();}},g.prototype.getPostProcess=function(b){return this._singleInstance?this._postProcesses[0]:this._postProcesses[b.name];},g.prototype._linkParameters=function(){var b,c;b=this;for(c in this._postProcesses)this.applyParameters&&this.applyParameters(this._postProcesses[c]),this._postProcesses[c].onBeforeRenderObservable.add(function(c){b._linkTextures(c);});},g.prototype._linkTextures=function(b){y4tt.v9();for(var c in this._renderPasses)b.setTexture(c,this._renderPasses[c].getRenderTexture());for(var d in this._renderEffectAsPasses)b.setTextureFromPostProcess(d+"Sampler",this._renderEffectAsPasses[d].getPostProcess());},g);y4tt.q9();b.PostProcessRenderEffect=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(b,d){this._engine=b;this._name=d;this._renderEffects={};this._renderEffectsForIsolatedPass={};this._cameras=[];};g=(Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var b in this._renderEffects)if(!this._renderEffects[b].isSupported)return!1;return!0;},enumerable:!0,configurable:!0}),e.prototype.addEffect=function(b){this._renderEffects[b._name]=b;},e.prototype._enableEffect=function(c,d){var f;f=this._renderEffects[c];y4tt.q9();f&&f._enable(b.Tools.MakeArray(d||this._cameras));},e.prototype._disableEffect=function(c,d){var f;f=this._renderEffects[c];f&&f._disable(b.Tools.MakeArray(d||this._cameras));},e.prototype._attachCameras=function(c,d){var f,e,j,l,g;e=b.Tools.MakeArray(c||this._cameras),j=[];for(f=0;f<e.length;f++){l=e[f],g=l.name;-1===this._cameras.indexOf(l)?this._cameras[g]=l:d&&j.push(f);}for(f=0;f<j.length;f++)c.splice(j[f],1);y4tt.v9();for(var m in this._renderEffects)this._renderEffects[m]._attachCameras(e);},e.prototype._detachCameras=function(c){c=b.Tools.MakeArray(c||this._cameras);for(var d in this._renderEffects)this._renderEffects[d]._detachCameras(c);for(d=0;d<c.length;d++)this._cameras.splice(this._cameras.indexOf(c[d]),1);},e.prototype._enableDisplayOnlyPass=function(c,d){var f,g,j,l,n,m;g=this,j=b.Tools.MakeArray(d||this._cameras),l=null;for(f in this._renderEffects)if(l=this._renderEffects[f].getPass(c),null!=l)break;y4tt.v9();if(null!==l){for(f in this._renderEffects)this._renderEffects[f]._disable(j);l._name=e.PASS_SAMPLER_NAME;for(f=0;f<j.length;f++){n=j[f],m=n.name;this._renderEffectsForIsolatedPass[m]=this._renderEffectsForIsolatedPass[m]||new b.PostProcessRenderEffect(this._engine,e.PASS_EFFECT_NAME,function(){y4tt.q9();return new b.DisplayPassPostProcess(e.PASS_EFFECT_NAME,1,null,null,g._engine,!0);});this._renderEffectsForIsolatedPass[m].emptyPasses();this._renderEffectsForIsolatedPass[m].addPass(l);this._renderEffectsForIsolatedPass[m]._attachCameras(n);}}},e.prototype._disableDisplayOnlyPass=function(c){var d,g,j;d=this;c=b.Tools.MakeArray(c||this._cameras);for(var f=0;f<c.length;f++){g=c[f],j=g.name;this._renderEffectsForIsolatedPass[j]=this._renderEffectsForIsolatedPass[j]||new b.PostProcessRenderEffect(this._engine,e.PASS_EFFECT_NAME,function(){return new b.DisplayPassPostProcess(e.PASS_EFFECT_NAME,1,null,null,d._engine,!0);});this._renderEffectsForIsolatedPass[j]._disable(g);}for(var l in this._renderEffects)this._renderEffects[l]._enable(c);},e.prototype._update=function(){var d;for(var b in this._renderEffects)this._renderEffects[b]._update();for(b=0;b<this._cameras.length;b++){d=this._cameras[b].name;this._renderEffectsForIsolatedPass[d]&&this._renderEffectsForIsolatedPass[d]._update();}},e.prototype.dispose=function(){},e.PASS_EFFECT_NAME="passEffect",e.PASS_SAMPLER_NAME="passSampler",e);b.PostProcessRenderPipeline=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(){this._renderPipelines={};};g=(g.prototype.addPipeline=function(b){this._renderPipelines[b._name]=b;},g.prototype.attachCamerasToRenderPipeline=function(b,c,d){(b=this._renderPipelines[b])&&b._attachCameras(c,d);},g.prototype.detachCamerasFromRenderPipeline=function(b,c){var d;d=this._renderPipelines[b];d&&d._detachCameras(c);},g.prototype.enableEffectInPipeline=function(b,c,d){(b=this._renderPipelines[b])&&b._enableEffect(c,d);},g.prototype.disableEffectInPipeline=function(b,c,d){(b=this._renderPipelines[b])&&b._disableEffect(c,d);},g.prototype.enableDisplayOnlyPassInPipeline=function(b,c,d){y4tt.q9();(b=this._renderPipelines[b])&&b._enableDisplayOnlyPass(c,d);},g.prototype.disableDisplayOnlyPassInPipeline=function(b,c){var d;y4tt.q9();d=this._renderPipelines[b];d&&d._disableDisplayOnlyPass(c);},g.prototype.update=function(){var c;for(var b in this._renderPipelines){c=this._renderPipelines[b];c.isSupported?c._update():(c.dispose(),delete this._renderPipelines[b]);}},g);b.PostProcessRenderPipelineManager=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(e){this.frontColor=new b.Color3(1,1,1);this.backColor=new b.Color3(0.1,0.1,0.1);this.showBackLines=!0;this.renderList=new b.SmartArray(32);y4tt.q9();this._vertexBuffers={};this._scene=e;};y4tt.v9();g=(g.prototype._prepareRessources=function(){var e,c;if(!this._colorShader){this._colorShader=new b.ShaderMaterial("colorShader",this._scene,"color",{attributes:[b.VertexBuffer.PositionKind],uniforms:["worldViewProjection","color"]});e=this._scene.getEngine(),c=b.VertexData.CreateBox(1);this._vertexBuffers[b.VertexBuffer.PositionKind]=new b.VertexBuffer(e,c.positions,b.VertexBuffer.PositionKind,!1);this._indexBuffer=e.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4]);}},g.prototype.reset=function(){this.renderList.reset();},g.prototype.render=function(){var e,d,f,g;y4tt.v9();if(0!==this.renderList.length&&(this._prepareRessources(),this._colorShader.isReady())){e=this._scene.getEngine();e.setDepthWrite(!1);this._colorShader._preBind();for(var c=0;c<this.renderList.length;c++){d=this.renderList.data[c],f=d.minimum,g=d.maximum.subtract(f),f=f.add(g.scale(0.5)),d=b.Matrix.Scaling(g.x,g.y,g.z).multiply(b.Matrix.Translation(f.x,f.y,f.z)).multiply(d.getWorldMatrix());e.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect());this.showBackLines&&(e.setDepthFunctionToGreaterOrEqual(),this._scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(d),e.draw(!1,0,24));e.setDepthFunctionToLess();this._scene.resetCachedMaterial();this._colorShader.setColor4("color",this.frontColor.toColor4());this._colorShader.bind(d);e.draw(!1,0,24);}this._colorShader.unbind();e.setDepthFunctionToLessOrEqual();e.setDepthWrite(!0);}},g.prototype.dispose=function(){var e;if(this._colorShader){this._colorShader.dispose();e=this._vertexBuffers[b.VertexBuffer.PositionKind];e&&(e.dispose(),this._vertexBuffers[b.VertexBuffer.PositionKind]=null);this._scene.getEngine()._releaseBuffer(this._indexBuffer);}},g);b.BoundingBoxRenderer=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=function(b){y4tt.q9();this._actionManager=b;};g=(e.prototype.isValid=function(){y4tt.v9();return!0;},e.prototype._getProperty=function(b){return this._actionManager._getProperty(b);},e.prototype._getEffectiveTarget=function(b,c){return this._actionManager._getEffectiveTarget(b,c);},e.prototype.serialize=function(){},e.prototype._serialize=function(b){y4tt.q9();return{type:2,children:[],name:b.name,properties:b.properties};},e);b.Condition=g;c=function(b,f,e,j,l){void 0===l&&(l=c.IsEqual);g.call(this,b);y4tt.q9();this.propertyPath=e;this.value=j;this.operator=l;this._target=f;this._effectiveTarget=this._getEffectiveTarget(f,this.propertyPath);this._property=this._getProperty(this.propertyPath);},e=(__extends(c,g),Object.defineProperty(c,"IsEqual",{get:function(){y4tt.v9();return c._IsEqual;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"IsDifferent",{get:function(){return c._IsDifferent;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"IsGreater",{get:function(){y4tt.q9();return c._IsGreater;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"IsLesser",{get:function(){return c._IsLesser;},enumerable:!0,configurable:!0}),c.prototype.isValid=function(){var b;y4tt.v9();switch(this.operator){case c.IsGreater:return this._effectiveTarget[this._property]>this.value;case c.IsLesser:return this._effectiveTarget[this._property]<this.value;case c.IsEqual:case c.IsDifferent:return b=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===c.IsEqual?b:!b;}return!1;},c.prototype.serialize=function(){y4tt.v9();return this._serialize({name:"ValueCondition",properties:[b.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:b.Action._SerializeValueAsString(this.value)},{name:"operator",value:c.GetOperatorName(this.operator)}]});},c.GetOperatorName=function(b){y4tt.q9();switch(b){case c._IsEqual:return"IsEqual";case c._IsDifferent:return"IsDifferent";case c._IsGreater:return"IsGreater";case c._IsLesser:return"IsLesser";default:return"";}},c._IsEqual=0,c._IsDifferent=1,c._IsGreater=2,c._IsLesser=3,c);b.ValueCondition=e;e=function(b,c){y4tt.v9();g.call(this,b);this.predicate=c;};e=(__extends(e,g),e.prototype.isValid=function(){y4tt.q9();return this.predicate();},e);b.PredicateCondition=e;e=function(b,c,e){g.call(this,b);y4tt.v9();this.value=e;this._target=c;};e=(__extends(e,g),e.prototype.isValid=function(){return this._target.state===this.value;},e.prototype.serialize=function(){y4tt.v9();return this._serialize({name:"StateCondition",properties:[b.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]});},e);b.StateCondition=e;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(b,c){this.triggerOptions=b;y4tt.v9();b.parameter?(this.trigger=b.trigger,this._triggerParameter=b.parameter):this.trigger=b;this._nextActiveAction=this;this._condition=c;};g=(g.prototype._prepare=function(){},g.prototype.getTriggerParameter=function(){y4tt.v9();return this._triggerParameter;},g.prototype._executeCurrent=function(b){var c,d;y4tt.q9();if(this._nextActiveAction._condition){c=this._nextActiveAction._condition,d=this._actionManager.getScene().getRenderId();if(c._evaluationId===d){if(!c._currentResult)return;}else{if(c._evaluationId=d,!c.isValid())return void(c._currentResult=!1);c._currentResult=!0;}}this._nextActiveAction.execute(b);this.skipToNextActiveAction();},g.prototype.execute=function(){},g.prototype.skipToNextActiveAction=function(){y4tt.v9();this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this;},g.prototype.then=function(b){y4tt.q9();return this._child=b,b._actionManager=this._actionManager,b._prepare(),b;},g.prototype._getProperty=function(b){return this._actionManager._getProperty(b);},g.prototype._getEffectiveTarget=function(b,c){return this._actionManager._getEffectiveTarget(b,c);},g.prototype.serialize=function(){},g.prototype._serialize=function(b,c){var d,f;d={type:1,children:[],name:b.name,properties:b.properties||[]};if(this._child&&this._child.serialize(d),this._condition){f=this._condition.serialize();return f.children.push(d),c&&c.children.push(f),f;}return c&&c.children.push(d),d;},g._SerializeValueAsString=function(e){y4tt.q9();return"number"==typeof e?e.toString():"boolean"==typeof e?e?"true":"false":e instanceof b.Vector2?e.x+", "+e.y:e instanceof b.Vector3?e.x+", "+e.y+", "+e.z:e instanceof b.Color3?e.r+", "+e.g+", "+e.b:e instanceof b.Color4?e.r+", "+e.g+", "+e.b+", "+e.a:e;},g._GetTargetProperty=function(e){return{name:"target",targetType:e instanceof b.Mesh?"MeshProperties":e instanceof b.Light?"LightProperties":e instanceof b.Camera?"CameraProperties":"SceneProperties",value:e instanceof b.Scene?"Scene":e.name};},g);b.Action=g;}(BABYLON||(BABYLON={}));y4tt.v9();!function(b){var g,e,c;e=function(b,c,e,j,l,g){this.source=b;this.pointerX=c;this.pointerY=e;this.meshUnderPointer=j;this.sourceEvent=l;this.additionalData=g;};g=(e.CreateNew=function(b,c,g){var j;j=b.getScene();y4tt.q9();return new e(b,j.pointerX,j.pointerY,j.meshUnderPointer,c,g);},e.CreateNewFromSprite=function(b,c,g,j){y4tt.v9();return new e(b,c.pointerX,c.pointerY,c.meshUnderPointer,g,j);},e.CreateNewFromScene=function(b,c){y4tt.v9();return new e(null,b.pointerX,b.pointerY,b.meshUnderPointer,c);},e.CreateNewFromPrimitive=function(b,c,g,j){return new e(b,c.x,c.y,null,g,j);},e);b.ActionEvent=g;c=function(b){y4tt.q9();this.actions=[];this._scene=b;b._actionManagers.push(this);};g=(Object.defineProperty(c,"NothingTrigger",{get:function(){y4tt.q9();return c._NothingTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnPickTrigger",{get:function(){return c._OnPickTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnLeftPickTrigger",{get:function(){y4tt.v9();return c._OnLeftPickTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnRightPickTrigger",{get:function(){return c._OnRightPickTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnCenterPickTrigger",{get:function(){y4tt.q9();return c._OnCenterPickTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnPickDownTrigger",{get:function(){return c._OnPickDownTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnPickUpTrigger",{get:function(){y4tt.v9();return c._OnPickUpTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnPickOutTrigger",{get:function(){return c._OnPickOutTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnLongPressTrigger",{get:function(){return c._OnLongPressTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnPointerOverTrigger",{get:function(){y4tt.q9();return c._OnPointerOverTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnPointerOutTrigger",{get:function(){y4tt.v9();return c._OnPointerOutTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnEveryFrameTrigger",{get:function(){return c._OnEveryFrameTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnIntersectionEnterTrigger",{get:function(){y4tt.v9();return c._OnIntersectionEnterTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnIntersectionExitTrigger",{get:function(){return c._OnIntersectionExitTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnKeyDownTrigger",{get:function(){return c._OnKeyDownTrigger;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnKeyUpTrigger",{get:function(){y4tt.q9();return c._OnKeyUpTrigger;},enumerable:!0,configurable:!0}),c.prototype.dispose=function(){var b;b=this._scene._actionManagers.indexOf(this);-1<b&&this._scene._actionManagers.splice(b,1);},c.prototype.getScene=function(){y4tt.v9();return this._scene;},c.prototype.hasSpecificTriggers=function(b){y4tt.v9();for(var c=0;c<this.actions.length;c++)if(-1<b.indexOf(this.actions[c].trigger))return!0;return!1;},c.prototype.hasSpecificTrigger=function(b){for(var c=0;c<this.actions.length;c++)if(this.actions[c].trigger===b)return!0;y4tt.q9();return!1;},Object.defineProperty(c.prototype,"hasPointerTriggers",{get:function(){var f;for(var b=0;b<this.actions.length;b++){f=this.actions[b];if(f.trigger>=c._OnPickTrigger&&f.trigger<=c._OnPointerOutTrigger)return!0;}y4tt.q9();return!1;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hasPickTriggers",{get:function(){var f;for(var b=0;b<this.actions.length;b++){f=this.actions[b];if(f.trigger>=c._OnPickTrigger&&f.trigger<=c._OnPickUpTrigger)return!0;}y4tt.q9();return!1;},enumerable:!0,configurable:!0}),c.prototype.registerAction=function(d){y4tt.v9();return d.trigger===c.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(b.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(d),d._actionManager=this,d._prepare(),d);},c.prototype.processTrigger=function(b,f){var j,l;y4tt.q9();for(var e=0;e<this.actions.length;e++){j=this.actions[e];if(j.trigger===b){if(b===c.OnKeyUpTrigger||b===c.OnKeyDownTrigger){l=j.getTriggerParameter();if(l&&String.fromCharCode(f.sourceEvent.charCode?f.sourceEvent.charCode:f.sourceEvent.keyCode).toLowerCase()!==l.toLowerCase())continue;}j._executeCurrent(f);}}},c.prototype._getEffectiveTarget=function(b,c){for(var e=c.split("."),j=0;j<e.length-1;j++)b=b[e[j]];return b;},c.prototype._getProperty=function(b){b=b.split(".");return b[b.length-1];},c.prototype.serialize=function(d){var e,j;y4tt.v9();d={children:[],name:d,type:3,properties:[]};for(var f=0;f<this.actions.length;f++){e={type:0,children:[],name:c.GetTriggerName(this.actions[f].trigger),properties:[]},j=this.actions[f].triggerOptions;j&&"number"!=typeof j&&(j.parameter instanceof b.Node?e.properties.push(b.Action._GetTargetProperty(j.parameter)):e.properties.push({name:"parameter",targetType:null,value:j.parameter}));this.actions[f].serialize(e);d.children.push(e);}return d;},c.Parse=function(d,f,e){var j,l,g,m;j=new b.ActionManager(e);y4tt.q9();null===f?e.actionManager=j:f.actionManager=j;l=function(d,f,g,m,p){var n,z,B,A,C,G,D;y4tt.q9();if(void 0===p&&(p=null),!d.detached){n=[],z=null,B=null,A=d.combine&&0<d.combine.length;if(2===d.type?n.push(j):n.push(f),A){z=[];for(B=0;B<d.combine.length;B++)l(d.combine[B],c.NothingTrigger,g,m,z);n.push(z);}else for(A=0;A<d.properties.length;A++){C=d.properties[A].value,G=d.properties[A].name,D=d.properties[A].targetType;if("target"===G)C=z=null!==D&&"SceneProperties"===D?e:e.getNodeByName(C);else if("parent"===G)C=e.getNodeByName(C);else if("sound"===G)C=e.getSoundByName(C);else if("propertyPath"!==G)if(2===d.type&&"operator"===G)C=b.ValueCondition[C];else if(D=C,C=z,G="value"===G?B:null,null===G)C=parseFloat(D),C="true"===D||"false"===D?"true"===D:isNaN(C)?D:C;else{for(var G=G.split("."),D=D.split(","),H=0;H<G.length;H++)C=C[G[H]];if("boolean"==typeof C)C="true"===D[0];else if("string"==typeof C)C=D[0];else{G=[];for(H=0;H<D.length;H++)G.push(parseFloat(D[H]));C=C instanceof b.Vector3?b.Vector3.FromArray(G):C instanceof b.Vector4?b.Vector4.FromArray(G):C instanceof b.Color3?b.Color3.FromArray(G):C instanceof b.Color4?b.Color4.FromArray(G):parseFloat(D[0]);}}else B=C;n.push(C);}if(null===p?n.push(g):n.push(null),"InterpolateValueAction"===d.name)n[n.length-1]=n[n.length-2],n[n.length-2]=g;z=Object.create(b[d.name].prototype);n=(z.constructor.apply(z,n),z);n instanceof b.Condition&&null!==g&&(z=new b.DoNothingAction(f,g),m?m.then(z):j.registerAction(z),m=z);null===p?n instanceof b.Condition?(g=n,n=m):(g=null,m?m.then(n):j.registerAction(n)):p.push(n);for(A=0;A<d.children.length;A++)l(d.children[A],f,g,n,null);}};for(f=0;f<d.children.length;f++){m=d.children[f];0<m.properties.length?(g=m.properties[0].value,g=null===m.properties[0].targetType?g:e.getMeshByName(g),g={trigger:b.ActionManager[m.name],parameter:g}):g=b.ActionManager[m.name];for(var p=0;p<m.children.length;p++)m.detached||l(m.children[p],g,null,null);}},c.GetTriggerName=function(b){switch(b){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return"";}},c._NothingTrigger=0,c._OnPickTrigger=1,c._OnLeftPickTrigger=2,c._OnRightPickTrigger=3,c._OnCenterPickTrigger=4,c._OnPickDownTrigger=5,c._OnPickUpTrigger=6,c._OnLongPressTrigger=7,c._OnPointerOverTrigger=8,c._OnPointerOutTrigger=9,c._OnEveryFrameTrigger=10,c._OnIntersectionEnterTrigger=11,c._OnIntersectionExitTrigger=12,c._OnKeyDownTrigger=13,c._OnKeyUpTrigger=14,c._OnPickOutTrigger=15,c.DragMovementThreshold=10,c.LongPressDelay=500,c);b.ActionManager=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.Action;g=function(b,d,f,g,j,l,n,m){void 0===j&&(j=1E3);e.call(this,b,l);this.propertyPath=f;this.value=g;this.duration=j;this.stopOtherAnimations=n;this.onInterpolationDone=m;this._target=this._effectiveTarget=d;};g=(__extends(g,e),g.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath);this._property=this._getProperty(this.propertyPath);},g.prototype.execute=function(){var c,d,f;d=this._actionManager.getScene(),f=[{frame:0,value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if("number"==typeof this.value)c=b.Animation.ANIMATIONTYPE_FLOAT;else if(this.value instanceof b.Color3)c=b.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof b.Vector3)c=b.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof b.Matrix)c=b.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof b.Quaternion))return void b.Tools.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");c=b.Animation.ANIMATIONTYPE_QUATERNION;}c=new b.Animation("InterpolateValueAction",this._property,100*(1E3/this.duration),c,b.Animation.ANIMATIONLOOPMODE_CONSTANT);c.setKeys(f);this.stopOtherAnimations&&d.stopAnimation(this._effectiveTarget);d.beginDirectAnimation(this._effectiveTarget,[c],0,100,!1,1,this.onInterpolationDone);},g.prototype.serialize=function(c){y4tt.q9();return e.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[b.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:b.Action._SerializeValueAsString(this.value)},{name:"duration",value:b.Action._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:b.Action._SerializeValueAsString(this.stopOtherAnimations)||!1}]},c);},g);b.InterpolateValueAction=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j,l,n,m,p,r,s;e=b.Action;g=function(b,c,d,f){e.call(this,b,f);y4tt.v9();this.propertyPath=d;this._target=this._effectiveTarget=c;};g=(__extends(g,e),g.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath);y4tt.v9();this._property=this._getProperty(this.propertyPath);},g.prototype.execute=function(){y4tt.v9();this._effectiveTarget[this._property]=!this._effectiveTarget[this._property];},g.prototype.serialize=function(c){return e.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[b.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},c);},g);b.SwitchBooleanAction=g;c=b.Action;g=function(b,d,f,e){c.call(this,b,e);y4tt.q9();this.value=f;this._target=d;};g=(__extends(g,c),g.prototype.execute=function(){y4tt.v9();this._target.state=this.value;},g.prototype.serialize=function(d){y4tt.q9();return c.prototype._serialize.call(this,{name:"SetStateAction",properties:[b.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]},d);},g);b.SetStateAction=g;d=b.Action;g=function(b,c,f,e,l){d.call(this,b,l);this.propertyPath=f;this.value=e;y4tt.q9();this._target=this._effectiveTarget=c;};g=(__extends(g,d),g.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath);y4tt.v9();this._property=this._getProperty(this.propertyPath);},g.prototype.execute=function(){this._effectiveTarget[this._property]=this.value;y4tt.v9();this._target.markAsDirty&&this._target.markAsDirty(this._property);},g.prototype.serialize=function(c){y4tt.q9();return d.prototype._serialize.call(this,{name:"SetValueAction",properties:[b.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:b.Action._SerializeValueAsString(this.value)}]},c);},g);b.SetValueAction=g;f=b.Action;g=function(b,c,d,e,l){f.call(this,b,l);this.propertyPath=d;this.value=e;y4tt.q9();this._target=this._effectiveTarget=c;};g=(__extends(g,f),g.prototype._prepare=function(){y4tt.v9();this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath);this._property=this._getProperty(this.propertyPath);"number"!=typeof this._effectiveTarget[this._property]&&b.Tools.Warn("Warning: IncrementValueAction can only be used with number values");},g.prototype.execute=function(){y4tt.q9();this._effectiveTarget[this._property]+=this.value;this._target.markAsDirty&&this._target.markAsDirty(this._property);},g.prototype.serialize=function(c){y4tt.v9();return f.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[b.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:b.Action._SerializeValueAsString(this.value)}]},c);},g);b.IncrementValueAction=g;q=b.Action;g=function(b,c,d,f,e,l){q.call(this,b,l);this.from=d;this.to=f;this.loop=e;this._target=c;};g=(__extends(g,q),g.prototype._prepare=function(){},g.prototype.execute=function(){y4tt.q9();this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop);},g.prototype.serialize=function(c){return q.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[b.Action._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:b.Action._SerializeValueAsString(this.loop)||!1}]},c);},g);b.PlayAnimationAction=g;j=b.Action;g=function(b,c,d){j.call(this,b,d);this._target=c;};g=(__extends(g,j),g.prototype._prepare=function(){},g.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target);},g.prototype.serialize=function(c){y4tt.v9();return j.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[b.Action._GetTargetProperty(this._target)]},c);},g);b.StopAnimationAction=g;l=b.Action;g=function(c,d){void 0===c&&(c=b.ActionManager.NothingTrigger);l.call(this,c,d);};g=(__extends(g,l),g.prototype.execute=function(){},g.prototype.serialize=function(b){return l.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},b);},g);y4tt.v9();b.DoNothingAction=g;n=b.Action;g=function(b,c,d){n.call(this,b,d);this.children=c;};g=(__extends(g,n),g.prototype._prepare=function(){y4tt.v9();for(var b=0;b<this.children.length;b++)this.children[b]._actionManager=this._actionManager,this.children[b]._prepare();},g.prototype.execute=function(b){for(var c=0;c<this.children.length;c++)this.children[c].execute(b);},g.prototype.serialize=function(b){b=n.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},b);y4tt.q9();for(var c=0;c<this.children.length;c++)b.combine.push(this.children[c].serialize(null));return b;},g);b.CombineAction=g;m=b.Action;g=function(b,c,d){y4tt.v9();m.call(this,b,d);this.func=c;};g=(__extends(g,m),g.prototype.execute=function(b){this.func(b);},g);b.ExecuteCodeAction=g;p=b.Action;g=function(b,c,d,f){p.call(this,b,f);this._target=c;this._parent=d;};g=(__extends(g,p),g.prototype._prepare=function(){},g.prototype.execute=function(){var c;if(this._target.parent!==this._parent){c=this._parent.getWorldMatrix().clone();c.invert();this._target.position=b.Vector3.TransformCoordinates(this._target.position,c);this._target.parent=this._parent;}},g.prototype.serialize=function(c){y4tt.q9();return p.prototype._serialize.call(this,{name:"SetParentAction",properties:[b.Action._GetTargetProperty(this._target),b.Action._GetTargetProperty(this._parent)]},c);},g);b.SetParentAction=g;r=b.Action;g=function(b,c,d){r.call(this,b,d);y4tt.q9();this._sound=c;};g=(__extends(g,r),g.prototype._prepare=function(){},g.prototype.execute=function(){y4tt.v9();void 0!==this._sound&&this._sound.play();},g.prototype.serialize=function(b){return r.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},b);},g);b.PlaySoundAction=g;s=b.Action;g=function(b,c,d){s.call(this,b,d);this._sound=c;};g=(__extends(g,s),g.prototype._prepare=function(){},g.prototype.execute=function(){void 0!==this._sound&&this._sound.stop();},g.prototype.serialize=function(b){y4tt.v9();return s.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},b);},g);b.StopSoundAction=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j,l,n,m,p,r,s,t,v;e=function(c,d,f,e,l){this.delayLoadState=b.Engine.DELAYLOADSTATE_NONE;this._totalVertices=0;y4tt.q9();this._isDisposed=!1;this.id=c;this._engine=d.getEngine();this._meshes=[];this._scene=d;this._vertexBuffers={};this._indices=[];f?this.setAllVerticesData(f,e):(this._totalVertices=0,this._indices=[]);l&&(l instanceof b.LinesMesh&&(this.boundingBias=new b.Vector2(0,l.intersectionThreshold),this.updateExtend()),this.applyToMesh(l),l.computeWorldMatrix(!0));};g=(Object.defineProperty(e.prototype,"boundingBias",{get:function(){y4tt.q9();return this._boundingBias;},set:function(b){this._boundingBias&&this._boundingBias.equals(b)||(this._boundingBias=b.clone(),this.updateBoundingInfo(!0,null));},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extend",{get:function(){return this._extend;},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene;},e.prototype.getEngine=function(){y4tt.q9();return this._engine;},e.prototype.isReady=function(){return this.delayLoadState===b.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===b.Engine.DELAYLOADSTATE_NONE;},e.prototype.setAllVerticesData=function(b,c){b.applyToGeometry(this,c);this.notifyUpdate();},e.prototype.setVerticesData=function(c,d,f,e){c=new b.VertexBuffer(this._engine,d,c,f,0===this._meshes.length,e);this.setVerticesBuffer(c);},e.prototype.setVerticesBuffer=function(c){var d,f,l;d=c.getKind();if(this._vertexBuffers[d]&&this._vertexBuffers[d].dispose(),this._vertexBuffers[d]=c,d===b.VertexBuffer.PositionKind){f=c.getData();c=c.getStrideSize();this._totalVertices=f.length/c;this.updateExtend(f,c);f=this._meshes;c=f.length;for(var e=0;c>e;e++){l=f[e];l._resetPointsArrayCache();l._boundingInfo=new b.BoundingInfo(this._extend.minimum,this._extend.maximum);l._createGlobalSubMesh();l.computeWorldMatrix(!0);}}this.notifyUpdate(d);},e.prototype.updateVerticesDataDirectly=function(b,c,d){var f;f=this.getVertexBuffer(b);f&&(f.updateDirectly(c,d),this.notifyUpdate(b));},e.prototype.updateVerticesData=function(c,d,f){var e;e=this.getVertexBuffer(c);if(e){if(e.update(d),c===b.VertexBuffer.PositionKind)e=e.getStrideSize(),this._totalVertices=d.length/e,this.updateBoundingInfo(f,d);this.notifyUpdate(c);}},e.prototype.updateBoundingInfo=function(c,d){var j;c&&this.updateExtend(d);for(var f=this._meshes,e=f.length,l=0;e>l;l++){j=f[l];if(j._resetPointsArrayCache(),c){j._boundingInfo=new b.BoundingInfo(this._extend.minimum,this._extend.maximum);for(var g=0;g<j.subMeshes.length;g++)j.subMeshes[g].refreshBoundingInfo();}}},e.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0;},e.prototype.getVerticesData=function(b,c){var d;d=this.getVertexBuffer(b);if(!d)return null;d=d.getData();if(c&&1!==this._meshes.length){for(var f=d.length,e=[],l=0;f>l;l++)e.push(d[l]);return e;}return d;},e.prototype.getVertexBuffer=function(b){y4tt.q9();return this.isReady()?this._vertexBuffers[b]:null;},e.prototype.getVertexBuffers=function(){y4tt.v9();return this.isReady()?this._vertexBuffers:null;},e.prototype.isVerticesDataPresent=function(b){return this._vertexBuffers?void 0!==this._vertexBuffers[b]:this._delayInfo?-1!==this._delayInfo.indexOf(b):!1;},e.prototype.getVerticesDataKinds=function(){var b,c;c=[];if(!this._vertexBuffers&&this._delayInfo)for(b in this._delayInfo)c.push(b);else for(b in this._vertexBuffers)c.push(b);y4tt.q9();return c;},e.prototype.setIndices=function(b,c){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer);this._indices=b;0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices));void 0!==c&&(this._totalVertices=c);for(var d=this._meshes,f=d.length,e=0;f>e;e++)d[e]._createGlobalSubMesh();this.notifyUpdate();},e.prototype.getTotalIndices=function(){y4tt.v9();return this.isReady()?this._indices.length:0;},e.prototype.getIndices=function(b){var c;if(!this.isReady())return null;c=this._indices;if(b&&1!==this._meshes.length){b=c.length;for(var d=[],f=0;b>f;f++)d.push(c[f]);return d;}return c;},e.prototype.getIndexBuffer=function(){y4tt.q9();return this.isReady()?this._indexBuffer:null;},e.prototype.releaseForMesh=function(b,c){var d,f;d=this._meshes,f=d.indexOf(b);y4tt.q9();if(-1!==f){for(var e in this._vertexBuffers)this._vertexBuffers[e].dispose();this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null);d.splice(f,1);b._geometry=null;0===d.length&&c&&this.dispose();}},e.prototype.applyToMesh=function(b){var c;if(b._geometry!==this){c=b._geometry;c&&c.releaseForMesh(b);c=this._meshes;b._geometry=this;this._scene.pushGeometry(this);c.push(b);this.isReady()?this._applyToMesh(b):b._boundingInfo=this._boundingInfo;}},e.prototype.updateExtend=function(c,d){y4tt.v9();void 0===c&&(c=null);c||(c=this._vertexBuffers[b.VertexBuffer.PositionKind].getData());this._extend=b.Tools.ExtractMinAndMax(c,0,this._totalVertices,this.boundingBias,d);},e.prototype._applyToMesh=function(c){var d,f;d=this._meshes.length;for(f in this._vertexBuffers)1===d&&this._vertexBuffers[f].create(),this._vertexBuffers[f].getBuffer().references=d,f===b.VertexBuffer.PositionKind&&(c._resetPointsArrayCache(),this._extend||this.updateExtend(this._vertexBuffers[f].getData()),c._boundingInfo=new b.BoundingInfo(this._extend.minimum,this._extend.maximum),c._createGlobalSubMesh(),c._updateBoundingInfo());1===d&&this._indices&&0<this._indices.length&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices));this._indexBuffer&&(this._indexBuffer.references=d);},e.prototype.notifyUpdate=function(b){y4tt.q9();this.onGeometryUpdated&&this.onGeometryUpdated(this,b);},e.prototype.load=function(c,d){var f;f=this;if(this.delayLoadState!==b.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(d&&d());this.delayLoadState=b.Engine.DELAYLOADSTATE_LOADING;c._addPendingData(this);b.Tools.LoadFile(this.delayLoadingFile,function(e){f._delayLoadingFunction(JSON.parse(e),f);y4tt.q9();f.delayLoadState=b.Engine.DELAYLOADSTATE_LOADED;f._delayInfo=[];c._removePendingData(f);e=f._meshes;for(var l=e.length,j=0;l>j;j++)f._applyToMesh(e[j]);d&&d();},function(){},c.database);}},e.prototype.toLeftHanded=function(){var c,f;c=this.getIndices(!1);if(null!=c&&0<c.length){for(var d=0;d<c.length;d+=3){f=c[d+0];c[d+0]=c[d+2];c[d+2]=f;}this.setIndices(c);}c=this.getVerticesData(b.VertexBuffer.PositionKind,!1);if(null!=c&&0<c.length){for(d=0;d<c.length;d+=3)c[d+2]=-c[d+2];this.setVerticesData(b.VertexBuffer.PositionKind,c,!1);}c=this.getVerticesData(b.VertexBuffer.NormalKind,!1);if(null!=c&&0<c.length){for(d=0;d<c.length;d+=3)c[d+2]=-c[d+2];this.setVerticesData(b.VertexBuffer.NormalKind,c,!1);}},e.prototype.isDisposed=function(){y4tt.v9();return this._isDisposed;},e.prototype.dispose=function(){var c,d,f;d=this._meshes,f=d.length;for(c=0;f>c;c++)this.releaseForMesh(d[c]);this._meshes=[];for(var e in this._vertexBuffers)this._vertexBuffers[e].dispose();this._vertexBuffers={};this._totalVertices=0;this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer);this._indexBuffer=null;this._indices=[];this.delayLoadState=b.Engine.DELAYLOADSTATE_NONE;this._delayLoadingFunction=this.delayLoadingFile=null;this._delayInfo=[];this._boundingInfo=null;this._scene.removeGeometry(this);this._isDisposed=!0;},e.prototype.copy=function(c){var d,j,l,g;d=new b.VertexData();y4tt.v9();d.indices=[];for(var f=this.getIndices(),l=0;l<f.length;l++)d.indices.push(f[l]);l=f=!1;for(j in this._vertexBuffers){g=this.getVerticesData(j);g instanceof Float32Array?d.set(new Float32Array(g),j):d.set(g.slice(0),j);l||(f=this.getVertexBuffer(j).isUpdatable(),l=!f);}c=new e(c,this._scene,d,f,null);c.delayLoadState=this.delayLoadState;c.delayLoadingFile=this.delayLoadingFile;c._delayLoadingFunction=this._delayLoadingFunction;for(j in this._delayInfo)c._delayInfo=c._delayInfo||[],c._delayInfo.push(j);return c._boundingInfo=new b.BoundingInfo(this._extend.minimum,this._extend.maximum),c;},e.prototype.serialize=function(){var c;c={};return c.id=this.id,b.Tags.HasTags(this)&&(c.tags=b.Tags.GetTags(this)),c;},e.prototype.serializeVerticeData=function(){var c;y4tt.v9();c=this.serialize();return this.isVerticesDataPresent(b.VertexBuffer.PositionKind)&&(c.positions=this.getVerticesData(b.VertexBuffer.PositionKind)),this.isVerticesDataPresent(b.VertexBuffer.NormalKind)&&(c.normals=this.getVerticesData(b.VertexBuffer.NormalKind)),this.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(c.uvs=this.getVerticesData(b.VertexBuffer.UVKind)),this.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(c.uvs2=this.getVerticesData(b.VertexBuffer.UV2Kind)),this.isVerticesDataPresent(b.VertexBuffer.UV3Kind)&&(c.uvs3=this.getVerticesData(b.VertexBuffer.UV3Kind)),this.isVerticesDataPresent(b.VertexBuffer.UV4Kind)&&(c.uvs4=this.getVerticesData(b.VertexBuffer.UV4Kind)),this.isVerticesDataPresent(b.VertexBuffer.UV5Kind)&&(c.uvs5=this.getVerticesData(b.VertexBuffer.UV5Kind)),this.isVerticesDataPresent(b.VertexBuffer.UV6Kind)&&(c.uvs6=this.getVerticesData(b.VertexBuffer.UV6Kind)),this.isVerticesDataPresent(b.VertexBuffer.ColorKind)&&(c.colors=this.getVerticesData(b.VertexBuffer.ColorKind)),this.isVerticesDataPresent(b.VertexBuffer.MatricesIndicesKind)&&(c.matricesIndices=this.getVerticesData(b.VertexBuffer.MatricesIndicesKind),c.matricesIndices._isExpanded=!0),this.isVerticesDataPresent(b.VertexBuffer.MatricesWeightsKind)&&(c.matricesWeights=this.getVerticesData(b.VertexBuffer.MatricesWeightsKind)),c.indices=this.getIndices(),c;},e.ExtractFromMesh=function(b,c){var d;y4tt.v9();d=b._geometry;return d?d.copy(c):null;},e.RandomId=function(){y4tt.q9();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c;c=16*Math.random()|0;y4tt.v9();return("x"===b?c:3&c|8).toString(16);});},e.ImportGeometry=function(c,d){var f,e,l,j;f=d.getScene(),e=c.geometryId;if(e)(e=f.getGeometryByID(e))&&e.applyToMesh(d);else if(c instanceof ArrayBuffer){e=d._binaryInfo;if(e.positionsAttrDesc&&0<e.positionsAttrDesc.count){l=new Float32Array(c,e.positionsAttrDesc.offset,e.positionsAttrDesc.count);d.setVerticesData(b.VertexBuffer.PositionKind,l,!1);}e.normalsAttrDesc&&0<e.normalsAttrDesc.count&&(l=new Float32Array(c,e.normalsAttrDesc.offset,e.normalsAttrDesc.count),d.setVerticesData(b.VertexBuffer.NormalKind,l,!1));e.uvsAttrDesc&&0<e.uvsAttrDesc.count&&(l=new Float32Array(c,e.uvsAttrDesc.offset,e.uvsAttrDesc.count),d.setVerticesData(b.VertexBuffer.UVKind,l,!1));e.uvs2AttrDesc&&0<e.uvs2AttrDesc.count&&(l=new Float32Array(c,e.uvs2AttrDesc.offset,e.uvs2AttrDesc.count),d.setVerticesData(b.VertexBuffer.UV2Kind,l,!1));e.uvs3AttrDesc&&0<e.uvs3AttrDesc.count&&(l=new Float32Array(c,e.uvs3AttrDesc.offset,e.uvs3AttrDesc.count),d.setVerticesData(b.VertexBuffer.UV3Kind,l,!1));e.uvs4AttrDesc&&0<e.uvs4AttrDesc.count&&(l=new Float32Array(c,e.uvs4AttrDesc.offset,e.uvs4AttrDesc.count),d.setVerticesData(b.VertexBuffer.UV4Kind,l,!1));e.uvs5AttrDesc&&0<e.uvs5AttrDesc.count&&(l=new Float32Array(c,e.uvs5AttrDesc.offset,e.uvs5AttrDesc.count),d.setVerticesData(b.VertexBuffer.UV5Kind,l,!1));e.uvs6AttrDesc&&0<e.uvs6AttrDesc.count&&(l=new Float32Array(c,e.uvs6AttrDesc.offset,e.uvs6AttrDesc.count),d.setVerticesData(b.VertexBuffer.UV6Kind,l,!1));e.colorsAttrDesc&&0<e.colorsAttrDesc.count&&(l=new Float32Array(c,e.colorsAttrDesc.offset,e.colorsAttrDesc.count),d.setVerticesData(b.VertexBuffer.ColorKind,l,!1,e.colorsAttrDesc.stride));e.matricesIndicesAttrDesc&&0<e.matricesIndicesAttrDesc.count&&(l=new Int32Array(c,e.matricesIndicesAttrDesc.offset,e.matricesIndicesAttrDesc.count),d.setVerticesData(b.VertexBuffer.MatricesIndicesKind,l,!1));e.matricesWeightsAttrDesc&&0<e.matricesWeightsAttrDesc.count&&(l=new Float32Array(c,e.matricesWeightsAttrDesc.offset,e.matricesWeightsAttrDesc.count),d.setVerticesData(b.VertexBuffer.MatricesWeightsKind,l,!1));e.indicesAttrDesc&&0<e.indicesAttrDesc.count&&(l=new Int32Array(c,e.indicesAttrDesc.offset,e.indicesAttrDesc.count),d.setIndices(l));if(e.subMeshesAttrDesc&&0<e.subMeshesAttrDesc.count){j=new Int32Array(c,e.subMeshesAttrDesc.offset,5*e.subMeshesAttrDesc.count);d.subMeshes=[];for(l=0;l<e.subMeshesAttrDesc.count;l++)new b.SubMesh(j[5*l+0],j[5*l+1],j[5*l+2],j[5*l+3],j[5*l+4],d);}}else if(c.positions&&c.normals&&c.indices){if(d.setVerticesData(b.VertexBuffer.PositionKind,c.positions,!1),d.setVerticesData(b.VertexBuffer.NormalKind,c.normals,!1),c.uvs&&d.setVerticesData(b.VertexBuffer.UVKind,c.uvs,!1),c.uvs2&&d.setVerticesData(b.VertexBuffer.UV2Kind,c.uvs2,!1),c.uvs3&&d.setVerticesData(b.VertexBuffer.UV3Kind,c.uvs3,!1),c.uvs4&&d.setVerticesData(b.VertexBuffer.UV4Kind,c.uvs4,!1),c.uvs5&&d.setVerticesData(b.VertexBuffer.UV5Kind,c.uvs5,!1),c.uvs6&&d.setVerticesData(b.VertexBuffer.UV6Kind,c.uvs6,!1),c.colors&&d.setVerticesData(b.VertexBuffer.ColorKind,b.Color4.CheckColors4(c.colors,c.positions.length/3),!1),c.matricesIndices)if(c.matricesIndices._isExpanded)delete c.matricesIndices._isExpanded,d.setVerticesData(b.VertexBuffer.MatricesIndicesKind,c.matricesIndices,!1);else{e=[];for(l=0;l<c.matricesIndices.length;l++)j=c.matricesIndices[l],e.push(255&j),e.push((65280&j)>>8),e.push((16711680&j)>>16),e.push(j>>24);d.setVerticesData(b.VertexBuffer.MatricesIndicesKind,e,!1);}if(c.matricesIndicesExtra)if(c.matricesIndicesExtra._isExpanded)delete c.matricesIndices._isExpanded,d.setVerticesData(b.VertexBuffer.MatricesIndicesExtraKind,c.matricesIndicesExtra,!1);else{e=[];for(l=0;l<c.matricesIndicesExtra.length;l++)j=c.matricesIndicesExtra[l],e.push(255&j),e.push((65280&j)>>8),e.push((16711680&j)>>16),e.push(j>>24);d.setVerticesData(b.VertexBuffer.MatricesIndicesExtraKind,e,!1);}c.matricesWeights&&d.setVerticesData(b.VertexBuffer.MatricesWeightsKind,c.matricesWeights,!1);c.matricesWeightsExtra&&d.setVerticesData(b.VertexBuffer.MatricesWeightsExtraKind,c.matricesWeightsExtra,!1);d.setIndices(c.indices);}y4tt.v9();if(c.subMeshes){d.subMeshes=[];for(e=0;e<c.subMeshes.length;e++)l=c.subMeshes[e],new b.SubMesh(l.materialIndex,l.verticesStart,l.verticesCount,l.indexStart,l.indexCount,d);}d._shouldGenerateFlatShading&&(d.convertToFlatShadedMesh(),delete d._shouldGenerateFlatShading);d.computeWorldMatrix(!0);f._selectionOctree&&f._selectionOctree.addMesh(d);},e.Parse=function(c,d,f){var l;if(d.getGeometryByID(c.id))return null;l=new e(c.id,d);return b.Tags.AddTagsTo(l,c.tags),c.delayLoadingFile?(l.delayLoadState=b.Engine.DELAYLOADSTATE_NOTLOADED,l.delayLoadingFile=f+c.delayLoadingFile,l._boundingInfo=new b.BoundingInfo(b.Vector3.FromArray(c.boundingBoxMinimum),b.Vector3.FromArray(c.boundingBoxMaximum)),l._delayInfo=[],c.hasUVs&&l._delayInfo.push(b.VertexBuffer.UVKind),c.hasUVs2&&l._delayInfo.push(b.VertexBuffer.UV2Kind),c.hasUVs3&&l._delayInfo.push(b.VertexBuffer.UV3Kind),c.hasUVs4&&l._delayInfo.push(b.VertexBuffer.UV4Kind),c.hasUVs5&&l._delayInfo.push(b.VertexBuffer.UV5Kind),c.hasUVs6&&l._delayInfo.push(b.VertexBuffer.UV6Kind),c.hasColors&&l._delayInfo.push(b.VertexBuffer.ColorKind),c.hasMatricesIndices&&l._delayInfo.push(b.VertexBuffer.MatricesIndicesKind),c.hasMatricesWeights&&l._delayInfo.push(b.VertexBuffer.MatricesWeightsKind),l._delayLoadingFunction=b.VertexData.ImportVertexData):b.VertexData.ImportVertexData(c,l),d.pushGeometry(l,!0),l;},e);b.Geometry=g;c=g=b.Geometry||(b.Geometry={});g=c.Primitives||(c.Primitives={});f=function(b,d,f,e){c.call(this,b,d,null,!1,e);this._canBeRegenerated=f;this._beingRegenerated=!0;this.regenerate();this._beingRegenerated=!1;};d=(__extends(f,c),f.prototype.canBeRegenerated=function(){return this._canBeRegenerated;},f.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1);},f.prototype.asNewGeometry=function(b){return c.prototype.copy.call(this,b);},f.prototype.setAllVerticesData=function(b){y4tt.v9();this._beingRegenerated&&c.prototype.setAllVerticesData.call(this,b,!1);},f.prototype.setVerticesData=function(b,d){y4tt.v9();this._beingRegenerated&&c.prototype.setVerticesData.call(this,b,d,!1);},f.prototype._regenerateVertexData=function(){y4tt.q9();throw Error("Abstract method");},f.prototype.copy=function(){throw Error("Must be overriden in sub-classes.");},f.prototype.serialize=function(){var b;b=c.prototype.serialize.call(this);return b.canBeRegenerated=this.canBeRegenerated(),b;},f);g._Primitive=d;q=function(c,f,e,l,j,g,m,p,n){void 0===n&&(n=b.Mesh.DEFAULTSIDE);d.call(this,c,f,m,p);this.pathArray=e;this.closeArray=l;this.closePath=j;y4tt.q9();this.offset=g;this.side=n;},f=(__extends(q,d),q.prototype._regenerateVertexData=function(){y4tt.v9();return b.VertexData.CreateRibbon({pathArray:this.pathArray,closeArray:this.closeArray,closePath:this.closePath,offset:this.offset,sideOrientation:this.side});},q.prototype.copy=function(b){return new q(b,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),null,this.side);},q);g.Ribbon=f;j=function(c,f,e,l,j,g){void 0===g&&(g=b.Mesh.DEFAULTSIDE);d.call(this,c,f,l,j);y4tt.v9();this.size=e;this.side=g;},f=(__extends(j,d),j.prototype._regenerateVertexData=function(){return b.VertexData.CreateBox({size:this.size,sideOrientation:this.side});},j.prototype.copy=function(b){return new j(b,this.getScene(),this.size,this.canBeRegenerated(),null,this.side);},j.prototype.serialize=function(){var b;b=d.prototype.serialize.call(this);return b.size=this.size,b;},j.Parse=function(d,f){var e;if(f.getGeometryByID(d.id))return null;e=new c.Primitives.Box(d.id,f,d.size,d.canBeRegenerated,null);return b.Tags.AddTagsTo(e,d.tags),f.pushGeometry(e,!0),e;},j);g.Box=f;l=function(c,f,e,l,j,g,m){void 0===m&&(m=b.Mesh.DEFAULTSIDE);d.call(this,c,f,j,g);this.segments=e;this.diameter=l;this.side=m;},f=(__extends(l,d),l.prototype._regenerateVertexData=function(){y4tt.v9();return b.VertexData.CreateSphere({segments:this.segments,diameter:this.diameter,sideOrientation:this.side});},l.prototype.copy=function(b){y4tt.q9();return new l(b,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side);},l.prototype.serialize=function(){var b;b=d.prototype.serialize.call(this);y4tt.q9();return b.segments=this.segments,b.diameter=this.diameter,b;},l.Parse=function(d,f){var e;if(f.getGeometryByID(d.id))return null;e=new c.Primitives.Sphere(d.id,f,d.segments,d.diameter,d.canBeRegenerated,null);return b.Tags.AddTagsTo(e,d.tags),f.pushGeometry(e,!0),e;},l);g.Sphere=f;n=function(c,f,e,l,j,g,m){void 0===m&&(m=b.Mesh.DEFAULTSIDE);d.call(this,c,f,j,g);this.radius=e;y4tt.q9();this.tessellation=l;this.side=m;},f=(__extends(n,d),n.prototype._regenerateVertexData=function(){y4tt.v9();return b.VertexData.CreateDisc({radius:this.radius,tessellation:this.tessellation,sideOrientation:this.side});},n.prototype.copy=function(b){return new n(b,this.getScene(),this.radius,this.tessellation,this.canBeRegenerated(),null,this.side);},n);g.Disc=f;m=function(c,f,e,l,j,g,m,p,n,q){void 0===m&&(m=1);void 0===q&&(q=b.Mesh.DEFAULTSIDE);d.call(this,c,f,p,n);this.height=e;this.diameterTop=l;this.diameterBottom=j;this.tessellation=g;this.subdivisions=m;this.side=q;},f=(__extends(m,d),m.prototype._regenerateVertexData=function(){y4tt.q9();return b.VertexData.CreateCylinder({height:this.height,diameterTop:this.diameterTop,diameterBottom:this.diameterBottom,tessellation:this.tessellation,subdivisions:this.subdivisions,sideOrientation:this.side});},m.prototype.copy=function(b){return new m(b,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side);},m.prototype.serialize=function(){var b;b=d.prototype.serialize.call(this);return b.height=this.height,b.diameterTop=this.diameterTop,b.diameterBottom=this.diameterBottom,b.tessellation=this.tessellation,b;},m.Parse=function(d,f){var e;if(f.getGeometryByID(d.id))return null;e=new c.Primitives.Cylinder(d.id,f,d.height,d.diameterTop,d.diameterBottom,d.tessellation,d.subdivisions,d.canBeRegenerated,null);return b.Tags.AddTagsTo(e,d.tags),f.pushGeometry(e,!0),e;},m);g.Cylinder=f;p=function(c,f,e,l,j,g,m,p){void 0===p&&(p=b.Mesh.DEFAULTSIDE);d.call(this,c,f,g,m);this.diameter=e;this.thickness=l;this.tessellation=j;this.side=p;},f=(__extends(p,d),p.prototype._regenerateVertexData=function(){return b.VertexData.CreateTorus({diameter:this.diameter,thickness:this.thickness,tessellation:this.tessellation,sideOrientation:this.side});},p.prototype.copy=function(b){y4tt.q9();return new p(b,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side);},p.prototype.serialize=function(){var b;y4tt.q9();b=d.prototype.serialize.call(this);return b.diameter=this.diameter,b.thickness=this.thickness,b.tessellation=this.tessellation,b;},p.Parse=function(d,f){var e;if(f.getGeometryByID(d.id))return null;e=new c.Primitives.Torus(d.id,f,d.diameter,d.thickness,d.tessellation,d.canBeRegenerated,null);y4tt.v9();return b.Tags.AddTagsTo(e,d.tags),f.pushGeometry(e,!0),e;},p);g.Torus=f;r=function(b,c,f,e,l,j,g){d.call(this,b,c,j,g);this.width=f;y4tt.v9();this.height=e;this.subdivisions=l;},f=(__extends(r,d),r.prototype._regenerateVertexData=function(){y4tt.q9();return b.VertexData.CreateGround({width:this.width,height:this.height,subdivisions:this.subdivisions});},r.prototype.copy=function(b){return new r(b,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null);},r.prototype.serialize=function(){var b;b=d.prototype.serialize.call(this);return b.width=this.width,b.height=this.height,b.subdivisions=this.subdivisions,b;},r.Parse=function(d,f){var e;if(f.getGeometryByID(d.id))return null;e=new c.Primitives.Ground(d.id,f,d.width,d.height,d.subdivisions,d.canBeRegenerated,null);return b.Tags.AddTagsTo(e,d.tags),f.pushGeometry(e,!0),e;},r);g.Ground=f;s=function(b,c,f,e,l,j,g,m,p,n){d.call(this,b,c,p,n);this.xmin=f;y4tt.q9();this.zmin=e;this.xmax=l;this.zmax=j;this.subdivisions=g;this.precision=m;},f=(__extends(s,d),s.prototype._regenerateVertexData=function(){y4tt.v9();return b.VertexData.CreateTiledGround({xmin:this.xmin,zmin:this.zmin,xmax:this.xmax,zmax:this.zmax,subdivisions:this.subdivisions,precision:this.precision});},s.prototype.copy=function(b){return new s(b,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null);},s);g.TiledGround=f;t=function(c,f,e,l,j,g){void 0===g&&(g=b.Mesh.DEFAULTSIDE);d.call(this,c,f,l,j);this.size=e;this.side=g;},f=(__extends(t,d),t.prototype._regenerateVertexData=function(){y4tt.q9();return b.VertexData.CreatePlane({size:this.size,sideOrientation:this.side});},t.prototype.copy=function(b){return new t(b,this.getScene(),this.size,this.canBeRegenerated(),null,this.side);},t.prototype.serialize=function(){var b;b=d.prototype.serialize.call(this);return b.size=this.size,b;},t.Parse=function(d,f){var e;y4tt.q9();if(f.getGeometryByID(d.id))return null;e=new c.Primitives.Plane(d.id,f,d.size,d.canBeRegenerated,null);return b.Tags.AddTagsTo(e,d.tags),f.pushGeometry(e,!0),e;},t);y4tt.v9();g.Plane=f;v=function(c,f,e,l,j,g,m,p,n,q,r){void 0===r&&(r=b.Mesh.DEFAULTSIDE);d.call(this,c,f,n,q);this.radius=e;this.tube=l;this.radialSegments=j;this.tubularSegments=g;this.p=m;this.q=p;this.side=r;},f=(__extends(v,d),v.prototype._regenerateVertexData=function(){y4tt.q9();return b.VertexData.CreateTorusKnot({radius:this.radius,tube:this.tube,radialSegments:this.radialSegments,tubularSegments:this.tubularSegments,p:this.p,q:this.q,sideOrientation:this.side});},v.prototype.copy=function(b){y4tt.q9();return new v(b,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side);},v.prototype.serialize=function(){var b;y4tt.q9();b=d.prototype.serialize.call(this);return b.radius=this.radius,b.tube=this.tube,b.radialSegments=this.radialSegments,b.tubularSegments=this.tubularSegments,b.p=this.p,b.q=this.q,b;},v.Parse=function(d,f){var e;if(f.getGeometryByID(d.id))return null;e=new c.Primitives.TorusKnot(d.id,f,d.radius,d.tube,d.radialSegments,d.tubularSegments,d.p,d.q,d.canBeRegenerated,null);return b.Tags.AddTagsTo(e,d.tags),f.pushGeometry(e,!0),e;},v);g.TorusKnot=f;!0;!0;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.Mesh;g=function(c,d){e.call(this,c,d);this.generateOctree=!1;y4tt.q9();this._worldInverse=new b.Matrix();};g=(__extends(g,e),Object.defineProperty(g.prototype,"subdivisions",{get:function(){return this._subdivisions;},enumerable:!0,configurable:!0}),g.prototype.optimize=function(b,d){void 0===d&&(d=32);this._subdivisions=b;this.subdivide(this._subdivisions);this.createOrUpdateSubmeshesOctree(d);},g.prototype.getHeightAtCoordinates=function(b,d){var f;if(b-=this.position.x,d-=this.position.z,b/=this.scaling.x,d/=this.scaling.z,b<this._minX||b>this._maxX||d<this._minZ||d>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());f=this._getFacetAt(b,d);return-(f.x*b+f.z*d+f.w)/f.y*this.scaling.y+this.position.y;},g.prototype.getNormalAtCoordinates=function(c,d){var f;y4tt.q9();f=new b.Vector3(0,1,0);return this.getNormalAtCoordinatesToRef(c,d,f),f;},g.prototype.getNormalAtCoordinatesToRef=function(b,d,f){y4tt.q9();if(b-=this.position.x,d-=this.position.z,b/=this.scaling.x,d/=this.scaling.z,!(b<this._minX||b>this._maxX||d<this._minZ||d>this._maxZ))this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads()),b=this._getFacetAt(b,d),f.x=b.x,f.y=b.y,f.z=b.z;},g.prototype.updateCoordinateHeights=function(){this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads();y4tt.q9();this._computeHeightQuads();},g.prototype._getFacetAt=function(b,d){var f;f=this._heightQuads[Math.floor(-(d+this._maxZ)*this._subdivisions/this._height+this._subdivisions)*this._subdivisions+Math.floor((b+this._maxX)*this._subdivisions/this._width)];return d<f.slope.x*b+f.slope.y?f.facet1:f.facet2;},g.prototype._initHeightQuads=function(){var f;y4tt.v9();this._heightQuads=[];for(var c=0;c<this._subdivisions;c++)for(var d=0;d<this._subdivisions;d++){f={slope:b.Vector2.Zero(),facet1:new b.Vector4(0,0,0,0),facet2:new b.Vector4(0,0,0,0)};this._heightQuads[c*this._subdivisions+d]=f;}},g.prototype._computeHeightQuads=function(){var v,y,B;y4tt.v9();for(var c=this.getVerticesData(b.VertexBuffer.PositionKind),d=b.Tmp.Vector3[0],f=b.Tmp.Vector3[1],e=b.Tmp.Vector3[2],j=b.Tmp.Vector3[3],l=b.Tmp.Vector3[4],g=b.Tmp.Vector3[5],m=b.Tmp.Vector3[6],p=b.Tmp.Vector3[7],r=b.Tmp.Vector3[8],s=0,t=0,v=0,y=v=t=s=0,x=0;x<this._subdivisions;x++)for(var z=0;z<this._subdivisions;z++){s=3*z;t=3*x*(this._subdivisions+1);v=3*(x+1)*(this._subdivisions+1);d.x=c[t+s];d.y=c[t+s+1];d.z=c[t+s+2];f.x=c[t+s+3];f.y=c[t+s+4];f.z=c[t+s+5];e.x=c[v+s];e.y=c[v+s+1];e.z=c[v+s+2];j.x=c[v+s+3];j.y=c[v+s+4];j.z=c[v+s+5];s=(j.z-d.z)/(j.x-d.x);t=d.z-s*d.x;f.subtractToRef(d,l);e.subtractToRef(d,g);j.subtractToRef(d,m);b.Vector3.CrossToRef(m,g,p);b.Vector3.CrossToRef(l,m,r);p.normalize();r.normalize();v=-(p.x*d.x+p.y*d.y+p.z*d.z),y=-(r.x*f.x+r.y*f.y+r.z*f.z),B=this._heightQuads[x*this._subdivisions+z];B.slope.copyFromFloats(s,t);B.facet1.copyFromFloats(p.x,p.y,p.z,v);B.facet2.copyFromFloats(r.x,r.y,r.z,y);}},g);b.GroundMesh=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;y4tt.v9();e=b.Mesh,c=function(c,f,g,j,l){void 0===g&&(g=null);e.call(this,c,f,g,j,l);this.color=new b.Color3(1,1,1);this.alpha=1;this._positionBuffer={};j&&(this.color=j.color.clone(),this.alpha=j.alpha);this._intersectionThreshold=0.1;this._colorShader=new b.ShaderMaterial("colorShader",f,"color",{attributes:[b.VertexBuffer.PositionKind],uniforms:["worldViewProjection","color"],needAlphaBlending:!0});y4tt.q9();this._positionBuffer[b.VertexBuffer.PositionKind]=null;};g=(__extends(c,e),Object.defineProperty(c.prototype,"intersectionThreshold",{get:function(){y4tt.v9();return this._intersectionThreshold;},set:function(c){y4tt.v9();this._intersectionThreshold!==c&&(this._intersectionThreshold=c,this.geometry&&(this.geometry.boundingBias=new b.Vector2(0,c)));},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"material",{get:function(){return this._colorShader;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"checkCollisions",{get:function(){y4tt.v9();return!1;},enumerable:!0,configurable:!0}),c.prototype.createInstance=function(){return b.Tools.Log("LinesMeshes do not support createInstance."),null;},c.prototype._bind=function(){var c;y4tt.v9();c=this.getScene().getEngine();this._positionBuffer[b.VertexBuffer.PositionKind]=this._geometry.getVertexBuffer(b.VertexBuffer.PositionKind);c.bindBuffers(this._positionBuffer,this._geometry.getIndexBuffer(),this._colorShader.getEffect());this._colorShader.setColor4("color",this.color.toColor4(this.alpha));},c.prototype._draw=function(b){this._geometry&&(this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer())&&this.getScene().getEngine().draw(!1,b.indexStart,b.indexCount);},c.prototype.dispose=function(b){y4tt.q9();this._colorShader.dispose();e.prototype.dispose.call(this,b);},c.prototype.clone=function(b,f,e){return new c(b,this.getScene(),f,this,e);},c);b.LinesMesh=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(b,c,d){var f;f=this;void 0===c&&(c="");void 0===d&&(d="black");this._renderingCanvas=b;this._loadingText=c;this._loadingDivBackgroundColor=d;this._resizeLoadingUI=function(){var b;b=f._renderingCanvas.getBoundingClientRect();y4tt.q9();f._loadingDiv.style.position="absolute";f._loadingDiv.style.left=b.left+"px";f._loadingDiv.style.top=b.top+"px";f._loadingDiv.style.width=b.width+"px";f._loadingDiv.style.height=b.height+"px";};};y4tt.q9();g=(g.prototype.displayLoadingUI=function(){var b,c,d,f;b=this;y4tt.q9();if(!this._loadingDiv){this._loadingDiv=document.createElement("div");this._loadingDiv.id="babylonjsLoadingDiv";this._loadingDiv.style.opacity="0";this._loadingDiv.style.transition="opacity 1.5s ease";this._loadingTextDiv=document.createElement("div");this._loadingTextDiv.style.position="absolute";this._loadingTextDiv.style.left="0";this._loadingTextDiv.style.top="50%";this._loadingTextDiv.style.marginTop="80px";this._loadingTextDiv.style.width="100%";this._loadingTextDiv.style.height="20px";this._loadingTextDiv.style.fontFamily="Arial";this._loadingTextDiv.style.fontSize="14px";this._loadingTextDiv.style.color="white";this._loadingTextDiv.style.textAlign="center";this._loadingTextDiv.innerHTML="Loading";this._loadingDiv.appendChild(this._loadingTextDiv);this._loadingTextDiv.innerHTML=this._loadingText;c=new Image();c.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAARbSURBVHhe7Z09aFNRFMc716kuLrq4FdyLq4Wi4CAoRQcR0UJBUBdRiuLSIYMo6CA4FF2sgw6CFAdFUOpSQYcWO4hD26UQCfXrIQrx/JJzw1OSWq3NPeL/B4Fy+0jg/HO+7j3vpUcI8b/Q39+/49ihfWdPHT94Yf/e3Se3bd263f8lus218TPn6vV6Ya8Wi/MzNRNmj18iusX9W1evmP1/EKNEIVG6CMbG6E3bt+fT++pHha8NoHdT72bLE8NDg7tGU64gLLndV4Wc4m8j/pS+vr4tGB/DT16v3Fyr8dvBe/jbit8BL0AES9LX1iPAz+BR/hFiLVCynj95dPzNy6fv3IZ/k4L3948Sq7FzYGBg4vLFGxitabuOFCbWNKGrMnbiUuo18KaV6tIHv6YtvL9/nOgE31jCktmrY7k6+/zhE4yP4Vf7hiNqh/BWWEl8mzDol4p22Lf7cIdvdUMEvv0Y2S9fE5S1hLzpqTsPkiep//gFGPnR3Yl7GL5p/xYFBrTwM+iXio3GqpwDGL5p/xYNIX7XG8Q6IJRgdIzf1KBBgafII7oMidhyQtVFaMA2Bt7il4huQRhaXphbcR2g4RXqBzKAGHiCCwGFVUAj/m/RTRDj29cvn10I0PZ3LghH5f4CL1EFlQmqqXK3jDDKFxmhQ3Yt6oQseUZGKmMnTpsOqc8o1F9kBOMjQlOLeqEeIyOc6JV6jYLJD/+XyIFvnzdgl9aXRQ5I2qZDK1SpospMqaoqON/wZZGDciLnMMiXRS7IF4hhqMTNTdk7CFu+LHLhR7BQqBvPDJUUQqCGvCMATHUgBmhWNgApmdOda9YpM+VwRYfuyyIXDK8hBlilNerLIheMZCKGwlUAyru6GlwOgPUbRxADdJ9FAChxXY864viyyEXqPxhc0M2TAfAbatSdRyHtXymhByEdRnE3ky+JnHAIhSA0h74kckETmHoQbSgGwJrCIRMEPSRIBCRIMAhZaYhaggQhJXUJEoRU9mofKwh+F22dLRRfEjlJM7w6KQwCoQpBOKTyJZETjmwRxKqtGV8SOSkNOGjKPQppBEgDDkFgpxdBVGkFgaYQQXRIFQSObk0P5ZFIpAZRHXsQ0r0hCluBWKkuvVbYCkQaCdL5ehBScudJP4yY+rLISdps1NBDEJKXMMmoSfggWC4ZQRR17oFYXph7hSiquIKQ+hJGTX1J5MYSPD/GVdNzsgLBwZVCVyAQAkF0ohiI/c1fS6tNXq9UfEnkhudmIQolsS+J3Hh/UtNDzQLhj42VKJFInqLwFYiUU5ToA+HdfI0JevUpQUAIn+vSz2lHIuUV/dJOIHhOY/IWVWGBIHQtzs88s9zyWBuTgcBLzGOmeNnfF/QslSDgMeQW85i3DOQxuipxAkCyZ8SIm4Omp+7MMlCB59j6sKZcMoM4iIEoeI2J9AKxrFobZx0v4vYInuHFS4J1GQRCAGaLEYQXfyMML5XSQgghhBBCCCH+cXp6vgNhKpSKX/XdOAAAAABJRU5ErkJggg==";c.style.position="absolute";c.style.left="50%";c.style.top="50%";c.style.marginLeft="-50px";c.style.marginTop="-50px";c.style.transition="transform 1.0s ease";c.style.webkitTransition="-webkit-transform 1.0s ease";d=360,f=function(){d+=360;c.style.transform="rotateZ("+d+"deg)";c.style.webkitTransform="rotateZ("+d+"deg)";};c.addEventListener("transitionend",f);c.addEventListener("webkitTransitionEnd",f);this._loadingDiv.appendChild(c);f=new Image();f.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAYJSURBVHhe7Zy/qx1FFMff/2Av2Nvbi4WFiiAEY/OQ2IgQsbCJQoqkCAgpFLXyoZURLfwBIiIpgqZJoYQYlWelNsIrNOxDJcrzfHe+G97dnTl75u7euzv7zgcWHrlnZmfOmXPmzI/NjuM4juM4juM4juM4juM4juM4juM4juM45fPic08/uHf5/CvffH7lnT8PfrtxdHS0n3p+/fHGl5+89/prr5599iEWd8bg0rkXHoFyqehKnlxQpjYSDHTm9JMPsGrHylOPPXofvICKXMcIGtXdf/76AYbm6xyNW9e/eAtKC7rbKLXnvHHx5Sf4auc4Ek7OQkFU1Dap/vv37k/wSjblZANFiFIGzw98hhizwqBgs04mCBdQRNCHidoAEtY+lLIvtSdoGFeyql2ZH57HBH4sE7O+o/r9l+8/ZXUni68+2jsHBQQ9qNRGeP/tSxdSYQX/roUcpL4/f3vtM9TD+jTq92n1LQ7jxF1hhGPtwWL3gGccy8JuS1r8sVWBGXNVdSKMYjBGPUJjCzooiGuSpnwlnnOGP2dhHRSLNgpHp2oMKIriK8TmG4Qh/rwW8D6pps9b9im+LDDipXOqMVJrAngBfg9i98gevWKA+/nnCod3Dr5GfaHaDgidVym6HKRjGIkpqthcAVKGxNqBImbEo66kjCih8AOpNmkUmbMuUrR8kEqiU6FvHZLGAPJ71JCYSyhiBqmwFE2GoD6jLGIfDHtG6EzoU4dK21PCqIRMEF0FGRjFzGDtIkXVAdATvsqfT9CJ0JcOFdYiFIsiMlqYy1YOFpQo2OddqBtyEaq9y+efoVh5oPHoROjLKn0j3JIE5Ka8UqZRtGrMnneX6yVofOhDh94MSbznTcpqmDOt1vyQzOgaJAF4F3JBfIXesrNEGWWmjIX7UBZ6jRJbBMLg/DmJiKUGVHleIpnVNTa+jakzkAviJqLhi4MC9XQGBrZeKJZESSrKy7ik0VGFWhQBRDTHIACKQ5l9nAjy75gya4a2w+Jhs0FJdc0xX/GwUbAqFBkZi7QpJ2w16WUbjFyK9MJF3KaoEM74KhVtLrQOrsmRxkbdHEqmSC/c+EuGnIFkjW7Ih2Kr4CCMIvNG2hrrgLpCjiFloooYCjyYrzCRyvhyBthkIPuQtsZGdnbMTezyDiU71KTC5zr7aVsHbsz2tllrEkS5UHwU1tq1HbtPW4UbeB0O7xx8R5EsMJql+BheUmHjkNVmIRP7LutoM3+D4O4tG7vCkNO9ESZ4lL3J6rKRMPx4qKbD/A0icf8CG7tC7kTahnMTwleuYSrsS7GatRAvfZh1tTm5BmmQCdZ8a0Sefe28xUrRBkmFLKy8KTIKUDRX0Y1xagPgwbaIdeFnQULmKak3xvwNMkVGgok/N5XNoehJvejRlCDl9escI28dJU0tZ++nBTJE9mEF647x5Ehbo4s5hDOKFIU0PdofeA5F5k1q63zIWmQqNI/P3ZubjFTqKxQ3jyjHAOX0RdlgVO9hzRFpczRcjZ3Gbxxpc7Qj6+5pTYF2OFXawNI+yDGf1k2NcvOlzBQeDQ/t7zD7DsEDpJ2xATXaNtDWUS4IzP4DS2ljajAVu57SUkYw245ptxZxA5JiZaJ0DswudGn3kYUy54426EjoT4dZfYbccxC2nI92cDkZHQr96jD4AGkMDKeSy/COBsRe6VTSKFN6irLeaCh3IteQjt1E5+oudsG/b/2DfZ5AqsYo8vMDK9LB1HzSsLWvlGThdxXvC6+NsqyPPWP0pMINtbdsajfVeC6f/GZ+cdAofQoB1d+Hf9waY98I7+RXWab3Lt4zYkjHtTnlOLXHYMsCh1zWeQYehu1zfNPOOiys/d91LAKEBSgh6MJMbSA82AaHofDgAIwbgvVvlLNS11nModMm4UZergLHZBZrodmBuA3lBB1thdorSjkOmATMDwg/UBQVtglqQyx6fbEJ+H3IWIapjYAjAfeIgeCMHldueJvFaqDaAHhwf8qNsEEQ1iQbOoUUGIbCLRc8+Bvfp4jyd2FEijuO4ziO4ziO4ziO4ziO4ziO4ziO4ziOUzw7O/8D0P7rcZ/GEboAAAAASUVORK5CYII=";f.style.position="absolute";f.style.left="50%";f.style.top="50%";f.style.marginLeft="-50px";f.style.marginTop="-50px";this._loadingDiv.appendChild(f);this._resizeLoadingUI();window.addEventListener("resize",this._resizeLoadingUI);this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor;document.body.appendChild(this._loadingDiv);setTimeout(function(){b._loadingDiv.style.opacity="1";c.style.transform="rotateZ(360deg)";y4tt.q9();c.style.webkitTransform="rotateZ(360deg)";},0);}},g.prototype.hideLoadingUI=function(){var b;y4tt.v9();b=this;this._loadingDiv&&(this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",function(){b._loadingDiv&&(document.body.removeChild(b._loadingDiv),window.removeEventListener("resize",b._resizeLoadingUI),b._loadingDiv=null);}));},Object.defineProperty(g.prototype,"loadingUIText",{set:function(b){this._loadingText=b;this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"loadingUIBackgroundColor",{get:function(){y4tt.v9();return this._loadingDivBackgroundColor;},set:function(b){y4tt.v9();this._loadingDivBackgroundColor=b;this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor);},enumerable:!0,configurable:!0}),g);b.DefaultLoadingScreen=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(){this._audioContext=null;this.unlocked=this.WarnedWebAudioUnsupported=this.canUseWebAudio=this._audioContextInitialized=!1;"undefined"==typeof window.AudioContext&&"undefined"==typeof window.webkitAudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);/iPad|iPhone|iPod/.test(navigator.platform)?this._unlockiOSaudio():this.unlocked=!0;};g=(Object.defineProperty(g.prototype,"audioContext",{get:function(){y4tt.q9();return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext;},enumerable:!0,configurable:!0}),g.prototype._unlockiOSaudio=function(){var b,c;b=this,c=function(){var d,f;d=b.audioContext.createBuffer(1,1,22050),f=b.audioContext.createBufferSource();f.buffer=d;f.connect(b.audioContext.destination);f.start(0);setTimeout(function(){f.playbackState!==f.PLAYING_STATE&&f.playbackState!==f.FINISHED_STATE||(b.unlocked=!0,window.removeEventListener("touchend",c,!1),b.onAudioUnlocked&&b.onAudioUnlocked());},0);};window.addEventListener("touchend",c,!1);},g.prototype._initializeAudioContext=function(){y4tt.q9();try{this.canUseWebAudio&&(this._audioContext=new AudioContext(),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0);}catch(e){this.canUseWebAudio=!1,b.Tools.Error("Web Audio: "+e.message);}},g.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1);y4tt.q9();this.WarnedWebAudioUnsupported=!1;},g.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1;},g.prototype.setGlobalVolume=function(b){y4tt.v9();this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=b);},g.prototype.connectToAnalyser=function(b){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();y4tt.q9();this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser=b,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination));},g);b.AudioEngine=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(c,d,f,e,j){var l;l=this;this.spatialSound=this.useCustomAttenuation=this.loop=this.autoplay=!1;this.rolloffFactor=this.refDistance=1;this.maxDistance=100;this.distanceModel="linear";this._panningModel="equalpower";this._playbackRate=1;this._streaming=!1;this._startOffset=this._startTime=0;this._position=b.Vector3.Zero();this._localDirection=new b.Vector3(1,0,0);this._volume=1;y4tt.q9();this._isDirectional=this.isPaused=this.isPlaying=this._isReadyToPlay=this._isLoaded=!1;this._coneOuterAngle=this._coneInnerAngle=360;this._coneOuterGain=0;this._isOutputConnected=!1;this.name=c;this._scene=f;this._readyToPlayCallback=e;this._customAttenuationFunction=function(b,c,d){return d>c?b*(1-c/d):0;};j&&(this.autoplay=j.autoplay||!1,this.loop=j.loop||!1,void 0!==j.volume&&(this._volume=j.volume),this.spatialSound=j.spatialSound||!1,this.maxDistance=j.maxDistance||100,this.useCustomAttenuation=j.useCustomAttenuation||!1,this.rolloffFactor=j.rolloffFactor||1,this.refDistance=j.refDistance||1,this.distanceModel=j.distanceModel||"linear",this._playbackRate=j.playbackRate||1,this._streaming=j.streaming||!1);b.Engine.audioEngine.canUseWebAudio?(this._soundGain=b.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._ouputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this),d&&("string"==typeof d?this._streaming?(this._htmlAudioElement=new Audio(d),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,this._htmlAudioElement.crossOrigin="anonymous",this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){y4tt.v9();l._isReadyToPlay=!0;l.autoplay&&l.play();l._readyToPlayCallback&&l._readyToPlayCallback();}),document.body.appendChild(this._htmlAudioElement)):b.Tools.LoadFile(d,function(b){l._soundLoaded(b);},null,this._scene.database,!0):d instanceof ArrayBuffer?0<d.byteLength&&this._soundLoaded(d):b.Tools.Error("Parameter must be a URL to the sound or an ArrayBuffer of the sound."))):(this._scene.mainSoundTrack.AddSound(this),b.Engine.audioEngine.WarnedWebAudioUnsupported||(b.Tools.Error("Web Audio is not supported by your browser."),b.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){l._readyToPlayCallback();},1E3));};y4tt.v9();g=(e.prototype.dispose=function(){y4tt.q9();b.Engine.audioEngine.canUseWebAudio&&this._isReadyToPlay&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedMesh=null));},e.prototype._soundLoaded=function(c){var d;d=this;y4tt.v9();this._isLoaded=!0;b.Engine.audioEngine.audioContext.decodeAudioData(c,function(b){d._audioBuffer=b;d._isReadyToPlay=!0;d.autoplay&&d.play();d._readyToPlayCallback&&d._readyToPlayCallback();},function(){b.Tools.Error("Error while decoding audio data for: "+d.name);});},e.prototype.setAudioBuffer=function(c){y4tt.q9();b.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=c,this._isReadyToPlay=!0);},e.prototype.updateOptions=function(b){y4tt.q9();b&&(this.loop=b.loop||this.loop,this.maxDistance=b.maxDistance||this.maxDistance,this.useCustomAttenuation=b.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=b.rolloffFactor||this.rolloffFactor,this.refDistance=b.refDistance||this.refDistance,this.distanceModel=b.distanceModel||this.distanceModel,this._playbackRate=b.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._streaming?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource.playbackRate.value=this._playbackRate));},e.prototype._createSpatialParameters=function(){y4tt.v9();b.Engine.audioEngine.canUseWebAudio&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=b.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._ouputAudioNode),this._inputAudioNode=this._soundPanner);},e.prototype._updateSpatialParameters=function(){this.spatialSound&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel));},e.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF";this._switchPanningModel();},e.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower";this._switchPanningModel();},e.prototype._switchPanningModel=function(){b.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&(this._soundPanner.panningModel=this._panningModel);},e.prototype.connectToSoundTrackAudioNode=function(c){b.Engine.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._ouputAudioNode.disconnect(),this._ouputAudioNode.connect(c),this._isOutputConnected=!0);},e.prototype.setDirectionalCone=function(c,d,f){y4tt.v9();return c>d?void b.Tools.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=c,this._coneOuterAngle=d,this._coneOuterGain=f,this._isDirectional=!0,void(this.isPlaying&&this.loop&&(this.stop(),this.play())));},e.prototype.setPosition=function(c){y4tt.v9();this._position=c;b.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z);},e.prototype.setLocalDirectionToMesh=function(c){this._localDirection=c;b.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection();},e.prototype._updateDirection=function(){var c;c=this._connectedMesh.getWorldMatrix(),c=b.Vector3.TransformNormal(this._localDirection,c);c.normalize();this._soundPanner.setOrientation(c.x,c.y,c.z);},e.prototype.updateDistanceFromListener=function(){var c;y4tt.v9();if(b.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation){c=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,c,this.maxDistance,this.refDistance,this.rolloffFactor);}},e.prototype.setAttenuationFunction=function(b){this._customAttenuationFunction=b;},e.prototype.play=function(c){var d,f;d=this;if(this._isReadyToPlay&&this._scene.audioEnabled)try{0>this._startOffset&&(c=-this._startOffset,this._startOffset=0);f=c?b.Engine.audioEngine.audioContext.currentTime+c:b.Engine.audioEngine.audioContext.currentTime;this._soundSource&&this._streamingSource||this.spatialSound&&(this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z)));this._streaming?(this._streamingSource||(this._streamingSource=b.Engine.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){y4tt.q9();d._onended();},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement.play()):(this._soundSource=b.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=function(){y4tt.v9();d._onended();},this._soundSource.start(f,this.isPaused?this._startOffset%this._soundSource.buffer.duration:0));this._startTime=f;this.isPlaying=!0;this.isPaused=!1;}catch(e){b.Tools.Error("Error while trying to play audio: "+this.name+", "+e.message);}},e.prototype._onended=function(){y4tt.v9();this.isPlaying=!1;this.onended&&this.onended();},e.prototype.stop=function(c){y4tt.q9();this.isPlaying&&(this._streaming?(this._htmlAudioElement.pause(),0<this._htmlAudioElement.currentTime&&(this._htmlAudioElement.currentTime=0)):(this._soundSource.stop(c?b.Engine.audioEngine.audioContext.currentTime+c:b.Engine.audioEngine.audioContext.currentTime),this._soundSource.onended=null,this.isPaused||(this._startOffset=0)),this.isPlaying=!1);},e.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement.pause():(this.stop(0),this._startOffset+=b.Engine.audioEngine.audioContext.currentTime-this._startTime));},e.prototype.setVolume=function(c,d){b.Engine.audioEngine.canUseWebAudio&&(d?(this._soundGain.gain.cancelScheduledValues(b.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,b.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(c,b.Engine.audioEngine.audioContext.currentTime+d)):this._soundGain.gain.value=c);this._volume=c;},e.prototype.setPlaybackRate=function(b){this._playbackRate=b;y4tt.q9();this.isPlaying&&(this._streaming?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource.playbackRate.value=this._playbackRate);},e.prototype.getVolume=function(){y4tt.q9();return this._volume;},e.prototype.attachToMesh=function(b){var d;d=this;this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null);this._connectedMesh=b;this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play()));this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh);this._registerFunc=function(b){y4tt.v9();return d._onRegisterAfterWorldMatrixUpdate(b);};b.registerAfterWorldMatrixUpdate(this._registerFunc);},e.prototype.detachFromMesh=function(){y4tt.q9();this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedMesh=null);},e.prototype._onRegisterAfterWorldMatrixUpdate=function(c){this.setPosition(c.getBoundingInfo().boundingSphere.centerWorld);b.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection();},e.prototype.clone=function(){var b,d,f,g;b=this;if(this._streaming)return null;d=function(){b._isReadyToPlay?(g._audioBuffer=b.getAudioBuffer(),g._isReadyToPlay=!0,g.autoplay&&g.play()):window.setTimeout(d,300);},f={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},g=new e(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,f);return this.useCustomAttenuation&&g.setAttenuationFunction(this._customAttenuationFunction),g.setPosition(this._position),g.setPlaybackRate(this._playbackRate),d(),g;},e.prototype.getAudioBuffer=function(){y4tt.q9();return this._audioBuffer;},e.Parse=function(c,d,f,g){var j,l,n,m;j=c.name;f=c.url?f+c.url:f+j;n={autoplay:c.autoplay,loop:c.loop,volume:c.volume,spatialSound:c.spatialSound,maxDistance:c.maxDistance,rolloffFactor:c.rolloffFactor,refDistance:c.refDistance,distanceModel:c.distanceModel,playbackRate:c.playbackRate};if(g){m=function(){y4tt.v9();g._isReadyToPlay?(l._audioBuffer=g.getAudioBuffer(),l._isReadyToPlay=!0,l.autoplay&&l.play()):window.setTimeout(m,300);};l=new e(j,new ArrayBuffer(0),d,null,n);m();}else l=new e(j,f,d,function(){y4tt.q9();d._removePendingData(l);},n),d._addPendingData(l);c.position&&(j=b.Vector3.FromArray(c.position),l.setPosition(j));if(c.isDirectional&&(l.setDirectionalCone(c.coneInnerAngle||360,c.coneOuterAngle||360,c.coneOuterGain||0),c.localDirectionToMesh))j=b.Vector3.FromArray(c.localDirectionToMesh),l.setLocalDirectionToMesh(j);c.connectedMeshId&&(c=d.getMeshByID(c.connectedMeshId))&&l.attachToMesh(c);return l;},e);b.Sound=g;}(BABYLON||(BABYLON={}));!function(b){var g;y4tt.q9();g=function(b,c){this.id=-1;this._isInitialized=this._isMainTrack=!1;this._scene=b;this.soundCollection=[];this._options=c;y4tt.v9();this._isMainTrack||(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1);};g=(g.prototype._initializeSoundTrackAudioGraph=function(){b.Engine.audioEngine.canUseWebAudio&&(this._outputAudioNode=b.Engine.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(b.Engine.audioEngine.masterGain),this._options&&(this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._options.mainTrack&&(this._isMainTrack=this._options.mainTrack)),this._isInitialized=!0);},g.prototype.dispose=function(){y4tt.q9();if(b.Engine.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect();this._outputAudioNode=null;}},g.prototype.AddSound=function(e){this._isInitialized||this._initializeSoundTrackAudioGraph();b.Engine.audioEngine.canUseWebAudio&&e.connectToSoundTrackAudioNode(this._outputAudioNode);e.soundTrackId&&(-1===e.soundTrackId?this._scene.mainSoundTrack.RemoveSound(e):this._scene.soundTracks[e.soundTrackId].RemoveSound(e));this.soundCollection.push(e);e.soundTrackId=this.id;},g.prototype.RemoveSound=function(b){b=this.soundCollection.indexOf(b);-1!==b&&this.soundCollection.splice(b,1);},g.prototype.setVolume=function(e){b.Engine.audioEngine.canUseWebAudio&&(this._outputAudioNode.gain.value=e);},g.prototype.switchPanningModelToHRTF=function(){y4tt.q9();if(b.Engine.audioEngine.canUseWebAudio)for(var e=0;e<this.soundCollection.length;e++)this.soundCollection[e].switchPanningModelToHRTF();},g.prototype.switchPanningModelToEqualPower=function(){if(b.Engine.audioEngine.canUseWebAudio)for(var e=0;e<this.soundCollection.length;e++)this.soundCollection[e].switchPanningModelToEqualPower();},g.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this._connectedAnalyser=e;b.Engine.audioEngine.canUseWebAudio&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,b.Engine.audioEngine.masterGain));},g);b.SoundTrack=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j,l,n;e=function(){};g=(e.TransformCoordinatesToRefSIMD=function(b,c,d){var f,e,l;b=SIMD.float32x4.loadXYZ(b._data,0);f=SIMD.float32x4.load(c.m,0),e=SIMD.float32x4.load(c.m,4),l=SIMD.float32x4.load(c.m,8);c=SIMD.float32x4.load(c.m,12);c=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,0,0,0,0),f),SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,1,1,1,1),e)),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,2,2,2,2),l),c));c=SIMD.float32x4.div(c,SIMD.float32x4.swizzle(c,3,3,3,3));SIMD.float32x4.storeXYZ(d._data,0,c);},e.TransformCoordinatesFromFloatsToRefSIMD=function(b,c,d,f,e){var l,j,g;b=SIMD.float32x4.splat(b);c=SIMD.float32x4.splat(c);d=SIMD.float32x4.splat(d);l=SIMD.float32x4.load(f.m,0),j=SIMD.float32x4.load(f.m,4),g=SIMD.float32x4.load(f.m,8);f=SIMD.float32x4.load(f.m,12);f=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(b,l),SIMD.float32x4.mul(c,j)),SIMD.float32x4.add(SIMD.float32x4.mul(d,g),f));f=SIMD.float32x4.div(f,SIMD.float32x4.swizzle(f,3,3,3,3));SIMD.float32x4.storeXYZ(e._data,0,f);},e);b.SIMDVector3=g;e=function(){};c=(e.prototype.multiplyToArraySIMD=function(b,c,d){var f,e,l,j,g;void 0===d&&(d=0);f=this.m,e=b.m;b=SIMD.float32x4.load(e,0);l=SIMD.float32x4.load(e,4),j=SIMD.float32x4.load(e,8),e=SIMD.float32x4.load(e,12),g=SIMD.float32x4.load(f,0);SIMD.float32x4.store(c,d+0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,0,0,0,0),b),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,1,1,1,1),l),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,2,2,2,2),j),SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,3,3,3,3),e)))));g=SIMD.float32x4.load(f,4);SIMD.float32x4.store(c,d+4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,0,0,0,0),b),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,1,1,1,1),l),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,2,2,2,2),j),SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,3,3,3,3),e)))));g=SIMD.float32x4.load(f,8);SIMD.float32x4.store(c,d+8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,0,0,0,0),b),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,1,1,1,1),l),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,2,2,2,2),j),SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,3,3,3,3),e)))));f=SIMD.float32x4.load(f,12);SIMD.float32x4.store(c,d+12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,0,0,0,0),b),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,1,1,1,1),l),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,2,2,2,2),j),SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,3,3,3,3),e)))));},e.prototype.invertToRefSIMD=function(b){var c,d,f,e,l,j,g,n,q,A,C,G,D,H;C=this.m;b=b.m;y4tt.q9();G=SIMD.float32x4.load(C,0),D=SIMD.float32x4.load(C,4),H=SIMD.float32x4.load(C,8),C=SIMD.float32x4.load(C,12);return l=SIMD.float32x4.shuffle(G,D,0,1,4,5),d=SIMD.float32x4.shuffle(H,C,0,1,4,5),c=SIMD.float32x4.shuffle(l,d,0,2,4,6),d=SIMD.float32x4.shuffle(d,l,1,3,5,7),l=SIMD.float32x4.shuffle(G,D,2,3,6,7),e=SIMD.float32x4.shuffle(H,C,2,3,6,7),f=SIMD.float32x4.shuffle(l,e,0,2,4,6),e=SIMD.float32x4.shuffle(e,l,1,3,5,7),l=SIMD.float32x4.mul(f,e),l=SIMD.float32x4.swizzle(l,1,0,3,2),j=SIMD.float32x4.mul(d,l),g=SIMD.float32x4.mul(c,l),l=SIMD.float32x4.swizzle(l,2,3,0,1),j=SIMD.float32x4.sub(SIMD.float32x4.mul(d,l),j),g=SIMD.float32x4.sub(SIMD.float32x4.mul(c,l),g),g=SIMD.float32x4.swizzle(g,2,3,0,1),l=SIMD.float32x4.mul(d,f),l=SIMD.float32x4.swizzle(l,1,0,3,2),j=SIMD.float32x4.add(SIMD.float32x4.mul(e,l),j),q=SIMD.float32x4.mul(c,l),l=SIMD.float32x4.swizzle(l,2,3,0,1),j=SIMD.float32x4.sub(j,SIMD.float32x4.mul(e,l)),q=SIMD.float32x4.sub(SIMD.float32x4.mul(c,l),q),q=SIMD.float32x4.swizzle(q,2,3,0,1),l=SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,2,3,0,1),e),l=SIMD.float32x4.swizzle(l,1,0,3,2),f=SIMD.float32x4.swizzle(f,2,3,0,1),j=SIMD.float32x4.add(SIMD.float32x4.mul(f,l),j),n=SIMD.float32x4.mul(c,l),l=SIMD.float32x4.swizzle(l,2,3,0,1),j=SIMD.float32x4.sub(j,SIMD.float32x4.mul(f,l)),n=SIMD.float32x4.sub(SIMD.float32x4.mul(c,l),n),n=SIMD.float32x4.swizzle(n,2,3,0,1),l=SIMD.float32x4.mul(c,d),l=SIMD.float32x4.swizzle(l,1,0,3,2),n=SIMD.float32x4.add(SIMD.float32x4.mul(e,l),n),q=SIMD.float32x4.sub(SIMD.float32x4.mul(f,l),q),l=SIMD.float32x4.swizzle(l,2,3,0,1),n=SIMD.float32x4.sub(SIMD.float32x4.mul(e,l),n),q=SIMD.float32x4.sub(q,SIMD.float32x4.mul(f,l)),l=SIMD.float32x4.mul(c,e),l=SIMD.float32x4.swizzle(l,1,0,3,2),g=SIMD.float32x4.sub(g,SIMD.float32x4.mul(f,l)),n=SIMD.float32x4.add(SIMD.float32x4.mul(d,l),n),l=SIMD.float32x4.swizzle(l,2,3,0,1),g=SIMD.float32x4.add(SIMD.float32x4.mul(f,l),g),n=SIMD.float32x4.sub(n,SIMD.float32x4.mul(d,l)),l=SIMD.float32x4.mul(c,f),l=SIMD.float32x4.swizzle(l,1,0,3,2),g=SIMD.float32x4.add(SIMD.float32x4.mul(e,l),g),q=SIMD.float32x4.sub(q,SIMD.float32x4.mul(d,l)),l=SIMD.float32x4.swizzle(l,2,3,0,1),g=SIMD.float32x4.sub(g,SIMD.float32x4.mul(e,l)),q=SIMD.float32x4.add(SIMD.float32x4.mul(d,l),q),A=SIMD.float32x4.mul(c,j),A=SIMD.float32x4.add(SIMD.float32x4.swizzle(A,2,3,0,1),A),A=SIMD.float32x4.add(SIMD.float32x4.swizzle(A,1,0,3,2),A),l=SIMD.float32x4.reciprocalApproximation(A),A=SIMD.float32x4.sub(SIMD.float32x4.add(l,l),SIMD.float32x4.mul(A,SIMD.float32x4.mul(l,l))),A=SIMD.float32x4.swizzle(A,0,0,0,0),j=SIMD.float32x4.mul(A,j),g=SIMD.float32x4.mul(A,g),n=SIMD.float32x4.mul(A,n),q=SIMD.float32x4.mul(A,q),SIMD.float32x4.store(b,0,j),SIMD.float32x4.store(b,4,g),SIMD.float32x4.store(b,8,n),SIMD.float32x4.store(b,12,q),this;},e.LookAtLHToRefSIMD=function(b,c,d,f){var e,l,j,g,n,q;f=f.m;c=SIMD.float32x4(c.x,c.y,c.z,0);b=SIMD.float32x4(b.x,b.y,b.z,0);e=SIMD.float32x4(d.x,d.y,d.z,0),l=SIMD.float32x4.sub(c,b);d=SIMD.float32x4.mul(l,l);d=SIMD.float32x4.add(d,SIMD.float32x4.add(SIMD.float32x4.swizzle(d,1,2,0,3),SIMD.float32x4.swizzle(d,2,0,1,3)));l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(d));d=SIMD.float32x4.mul(e,e);d=SIMD.float32x4.add(d,SIMD.float32x4.add(SIMD.float32x4.swizzle(d,1,2,0,3),SIMD.float32x4.swizzle(d,2,0,1,3)));e=SIMD.float32x4.mul(e,SIMD.float32x4.reciprocalSqrtApproximation(d));e=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(e,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(e,1,2,0,3)));d=SIMD.float32x4.mul(e,e);d=SIMD.float32x4.add(d,SIMD.float32x4.add(SIMD.float32x4.swizzle(d,1,2,0,3),SIMD.float32x4.swizzle(d,2,0,1,3)));e=SIMD.float32x4.mul(e,SIMD.float32x4.reciprocalSqrtApproximation(d)),j=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(e,1,2,0,3),SIMD.float32x4.swizzle(l,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(e,2,0,1,3),SIMD.float32x4.swizzle(l,1,2,0,3)));d=SIMD.float32x4.mul(e,e);d=SIMD.float32x4.add(d,SIMD.float32x4.add(SIMD.float32x4.swizzle(d,1,2,0,3),SIMD.float32x4.swizzle(d,2,0,1,3)));e=SIMD.float32x4.mul(e,SIMD.float32x4.reciprocalSqrtApproximation(d)),g=SIMD.float32x4.splat(0),e=SIMD.float32x4.neg(e),n=SIMD.float32x4.shuffle(e,j,0,1,4,5),q=SIMD.float32x4.shuffle(l,g,0,1,4,5);d=SIMD.float32x4.shuffle(n,q,0,2,4,6);c=SIMD.float32x4.shuffle(n,q,1,3,5,7);n=SIMD.float32x4.shuffle(e,j,2,3,6,7);q=SIMD.float32x4.shuffle(l,g,2,3,6,7);l=SIMD.float32x4.shuffle(n,q,0,2,4,6);e=SIMD.float32x4(0,0,0,1);j=SIMD.float32x4(1,0,0,0);g=SIMD.float32x4(0,1,0,0);n=SIMD.float32x4(0,0,1,0);b=SIMD.float32x4.neg(b);b=SIMD.float32x4.withW(b,1);SIMD.float32x4.store(f,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,0,0,0,0),d),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,1,1,1,1),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,2,2,2,2),l),SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,3,3,3,3),e)))));SIMD.float32x4.store(f,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,0,0,0,0),d),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,1,1,1,1),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,2,2,2,2),l),SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,3,3,3,3),e)))));SIMD.float32x4.store(f,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,0,0,0,0),d),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,1,1,1,1),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,2,2,2,2),l),SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,3,3,3,3),e)))));SIMD.float32x4.store(f,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,0,0,0,0),d),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,1,1,1,1),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,2,2,2,2),l),SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,3,3,3,3),e)))));},e);b.SIMDMatrix=c;d=b.Matrix.prototype.multiplyToArray,f=b.Matrix.prototype.invertToRef,q=b.Matrix.LookAtLHToRef,j=b.Vector3.TransformCoordinatesToRef,l=b.Vector3.TransformCoordinatesFromFloatsToRef,n=function(){},e=(Object.defineProperty(n,"IsEnabled",{get:function(){return n._isEnabled;},enumerable:!0,configurable:!0}),n.DisableSIMD=function(){b.Matrix.prototype.multiplyToArray=d;b.Matrix.prototype.invertToRef=f;b.Matrix.LookAtLHToRef=q;b.Vector3.TransformCoordinatesToRef=j;b.Vector3.TransformCoordinatesFromFloatsToRef=l;n._isEnabled=!1;},n.EnableSIMD=function(){y4tt.q9();void 0!==window.SIMD&&(b.Matrix.prototype.multiplyToArray=c.prototype.multiplyToArraySIMD,b.Matrix.prototype.invertToRef=c.prototype.invertToRefSIMD,b.Matrix.LookAtLHToRef=c.LookAtLHToRefSIMD,b.Vector3.TransformCoordinatesToRef=g.TransformCoordinatesToRefSIMD,b.Vector3.TransformCoordinatesFromFloatsToRef=g.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(b.Vector3.prototype,"x",{get:function(){y4tt.q9();return this._data[0];},set:function(b){this._data||(this._data=new Float32Array(3));this._data[0]=b;}}),Object.defineProperty(b.Vector3.prototype,"y",{get:function(){y4tt.q9();return this._data[1];},set:function(b){this._data[1]=b;}}),Object.defineProperty(b.Vector3.prototype,"z",{get:function(){y4tt.v9();return this._data[2];},set:function(b){y4tt.q9();this._data[2]=b;}}),n._isEnabled=!0);},n._isEnabled=!1,n);b.SIMDHelper=e;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=function(b,c,e,j){this._pos=e;this._size=j;this._root=b;this._parent=c;};g=(Object.defineProperty(e.prototype,"pos",{get:function(){y4tt.v9();return this._pos;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentSize",{get:function(){y4tt.v9();return this._contentSize;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"UVs",{get:function(){var c,f,e;y4tt.v9();c=this._root._size.width,f=this._root._size.height,e=new b.Vector2(this._pos.x/c,this._pos.y/f),c=new b.Vector2((this._pos.x+this._contentSize.width-1)/c,(this._pos.y+this._contentSize.height-1)/f),f=[];return f.push(e),f.push(new b.Vector2(c.x,e.y)),f.push(c),f.push(new b.Vector2(e.x,c.y)),f;},enumerable:!0,configurable:!0}),e.prototype.freeContent=function(){y4tt.q9();this.contentSize&&(this._contentSize=null,this.attemptDefrag());},Object.defineProperty(e.prototype,"isUsed",{get:function(){y4tt.q9();return null!=this._contentSize||null!=this._leftNode;},enumerable:!0,configurable:!0}),e.prototype.findAndSplitNode=function(b){var c;c=this.findNode(b);return c?(c.splitNode(b),c):null;},e.prototype.findNode=function(b){var c;c=null;y4tt.v9();return this.isUsed?(this._leftNode&&(c=this._leftNode.findNode(b)),!c&&this._rightNode&&(c=this._rightNode.findNode(b)),!c&&this._bottomNode&&(c=this._bottomNode.findNode(b))):this._initialSize&&b.width<=this._initialSize.width&&b.height<=this._initialSize.height?c=this:b.width<=this._size.width&&b.height<=this._size.height&&(c=this),c;},e.prototype.splitNode=function(c){y4tt.q9();return!this._contentSize&&this._initialSize?(this._leftNode=new e(this._root,this,new b.Vector2(this._pos.x,this._pos.y),new b.Size(this._initialSize.width,this._initialSize.height)),this._leftNode.splitNode(c)):(this._contentSize=c.clone(),this._initialSize=c.clone(),c.width!==this._size.width&&(this._rightNode=new e(this._root,this,new b.Vector2(this._pos.x+c.width,this._pos.y),new b.Size(this._size.width-c.width,c.height))),c.height!==this._size.height&&(this._bottomNode=new e(this._root,this,new b.Vector2(this._pos.x,this._pos.y+c.height),new b.Size(this._size.width,this._size.height-c.height))),this);},e.prototype.attemptDefrag=function(){!this.isUsed&&this.isRecursiveFree&&(this.clearNode(),this._parent&&this._parent.attemptDefrag());},e.prototype.clearNode=function(){this._bottomNode=this._rightNode=this._initialSize=null;},Object.defineProperty(e.prototype,"isRecursiveFree",{get:function(){y4tt.v9();return!this.contentSize&&(!this._leftNode||this._leftNode.isRecursiveFree)&&(!this._rightNode||this._rightNode.isRecursiveFree)&&(!this._bottomNode||this._bottomNode.isRecursiveFree);},enumerable:!0,configurable:!0}),e.prototype.evalFreeSize=function(b){var c;c=0;return this.isUsed||(c=this._initialSize?this._initialSize.surface:this._size.surface),this._rightNode&&(c+=this._rightNode.evalFreeSize(0)),this._bottomNode&&(c+=this._bottomNode.evalFreeSize(0)),c+b;},e);b.PackedRect=g;c=function(c){g.call(this,null,null,b.Vector2.Zero(),c);this._root=this;};c=(__extends(c,g),c.prototype.addRect=function(b){return this.findAndSplitNode(b);},Object.defineProperty(c.prototype,"freeSpace",{get:function(){var b;b=0;y4tt.v9();return b=this.evalFreeSize(b),b/(this._size.width*this._size.height);},enumerable:!0,configurable:!0}),c);b.RectPackingMap=c;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;y4tt.v9();g=function(){};b.DynamicFloatArrayElementInfo=g;e=function(b,c){var j;this.compareValueOffset=null;y4tt.q9();this.sortingAscending=!0;this._stride=b;this.buffer=new Float32Array(b*c);this._firstFree=this._lastUsed=0;this._allEntries=Array(c);this._freeEntries=Array(c);for(var e=0;c>e;e++){j=new g();j.offset=e*b;this._allEntries[e]=j;this._freeEntries[c-e-1]=j;}};e=(e.prototype.allocElement=function(){var b;y4tt.q9();0===this._freeEntries.length&&this._growBuffer();b=this._freeEntries.pop();return this._lastUsed=Math.max(b.offset,this._lastUsed),b.offset===this._firstFree&&(0<this._freeEntries.length?this._firstFree=this._freeEntries[this._freeEntries.length-1].offset:this._firstFree+=this._stride),b;},e.prototype.freeElement=function(b){this._firstFree=Math.min(b.offset,this._firstFree);this._freeEntries.push(b);},e.prototype.pack=function(){var b,c,r,m,y,x,z,B;if(0===this._freeEntries.length)return this.buffer;if(this._lastUsed<this._firstFree)return this.buffer.subarray(0,this._lastUsed+this._stride);b=this._stride,c=new g();c.offset=this.totalElementCount*b;this._freeEntries.push(c);for(var c=this._freeEntries.sort(function(b,c){return b.offset-c.offset;}),e=this._allEntries.sort(function(b,c){return b.offset-c.offset;}),j=c[0].offset,l=1,n=(this.usedElementCount+1)*b,m=c[0].offset,p=1;p<c.length&&!(j>=n);p++){r=c[p].offset,m=r-m;if(m!==b){for(var m=m/b-1,s=r-b,t=Math.min(l,m),v=0;t>v;v++){y=j/b,x=s/b,z=e[x];this._moveElement(z,j);B=e[y];B.offset=s;e[y]=z;e[x]=B;s-=b;j+=b;}m>=l?(j=s+b,l=1+t):l=(r-j)/b+1;}else++l;m=r;}l=this.buffer.subarray(0,j);return this._lastUsed=j-b,this._firstFree=j,c.pop(),this._freeEntries=c.sort(function(b,c){return c.offset-b.offset;}),this._allEntries=e,l;},e.prototype._moveElement=function(b,c){for(var e=0;e<this._stride;e++)this.buffer[c+e]=this.buffer[b.offset+e];b.offset=c;},e.prototype._growBuffer=function(){var b,c,l;b=Math.floor(1.5*this.totalElementCount),c=new Float32Array(b*this._stride);c.set(this.buffer);for(var e=this.totalElementCount,b=b-this.totalElementCount,j=0;b>j;j++){l=new g();l.offset=(e+j)*this.stride;this._allEntries.push(l);this._freeEntries[b-j-1]=l;}this._firstFree=e*this.stride;this.buffer=c;},Object.defineProperty(e.prototype,"totalElementCount",{get:function(){return this._allEntries.length;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"freeElementCount",{get:function(){y4tt.q9();return this._freeEntries.length;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usedElementCount",{get:function(){return this._allEntries.length-this._freeEntries.length;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stride",{get:function(){return this._stride;},enumerable:!0,configurable:!0}),e.prototype.sort=function(){var b,f,l,e,g,r;if(!this.compareValueOffset)throw Error("The DynamicFloatArray.sort() method needs a valid 'compareValueOffset' property");b=this.usedElementCount;if(!this._sortTable||this._sortTable.length<b){f=Math.min(this.totalElementCount,2*b);this._sortTable=Array(f);this._sortedTable=Array(f);}this.pack();for(var e=0,f=this.stride,j=0;b>j;j++,e+=f){l=this._sortTable[j];l||(l=new c(),this._sortTable[j]=l);l.compareData=this.buffer[e+this.compareValueOffset];l.offset=e;l.swapedOffset=null;this._sortedTable[j]=l;}this.sortingAscending?this._sortedTable.sort(function(b,c){y4tt.q9();return b.compareData-c.compareData;}):this._sortedTable.sort(function(b,c){y4tt.q9();return c.compareData-b.compareData;});for(j=0;b>j;j++){e=this._sortedTable[j],l=this._sortTable[j],g=e.offset;if(e.swapedOffset){for(g=e;g.swapedOffset;)g=this._sortTable[g.swapedOffset/f];g=g.offset;}l.swapedOffset=g;if(g!==l.offset)for(var m=l.offset,p=0;f>p;p++){r=this.buffer[m+p];this.buffer[m+p]=this.buffer[g+p];this.buffer[g+p]=r;}this._allEntries[e.offset/f].offset=l.offset;}return this._allEntries.sort(function(b,c){return b.offset-c.offset;}),!0;},e);b.DynamicFloatArray=e;c=function(){this.compareData=this.offset=this.swapedOffset=null;};}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d;g=function(){};b.CharInfo=g;c=b.Texture,d=function(d,e,j,l,g){void 0===l&&(l=200);void 0===g&&(g=b.Texture.TRILINEAR_SAMPLINGMODE);c.call(this,null,j,!0,!1,g);this._charInfos={};this._curCharCount=0;this._lastUpdateCharCount=-1;this._usedCounter=1;this.name=d;this.wrapV=this.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._canvas=document.createElement("canvas");this._context=this._canvas.getContext("2d");this._context.font=e;this._context.fillStyle="white";d=this.getFontHeight(e);this._lineHeight=d.height;this._offset=d.offset-1;d=this._context.measureText("W").width;this._spaceWidth=this._context.measureText(" ").width;l=Math.sqrt(this._lineHeight*d*l);l=Math.pow(2,Math.ceil(Math.log(l)/Math.log(2)));this._texture=j.getEngine().createDynamicTexture(l,l,!1,g);j=this.getSize();this._canvas=document.createElement("canvas");this._canvas.width=j.width;this._canvas.height=j.height;this._context=this._canvas.getContext("2d");this._context.textBaseline="top";this._context.font=e;this._context.fillStyle="white";this._context.imageSmoothingEnabled=!1;this._currentFreePosition=b.Vector2.Zero();for(e=32;127>e;e++)j=String.fromCharCode(e),this.getChar(j);this.update();};e=(__extends(d,c),Object.defineProperty(d.prototype,"spaceWidth",{get:function(){y4tt.v9();return this._spaceWidth;},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"lineHeight",{get:function(){y4tt.q9();return this._lineHeight;},enumerable:!0,configurable:!0}),d.GetCachedFontTexture=function(c,e){var j,l,g;c.__fontTextureCache__||(c.__fontTextureCache__=new b.StringDictionary());j=c.__fontTextureCache__,l=e.toLocaleLowerCase(),g=j.get(l);return g?(++g._usedCounter,g):(g=new d(null,l,c,200,b.Texture.NEAREST_SAMPLINGMODE),j.add(l,g),g);},d.ReleaseCachedFontTexture=function(b,c){var d,e,g;d=b.__fontTextureCache__;if(d){e=c.toLocaleLowerCase(),g=d.get(e);0===--g._usedCounter&&(d.remove(e),g.dispose());}},d.prototype.getChar=function(c){var d,e,l;if(1!==c.length)return null;d=this._charInfos[c];if(d)return d;d=new g(),e=this._context.measureText(c),l=this.getSize(),e=e.width;return this._currentFreePosition.x+e+2>l.width&&(this._currentFreePosition.x=0,this._currentFreePosition.y+=this._lineHeight+2,this._currentFreePosition.y>l.height)?this.getChar("!"):(this._context.fillText(c,this._currentFreePosition.x-0.5,this._currentFreePosition.y-this._offset-0.5),d.topLeftUV=new b.Vector2(this._currentFreePosition.x/l.width,this._currentFreePosition.y/l.height),d.bottomRightUV=new b.Vector2(d.topLeftUV.x+e/l.width,d.topLeftUV.y+(this._lineHeight+2)/l.height),d.charWidth=e,this._charInfos[c]=d,this._curCharCount++,this._currentFreePosition.x+=e+2,d);},d.prototype.measureText=function(c,d){var r;y4tt.q9();void 0===d&&(d=4);for(var e=0,l=0,g=1,m=0,p=0;p<c.length;p++){r=c[p];"\n"!==r?"\t"!==r?" ">r||(l+=this.getChar(r).charWidth,++m):(r=m+d,r-=r%d,l+=(r-m)*this.spaceWidth,m=r):(e=Math.max(e,l),l=m=0,++g);}return e=Math.max(e,l),new b.Size(e,g*this._lineHeight);},d.prototype.getFontHeight=function(b){var c,d;c=document.createElement("canvas"),d=c.getContext("2d");d.fillRect(0,0,c.width,c.height);d.textBaseline="top";d.fillStyle="white";d.font=b;d.fillText("jH|",0,0);b=d.getImageData(0,0,c.width,c.height).data;for(var e=d=-1,g=0;g<c.height;g++)for(var m=0;m<c.width;m++){if(0!==b[4*(g*c.width+m)]){-1===d&&(d=g);break;}if(m===c.width-1&&-1!==d){e=g;g=c.height;break;}}return{height:e-d,offset:d-1};},Object.defineProperty(d.prototype,"canRescale",{get:function(){y4tt.v9();return!1;},enumerable:!0,configurable:!0}),d.prototype.getContext=function(){return this._context;},d.prototype.update=function(){this._lastUpdateCharCount<this._curCharCount&&(this.getScene().getEngine().updateDynamicTexture(this._texture,this._canvas,!1,!0),this._lastUpdateCharCount=this._curCharCount);},d.prototype.clone=function(){y4tt.v9();return null;},d);b.FontTexture=e;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.Texture;g=function(c,d,f,g){void 0===g&&(g=b.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,d,!0,!1,g);this.name=c;this._size=f;this.wrapV=this.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._rectPackingMap=new b.RectPackingMap(new b.Size(f.width,f.height));this._texture=d.getEngine().createRenderTargetTexture(f,{generateMipMaps:!this.noMipmap,type:b.Engine.TEXTURETYPE_UNSIGNED_INT});};g=(__extends(g,e),g.prototype.allocateRect=function(b){return this._rectPackingMap.addRect(b);},g.prototype.freeRect=function(b){y4tt.v9();b&&b.freeContent();},Object.defineProperty(g.prototype,"freeSpace",{get:function(){y4tt.v9();return this._rectPackingMap.freeSpace;},enumerable:!0,configurable:!0}),g.prototype.bindTextureForRect=function(b,d){return this.bindTextureForPosSize(b.pos,b.contentSize,d);},g.prototype.bindTextureForPosSize=function(c,d,f){var e;e=this.getScene().getEngine();e.bindFramebuffer(this._texture);this._replacedViewport=e.setDirectViewport(c.x,c.y,d.width,d.height);y4tt.q9();f&&e.scissorClear(c.x,c.y,d.width,d.height,new b.Color4(0,0,0,0));},g.prototype.unbindTexture=function(c){c&&b.Tools.DumpFramebuffer(this._size.width,this._size.height,this.getScene().getEngine());c=this.getScene().getEngine();this._replacedViewport&&(c.setViewport(this._replacedViewport),this._replacedViewport=null);c.unBindFramebuffer(this._texture);},Object.defineProperty(g.prototype,"canRescale",{get:function(){y4tt.q9();return!1;},enumerable:!0,configurable:!0}),g.prototype.clone=function(){return null;},g);b.MapTexture=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(){this.radius=0;this.center=b.Vector2.Zero();y4tt.q9();this.extent=b.Vector2.Zero();};g=(e.CreateFromSize=function(b){var d;d=new e();return e.CreateFromSizeToRef(b,d),d;},e.CreateFromRadius=function(b){var d;y4tt.v9();d=new e();return e.CreateFromRadiusToRef(b,d),d;},e.CreateFromPoints=function(b){var d;y4tt.q9();d=new e();return e.CreateFromPointsToRef(b,d),d;},e.CreateFromSizeToRef=function(c,d){c||(c=b.Size.Zero());d.center.x=+c.width/2;d.center.y=+c.height/2;d.extent.x=d.center.x;d.extent.y=d.center.y;d.radius=d.extent.length();},e.CreateFromRadiusToRef=function(b,d){var f;d.center.x=d.center.y=0;f=+b;d.extent.x=f;d.extent.y=f;d.radius=f;},e.CreateFromPointsToRef=function(b,d){for(var f=Number.MAX_VALUE,g=Number.MAX_VALUE,j=Number.MIN_VALUE,l=Number.MIN_VALUE,n=0;n<b.length;n++)var m=b[n],f=Math.min(m.x,f),j=Math.max(m.x,j),g=Math.min(m.y,g),l=Math.max(m.y,l);e.CreateFromMinMaxToRef(f,j,g,l,d);},e.CreateFromMinMaxToRef=function(c,d,f,e,j){j.center=new b.Vector2(c+(d-c)/2,f+(e-f)/2);y4tt.v9();j.extent=new b.Vector2(d-j.center.x,e-j.center.y);j.radius=j.extent.length();},e.prototype.clone=function(){var b;b=new e();return b.center=this.center.clone(),b.radius=this.radius,b.extent=this.extent.clone(),b;},e.prototype.max=function(){var c;c=b.Vector2.Zero();y4tt.q9();return this.maxToRef(c),c;},e.prototype.maxToRef=function(b){b.x=this.center.x+this.extent.x;b.y=this.center.y+this.extent.y;},e.prototype.transform=function(b){var d;d=new e();return this.transformToRef(b,d),d;},e.prototype.union=function(b){var d;y4tt.v9();d=new e();return this.unionToRef(b,d),d;},e.prototype.transformToRef=function(c,d){var f;f=e._transform;f[0].x=this.center.x+this.extent.x;f[0].y=this.center.y+this.extent.y;y4tt.q9();f[1].x=this.center.x+this.extent.x;f[1].y=this.center.y-this.extent.y;f[2].x=this.center.x-this.extent.x;f[2].y=this.center.y-this.extent.y;f[3].x=this.center.x-this.extent.x;f[3].y=this.center.y+this.extent.y;for(var g=0;4>g;g++)b.Vector2.TransformToRef(f[g],c,f[g]);e.CreateFromPointsToRef(f,d);},e.prototype.unionToRef=function(b,d){var f,g,j,l;f=Math.max(this.center.x+this.extent.x,b.center.x+b.extent.x),g=Math.max(this.center.y+this.extent.y,b.center.y+b.extent.y),j=Math.min(this.center.x-this.extent.x,b.center.x-b.extent.x),l=Math.min(this.center.y-this.extent.y,b.center.y-b.extent.y);e.CreateFromMinMaxToRef(j,f,l,g,d);},e.prototype.doesIntersect=function(b){b=b.subtract(this.center);return b.lengthSquared()<=this.radius*this.radius?Math.abs(b.x)<=this.extent.x&&Math.abs(b.y)<=this.extent.y:!1;},e._transform=[b.Vector2.Zero(),b.Vector2.Zero(),b.Vector2.Zero(),b.Vector2.Zero()],e);b.BoundingInfo2D=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=function(){};g=(e.prototype.isLocked=function(){return this._isLocked;},e.prototype.lock=function(){return this._isLocked?!0:(this.onLock(),this._isLocked=!0,!1);},e.prototype.onLock=function(){},e);b.LockableBase=g;c=function(b,c){void 0===c&&(c=!1);g.call(this);this._color=b;c&&this.lock();},e=(__extends(c,g),c.prototype.isTransparent=function(){y4tt.v9();return this._color&&1>this._color.a;},Object.defineProperty(c.prototype,"color",{get:function(){y4tt.v9();return this._color;},set:function(b){y4tt.q9();this.isLocked()||(this._color=b);},enumerable:!0,configurable:!0}),c.prototype.toString=function(){return this._color.toHexString();},c=__decorate([b.className("SolidColorBrush2D")],c));b.SolidColorBrush2D=e;c=function(c,f,e,j,l,n){void 0===e&&(e=b.Vector2.Zero());void 0===j&&(j=0);void 0===l&&(l=1);void 0===n&&(n=!1);g.call(this);this._color1=c;this._color2=f;y4tt.q9();this._translation=e;this._rotation=j;this._scale=l;n&&this.lock();};e=(__extends(c,g),c.prototype.isTransparent=function(){return this._color1&&1>this._color1.a||this._color2&&1>this._color2.a;},Object.defineProperty(c.prototype,"color1",{get:function(){return this._color1;},set:function(b){this.isLocked()||(this._color1=b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"color2",{get:function(){return this._color2;},set:function(b){y4tt.q9();this.isLocked()||(this._color2=b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"translation",{get:function(){y4tt.v9();return this._translation;},set:function(b){this.isLocked()||(this._translation=b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotation",{get:function(){return this._rotation;},set:function(b){this.isLocked()||(this._rotation=b);},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scale",{get:function(){return this._scale;},set:function(b){y4tt.v9();this.isLocked()||(this._scale=b);},enumerable:!0,configurable:!0}),c.prototype.toString=function(){y4tt.q9();return"C1:"+this._color1+";C2:"+this._color2+";T:"+this._translation.toString()+";R:"+this._rotation+";S:"+this._scale+";";},c.BuildKey=function(b,c,e,j,l){y4tt.q9();return"C1:"+b+";C2:"+c+";T:"+e.toString()+";R:"+j+";S:"+l+";";},c=__decorate([b.className("GradientColorBrush2D")],c));b.GradientColorBrush2D=e;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j;g=function(){};b.Prim2DClassInfo=g;c=function(){};e=(c.PROPKIND_MODEL=1,c.PROPKIND_INSTANCE=2,c.PROPKIND_DYNAMIC=3,c);b.Prim2DPropInfo=e;c=function(){};b.PropertyChangedInfo=c;f=function(c,d,e){this._baseClass=c;this._type=d;this._subClasses=[];this._levelContent=new b.StringDictionary();y4tt.q9();this._classContentFactory=e;};d=(Object.defineProperty(f.prototype,"classContent",{get:function(){y4tt.q9();return this._classContent||(this._classContent=this._classContentFactory(this._baseClass?this._baseClass.classContent:null)),this._classContent;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"type",{get:function(){return this._type;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"levelContent",{get:function(){y4tt.q9();return this._levelContent;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"fullContent",{get:function(){if(!this._fullContent){for(var c=new b.StringDictionary(),d=this;d;)d.levelContent.forEach(function(b,d){return c.add(b,d);}),d=d._baseClass;this._fullContent=c;}return this._fullContent;},enumerable:!0,configurable:!0}),f.prototype.getLevelOf=function(b){var c;if(b===this._type)return this;c=Object.getPrototypeOf(b);return this.getOrAddType(Object.getPrototypeOf(c),c)||this.getLevelOf(c),this.getOrAddType(c,b);},f.prototype.getOrAddType=function(b,c){var j;if(b===this._type){for(var d=0,e=this._subClasses;d<e.length;d++){j=e[d];if(j.type===c)return j.node;}j=new f(this,c,this._classContentFactory);j={type:c,node:j};return this._subClasses.push(j),j.node;}d=0;for(e=this._subClasses;d<e.length;d++)if(j=e[d],j=j.node.getOrAddType(b,c))return j;y4tt.q9();return null;},f.get=function(b){var c;c=b.__classTreeInfo;return c?c.getLevelOf(b):null;},f.getOrRegister=function(b,c){var d;d=b.__classTreeInfo;y4tt.q9();return d||(d=new f(null,b,c),b.__classTreeInfo=d),d;},f);b.ClassTreeInfo=d;j=function(){this._flags=0;this._modelKey=null;this._instanceDirtyFlags=0;this._levelBoundingInfo=new b.BoundingInfo2D();y4tt.v9();this.animations=[];};q=(Object.defineProperty(j.prototype,"isDisposed",{get:function(){return this._isFlagSet(j.flagIsDisposed);},enumerable:!0,configurable:!0}),j.prototype.dispose=function(){y4tt.v9();return this.isDisposed?!1:(this.animations.splice(0),this._setFlags(j.flagIsDisposed),!0);},j.prototype.getAnimatables=function(){y4tt.v9();return[];},Object.defineProperty(j.prototype,"modelKey",{get:function(){var c,d;c=this;if(!this._isFlagSet(j.flagModelDirty)&&this._modelKey)return this._modelKey;d="Class:"+b.Tools.getClassName(this)+";";return this.propDic.forEach(function(f,j){var g;if(j.kind===e.PROPKIND_MODEL){g=c[j.name];g&&g.constructor===Array&&(g=g[0]?b.Tools.hashCodeFromStream(b.Tools.arrayOrStringFeeder(g)):0);d+=j.name+":"+(null!=g?j.typeLevelCompare?b.Tools.getClassName(g):g.toString():"[null]")+";";}}),this._clearFlags(j.flagModelDirty),this._modelKey=d,d;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"isDirty",{get:function(){return 0!==this._instanceDirtyFlags||this._areSomeFlagsSet(j.flagModelDirty|j.flagPositioningDirty|j.flagLayoutDirty);},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"propDic",{get:function(){var b;if(!this._propInfo){b=d.get(Object.getPrototypeOf(this));if(!b)throw Error("Can't access the propDic member in class definition, is this class SmartPropertyPrim based?");this._propInfo=b.fullContent;}return this._propInfo;},enumerable:!0,configurable:!0}),j._createPropInfo=function(b,c,f,j,q,s){var t;y4tt.q9();b=d.getOrRegister(b,function(){return new g();}).getLevelOf(b);t=b.levelContent.get(f.toString());if(t)throw Error("The ID "+f+" is already taken by another property declaration named: "+t.name);return t=new e(),t.id=f,t.flagId=Math.pow(2,f),t.kind=s,t.name=c,t.dirtyBoundingInfo=j,t.typeLevelCompare=q,b.levelContent.add(c,t),t;},j._checkUnchanged=function(b,c){y4tt.q9();if(null===b&&null===c||void 0===b&&void 0===c)return!0;if(null!=b&&null!=c)if("function"==typeof b.equals){if(b.equals(c))return!0;}else if(b===c)return!0;return!1;},j.prototype.markAsDirty=function(b){var c;y4tt.q9();if(!this.isDisposed){c=b.indexOf(".");-1!==c&&(b=b.substr(0,c));(c=this.propDic.get(b))&&this._handlePropChanged(void 0,this[b],b,c,c.typeLevelCompare);}},j.prototype._boundingBoxDirty=function(){y4tt.q9();if(this._setFlags(j.flagLevelBoundingInfoDirty),this instanceof b.Prim2DBase)for(var c=this;c&&(c._boundingSize=null,c._setFlags(j.flagBoundingInfoDirty),c.isSizeAuto&&c.onPrimitivePropertyDirty(b.Prim2DBase.sizeProperty.flagId),!(c instanceof b.Group2D&&c.isRenderableGroup));)c=c.parent;},j.prototype._handlePropChanged=function(c,d,f,g,q){var s;g.dirtyBoundingInfo&&this._boundingBoxDirty();s=j.propChangedInfo;s.oldValue=c;s.newValue=d;s.propertyName=f;f=g.flagId;if(this.propertyChanged.notifyObservers(s,f),this instanceof b.Group2D&&this.handleGroupChanged(g),this instanceof b.Prim2DBase)s=this._parent,null!=s&&s.layoutEngine&&0!==(s.layoutEngine.layoutDirtyOnPropertyChangedMask&g.flagId)&&s._setLayoutDirty();s=!1;q&&(null!=c&&null!=d)&&(s=c.__proto__===d.__proto__);s||g.kind!==e.PROPKIND_MODEL?(s||g.kind===e.PROPKIND_INSTANCE||g.kind===e.PROPKIND_DYNAMIC)&&this.onPrimitivePropertyDirty(f):this.onPrimitivePropertyDirty(j.flagModelDirty);},j.prototype.onPrimitivePropertyDirty=function(b){y4tt.v9();this.isDirty||this.onPrimBecomesDirty();this._instanceDirtyFlags|=b;},j.prototype.handleGroupChanged=function(){},j.prototype.checkPropertiesDirty=function(b){y4tt.q9();return 0!==(this._instanceDirtyFlags&b);},j.prototype.clearPropertiesDirty=function(b){return this._instanceDirtyFlags&=~b,this._instanceDirtyFlags;},j.prototype._resetPropertiesDirty=function(){y4tt.v9();this._instanceDirtyFlags=0;},Object.defineProperty(j.prototype,"levelBoundingInfo",{get:function(){return this._isFlagSet(j.flagLevelBoundingInfoDirty)&&(this.updateLevelBoundingInfo(),this._clearFlags(j.flagLevelBoundingInfoDirty)),this._levelBoundingInfo;},enumerable:!0,configurable:!0}),j.prototype.updateLevelBoundingInfo=function(){},j.prototype.onPrimBecomesDirty=function(){},j._hookProperty=function(b,c,d,f,e){y4tt.v9();return function(g,q,v){var y,x,z;y=j._createPropInfo(g,q,b,f,d,e);c&&c(y);x=v.get,z=v.set;v.set=function(b){var c;if(!this.isDisposed){c=x.call(this);j._checkUnchanged(c,b)||(z.call(this,b),this._handlePropChanged(c,b,q,y,d));}};};},j.prototype.addExternalData=function(c,d){return this._externalData||(this._externalData=new b.StringDictionary()),this._externalData.add(c,d);},j.prototype.getExternalData=function(b){y4tt.q9();return this._externalData?this._externalData.get(b):null;},j.prototype.getOrAddExternalDataWithFactory=function(c,d){return this._externalData||(this._externalData=new b.StringDictionary()),this._externalData.getOrAddWithFactory(c,d);},j.prototype.removeExternalData=function(b){y4tt.v9();return this._externalData?this._externalData.remove(b):!1;},j.prototype._isFlagSet=function(b){return 0!==(this._flags&b);},j.prototype._areAllFlagsSet=function(b){return(this._flags&b)===b;},j.prototype._areSomeFlagsSet=function(b){y4tt.v9();return 0!==(this._flags&b);},j.prototype._clearFlags=function(b){this._flags&=~b;},j.prototype._setFlags=function(b){var c;c=this._flags;return this._flags|=b,c;},j.prototype._changeFlags=function(b,c){y4tt.v9();c?this._flags|=b:this._flags&=~b;},j.propChangedInfo=new c(),j.flagIsDisposed=1,j.flagLevelBoundingInfoDirty=2,j.flagModelDirty=4,j.flagLayoutDirty=8,j.flagLevelVisible=16,j.flagBoundingInfoDirty=32,j.flagIsPickable=64,j.flagIsVisible=128,j.flagVisibilityChanged=256,j.flagPositioningDirty=512,j.flagTrackedGroup=1024,j=__decorate([b.className("SmartPropertyPrim")],j));b.SmartPropertyPrim=q;b.modelLevelProperty=function(b,c,d,f){y4tt.q9();return void 0===d&&(d=!1),void 0===f&&(f=!1),q._hookProperty(b,c,d,f,e.PROPKIND_MODEL);};b.instanceLevelProperty=function(b,c,d,f){return void 0===d&&(d=!1),void 0===f&&(f=!1),q._hookProperty(b,c,d,f,e.PROPKIND_INSTANCE);};b.dynamicLevelProperty=function(b,c,d,f){return void 0===d&&(d=!1),void 0===f&&(f=!1),q._hookProperty(b,c,d,f,e.PROPKIND_DYNAMIC);};}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j,l,n,m;b.PrepareRender2DContext=function(){this.forceRefreshPrimitive=!1;};e=function(b){this._renderMode=b;y4tt.v9();this.useInstancing=!1;this.partDataStartIndex=this.partDataEndIndex=this.groupInfoPartData=null;};g=(Object.defineProperty(e.prototype,"renderMode",{get:function(){return this._renderMode;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeOpaque",{get:function(){y4tt.q9();return e._renderModeOpaque;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeAlphaTest",{get:function(){y4tt.q9();return e._renderModeAlphaTest;},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeTransparent",{get:function(){y4tt.v9();return e._renderModeTransparent;},enumerable:!0,configurable:!0}),e._renderModeOpaque=1,e._renderModeAlphaTest=2,e._renderModeTransparent=3,e);b.Render2DContext=g;c=function(){this.primitivePointerPos=b.Vector2.Zero();this.tilt=b.Vector2.Zero();this.cancelBubble=!1;};g=(Object.defineProperty(c,"PointerOver",{get:function(){return c._pointerOver;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerEnter",{get:function(){return c._pointerEnter;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerDown",{get:function(){return c._pointerDown;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerMouseWheel",{get:function(){y4tt.q9();return c._pointerMouseWheel;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerMove",{get:function(){return c._pointerMove;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerUp",{get:function(){y4tt.q9();return c._pointerUp;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerOut",{get:function(){y4tt.v9();return c._pointerOut;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerLeave",{get:function(){return c._pointerLeave;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerGotCapture",{get:function(){return c._pointerGotCapture;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerLostCapture",{get:function(){return c._pointerLostCapture;},enumerable:!0,configurable:!0}),Object.defineProperty(c,"MouseWheelPrecision",{get:function(){return c._mouseWheelPrecision;},enumerable:!0,configurable:!0}),c.prototype.updateRelatedTarget=function(b,c){this.relatedTarget=b;this.relatedTargetPointerPos=c;},c.getEventTypeName=function(b){y4tt.q9();switch(b){case c.PointerOver:return"PointerOver";case c.PointerEnter:return"PointerEnter";case c.PointerDown:return"PointerDown";case c.PointerMouseWheel:return"PointerMouseWheel";case c.PointerMove:return"PointerMove";case c.PointerUp:return"PointerUp";case c.PointerOut:return"PointerOut";case c.PointerLeave:return"PointerLeave";case c.PointerGotCapture:return"PointerGotCapture";case c.PointerLostCapture:return"PointerLostCapture";}},c._pointerOver=1,c._pointerEnter=2,c._pointerDown=4,c._pointerMouseWheel=8,c._pointerMove=16,c._pointerUp=32,c._pointerOut=64,c._pointerLeave=128,c._pointerGotCapture=256,c._pointerLostCapture=512,c._mouseWheelPrecision=3,c);b.PrimitivePointerInfo=g;y4tt.q9();f=function(b){this._changedCallback=b;this._horizontal=f.AlignLeft;this._vertical=f.AlignBottom;};d=(Object.defineProperty(f,"AlignLeft",{get:function(){y4tt.v9();return f._AlignLeft;},enumerable:!0,configurable:!0}),Object.defineProperty(f,"AlignTop",{get:function(){y4tt.q9();return f._AlignTop;},enumerable:!0,configurable:!0}),Object.defineProperty(f,"AlignRight",{get:function(){y4tt.v9();return f._AlignRight;},enumerable:!0,configurable:!0}),Object.defineProperty(f,"AlignBottom",{get:function(){y4tt.q9();return f._AlignBottom;},enumerable:!0,configurable:!0}),Object.defineProperty(f,"AlignCenter",{get:function(){return f._AlignCenter;},enumerable:!0,configurable:!0}),Object.defineProperty(f,"AlignStretch",{get:function(){return f._AlignStretch;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"horizontal",{get:function(){y4tt.q9();return this._horizontal;},set:function(b){y4tt.q9();this._horizontal!==b&&(this._horizontal=b,this._changedCallback());},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"vertical",{get:function(){y4tt.v9();return this._vertical;},set:function(b){this._vertical!==b&&(this._vertical=b,this._changedCallback());},enumerable:!0,configurable:!0}),f.prototype.setHorizontal=function(b){switch(b.trim().toLocaleLowerCase()){case"left":return void(this.horizontal=f.AlignLeft);case"right":return void(this.horizontal=f.AlignRight);case"center":return void(this.horizontal=f.AlignCenter);case"stretch":return void(this.horizontal=f.AlignStretch);}},f.prototype.setVertical=function(b){switch(b.trim().toLocaleLowerCase()){case"top":return void(this.vertical=f.AlignTop);case"bottom":return void(this.vertical=f.AlignBottom);case"center":return void(this.vertical=f.AlignCenter);case"stretch":return void(this.vertical=f.AlignStretch);}},f.prototype.fromString=function(b){var d,f;b=b.trim().split(",");for(var c=0;c<b.length;c++){d=b[c],d=d.toLocaleLowerCase().trim(),f=d.indexOf("h:");-1===f&&(f=d.indexOf("horizontal:"));-1===f?(f=d.indexOf("v:"),-1===f&&(f=d.indexOf("vertical:")),-1===f||(d=d.substr(d.indexOf(":")+1),this.setVertical(d))):(d=d.substr(d.indexOf(":")+1),this.setHorizontal(d));}},f._AlignLeft=1,f._AlignTop=1,f._AlignRight=2,f._AlignBottom=2,f._AlignCenter=3,f._AlignStretch=4,f);b.PrimitiveAlignment=d;q=function(b,c){this.prim=b;this.intersectionLocation=c;};b.PrimitiveIntersectedInfo=q;l=function(b,c){this._parentAccess=b;this._changedCallback=c;this._pixels=Array(4);this._percentages=Array(4);y4tt.v9();this._setType(0,l.Auto);this._setType(1,l.Auto);this._setType(2,l.Auto);this._setType(3,l.Auto);this._pixels[0]=0;this._pixels[1]=0;this._pixels[2]=0;this._pixels[3]=0;};j=(l.prototype.fromString=function(b){this._clear();b=b.trim().split(",");for(var c=!1,d=0;d<b.length;d++)c=this._extractString(b[d],!1)||c;if(!c)throw Error("Can't parse the string to create a PrimitiveMargin object, format must be: 'top: <value>, left:<value>, right:<value>, bottom:<value>");0===(15&this._flags)&&(this._flags|=l.Pixel<<0);0===(240&this._flags)&&(this._flags|=l.Pixel<<4);y4tt.v9();0===(3840&this._flags)&&(this._flags|=l.Pixel<<8);0===(61440&this._flags)&&(this._flags|=l.Pixel<<12);this._changedCallback();},l.prototype.fromStrings=function(b,c,d,f){y4tt.v9();return this._clear(),this._setStringValue(b,0,!1),this._setStringValue(c,1,!1),this._setStringValue(d,2,!1),this._setStringValue(f,3,!1),this._changedCallback(),this;},l.prototype.fromPixels=function(b,c,d,f){return this._clear(),this._pixels[0]=b,this._pixels[1]=c,this._pixels[2]=d,this._pixels[3]=f,this._changedCallback(),this;},l.prototype.fromUniformPixels=function(b){y4tt.q9();return this._clear(),this._pixels[0]=b,this._pixels[1]=b,this._pixels[2]=b,this._pixels[3]=b,this._changedCallback(),this;},l.prototype.auto=function(){return this._clear(),this._flags=l.Auto<<0|l.Auto<<4|l.Auto<<8|l.Auto<<12,this._pixels[0]=0,this._pixels[1]=0,this._pixels[2]=0,this._pixels[3]=0,this._changedCallback(),this;},l.prototype._clear=function(){this._flags=0;this._pixels[0]=0;this._pixels[1]=0;this._pixels[2]=0;this._pixels[3]=0;this._percentages[0]=null;this._percentages[1]=null;this._percentages[2]=null;this._percentages[3]=null;},l.prototype._extractString=function(b,c){var d;y4tt.q9();d=b.trim().toLocaleLowerCase();return 0===d.indexOf("top:")?(d=d.substr(4).trim(),this._setStringValue(d,0,c)):0===d.indexOf("left:")?(d=d.substr(5).trim(),this._setStringValue(d,1,c)):0===d.indexOf("right:")?(d=d.substr(6).trim(),this._setStringValue(d,2,c)):0===d.indexOf("bottom:")?(d=d.substr(7).trim(),this._setStringValue(d,3,c)):!1;},l.prototype._setStringValue=function(b,c,d){var f;b=b.trim().toLocaleLowerCase();if("auto"===b){if(this._isType(c,l.Auto))return!0;this._setType(c,l.Auto);this._pixels[c]=0;}else{if("inherit"!==b){f=b.indexOf("%");if(-1!==f)return b=b.substr(0,f),b=Math.round(Number(b))/100,this._isType(c,l.Percentage)&&this._percentages[c]===b?!0:(this._setType(c,l.Percentage),isNaN(b)?!1:(this._percentages[c]=b,d&&this._changedCallback(),!0));f=b.indexOf("px");b=-1!==f?b.substr(0,f).trim():b;b=Number(b);return this._isType(c,l.Pixel)&&this._pixels[c]===b?!0:isNaN(b)?!1:(this._pixels[c]=b,this._setType(c,l.Pixel),d&&this._changedCallback(),!0);}if(this._isType(c,l.Inherit))return!0;this._setType(c,l.Inherit);this._pixels[c]=null;}d&&this._changedCallback();},l.prototype._setPixels=function(b,c,d){b=Math.round(b);this._isType(c,l.Pixel)&&this._pixels[c]===b||(this._setType(c,l.Pixel),this._pixels[c]=b,d&&this._changedCallback());},l.prototype._setPercentage=function(b,c,d){b=Math.min(1,b);y4tt.q9();b=Math.max(0,b);b=Math.round(100*b)/100;this._isType(c,l.Percentage)&&this._percentages[c]===b||(this._setType(c,l.Percentage),this._percentages[c]=b,d&&this._changedCallback());},l.prototype._getStringValue=function(b){y4tt.v9();switch(this._flags>>4*b&15){case l.Auto:return"auto";case l.Pixel:return this._pixels[b]+"px";case l.Percentage:return 100*this._percentages[b]+"%";case l.Inherit:return"inherit";}return"";},l.prototype._isType=function(b,c){y4tt.q9();return(this._flags>>4*b&15)===c;},l.prototype._getType=function(b,c){var d;d=this._flags>>4*b&15;return c&&d===l.Inherit?(d=this._parentAccess())?d._getType(b,!0):l.Auto:d;},l.prototype._setType=function(b,c){this._flags&=~(15<<4*b);this._flags|=c<<4*b;},l.prototype.setTop=function(b){y4tt.q9();"string"==typeof b?this._setStringValue(b,0,!0):this.topPixels=b;},l.prototype.setLeft=function(b){"string"==typeof b?this._setStringValue(b,1,!0):this.leftPixels=b;},l.prototype.setRight=function(b){y4tt.q9();"string"==typeof b?this._setStringValue(b,2,!0):this.rightPixels=b;},l.prototype.setBottom=function(b){"string"==typeof b?this._setStringValue(b,3,!0):this.bottomPixels=b;},Object.defineProperty(l.prototype,"top",{get:function(){return this._getStringValue(0);},set:function(b){this._setStringValue(b,0,!0);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"left",{get:function(){return this._getStringValue(1);},set:function(b){y4tt.q9();this._setStringValue(b,1,!0);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"right",{get:function(){y4tt.v9();return this._getStringValue(2);},set:function(b){this._setStringValue(b,2,!0);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"bottom",{get:function(){y4tt.v9();return this._getStringValue(3);},set:function(b){y4tt.q9();this._setStringValue(b,3,!0);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"topPixels",{get:function(){y4tt.q9();return this._pixels[0];},set:function(b){y4tt.q9();this._setPixels(b,0,!0);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"leftPixels",{get:function(){y4tt.v9();return this._pixels[1];},set:function(b){y4tt.q9();this._setPixels(b,1,!0);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"rightPixels",{get:function(){return this._pixels[2];},set:function(b){y4tt.q9();this._setPixels(b,2,!0);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"bottomPixels",{get:function(){y4tt.v9();return this._pixels[3];},set:function(b){this._setPixels(b,3,!0);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"topPercentage",{get:function(){return this._percentages[0];},set:function(b){this._setPercentage(b,0,!0);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"leftPercentage",{get:function(){y4tt.q9();return this._percentages[1];},set:function(b){y4tt.q9();this._setPercentage(b,1,!0);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"rightPercentage",{get:function(){return this._percentages[2];},set:function(b){y4tt.q9();this._setPercentage(b,2,!0);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"bottomPercentage",{get:function(){return this._percentages[3];},set:function(b){y4tt.q9();this._setPercentage(b,3,!0);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"topMode",{get:function(){y4tt.v9();return this._getType(0,!1);},set:function(b){this._setType(0,b);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"leftMode",{get:function(){return this._getType(1,!1);},set:function(b){y4tt.q9();this._setType(1,b);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"rightMode",{get:function(){y4tt.q9();return this._getType(2,!1);},set:function(b){y4tt.q9();this._setType(2,b);},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"bottomMode",{get:function(){return this._getType(3,!1);},set:function(b){this._setType(3,b);},enumerable:!0,configurable:!0}),l.prototype._computePixels=function(b,c,d){var f;f=this._getType(b,!1);if(f===l.Inherit)return void this._parentAccess()._computePixels(b,c,d);f===l.Percentage&&(this._pixels[b]=(0===b||3===b?c.height:c.width)*this._percentages[b],d&&this._changedCallback());},l.prototype.computeWithAlignment=function(b,c,f,e,j){var g,m,n,q,A;g=this._getType(0,!0),m=this._getType(1,!0),n=this._getType(2,!0),q=this._getType(3,!0),A=c&&null!=c.width?c.width:0;c=c&&null!=c.height?c.height:0;g=g===l.Auto;m=m===l.Auto;n=n===l.Auto;q=q===l.Auto;switch(f.horizontal){case d.AlignLeft:m?e.x=0:(this._computePixels(1,b,!0),e.x=this.leftPixels);j.width=A;break;case d.AlignRight:n?e.x=Math.round(b.width-A):(this._computePixels(2,b,!0),e.x=Math.round(b.width-(A+this.rightPixels)));j.width=A;break;case d.AlignStretch:m?e.x=0:(this._computePixels(1,b,!0),e.x=this.leftPixels);A=0;n||(this._computePixels(2,b,!0),A=this.rightPixels);j.width=b.width-(e.x+A);break;case d.AlignCenter:m||this._computePixels(1,b,!0),n||this._computePixels(2,b,!0),n=(m?0:this.leftPixels)-(n?0:this.rightPixels),e.x=Math.round((b.width-A)/2+n),j.width=A;}switch(f.vertical){case d.AlignTop:g?e.y=b.height-c:(this._computePixels(0,b,!0),e.y=Math.round(b.height-(c+this.topPixels)));j.height=c;break;case d.AlignBottom:q?e.y=0:(this._computePixels(3,b,!0),e.y=this.bottomPixels);j.height=c;break;case d.AlignStretch:q?e.y=0:(this._computePixels(3,b,!0),e.y=this.bottomPixels);f=0;g||(this._computePixels(0,b,!0),f=this.topPixels);j.height=b.height-(e.y+f);break;case d.AlignCenter:g||this._computePixels(0,b,!0),q||this._computePixels(3,b,!0),n=(q?0:this.bottomPixels)-(g?0:this.topPixels),e.y=Math.round((b.height-c)/2+n),j.height=c;}},l.prototype.compute=function(b,c,d){this._computePixels(0,b,!0);this._computePixels(1,b,!0);this._computePixels(2,b,!0);this._computePixels(3,b,!0);c.x=this.leftPixels;d.width=b.width-(c.x+this.rightPixels);c.y=this.bottomPixels;d.height=b.height-(c.y+this.topPixels);},l.prototype.computeArea=function(b,c){this._computePixels(0,b,!0);y4tt.q9();this._computePixels(1,b,!0);this._computePixels(2,b,!0);this._computePixels(3,b,!0);c.width=this.leftPixels+b.width+this.rightPixels;c.height=this.bottomPixels+b.height+this.topPixels;},l.Auto=1,l.Inherit=2,l.Percentage=4,l.Pixel=8,l);b.PrimitiveThickness=j;g=function(){this.intersectHidden=this.findFirstOnly=!1;y4tt.q9();this.pickPosition=b.Vector2.Zero();};g=(Object.defineProperty(g.prototype,"isIntersected",{get:function(){return this.intersectedPrimitives&&0<this.intersectedPrimitives.length;},enumerable:!0,configurable:!0}),g.prototype.isPrimIntersected=function(b){var f;for(var c=0,d=this.intersectedPrimitives;c<d.length;c++){f=d[c];if(f.prim===b)return f.intersectionLocation;}return null;},g.prototype._exit=function(b){b&&(this._globalPickPosition=null);},g);b.IntersectInfo2D=g;n=b.SmartPropertyPrim,m=function(c){var d,f,e;null==c&&(c={});n.call(this);if(m._isCanvasInit)d=this,f=null,this._canvasPreInit(c);else if(null!=c.parent){if(f=c.parent,d=c.parent.owner,!d)throw Error("Parent "+f.id+" of "+c.id+" doesn't have a valid owner!");if(!(this instanceof b.Group2D||this instanceof b.Sprite2D&&null!==c.id&&0===c.id.indexOf("__cachedSpriteOfGroup__")||d.cachingStrategy!==b.Canvas2D.CACHESTRATEGY_TOPLEVELGROUPS||f!==d))throw Error("Can't create a primitive with the canvas as direct parent when the caching strategy is TOPLEVELGROUPS. You need to create a Group below the canvas and use it as the parent for the primitive");}(this._layoutEngine=b.CanvasLayoutEngine.Singleton,this._size=null,this._actualSize=null,this._boundingSize=null,this._layoutArea=b.Size.Zero(),this._layoutAreaPos=b.Vector2.Zero(),this._marginOffset=b.Vector2.Zero(),this._parentMargingOffset=b.Vector2.Zero(),this._parentContentArea=b.Size.Zero(),this._contentArea=new b.Size(null,null),this._pointerEventObservable=new b.Observable(),this._siblingDepthOffset=this._hierarchyDepthOffset=0,this._boundingInfo=new b.BoundingInfo2D(),this._owner=d,this._parent=null,this._margin=null,this._padding=null,this._marginAlignment=null,this._id=c.id,this.propertyChanged=new b.Observable(),this._children=[],this._localTransform=new b.Matrix(),this._globalTransform=null,this._invGlobalTransform=null,this._globalTransformProcessStep=0,this._globalTransformStep=0,this._hierarchyDepth=0,this._renderGroup=null,this._setFlags(b.SmartPropertyPrim.flagIsPickable|b.SmartPropertyPrim.flagBoundingInfoDirty),null!=f&&(f.addChild(this),this._patchHierarchy(f.owner)),this.owner&&this instanceof b.Group2D)&&this.detectGroupStates();if(null!=c.children){d=0;for(f=c.children;d<f.length;d++){e=f[d];this.addChild(e);e._patchHierarchy(this.owner);}}if(null!=c.position?this.position=c.position:null!=c.x||null!=c.y?this.position=new b.Vector2(c.x||0,c.y||0):this._position=null,this.rotation=null==c.rotation?0:c.rotation,this.scale=null==c.scale?1:c.scale,this.levelVisible=null==c.isVisible?!0:c.isVisible,this.origin=c.origin||new b.Vector2(0.5,0.5),null!=c.layoutEngine)"string"==typeof c.layoutEngine?(d=c.layoutEngine.toLocaleLowerCase().trim(),"canvas"===d||"canvaslayoutengine"===d?this.layoutEngine=b.CanvasLayoutEngine.Singleton:0===d.indexOf("stackpanel")||0===d.indexOf("horizontalstackpanel")?this.layoutEngine=b.StackPanelLayoutEngine.Horizontal:0===d.indexOf("verticalstackpanel")&&(this.layoutEngine=b.StackPanelLayoutEngine.Vertical)):c.layoutEngine instanceof b.LayoutEngineBase&&(this.layoutEngine=c.layoutEngine);c.marginTop&&this.margin.setTop(c.marginTop);c.marginLeft&&this.margin.setLeft(c.marginLeft);y4tt.v9();c.marginRight&&this.margin.setRight(c.marginRight);c.marginBottom&&this.margin.setBottom(c.marginBottom);c.margin&&("string"==typeof c.margin?this.margin.fromString(c.margin):this.margin.fromUniformPixels(c.margin));c.marginHAlignment&&(this.marginAlignment.horizontal=c.marginHAlignment);c.marginVAlignment&&(this.marginAlignment.vertical=c.marginVAlignment);c.marginAlignment&&this.marginAlignment.fromString(c.marginAlignment);c.paddingTop&&this.padding.setTop(c.paddingTop);c.paddingLeft&&this.padding.setLeft(c.paddingLeft);c.paddingRight&&this.padding.setRight(c.paddingRight);c.paddingBottom&&this.padding.setBottom(c.paddingBottom);c.padding&&this.padding.fromString(c.padding);this._parentLayoutDirty();this._positioningDirty();};g=(__extends(m,n),Object.defineProperty(m.prototype,"actionManager",{get:function(){return this._actionManager||(this._actionManager=new b.ActionManager(this.owner.scene)),this._actionManager;},enumerable:!0,configurable:!0}),m.prototype.traverseUp=function(b){for(var c=this;null!=c;){if(b(c))return c;c=c._parent;}return null;},Object.defineProperty(m.prototype,"owner",{get:function(){y4tt.q9();return this._owner;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"parent",{get:function(){y4tt.v9();return this._parent;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"children",{get:function(){return this._children;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"id",{get:function(){return this._id;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"actualPosition",{get:function(){y4tt.q9();return null!=this._actualPosition?this._actualPosition:null!=this._position?this._position:m._nullPosition;},set:function(b){y4tt.v9();this._actualPosition=b;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"actualX",{get:function(){y4tt.v9();return this.actualPosition.x;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"actualY",{get:function(){y4tt.v9();return this.actualPosition.y;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"position",{get:function(){return this._position;},set:function(b){y4tt.q9();this._checkPositionChange()&&(this._position=b);},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"x",{get:function(){return this._position?this._position.x:null;},set:function(c){y4tt.v9();this._checkPositionChange()&&(this._position||(this._position=b.Vector2.Zero()),this._position.x!==c&&(this._position.x=c,this.markAsDirty("position")));},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"y",{get:function(){y4tt.v9();return this._position?this._position.y:null;},set:function(c){this._checkPositionChange()&&(this._position||(this._position=b.Vector2.Zero()),this._position.y!==c&&(this._position.y=c,this.markAsDirty("position")));},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"size",{get:function(){y4tt.v9();if(!this._size||null==this._size.width||null==this._size.height){if(m.boundinbBoxReentrency)return m.nullSize;if(this._boundingSize)return this._boundingSize;m.boundinbBoxReentrency=!0;this.boundingInfo;return m.boundinbBoxReentrency=!1,this._boundingSize;}return this._size;},set:function(b){this._size=b;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"width",{get:function(){return this.size?this.size.width:null;},set:function(c){return this.size?void(this.size.width!==c&&(this.size.width=c,this.markAsDirty("size"),this._positioningDirty())):void(this.size=new b.Size(c,0));},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"height",{get:function(){return this.size?this.size.height:null;},set:function(c){y4tt.q9();return this.size?void(this.size.height!==c&&(this.size.height=c,this.markAsDirty("size"),this._positioningDirty())):void(this.size=new b.Size(0,c));},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"rotation",{get:function(){return this._rotation;},set:function(b){y4tt.v9();this._rotation=b;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"scale",{get:function(){y4tt.v9();return this._scale;},set:function(b){this._scale=b;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"actualSize",{get:function(){y4tt.v9();return this._actualSize?this._actualSize:this._size;},set:function(b){this._actualSize.equals(b)||(this._actualSize=b);},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"actualZOffset",{get:function(){y4tt.q9();return this._zOrder||1-this._hierarchyDepthOffset;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"minSize",{get:function(){y4tt.v9();return this._minSize;},set:function(b){this._minSize&&b&&this._minSize.equals(b)||(this._minSize=b,this._parentLayoutDirty());},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"maxSize",{get:function(){return this._maxSize;},set:function(b){y4tt.q9();this._maxSize&&b&&this._maxSize.equals(b)||(this._maxSize=b,this._parentLayoutDirty());},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"origin",{get:function(){y4tt.q9();return this._origin;},set:function(b){y4tt.v9();this._origin=b;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"levelVisible",{get:function(){y4tt.v9();return this._isFlagSet(b.SmartPropertyPrim.flagLevelVisible);},set:function(c){y4tt.v9();this._changeFlags(b.SmartPropertyPrim.flagLevelVisible,c);},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isVisible",{get:function(){return this._isFlagSet(b.SmartPropertyPrim.flagIsVisible);},set:function(c){y4tt.v9();this._changeFlags(b.SmartPropertyPrim.flagIsVisible,c);},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"zOrder",{get:function(){return this._zOrder;},set:function(b){y4tt.v9();this._zOrder=b;this.onZOrderChanged();},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"margin",{get:function(){var b;y4tt.v9();b=this;return this._margin||(this._margin=new j(function(){return b.parent?b.parent.margin:null;},function(){y4tt.v9();return b._positioningDirty();})),this._margin;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"_hasMargin",{get:function(){return null!==this._margin||null!==this._marginAlignment;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"padding",{get:function(){var b;b=this;return this._padding||(this._padding=new j(function(){y4tt.v9();return b.parent?b.parent.padding:null;},function(){return b._positioningDirty();})),this._padding;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"_hasPadding",{get:function(){y4tt.v9();return null!==this._padding;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"marginAlignment",{get:function(){var b;b=this;y4tt.q9();return this._marginAlignment||(this._marginAlignment=new d(function(){y4tt.q9();return b._positioningDirty();})),this._marginAlignment;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"layoutEngine",{get:function(){return this._layoutEngine||(this._layoutEngine=b.CanvasLayoutEngine.Singleton),this._layoutEngine;},set:function(b){this._layoutEngine!==b&&this._changeLayoutEngine(b);},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"layoutArea",{get:function(){return this._layoutArea;},set:function(b){y4tt.q9();this._layoutArea.equals(b)||(this._positioningDirty(),this._layoutArea=b);},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"layoutAreaPos",{get:function(){y4tt.v9();return this._layoutAreaPos;},set:function(b){y4tt.v9();this._layoutAreaPos.equals(b)||(this._positioningDirty(),this._layoutAreaPos=b);},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isPickable",{get:function(){y4tt.v9();return this._isFlagSet(b.SmartPropertyPrim.flagIsPickable);},set:function(c){y4tt.q9();this._changeFlags(b.SmartPropertyPrim.flagIsPickable,c);},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"hierarchyDepth",{get:function(){y4tt.q9();return this._hierarchyDepth;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"renderGroup",{get:function(){return this._renderGroup;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"globalTransform",{get:function(){return this._globalTransform;},enumerable:!0,configurable:!0}),m.prototype.getGlobalPosition=function(){var c;y4tt.q9();c=new b.Vector2(0,0);return this.getGlobalPositionByRef(c),c;},m.prototype.getGlobalPositionByRef=function(b){y4tt.q9();b.x=this.globalTransform.m[12];b.y=this.globalTransform.m[13];},Object.defineProperty(m.prototype,"invGlobalTransform",{get:function(){return this._invGlobalTransform;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"localTransform",{get:function(){y4tt.q9();return this._updateLocalTransform(),this._localTransform;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"boundingInfo",{get:function(){var l;y4tt.v9();if(this._isFlagSet(b.SmartPropertyPrim.flagBoundingInfoDirty)){for(var c=this._boundingInfo=this.levelBoundingInfo.clone(),d=new b.BoundingInfo2D(),f=0,e=this._children;f<e.length;f++){l=e[f];l.boundingInfo.transformToRef(l.localTransform,d);c.unionToRef(d,c);}this._boundingSize=b.Size.Zero();c=this._boundingInfo.max();this._boundingSize=new b.Size(this._size&&null!=this._size.width?this._size.width:Math.ceil(c.x),this._size&&null!=this._size.height?this._size.height:Math.ceil(c.y));this._clearFlags(b.SmartPropertyPrim.flagBoundingInfoDirty);}return this._boundingInfo;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isSizeAuto",{get:function(){return null==this._size;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isPositionAuto",{get:function(){return null==this._position;},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"pointerEventObservable",{get:function(){return this._pointerEventObservable;},enumerable:!0,configurable:!0}),m.prototype.findById=function(b){var f;y4tt.v9();if(this._id===b)return this;for(var c=0,d=this._children;c<d.length;c++){f=d[c].findById(b);if(null!=f)return f;}},m.prototype.onZOrderChanged=function(){},m.prototype.levelIntersect=function(){return!1;},m.prototype.setPointerEventCapture=function(b){y4tt.v9();return this.owner._setPointerCapture(b,this);},m.prototype.releasePointerEventsCapture=function(b){return this.owner._releasePointerCapture(b,this);},m.prototype.intersect=function(c){var d,f,e,l;if(!c)return!1;d=!c._globalPickPosition;if(d&&(c._globalPickPosition=b.Vector2.Zero(),b.Vector2.TransformToRef(c.pickPosition,this.globalTransform,c._globalPickPosition),c._localPickPosition=c.pickPosition.clone(),c.intersectedPrimitives=[],c.topMostIntersectedPrimitive=null),!c.intersectHidden&&!this.isVisible)return!1;if(this.isPickable&&!this.boundingInfo.doesIntersect(c._localPickPosition))return c._exit(d),!1;f=!1;if(this.isPickable&&(f=this.levelIntersect(c))){e=new q(this,c._localPickPosition.clone());if(c.intersectedPrimitives.push(e),(!c.topMostIntersectedPrimitive||c.topMostIntersectedPrimitive.prim.actualZOffset>e.prim.actualZOffset)&&(c.topMostIntersectedPrimitive=e),c.findFirstOnly)return c._exit(d),!0;}if(!f||!c.findFirstOnly){f=0;for(e=this._children;f<e.length;f++){l=e[f];if(l.isPickable&&(c.intersectHidden||l.isVisible)&&(b.Vector2.TransformToRef(c._globalPickPosition,l.invGlobalTransform,c._localPickPosition),l.intersect(c)&&c.findFirstOnly))return c._exit(d),!0;}}return c._exit(d),c.isIntersected;},m.prototype.moveChild=function(b,c){var d,f,e,l;y4tt.q9();if(b.parent!==this)return!1;e=this._children.indexOf(b),l=c?this._children.indexOf(c):-1;c?(d=this._children[l]._siblingDepthOffset,f=this._children[l+1]._siblingDepthOffset):(d=1,f=this._children[1]._siblingDepthOffset);b._siblingDepthOffset=(f-d)/2;this._children.splice(l+1,0,this._children.splice(e,1)[0]);},m.prototype.addChild=function(b){b._parent=this;this._boundingBoxDirty();this._patchHierarchyDepth(b);this._children.push(b);},m.prototype.dispose=function(){var b;if(!n.prototype.dispose.call(this))return!1;y4tt.v9();if(this._actionManager&&(this._actionManager.dispose(),this._actionManager=null),this._parent){b=this._parent._children.indexOf(this);void 0!==b&&this._parent._children.splice(b,1);this._parent=null;}if(this._children)for(;0<this._children.length;)this._children[this._children.length-1].dispose();return!0;},m.prototype.onPrimBecomesDirty=function(){this._renderGroup&&this._renderGroup._addPrimToDirtyList(this);},m.prototype._needPrepare=function(){return this._areSomeFlagsSet(b.SmartPropertyPrim.flagVisibilityChanged|b.SmartPropertyPrim.flagModelDirty)||0!==this._instanceDirtyFlags||this._globalTransformProcessStep!==this._globalTransformStep;},m.prototype._prepareRender=function(b){this._prepareRenderPre(b);y4tt.q9();this._prepareRenderPost(b);},m.prototype._prepareRenderPre=function(){},m.prototype._prepareRenderPost=function(c){this instanceof b.Group2D&&this.isRenderableGroup||(0<this._children.length&&(this._globalTransformProcessStep!==this._globalTransformStep||this.checkPropertiesDirty(m.isVisibleProperty.flagId))&&this._children.forEach(function(d){y4tt.q9();d instanceof b.Group2D&&d.isRenderableGroup||d._prepareRender(c);}),this._clearFlags(b.SmartPropertyPrim.flagModelDirty),this._instanceDirtyFlags=0);},m.prototype._canvasPreInit=function(){},m.CheckParent=function(){},m.prototype.updateCachedStatesOf=function(b,c){for(var d=0;d<b.length;d++)b[d].updateCachedStates(c);},m.prototype._parentLayoutDirty=function(){this._parent&&!this._parent.isDisposed&&this._parent._setLayoutDirty();},m.prototype._setLayoutDirty=function(){this.isDirty||this.onPrimBecomesDirty();this._setFlags(b.SmartPropertyPrim.flagLayoutDirty);},m.prototype._checkPositionChange=function(){return this.parent&&!1===this.parent.layoutEngine.isChildPositionAllowed?(console.log("Can't manually set the position of "+this.id+", the Layout Engine of its parent doesn't allow it"),!1):!0;},m.prototype._positioningDirty=function(){y4tt.v9();this.isDirty||this.onPrimBecomesDirty();this._setFlags(b.SmartPropertyPrim.flagPositioningDirty);},m.prototype._changeLayoutEngine=function(b){this._layoutEngine=b;},m.prototype._updateLocalTransform=function(){var c,d,f,e;c=!1,d=null;this._parent?(d=this._parent._marginOffset,c=!d.equals(this._parentMargingOffset),this._parentMargingOffset.copyFrom(d)):d=m._v0;f=m.actualPositionProperty.flagId|m.rotationProperty.flagId|m.scaleProperty.flagId|m.originProperty.flagId;if(c||this.checkPropertiesDirty(f)){c=b.Quaternion.RotationAxis(new b.Vector3(0,0,1),this._rotation);if(0===this._origin.x&&0===this._origin.y)this._localTransform=d=b.Matrix.Compose(new b.Vector3(this._scale,this._scale,1),c,new b.Vector3(this.actualPosition.x+d.x,this.actualPosition.y+d.y,0));else{e=this.actualSize;b.Matrix.TranslationToRef(-e.width*this._origin.x,-e.height*this._origin.y,0,m._t0);c.toRotationMatrix(m._t1);m._t0.multiplyToRef(m._t1,m._t2);b.Matrix.ScalingToRef(this._scale,this._scale,1,m._t0);m._t2.multiplyToRef(m._t0,m._t1);b.Matrix.TranslationToRef(e.width*this._origin.x+this.actualPosition.x+d.x,e.height*this._origin.y+this.actualPosition.y+d.y,0,m._t2);m._t1.multiplyToRef(m._t2,this._localTransform);}return this.clearPropertiesDirty(f),!0;}y4tt.q9();return!1;},m.prototype.updateCachedStates=function(c){var d,f;y4tt.q9();if(!this.isDisposed){this._parent&&(this._parent._globalTransformProcessStep!==this.owner._globalTransformProcessStep||this._parent._areSomeFlagsSet(b.SmartPropertyPrim.flagLayoutDirty|b.SmartPropertyPrim.flagPositioningDirty))&&this._parent.updateCachedStates(!1);d=this.checkPropertiesDirty(m.sizeProperty.flagId);!this._isFlagSet(b.SmartPropertyPrim.flagLayoutDirty)&&d&&this.size&&(null!=this.size.width&&(this.actualSize.width=this.size.width),null!=this.size.height&&(this.actualSize.height=this.size.height),this.clearPropertiesDirty(m.sizeProperty.flagId));f=this._isFlagSet(b.SmartPropertyPrim.flagPositioningDirty);this._isFlagSet(b.SmartPropertyPrim.flagLayoutDirty)&&(this._layoutEngine.updateLayout(this),this._clearFlags(b.SmartPropertyPrim.flagLayoutDirty));f=f&&!this._isFlagSet(b.SmartPropertyPrim.flagPositioningDirty);if(!f&&(d||this._isFlagSet(b.SmartPropertyPrim.flagPositioningDirty)||this._parent&&!this._parent.contentArea.equals(this._parentContentArea))&&(this._updatePositioning(),this._clearFlags(b.SmartPropertyPrim.flagPositioningDirty),f=!0),f&&this._parent&&this._parentContentArea.copyFrom(this._parent.contentArea),this===this.owner||this._globalTransformProcessStep!==this.owner._globalTransformProcessStep){d=this.isVisible;this.isVisible=(!this._parent||this._parent.isVisible)&&this.levelVisible;this._changeFlags(b.SmartPropertyPrim.flagVisibilityChanged,d!==this.isVisible);d=this._updateLocalTransform();f=null!=this._parent?this._parent._globalTransformStep!==this._parentTransformStep:!1;if(!this._globalTransform||d||f)d=this._parent?this._parent._globalTransform:null,this._globalTransform=this._parent?this._localTransform.multiply(d):this._localTransform,this._invGlobalTransform=b.Matrix.Invert(this._globalTransform),this._globalTransformStep=this.owner._globalTransformProcessStep+1,this._parentTransformStep=this._parent?this._parent._globalTransformStep:0;this._globalTransformProcessStep=this.owner._globalTransformProcessStep;}if(c){c=0;for(d=this._children;c<d.length;c++)f=d[c],f.updateCachedStates(!(f instanceof b.Group2D&&f.isRenderableGroup));}}},m.prototype._updatePositioning=function(){this._hasMargin||null!=this.actualSize.width&&null!=this.actualSize.height||(null==this.actualSize.width&&(this.marginAlignment.horizontal=d.AlignStretch),null==this.actualSize.height&&(this.marginAlignment.vertical=d.AlignStretch));this._hasMargin&&(this.margin.computeWithAlignment(this.layoutArea,this.size,this.marginAlignment,this._marginOffset,m._size),this.actualPosition=this._marginOffset.add(this._layoutAreaPos),null!=this.size.width&&(this.size.width=m._size.width),null!=this.size.height&&(this.size.height=m._size.height),this.actualSize.copyFrom(m._size.clone()));y4tt.q9();this._hasPadding?(this._getInitialContentAreaToRef(this.actualSize,m._icPos,m._icArea),m._icArea.width=Math.max(0,m._icArea.width),m._icArea.height=Math.max(0,m._icArea.height),this.padding.compute(m._icArea,this._marginOffset,m._size),this._marginOffset.x+=m._icPos.x,this._marginOffset.y+=m._icPos.y,this._contentArea.copyFrom(m._size)):(this._getInitialContentAreaToRef(this.actualSize,m._icPos,m._icArea),m._icArea.width=Math.max(0,m._icArea.width),m._icArea.height=Math.max(0,m._icArea.height),this._marginOffset.copyFrom(m._icPos),this._contentArea.copyFrom(m._icArea));},Object.defineProperty(m.prototype,"contentArea",{get:function(){return this._isFlagSet(b.SmartPropertyPrim.flagPositioningDirty)&&(this._updatePositioning(),this._clearFlags(b.SmartPropertyPrim.flagPositioningDirty)),this._contentArea;},enumerable:!0,configurable:!0}),m.prototype._patchHierarchy=function(c){var d,e;y4tt.v9();if(this._owner=c,null==this._renderGroup){this instanceof b.Group2D&&(this.detectGroupStates(),this._trackedNode&&!this._isFlagSet(b.SmartPropertyPrim.flagTrackedGroup)&&this.owner._registerTrackedNode(this));if(this._parent&&(this._renderGroup=this.parent.traverseUp(function(c){return c instanceof b.Group2D&&c.isRenderableGroup;}),this._parentLayoutDirty()),this._renderGroup&&this.isDirty){d=this._renderGroup._renderableData._primDirtyList;-1===d.indexOf(this)&&d.push(this);}for(var d=0,f=this._children;d<f.length;d++){e=f[d];this._patchHierarchyDepth(e);e._patchHierarchy(c);}}},m.prototype._patchHierarchyDepth=function(c){c._hierarchyDepth=this._hierarchyDepth+1;c._hierarchyDepthOffset=this._hierarchyDepthOffset+(this._children.length+1)*this._siblingDepthOffset;c._siblingDepthOffset=this._siblingDepthOffset/b.Canvas2D.hierarchyLevelMaxSiblingCount;},m.prototype._getInitialContentAreaToRef=function(b,c,d){d.width=b.width;d.height=b.height;c.x=c.y=0;},m.PRIM2DBASE_PROPCOUNT=15,m._nullPosition=b.Vector2.Zero(),m.boundinbBoxReentrency=!1,m.nullSize=b.Size.Zero(),m._isCanvasInit=!1,m._t0=new b.Matrix(),m._t1=new b.Matrix(),m._t2=new b.Matrix(),m._v0=b.Vector2.Zero(),m._icPos=b.Vector2.Zero(),m._icArea=b.Size.Zero(),m._size=b.Size.Zero(),__decorate([b.instanceLevelProperty(1,function(b){y4tt.q9();return m.actualPositionProperty=b;},!1,!0)],m.prototype,"actualPosition",null),__decorate([b.dynamicLevelProperty(1,function(b){return m.positionProperty=b;},!1,!0)],m.prototype,"position",null),__decorate([b.dynamicLevelProperty(2,function(b){y4tt.v9();return m.sizeProperty=b;},!1,!0)],m.prototype,"size",null),__decorate([b.instanceLevelProperty(3,function(b){y4tt.v9();return m.rotationProperty=b;},!1,!0)],m.prototype,"rotation",null),__decorate([b.instanceLevelProperty(4,function(b){return m.scaleProperty=b;},!1,!0)],m.prototype,"scale",null),__decorate([b.dynamicLevelProperty(5,function(b){y4tt.q9();return m.originProperty=b;},!1,!0)],m.prototype,"origin",null),__decorate([b.dynamicLevelProperty(6,function(b){y4tt.v9();return m.levelVisibleProperty=b;})],m.prototype,"levelVisible",null),__decorate([b.instanceLevelProperty(7,function(b){y4tt.v9();return m.isVisibleProperty=b;})],m.prototype,"isVisible",null),__decorate([b.instanceLevelProperty(8,function(b){return m.zOrderProperty=b;})],m.prototype,"zOrder",null),__decorate([b.dynamicLevelProperty(9,function(b){return m.marginProperty=b;})],m.prototype,"margin",null),__decorate([b.dynamicLevelProperty(10,function(b){y4tt.q9();return m.paddingProperty=b;})],m.prototype,"padding",null),__decorate([b.dynamicLevelProperty(11,function(b){return m.marginAlignmentProperty=b;})],m.prototype,"marginAlignment",null),m=__decorate([b.className("Prim2DBase")],m));b.Prim2DBase=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f;g=function(c,d,f){this._partCount=f;this.owner=c;this.modelRenderCache=d;this.modelRenderCache.addRef();y4tt.v9();this.partIndexFromId=new b.StringDictionary();this._usedShaderCategories=Array(f);this._strides=Array(f);this._transparentData=this._alphaTestData=this._opaqueData=null;this.opaqueDirty=this.alphaTestDirty=this.transparentDirty=this.transparentOrderDirty=!1;};g=(g.prototype.dispose=function(){var b;y4tt.v9();if(this._isDisposed)return!1;this.modelRenderCache&&this.modelRenderCache.dispose();b=this.owner.owner.engine;return this.opaqueData&&(this.opaqueData.forEach(function(c){return c.dispose(b);}),this.opaqueData=null),this.partIndexFromId=null,this._isDisposed=!0,!0;},Object.defineProperty(g.prototype,"hasOpaqueData",{get:function(){y4tt.q9();return null!=this._opaqueData;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"hasAlphaTestData",{get:function(){y4tt.v9();return null!=this._alphaTestData;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"hasTransparentData",{get:function(){y4tt.v9();return null!=this._transparentData;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"opaqueData",{get:function(){if(!this._opaqueData){this._opaqueData=Array(this._partCount);for(var b=0;b<this._partCount;b++)this._opaqueData[b]=new e(this._strides[b]);}return this._opaqueData;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"alphaTestData",{get:function(){y4tt.v9();if(!this._alphaTestData){this._alphaTestData=Array(this._partCount);for(var b=0;b<this._partCount;b++)this._alphaTestData[b]=new e(this._strides[b]);}return this._alphaTestData;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"transparentData",{get:function(){if(!this._transparentData){this._transparentData=Array(this._partCount);for(var b=0;b<this._partCount;b++)this._transparentData[b]=new c(this._strides[b],this.modelRenderCache._partData[b]._zBiasOffset);}return this._transparentData;},enumerable:!0,configurable:!0}),g.prototype.sortTransparentData=function(){if(this.transparentOrderDirty){for(var b=0;b<this._transparentData.length;b++)this._transparentData[b]._partData.sort();this.transparentOrderDirty=!1;}},Object.defineProperty(g.prototype,"usedShaderCategories",{get:function(){y4tt.v9();return this._usedShaderCategories;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"strides",{get:function(){return this._strides;},enumerable:!0,configurable:!0}),g);b.GroupInstanceInfo=g;b.TransparentSegment=function(){};g=function(c){this._partBuffer=this._partData=null;this._partBufferSize=0;this._partData=new b.DynamicFloatArray(c/4,50);y4tt.v9();this._isDisposed=!1;};e=(g.prototype.dispose=function(b){y4tt.v9();return this._isDisposed?!1:(this._partBuffer&&(b._releaseBuffer(this._partBuffer),this._partBuffer=null),this._partData=null,void(this._isDisposed=!0));},g);b.GroupInfoPartData=e;d=e;g=function(b,c){d.call(this,b);this._partData.compareValueOffset=c;this._partData.sortingAscending=!1;};c=(__extends(g,d),g);y4tt.v9();b.TransparentGroupInfoPartData=c;f=function(c,d){this._engine=c;this._modelKey=d;this._refCounter=this._nextKey=1;y4tt.q9();this._instancesData=new b.StringDictionary();this._partData=null;};g=(f.prototype.dispose=function(){var b;if(0!==--this._refCounter)return!1;b=this._engine.getExternalData("__BJSCANVAS2D__");return b&&b.DisposeModelRenderCache(this),!0;},Object.defineProperty(f.prototype,"isDisposed",{get:function(){return 0>=this._refCounter;},enumerable:!0,configurable:!0}),f.prototype.addRef=function(){return++this._refCounter;},Object.defineProperty(f.prototype,"modelKey",{get:function(){y4tt.q9();return this._modelKey;},enumerable:!0,configurable:!0}),f.prototype.render=function(){return!0;},f.prototype.addInstanceDataParts=function(b){var c;c=this._nextKey.toString();if(!this._instancesData.add(c,b))throw Error("Key: "+c+" is already allocated");y4tt.v9();return++this._nextKey,c;},f.prototype.removeInstanceData=function(b){this._instancesData.remove(b);},f.prototype.getPartIndexFromId=function(b){for(var c=0;c<this._partData.length;c++)if(this._partData[c]._partId===b)return c;return null;},f.prototype.loadInstancingAttributes=function(b,c){var d;d=this.getPartIndexFromId(b);return null===d?null:this._partsClassInfo[d].classContent.getInstancingAttributeInfos(c,this._partData[d]._partUsedCategories);},f.prototype.setupUniforms=function(b,c,d,e){var g,p;g=this._partData[c],p=g._partDataStride/4*e;this._partsClassInfo[c].fullContent.forEach(function(c,e){var j;if(!e.category||-1!==g._partUsedCategories.indexOf(e.category))switch(e.dataType){case 4:j=e.instanceOffset.get(g._partJoinedUsedCategories);b.setFloat(e.attributeName,d.buffer[p+j]);break;case 0:j=e.instanceOffset.get(g._partJoinedUsedCategories);f.v2.x=d.buffer[p+j+0];f.v2.y=d.buffer[p+j+1];b.setVector2(e.attributeName,f.v2);break;case 5:case 1:j=e.instanceOffset.get(g._partJoinedUsedCategories);f.v3.x=d.buffer[p+j+0];f.v3.y=d.buffer[p+j+1];f.v3.z=d.buffer[p+j+2];b.setVector3(e.attributeName,f.v3);break;case 6:case 2:j=e.instanceOffset.get(g._partJoinedUsedCategories),f.v4.x=d.buffer[p+j+0],f.v4.y=d.buffer[p+j+1],f.v4.z=d.buffer[p+j+2],f.v4.w=d.buffer[p+j+3],b.setVector4(e.attributeName,f.v4);}});},f.v2=b.Vector2.Zero(),f.v3=b.Vector3.Zero(),f.v4=b.Vector4.Zero(),f);b.ModelRenderCache=g;b.ModelRenderCachePartData=function(){};}(BABYLON||(BABYLON={}));!function(b){var e,c,d,f,q,j;c=function(c){this._baseInfo=c;y4tt.q9();this._nextOffset=new b.StringDictionary();this._attributes=[];};y4tt.v9();e=(c.prototype.mapProperty=function(b,d){var f;f=this._nextOffset.getOrAdd(c._CurCategories,0);b.instanceOffset.add(c._CurCategories,this._getBaseOffset(c._CurCategories)+f);this._nextOffset.set(c._CurCategories,f+b.size/4);d&&this._attributes.push(b);},c.prototype.getInstancingAttributeInfos=function(c,d){var v,y,x;for(var f=";"+d.join(";")+";",e=[],j=this;j;){for(var g=0,q=j._attributes;g<q.length;g++){v=q[g];if(!v.category||-1!==d.indexOf(v.category)){y=c.getAttributeLocationByName(v.attributeName),x=new b.InstancingAttributeInfo();x.index=y;x.attributeSize=v.size/4;x.offset=4*v.instanceOffset.get(f);x.attributeName=v.attributeName;e.push(x);}}j=j._baseInfo;}y4tt.v9();return e;},c.prototype.getShaderAttributes=function(b){var j;for(var c=[],d=this;d;){for(var f=0,e=d._attributes;f<e.length;f++){j=e[f];j.category&&-1===b.indexOf(j.category)||c.push(j.attributeName);}d=d._baseInfo;}y4tt.q9();return c;},c.prototype._getBaseOffset=function(b){for(var c=0,d=this._baseInfo;d;)c+=d._nextOffset.getOrAdd(b,0),d=d._baseInfo;y4tt.v9();return c;},c);b.InstanceClassInfo=e;f=function(){this.instanceOffset=new b.StringDictionary();};d=(f.prototype.setSize=function(c){if(c instanceof b.Vector2)return this.size=8,void(this.dataType=0);if(c instanceof b.Vector3)return this.size=12,void(this.dataType=1);if(c instanceof b.Vector4)return this.size=16,void(this.dataType=2);if(c instanceof b.Matrix)throw Error("Matrix type is not supported by WebGL Instance Buffer, you have to use four Vector4 properties instead");return"number"==typeof c?(this.size=4,void(this.dataType=4)):c instanceof b.Color3?(this.size=12,void(this.dataType=5)):c instanceof b.Color4?(this.size=16,void(this.dataType=6)):c instanceof b.Size?(this.size=8,void(this.dataType=7)):void 0;},f.prototype.writeData=function(b,c,d){y4tt.v9();switch(this.dataType){case 0:b[c+0]=d.x;b[c+1]=d.y;break;case 1:b[c+0]=d.x;b[c+1]=d.y;b[c+2]=d.z;break;case 2:b[c+0]=d.x;b[c+1]=d.y;b[c+2]=d.z;b[c+3]=d.w;break;case 5:b[c+0]=d.r;b[c+1]=d.g;b[c+2]=d.b;break;case 6:b[c+0]=d.r;b[c+1]=d.g;b[c+2]=d.b;b[c+3]=d.a;break;case 4:b[c]=d;break;case 3:for(var f=0;16>f;f++)b[c+f]=d.m[f];break;case 7:b[c+0]=d.width,b[c+1]=d.height;}},f);b.InstancePropInfo=d;b.instanceData=g;f=function(b,c){this.id=b;y4tt.q9();this.curElement=0;this.dataElementCount=c;};f=(Object.defineProperty(f.prototype,"zBias",{get:function(){y4tt.v9();return null;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"transformX",{get:function(){y4tt.v9();return null;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"transformY",{get:function(){return null;},enumerable:!0,configurable:!0}),f.prototype.getClassTreeInfo=function(){return this.typeInfo||(this.typeInfo=b.ClassTreeInfo.get(Object.getPrototypeOf(this))),this.typeInfo;},f.prototype.allocElements=function(){if(this.dataBuffer){for(var b=Array(this.dataElementCount),c=0;c<this.dataElementCount;c++)b[c]=this.dataBuffer.allocElement();this.dataElements=b;}},f.prototype.freeElements=function(){if(this.dataElements){for(var b=0,c=this.dataElements;b<c.length;b++)this.dataBuffer.freeElement(c[b]);this.dataElements=null;}},Object.defineProperty(f.prototype,"dataElementCount",{get:function(){y4tt.q9();return this._dataElementCount;},set:function(b){b!==this._dataElementCount&&(this.freeElements(),this._dataElementCount=b,this.allocElements());},enumerable:!0,configurable:!0}),__decorate([g()],f.prototype,"zBias",null),__decorate([g()],f.prototype,"transformX",null),__decorate([g()],f.prototype,"transformY",null),f);b.InstanceDataBase=f;q=b.Prim2DBase,j=function(b){q.call(this,b);this._isAlphaTest=this._isTransparent=!1;this._transparentPrimitiveInfo=null;},f=(__extends(j,q),Object.defineProperty(j.prototype,"isAlphaTest",{get:function(){y4tt.q9();return this._isAlphaTest;},set:function(b){y4tt.q9();this._isAlphaTest=b;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"isTransparent",{get:function(){y4tt.q9();return this._isTransparent;},set:function(b){this._isTransparent=b;},enumerable:!0,configurable:!0}),j.prototype.dispose=function(){return q.prototype.dispose.call(this)?(this._transparentPrimitiveInfo&&(this.renderGroup._renderableData.removeTransparentPrimitiveInfo(this._transparentPrimitiveInfo),this._transparentPrimitiveInfo=null),this._modelRenderInstanceID&&(this._modelRenderCache.removeInstanceData(this._modelRenderInstanceID),this._modelRenderInstanceID=null),this._modelRenderCache&&(this._modelRenderCache.dispose(),this._modelRenderCache=null),this._instanceDataParts&&(this._instanceDataParts.forEach(function(b){b.freeElements();}),this._instanceDataParts=null),!0):!1;},j.prototype._prepareRenderPre=function(c){var d,f,e;q.prototype._prepareRenderPre.call(this,c);this._isFlagSet(b.SmartPropertyPrim.flagModelDirty)&&this._modelRenderInstanceID&&(this._modelRenderCache.removeInstanceData(this._modelRenderInstanceID),this._modelRenderInstanceID=null);d=!1;this._modelRenderCache&&!this._isFlagSet(b.SmartPropertyPrim.flagModelDirty)||(d=this._createModelRenderCache());f=null,e=!1;this._modelRenderInstanceID||(e=!0,f=this._createModelDataParts());d&&this.setupModelRenderCache(this._modelRenderCache);(this._isFlagSet(b.SmartPropertyPrim.flagVisibilityChanged)||c.forceRefreshPrimitive||e||0!==this._instanceDirtyFlags||this._globalTransformProcessStep!==this._globalTransformStep)&&(this.isTransparent,this._updateInstanceDataParts(f));},j.prototype._createModelRenderCache=function(){var c,d;c=this,d=!1;y4tt.v9();return this._modelRenderCache&&this._modelRenderCache.dispose(),this._modelRenderCache=this.owner._engineData.GetOrAddModelCache(this.modelKey,function(b){y4tt.v9();b=c.createModelRenderCache(b);return d=!0,b;}),this._clearFlags(b.SmartPropertyPrim.flagModelDirty),d||this._modelRenderCache.addRef(),d;},j.prototype._createModelDataParts=function(){var c,d,g;c=this,d=this.createInstanceDataParts();this._instanceDataParts=d;this._modelRenderCache._partData||this._setupModelRenderCache(d);for(var f=this.renderGroup._renderableData._renderGroupInstancesInfo.getOrAddWithFactory(this.modelKey,function(){var e;y4tt.v9();for(var d=new b.GroupInstanceInfo(c.renderGroup,c._modelRenderCache,c._modelRenderCache._partData.length),f=0;f<c._modelRenderCache._partData.length;f++){e=c._instanceDataParts[f];d.partIndexFromId.add(e.id.toString(),f);d.usedShaderCategories[f]=((7205,728.79)>5250?(!"",!1):";")+c.getUsedShaderCategories(e).join(";")+";";d.strides[f]=c._modelRenderCache._partData[f]._partDataStride;}return d;}),e=null,e=this.isTransparent?f.transparentData:this.isAlphaTest?f.alphaTestData:f.opaqueData,j=0;j<d.length;j++){g=d[j];g.dataBuffer=e[j]._partData;g.allocElements();}return this._modelRenderInstanceID=this._modelRenderCache.addInstanceDataParts(this._instanceDataParts),f;},j.prototype._setupModelRenderCache=function(c){var d,j,g,q,t,v,y,x,z;d=[];this._modelRenderCache._partData=[];y4tt.q9();for(var f=0;f<c.length;f++){j=c[f],g=new b.ModelRenderCachePartData();this._modelRenderCache._partData.push(g);q=this.getUsedShaderCategories(j),t=j.getClassTreeInfo(),v=this.isVisible;this.isVisible=!0;y=";"+q.join(";")+";";g._partJoinedUsedCategories=y;e._CurCategories=y;x=this.beforeRefreshForLayoutConstruction(j);this.refreshInstanceDataPart(j);this.afterRefreshForLayoutConstruction(j,x);this.isVisible=v;z=0;t.fullContent.forEach(function(c,d){y4tt.q9();d.category&&-1===q.indexOf(d.category)||("zBias"===d.attributeName&&(g._zBiasOffset=d.instanceOffset.get(y)),d.size?z+=d.size:console.log("ERROR: Couldn't detect the size of the Property "+d.attributeName+" from type "+b.Tools.getClassName(t.type)+". Property is ignored."));});g._partDataStride=z;g._partUsedCategories=q;g._partId=j.id;d.push(t);}this._modelRenderCache._partsClassInfo=d;},j.prototype.onZOrderChanged=function(){this.isTransparent&&this._transparentPrimitiveInfo&&(this.renderGroup._renderableData.transparentPrimitiveZChanged(this._transparentPrimitiveInfo),this.renderGroup._renderableData._renderGroupInstancesInfo.get(this.modelKey).transparentOrderDirty=!0);},j.prototype._updateInstanceDataParts=function(c){var j;c||(c=this.renderGroup._renderableData._renderGroupInstancesInfo.get(this.modelKey));this.isTransparent&&this._isFlagSet(b.SmartPropertyPrim.flagVisibilityChanged)&&(this.isVisible?this._transparentPrimitiveInfo||(this._transparentPrimitiveInfo=this.renderGroup._renderableData.addNewTransparentPrimitiveInfo(this,c)):this._transparentPrimitiveInfo&&(this.renderGroup._renderableData.removeTransparentPrimitiveInfo(this._transparentPrimitiveInfo),this._transparentPrimitiveInfo=null),c.transparentOrderDirty=!0);for(var d=0,f=this._instanceDataParts;d<f.length;d++){j=f[d];this._isFlagSet(b.SmartPropertyPrim.flagVisibilityChanged)&&!j.dataElements&&j.allocElements();e._CurCategories=c.usedShaderCategories[c.partIndexFromId.get(j.id.toString())];this.refreshInstanceDataPart(j)||j.dataElements&&j.freeElements();}this._instanceDirtyFlags=0;this.isTransparent?c.transparentDirty=!0:this.isAlphaTest?c.alphaTestDirty=!0:c.opaqueDirty=!0;this._clearFlags(b.SmartPropertyPrim.flagVisibilityChanged);},j.prototype._getFirstIndexInDataBuffer=function(){var d;y4tt.v9();for(var b=0,c=this._instanceDataParts;b<c.length;b++){d=c[b];if(d)return d.dataElements[0].offset/d.dataBuffer.stride;}return null;},j.prototype._getLastIndexInDataBuffer=function(){var d;y4tt.v9();for(var b=0,c=this._instanceDataParts;b<c.length;b++){d=c[b];if(d)return d.dataElements[d.dataElements.length-1].offset/d.dataBuffer.stride;}return null;},j.prototype._getNextPrimZOrder=function(){var d,b,f;for(var b=this._instanceDataParts.length,c=0;b>c;c++){d=this._instanceDataParts[c];if(d){b=d.dataBuffer.stride,f=d.dataElements[d.dataElements.length-1].offset;return d.dataBuffer.totalElementCount*b<=f?null:d.dataBuffer[f+b+this.modelRenderCache._partData[c]._zBiasOffset];}}y4tt.v9();return null;},j.prototype._getPrevPrimZOrder=function(){var d,b,f;for(var b=this._instanceDataParts.length,c=0;b>c;c++){d=this._instanceDataParts[c];if(d){b=d.dataBuffer.stride,f=d.dataElements[0].offset;return 0===f?null:d.dataBuffer[f-b+this.modelRenderCache._partData[c]._zBiasOffset];}}y4tt.v9();return null;},j.prototype.transformPointWithOriginByRef=function(b,c,d){var f;f=this.actualSize;d.x=b.x-(this.origin.x+(c?c.x:0))*f.width;d.y=b.y-(this.origin.y+(c?c.y:0))*f.height;},j.prototype.transformPointWithOriginToRef=function(b,c,d){y4tt.v9();return this.transformPointWithOriginByRef(b,c,d),d;},j.prototype.getDataPartEffectInfo=function(c,d,f){var e,j,g;void 0===f&&(f=null);e=b.Tools.first(this._instanceDataParts,function(b){return b.id===c;});if(!e)return null;j=this.owner.supportInstancedArray;y4tt.v9();if(null!=f){if(f&&!1===j)return null;j=f;}f=e.getClassTreeInfo();e=this.getUsedShaderCategories(e);f=f.classContent.getShaderAttributes(e);g="";return e.forEach(function(b){y4tt.q9();g+="#define "+b+"\n";}),j&&(g+="#define Instanced\n"),{attributes:j?d.concat(f):d,uniforms:j?[]:f,defines:g};},Object.defineProperty(j.prototype,"modelRenderCache",{get:function(){return this._modelRenderCache;},enumerable:!0,configurable:!0}),j.prototype.createModelRenderCache=function(){return null;},j.prototype.setupModelRenderCache=function(){},j.prototype.createInstanceDataParts=function(){return null;},j.prototype.getUsedShaderCategories=function(){return[];},j.prototype.beforeRefreshForLayoutConstruction=function(){},j.prototype.afterRefreshForLayoutConstruction=function(){},j.prototype.refreshInstanceDataPart=function(b){return this.isVisible?(b.isVisible=this.isVisible,1===b.dataElementCount&&(b.curElement=0,this.updateInstanceDataPart(b)),!0):!1;},j.prototype.updateInstanceDataPart=function(c,d){var f,e,j,g,q,v,y;void 0===d&&(d=null);f=this._globalTransform.multiply(this.renderGroup.invGlobalTransform),e=this.renderGroup.viewportSize,j=this.actualZOffset,g=0,q=0;d&&(g=d.x*f.m[0]+d.y*f.m[4],q=d.x*f.m[1]+d.y*f.m[5]);y4tt.v9();v=e.width,y=e.height,e=1/j,g=new b.Vector4(2*f.m[0]/v,2*f.m[4]/v,0,2*(f.m[12]+g)/v-1),f=new b.Vector4(2*f.m[1]/y,2*f.m[5]/y,0,2*(f.m[13]+q)/y-1);c.transformX=g;c.transformY=f;c.zBias=new b.Vector2(j,e);},j.RENDERABLEPRIM2D_PROPCOUNT=b.Prim2DBase.PRIM2DBASE_PROPCOUNT+5,__decorate([b.dynamicLevelProperty(b.Prim2DBase.PRIM2DBASE_PROPCOUNT+0,function(b){return j.isAlphaTestProperty=b;})],j.prototype,"isAlphaTest",null),__decorate([b.dynamicLevelProperty(b.Prim2DBase.PRIM2DBASE_PROPCOUNT+1,function(b){y4tt.v9();return j.isTransparentProperty=b;})],j.prototype,"isTransparent",null),j=__decorate([b.className("RenderablePrim2D")],j));b.RenderablePrim2D=f;function g(c,f){y4tt.v9();return function(j,g,q){var s,t;s=b.ClassTreeInfo.getOrRegister(j,function(b){return new e(b);}).getLevelOf(j);f=f||g;y4tt.q9();t=s.levelContent.get(g);if(t)throw Error("The ID "+g+" is already taken by another instance data");t=new d();t.attributeName=f;t.category=c||null;t.category&&(t.delimitedCategory=";"+t.category+";");s.levelContent.add(g,t);q.get=function(){y4tt.q9();return null;};q.set=function(b){var c;y4tt.q9();if(!t.category||-1!==e._CurCategories.indexOf(t.delimitedCategory))if(t.size?t.instanceOffset.contains(e._CurCategories)||s.classContent.mapProperty(t,!1):(t.setSize(b),s.classContent.mapProperty(t,!0)),this.dataBuffer&&this.dataElements){c=this.dataElements[this.curElement].offset+t.instanceOffset.get(e._CurCategories);t.writeData(this.dataBuffer.buffer,c,b);}};};}}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f;e=b.RenderablePrim2D,c=function(c){var d,f;e.call(this,c);c||(c={});d=null;c.border&&(d="string"==typeof c.border?b.Canvas2D.GetBrushFromString(c.border):c.border);f=null;c.fill&&(f="string"==typeof c.fill?b.Canvas2D.GetBrushFromString(c.fill):c.fill);this.border=d;this.fill=f;this.borderThickness=c.borderThickness;};g=(__extends(c,e),Object.defineProperty(c.prototype,"border",{get:function(){return this._border;},set:function(b){this._border=b;this._updateTransparencyStatus();},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"fill",{get:function(){return this._fill;},set:function(b){this._fill=b;this._updateTransparencyStatus();},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"borderThickness",{get:function(){return this._borderThickness;},set:function(b){y4tt.v9();this._borderThickness=b;},enumerable:!0,configurable:!0}),c.prototype.getUsedShaderCategories=function(d){var f,l;f=e.prototype.getUsedShaderCategories.call(this,d);if(d.id===c.SHAPE2D_FILLPARTID){l=this.fill;l instanceof b.SolidColorBrush2D&&f.push(c.SHAPE2D_CATEGORY_FILLSOLID);l instanceof b.GradientColorBrush2D&&f.push(c.SHAPE2D_CATEGORY_FILLGRADIENT);}d.id===c.SHAPE2D_BORDERPARTID&&(f.push(c.SHAPE2D_CATEGORY_BORDER),d=this.border,d instanceof b.SolidColorBrush2D&&f.push(c.SHAPE2D_CATEGORY_BORDERSOLID),d instanceof b.GradientColorBrush2D&&f.push(c.SHAPE2D_CATEGORY_BORDERGRADIENT));y4tt.q9();return f;},c.prototype.refreshInstanceDataPart=function(d){var f;if(!e.prototype.refreshInstanceDataPart.call(this,d))return!1;if(d.id===c.SHAPE2D_FILLPARTID){if(this.fill){f=this.fill;f instanceof b.SolidColorBrush2D?d.fillSolidColor=f.color:f instanceof b.GradientColorBrush2D&&(d.fillGradientColor1=f.color1,d.fillGradientColor2=f.color2,f=b.Matrix.Compose(new b.Vector3(f.scale,f.scale,f.scale),b.Quaternion.RotationAxis(new b.Vector3(0,0,1),f.rotation),new b.Vector3(f.translation.x,f.translation.y,0)),f=new b.Vector4(f.m[1],f.m[5],f.m[9],f.m[13]),d.fillGradientTY=f);}}else d.id===c.SHAPE2D_BORDERPARTID&&this.border&&(d.borderThickness=this.borderThickness,f=this.border,f instanceof b.SolidColorBrush2D?d.borderSolidColor=f.color:f instanceof b.GradientColorBrush2D&&(d.borderGradientColor1=f.color1,d.borderGradientColor2=f.color2,f=b.Matrix.Compose(new b.Vector3(f.scale,f.scale,f.scale),b.Quaternion.RotationAxis(new b.Vector3(0,0,1),f.rotation),new b.Vector3(f.translation.x,f.translation.y,0)),f=new b.Vector4(f.m[1],f.m[5],f.m[9],f.m[13]),d.borderGradientTY=f));return!0;},c.prototype._updateTransparencyStatus=function(){y4tt.v9();this.isTransparent=this._border&&this._border.isTransparent()||this._fill&&this._fill.isTransparent();},c.SHAPE2D_BORDERPARTID=1,c.SHAPE2D_FILLPARTID=2,c.SHAPE2D_CATEGORY_BORDER="Border",c.SHAPE2D_CATEGORY_BORDERSOLID="BorderSolid",c.SHAPE2D_CATEGORY_BORDERGRADIENT="BorderGradient",c.SHAPE2D_CATEGORY_FILLSOLID="FillSolid",c.SHAPE2D_CATEGORY_FILLGRADIENT="FillGradient",c.SHAPE2D_PROPCOUNT=b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+5,__decorate([b.modelLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,function(b){y4tt.v9();return c.borderProperty=b;},!0)],c.prototype,"border",null),__decorate([b.modelLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(b){return c.fillProperty=b;},!0)],c.prototype,"fill",null),__decorate([b.instanceLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(b){y4tt.q9();return c.borderThicknessProperty=b;})],c.prototype,"borderThickness",null),c=__decorate([b.className("Shape2D")],c));b.Shape2D=g;d=b.InstanceDataBase,f=function(){y4tt.v9();d.apply(this,arguments);};g=(__extends(f,d),Object.defineProperty(f.prototype,"fillSolidColor",{get:function(){y4tt.q9();return null;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"fillGradientColor1",{get:function(){y4tt.v9();return null;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"fillGradientColor2",{get:function(){y4tt.q9();return null;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"fillGradientTY",{get:function(){y4tt.q9();return null;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"borderThickness",{get:function(){y4tt.v9();return null;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"borderSolidColor",{get:function(){y4tt.q9();return null;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"borderGradientColor1",{get:function(){y4tt.v9();return null;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"borderGradientColor2",{get:function(){return null;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"borderGradientTY",{get:function(){return null;},enumerable:!0,configurable:!0}),__decorate([b.instanceData(g.SHAPE2D_CATEGORY_FILLSOLID)],f.prototype,"fillSolidColor",null),__decorate([b.instanceData(g.SHAPE2D_CATEGORY_FILLGRADIENT)],f.prototype,"fillGradientColor1",null),__decorate([b.instanceData(g.SHAPE2D_CATEGORY_FILLGRADIENT)],f.prototype,"fillGradientColor2",null),__decorate([b.instanceData(g.SHAPE2D_CATEGORY_FILLGRADIENT)],f.prototype,"fillGradientTY",null),__decorate([b.instanceData(g.SHAPE2D_CATEGORY_BORDER)],f.prototype,"borderThickness",null),__decorate([b.instanceData(g.SHAPE2D_CATEGORY_BORDERSOLID)],f.prototype,"borderSolidColor",null),__decorate([b.instanceData(g.SHAPE2D_CATEGORY_BORDERGRADIENT)],f.prototype,"borderGradientColor1",null),__decorate([b.instanceData(g.SHAPE2D_CATEGORY_BORDERGRADIENT)],f.prototype,"borderGradientColor2",null),__decorate([b.instanceData(g.SHAPE2D_CATEGORY_BORDERGRADIENT)],f.prototype,"borderGradientTY",null),f);b.Shape2DInstanceData=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f;e=b.Prim2DBase,c=function(d){var f;null==d&&(d={});null==d.origin&&(d.origin=new b.Vector2(0,0));e.call(this,d);f=d.size||d.width||d.height?d.size||new b.Size(d.width||0,d.height||0):null;(this._trackedNode=null==d.trackNode?null:d.trackNode)&&this.owner&&this.owner._registerTrackedNode(this);this._cacheBehavior=null==d.cacheBehavior?c.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY:d.cacheBehavior;y4tt.q9();this.size=f;this._viewportPosition=b.Vector2.Zero();};g=(__extends(c,e),c._createCachedCanvasGroup=function(d){y4tt.q9();return new c({parent:d,id:"__cachedCanvasGroup__",position:b.Vector2.Zero(),origin:b.Vector2.Zero(),size:null,isVisible:!0});},c.prototype.applyCachedTexture=function(c,d){if(this._bindCacheTarget(),c)for(var f=c.uvs,e=this._renderableData._cacheNode.UVs,g=0;4>g;g++)f[2*g+0]=e[g].x,f[2*g+1]=e[g].y;d&&(d.diffuseTexture=this._renderableData._cacheTexture,d.emissiveColor=new b.Color3(1,1,1));this._renderableData._cacheTexture.hasAlpha=!0;this._unbindCacheTarget();},Object.defineProperty(c.prototype,"cachedRect",{get:function(){return this._renderableData?this._renderableData._cacheNode:null;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"cacheTexture",{get:function(){y4tt.v9();return this._renderableData?this._renderableData._cacheTexture:null;},enumerable:!0,configurable:!0}),c.prototype.dispose=function(){y4tt.q9();return e.prototype.dispose.call(this)?(null!=this._trackedNode&&(this.owner._unregisterTrackedNode(this),this._trackedNode=null),this._renderableData&&(this._renderableData.dispose(),this._renderableData=null),!0):!1;},Object.defineProperty(c.prototype,"isRenderableGroup",{get:function(){return this._isRenderableGroup;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isCachedGroup",{get:function(){return this._isCachedGroup;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"size",{get:function(){y4tt.v9();return this._size;},set:function(b){y4tt.q9();this._size=b;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"viewportSize",{get:function(){return this._viewportSize;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"actualSize",{get:function(){var d;this._size?d=new b.Size(Math.ceil(this._size.width),Math.ceil(this._size.height)):(d=this.boundingInfo.max(),d=new b.Size(Math.ceil(d.x),Math.ceil(d.y)));y4tt.q9();return d.equals(this._actualSize)||(this.onPrimitivePropertyDirty(c.actualSizeProperty.flagId),this._actualSize=d,this.handleGroupChanged(c.actualSizeProperty)),d;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"cacheBehavior",{get:function(){return this._cacheBehavior;},enumerable:!0,configurable:!0}),c.prototype._addPrimToDirtyList=function(b){this._renderableData._primDirtyList.push(b);},c.prototype._renderCachedCanvas=function(){var c;this.updateCachedStates(!0);c=new b.PrepareRender2DContext();this._prepareGroupRender(c);this._groupRender();},Object.defineProperty(c.prototype,"trackedNode",{get:function(){y4tt.v9();return this._trackedNode;},set:function(c){null!=c?(this._isFlagSet(b.SmartPropertyPrim.flagTrackedGroup)||this.owner._registerTrackedNode(this),this._trackedNode=c):(this._isFlagSet(b.SmartPropertyPrim.flagTrackedGroup)&&this.owner._unregisterTrackedNode(this),this._trackedNode=null);},enumerable:!0,configurable:!0}),c.prototype.levelIntersect=function(){y4tt.q9();return!0;},c.prototype.updateLevelBoundingInfo=function(){var c;c=this.size?this.size:new b.Size(0,0);b.BoundingInfo2D.CreateFromSizeToRef(c,this._levelBoundingInfo);},c.prototype._prepareGroupRender=function(c){var d,f,e,g;d=null;if((0<this._renderableData._primDirtyList.length||c.forceRefreshPrimitive)&&(d=this._renderableData._primDirtyList.sort(function(b,c){return b.hierarchyDepth-c.hierarchyDepth;}),this.updateCachedStatesOf(d,!0)),this._isCachedGroup){f=this.actualSize.clone();f.equals(this._viewportSize)||(c.forceRefreshPrimitive=!0);this._viewportSize=f;}else{e=this._globalTransform.getTranslation(),f=this.actualSize.clone(),g=this.owner._renderingSize;f.height=Math.min(f.height,g.height-e.y);f.width=Math.min(f.width,g.width-e.x);g=e.y;this._viewportPosition.x=e.x;this._viewportPosition.y=g;e=f.width;f=f.height;this._viewportSize?(this._viewportSize.width===e&&this._viewportSize.height===f||(c.forceRefreshPrimitive=!0),this._viewportSize.width=e,this._viewportSize.height=f):this._viewportSize=new b.Size(e,f);}if(0<this._renderableData._primDirtyList.length||c.forceRefreshPrimitive)if(this._cacheGroupDirty=this._isCachedGroup,c.forceRefreshPrimitive){d=0;for(f=this._children;d<f.length;d++)f[d]._prepareRender(c);}else d||(d=this._renderableData._primDirtyList.sort(function(b,c){y4tt.q9();return b.hierarchyDepth-c.hierarchyDepth;})),d.forEach(function(b){y4tt.q9();!b.isDisposed&&b._needPrepare()&&b._prepareRender(c);}),this._renderableData._primDirtyList.forEach(function(b){return b._resetPropertiesDirty();}),this._renderableData._primDirtyList.splice(0);this._renderableData._childrenRenderableGroups.forEach(function(b){b._prepareGroupRender(c);});},c.prototype._groupRender=function(){var p,r;for(var c=this,d=this.owner.engine,f=0,e=0,g=this._renderableData._childrenRenderableGroups;e<g.length;e++)g[e]._groupRender();if(!this.isCachedGroup||this._cacheGroupDirty){if(this.isCachedGroup)this._bindCacheTarget();else p=d.setDirectViewport(this._viewportPosition.x,this._viewportPosition.y,this._viewportSize.width,this._viewportSize.height);e=!0===d.getAlphaTesting();g=!0===d.getDepthWrite();d.setAlphaTesting(!1);d.setDepthWrite(!0);r=new b.Render2DContext(b.Render2DContext.RenderModeOpaque);this._renderableData._renderGroupInstancesInfo.forEach(function(b,e){var g;g=c._prepareContext(d,r,e);if(null!==g&&(!c.owner.supportInstancedArray||0<g))g=!e.modelRenderCache.render(e,r),e.opaqueDirty=g,f+=g?1:0;});d.setAlphaTesting(!0);d.setDepthWrite(!0);r=new b.Render2DContext(b.Render2DContext.RenderModeAlphaTest);this._renderableData._renderGroupInstancesInfo.forEach(function(b,e){var g;g=c._prepareContext(d,r,e);if(null!==g&&(!c.owner.supportInstancedArray||0<g))g=!e.modelRenderCache.render(e,r),e.opaqueDirty=g,f+=g?1:0;});d.setAlphaTesting(!0);d.setDepthWrite(!1);this._renderableData._transparentListChanged&&this._updateTransparentData();f+=this._renderTransparentData();this._cacheGroupDirty=0!==f;this.isCachedGroup?this._unbindCacheTarget():p&&d.setViewport(p);d.setAlphaTesting(e);d.setDepthWrite(g);}},c.prototype._updateTransparentData=function(){var c,e,g,p;c=this._renderableData;y4tt.v9();if(null!==c._firstChangedPrim){c._transparentPrimitives.sort(function(b,c){y4tt.v9();return c._primitive.actualZOffset-b._primitive.actualZOffset;});c._transparentSegments.splice(0);for(var d=null,f=0;f<c._transparentPrimitives.length;f++){e=c._transparentPrimitives[f];e._groupInstanceInfo.transparentOrderDirty&&e._groupInstanceInfo.sortTransparentData();e._transparentSegment=null;if(d){g=c._transparentPrimitives[f];if(d.groupInsanceInfo===g._groupInstanceInfo){p=g._primitive.actualZOffset;g._transparentSegment=d;p<d.endZ&&(d.endZ=p,d.endDataIndex=g._primitive._getLastIndexInDataBuffer()+1);}}e._transparentSegment||(d=new b.TransparentSegment(),d.groupInsanceInfo=e._groupInstanceInfo,g=e._primitive,d.startZ=g.actualZOffset,d.startDataIndex=g._getFirstIndexInDataBuffer(),d.endDataIndex=g._getLastIndexInDataBuffer()+1,d.endZ=d.startZ,e._transparentSegment=d,c._transparentSegments.push(d));d=e._transparentSegment;}c._firstChangedPrim=null;c._transparentListChanged=!1;}},c.prototype._renderTransparentData=function(){var p,r,s;for(var c=0,d=new b.Render2DContext(b.Render2DContext.RenderModeTransparent),f=this._renderableData,e=f._transparentSegments.length,g=0;e>g;g++){p=f._transparentSegments[g],r=p.groupInsanceInfo,s=r.modelRenderCache;d.useInstancing=!1;d.partDataStartIndex=p.startDataIndex;d.partDataEndIndex=p.endDataIndex;d.groupInfoPartData=r.transparentData;p=!s.render(r,d);c+=p?1:0;}y4tt.q9();return c;},c.prototype._prepareContext=function(c,d,f){var e,g,p,r,t,v;p=null;switch(d.renderMode){case b.Render2DContext.RenderModeOpaque:if(!f.hasOpaqueData)return null;e=function(b){y4tt.v9();f.opaqueDirty=b;};g=function(){y4tt.v9();return f.opaqueDirty;};p=d.groupInfoPartData=f.opaqueData;break;case b.Render2DContext.RenderModeAlphaTest:if(!f.hasAlphaTestData)return null;e=function(b){y4tt.q9();f.alphaTestDirty=b;};g=function(){y4tt.q9();return f.alphaTestDirty;};p=d.groupInfoPartData=f.alphaTestData;break;default:throw Error("_prepareContext is only for opaque or alphaTest");}r=0;if(this.owner.supportInstancedArray){d.useInstancing=!0;for(var s=0;s<p.length;s++){d=p[s];t=d._partData,v=t.pack(),r=r+t.usedElementCount,t=4*t.usedElementCount*t.stride;!d._partBuffer||d._partBufferSize<t?(d._partBuffer&&c.deleteInstancesBuffer(d._partBuffer),d._partBuffer=c.createInstancesBuffer(t),d._partBufferSize=t,e(!1),c.updateArrayBuffer(v)):g()&&(c.bindArrayBuffer(d._partBuffer),c.updateArrayBuffer(v));}e(!1);}else{for(s=d.partDataStartIndex=0;!d.groupInfoPartData[s];)s++;d.partDataEndIndex=d.groupInfoPartData[s]._partData.usedElementCount;}return r;},c.prototype._bindCacheTarget=function(){var c,d,f,e,g,p;f=this._renderableData;if(f._cacheNode){e=f._cacheNode.contentSize,g=Math.ceil(this.actualSize.width),p=Math.ceil(this.actualSize.height);(e.width<g||e.height<p)&&(c=Math.floor(1.07*e.width),d=Math.floor(1.07*e.height),f._cacheTexture.freeRect(f._cacheNode),f._cacheNode=null);}f._cacheNode||(c=this.owner._allocateGroupCache(this,this.renderGroup,c?new b.Size(c,d):null),f._cacheNode=c.node,f._cacheTexture=c.texture,f._cacheRenderSprite=c.sprite);f._cacheTexture.bindTextureForPosSize(f._cacheNode.pos,this.actualSize,!0);},c.prototype._unbindCacheTarget=function(){y4tt.q9();this._renderableData._cacheTexture&&this._renderableData._cacheTexture.unbindTexture();},c.prototype.handleGroupChanged=function(d){var f;f=this._renderableData;this.isCachedGroup&&f._cacheRenderSprite&&(d.id===b.Prim2DBase.actualPositionProperty.id?f._cacheRenderSprite.actualPosition=this.actualPosition.clone():d.id===b.Prim2DBase.rotationProperty.id?f._cacheRenderSprite.rotation=this.rotation:d.id===b.Prim2DBase.scaleProperty.id?f._cacheRenderSprite.scale=this.scale:d.id===b.Prim2DBase.originProperty.id?f._cacheRenderSprite.origin=this.origin.clone():d.id===c.actualSizeProperty.id&&(f._cacheRenderSprite.size=this.actualSize.clone()));},c.prototype.detectGroupStates=function(){var f,e;f=this instanceof b.Canvas2D,e=this.owner.cachingStrategy;e===b.Canvas2D.CACHESTRATEGY_DONTCACHE?(this._isRenderableGroup=f,this._isCachedGroup=!1):e===b.Canvas2D.CACHESTRATEGY_CANVAS?f?(this._isRenderableGroup=!0,this._isCachedGroup=!0):(this._isRenderableGroup="__cachedCanvasGroup__"===this.id,this._isCachedGroup=!1):e===b.Canvas2D.CACHESTRATEGY_TOPLEVELGROUPS?f?(this._isRenderableGroup=!0,this._isCachedGroup=!1):1===this.hierarchyDepth?(this._isRenderableGroup=!0,this._isCachedGroup=!0):(this._isRenderableGroup=!1,this._isCachedGroup=!1):e===b.Canvas2D.CACHESTRATEGY_ALLGROUPS&&(f=this.cacheBehavior,f!==c.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE&&f!==c.GROUPCACHEBEHAVIOR_CACHEINPARENTGROUP||(this._isRenderableGroup=f===c.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE,this._isCachedGroup=!1),f===c.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY&&(this._isRenderableGroup=!0,this._isCachedGroup=!0));if(this._isRenderableGroup&&(this._renderableData||(this._renderableData=new d())),this._isCachedGroup)for(f=this.parent;f;){if(f instanceof c&&f._isRenderableGroup){-1===f._renderableData._childrenRenderableGroups.indexOf(this)&&f._renderableData._childrenRenderableGroups.push(this);break;}f=f.parent;}},c.GROUP2D_PROPCOUNT=b.Prim2DBase.PRIM2DBASE_PROPCOUNT+5,c.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY=0,c.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE=1,c.GROUPCACHEBEHAVIOR_CACHEINPARENTGROUP=2,__decorate([b.instanceLevelProperty(b.Prim2DBase.PRIM2DBASE_PROPCOUNT+1,function(b){y4tt.q9();return c.sizeProperty=b;},!1,!0)],c.prototype,"size",null),__decorate([b.instanceLevelProperty(b.Prim2DBase.PRIM2DBASE_PROPCOUNT+2,function(b){return c.actualSizeProperty=b;})],c.prototype,"actualSize",null),c=__decorate([b.className("Group2D")],c));b.Group2D=g;g=function(){this._primDirtyList=[];this._childrenRenderableGroups=[];this._renderGroupInstancesInfo=new b.StringDictionary();this._transparentPrimitives=[];this._transparentSegments=[];this._firstChangedPrim=null;y4tt.v9();this._transparentListChanged=!1;this._cacheRenderSprite=this._cacheTexture=this._cacheNode=null;};d=(g.prototype.dispose=function(){this._cacheRenderSprite&&(this._cacheRenderSprite.dispose(),this._cacheRenderSprite=null);this._cacheTexture&&this._cacheNode&&(this._cacheTexture.freeRect(this._cacheNode),this._cacheTexture=null,this._cacheNode=null);this._primDirtyList&&(this._primDirtyList.splice(0),this._primDirtyList=null);this._renderGroupInstancesInfo&&(this._renderGroupInstancesInfo.forEach(function(b,c){y4tt.v9();c.dispose();}),this._renderGroupInstancesInfo=null);},g.prototype.addNewTransparentPrimitiveInfo=function(b,c){var d;d=new f();return d._primitive=b,d._groupInstanceInfo=c,d._transparentSegment=null,this._transparentPrimitives.push(d),this._transparentListChanged=!0,this.updateSmallestZChangedPrim(d),d;},g.prototype.removeTransparentPrimitiveInfo=function(b){var c;c=this._transparentPrimitives.indexOf(b);-1!==c&&(this._transparentPrimitives.splice(c,1),this._transparentListChanged=!0,this.updateSmallestZChangedPrim(b));},g.prototype.transparentPrimitiveZChanged=function(b){y4tt.v9();this._transparentListChanged=!0;this.updateSmallestZChangedPrim(b);},g.prototype.updateSmallestZChangedPrim=function(b){b._primitive&&b._primitive.actualZOffset>(this._firstChangedPrim?this._firstChangedPrim._primitive.actualZOffset:Number.MIN_VALUE)&&(this._firstChangedPrim=b);},g);b.RenderableGroupData=d;f=function(){};b.TransparentPrimitiveInfo=f;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j;e=b.ModelRenderCache,c=function(b,c){e.call(this,b,c);this.effectsReady=!1;this.fillIB=this.fillVB=null;y4tt.v9();this.fillIndicesCount=0;this.borderIB=this.borderVB=this.effectFillInstanced=this.effectFill=this.instancingFillAttributes=null;this.borderIndicesCount=0;this.effectBorderInstanced=this.effectBorder=this.instancingBorderAttributes=null;};g=(__extends(c,e),c.prototype.render=function(c,d){var f,e,g,j,q,v;if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0;}f=c.owner.owner.engine,e=0;y4tt.v9();this.effectFill&&this.effectBorder&&(e=f.getDepthFunction(),f.setDepthFunctionToLessOrEqual());g=f.getAlphaMode();if(this.effectFill){j=c.partIndexFromId.get(b.Shape2D.SHAPE2D_FILLPARTID.toString()),q=d.groupInfoPartData[j];d.renderMode!==b.Render2DContext.RenderModeOpaque&&f.setAlphaMode(b.Engine.ALPHA_COMBINE);v=d.useInstancing?this.effectFillInstanced:this.effectFill;if(f.enableEffect(v),f.bindBuffersDirectly(this.fillVB,this.fillIB,[1],4,v),d.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(b.Shape2D.SHAPE2D_FILLPARTID,v)),f.updateAndBindInstancesBuffer(q._partBuffer,null,this.instancingFillAttributes),f.draw(!0,0,this.fillIndicesCount,q._partData.usedElementCount),f.unbindInstanceAttributes();else for(var y=d.partDataStartIndex;y<d.partDataEndIndex;y++)this.setupUniforms(v,j,q._partData,y),f.draw(!0,0,this.fillIndicesCount);}if(this.effectBorder)if(j=c.partIndexFromId.get(b.Shape2D.SHAPE2D_BORDERPARTID.toString()),q=d.groupInfoPartData[j],d.renderMode!==b.Render2DContext.RenderModeOpaque&&f.setAlphaMode(b.Engine.ALPHA_COMBINE),v=d.useInstancing?this.effectBorderInstanced:this.effectBorder,f.enableEffect(v),f.bindBuffersDirectly(this.borderVB,this.borderIB,[1],4,v),d.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(b.Shape2D.SHAPE2D_BORDERPARTID,v)),f.updateAndBindInstancesBuffer(q._partBuffer,null,this.instancingBorderAttributes),f.draw(!0,0,this.borderIndicesCount,q._partData.usedElementCount),f.unbindInstanceAttributes();else for(y=d.partDataStartIndex;y<d.partDataEndIndex;y++)this.setupUniforms(v,j,q._partData,y),f.draw(!0,0,this.borderIndicesCount);return f.setAlphaMode(g),this.effectFill&&this.effectBorder&&f.setDepthFunction(e),!0;},c.prototype.dispose=function(){return e.prototype.dispose.call(this)?(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0):!1;},c);b.Rectangle2DRenderCache=g;f=b.Shape2DInstanceData,c=function(b){y4tt.q9();f.call(this,b,1);};y4tt.v9();d=(__extends(c,f),Object.defineProperty(c.prototype,"properties",{get:function(){return null;},enumerable:!0,configurable:!0}),__decorate([b.instanceData()],c.prototype,"properties",null),c);b.Rectangle2DInstanceData=d;q=b.Shape2D,j=function(c){var d;y4tt.v9();if(null==c&&(c={}),q.call(this,c),null!=c.size)this.size=c.size;else if(c.width||c.height)this.size=new b.Size(c.width,c.height);d=null==c.borderThickness?1:c.borderThickness;this.roundRadius=null==c.roundRadius?0:c.roundRadius;this.borderThickness=d;},c=(__extends(j,q),Object.defineProperty(j.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size;},set:function(b){this._actualSize=b;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"notRounded",{get:function(){y4tt.q9();return this._notRounded;},set:function(b){this._notRounded=b;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"roundRadius",{get:function(){y4tt.v9();return this._roundRadius;},set:function(b){y4tt.v9();this._roundRadius=b;this.notRounded=0===b;this._positioningDirty();},enumerable:!0,configurable:!0}),j.prototype.levelIntersect=function(b){var c,d;if(this.notRounded)return!0;c=this.size;j._i0.x=b._localPickPosition.x;j._i0.y=b._localPickPosition.y;b=this.roundRadius;d=b*b;return j._i1.x=b,j._i1.y=b,j._i0.x<=j._i1.x&&j._i0.y<=j._i1.y?(j._i2.x=j._i0.x-j._i1.x,j._i2.y=j._i0.y-j._i1.y,j._i2.lengthSquared()<=d):(j._i1.x=b,j._i1.y=c.height-b,j._i0.x<=j._i1.x&&j._i0.y>=j._i1.y?(j._i2.x=j._i0.x-j._i1.x,j._i2.y=j._i0.y-j._i1.y,j._i2.lengthSquared()<=d):(j._i1.x=c.width-b,j._i1.y=c.height-b,j._i0.x>=j._i1.x&&j._i0.y>=j._i1.y?(j._i2.x=j._i0.x-j._i1.x,j._i2.y=j._i0.y-j._i1.y,j._i2.lengthSquared()<=d):(j._i1.x=c.width-b,j._i1.y=b,j._i0.x>=j._i1.x&&j._i0.y<=j._i1.y?(j._i2.x=j._i0.x-j._i1.x,j._i2.y=j._i0.y-j._i1.y,j._i2.lengthSquared()<=d):!0)));},j.prototype.updateLevelBoundingInfo=function(){b.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo);},j.prototype.createModelRenderCache=function(b){return new g(this.owner.engine,b);},j.prototype.setupModelRenderCache=function(c){var d,t,v;d=this.owner.engine;if(this.fill){for(var f=4*(this.notRounded?1:j.roundSubdivisions)+1,e=new Float32Array(f),g=0;f>g;g++)e[g]=g;c.fillVB=d.createVertexBuffer(e);f-=1;e=new Float32Array(3*f);for(g=0;f>g;g++)e[3*g+0]=0,e[3*g+2]=g+1,e[3*g+1]=g+2;e[3*f-2]=1;c.fillIB=d.createIndexBuffer(e);c.fillIndicesCount=3*f;(g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_FILLPARTID,["index"],!0))&&(c.effectFillInstanced=d.createEffect("rect2d",g.attributes,g.uniforms,[],g.defines,null));g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_FILLPARTID,["index"],!1);c.effectFill=d.createEffect("rect2d",g.attributes,g.uniforms,[],g.defines,null);}if(this.border){f=8*(this.notRounded?1:j.roundSubdivisions);e=new Float32Array(f);for(g=0;f>g;g++)e[g]=g;c.borderVB=d.createVertexBuffer(e);for(var q=f/2,e=new Float32Array(3*f),g=0;q>g;g++){t=g,v=(g+1)%q;e[6*g+0]=q+v;e[6*g+1]=q+t;e[6*g+2]=t;e[6*g+3]=v;e[6*g+4]=q+v;e[6*g+5]=t;}c.borderIB=d.createIndexBuffer(e);c.borderIndicesCount=3*f;(g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_BORDERPARTID,["index"],!0))&&(c.effectBorderInstanced=d.createEffect("rect2d",g.attributes,g.uniforms,[],g.defines,null));g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_BORDERPARTID,["index"],!1);c.effectBorder=d.createEffect("rect2d",g.attributes,g.uniforms,[],g.defines,null);}return c;},j.prototype._getInitialContentAreaToRef=function(b,c,d){var f;y4tt.v9();if(this._notRounded)q.prototype._getInitialContentAreaToRef.call(this,b,c,d);else{f=Math.round(1.3*(this.roundRadius-this.roundRadius/Math.sqrt(2)));c.x=c.y=f;d.width=Math.max(0,b.width-2*f);d.height=Math.max(0,b.height-2*f);}},j.prototype.createInstanceDataParts=function(){var c;y4tt.q9();c=[];return this.border&&c.push(new d(b.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&c.push(new d(b.Shape2D.SHAPE2D_FILLPARTID)),c;},j.prototype.refreshInstanceDataPart=function(c){var d;if(!q.prototype.refreshInstanceDataPart.call(this,c))return!1;if(c.id===b.Shape2D.SHAPE2D_BORDERPARTID){d=this.actualSize;c.properties=new b.Vector3(d.width,d.height,this.roundRadius||0);}else c.id===b.Shape2D.SHAPE2D_FILLPARTID&&(d=this.actualSize,c.properties=new b.Vector3(d.width,d.height,this.roundRadius||0));y4tt.q9();return!0;},j._i0=b.Vector2.Zero(),j._i1=b.Vector2.Zero(),j._i2=b.Vector2.Zero(),j.roundSubdivisions=16,__decorate([b.instanceLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+1,function(b){return j.actualSizeProperty=b;},!1,!0)],j.prototype,"actualSize",null),__decorate([b.modelLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+2,function(b){return j.notRoundedProperty=b;})],j.prototype,"notRounded",null),__decorate([b.instanceLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+3,function(b){return j.roundRadiusProperty=b;})],j.prototype,"roundRadius",null),j=__decorate([b.className("Rectangle2D")],j));b.Rectangle2D=c;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j;e=b.ModelRenderCache,c=function(b,c){e.call(this,b,c);this.effectsReady=!1;this.fillIB=this.fillVB=null;y4tt.v9();this.fillIndicesCount=0;this.borderIB=this.borderVB=this.effectFill=this.effectFillInstanced=this.instancingFillAttributes=null;this.borderIndicesCount=0;this.effectBorder=this.effectBorderInstanced=this.instancingBorderAttributes=null;};g=(__extends(c,e),c.prototype.render=function(c,d){var f,e,g,j,q,v;y4tt.q9();if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0;}f=c.owner.owner.engine,e=0;this.effectFill&&this.effectBorder&&(e=f.getDepthFunction(),f.setDepthFunctionToLessOrEqual());g=f.getAlphaMode();if(this.effectFill){j=c.partIndexFromId.get(b.Shape2D.SHAPE2D_FILLPARTID.toString()),q=d.groupInfoPartData[j];d.renderMode!==b.Render2DContext.RenderModeOpaque&&f.setAlphaMode(b.Engine.ALPHA_COMBINE);v=d.useInstancing?this.effectFillInstanced:this.effectFill;if(f.enableEffect(v),f.bindBuffersDirectly(this.fillVB,this.fillIB,[1],4,v),d.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(b.Shape2D.SHAPE2D_FILLPARTID,v)),f.updateAndBindInstancesBuffer(q._partBuffer,null,this.instancingFillAttributes),f.draw(!0,0,this.fillIndicesCount,q._partData.usedElementCount),f.unbindInstanceAttributes();else for(var y=d.partDataStartIndex;y<d.partDataEndIndex;y++)this.setupUniforms(v,j,q._partData,y),f.draw(!0,0,this.fillIndicesCount);}if(this.effectBorder)if(j=c.partIndexFromId.get(b.Shape2D.SHAPE2D_BORDERPARTID.toString()),q=d.groupInfoPartData[j],d.renderMode!==b.Render2DContext.RenderModeOpaque&&f.setAlphaMode(b.Engine.ALPHA_COMBINE),v=d.useInstancing?this.effectBorderInstanced:this.effectBorder,f.enableEffect(v),f.bindBuffersDirectly(this.borderVB,this.borderIB,[1],4,v),d.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(b.Shape2D.SHAPE2D_BORDERPARTID,v)),f.updateAndBindInstancesBuffer(q._partBuffer,null,this.instancingBorderAttributes),f.draw(!0,0,this.borderIndicesCount,q._partData.usedElementCount),f.unbindInstanceAttributes();else for(y=d.partDataStartIndex;y<d.partDataEndIndex;y++)this.setupUniforms(v,j,q._partData,y),f.draw(!0,0,this.borderIndicesCount);return f.setAlphaMode(g),this.effectFill&&this.effectBorder&&f.setDepthFunction(e),!0;},c.prototype.dispose=function(){y4tt.q9();return e.prototype.dispose.call(this)?(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0):!1;},c);b.Ellipse2DRenderCache=g;f=b.Shape2DInstanceData,c=function(b){y4tt.q9();f.call(this,b,1);};d=(__extends(c,f),Object.defineProperty(c.prototype,"properties",{get:function(){y4tt.v9();return null;},enumerable:!0,configurable:!0}),__decorate([b.instanceData()],c.prototype,"properties",null),c);b.Ellipse2DInstanceData=d;q=b.Shape2D,j=function(c){if(null==c&&(c={}),q.call(this,c),null!=c.size)this.size=c.size;else if(c.width||c.height)this.size=new b.Size(c.width,c.height);y4tt.v9();this.subdivisions=null==c.subdivisions?64:c.subdivisions;},c=(__extends(j,q),Object.defineProperty(j.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size;},set:function(b){this._actualSize=b;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"subdivisions",{get:function(){y4tt.q9();return this._subdivisions;},set:function(b){y4tt.v9();this._subdivisions=b;},enumerable:!0,configurable:!0}),j.prototype.levelIntersect=function(b){var c,d,f;y4tt.q9();c=this.size.width/2,d=this.size.height/2,f=b._localPickPosition.x-c;b=b._localPickPosition.y-d;return 1>=f*f/(c*c)+b*b/(d*d);},j.prototype.updateLevelBoundingInfo=function(){b.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo);},j.prototype.createModelRenderCache=function(b){return new g(this.owner.engine,b);},j.prototype.setupModelRenderCache=function(c){var d,q,v;d=this.owner.engine;y4tt.v9();if(this.fill){for(var f=this.subdivisions+1,e=new Float32Array(f),g=0;f>g;g++)e[g]=g;c.fillVB=d.createVertexBuffer(e);f-=1;e=new Float32Array(3*f);for(g=0;f>g;g++)e[3*g+0]=0,e[3*g+2]=g+1,e[3*g+1]=g+2;e[3*f-2]=1;c.fillIB=d.createIndexBuffer(e);c.fillIndicesCount=3*f;(g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_FILLPARTID,["index"],!0))&&(c.effectFillInstanced=d.createEffect({vertex:"ellipse2d",fragment:"ellipse2d"},g.attributes,g.uniforms,[],g.defines,null));g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_FILLPARTID,["index"],!1);c.effectFill=d.createEffect({vertex:"ellipse2d",fragment:"ellipse2d"},g.attributes,g.uniforms,[],g.defines,null);}if(this.border){f=2*this.subdivisions;e=new Float32Array(f);for(g=0;f>g;g++)e[g]=g;c.borderVB=d.createVertexBuffer(e);for(var j=f/2,e=new Float32Array(3*f),g=0;j>g;g++){q=g,v=(g+1)%j;e[6*g+0]=j+v;e[6*g+1]=j+q;e[6*g+2]=q;e[6*g+3]=v;e[6*g+4]=j+v;e[6*g+5]=q;}c.borderIB=d.createIndexBuffer(e);c.borderIndicesCount=3*f;(g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_BORDERPARTID,["index"],!0))&&(c.effectBorderInstanced=d.createEffect("ellipse2d",g.attributes,g.uniforms,[],g.defines,null));g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_BORDERPARTID,["index"],!1);c.effectBorder=d.createEffect("ellipse2d",g.attributes,g.uniforms,[],g.defines,null);}return c;},j.prototype.createInstanceDataParts=function(){var c;c=[];return this.border&&c.push(new d(b.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&c.push(new d(b.Shape2D.SHAPE2D_FILLPARTID)),c;},j.prototype.refreshInstanceDataPart=function(c){var d;y4tt.v9();if(!q.prototype.refreshInstanceDataPart.call(this,c))return!1;if(c.id===b.Shape2D.SHAPE2D_BORDERPARTID){d=this.actualSize;c.properties=new b.Vector3(d.width,d.height,this.subdivisions);}else c.id===b.Shape2D.SHAPE2D_FILLPARTID&&(d=this.actualSize,c.properties=new b.Vector3(d.width,d.height,this.subdivisions));return!0;},__decorate([b.instanceLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+1,function(b){return j.acutalSizeProperty=b;},!1,!0)],j.prototype,"actualSize",null),__decorate([b.modelLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+2,function(b){return j.subdivisionsProperty=b;})],j.prototype,"subdivisions",null),j=__decorate([b.className("Ellipse2D")],j));b.Ellipse2D=c;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j,l;e=b.ModelRenderCache,c=function(){e.apply(this,arguments);this.effectsReady=!1;this.effectInstanced=this.effect=this.texture=this.instancingAttributes=this.ib=this.vb=null;};g=(__extends(c,e),c.prototype.render=function(c,d){var f,e,l,g;if(!this.effectsReady){if(this.effect&&(!this.effect.isReady()||this.effectInstanced&&!this.effectInstanced.isReady()))return!1;this.effectsReady=!0;}f=c.owner.owner.engine,e=d.useInstancing?this.effectInstanced:this.effect;f.enableEffect(e);e.setTexture("diffuseSampler",this.texture);f.bindBuffersDirectly(this.vb,this.ib,[1],4,e);l=f.getAlphaMode();d.renderMode!==b.Render2DContext.RenderModeOpaque&&f.setAlphaMode(b.Engine.ALPHA_COMBINE);g=d.groupInfoPartData[0];if(d.useInstancing)this.instancingAttributes||(this.instancingAttributes=this.loadInstancingAttributes(q.SPRITE2D_MAINPARTID,e)),f.updateAndBindInstancesBuffer(g._partBuffer,null,this.instancingAttributes),f.draw(!0,0,6,g._partData.usedElementCount),f.unbindInstanceAttributes();else for(var j=d.partDataStartIndex;j<d.partDataEndIndex;j++)this.setupUniforms(e,0,g._partData,j),f.draw(!0,0,6);return f.setAlphaMode(l),!0;},c.prototype.dispose=function(){return e.prototype.dispose.call(this)?(this.vb&&(this._engine._releaseBuffer(this.vb),this.vb=null),this.ib&&(this._engine._releaseBuffer(this.ib),this.ib=null),this.texture&&(this.texture.dispose(),this.texture=null),this.effect&&(this._engine._releaseEffect(this.effect),this.effect=null),this.effectInstanced&&(this._engine._releaseEffect(this.effectInstanced),this.effectInstanced=null),!0):!1;},c);b.Sprite2DRenderCache=g;f=b.InstanceDataBase,c=function(b){f.call(this,b,1);};d=(__extends(c,f),Object.defineProperty(c.prototype,"topLeftUV",{get:function(){return null;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"sizeUV",{get:function(){return null;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"textureSize",{get:function(){return null;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"properties",{get:function(){return null;},enumerable:!0,configurable:!0}),__decorate([b.instanceData()],c.prototype,"topLeftUV",null),__decorate([b.instanceData()],c.prototype,"sizeUV",null),__decorate([b.instanceData()],c.prototype,"textureSize",null),__decorate([b.instanceData()],c.prototype,"properties",null),c);b.Sprite2DInstanceData=d;j=b.RenderablePrim2D,l=function(c,d){var f;if(d||(d={}),j.call(this,d),this.texture=c,this.texture.wrapU=b.Texture.CLAMP_ADDRESSMODE,this.texture.wrapV=b.Texture.CLAMP_ADDRESSMODE,this.size=d.spriteSize||null,this.spriteLocation=d.spriteLocation||new b.Vector2(0,0),this.spriteFrame=0,this.invertY=null==d.invertY?!1:d.invertY,this.alignToPixel=null==d.alignToPixel?!0:d.alignToPixel,this._isTransparent=!0,!this.size){f=c.getSize();this.size=new b.Size(f.width,f.height);}};q=(__extends(l,j),Object.defineProperty(l.prototype,"texture",{get:function(){return this._texture;},set:function(b){this._texture=b;},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size;},set:function(b){y4tt.v9();this._actualSize=b;},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"spriteLocation",{get:function(){y4tt.v9();return this._location;},set:function(b){y4tt.v9();this._location=b;},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"spriteFrame",{get:function(){y4tt.v9();return this._spriteFrame;},set:function(b){this._spriteFrame=b;},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"invertY",{get:function(){return this._invertY;},set:function(b){y4tt.q9();this._invertY=b;},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"alignToPixel",{get:function(){y4tt.v9();return this._alignToPixel;},set:function(b){this._alignToPixel=b;},enumerable:!0,configurable:!0}),l.prototype.updateLevelBoundingInfo=function(){b.BoundingInfo2D.CreateFromSizeToRef(this.size,this._levelBoundingInfo);},l.prototype.getAnimatables=function(){var b;b=[];return this.texture&&this.texture.animations&&0<this.texture.animations.length&&b.push(this.texture),b;},l.prototype.levelIntersect=function(){return!0;},l._createCachedCanvasSprite=function(c,d,f,e){return new l(d,{parent:c,id:"__cachedCanvasSprite__",position:b.Vector2.Zero(),origin:b.Vector2.Zero(),spriteSize:f,spriteLocation:e,alignToPixel:!0});},l.prototype.createModelRenderCache=function(b){y4tt.v9();return new g(this.owner.engine,b);},l.prototype.setupModelRenderCache=function(b){for(var c=this.owner.engine,d=new Float32Array(4),f=0;4>f;f++)d[f]=f;b.vb=c.createVertexBuffer(d);d=new Float32Array(6);d[0]=0;d[1]=2;d[2]=1;d[3]=0;y4tt.q9();d[4]=3;d[5]=2;b.ib=c.createIndexBuffer(d);b.texture=this.texture;d=this.getDataPartEffectInfo(l.SPRITE2D_MAINPARTID,["index"],!0);return d&&(b.effectInstanced=c.createEffect("sprite2d",d.attributes,d.uniforms,["diffuseSampler"],d.defines,null)),d=this.getDataPartEffectInfo(l.SPRITE2D_MAINPARTID,["index"],!1),b.effect=c.createEffect("sprite2d",d.attributes,d.uniforms,["diffuseSampler"],d.defines,null),b;},l.prototype.createInstanceDataParts=function(){return[new d(l.SPRITE2D_MAINPARTID)];},l.prototype.refreshInstanceDataPart=function(c){var d,f,e;if(!j.prototype.refreshInstanceDataPart.call(this,c))return!1;if(c.id===l.SPRITE2D_MAINPARTID){c=this._instanceDataParts[0];d=this.texture.getBaseSize(),f=this.spriteLocation,e=this.actualSize;c.topLeftUV=new b.Vector2(f.x/d.width,f.y/d.height);f=new b.Vector2(e.width/d.width,e.height/d.height);c.sizeUV=f;l._prop.x=this.spriteFrame;l._prop.y=this.invertY?1:0;l._prop.z=this.alignToPixel?1:0;c.properties=l._prop;c.textureSize=new b.Vector2(d.width,d.height);}return!0;},l.SPRITE2D_MAINPARTID=1,l._prop=b.Vector3.Zero(),__decorate([b.modelLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,function(b){y4tt.v9();return l.textureProperty=b;})],l.prototype,"texture",null),__decorate([b.instanceLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(b){return l.actualSizeProperty=b;},!1,!0)],l.prototype,"actualSize",null),__decorate([b.instanceLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(b){return l.spriteLocationProperty=b;})],l.prototype,"spriteLocation",null),__decorate([b.instanceLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+4,function(b){y4tt.v9();return l.spriteFrameProperty=b;})],l.prototype,"spriteFrame",null),__decorate([b.instanceLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+5,function(b){return l.invertYProperty=b;})],l.prototype,"invertY",null),l=__decorate([b.className("Sprite2D")],l));b.Sprite2D=q;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j,l;e=b.ModelRenderCache,c=function(){e.apply(this,arguments);this.effectsReady=!1;y4tt.v9();this.effectInstanced=this.effect=this.fontTexture=this.instancingAttributes=this.ib=this.vb=null;};g=(__extends(c,e),c.prototype.render=function(c,d){var f,e,l,g;if(!this.effectsReady){if(this.effect&&(!this.effect.isReady()||this.effectInstanced&&!this.effectInstanced.isReady()))return!1;this.effectsReady=!0;}f=c.owner.owner.engine;this.fontTexture.update();e=d.useInstancing?this.effectInstanced:this.effect;f.enableEffect(e);e.setTexture("diffuseSampler",this.fontTexture);f.bindBuffersDirectly(this.vb,this.ib,[1],4,e);y4tt.q9();l=f.getAlphaMode();f.setAlphaMode(b.Engine.ALPHA_COMBINE,!0);g=d.groupInfoPartData[0];if(d.useInstancing)this.instancingAttributes||(this.instancingAttributes=this.loadInstancingAttributes(q.TEXT2D_MAINPARTID,e)),f.updateAndBindInstancesBuffer(g._partBuffer,null,this.instancingAttributes),f.draw(!0,0,6,g._partData.usedElementCount),f.unbindInstanceAttributes();else for(var j=d.partDataStartIndex;j<d.partDataEndIndex;j++)this.setupUniforms(e,0,g._partData,j),f.draw(!0,0,6);return f.setAlphaMode(l),!0;},c.prototype.dispose=function(){y4tt.q9();return e.prototype.dispose.call(this)?(this.vb&&(this._engine._releaseBuffer(this.vb),this.vb=null),this.ib&&(this._engine._releaseBuffer(this.ib),this.ib=null),this.fontTexture&&(this.fontTexture.dispose(),this.fontTexture=null),this.effect&&(this._engine._releaseEffect(this.effect),this.effect=null),this.effectInstanced&&(this._engine._releaseEffect(this.effectInstanced),this.effectInstanced=null),!0):!1;},c);b.Text2DRenderCache=g;f=b.InstanceDataBase,c=function(b,c){f.call(this,b,c);};d=(__extends(c,f),Object.defineProperty(c.prototype,"topLeftUV",{get:function(){y4tt.q9();return null;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"sizeUV",{get:function(){y4tt.v9();return null;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"textureSize",{get:function(){y4tt.v9();return null;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"color",{get:function(){return null;},enumerable:!0,configurable:!0}),__decorate([b.instanceData()],c.prototype,"topLeftUV",null),__decorate([b.instanceData()],c.prototype,"sizeUV",null),__decorate([b.instanceData()],c.prototype,"textureSize",null),__decorate([b.instanceData()],c.prototype,"color",null),c);b.Text2DInstanceData=d;j=b.RenderablePrim2D,l=function(c,d){d||(d={});j.call(this,d);this.fontName=null==d.fontName?"12pt Arial":d.fontName;this.defaultFontColor=null==d.defaultFontColor?new b.Color4(1,1,1,1):d.defaultFontColor;this._tabulationSize=null==d.tabulationSize?4:d.tabulationSize;this._textSize=null;this.text=c;this.size=null==d.size?null:d.size;this.isAlphaTest=!0;};q=(__extends(l,j),Object.defineProperty(l.prototype,"fontName",{get:function(){return this._fontName;},set:function(b){if(this._fontName)throw Error("Font Name change is not supported right now.");y4tt.v9();this._fontName=b;},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"defaultFontColor",{get:function(){return this._defaultFontColor;},set:function(b){this._defaultFontColor=b;},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"text",{get:function(){return this._text;},set:function(b){this._text=b;y4tt.v9();this._size=this._textSize=null;this._updateCharCount();this.textSize;},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"size",{get:function(){y4tt.q9();return null!=this._size?this._size:this.textSize;},set:function(b){y4tt.q9();this._size=b;},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size;},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"textSize",{get:function(){var c;if(!this._textSize){if(!this.owner)return l.nullSize;c=this.fontTexture.measureText(this._text,this._tabulationSize);c.equals(this._textSize)||(this.onPrimitivePropertyDirty(b.Prim2DBase.sizeProperty.flagId),this._positioningDirty());this._textSize=c;}return this._textSize;},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"fontTexture",{get:function(){y4tt.q9();return this._fontTexture?this._fontTexture:(this._fontTexture=b.FontTexture.GetCachedFontTexture(this.owner.scene,this.fontName),this._fontTexture);},enumerable:!0,configurable:!0}),l.prototype.dispose=function(){y4tt.q9();return j.prototype.dispose.call(this)?(this._fontTexture&&(b.FontTexture.ReleaseCachedFontTexture(this.owner.scene,this.fontName),this._fontTexture=null),!0):!1;},l.prototype.updateLevelBoundingInfo=function(){y4tt.v9();b.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo);},l.prototype.levelIntersect=function(){y4tt.q9();return!0;},l.prototype.createModelRenderCache=function(b){return new g(this.owner.engine,b);},l.prototype.setupModelRenderCache=function(b){var c;c=this.owner.engine;b.fontTexture=this.fontTexture;for(var d=new Float32Array(4),f=0;4>f;f++)d[f]=f;b.vb=c.createVertexBuffer(d);d=new Float32Array(6);d[0]=0;d[1]=2;d[2]=1;d[3]=0;d[4]=3;d[5]=2;b.ib=c.createIndexBuffer(d);d=this.getDataPartEffectInfo(l.TEXT2D_MAINPARTID,["index"],!0);return d&&(b.effectInstanced=c.createEffect("text2d",d.attributes,d.uniforms,["diffuseSampler"],d.defines,null)),d=this.getDataPartEffectInfo(l.TEXT2D_MAINPARTID,["index"],!1),b.effect=c.createEffect("text2d",d.attributes,d.uniforms,["diffuseSampler"],d.defines,null),b;},l.prototype.createInstanceDataParts=function(){y4tt.v9();return[new d(l.TEXT2D_MAINPARTID,this._charCount)];},l.prototype.beforeRefreshForLayoutConstruction=function(){var b;y4tt.v9();if(!this._charCount){b=this._text;return this.text="A",b;}},l.prototype.afterRefreshForLayoutConstruction=function(b,c){y4tt.v9();void 0!==c&&(this.text=c);},l.prototype.refreshInstanceDataPart=function(c){var d,f,e,g,y;if(!j.prototype.refreshInstanceDataPart.call(this,c))return!1;if(c.id===l.TEXT2D_MAINPARTID){d=this.fontTexture,f=d.getSize(),e=b.Vector2.Zero(),g=this.fontTexture.lineHeight;e.y=(this.textSize.height/g-1)*g;g=0;c.dataElementCount=this._charCount;for(var q=c.curElement=0,v=this.text;q<v.length;q++){y=v[q];("\n"===y&&(e.x=0,e.y-=d.lineHeight),"\t"!==y)?" ">y||(this.updateInstanceDataPart(c,e),y=d.getChar(y),e.x+=y.charWidth,c.topLeftUV=y.topLeftUV,y=y.bottomRightUV.subtract(y.topLeftUV),c.sizeUV=y,c.textureSize=new b.Vector2(f.width,f.height),c.color=this.defaultFontColor,++c.curElement):(y=g+this._tabulationSize,y-=y%this._tabulationSize,e.x+=(y-g)*d.spaceWidth,g=y);}}return!0;},l.prototype._updateCharCount=function(){var f;for(var b=0,c=0,d=this._text;c<d.length;c++){f=d[c];"\r"===f||"\n"===f||"\t"===f||" ">f||++b;}y4tt.v9();this._charCount=b;},l.TEXT2D_MAINPARTID=1,__decorate([b.modelLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,function(b){return l.fontProperty=b;},!1,!0)],l.prototype,"fontName",null),__decorate([b.dynamicLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(b){y4tt.v9();return l.defaultFontColorProperty=b;})],l.prototype,"defaultFontColor",null),__decorate([b.instanceLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(b){y4tt.q9();return l.textProperty=b;},!1,!0)],l.prototype,"text",null),__decorate([b.instanceLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+4,function(b){return l.sizeProperty=b;})],l.prototype,"size",null),l=__decorate([b.className("Text2D")],l));b.Text2D=q;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j;e=b.ModelRenderCache,c=function(b,c){e.call(this,b,c);this.effectsReady=!1;y4tt.v9();this.fillIB=this.fillVB=null;this.fillIndicesCount=0;this.borderIB=this.borderVB=this.effectFillInstanced=this.effectFill=this.instancingFillAttributes=null;this.borderIndicesCount=0;this.effectBorderInstanced=this.effectBorder=this.instancingBorderAttributes=null;};g=(__extends(c,e),c.prototype.render=function(c,d){var f,e,g,j,q,v;if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0;}f=c.owner.owner.engine,e=0;this.effectFill&&this.effectBorder&&(e=f.getDepthFunction(),f.setDepthFunctionToLessOrEqual());g=f.getAlphaMode();if(this.effectFill){j=c.partIndexFromId.get(b.Shape2D.SHAPE2D_FILLPARTID.toString()),q=d.groupInfoPartData[j];d.renderMode!==b.Render2DContext.RenderModeOpaque&&f.setAlphaMode(b.Engine.ALPHA_COMBINE);v=d.useInstancing?this.effectFillInstanced:this.effectFill;if(f.enableEffect(v),f.bindBuffersDirectly(this.fillVB,this.fillIB,[2],8,v),d.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(b.Shape2D.SHAPE2D_FILLPARTID,v)),f.updateAndBindInstancesBuffer(q._partBuffer,null,this.instancingFillAttributes),f.draw(!0,0,this.fillIndicesCount,q._partData.usedElementCount),f.unbindInstanceAttributes();else for(var y=d.partDataStartIndex;y<d.partDataEndIndex;y++)this.setupUniforms(v,j,q._partData,y),f.draw(!0,0,this.fillIndicesCount);}if(this.effectBorder)if(j=c.partIndexFromId.get(b.Shape2D.SHAPE2D_BORDERPARTID.toString()),q=d.groupInfoPartData[j],d.renderMode!==b.Render2DContext.RenderModeOpaque&&f.setAlphaMode(b.Engine.ALPHA_COMBINE),v=d.useInstancing?this.effectBorderInstanced:this.effectBorder,f.enableEffect(v),f.bindBuffersDirectly(this.borderVB,this.borderIB,[2],8,v),d.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(b.Shape2D.SHAPE2D_BORDERPARTID,v)),f.updateAndBindInstancesBuffer(q._partBuffer,null,this.instancingBorderAttributes),f.draw(!0,0,this.borderIndicesCount,q._partData.usedElementCount),f.unbindInstanceAttributes();else for(y=d.partDataStartIndex;y<d.partDataEndIndex;y++)this.setupUniforms(v,j,q._partData,y),f.draw(!0,0,this.borderIndicesCount);return f.setAlphaMode(g),this.effectFill&&this.effectBorder&&f.setDepthFunction(e),!0;},c.prototype.dispose=function(){return e.prototype.dispose.call(this)?(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0):!1;},c);b.Lines2DRenderCache=g;f=b.Shape2DInstanceData,c=function(b){y4tt.v9();f.call(this,b,1);};d=(__extends(c,f),Object.defineProperty(c.prototype,"boundingMin",{get:function(){return null;},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"boundingMax",{get:function(){y4tt.v9();return null;},enumerable:!0,configurable:!0}),__decorate([b.instanceData(b.Shape2D.SHAPE2D_CATEGORY_FILLGRADIENT)],c.prototype,"boundingMin",null),__decorate([b.instanceData(b.Shape2D.SHAPE2D_CATEGORY_FILLGRADIENT)],c.prototype,"boundingMax",null),c);b.Lines2DInstanceData=d;q=b.Shape2D,j=function(c,d){var f,e,g,j;d||(d={});q.call(this,d);this._borderIB=this._borderVB=this._fillIB=this._fillVB=null;this._size=b.Size.Zero();this._boundingMax=this._boundingMin=null;y4tt.v9();f=null==d.fillThickness?1:d.fillThickness,e=null==d.startCap?0:d.startCap,g=null==d.endCap?0:d.endCap,j=null==d.closed?!1:d.closed;this.points=c;this.fillThickness=f;this.startCap=e;this.endCap=g;this.closed=j;},c=(__extends(j,q),Object.defineProperty(j,"NoCap",{get:function(){y4tt.v9();return j._noCap;},enumerable:!0,configurable:!0}),Object.defineProperty(j,"RoundCap",{get:function(){return j._roundCap;},enumerable:!0,configurable:!0}),Object.defineProperty(j,"TriangleCap",{get:function(){return j._triangleCap;},enumerable:!0,configurable:!0}),Object.defineProperty(j,"SquareAnchorCap",{get:function(){return j._squareAnchorCap;},enumerable:!0,configurable:!0}),Object.defineProperty(j,"RoundAnchorCap",{get:function(){return j._roundAnchorCap;},enumerable:!0,configurable:!0}),Object.defineProperty(j,"DiamondAnchorCap",{get:function(){return j._diamondAnchorCap;},enumerable:!0,configurable:!0}),Object.defineProperty(j,"ArrowCap",{get:function(){return j._arrowCap;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"points",{get:function(){y4tt.v9();return this._points;},set:function(b){y4tt.q9();this._points=b;this._boundingBoxDirty();},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"fillThickness",{get:function(){return this._fillThickness;},set:function(b){this._fillThickness=b;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"closed",{get:function(){return this._closed;},set:function(b){y4tt.v9();this._closed=b;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"startCap",{get:function(){y4tt.q9();return this._startCap;},set:function(b){y4tt.q9();this._startCap=b;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"endCap",{get:function(){return this._endCap;},set:function(b){y4tt.q9();this._endCap=b;},enumerable:!0,configurable:!0}),j.prototype.levelIntersect=function(c){var d,f,e,g;d=this;null==this._contour&&this._computeLines2D();f=this.points.length,e=this.closed?f+1:f,g=c._localPickPosition;this.transformPointWithOriginToRef(this._contour[0],null,j._prevA);this.transformPointWithOriginToRef(this._contour[1],null,j._prevB);for(c=1;e>c;c++){if((this.transformPointWithOriginToRef(this._contour[2*(c%f)+0],null,j._curA),this.transformPointWithOriginToRef(this._contour[2*(c%f)+1],null,j._curB),b.Vector2.PointInTriangle(g,j._prevA,j._prevB,j._curA))||b.Vector2.PointInTriangle(g,j._curA,j._prevB,j._curB))return!0;j._prevA.x=j._curA.x;j._prevA.y=j._curA.y;j._prevB.x=j._curB.x;j._prevB.y=j._curB.y;}f=function(c,f){for(var e=c.length,l=0;e>l;l+=3)if(j._curA.x=f[2*c[l+0]+0],j._curA.y=f[2*c[l+0]+1],d.transformPointWithOriginToRef(j._curA,null,j._curB),j._curA.x=f[2*c[l+1]+0],j._curA.y=f[2*c[l+1]+1],d.transformPointWithOriginToRef(j._curA,null,j._prevA),j._curA.x=f[2*c[l+2]+0],j._curA.y=f[2*c[l+2]+1],d.transformPointWithOriginToRef(j._curA,null,j._prevB),b.Vector2.PointInTriangle(g,j._prevA,j._prevB,j._curB))return!0;return!1;};return this._startCapTriIndices&&(f(this._startCapTriIndices,this._startCapContour)||f(this._endCapTriIndices,this._endCapContour))?!0:!1;},Object.defineProperty(j.prototype,"boundingMin",{get:function(){return this._boundingMin||this._computeLines2D(),this._boundingMin;},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"boundingMax",{get:function(){return this._boundingMax||this._computeLines2D(),this._boundingMax;},enumerable:!0,configurable:!0}),j.prototype.getUsedShaderCategories=function(c){var d;c=q.prototype.getUsedShaderCategories.call(this,c);d=c.indexOf(b.Shape2D.SHAPE2D_CATEGORY_BORDER);return-1!==d&&c.splice(d,1),c;},j.prototype.updateLevelBoundingInfo=function(){this._boundingMin||this._computeLines2D();b.BoundingInfo2D.CreateFromMinMaxToRef(this._boundingMin.x,this._boundingMax.x,this._boundingMin.y,this._boundingMax.y,this._levelBoundingInfo);},j.prototype.createModelRenderCache=function(b){return new g(this.owner.engine,b);},j.prototype._perp=function(b,c){y4tt.v9();c.x=b.y;c.y=-b.x;},j.prototype._direction=function(b,c,d){b.subtractToRef(c,d);d.normalize();},j.prototype._computeMiter=function(c,d,f,e){y4tt.v9();return f.addToRef(e,c),c.normalize(),d.x=-c.y,d.y=c.x,j._miterTps.x=-f.y,j._miterTps.y=f.x,1/b.Vector2.Dot(d,j._miterTps);},j.prototype._intersect=function(b,c,d,f,e,g,j,q){var y;y=(b-d)*(g-q)-(c-f)*(e-j);y4tt.q9();if(0===y)return!1;c=((e-j)*(b*f-c*d)-(b-d)*(e*q-g*j))/y;return c<Math.min(b,d)||c>Math.max(b,d)?!1:!(c<Math.min(e,j)||c>Math.max(e,j));},j.prototype._updateMinMax=function(b,c){y4tt.q9();c>=b.length||(this._boundingMin.x=Math.min(this._boundingMin.x,b[c]),this._boundingMax.x=Math.max(this._boundingMax.x,b[c]),this._boundingMin.y=Math.min(this._boundingMin.y,b[c+1]),this._boundingMax.y=Math.max(this._boundingMax.y,b[c+1]));},j.prototype._store=function(c,d,f,e,g,q,t,v,y){var x,z;x=null!=v&&!isNaN(v),z=f*(x?8:4);if(!(z>=c.length)){0===f?this._perp(q,j._startDir):f===e-1&&(this._perp(q,j._endDir),j._endDir.x*=-1,j._endDir.y*=-1);f=!1;if(c[z+0]=g.x+q.x*t,c[z+1]=g.y+q.y*t,c[z+2]=g.x+q.x*-t,c[z+3]=g.y+q.y*-t,this._updateMinMax(c,z),this._updateMinMax(c,z+2),void 0!==y)y*=x?8:4,this._intersect(c[z+0],c[z+1],c[y+0],c[y+1],c[z+2],c[z+3],c[y+2],c[y+3])&&(f=!0,y=c[z+0],c[z+0]=c[z+2],c[z+2]=y,y=c[z+1],c[z+1]=c[z+3],c[z+3]=y);x&&(t+=v,c[z+4]=g.x+q.x*(f?-t:t),c[z+5]=g.y+q.y*(f?-t:t),c[z+6]=g.x+q.x*(f?t:-t),c[z+7]=g.y+q.y*(f?t:-t),this._updateMinMax(c,z+4),this._updateMinMax(c,z+6));d&&(z+=x?4:0,d.push(new b.Vector2(c[z+0],c[z+1])),d.push(new b.Vector2(c[z+2],c[z+3])));}},j.prototype._getCapSize=function(b,c){var d,f,e;void 0===c&&(c=!1);d=j._roundCapSubDiv,f=0,e=0;switch(b){case j.NoCap:!this.closed&&c?(f=4,e=6):f=e=0;break;case j.RoundCap:c?(f=d,e=3*(d-2)):(f=d/2+1,e=3*(d/2));break;case j.ArrowCap:c?(f=12,e=24):(f=3,e=3);break;case j.TriangleCap:c?(f=6,e=12):(f=3,e=3);break;case j.DiamondAnchorCap:c?(f=10,e=24):(f=5,e=9);break;case j.SquareAnchorCap:c?(f=12,e=30):(f=4,e=6);break;case j.RoundAnchorCap:c?(f=2*d,e=6*(d-1)):(f=d+1,e=3*(d+1));}return{vbsize:2*f,ibsize:e};},j.prototype._storeVertex=function(b,c,d,f,e,g,q){var v;v=Math.cos(e);e=Math.sin(e);j._tpsV.x=v*g.x+-e*g.y+f.x;j._tpsV.y=e*g.x+v*g.y+f.y;y4tt.v9();f=c+2*d;return b[f+0]=j._tpsV.x,b[f+1]=j._tpsV.y,q&&(q.push(j._tpsV.x),q.push(j._tpsV.y)),this._updateMinMax(b,f),(c+2*d)/2;},j.prototype._storeIndex=function(b,c,d,f){y4tt.q9();b[c+d]=f;},j.prototype._buildCap=function(c,d,f,e,g,q,t,v,y,x){var z,B,A,C,G,D,H,J,F,O,E,L,N;z=j._roundCapSubDiv,B=new b.Vector2(1,0);y=Math.atan2(y.y,y.x)-Math.atan2(B.y,B.x);y4tt.q9();B=q/2,A=null!=t;switch(v){case j.NoCap:if(A&&!this.closed){A=v=0,C=this._storeVertex(c,d,v++,g,y,new b.Vector2(0,B+t),x),G=this._storeVertex(c,d,v++,g,y,new b.Vector2(t,B+t),x),D=this._storeVertex(c,d,v++,g,y,new b.Vector2(t,-(B+t)),x),z=this._storeVertex(c,d,v++,g,y,new b.Vector2(0,-(B+t)),x);this._storeIndex(f,e,A++,C);this._storeIndex(f,e,A++,G);this._storeIndex(f,e,A++,D);this._storeIndex(f,e,A++,C);this._storeIndex(f,e,A++,D);this._storeIndex(f,e,A++,z);}break;case j.ArrowCap:B*=2;case j.TriangleCap:if(A){H=v===j.TriangleCap?t:Math.sqrt(2*t*t),C=this._storeVertex(c,d,0,g,y,new b.Vector2(0,B),null),G=this._storeVertex(c,d,1,g,y,new b.Vector2(B,0),null),D=this._storeVertex(c,d,2,g,y,new b.Vector2(0,-B),null),z=this._storeVertex(c,d,3,g,y,new b.Vector2(0,B+H),x),J=this._storeVertex(c,d,4,g,y,new b.Vector2(B+H,0),x),F=this._storeVertex(c,d,5,g,y,new b.Vector2(0,-(B+H)),x),A=0;if(this._storeIndex(f,e,A++,C),this._storeIndex(f,e,A++,z),this._storeIndex(f,e,A++,J),this._storeIndex(f,e,A++,C),this._storeIndex(f,e,A++,J),this._storeIndex(f,e,A++,G),this._storeIndex(f,e,A++,F),this._storeIndex(f,e,A++,D),this._storeIndex(f,e,A++,G),this._storeIndex(f,e,A++,F),this._storeIndex(f,e,A++,G),this._storeIndex(f,e,A++,J),v===j.ArrowCap){C=q/2;q=this._storeVertex(c,d,9,g,y,new b.Vector2(0,-(C+t)),null);v=this._storeVertex(c,d,11,g,y,new b.Vector2(-t,-(B+H)),x);O=this._storeVertex(c,d,10,g,y,new b.Vector2(-t,-(C+t)),x),E=this._storeVertex(c,d,6,g,y,new b.Vector2(0,C+t),null),L=this._storeVertex(c,d,7,g,y,new b.Vector2(-t,C+t),x),N=this._storeVertex(c,d,8,g,y,new b.Vector2(-t,B+H),x);this._storeIndex(f,e,A++,E);this._storeIndex(f,e,A++,L);this._storeIndex(f,e,A++,N);this._storeIndex(f,e,A++,E);this._storeIndex(f,e,A++,N);this._storeIndex(f,e,A++,z);this._storeIndex(f,e,A++,q);this._storeIndex(f,e,A++,v);this._storeIndex(f,e,A++,O);this._storeIndex(f,e,A++,q);this._storeIndex(f,e,A++,F);this._storeIndex(f,e,A++,v);}}else C=this._storeVertex(c,d,0,g,y,new b.Vector2(0,B),x),G=this._storeVertex(c,d,1,g,y,new b.Vector2(B,0),x),D=this._storeVertex(c,d,2,g,y,new b.Vector2(0,-B),x),this._storeIndex(f,e,0,C),this._storeIndex(f,e,1,G),this._storeIndex(f,e,2,D);break;case j.RoundCap:if(A){D=-Math.PI/2;J=Math.PI/(z/2-1);for(F=A=0;z/2>F;F++)C=this._storeVertex(c,d,2*F+0,g,y,new b.Vector2(Math.cos(D)*B,Math.sin(D)*B),null),G=this._storeVertex(c,d,2*F+1,g,y,new b.Vector2(Math.cos(D)*(B+t),Math.sin(D)*(B+t)),x),0<F&&(this._storeIndex(f,e,A++,C-2),this._storeIndex(f,e,A++,G-2),this._storeIndex(f,e,A++,G),this._storeIndex(f,e,A++,C-2),this._storeIndex(f,e,A++,G),this._storeIndex(f,e,A++,C)),D+=J;}else{H=this._storeVertex(c,d,0,g,y,new b.Vector2(0,0),null);D=-Math.PI/2;J=Math.PI/(z/2-1);this._storeVertex(c,d,1,g,y,new b.Vector2(Math.cos(D)*B,Math.sin(D)*B),null);D+=J;for(F=1;z/2>F;F++)G=this._storeVertex(c,d,F+1,g,y,new b.Vector2(Math.cos(D)*B,Math.sin(D)*B),x),this._storeIndex(f,e,3*F+0,H),this._storeIndex(f,e,3*F+1,G-1),this._storeIndex(f,e,3*F+2,G),D+=J;}break;case j.SquareAnchorCap:v=0;H=A?null:x;C=this._storeVertex(c,d,v++,g,y,new b.Vector2(0,q),H);G=this._storeVertex(c,d,v++,g,y,new b.Vector2(2*q,q),H);D=this._storeVertex(c,d,v++,g,y,new b.Vector2(2*q,-q),H);z=this._storeVertex(c,d,v++,g,y,new b.Vector2(0,-q),H);A?(J=this._storeVertex(c,d,v++,g,y,new b.Vector2(0,B+t),null),F=this._storeVertex(c,d,v++,g,y,new b.Vector2(-t,B+t),x),E=this._storeVertex(c,d,v++,g,y,new b.Vector2(-t,q+t),x),L=this._storeVertex(c,d,v++,g,y,new b.Vector2(2*q+t,q+t),x),N=this._storeVertex(c,d,v++,g,y,new b.Vector2(2*q+t,-(q+t)),x),q=this._storeVertex(c,d,v++,g,y,new b.Vector2(-t,-(q+t)),x),O=this._storeVertex(c,d,v++,g,y,new b.Vector2(-t,-(B+t)),x),v=this._storeVertex(c,d,v++,g,y,new b.Vector2(0,-(B+t)),null),A=0,this._storeIndex(f,e,A++,F),this._storeIndex(f,e,A++,C),this._storeIndex(f,e,A++,J),this._storeIndex(f,e,A++,F),this._storeIndex(f,e,A++,E),this._storeIndex(f,e,A++,C),this._storeIndex(f,e,A++,C),this._storeIndex(f,e,A++,E),this._storeIndex(f,e,A++,L),this._storeIndex(f,e,A++,C),this._storeIndex(f,e,A++,L),this._storeIndex(f,e,A++,G),this._storeIndex(f,e,A++,G),this._storeIndex(f,e,A++,L),this._storeIndex(f,e,A++,N),this._storeIndex(f,e,A++,G),this._storeIndex(f,e,A++,N),this._storeIndex(f,e,A++,D),this._storeIndex(f,e,A++,D),this._storeIndex(f,e,A++,N),this._storeIndex(f,e,A++,q),this._storeIndex(f,e,A++,D),this._storeIndex(f,e,A++,q),this._storeIndex(f,e,A++,z),this._storeIndex(f,e,A++,q),this._storeIndex(f,e,A++,O),this._storeIndex(f,e,A++,z),this._storeIndex(f,e,A++,O),this._storeIndex(f,e,A++,v),this._storeIndex(f,e,A++,z)):(this._storeIndex(f,e,0,C),this._storeIndex(f,e,1,G),this._storeIndex(f,e,2,D),this._storeIndex(f,e,3,C),this._storeIndex(f,e,4,D),this._storeIndex(f,e,5,z));break;case j.RoundAnchorCap:B=Math.sqrt(q*q-B*B);C=new b.Vector2(B,0);D=b.Tools.ToRadians(-150);J=b.Tools.ToRadians(300)/(z-1);if(A)for(F=A=0;z>F;F++)C=this._storeVertex(c,d,2*F+0,g,y,new b.Vector2(B+Math.cos(D)*q,Math.sin(D)*q),null),G=this._storeVertex(c,d,2*F+1,g,y,new b.Vector2(B+Math.cos(D)*(q+t),Math.sin(D)*(q+t)),x),0<F&&(this._storeIndex(f,e,A++,C-2),this._storeIndex(f,e,A++,G-2),this._storeIndex(f,e,A++,G),this._storeIndex(f,e,A++,C-2),this._storeIndex(f,e,A++,G),this._storeIndex(f,e,A++,C)),D+=J;else{H=this._storeVertex(c,d,0,g,y,C,null);this._storeVertex(c,d,1,g,y,new b.Vector2(B+Math.cos(D)*q,Math.sin(D)*q),null);D+=J;for(F=1;z>F;F++)G=this._storeVertex(c,d,F+1,g,y,new b.Vector2(B+Math.cos(D)*q,Math.sin(D)*q),x),this._storeIndex(f,e,3*F+0,H),this._storeIndex(f,e,3*F+1,G-1),this._storeIndex(f,e,3*F+2,G),D+=J;this._storeIndex(f,e,3*z+0,H);this._storeIndex(f,e,3*z+1,H+1);this._storeIndex(f,e,3*z+2,H+z);}break;case j.DiamondAnchorCap:v=0,H=A?null:x,C=this._storeVertex(c,d,v++,g,y,new b.Vector2(0,B),H),G=this._storeVertex(c,d,v++,g,y,new b.Vector2(B,q),H),D=this._storeVertex(c,d,v++,g,y,new b.Vector2(3*B,0),H),z=this._storeVertex(c,d,v++,g,y,new b.Vector2(B,-q),H),J=this._storeVertex(c,d,v++,g,y,new b.Vector2(0,-B),H),A?(H=Math.sqrt(2*t*t),F=this._storeVertex(c,d,v++,g,y,new b.Vector2(-H,B),x),E=this._storeVertex(c,d,v++,g,y,new b.Vector2(B,q+H),x),L=this._storeVertex(c,d,v++,g,y,new b.Vector2(3*B+H,0),x),N=this._storeVertex(c,d,v++,g,y,new b.Vector2(B,-(q+H)),x),q=this._storeVertex(c,d,v++,g,y,new b.Vector2(-H,-B),x),A=0,this._storeIndex(f,e,A++,F),this._storeIndex(f,e,A++,E),this._storeIndex(f,e,A++,C),this._storeIndex(f,e,A++,C),this._storeIndex(f,e,A++,E),this._storeIndex(f,e,A++,G),this._storeIndex(f,e,A++,G),this._storeIndex(f,e,A++,E),this._storeIndex(f,e,A++,L),this._storeIndex(f,e,A++,G),this._storeIndex(f,e,A++,L),this._storeIndex(f,e,A++,D),this._storeIndex(f,e,A++,D),this._storeIndex(f,e,A++,L),this._storeIndex(f,e,A++,N),this._storeIndex(f,e,A++,D),this._storeIndex(f,e,A++,N),this._storeIndex(f,e,A++,z),this._storeIndex(f,e,A++,z),this._storeIndex(f,e,A++,N),this._storeIndex(f,e,A++,q),this._storeIndex(f,e,A++,z),this._storeIndex(f,e,A++,q),this._storeIndex(f,e,A++,J)):(this._storeIndex(f,e,0,C),this._storeIndex(f,e,1,G),this._storeIndex(f,e,2,D),this._storeIndex(f,e,3,C),this._storeIndex(f,e,4,D),this._storeIndex(f,e,5,J),this._storeIndex(f,e,6,J),this._storeIndex(f,e,7,D),this._storeIndex(f,e,8,z));}return null;},j.prototype._buildLine=function(c,d,f,e){var g,j,q,v,y,B,A;y4tt.q9();g=b.Vector2.Zero(),j=b.Vector2.Zero(),q=b.Vector2.Zero(),v=b.Vector2.Zero(),y=null;this.closed&&this.points.push(this.points[0]);for(var x=this.points.length,z=1;x>z;z++){B=this.points[z],A=z<this.points.length-1?this.points[z+1]:null;(this._direction(B,this.points[z-1],g),y||(y=b.Vector2.Zero(),this._perp(g,y)),1===z&&this._store(c,d,0,x,this.points[0],y,f,e),A)?(this._direction(A,B,j),B=this._computeMiter(q,v,g,j),this._store(c,d,z,x,this.points[z],v,B*f,B*e,z-1)):(this._perp(g,y),this._store(c,d,z,x,this.points[z],y,f,e,z-1));}if(2<this.points.length&&this.closed&&(z=this.points[0],B=this.points[1],this._direction(z,this.points[x-2],g),this._direction(B,z,j),this._perp(g,y),g=this._computeMiter(q,v,g,j),this._store(c,null,0,x,this.points[0],v,g*f,g*e,1),d))f=null==e?0:4,d[0].x=c[f+0],d[0].y=c[f+1],d[1].x=c[f+2],d[1].y=c[f+3];this.closed&&this.points.splice(x-1);},j.prototype.setupModelRenderCache=function(c){var d,f;d=this.owner.engine;if(null===this._fillVB&&this._computeLines2D(),this.fill){c.fillVB=d.createVertexBuffer(this._fillVB);c.fillIB=d.createIndexBuffer(this._fillIB);c.fillIndicesCount=this._fillIB.length;f=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_FILLPARTID,["position"],!0);f&&(c.effectFillInstanced=d.createEffect("lines2d",f.attributes,f.uniforms,[],f.defines,null));f=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_FILLPARTID,["position"],!1);c.effectFill=d.createEffect("lines2d",f.attributes,f.uniforms,[],f.defines,null);}this.border&&(c.borderVB=d.createVertexBuffer(this._borderVB),c.borderIB=d.createIndexBuffer(this._borderIB),c.borderIndicesCount=this._borderIB.length,(f=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_BORDERPARTID,["position"],!0))&&(c.effectBorderInstanced=d.createEffect({vertex:"lines2d",fragment:"lines2d"},f.attributes,f.uniforms,[],f.defines,null)),f=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_BORDERPARTID,["position"],!1),c.effectBorder=d.createEffect({vertex:"lines2d",fragment:"lines2d"},f.attributes,f.uniforms,[],f.defines,null));return this._fillVB=null,this._fillIB=null,this._borderVB=null,this._borderIB=null,c;},j.prototype._computeLines2D=function(){var c,d,f,e,g,q,t,v,y;this._boundingMin=new b.Vector2(Number.MAX_VALUE,Number.MAX_VALUE);this._boundingMax=new b.Vector2(Number.MIN_VALUE,Number.MIN_VALUE);c=[],d=[],f=[];if(this.fill){e=this._getCapSize(this.startCap),g=this._getCapSize(this.endCap),q=this.points.length,t=4*q+e.vbsize+g.vbsize,t=this._fillVB=new Float32Array(t),v=this.fillThickness/2,y=this.points.length;this._buildLine(t,this.border?null:c,v);for(var v=2*y,x=2*(q-(this.closed?0:1)),g=this._fillIB=new Float32Array(3*x+e.ibsize+g.ibsize),z=0;x>z;z+=2)g[3*z+0]=z+0,g[3*z+1]=z+1,g[3*z+2]=(z+2)%v,g[3*z+3]=z+1,g[3*z+4]=(z+3)%v,g[3*z+5]=(z+2)%v;this._buildCap(t,4*q,g,3*x,this.points[0],this.fillThickness,null,this.startCap,j._startDir,this.border?null:d);this._buildCap(t,4*q+e.vbsize,g,3*x+e.ibsize,this.points[y-1],this.fillThickness,null,this.endCap,j._endDir,this.border?null:d);}if(this.border){e=this._getCapSize(this.startCap,!0);g=this._getCapSize(this.endCap,!0);q=this.points.length;t=8*q+e.vbsize+g.vbsize;t=this._borderVB=new Float32Array(t);v=this.fillThickness/2;x=this.borderThickness;y=this.points.length;this._buildLine(t,c,v,x);v=4*y;x=4*(q-(this.closed?0:1));g=this._borderIB=new Float32Array(3*x+e.ibsize+g.ibsize);for(z=0;x>z;z+=4)g[3*z+0]=z+0,g[3*z+1]=z+2,g[3*z+2]=(z+6)%v,g[3*z+3]=z+0,g[3*z+4]=(z+6)%v,g[3*z+5]=(z+4)%v,g[3*z+6]=z+3,g[3*z+7]=z+1,g[3*z+8]=(z+5)%v,g[3*z+9]=z+3,g[3*z+10]=(z+5)%v,g[3*z+11]=(z+7)%v;this._buildCap(t,8*q,g,3*x,this.points[0],this.fillThickness,this.borderThickness,this.startCap,j._startDir,d);this._buildCap(t,8*q+e.vbsize,g,3*x+e.ibsize,this.points[y-1],this.fillThickness,this.borderThickness,this.endCap,j._endDir,f);}if(this._contour=c,0<d.length)this._startCapTriIndices=Earcut.earcut(d,null,2),this._startCapContour=d;0<f.length&&(c=Earcut.earcut(f,null,2),this._endCapContour=f,this._endCapTriIndices=c);y4tt.v9();f=this._boundingMax.subtract(this._boundingMin);this._size.width=f.x;this._size.height=f.y;},Object.defineProperty(j.prototype,"size",{get:function(){y4tt.v9();return null==this._size&&this._computeLines2D(),this._size;},enumerable:!0,configurable:!0}),j.prototype.createInstanceDataParts=function(){var c;y4tt.v9();c=[];return this.border&&c.push(new d(b.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&c.push(new d(b.Shape2D.SHAPE2D_FILLPARTID)),c;},j.prototype.refreshInstanceDataPart=function(c){if(!q.prototype.refreshInstanceDataPart.call(this,c))return!1;c.id===b.Shape2D.SHAPE2D_BORDERPARTID?this.border instanceof b.GradientColorBrush2D&&(c.boundingMin=this.boundingMin,c.boundingMax=this.boundingMax):c.id===b.Shape2D.SHAPE2D_FILLPARTID&&this.fill instanceof b.GradientColorBrush2D&&(c.boundingMin=this.boundingMin,c.boundingMax=this.boundingMax);return!0;},j._prevA=b.Vector2.Zero(),j._prevB=b.Vector2.Zero(),j._curA=b.Vector2.Zero(),j._curB=b.Vector2.Zero(),j._miterTps=b.Vector2.Zero(),j._startDir=b.Vector2.Zero(),j._endDir=b.Vector2.Zero(),j._tpsV=b.Vector2.Zero(),j._noCap=0,j._roundCap=1,j._triangleCap=2,j._squareAnchorCap=3,j._roundAnchorCap=4,j._diamondAnchorCap=5,j._arrowCap=6,j._roundCapSubDiv=36,__decorate([b.modelLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+1,function(b){return j.pointsProperty=b;})],j.prototype,"points",null),__decorate([b.modelLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+2,function(b){y4tt.q9();return j.fillThicknessProperty=b;})],j.prototype,"fillThickness",null),__decorate([b.modelLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+3,function(b){y4tt.q9();return j.closedProperty=b;})],j.prototype,"closed",null),__decorate([b.modelLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+4,function(b){return j.startCapProperty=b;})],j.prototype,"startCap",null),__decorate([b.modelLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+5,function(b){y4tt.v9();return j.endCapProperty=b;})],j.prototype,"endCap",null),j=__decorate([b.className("Lines2D")],j));b.Lines2D=c;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q;e=function(){this._modelCache=new b.StringDictionary();};g=(e.prototype.GetOrAddModelCache=function(b,c){y4tt.q9();return this._modelCache.getOrAddWithFactory(b,c);},e.prototype.DisposeModelRenderCache=function(b){return b.isDisposed?(this._modelCache.remove(b.modelKey),!0):!1;},e);b.Canvas2DEngineBoundData=g;d=b.Group2D,f=function(c,e){var n,m,q,r;n=this;d.call(this,e);this.worldSpaceToNodeLocal=function(c){var d;d=n._worldSpaceNode;if(d)return d=d.getWorldMatrix().clone(),d.invert(),c=b.Vector3.TransformCoordinates(c,d),d=n._renderScaleFactor,c=new b.Vector2(c.x*d,c.y*d),d=n.actualSize,n.origin,c.x+=0.5*d.width,c.y+=0.5*d.width,c;};this._notifDebugMode=!1;this._mapCounter=0;b.Prim2DBase._isCanvasInit=!1;y4tt.v9();e||(e={});m=null==e.renderScaleFactor?1:e.renderScaleFactor;this._cachingStrategy!==f.CACHESTRATEGY_TOPLEVELGROUPS&&(this._background=new b.Rectangle2D({parent:this,id:"###CANVAS BACKGROUND###",size:e.size}),this._background.zOrder=1,this._background.isPickable=!1,this._background.origin=b.Vector2.Zero(),this._background.levelVisible=!1,null!=e.backgroundRoundRadius&&(this.backgroundRoundRadius=e.backgroundRoundRadius),null!=e.backgroundBorder&&("string"==typeof e.backgroundBorder?this.backgroundBorder=f.GetBrushFromString(e.backgroundBorder):this.backgroundBorder=e.backgroundBorder),null!=e.backgroundBorderThickNess&&(this.backgroundBorderThickness=e.backgroundBorderThickNess),null!=e.backgroundFill&&("string"==typeof e.backgroundFill?this.backgroundFill=f.GetBrushFromString(e.backgroundFill):this.backgroundFill=e.backgroundFill),this._background._patchHierarchy(this));q=c.getEngine();this.__engineData=q.getOrAddExternalDataWithFactory("__BJSCANVAS2D__",function(){return new g();});this._renderScaleFactor=m;this._primPointerInfo=new b.PrimitivePointerInfo();this._capturedPointers=new b.StringDictionary();this._pickStartingPosition=b.Vector2.Zero();this._hierarchyLevelMaxSiblingCount=50;this._hierarchyDepthOffset=0;this._siblingDepthOffset=1/this._hierarchyLevelMaxSiblingCount;this._scene=c;this._engine=q;this._renderingSize=new b.Size(0,0);this._trackedGroups=[];this._patchHierarchy(this);r=null==e.enableInteraction?!0:e.enableInteraction;this._fitRenderingDevice=!e.size;e.size?(e.size.height*=m,e.size.width*=m):e.size=new b.Size(q.getRenderWidth(),q.getRenderHeight());c.onDisposeObservable.add(function(){y4tt.v9();n.dispose();});this._isScreenSpace?this._afterRenderObserver=this._scene.onAfterRenderObservable.add(function(){n._engine.clear(null,!1,!0);n._render();}):this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(){n._render();});this._supprtInstancedArray=null!==this._engine.getCaps().instancedArrays;this._setupInteraction(r);};c=(__extends(f,d),f.prototype._canvasPreInit=function(b){this._cachingStrategy=null==b.cachingStrategy?f.CACHESTRATEGY_DONTCACHE:b.cachingStrategy;this._isScreenSpace=null==b.isScreenSpace?!0:b.isScreenSpace;},f.prototype._setupInteraction=function(b){var c,d;c=this;if(b!==this._interactionEnabled)if(this._interactionEnabled=b,this._isScreenSpace){if(!b)return void(this._scenePrePointerObserver&&(this.scene.onPrePointerObservable.remove(this._scenePrePointerObserver),this._scenePrePointerObserver=null));this._scenePrePointerObserver=this.scene.onPrePointerObservable.add(function(b,d){var f;f=1/c.engine.getHardwareScalingLevel(),f=b.localPosition.multiplyByFloats(f,f);c._handlePointerEventForInteraction(b,f,d);});}else{d=this.scene;b?(d.constantlyUpdateMeshUnderPointer=!0,this._scenePointerObserver=d.onPointerObservable.add(function(b,d){var f;if(b.pickInfo.hit&&b.pickInfo.pickedMesh===c._worldSpaceNode&&c.worldSpaceToNodeLocal){f=c.worldSpaceToNodeLocal(b.pickInfo.pickedPoint);c._handlePointerEventForInteraction(b,f,d);}})):this._scenePointerObserver&&(this.scene.onPointerObservable.remove(this._scenePointerObserver),this._scenePointerObserver=null);}},f.prototype._setPointerCapture=function(c,d){if(this.isPointerCaptured(c))return!1;try{this.engine.getRenderingCanvas().setPointerCapture(c);}catch(f){}y4tt.q9();return this._primPointerInfo.updateRelatedTarget(d,b.Vector2.Zero()),this._bubbleNotifyPrimPointerObserver(d,b.PrimitivePointerInfo.PointerGotCapture,null),this._capturedPointers.add(c.toString(),d),!0;},f.prototype._releasePointerCapture=function(c,d){if(this._capturedPointers.get(c.toString())!==d)return!1;try{this.engine.getRenderingCanvas().releasePointerCapture(c);}catch(f){}return this._primPointerInfo.updateRelatedTarget(d,b.Vector2.Zero()),this._bubbleNotifyPrimPointerObserver(d,b.PrimitivePointerInfo.PointerLostCapture,null),this._capturedPointers.remove(c.toString()),!0;},f.prototype.isPointerCaptured=function(b){y4tt.v9();return this._capturedPointers.contains(b.toString());},f.prototype.getCapturedPrimitive=function(b){return 0===this._capturedPointers.count?null:this._capturedPointers.get(b.toString());},f.prototype._handlePointerEventForInteraction=function(c,d){var f,e;if(!this.isDisposed){this._updatePointerInfo(c,d);f=this.getCapturedPrimitive(this._primPointerInfo.pointerId);if(this._updateIntersectionList(this._primPointerInfo.canvasPointerPos,null!==f),this._updateOverStatus(),this._actualOverPrimitive||f){e=f||this._actualOverPrimitive.prim,f=f?this._primPointerInfo.canvasPointerPos.subtract(new b.Vector2(e.globalTransform.m[12],e.globalTransform.m[13])):this._actualOverPrimitive.intersectionLocation;this._primPointerInfo.updateRelatedTarget(e,f);c.type===b.PointerEventTypes.POINTERWHEEL?this._bubbleNotifyPrimPointerObserver(e,b.PrimitivePointerInfo.PointerMouseWheel,c.event):c.type===b.PointerEventTypes.POINTERMOVE?this._bubbleNotifyPrimPointerObserver(e,b.PrimitivePointerInfo.PointerMove,c.event):c.type===b.PointerEventTypes.POINTERDOWN?this._bubbleNotifyPrimPointerObserver(e,b.PrimitivePointerInfo.PointerDown,c.event):c.type===b.PointerEventTypes.POINTERUP&&this._bubbleNotifyPrimPointerObserver(e,b.PrimitivePointerInfo.PointerUp,c.event);}}},f.prototype._updatePointerInfo=function(c,d){var f,e,g,q;f=this._primPointerInfo;f.canvasPointerPos||(f.canvasPointerPos=b.Vector2.Zero());e=this._scene.cameraToUseForPointers||this._scene.activeCamera,g=this._scene.getEngine();if(this._isScreenSpace){e=e.viewport.toGlobal(g.getRenderWidth(),g.getRenderHeight()),q=d.y-e.y;f.canvasPointerPos.x=d.x-e.x-this.actualPosition.x;f.canvasPointerPos.y=g.getRenderHeight()-q-this.actualPosition.y;}else f.canvasPointerPos.x=d.x,f.canvasPointerPos.y=d.y;(f.mouseWheelDelta=0,c.type===b.PointerEventTypes.POINTERWHEEL)?(g=c.event,g.wheelDelta?f.mouseWheelDelta=g.wheelDelta/(40*b.PrimitivePointerInfo.MouseWheelPrecision):g.detail&&(f.mouseWheelDelta=-g.detail/b.PrimitivePointerInfo.MouseWheelPrecision)):(g=c.event,f.ctrlKey=g.ctrlKey,f.altKey=g.altKey,f.shiftKey=g.shiftKey,f.metaKey=g.metaKey,f.button=g.button,f.buttons=g.buttons,f.pointerId=g.pointerId,f.width=g.width,f.height=g.height,f.presssure=g.pressure,f.tilt.x=g.tiltX,f.tilt.y=g.tiltY,f.isCaptured=null!==this.getCapturedPrimitive(g.pointerId));},f.prototype._updateIntersectionList=function(b,c){var d;y4tt.v9();if(this.scene.getRenderId()!==this._intersectionRenderId){this._globalTransform||this.updateCachedStates(!0);d=f._interInfo;if(d.pickPosition.x=b.x,d.pickPosition.y=b.y,d.findFirstOnly=!1,!c&&!this.boundingInfo.doesIntersect(d.pickPosition))return this._previousIntersectionList=this._actualIntersectionList,this._actualIntersectionList=null,this._previousOverPrimitive=this._actualOverPrimitive,void(this._actualOverPrimitive=null);this.intersect(d);this._previousIntersectionList=this._actualIntersectionList;this._actualIntersectionList=d.intersectedPrimitives;this._previousOverPrimitive=this._actualOverPrimitive;this._actualOverPrimitive=d.topMostIntersectedPrimitive;this._intersectionRenderId=this.scene.getRenderId();}},f.prototype._updateOverStatus=function(){var c,d,f;y4tt.v9();if(this.scene.getRenderId()!==this._hoverStatusRenderId&&this._previousIntersectionList&&this._actualIntersectionList){c=this._previousOverPrimitive?this._previousOverPrimitive.prim:null,d=this._actualOverPrimitive?this._actualOverPrimitive.prim:null;if(c!==d){f=this.getCapturedPrimitive(this._primPointerInfo.pointerId);(f&&f===c||!f&&c)&&(this._primPointerInfo.updateRelatedTarget(c,this._previousOverPrimitive.intersectionLocation),this._bubbleNotifyPrimPointerObserver(c,b.PrimitivePointerInfo.PointerOut,null));(f&&f===d||!f&&d)&&(this._primPointerInfo.updateRelatedTarget(d,this._actualOverPrimitive.intersectionLocation),this._bubbleNotifyPrimPointerObserver(d,b.PrimitivePointerInfo.PointerOver,null));}this._hoverStatusRenderId=this.scene.getRenderId();}},f.prototype._updatePrimPointerPos=function(b){var f;y4tt.q9();if(this._primPointerInfo.isCaptured)this._primPointerInfo.primitivePointerPos=this._primPointerInfo.relatedTargetPointerPos;else for(var c=0,d=this._actualIntersectionList;c<d.length;c++){f=d[c];if(f.prim===b)return void(this._primPointerInfo.primitivePointerPos=f.intersectionLocation);}},f.prototype._debugExecObserver=function(c,d){y4tt.v9();if(this._notifDebugMode){for(var f="",e=0;e<c.hierarchyDepth;e++)f+="  ";e=this._primPointerInfo;f+="[RID:"+this.scene.getRenderId()+"] ["+c.hierarchyDepth+"] event:"+b.PrimitivePointerInfo.getEventTypeName(d)+", id: "+c.id+" ("+b.Tools.getClassName(c)+"), primPos: "+e.primitivePointerPos.toString()+", canvasPos: "+e.canvasPointerPos.toString();console.log(f);}},f.prototype._bubbleNotifyPrimPointerObserver=function(c,d,f){var e;y4tt.v9();e=this._primPointerInfo;0!==(d&(b.PrimitivePointerInfo.PointerOver|b.PrimitivePointerInfo.PointerOut))&&this._notifParents(c,d);for(var g=!1;c;){if(!g&&(this._updatePrimPointerPos(c),this._debugExecObserver(c,d),c._pointerEventObservable.notifyObservers(e,d),this._triggerActionManager(c,e,d,f),e.cancelBubble)){if(0===(d&(b.PrimitivePointerInfo.PointerOver|b.PrimitivePointerInfo.PointerOut)))break;g=!0;}g&&this._updatePrimPointerPos(c);d===b.PrimitivePointerInfo.PointerOver?(this._debugExecObserver(c,b.PrimitivePointerInfo.PointerEnter),c._pointerEventObservable.notifyObservers(e,b.PrimitivePointerInfo.PointerEnter)):d===b.PrimitivePointerInfo.PointerOut&&(this._debugExecObserver(c,b.PrimitivePointerInfo.PointerLeave),c._pointerEventObservable.notifyObservers(e,b.PrimitivePointerInfo.PointerLeave));c=c.parent;}},f.prototype._triggerActionManager=function(c,d,f,e){var g;g=this;if(this._globalTransform||this.updateCachedStates(!0),0!==(f&b.PrimitivePointerInfo.PointerDown)){if(this._pickStartingPosition=d.primitivePointerPos.clone(),this._pickStartingTime=new Date().getTime(),this._pickedDownPrim=null,c.actionManager){if(this._pickedDownPrim=c,c.actionManager.hasPickTriggers){f=b.ActionEvent.CreateNewFromPrimitive(c,d.primitivePointerPos,e);switch(e.button){case 0:c.actionManager.processTrigger(b.ActionManager.OnLeftPickTrigger,f);break;case 1:c.actionManager.processTrigger(b.ActionManager.OnCenterPickTrigger,f);break;case 2:c.actionManager.processTrigger(b.ActionManager.OnRightPickTrigger,f);}c.actionManager.processTrigger(b.ActionManager.OnPickDownTrigger,f);}c.actionManager.hasSpecificTrigger(b.ActionManager.OnLongPressTrigger)&&window.setTimeout(function(){var d,f;d=g._primPointerInfo,f=g.getCapturedPrimitive(d.pointerId);g._updateIntersectionList(d.canvasPointerPos,null!==f);f=new b.IntersectInfo2D();f.pickPosition=d.canvasPointerPos.clone();y4tt.q9();f.findFirstOnly=!1;g.intersect(f);null!==f.isPrimIntersected(c)&&c.actionManager&&0!==g._pickStartingTime&&new Date().getTime()-g._pickStartingTime>b.ActionManager.LongPressDelay&&Math.abs(g._pickStartingPosition.x-f.pickPosition.x)<b.ActionManager.DragMovementThreshold&&Math.abs(g._pickStartingPosition.y-f.pickPosition.y)<b.ActionManager.DragMovementThreshold&&(g._pickStartingTime=0,c.actionManager.processTrigger(b.ActionManager.OnLongPressTrigger,b.ActionEvent.CreateNewFromPrimitive(c,d.primitivePointerPos,e)));},b.ActionManager.LongPressDelay);}}else 0!==(f&b.PrimitivePointerInfo.PointerUp)?(this._pickStartingTime=0,f=b.ActionEvent.CreateNewFromPrimitive(c,d.primitivePointerPos,e),c.actionManager&&(c.actionManager.processTrigger(b.ActionManager.OnPickUpTrigger,f),Math.abs(this._pickStartingPosition.x-d.canvasPointerPos.x)<b.ActionManager.DragMovementThreshold&&Math.abs(this._pickStartingPosition.y-d.canvasPointerPos.y)<b.ActionManager.DragMovementThreshold&&c.actionManager.processTrigger(b.ActionManager.OnPickTrigger,f)),this._pickedDownPrim&&this._pickedDownPrim.actionManager&&this._pickedDownPrim!==c&&this._pickedDownPrim.actionManager.processTrigger(b.ActionManager.OnPickOutTrigger,f)):0!==(f&b.PrimitivePointerInfo.PointerOver)?c.actionManager&&(f=b.ActionEvent.CreateNewFromPrimitive(c,d.primitivePointerPos,e),c.actionManager.processTrigger(b.ActionManager.OnPointerOverTrigger,f)):0!==(f&b.PrimitivePointerInfo.PointerOut)&&c.actionManager&&(f=b.ActionEvent.CreateNewFromPrimitive(c,d.primitivePointerPos,e),c.actionManager.processTrigger(b.ActionManager.OnPointerOutTrigger,f));},f.prototype._notifParents=function(c,d){y4tt.q9();for(var f=this._primPointerInfo,e=this;e;)this._updatePrimPointerPos(e),d===b.PrimitivePointerInfo.PointerOver?(this._debugExecObserver(e,b.PrimitivePointerInfo.PointerEnter),e._pointerEventObservable.notifyObservers(f,b.PrimitivePointerInfo.PointerEnter)):d===b.PrimitivePointerInfo.PointerOut&&(this._debugExecObserver(e,b.PrimitivePointerInfo.PointerLeave),e._pointerEventObservable.notifyObservers(f,b.PrimitivePointerInfo.PointerLeave)),e=e.parent;},f.prototype.dispose=function(){y4tt.q9();return d.prototype.dispose.call(this)?(this.interactionEnabled&&this._setupInteraction(!1),this._beforeRenderObserver&&(this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this._beforeRenderObserver=null),this._afterRenderObserver&&(this._scene.onAfterRenderObservable.remove(this._afterRenderObserver),this._afterRenderObserver=null),void(this._groupCacheMaps&&(this._groupCacheMaps.forEach(function(b){return b.dispose();}),this._groupCacheMaps=null))):!1;},Object.defineProperty(f.prototype,"scene",{get:function(){return this._scene;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"engine",{get:function(){return this._engine;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"cachingStrategy",{get:function(){return this._cachingStrategy;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"worldSpaceCanvasNode",{get:function(){y4tt.v9();return this._worldSpaceNode;},set:function(b){this._worldSpaceNode=b;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"supportInstancedArray",{get:function(){y4tt.v9();return this._supprtInstancedArray;},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"backgroundFill",{get:function(){y4tt.v9();return this._background&&this._background.isVisible?this._background.fill:null;},set:function(b){this.checkBackgroundAvailability();b!==this._background.fill&&(this._background.fill=b,this._background.levelVisible=!0);},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"backgroundBorder",{get:function(){y4tt.v9();return this._background&&this._background.isVisible?this._background.border:null;},set:function(b){y4tt.q9();this.checkBackgroundAvailability();b!==this._background.border&&(this._background.border=b,this._background.levelVisible=!0);},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"backgroundBorderThickness",{get:function(){y4tt.q9();return this._background&&this._background.isVisible?this._background.borderThickness:null;},set:function(b){y4tt.q9();this.checkBackgroundAvailability();b!==this._background.borderThickness&&(this._background.borderThickness=b);},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"backgroundRoundRadius",{get:function(){return this._background&&this._background.isVisible?this._background.roundRadius:null;},set:function(b){this.checkBackgroundAvailability();b!==this._background.roundRadius&&(this._background.roundRadius=b,this._background.levelVisible=!0);},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"interactionEnabled",{get:function(){y4tt.v9();return this._interactionEnabled;},set:function(b){y4tt.v9();this._setupInteraction(b);},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"_engineData",{get:function(){return this.__engineData;},enumerable:!0,configurable:!0}),f.prototype.checkBackgroundAvailability=function(){if(this._cachingStrategy===f.CACHESTRATEGY_TOPLEVELGROUPS)throw Error("Can't use Canvas Background with the caching strategy TOPLEVELGROUPS");},f.prototype.onPrimBecomesDirty=function(){this._addPrimToDirtyList(this);},f.prototype._updateTrackedNodes=function(){var c,q,r;c=this.scene.cameraToUseForPointers||this.scene.activeCamera;c.getViewMatrix().multiplyToRef(c.getProjectionMatrix(),f._m);for(var d=this.engine.getRenderHeight(),c=c.viewport.toGlobal(this.engine.getRenderWidth(),d),e=0,g=this._trackedGroups;e<g.length;e++){q=g[e];if(!q.isDisposed&&q.isVisible){r=q.trackedNode.getWorldMatrix(),r=b.Vector3.Project(f._v,r,f._m,c);q.x=Math.round(r.x);q.y=Math.round(d-r.y);}}},f.prototype._updateCanvasState=function(){var c,d;y4tt.q9();if(this.scene.getRenderId()!==this._updateRenderId){c=!1,d=this.engine.getRenderWidth();d!==this._renderingSize.width&&(c=!0);this._renderingSize.width=d;d=this.engine.getRenderHeight();d!==this._renderingSize.height&&(c=!0);this._renderingSize.height=d;c&&this._fitRenderingDevice&&(this.size=this._renderingSize,this._background&&(this._background.size=this.size),this._setLayoutDirty());c=new b.PrepareRender2DContext();++this._globalTransformProcessStep;this.updateCachedStates(!1);this._prepareGroupRender(c);this._updateRenderId=this.scene.getRenderId();}},f.prototype._render=function(){this._updateTrackedNodes();this._updateCanvasState();this._primPointerInfo.canvasPointerPos&&(this._updateIntersectionList(this._primPointerInfo.canvasPointerPos,!1),this._updateOverStatus());this.engine.setState(!1);this._groupRender();this._cachingStrategy===f.CACHESTRATEGY_CANVAS&&this._cachedCanvasGroup&&this._cachedCanvasGroup._renderCachedCanvas();},f.prototype._allocateGroupCache=function(c,d,e){var g,s,t;g=c.actualSize,g=new b.Size(Math.ceil(g.width),Math.ceil(g.height));e&&(g.width=Math.max(e.width,g.width),g.height=Math.max(e.height,g.height));this._groupCacheMaps||(this._groupCacheMaps=[]);e=null;for(var q=0,r=this._groupCacheMaps;q<r.length;q++){s=r[q],t=s.allocateRect(g);if(t){e={node:t,texture:s};break;}}e||(e=new b.Size(f._groupTextureCacheSize,f._groupTextureCacheSize),(g.width>e.width||g.height>e.height)&&(e.width=Math.pow(2,Math.ceil(Math.log(g.width)/Math.log(2))),e.height=Math.pow(2,Math.ceil(Math.log(g.height)/Math.log(2)))),s=new b.MapTexture("groupsMapChache"+this._mapCounter+"forCanvas"+this.id,this._scene,e),this._groupCacheMaps.push(s),t=s.allocateRect(g),e={node:t,texture:s});if(c!==this||this._isScreenSpace)t=e.node,this._cachingStrategy===f.CACHESTRATEGY_CANVAS?(this._cachedCanvasGroup=b.Group2D._createCachedCanvasGroup(this),d=new b.Sprite2D(s,{parent:this._cachedCanvasGroup,id:"__cachedCanvasSprite__",spriteSize:t.contentSize,spriteLocation:t.pos}),d.zOrder=1,d.origin=b.Vector2.Zero()):(d=new b.Sprite2D(s,{parent:d,id:"__cachedSpriteOfGroup__"+c.id,x:c.actualPosition.x,y:c.actualPosition.y,spriteSize:t.contentSize,spriteLocation:t.pos}),d.origin=c.origin.clone(),e.sprite=d);return e;},f.prototype._registerTrackedNode=function(c){y4tt.q9();c._isFlagSet(b.SmartPropertyPrim.flagTrackedGroup)||(this._trackedGroups.push(c),c._setFlags(b.SmartPropertyPrim.flagTrackedGroup));},f.prototype._unregisterTrackedNode=function(c){var d;if(c._isFlagSet(b.SmartPropertyPrim.flagTrackedGroup)){d=this._trackedGroups.indexOf(c);-1!==d&&this._trackedGroups.splice(d,1);c._clearFlags(b.SmartPropertyPrim.flagTrackedGroup);}},f.GetSolidColorBrush=function(c){return f._solidColorBrushes.getOrAddWithFactory(c.toHexString(),function(){return new b.SolidColorBrush2D(c.clone(),!0);});},f.GetSolidColorBrushFromHex=function(c){y4tt.q9();return f._solidColorBrushes.getOrAddWithFactory(c,function(){return new b.SolidColorBrush2D(b.Color4.FromHexString(c),!0);});},f.GetGradientColorBrush=function(c,d,e,g,q){return void 0===e&&(e=b.Vector2.Zero()),void 0===g&&(g=0),void 0===q&&(q=1),f._gradientColorBrushes.getOrAddWithFactory(b.GradientColorBrush2D.BuildKey(c,d,e,g,q),function(){return new b.GradientColorBrush2D(c,d,e,g,q,!0);});},f.GetBrushFromString=function(c){var d,e,g,q,r,s,t,v;y4tt.v9();c=c.trim();d=c.split(",");if(1===d.length){d=null;if(0===c.indexOf("solid:"))d=c.substr(6).trim();else{if(0!==c.indexOf("#"))return null;d=c;}return f.GetSolidColorBrushFromHex(d);}0===d[0].indexOf("gradient:")&&(d[0]=d[0].substr(9).trim());try{e=b.Color4.FromHexString(d[0].trim()),g=b.Color4.FromHexString(d[1].trim()),q=b.Vector2.Zero();if(2<d.length){r=d[2].trim();if("["!==r.charAt(0)||"]"!==r.charAt(r.length-1))return null;s=r.indexOf(":"),t=parseFloat(r.substr(1,s)),v=parseFloat(r.substr(s+1,r.length-(s+1))),q=new b.Vector2(t,v);}c=0;3<d.length&&(c=b.Tools.ToRadians(parseFloat(d[3].trim())));r=1;return 4<d.length&&(r=parseFloat(d[4].trim())),f.GetGradientColorBrush(e,g,q,c,r);}catch(y){return null;}},f.CACHESTRATEGY_TOPLEVELGROUPS=1,f.CACHESTRATEGY_ALLGROUPS=2,f.CACHESTRATEGY_CANVAS=3,f.CACHESTRATEGY_DONTCACHE=4,f.hierarchyLevelMaxSiblingCount=50,f._interInfo=new b.IntersectInfo2D(),f._v=b.Vector3.Zero(),f._m=b.Matrix.Identity(),f._groupTextureCacheSize=1024,f._solidColorBrushes=new b.StringDictionary(),f._gradientColorBrushes=new b.StringDictionary(),f=__decorate([b.className("Canvas2D")],f));b.Canvas2D=c;q=function(d,f,e){var g,q;b.Prim2DBase._isCanvasInit=!0;y4tt.q9();if(e.isScreenSpace=!1,e.size=f.clone(),e.cachingStrategy=null==e.cachingStrategy?c.CACHESTRATEGY_CANVAS:e.cachingStrategy,e.cachingStrategy!==c.CACHESTRATEGY_CANVAS)throw Error("Right now only the CACHESTRATEGY_CANVAS cache Strategy is supported for WorldSpace Canvas. More will come soon!");c.call(this,d,e);b.Prim2DBase._isCanvasInit=!1;g=e?e.id||null:null;if(!e||null==e.customWorldSpaceNode){q=new b.WorldSpaceCanvas2DNode(g,d,this);f=b.VertexData.CreatePlane({width:f.width,height:f.height,sideOrientation:e&&e.sideOrientation||b.Mesh.DEFAULTSIDE});d=new b.StandardMaterial(g+"_Material",d);this.applyCachedTexture(f,d);f.applyToMesh(q,!1);d.specularColor=new b.Color3(0,0,0);d.disableLighting=!0;d.useAlphaFromDiffuseTexture=!0;q.position=e&&e.worldPosition||b.Vector3.Zero();q.rotationQuaternion=e&&e.worldRotation||b.Quaternion.Identity();q.material=d;this._worldSpaceNode=q;}else this._worldSpaceNode=e.customWorldSpaceNode,this.applyCachedTexture(null,null);},e=(__extends(q,c),q=__decorate([b.className("WorldSpaceCanvas2D")],q));b.WorldSpaceCanvas2D=e;y4tt.v9();q=function(d,f){y4tt.q9();b.Prim2DBase._isCanvasInit=!0;c.call(this,d,f);};e=(__extends(q,c),q=__decorate([b.className("ScreenSpaceCanvas2D")],q));b.ScreenSpaceCanvas2D=e;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.Mesh;g=function(b,d,f){e.call(this,b,d);this._canvas=f;};y4tt.v9();g=(__extends(g,e),g.prototype.dispose=function(){e.prototype.dispose.call(this);this._canvas&&(this._canvas.dispose(),this._canvas=null);},g);b.WorldSpaceCanvas2DNode=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d;e=function(){y4tt.v9();this.layoutDirtyOnPropertyChangedMask=0;};g=(e.prototype.updateLayout=function(){},Object.defineProperty(e.prototype,"isChildPositionAllowed",{get:function(){y4tt.q9();return!1;},enumerable:!0,configurable:!0}),e.prototype.isLocked=function(){return this._isLocked;},e.prototype.lock=function(){return this._isLocked?!1:(this._isLocked=!0,!0);},e=__decorate([b.className("LayoutEngineBase")],e));b.LayoutEngineBase=g;c=function(){g.apply(this,arguments);},e=(__extends(c,g),c.prototype.updateLayout=function(c){if(c._isFlagSet(b.SmartPropertyPrim.flagLayoutDirty)){for(var d=0,e=c.children;d<e.length;d++)this._doUpdate(e[d]);c._clearFlags(b.SmartPropertyPrim.flagLayoutDirty);}},c.prototype._doUpdate=function(c){y4tt.q9();c instanceof b.Canvas2D?c.layoutArea=c.actualSize:c.parent instanceof b.Canvas2D?c.layoutArea=c.owner.actualSize:c.layoutArea=c.parent.contentArea;},Object.defineProperty(c.prototype,"isChildPositionAllowed",{get:function(){return!0;},enumerable:!0,configurable:!0}),c.Singleton=new c(),c=__decorate([b.className("CanvasLayoutEngine")],c));b.CanvasLayoutEngine=e;d=function(){g.call(this);this._isHorizontal=!0;this.layoutDirtyOnPropertyChangedMask=b.Prim2DBase.sizeProperty.flagId;},e=(__extends(d,g),Object.defineProperty(d,"Horizontal",{get:function(){return d._horizontal||(d._horizontal=new d(),d._horizontal.isHorizontal=!0,d._horizontal.lock()),d._horizontal;},enumerable:!0,configurable:!0}),Object.defineProperty(d,"Vertical",{get:function(){return d._vertical||(d._vertical=new d(),d._vertical.isHorizontal=!1,d._vertical.lock()),d._vertical;},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"isHorizontal",{get:function(){y4tt.v9();return this._isHorizontal;},set:function(b){this.isLocked()||(this._isHorizontal=b);},enumerable:!0,configurable:!0}),d.prototype.updateLayout=function(c){var r,s;y4tt.v9();if(c._isFlagSet(b.SmartPropertyPrim.flagLayoutDirty)){for(var d=0,e=0,g=this.isHorizontal,n=0,m=0,p=c.children;m<p.length;m++){r=p[m],s=r.layoutArea;r.margin.computeArea(r.actualSize,s);n=Math.max(n,g?s.height:s.width);}m=0;for(p=c.children;m<p.length;m++)r=p[m],r.layoutAreaPos=new b.Vector2(d,e),s=r.layoutArea,g?(d+=s.width,r.layoutArea=new b.Size(s.width,n)):(e+=s.height,r.layoutArea=new b.Size(n,s.height));c._clearFlags(b.SmartPropertyPrim.flagLayoutDirty);}},Object.defineProperty(d.prototype,"isChildPositionAllowed",{get:function(){return!1;},enumerable:!0,configurable:!0}),d._horizontal=null,d._vertical=null,d=__decorate([b.className("StackPanelLayoutEngine")],d));b.StackPanelLayoutEngine=e;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.Material,c=function(c,f,g,j){e.call(this,c,f);this._textures={};this._floats={};this._floatsArrays={};this._colors3={};this._colors4={};this._vectors2={};this._vectors3={};this._vectors4={};this._matrices={};this._matrices3x3={};this._matrices2x2={};this._cachedWorldViewMatrix=new b.Matrix();this._shaderPath=g;j.needAlphaBlending=j.needAlphaBlending||!1;j.needAlphaTesting=j.needAlphaTesting||!1;j.attributes=j.attributes||["position","normal","uv"];j.uniforms=j.uniforms||["worldViewProjection"];j.samplers=j.samplers||[];j.defines=j.defines||[];this._options=j;};g=(__extends(c,e),c.prototype.needAlphaBlending=function(){y4tt.q9();return this._options.needAlphaBlending;},c.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting;},c.prototype._checkUniform=function(b){-1===this._options.uniforms.indexOf(b)&&this._options.uniforms.push(b);},c.prototype.setTexture=function(b,c){y4tt.v9();return-1===this._options.samplers.indexOf(b)&&this._options.samplers.push(b),this._textures[b]=c,this;},c.prototype.setFloat=function(b,c){y4tt.q9();return this._checkUniform(b),this._floats[b]=c,this;},c.prototype.setFloats=function(b,c){y4tt.q9();return this._checkUniform(b),this._floatsArrays[b]=c,this;},c.prototype.setColor3=function(b,c){y4tt.v9();return this._checkUniform(b),this._colors3[b]=c,this;},c.prototype.setColor4=function(b,c){return this._checkUniform(b),this._colors4[b]=c,this;},c.prototype.setVector2=function(b,c){y4tt.q9();return this._checkUniform(b),this._vectors2[b]=c,this;},c.prototype.setVector3=function(b,c){y4tt.v9();return this._checkUniform(b),this._vectors3[b]=c,this;},c.prototype.setVector4=function(b,c){return this._checkUniform(b),this._vectors4[b]=c,this;},c.prototype.setMatrix=function(b,c){y4tt.v9();return this._checkUniform(b),this._matrices[b]=c,this;},c.prototype.setMatrix3x3=function(b,c){y4tt.v9();return this._checkUniform(b),this._matrices3x3[b]=c,this;},c.prototype.setMatrix2x2=function(b,c){return this._checkUniform(b),this._matrices2x2[b]=c,this;},c.prototype.isReady=function(c,f){var e,g,l,n;e=this.getScene(),g=e.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===e.getRenderId())return!0;l=[],n=new b.EffectFallbacks();f&&l.push("#define INSTANCES");for(var m=0;m<this._options.defines.length;m++)l.push(this._options.defines[m]);c&&c.useBones&&c.computeBonesUsingShaders&&(l.push("#define NUM_BONE_INFLUENCERS "+c.numBoneInfluencers),l.push("#define BonesPerMesh "+(c.skeleton.bones.length+1)),n.addCPUSkinningFallback(0,c));g.getAlphaTesting()&&l.push("#define ALPHATEST");m=this._effect;l=l.join("\n");return this._effect=g.createEffect(this._shaderPath,this._options.attributes,this._options.uniforms,this._options.samplers,l,n,this.onCompiled,this.onError),this._effect.isReady()?(m!==this._effect&&e.resetCachedMaterial(),this._renderId=e.getRenderId(),!0):!1;},c.prototype.bindOnlyWorldMatrix=function(b){var c;c=this.getScene();y4tt.q9();-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",b);-1!==this._options.uniforms.indexOf("worldView")&&(b.multiplyToRef(c.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix));-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",b.multiply(c.getTransformMatrix()));},c.prototype.bind=function(b,c){var j;if(this.bindOnlyWorldMatrix(b),this.getScene().getCachedMaterial()!==this){-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix());-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix());-1!==this._options.uniforms.indexOf("viewProjection")&&this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix());c&&c.useBones&&c.computeBonesUsingShaders&&this._effect.setMatrices("mBones",c.skeleton.getTransformMatrices(c));for(var g in this._textures)this._effect.setTexture(g,this._textures[g]);for(g in this._floats)this._effect.setFloat(g,this._floats[g]);for(g in this._floatsArrays)this._effect.setArray(g,this._floatsArrays[g]);for(g in this._colors3)this._effect.setColor3(g,this._colors3[g]);for(g in this._colors4){j=this._colors4[g];this._effect.setFloat4(g,j.r,j.g,j.b,j.a);}for(g in this._vectors2)this._effect.setVector2(g,this._vectors2[g]);for(g in this._vectors3)this._effect.setVector3(g,this._vectors3[g]);for(g in this._vectors4)this._effect.setVector4(g,this._vectors4[g]);for(g in this._matrices)this._effect.setMatrix(g,this._matrices[g]);for(g in this._matrices3x3)this._effect.setMatrix3x3(g,this._matrices3x3[g]);for(g in this._matrices2x2)this._effect.setMatrix2x2(g,this._matrices2x2[g]);}e.prototype.bind.call(this,b,c);},c.prototype.clone=function(b){return new c(b,this.getScene(),this._shaderPath,this._options);},c.prototype.dispose=function(b,c){if(c)for(var g in this._textures)this._textures[g].dispose();this._textures={};e.prototype.dispose.call(this,b,c);},c.prototype.serialize=function(){var c;c=b.SerializationHelper.Serialize(this);c.customType="BABYLON.ShaderMaterial";c.options=this._options;c.shaderPath=this._shaderPath;c.textures={};for(var f in this._textures)c.textures[f]=this._textures[f].serialize();c.floats={};for(f in this._floats)c.floats[f]=this._floats[f];c.floatArrays={};for(f in this._floatsArrays)c.floatArrays[f]=this._floatsArrays[f];c.colors3={};for(f in this._colors3)c.colors3[f]=this._colors3[f].asArray();c.colors4={};for(f in this._colors4)c.colors4[f]=this._colors4[f].asArray();c.vectors2={};for(f in this._vectors2)c.vectors2[f]=this._vectors2[f].asArray();c.vectors3={};y4tt.q9();for(f in this._vectors3)c.vectors3[f]=this._vectors3[f].asArray();c.vectors4={};for(f in this._vectors4)c.vectors4[f]=this._vectors4[f].asArray();c.matrices={};for(f in this._matrices)c.matrices[f]=this._matrices[f].asArray();c.matrices3x3={};for(f in this._matrices3x3)c.matrices3x3[f]=this._matrices3x3[f];c.matrices2x2={};for(f in this._matrices2x2)c.matrices2x2[f]=this._matrices2x2[f];return c;},c.Parse=function(d,f,e){var g,l;g=b.SerializationHelper.Parse(function(){y4tt.v9();return new c(d.name,f,d.shaderPath,d.options);},d,f,e);for(l in d.textures)g.setTexture(l,b.Texture.Parse(d.textures[l],f,e));for(l in d.floats)g.setFloat(l,d.floats[l]);for(l in d.floatsArrays)g.setFloats(l,d.floatsArrays[l]);for(l in d.colors3)g.setColor3(l,b.Color3.FromArray(d.colors3[l]));for(l in d.colors4)g.setColor4(l,b.Color4.FromArray(d.colors4[l]));for(l in d.vectors2)g.setVector2(l,b.Vector2.FromArray(d.vectors2[l]));for(l in d.vectors3)g.setVector3(l,b.Vector3.FromArray(d.vectors3[l]));for(l in d.vectors4)g.setVector4(l,b.Vector4.FromArray(d.vectors4[l]));y4tt.q9();for(l in d.matrices)g.setMatrix(l,b.Matrix.FromArray(d.matrices[l]));for(l in d.matrices3x3)g.setMatrix3x3(l,d.matrices3x3[l]);for(l in d.matrices2x2)g.setMatrix2x2(l,d.matrices2x2[l]);return g;},c);b.ShaderMaterial=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q;g=b.Internals||(b.Internals={}),e=function(b){return b.charCodeAt(0)+(b.charCodeAt(1)<<8)+(b.charCodeAt(2)<<16)+(b.charCodeAt(3)<<24);},c=e("DXT1"),d=e("DXT3"),f=e("DXT5"),q=function(){},e=(q.GetDDSInfo=function(b){var c;b=new Int32Array(b,0,31);c=1;return b[2]&131072&&(c=Math.max(1,b[7])),{width:b[4],height:b[3],mipmapCount:c,isFourCC:4===(b[20]&4),isRGB:64===(b[20]&64),isLuminance:131072===(b[20]&131072),isCube:512===(b[28]&512)};},q.GetRGBAArrayBuffer=function(b,c,d,f,e){var g,t;f=new Uint8Array(f);e=new Uint8Array(e);g=0;for(c-=1;0<=c;c--)for(var q=0;b>q;q++){t=d+4*(q+c*b);f[g+2]=e[t];f[g+1]=e[t+1];f[g]=e[t+2];f[g+3]=e[t+3];g+=4;}return f;},q.GetRGBArrayBuffer=function(b,c,d,f,e){var g,t;f=new Uint8Array(f);e=new Uint8Array(e);g=0;for(c-=1;0<=c;c--)for(var q=0;b>q;q++){t=d+3*(q+c*b);f[g+2]=e[t];f[g+1]=e[t+1];f[g]=e[t+2];g+=3;}return f;},q.GetLuminanceArrayBuffer=function(b,c,d,f,e){var g;f=new Uint8Array(f);y4tt.v9();e=new Uint8Array(e);g=0;for(c-=1;0<=c;c--)for(var q=0;b>q;q++)f[g]=e[d+(q+c*b)],g++;return f;},q.UploadDDSLevels=function(e,g,n,m,p,r){var s,t,v,y,x,z,B,A,D;A=new Int32Array(n,0,31);if(542327876!=A[0])return void b.Tools.Error("Invalid magic number in DDS header");if(!m.isFourCC&&!m.isRGB&&!m.isLuminance)return void b.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(m.isFourCC)switch(s=A[21]){case c:s=8;t=g.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case d:s=16;t=g.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case f:s=16;t=g.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return void console.error("Unsupported FourCC code:",String.fromCharCode(255&s,s>>8&255,s>>16&255,s>>24&255));}g=1;A[2]&131072&&!1!==p&&(g=Math.max(1,A[7]));for(var C=A[22],G=0;r>G;G++){D=1===r?e.TEXTURE_2D:e.TEXTURE_CUBE_MAP_POSITIVE_X+G;p=A[4];v=A[3];x=A[1]+4;for(B=0;g>B;++B)m.isRGB?24===C?(y=3*p*v,z=q.GetRGBArrayBuffer(p,v,x,y,n),e.texImage2D(D,B,e.RGB,p,v,0,e.RGB,e.UNSIGNED_BYTE,z)):(y=4*p*v,z=q.GetRGBAArrayBuffer(p,v,x,y,n),e.texImage2D(D,B,e.RGBA,p,v,0,e.RGBA,e.UNSIGNED_BYTE,z)):m.isLuminance?(y=e.getParameter(e.UNPACK_ALIGNMENT),y=Math.floor((p+y-1)/y)*y*(v-1)+p,z=q.GetLuminanceArrayBuffer(p,v,x,y,n),e.texImage2D(D,B,e.LUMINANCE,p,v,0,e.LUMINANCE,e.UNSIGNED_BYTE,z)):(y=Math.max(4,p)/4*Math.max(4,v)/4*s,z=new Uint8Array(n,x,y),e.compressedTexImage2D(D,B,t,p,v,0,z)),x+=y,p*=0.5,v*=0.5,p=Math.max(1,p),v=Math.max(1,v);}},q);g.DDSTools=e;!0;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(e,c){return void 0===e&&(e=!0),void 0===c&&(c=10),this._useDeltaForWorldStep=e,this.name="CannonJSPlugin",this._physicsMaterials=[],this._fixedTimeStep=1/60,this._currentCollisionGroup=2,this._minus90X=new b.Quaternion(-0.7071067811865475,0,0,0.7071067811865475),this._plus90X=new b.Quaternion(0.7071067811865475,0,0,0.7071067811865475),this._tmpPosition=b.Vector3.Zero(),this._tmpQuaternion=new b.Quaternion(),this._tmpDeltaPosition=b.Vector3.Zero(),this._tmpDeltaRotation=new b.Quaternion(),this._tmpUnityRotation=new b.Quaternion(),this.isSupported()?(this.world=new CANNON.World(),this.world.broadphase=new CANNON.NaiveBroadphase(),void(this.world.solver.iterations=c)):void b.Tools.Error("CannonJS is not available. Please make sure you included the js file.");};g=(g.prototype.setGravity=function(b){y4tt.v9();this.world.gravity.copy(b);},g.prototype.setTimeStep=function(b){this._fixedTimeStep=b;},g.prototype.executeStep=function(b){y4tt.v9();this.world.step(this._fixedTimeStep,this._useDeltaForWorldStep?1E3*b:0,3);},g.prototype.applyImpulse=function(b,c,d){d=new CANNON.Vec3(d.x,d.y,d.z);c=new CANNON.Vec3(c.x,c.y,c.z);y4tt.v9();b.physicsBody.applyImpulse(c,d);},g.prototype.applyForce=function(b,c,d){d=new CANNON.Vec3(d.x,d.y,d.z);c=new CANNON.Vec3(c.x,c.y,c.z);b.physicsBody.applyImpulse(c,d);},g.prototype.generatePhysicsBody=function(b){var c,d,f,g,j;y4tt.q9();if(b.parent)return void(b.physicsBody&&(this.removePhysicsBody(b),b.forceUpdate()));if(b.isBodyInitRequired()){c=this._createShape(b),d=b.physicsBody;d&&this.removePhysicsBody(b);f=this._addMaterial("mat-"+b.uniqueId,b.getParam("friction"),b.getParam("restitution")),f={mass:b.getParam("mass"),material:f},g=b.getParam("nativeOptions");for(j in g)g.hasOwnProperty(j)&&(f[j]=g[j]);b.physicsBody=new CANNON.Body(f);b.physicsBody.addEventListener("collide",b.onCollide);this.world.addEventListener("preStep",b.beforeStep);this.world.addEventListener("postStep",b.afterStep);b.physicsBody.addShape(c);this.world.add(b.physicsBody);d&&["force","torque","velocity","angularVelocity"].forEach(function(c){b.physicsBody[c].copy(d[c]);});this._processChildMeshes(b);}this._updatePhysicsBodyTransformation(b);},g.prototype._processChildMeshes=function(e){var c,d,f;c=this,d=e.object.getChildMeshes?e.object.getChildMeshes():[];if(d.length){f=function(b,d){var g;g=d.getPhysicsImpostor();g&&g.parent!==e&&(b=d.position,g.physicsBody&&(c.removePhysicsBody(g),g.physicsBody=null),g.parent=e,g.resetUpdateFlags(),e.physicsBody.addShape(c._createShape(g),new CANNON.Vec3(b.x,b.y,b.z)),e.physicsBody.mass+=g.getParam("mass"));d.getChildMeshes().forEach(f.bind(c,d.position));};d.forEach(f.bind(this,b.Vector3.Zero()));}},g.prototype.removePhysicsBody=function(b){b.physicsBody.removeEventListener("collide",b.onCollide);y4tt.v9();this.world.removeEventListener("preStep",b.beforeStep);this.world.removeEventListener("postStep",b.afterStep);this.world.remove(b.physicsBody);},g.prototype.generateJoint=function(e){var c,d,f,g,j;y4tt.v9();c=e.mainImpostor.physicsBody,d=e.connectedImpostor.physicsBody;if(c&&d){g=e.joint.jointData,j={pivotA:g.mainPivot?new CANNON.Vec3().copy(g.mainPivot):null,pivotB:g.connectedPivot?new CANNON.Vec3().copy(g.connectedPivot):null,axisA:g.mainAxis?new CANNON.Vec3().copy(g.mainAxis):null,axisB:g.connectedAxis?new CANNON.Vec3().copy(g.connectedAxis):null,maxForce:g.nativeParams.maxForce,collideConnected:!!g.collision};switch(e.joint.type){case b.PhysicsJoint.HingeJoint:case b.PhysicsJoint.Hinge2Joint:f=new CANNON.HingeConstraint(c,d,j);break;case b.PhysicsJoint.DistanceJoint:f=new CANNON.DistanceConstraint(c,d,g.maxDistance||2);break;case b.PhysicsJoint.SpringJoint:f=new CANNON.Spring(c,d,{restLength:g.length,stiffness:g.stiffness,damping:g.damping,localAnchorA:j.pivotA,localAnchorB:j.pivotB});break;case b.PhysicsJoint.LockJoint:f=new CANNON.LockConstraint(c,d,j);break;default:f=new CANNON.PointToPointConstraint(c,j.pivotA,d,j.pivotA,j.maxForce);}f.collideConnected=!!g.collision;e.joint.physicsJoint=f;e.joint.type!==b.PhysicsJoint.SpringJoint?this.world.addConstraint(f):e.mainImpostor.registerAfterPhysicsStep(function(){f.applyForce();});}},g.prototype.removeJoint=function(b){y4tt.q9();this.world.removeConstraint(b.joint.physicsJoint);},g.prototype._addMaterial=function(b,c,d){var f,g;for(f=0;f<this._physicsMaterials.length;f++)if(g=this._physicsMaterials[f],g.friction===c&&g.restitution===d)return g;b=new CANNON.Material(b);y4tt.q9();return b.friction=c,b.restitution=d,this._physicsMaterials.push(b),b;},g.prototype._checkWithEpsilon=function(e){y4tt.v9();return e<b.PhysicsEngine.Epsilon?b.PhysicsEngine.Epsilon:e;},g.prototype._createShape=function(e){var c,d,f;d=e.object,f=e.getObjectExtendSize();y4tt.q9();switch(e.type){case b.PhysicsEngine.SphereImpostor:d=f.y;e=f.z;c=new CANNON.Sphere(Math.max(this._checkWithEpsilon(f.x),this._checkWithEpsilon(d),this._checkWithEpsilon(e))/2);break;case b.PhysicsImpostor.CylinderImpostor:c=new CANNON.Cylinder(this._checkWithEpsilon(f.x)/2,this._checkWithEpsilon(f.x)/2,this._checkWithEpsilon(f.y),16);break;case b.PhysicsImpostor.BoxImpostor:f=f.scale(0.5);c=new CANNON.Box(new CANNON.Vec3(this._checkWithEpsilon(f.x),this._checkWithEpsilon(f.y),this._checkWithEpsilon(f.z)));break;case b.PhysicsImpostor.PlaneImpostor:b.Tools.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead");c=new CANNON.Plane();break;case b.PhysicsImpostor.MeshImpostor:f=d.getVerticesData?d.getVerticesData(b.VertexBuffer.PositionKind):[];d=d.getIndices?d.getIndices():[];b.Tools.Warn("MeshImpostor only collides against spheres.");c=new CANNON.Trimesh(f,d);break;case b.PhysicsImpostor.HeightmapImpostor:c=this._createHeightmap(d);break;case b.PhysicsImpostor.ParticleImpostor:c=new CANNON.Particle();}return c;},g.prototype._createHeightmap=function(e,c){var m,p,r;for(var d=e.getVerticesData(b.VertexBuffer.PositionKind),f=[],g=c||~~(Math.sqrt(d.length/3)-1),j=2*Math.min(e.getBoundingInfo().boundingBox.extendSize.x,e.getBoundingInfo().boundingBox.extendSize.z)/g,l=e.getBoundingInfo().boundingBox.extendSize.y,n=0;n<d.length;n+=3){m=Math.round(d[n+0]/j+g/2),p=Math.round(-1*(d[n+2]/j-g/2)),r=d[n+1]+l;f[m]||(f[m]=[]);f[m][p]||(f[m][p]=r);f[m][p]=Math.max(r,f[m][p]);}for(m=0;g>=m;++m){if(!f[m]){for(d=1;!f[(m+d)%g];)d++;f[m]=f[(m+d)%g].slice();}for(p=0;g>=p;++p)if(!f[m][p]){for(var s,d=1;void 0===s;)s=f[m][(p+d++)%g];f[m][p]=s;}}f=new CANNON.Heightfield(f,{elementSize:j});y4tt.v9();return f.minY=l,f;},g.prototype._updatePhysicsBodyTransformation=function(e){var c,d,f,g,j,l;c=e.object;c.computeWorldMatrix&&c.computeWorldMatrix(!0);d=e.getObjectCenter();e.getObjectExtendSize();this._tmpDeltaPosition.copyFrom(c.position.subtract(d));this._tmpPosition.copyFrom(d);f=c.rotationQuaternion;if(e.type!==b.PhysicsImpostor.PlaneImpostor&&e.type!==b.PhysicsImpostor.HeightmapImpostor&&e.type!==b.PhysicsImpostor.CylinderImpostor||(f=f.multiply(this._minus90X),e.setDeltaRotation(this._plus90X)),e.type===b.PhysicsEngine.HeightmapImpostor){g=c.rotationQuaternion;c.rotationQuaternion=this._tmpUnityRotation;c.computeWorldMatrix(!0);j=d.clone(),l=c.getPivotMatrix()||b.Matrix.Translation(0,0,0);c.rotationQuaternion=g;g=b.Matrix.Translation(c.getBoundingInfo().boundingBox.extendSize.x,0,-c.getBoundingInfo().boundingBox.extendSize.z);c.setPivotMatrix(g);c.computeWorldMatrix(!0);d=c.getBoundingInfo().boundingBox.center.subtract(d).subtract(c.position).negate();this._tmpPosition.copyFromFloats(d.x,d.y-c.getBoundingInfo().boundingBox.extendSize.y,d.z);this._tmpDeltaPosition.copyFrom(c.getBoundingInfo().boundingBox.center.subtract(j));this._tmpDeltaPosition.y+=c.getBoundingInfo().boundingBox.extendSize.y;c.setPivotMatrix(l);c.computeWorldMatrix(!0);}else e.type===b.PhysicsEngine.MeshImpostor&&(this._tmpDeltaPosition.copyFromFloats(0,0,0),this._tmpPosition.copyFrom(c.position));e.setDeltaPosition(this._tmpDeltaPosition);e.physicsBody.position.copy(this._tmpPosition);e.physicsBody.quaternion.copy(f);},g.prototype.setTransformationFromPhysicsBody=function(b){b.object.position.copyFrom(b.physicsBody.position);b.object.rotationQuaternion.copyFrom(b.physicsBody.quaternion);},g.prototype.setPhysicsBodyTransformation=function(b,c,d){b.physicsBody.position.copy(c);b.physicsBody.quaternion.copy(d);},g.prototype.isSupported=function(){return void 0!==window.CANNON;},g.prototype.setLinearVelocity=function(b,c){y4tt.q9();b.physicsBody.velocity.copy(c);},g.prototype.setAngularVelocity=function(b,c){b.physicsBody.angularVelocity.copy(c);},g.prototype.getLinearVelocity=function(e){return(e=e.physicsBody.velocity)?new b.Vector3(e.x,e.y,e.z):null;},g.prototype.getAngularVelocity=function(e){y4tt.q9();return(e=e.physicsBody.angularVelocity)?new b.Vector3(e.x,e.y,e.z):null;},g.prototype.setBodyMass=function(b,c){b.physicsBody.mass=c;b.physicsBody.updateMassProperties();},g.prototype.sleepBody=function(b){b.physicsBody.sleep();},g.prototype.wakeUpBody=function(b){y4tt.v9();b.physicsBody.wakeUp();},g.prototype.updateDistanceJoint=function(b,c){b.physicsJoint.distance=c;},g.prototype.enableMotor=function(b,c){c||b.physicsJoint.enableMotor();},g.prototype.disableMotor=function(b,c){c||b.physicsJoint.disableMotor();},g.prototype.setMotor=function(b,c,d,f){y4tt.q9();f||(b.physicsJoint.enableMotor(),b.physicsJoint.setMotorSpeed(c),d&&this.setLimit(b,d));},g.prototype.setLimit=function(b,c,d){b.physicsJoint.motorEquation.maxForce=c;b.physicsJoint.motorEquation.minForce=void 0===d?-c:d;},g.prototype.dispose=function(){},g);b.CannonJSPlugin=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(e){this.name="OimoJSPlugin";this._tmpImpostorsArray=[];this._tmpPositionVector=b.Vector3.Zero();y4tt.v9();this.world=new OIMO.World(1/60,2,e,!0);this.world.clear();this.world.isNoStat=!0;};g=(g.prototype.setGravity=function(b){y4tt.q9();this.world.gravity.copy(b);},g.prototype.setTimeStep=function(b){y4tt.q9();this.world.timeStep=b;},g.prototype.executeStep=function(b,c){var d,g,j;d=this;c.forEach(function(b){b.beforeStep();});this.world.step();c.forEach(function(b){b.afterStep();y4tt.v9();d._tmpImpostorsArray[b.uniqueId]=b;});for(var f=this.world.contacts;null!==f;)if(!f.touching||f.body1.sleeping||f.body2.sleeping){g=this._tmpImpostorsArray[+f.body1.name],j=this._tmpImpostorsArray[+f.body2.name];g&&j?(g.onCollide({body:j.physicsBody}),j.onCollide({body:g.physicsBody}),f=f.next):f=f.next;}else f=f.next;},g.prototype.applyImpulse=function(b,c,d){var f;f=b.physicsBody.massInfo.mass;b.physicsBody.applyImpulse(d.scale(OIMO.INV_SCALE),c.scale(OIMO.INV_SCALE*f));},g.prototype.applyForce=function(e,c,d){b.Tools.Warn("Oimo doesn't support applying force. Using impule instead.");this.applyImpulse(e,c,d);},g.prototype.generatePhysicsBody=function(e){var d,f,g,j;d=this;if(e.parent)return void(e.physicsBody&&(this.removePhysicsBody(e),e.forceUpdate()));if(e.isBodyInitRequired()){f={name:e.uniqueId,config:[e.getParam("mass")||1,e.getParam("friction"),e.getParam("restitution")],size:[],type:[],pos:[],rot:[],move:0!==e.getParam("mass"),world:this.world},g=[e],j=e.object;j.getChildMeshes&&j.getChildMeshes().forEach(function(b){y4tt.q9();b.physicsImpostor&&(g.push(b.physicsImpostor),b.physicsImpostor._init());});g.forEach(function(g){var j,m,q,r;j=g.object.rotationQuaternion,m=new OIMO.Euler().setFromQuaternion({x:e.object.rotationQuaternion.x,y:e.object.rotationQuaternion.y,z:e.object.rotationQuaternion.z,s:e.object.rotationQuaternion.w}),q=g.getObjectExtendSize();if(g===e){r=e.getObjectCenter();e.object.position.subtractToRef(r,d._tmpPositionVector);f.pos.push(r.x);f.pos.push(r.y);f.pos.push(r.z);f.rot.push(m.x/(OIMO.degtorad||OIMO.TO_RAD));f.rot.push(m.y/(OIMO.degtorad||OIMO.TO_RAD));f.rot.push(m.z/(OIMO.degtorad||OIMO.TO_RAD));}else f.pos.push(g.object.position.x),f.pos.push(g.object.position.y),f.pos.push(g.object.position.z),f.rot.push(0),f.rot.push(0),f.rot.push(0);switch(g.type){case b.PhysicsImpostor.ParticleImpostor:b.Tools.Warn("No Particle support in Oimo.js. using SphereImpostor instead");case b.PhysicsImpostor.SphereImpostor:m=q.y;r=q.z;q=Math.max(c(q.x),c(m),c(r))/2;f.type.push("sphere");f.size.push(q);f.size.push(q);f.size.push(q);break;case b.PhysicsImpostor.CylinderImpostor:m=c(q.x)/2;r=c(q.y);f.type.push("cylinder");f.size.push(m);f.size.push(r);f.size.push(r);break;default:m=c(q.x),r=c(q.y),q=c(q.z),f.type.push("box"),f.size.push(m),f.size.push(r),f.size.push(q);}g.object.rotationQuaternion=j;});e.physicsBody=new OIMO.Body(f).body;}else this._tmpPositionVector.copyFromFloats(0,0,0);e.setDeltaPosition(this._tmpPositionVector);function c(c){return Math.max(c,b.PhysicsEngine.Epsilon);}},g.prototype.removePhysicsBody=function(b){y4tt.q9();this.world.removeRigidBody(b.physicsBody);},g.prototype.generateJoint=function(e){var c,d,f,g;c=e.mainImpostor.physicsBody,d=e.connectedImpostor.physicsBody;if(c&&d){f=e.joint.jointData,g=f.nativeParams||{},d={body1:c,body2:d,axe1:g.axe1||(f.mainAxis?f.mainAxis.asArray():null),axe2:g.axe2||(f.connectedAxis?f.connectedAxis.asArray():null),pos1:g.pos1||(f.mainPivot?f.mainPivot.asArray():null),pos2:g.pos2||(f.connectedPivot?f.connectedPivot.asArray():null),min:g.min,max:g.max,collision:g.collision||f.collision,spring:g.spring,world:this.world};switch(e.joint.type){case b.PhysicsJoint.BallAndSocketJoint:c="jointBall";break;case b.PhysicsJoint.SpringJoint:b.Tools.Warn("Oimo.js doesn't support Spring Constraint. Simulating using DistanceJoint instead"),d.min=f.length||d.min,d.max=Math.max(d.min,d.max);case b.PhysicsJoint.DistanceJoint:c="jointDistance";d.max=f.maxDistance;break;case b.PhysicsJoint.PrismaticJoint:c="jointPrisme";break;case b.PhysicsJoint.SliderJoint:c="jointSlide";break;case b.PhysicsJoint.WheelJoint:c="jointWheel";break;default:c="jointHinge";}d.type=c;e.joint.physicsJoint=new OIMO.Link(d).joint;}},g.prototype.removeJoint=function(e){try{this.world.removeJoint(e.joint.physicsJoint);}catch(c){b.Tools.Warn(c);}},g.prototype.isSupported=function(){y4tt.v9();return void 0!==OIMO;},g.prototype.setTransformationFromPhysicsBody=function(b){var c;if(!b.physicsBody.sleeping){if(b.physicsBody.shapes.next){c=this._getLastShape(b.physicsBody);b.object.position.x=c.position.x*OIMO.WORLD_SCALE;b.object.position.y=c.position.y*OIMO.WORLD_SCALE;b.object.position.z=c.position.z*OIMO.WORLD_SCALE;}else b.object.position.copyFrom(b.physicsBody.getPosition());b.object.rotationQuaternion.copyFrom(b.physicsBody.getQuaternion());b.object.rotationQuaternion.normalize();}},g.prototype.setPhysicsBodyTransformation=function(b,c,d){b=b.physicsBody;b.position.init(c.x*OIMO.INV_SCALE,c.y*OIMO.INV_SCALE,c.z*OIMO.INV_SCALE);b.orientation.init(d.w,d.x,d.y,d.z);b.syncShapes();b.awake();},g.prototype._getLastShape=function(b){y4tt.q9();for(b=b.shapes;b.next;)b=b.next;return b;},g.prototype.setLinearVelocity=function(b,c){y4tt.q9();b.physicsBody.linearVelocity.init(c.x,c.y,c.z);},g.prototype.setAngularVelocity=function(b,c){b.physicsBody.angularVelocity.init(c.x,c.y,c.z);},g.prototype.getLinearVelocity=function(e){y4tt.q9();return(e=e.physicsBody.linearVelocity)?new b.Vector3(e.x,e.y,e.z):null;},g.prototype.getAngularVelocity=function(e){y4tt.q9();return(e=e.physicsBody.angularVelocity)?new b.Vector3(e.x,e.y,e.z):null;},g.prototype.setBodyMass=function(b,c){var d;d=0===c;b.physicsBody.shapes.density=d?1:c;y4tt.v9();b.physicsBody.setupMass(d?2:1);},g.prototype.sleepBody=function(b){y4tt.v9();b.physicsBody.sleep();},g.prototype.wakeUpBody=function(b){y4tt.q9();b.physicsBody.awake();},g.prototype.updateDistanceJoint=function(b,c,d){b.physicsJoint.limitMotoe.upperLimit=c;void 0!==d&&(b.physicsJoint.limitMotoe.lowerLimit=d);},g.prototype.setMotor=function(b,c,d,f){(b=f?b.physicsJoint.rotationalLimitMotor2:b.physicsJoint.rotationalLimitMotor1||b.physicsJoint.rotationalLimitMotor||b.physicsJoint.limitMotor)&&b.setMotor(c,d);},g.prototype.setLimit=function(b,c,d,f){y4tt.q9();(b=f?b.physicsJoint.rotationalLimitMotor2:b.physicsJoint.rotationalLimitMotor1||b.physicsJoint.rotationalLimitMotor||b.physicsJoint.limitMotor)&&b.setLimit(c,void 0===d?-c:d);},g.prototype.dispose=function(){y4tt.v9();this.world.clear();},g);b.OimoJSPlugin=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.PostProcess;y4tt.v9();g=function(b,d,f,g,j,l){y4tt.v9();e.call(this,b,"displayPass",["passSampler"],["passSampler"],d,f,g,j,l);};g=(__extends(g,e),g);b.DisplayPassPostProcess=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j;b.SimplificationSettings=function(b,c,d){this.quality=b;this.distance=c;this.optimizeMesh=d;};g=function(){this.running=!1;y4tt.v9();this._simplificationArray=[];};g=(g.prototype.addTask=function(b){this._simplificationArray.push(b);},g.prototype.executeNext=function(){var b;b=this._simplificationArray.pop();b?(this.running=!0,this.runSimplification(b)):this.running=!1;},g.prototype.runSimplification=function(c){var d,f;d=this;if(c.parallelProcessing)c.settings.forEach(function(b){d.getSimplifier(c).simplify(b,function(f){y4tt.q9();c.mesh.addLODLevel(b.distance,f);f.isVisible=!0;b.quality===c.settings[c.settings.length-1].quality&&c.successCallback&&c.successCallback();d.executeNext();});});else{f=this.getSimplifier(c);b.AsyncLoop.Run(c.settings.length,function(b){var d;d=c.settings[b.index];f.simplify(d,function(f){c.mesh.addLODLevel(d.distance,f);y4tt.v9();f.isVisible=!0;b.executeNext();});},function(){c.successCallback&&c.successCallback();y4tt.q9();d.executeNext();});}},g.prototype.getSimplifier=function(b){switch(b.simplificationType){default:return new j(b.mesh);}},g);b.SimplificationQueue=g;g=b.SimplificationType||(b.SimplificationType={});g[g.QUADRATIC=0]="QUADRATIC";e=function(b){this.vertices=b;this.error=Array(4);this.deletePending=this.isDirty=this.deleted=!1;this.borderFactor=0;};b.DecimationTriangle=e;g=function(b,c){this.position=b;this.id=c;this.isBorder=!0;y4tt.q9();this.q=new d();this.triangleStart=this.triangleCount=0;this.originalOffsets=[];};c=(g.prototype.updatePosition=function(b){y4tt.q9();this.position.copyFrom(b);},g);b.DecimationVertex=c;f=function(b){this.data=Array(10);for(var c=0;10>c;++c)b&&b[c]?this.data[c]=b[c]:this.data[c]=0;};d=(f.prototype.det=function(b,c,d,f,e,g,j,q,y){return this.data[b]*this.data[e]*this.data[y]+this.data[d]*this.data[f]*this.data[q]+this.data[c]*this.data[g]*this.data[j]-this.data[d]*this.data[e]*this.data[j]-this.data[b]*this.data[g]*this.data[q]-this.data[c]*this.data[f]*this.data[y];},f.prototype.addInPlace=function(b){y4tt.q9();for(var c=0;10>c;++c)this.data[c]+=b.data[c];},f.prototype.addArrayInPlace=function(b){for(var c=0;10>c;++c)this.data[c]+=b[c];},f.prototype.add=function(b){for(var c=new f(),d=0;10>d;++d)c.data[d]=this.data[d]+b.data[d];y4tt.q9();return c;},f.FromData=function(b,c,d,e){y4tt.q9();return new f(f.DataFromNumbers(b,c,d,e));},f.DataFromNumbers=function(b,c,d,f){return[b*b,b*c,b*d,b*f,c*c,c*d,c*f,d*d,d*f,f*f];},f);b.QuadraticMatrix=d;q=function(b,c){this.vertexId=b;this.triangleId=c;};b.Reference=q;y4tt.q9();g=function(c){this._mesh=c;y4tt.v9();this.initialized=!1;this.syncIterations=5E3;this.aggressiveness=7;this.decimationIterations=100;this.boundingBoxEpsilon=b.Epsilon;};j=(g.prototype.simplify=function(c,d){var f;f=this;this.initDecimatedMesh();y4tt.q9();b.AsyncLoop.Run(this._mesh.subMeshes.length,function(b){f.initWithMesh(b.index,function(){y4tt.v9();f.runDecimation(c,b.index,function(){y4tt.v9();b.executeNext();});},c.optimizeMesh);},function(){setTimeout(function(){y4tt.v9();d(f._reconstructedMesh);},0);});},g.prototype.isTriangleOnBoundingBox=function(b){var c,d;c=this,d=0;return b.vertices.forEach(function(b){var f,e;f=0;b=b.position;e=c._mesh.getBoundingInfo().boundingBox;(e.maximum.x-b.x<c.boundingBoxEpsilon||b.x-e.minimum.x>c.boundingBoxEpsilon)&&++f;e.maximum.y!==b.y&&b.y!==e.minimum.y||++f;e.maximum.z!==b.z&&b.z!==e.minimum.z||++f;1<f&&++d;}),1<d&&console.log(b,d),1<d;},g.prototype.runDecimation=function(c,d,f){var e,g,j,q;e=this,g=~~(this.triangles.length*c.quality),j=0,q=this.triangles.length;b.AsyncLoop.Run(this.decimationIterations,function(c){var d,f;y4tt.v9();if(g>=q-j)c.breakLoop();else{d=c.index,f=function(){c.executeNext();};setTimeout(function(){var l;y4tt.v9();0===d%5&&e.updateMesh(0===d);for(var c=0;c<e.triangles.length;++c)e.triangles[c].isDirty=!1;l=1E-9*Math.pow(d+3,e.aggressiveness);b.AsyncLoop.SyncAsyncForLoop(e.triangles.length,e.syncIterations,function(c){var d,g,m,n,q,r,t,v,y;d=e.triangles[~~((e.triangles.length/2+c)%e.triangles.length)];if(d&&!(d.error[3]>l||d.deleted||d.isDirty))for(var f=0;3>f;++f)if(d.error[f]<l){g=[],m=[];c=d.vertices[f];n=d.vertices[(f+1)%3];if(!c.isBorder&&!n.isBorder){q=b.Vector3.Zero(),r=b.Vector3.Zero(),t=b.Vector2.Zero(),v=new b.Color4(0,0,0,1);e.calculateError(c,n,q,r,t,v);r=[];if(!e.isFlipped(c,n,q,g,d.borderFactor,r)&&!e.isFlipped(n,c,q,m,d.borderFactor,r)&&!(0>g.indexOf(!0)||0>m.indexOf(!0))){y=[];if(!(r.forEach(function(b){-1===y.indexOf(b)&&(b.deletePending=!0,y.push(b));}),0!==y.length%2)){c.q=n.q.add(c.q);c.updatePosition(q);d=e.references.length;j=e.updateTriangles(c,c,g,j);j=e.updateTriangles(c,n,m,j);g=e.references.length-d;if(g<=c.triangleCount){if(g)for(m=0;g>m;m++)e.references[c.triangleStart+m]=e.references[d+m];}else c.triangleStart=d;c.triangleCount=g;break;}}}}},f,function(){y4tt.v9();return g>=q-j;});},0);}},function(){setTimeout(function(){e.reconstructMesh(d);f();},0);});},g.prototype.initWithMesh=function(d,f,g){var j,q,s,t,v;j=this;this.vertices=[];this.triangles=[];q=this._mesh.getVerticesData(b.VertexBuffer.PositionKind),s=this._mesh.getIndices(),t=this._mesh.subMeshes[d],v=[];y4tt.v9();b.AsyncLoop.SyncAsyncForLoop(t.verticesCount,this.syncIterations/4>>0,function(d){var f,e;d+=t.verticesStart;f=b.Vector3.FromArray(q,3*d);a:{if(g)for(e=0;e<j.vertices.length;++e)if(j.vertices[e].position.equals(f)){e=j.vertices[e];break a;}e=null;}f=e||new c(f,j.vertices.length);f.originalOffsets.push(d);f.id===j.vertices.length&&j.vertices.push(f);y4tt.v9();v.push(f.id);},function(){b.AsyncLoop.SyncAsyncForLoop(t.indexCount/3,j.syncIterations,function(b){var c;b=3*(t.indexStart/3+b);y4tt.v9();c=new e([j.vertices[v[s[b+0]-t.verticesStart]],j.vertices[v[s[b+1]-t.verticesStart]],j.vertices[v[s[b+2]-t.verticesStart]]]);c.originalOffset=b;j.triangles.push(c);},function(){j.init(f);});});},g.prototype.init=function(c){var f;f=this;b.AsyncLoop.SyncAsyncForLoop(this.triangles.length,this.syncIterations,function(c){c=f.triangles[c];c.normal=b.Vector3.Cross(c.vertices[1].position.subtract(c.vertices[0].position),c.vertices[2].position.subtract(c.vertices[0].position)).normalize();for(var e=0;3>e;e++)c.vertices[e].q.addArrayInPlace(d.DataFromNumbers(c.normal.x,c.normal.y,c.normal.z,-b.Vector3.Dot(c.normal,c.vertices[0].position)));},function(){b.AsyncLoop.SyncAsyncForLoop(f.triangles.length,f.syncIterations,function(b){b=f.triangles[b];for(var c=0;3>c;++c)b.error[c]=f.calculateError(b.vertices[c],b.vertices[(c+1)%3]);b.error[3]=Math.min(b.error[0],b.error[1],b.error[2]);},function(){f.initialized=!0;y4tt.q9();c();});});},g.prototype.reconstructMesh=function(c){var d,f,e,g,j,q,v,y,x,z,B,A,C,G,D,H,J;f=[];for(d=0;d<this.vertices.length;++d)this.vertices[d].triangleCount=0;for(d=0;d<this.triangles.length;++d)if(!this.triangles[d].deleted){e=this.triangles[d];for(g=0;3>g;++g)e.vertices[g].triangleCount=1;f.push(e);}j=this._reconstructedMesh.getVerticesData(b.VertexBuffer.PositionKind)||[],q=this._reconstructedMesh.getVerticesData(b.VertexBuffer.NormalKind)||[],v=this._reconstructedMesh.getVerticesData(b.VertexBuffer.UVKind)||[],y=this._reconstructedMesh.getVerticesData(b.VertexBuffer.ColorKind)||[],x=this._mesh.getVerticesData(b.VertexBuffer.NormalKind),z=this._mesh.getVerticesData(b.VertexBuffer.UVKind),B=this._mesh.getVerticesData(b.VertexBuffer.ColorKind),A=0;for(d=0;d<this.vertices.length;++d){C=this.vertices[d];C.id=A;C.triangleCount&&C.originalOffsets.forEach(function(b){j.push(C.position.x);j.push(C.position.y);j.push(C.position.z);q.push(x[3*b]);q.push(x[3*b+1]);q.push(x[3*b+2]);z&&z.length?(v.push(z[2*b]),v.push(z[2*b+1])):B&&B.length&&(y.push(B[4*b]),y.push(B[4*b+1]),y.push(B[4*b+2]),y.push(B[4*b+3]));++A;});}g=this._reconstructedMesh.getTotalIndices();G=this._reconstructedMesh.getTotalVertices(),D=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];H=this._reconstructedMesh.getIndices(),J=this._mesh.getIndices();for(d=0;d<f.length;++d)e=f[d],[0,1,2].forEach(function(b){var c;c=e.vertices[b].originalOffsets.indexOf(J[e.originalOffset+b]);0>c&&(c=0);y4tt.v9();H.push(e.vertices[b].id+c+G);});this._reconstructedMesh.setIndices(H);this._reconstructedMesh.setVerticesData(b.VertexBuffer.PositionKind,j);this._reconstructedMesh.setVerticesData(b.VertexBuffer.NormalKind,q);0<v.length&&this._reconstructedMesh.setVerticesData(b.VertexBuffer.UVKind,v);y4tt.q9();0<y.length&&this._reconstructedMesh.setVerticesData(b.VertexBuffer.ColorKind,y);d=this._mesh.subMeshes[c];0<c&&(this._reconstructedMesh.subMeshes=[],D.forEach(function(c){new b.SubMesh(c.materialIndex,c.verticesStart,c.verticesCount,c.indexStart,c.indexCount,c.getMesh());}),new b.SubMesh(d.materialIndex,G,A,g,3*f.length,this._reconstructedMesh));},g.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new b.Mesh(this._mesh.name+"Decimated",this._mesh.getScene());y4tt.v9();this._reconstructedMesh.material=this._mesh.material;this._reconstructedMesh.parent=this._mesh.parent;this._reconstructedMesh.isVisible=!1;this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId;},g.prototype.isFlipped=function(c,d,f,e,g,j){var q,v,y;for(g=0;g<c.triangleCount;++g){q=this.triangles[this.references[c.triangleStart+g].triangleId];if(!q.deleted){v=this.references[c.triangleStart+g].vertexId,y=q.vertices[(v+1)%3],v=q.vertices[(v+2)%3];if(y!==d&&v!==d){y=y.position.subtract(f);y=y.normalize();v=v.position.subtract(f);if(v=v.normalize(),0.999<Math.abs(b.Vector3.Dot(y,v)))return!0;y=b.Vector3.Cross(y,v).normalize();if(e[g]=!1,0.2>b.Vector3.Dot(y,q.normal))return!0;}else e[g]=!0,j.push(q);}}return!1;},g.prototype.updateTriangles=function(b,c,d,f){var g,j;for(var e=0;e<c.triangleCount;++e){g=this.references[c.triangleStart+e],j=this.triangles[g.triangleId];j.deleted||(d[e]&&j.deletePending?(j.deleted=!0,f++):(j.vertices[g.vertexId]=b,j.isDirty=!0,j.error[0]=this.calculateError(j.vertices[0],j.vertices[1])+j.borderFactor/2,j.error[1]=this.calculateError(j.vertices[1],j.vertices[2])+j.borderFactor/2,j.error[2]=this.calculateError(j.vertices[2],j.vertices[0])+j.borderFactor/2,j.error[3]=Math.min(j.error[0],j.error[1],j.error[2]),this.references.push(g)));}y4tt.v9();return f;},g.prototype.identifyBorder=function(){var c,d,f,e;y4tt.q9();for(var b=0;b<this.vertices.length;++b){d=[],f=[],e=this.vertices[b];for(c=0;c<e.triangleCount;++c)for(var g=this.triangles[this.references[e.triangleStart+c].triangleId],j=0;3>j;j++){for(var q=0,y=g.vertices[j];q<d.length&&f[q]!==y.id;)++q;q===d.length?(d.push(1),f.push(y.id)):d[q]++;}for(c=0;c<d.length;++c)1===d[c]?this.vertices[f[c]].isBorder=!0:this.vertices[f[c]].isBorder=!1;}},g.prototype.updateMesh=function(b){var c,d,f,e,g;void 0===b&&(b=!1);if(!b){d=[];for(c=0;c<this.triangles.length;++c)this.triangles[c].deleted||d.push(this.triangles[c]);this.triangles=d;}for(c=0;c<this.vertices.length;++c)this.vertices[c].triangleCount=0,this.vertices[c].triangleStart=0;for(c=0;c<this.triangles.length;++c){d=this.triangles[c];for(f=0;3>f;++f)e=d.vertices[f],e.triangleCount++;}for(c=d=0;c<this.vertices.length;++c)this.vertices[c].triangleStart=d,d+=this.vertices[c].triangleCount,this.vertices[c].triangleCount=0;g=Array(3*this.triangles.length);for(c=0;c<this.triangles.length;++c){d=this.triangles[c];for(f=0;3>f;++f)e=d.vertices[f],g[e.triangleStart+e.triangleCount]=new q(f,c),e.triangleCount++;}this.references=g;b&&this.identifyBorder();},g.prototype.vertexError=function(b,c){var d,f,e;d=c.x,f=c.y,e=c.z;return b.data[0]*d*d+2*b.data[1]*d*f+2*b.data[2]*d*e+2*b.data[3]*d+b.data[4]*f*f+2*b.data[5]*f*e+2*b.data[6]*f+b.data[7]*e*e+2*b.data[8]*e+b.data[9];},g.prototype.calculateError=function(c,d,f){var e,g,j,q,v;e=c.q.add(d.q),g=c.isBorder&&d.isBorder,j=0,j=e.det(0,1,2,1,4,5,2,5,7);if(0===j||g){g=c.position.add(d.position).divide(new b.Vector3(2,2,2)),q=this.vertexError(e,c.position),v=this.vertexError(e,d.position),e=this.vertexError(e,g),j=Math.min(q,v,e);j===q?f&&f.copyFrom(c.position):j===v?f&&f.copyFrom(d.position):f&&f.copyFrom(g);}else f||(f=b.Vector3.Zero()),f.x=-1/j*e.det(1,2,3,4,5,6,5,7,8),f.y=1/j*e.det(0,2,3,1,5,6,2,7,8),f.z=-1/j*e.det(0,1,3,1,4,6,2,5,8),j=this.vertexError(e,f);y4tt.q9();return j;},g);b.QuadraticErrorSimplification=j;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d;y4tt.q9();g=[],e=function(c,d){y4tt.q9();if(!g[c.id]){if(c instanceof b.Geometry.Primitives.Box)d.boxes.push(c.serialize());else if(c instanceof b.Geometry.Primitives.Sphere)d.spheres.push(c.serialize());else if(c instanceof b.Geometry.Primitives.Cylinder)d.cylinders.push(c.serialize());else if(c instanceof b.Geometry.Primitives.Torus)d.toruses.push(c.serialize());else if(c instanceof b.Geometry.Primitives.Ground)d.grounds.push(c.serialize());else if(c instanceof b.Geometry.Primitives.Plane)d.planes.push(c.serialize());else if(c instanceof b.Geometry.Primitives.TorusKnot)d.torusKnots.push(c.serialize());else{if(c instanceof b.Geometry.Primitives._Primitive)throw Error("Unknown primitive type");d.vertexData.push(c.serializeVerticeData());}g[c.id]=!0;}},c=function(c,d){var g,l,n,m;g={};g.name=c.name;g.id=c.id;b.Tags.HasTags(c)&&(g.tags=b.Tags.GetTags(c));g.position=c.position.asArray();c.rotationQuaternion?g.rotationQuaternion=c.rotationQuaternion.asArray():c.rotation&&(g.rotation=c.rotation.asArray());g.scaling=c.scaling.asArray();g.localMatrix=c.getPivotMatrix().asArray();y4tt.v9();g.isEnabled=c.isEnabled();g.isVisible=c.isVisible;g.infiniteDistance=c.infiniteDistance;g.pickable=c.isPickable;g.receiveShadows=c.receiveShadows;g.billboardMode=c.billboardMode;g.visibility=c.visibility;g.checkCollisions=c.checkCollisions;c.parent&&(g.parentId=c.parent.id);l=c._geometry;if(l){n=l.id;g.geometryId=n;c.getScene().getGeometryByID(n)||e(l,d.geometries);g.subMeshes=[];for(l=0;l<c.subMeshes.length;l++)n=c.subMeshes[l],g.subMeshes.push({materialIndex:n.materialIndex,verticesStart:n.verticesStart,verticesCount:n.verticesCount,indexStart:n.indexStart,indexCount:n.indexCount});}c.material?g.materialId=c.material.id:c.material=null;c.skeleton&&(g.skeletonId=c.skeleton.id);c.getPhysicsImpostor()&&(g.physicsMass=c.getPhysicsMass(),g.physicsFriction=c.getPhysicsFriction(),g.physicsRestitution=c.getPhysicsRestitution(),g.physicsImpostor=c.getPhysicsImpostor().type);g.instances=[];for(l=0;l<c.instances.length;l++){n=c.instances[l],m={name:n.name,position:n.position.asArray(),scaling:n.scaling.asArray()};n.rotationQuaternion?m.rotationQuaternion=n.rotationQuaternion.asArray():n.rotation&&(m.rotation=n.rotation.asArray());g.instances.push(m);b.Animation.AppendSerializedAnimations(n,m);m.ranges=n.serializeAnimationRanges();}return b.Animation.AppendSerializedAnimations(c,g),g.ranges=c.serializeAnimationRanges(),g.layerMask=c.layerMask,c.actionManager&&(g.actions=c.actionManager.serialize(c.name)),g;};d=function(){};d=(d.ClearCache=function(){g=[];},d.Serialize=function(d){var q,j,l,n;q={};q.useDelayedTextureLoading=d.useDelayedTextureLoading;q.autoClear=d.autoClear;q.clearColor=d.clearColor.asArray();q.ambientColor=d.ambientColor.asArray();q.gravity=d.gravity.asArray();q.collisionsEnabled=d.collisionsEnabled;y4tt.q9();q.workerCollisions=d.workerCollisions;d.fogMode&&0!==d.fogMode&&(q.fogMode=d.fogMode,q.fogColor=d.fogColor.asArray(),q.fogStart=d.fogStart,q.fogEnd=d.fogEnd,q.fogDensity=d.fogDensity);d.isPhysicsEnabled()&&(q.physicsEnabled=!0,q.physicsGravity=d.getPhysicsEngine().gravity.asArray(),q.physicsEngine=d.getPhysicsEngine().getPhysicsPluginName());q.lights=[];for(j=0;j<d.lights.length;j++)l=d.lights[j],q.lights.push(l.serialize());q.cameras=[];for(j=0;j<d.cameras.length;j++)q.cameras.push(d.cameras[j].serialize());d.activeCamera&&(q.activeCameraID=d.activeCamera.id);b.Animation.AppendSerializedAnimations(d,q);q.materials=[];q.multiMaterials=[];for(j=0;j<d.materials.length;j++)l=d.materials[j],q.materials.push(l.serialize());q.multiMaterials=[];for(j=0;j<d.multiMaterials.length;j++)q.multiMaterials.push(d.multiMaterials[j].serialize());q.skeletons=[];for(j=0;j<d.skeletons.length;j++)q.skeletons.push(d.skeletons[j].serialize());q.geometries={};q.geometries.boxes=[];q.geometries.spheres=[];q.geometries.cylinders=[];q.geometries.toruses=[];q.geometries.grounds=[];q.geometries.planes=[];q.geometries.torusKnots=[];q.geometries.vertexData=[];g=[];l=d.getGeometries();for(j=0;j<l.length;j++){n=l[j];n.isReady()&&e(n,q.geometries);}q.meshes=[];for(j=0;j<d.meshes.length;j++)l=d.meshes[j],l instanceof b.Mesh&&(l.delayLoadState!==b.Engine.DELAYLOADSTATE_LOADED&&l.delayLoadState!==b.Engine.DELAYLOADSTATE_NONE||q.meshes.push(c(l,q)));q.particleSystems=[];for(j=0;j<d.particleSystems.length;j++)q.particleSystems.push(d.particleSystems[j].serialize());q.lensFlareSystems=[];for(j=0;j<d.lensFlareSystems.length;j++)q.lensFlareSystems.push(d.lensFlareSystems[j].serialize());q.shadowGenerators=[];for(j=0;j<d.lights.length;j++)l=d.lights[j],l.getShadowGenerator()&&q.shadowGenerators.push(l.getShadowGenerator().serialize());return d.actionManager&&(q.actions=d.actionManager.serialize("scene")),q;},d.SerializeMesh=function(d,g,j){var l;void 0===g&&(g=!1);void 0===j&&(j=!1);l={};y4tt.v9();if(d=d instanceof Array?d:[d],g||j)for(var n=0;n<d.length;++n)j&&d[n].getDescendants().forEach(function(c){y4tt.q9();c instanceof b.Mesh&&0>d.indexOf(c)&&d.push(c);}),g&&d[n].parent&&0>d.indexOf(d[n].parent)&&d.push(d[n].parent);return d.forEach(function(d){var f;if(d.delayLoadState===b.Engine.DELAYLOADSTATE_LOADED||d.delayLoadState===b.Engine.DELAYLOADSTATE_NONE){d.material&&(d.material instanceof b.StandardMaterial?(l.materials=l.materials||[],l.materials.some(function(b){y4tt.q9();return b.id===d.material.id;})||l.materials.push(d.material.serialize())):d.material instanceof b.MultiMaterial&&(l.multiMaterials=l.multiMaterials||[],l.multiMaterials.some(function(b){return b.id===d.material.id;})||l.multiMaterials.push(d.material.serialize())));f=d._geometry;f&&(l.geometries||(l.geometries={},l.geometries.boxes=[],l.geometries.spheres=[],l.geometries.cylinders=[],l.geometries.toruses=[],l.geometries.grounds=[],l.geometries.planes=[],l.geometries.torusKnots=[],l.geometries.vertexData=[]),e(f,l.geometries));d.skeleton&&(l.skeletons=l.skeletons||[],l.skeletons.push(d.skeleton.serialize()));l.meshes=l.meshes||[];l.meshes.push(c(d,l));}}),l;},d);b.SceneSerializer=d;}(BABYLON||(BABYLON={}));!function(b){function n(b,c,d){y4tt.q9();return(c.y-b.y)*(d.x-c.x)-(c.x-b.x)*(d.y-c.y);}b.earcut=function(b,l,m){var q,n,p,r,t,v,y,x,L,N,P,M;m=m||2;q=l&&l.length,n=q?l[0]*m:b.length,p=g(b,0,n,m,!0),r=[];if(!p)return r;if(q){L=m;x=[];q=0;for(N=l.length;N>q;q++)P=l[q]*L,M=N-1>q?l[q+1]*L:b.length,P=g(b,P,M,L,!1),P===P.next&&(P.steiner=!0),x.push(j(P));x.sort(d);for(q=0;q<x.length;q++){l=x[q];L=p;if(L=f(l,L))l=s(L,l),e(l,l.next);p=e(p,p.next);}}if(b.length>80*m){t=y=b[0];v=q=b[1];for(L=m;n>L;L+=m)x=b[L],l=b[L+1],t>x&&(t=x),v>l&&(v=l),x>y&&(y=x),l>q&&(q=l);y=Math.max(y-t,q-v);}y4tt.q9();return c(p,r,m,t,v,y,void 0),r;};function l(b,c,d,f,e,g,l,j){y4tt.v9();return 0<=(e-l)*(c-j)-(b-l)*(g-j)&&0<=(b-l)*(f-j)-(d-l)*(c-j)&&0<=(d-l)*(g-j)-(e-l)*(f-j);}function q(b,c,d,f,e){y4tt.q9();return b=32767*(b-d)/e,c=32767*(c-f)/e,b=16711935&(b|b<<8),b=252645135&(b|b<<4),b=858993459&(b|b<<2),b=1431655765&(b|b<<1),c=16711935&(c|c<<8),c=252645135&(c|c<<4),c=858993459&(c|c<<2),c=1431655765&(c|c<<1),b|c<<1;}function m(b,c){y4tt.v9();return b.x===c.x&&b.y===c.y;}function c(b,d,f,g,j,t,y){var x,F,O,E,L,N,P,M,I,Q,K,R,Z;y4tt.v9();if(b){if(!y&&t){x=b,F=x;do null===F.z&&(F.z=q(F.x,F.y,g,j,t)),F.prevZ=F.prev,F=F.nextZ=F.next;while(F!==x);F.prevZ.nextZ=null;F.prevZ=null;x=F,I=1;do{F=x;N=x=null;for(P=0;F;){P++;E=F;for(O=M=0;I>O&&(M++,E=E.nextZ,E);O++);for(O=I;0<M||0<O&&E;)0===M?(L=E,E=E.nextZ,O--):0!==O&&E?F.z<=E.z?(L=F,F=F.nextZ,M--):(L=E,E=E.nextZ,O--):(L=F,F=F.nextZ,M--),N?N.nextZ=L:x=L,L.prevZ=N,N=L;F=E;}N.nextZ=null;I*=2;}while(1<P);}for(F=b;b.prev!==b.next;){L=b.prev;x=b.next;if(t)a:{E=b;O=g;Q=j,K=t;N=E.prev;P=E;M=E.next;if(0<=n(N,P,M))E=!1;else{R=N.x>P.x?N.x>M.x?N.x:M.x:P.x>M.x?P.x:M.x,Z=N.y>P.y?N.y>M.y?N.y:M.y:P.y>M.y?P.y:M.y,I=q(N.x<P.x?N.x<M.x?N.x:M.x:P.x<M.x?P.x:M.x,N.y<P.y?N.y<M.y?N.y:M.y:P.y<M.y?P.y:M.y,O,Q,K);O=q(R,Z,O,Q,K);for(Q=E.nextZ;Q&&Q.z<=O;){if(Q!==E.prev&&Q!==E.next&&l(N.x,N.y,P.x,P.y,M.x,M.y,Q.x,Q.y)&&0<=n(Q.prev,Q,Q.next)){E=!1;break a;}Q=Q.nextZ;}for(Q=E.prevZ;Q&&Q.z>=I;){if(Q!==E.prev&&Q!==E.next&&l(N.x,N.y,P.x,P.y,M.x,M.y,Q.x,Q.y)&&0<=n(Q.prev,Q,Q.next)){E=!1;break a;}Q=Q.prevZ;}E=!0;}}else a:if(E=b,N=E.prev,P=E,M=E.next,0<=n(N,P,M))E=!1;else{for(I=E.next.next;I!==E.prev;){if(l(N.x,N.y,P.x,P.y,M.x,M.y,I.x,I.y)&&0<=n(I.prev,I,I.next)){E=!1;break a;}I=I.next;}E=!0;}if(E)d.push(L.i/f),d.push(b.i/f),d.push(x.i/f),v(b),F=b=x.next;else if(b=x,b===F){if(y)if(1===y){y=d;L=f;x=b;do F=x.prev,E=x.next.next,!m(F,E)&&p(F,x,x.next,E)&&r(F,E)&&r(E,F)&&(y.push(F.i/L),y.push(x.i/L),y.push(E.i/L),v(x),v(x.next),x=b=E),x=x.next;while(x!==b);b=x;c(b,d,f,g,j,t,2);}else{if(2===y)a:{y=b;do{for(L=y.next.next;L!==y.prev;){if(x=y.i!==L.i){x=y;F=L;E=void 0;if(E=x.next.i!==F.i)if(E=void 0,E=x.prev.i!==F.i){E=E=void 0;b:{E=x;do{if(E.i!==x.i&&E.next.i!==x.i&&E.i!==F.i&&E.next.i!==F.i&&p(E,E.next,x,F)){E=!0;break b;}E=E.next;}while(E!==x);E=!1;}if(E=!E)if(E=void 0,E=r(x,F))if(E=void 0,E=r(F,x)){E=x;N=!1;P=(x.x+F.x)/2;F=(x.y+F.y)/2;do E.y>F!=E.next.y>F&&P<(E.next.x-E.x)*(F-E.y)/(E.next.y-E.y)+E.x&&(N=!N),E=E.next;while(E!==x);E=N;}}x=E;}if(x){b=s(y,L);y=e(y,y.next);b=e(b,b.next);c(y,d,f,g,j,t,void 0);c(b,d,f,g,j,t,void 0);break a;}L=L.next;}y=y.next;}while(y!==b);}}else c(e(b,void 0),d,f,g,j,t,1);break;}}}}function j(b){var c,d;c=b,d=b;do c.x<d.x&&(d=c),c=c.next;while(c!==b);return d;}function v(b){b.next.prev=b.prev;b.prev.next=b.next;y4tt.q9();b.prevZ&&(b.prevZ.nextZ=b.nextZ);b.nextZ&&(b.nextZ.prevZ=b.prevZ);}function y(b,c,d){y4tt.q9();this.i=b;this.x=c;this.y=d;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1;}function s(b,c){var d,f,e,g;d=new y(b.i,b.x,b.y),f=new y(c.i,c.x,c.y),e=b.next,g=c.prev;return b.next=c,c.prev=b,d.next=e,e.prev=d,f.next=d,d.prev=f,g.next=f,f.prev=g,f;}function d(b,c){return b.x-c.x;}function x(b,c,d,f){for(var e=0,g=d-f;d>c;c+=f)e+=(b[g]-b[c])*(b[c+1]+b[g+1]),g=c;y4tt.q9();return e;}b.deviation=function(b,c,d,f){var e,g,l,j,m;y4tt.v9();e=c&&c.length,g=Math.abs(x(b,0,e?c[0]*d:b.length,d));if(e)for(var e=0,l=c.length;l>e;e++)g-=Math.abs(x(b,c[e]*d,l-1>e?c[e+1]*d:b.length,d));for(e=c=0;e<f.length;e+=3){l=f[e]*d,j=f[e+1]*d,m=f[e+2]*d;c+=Math.abs((b[l]-b[m])*(b[j+1]-b[l+1])-(b[l]-b[j])*(b[m+1]-b[l+1]));}return 0===g&&0===c?0:Math.abs((c-g)/g);};function t(b,c,d,f){y4tt.v9();b=new y(b,c,d);return f?(b.next=f.next,b.prev=f,f.next.prev=b,f.next=b):(b.prev=b,b.next=b),b;}b.flatten=function(b){for(var c=b[0][0].length,d={vertices:[],holes:[],dimensions:c},f=0,e=0;e<b.length;e++){for(var g=0;g<b[e].length;g++)for(var l=0;c>l;l++)d.vertices.push(b[e][g][l]);0<e&&(f+=b[e-1].length,d.holes.push(f));}return d;};function e(b,c){var d,f;if(!b)return b;c||(c=b);f=b;y4tt.v9();do if(d=!1,f.steiner||!m(f,f.next)&&0!==n(f.prev,f,f.next))f=f.next;else{if(v(f),f=c=f.prev,f===f.next)return null;d=!0;}while(d||f!==c);return c;}function f(b,c){var d,f,e,g,j,m;f=c,e=b.x,g=b.y,j=-(1/0);do{if(g<=f.y&&g>=f.next.y){m=f.x+(g-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(e>=m&&m>j){if(j=m,m===e){if(g===f.y)return f;if(g===f.next.y)return f.next;}d=f.x<f.next.x?f:f.next;}}f=f.next;}while(f!==c);if(!d)return null;if(e===j)return d.prev;for(var q,m=d,n=d.x,p=d.y,s=1/0,f=d.next;f!==m;)e>=f.x&&f.x>=n&&l(p>g?e:j,g,n,p,p>g?j:e,g,f.x,f.y)&&(q=Math.abs(g-f.y)/(e-f.x),(s>q||q===s&&f.x>d.x)&&r(f,b)&&(d=f,s=q)),f=f.next;y4tt.v9();return d;}function g(b,c,d,f,e){var g;if(e===0<x(b,c,d,f))for(e=c;d>e;e+=f)g=t(e,b[e],b[e+1],g);else for(e=d-f;e>=c;e-=f)g=t(e,b[e],b[e+1],g);y4tt.v9();return g&&m(g,g.next)&&(v(g),g=g.next),g;}function r(b,c){y4tt.v9();return 0>n(b.prev,b,b.next)?0<=n(b,c,b.next)&&0<=n(b,b.prev,c):0>n(b,c,b.prev)||0>n(b,b.next,c);}function p(b,c,d,f){return m(b,c)&&m(d,f)||m(b,f)&&m(d,c)?!0:0<n(b,c,d)!=0<n(b,c,f)&&0<n(d,f,b)!=0<n(d,f,c);}}(Earcut||(Earcut={}));!function(b){var g,e,c,d,f,q,j,l,n,m,p;g=0,c=function(b,c,d){this.pos=b;this.normal=c;this.uv=d;};e=(c.prototype.clone=function(){y4tt.v9();return new c(this.pos.clone(),this.normal.clone(),this.uv.clone());},c.prototype.flip=function(){this.normal=this.normal.scale(-1);},c.prototype.interpolate=function(d,f){return new c(b.Vector3.Lerp(this.pos,d.pos,f),b.Vector3.Lerp(this.normal,d.normal,f),b.Vector2.Lerp(this.uv,d.uv,f));},c);f=function(b,c){this.normal=b;this.w=c;};d=(f.FromPoints=function(c,d,e){e=e.subtract(c);d=d.subtract(c);if(0===e.lengthSquared()||0===d.lengthSquared())return null;d=b.Vector3.Normalize(b.Vector3.Cross(e,d));return new f(d,b.Vector3.Dot(d,c));},f.prototype.clone=function(){return new f(this.normal.clone(),this.w);},f.prototype.flip=function(){this.normal.scaleInPlace(-1);this.w=-this.w;},f.prototype.splitPolygon=function(c,d,e,g,l){var j,m,n,p,C,G,D;n=0,p=[];for(j=0;j<c.vertices.length;j++)m=b.Vector3.Dot(this.normal,c.vertices[j].pos)-this.w,m=m<-f.EPSILON?2:m>f.EPSILON?1:0,n|=m,p.push(m);switch(n){case 0:(0<b.Vector3.Dot(this.normal,c.plane.normal)?d:e).push(c);break;case 1:g.push(c);break;case 2:l.push(c);break;case 3:d=[];e=[];for(j=0;j<c.vertices.length;j++){C=(j+1)%c.vertices.length;m=p[j];G=p[C],n=c.vertices[j],C=c.vertices[C];if(2!==m&&d.push(n),1!==m&&e.push(2!==m?n.clone():n),3===(m|G))m=(this.w-b.Vector3.Dot(this.normal,n.pos))/b.Vector3.Dot(this.normal,C.pos.subtract(n.pos)),m=n.interpolate(C,m),d.push(m),e.push(m.clone());}3<=d.length&&(D=new q(d,c.shared),D.plane&&g.push(D));3<=e.length&&(D=new q(e,c.shared),D.plane&&l.push(D));}},f.EPSILON=1E-5,f);j=function(b,c){this.vertices=b;this.shared=c;this.plane=d.FromPoints(b[0].pos,b[1].pos,b[2].pos);};q=(j.prototype.clone=function(){var b;b=this.vertices.map(function(b){return b.clone();});y4tt.v9();return new j(b,this.shared);},j.prototype.flip=function(){this.vertices.reverse().map(function(b){y4tt.v9();b.flip();});this.plane.flip();},j);n=function(b){this.back=this.front=this.plane=null;this.polygons=[];b&&this.build(b);};l=(n.prototype.clone=function(){var b;b=new n();return b.plane=this.plane&&this.plane.clone(),b.front=this.front&&this.front.clone(),b.back=this.back&&this.back.clone(),b.polygons=this.polygons.map(function(b){y4tt.v9();return b.clone();}),b;},n.prototype.invert=function(){for(var b=0;b<this.polygons.length;b++)this.polygons[b].flip();this.plane&&this.plane.flip();this.front&&this.front.invert();this.back&&this.back.invert();b=this.front;this.front=this.back;this.back=b;},n.prototype.clipPolygons=function(b){if(!this.plane)return b.slice();for(var c=[],d=[],f=0;f<b.length;f++)this.plane.splitPolygon(b[f],c,d,c,d);return this.front&&(c=this.front.clipPolygons(c)),d=this.back?this.back.clipPolygons(d):[],c.concat(d);},n.prototype.clipTo=function(b){this.polygons=b.clipPolygons(this.polygons);this.front&&this.front.clipTo(b);this.back&&this.back.clipTo(b);},n.prototype.allPolygons=function(){var b;y4tt.v9();b=this.polygons.slice();return this.front&&(b=b.concat(this.front.allPolygons())),this.back&&(b=b.concat(this.back.allPolygons())),b;},n.prototype.build=function(b){y4tt.q9();if(b.length){this.plane||(this.plane=b[0].plane.clone());for(var c=[],d=[],f=0;f<b.length;f++)this.plane.splitPolygon(b[f],this.polygons,this.polygons,c,d);c.length&&(this.front||(this.front=new n()),this.front.build(c));d.length&&(this.back||(this.back=new n()),this.back.build(d));}},n);p=function(){y4tt.v9();this.polygons=[];};m=(p.FromMesh=function(c){var d,f,l,j,m,n,B,A,C,G,D,H,J,F;G=[];if(!(c instanceof b.Mesh))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";c.computeWorldMatrix(!0);m=c.getWorldMatrix();n=c.position.clone();B=c.rotation.clone();c.rotationQuaternion&&(A=c.rotationQuaternion.clone());C=c.scaling.clone();D=c.getIndices(),H=c.getVerticesData(b.VertexBuffer.PositionKind),J=c.getVerticesData(b.VertexBuffer.NormalKind),F=c.getVerticesData(b.VertexBuffer.UVKind);c=c.subMeshes;for(var O=0,E=c.length;E>O;O++)for(var L=c[O].indexStart,N=c[O].indexCount+c[O].indexStart;N>L;L+=3){j=[];for(var P=0;3>P;P++)f=new b.Vector3(J[3*D[L+P]],J[3*D[L+P]+1],J[3*D[L+P]+2]),d=new b.Vector2(F[2*D[L+P]],F[2*D[L+P]+1]),l=new b.Vector3(H[3*D[L+P]],H[3*D[L+P]+1],H[3*D[L+P]+2]),l=b.Vector3.TransformCoordinates(l,m),f=b.Vector3.TransformNormal(f,m),d=new e(l,f,d),j.push(d);j=new q(j,{subMeshId:O,meshId:g,materialIndex:c[O].materialIndex});j.plane&&G.push(j);}G=p.FromPolygons(G);return G.matrix=m,G.position=n,G.rotation=B,G.scaling=C,G.rotationQuaternion=A,g++,G;},p.FromPolygons=function(b){var c;c=new p();return c.polygons=b,c;},p.prototype.clone=function(){var b;b=new p();return b.polygons=this.polygons.map(function(b){return b.clone();}),b.copyTransformAttributes(this),b;},p.prototype.toPolygons=function(){y4tt.q9();return this.polygons;},p.prototype.union=function(b){var c;c=new l(this.clone().polygons);b=new l(b.clone().polygons);return c.clipTo(b),b.clipTo(c),b.invert(),b.clipTo(c),b.invert(),c.build(b.allPolygons()),p.FromPolygons(c.allPolygons()).copyTransformAttributes(this);},p.prototype.unionInPlace=function(b){var c;c=new l(this.polygons);b=new l(b.polygons);c.clipTo(b);b.clipTo(c);b.invert();b.clipTo(c);b.invert();c.build(b.allPolygons());this.polygons=c.allPolygons();},p.prototype.subtract=function(b){var c;c=new l(this.clone().polygons);b=new l(b.clone().polygons);y4tt.v9();return c.invert(),c.clipTo(b),b.clipTo(c),b.invert(),b.clipTo(c),b.invert(),c.build(b.allPolygons()),c.invert(),p.FromPolygons(c.allPolygons()).copyTransformAttributes(this);},p.prototype.subtractInPlace=function(b){var c;c=new l(this.polygons);b=new l(b.polygons);y4tt.q9();c.invert();c.clipTo(b);b.clipTo(c);b.invert();b.clipTo(c);b.invert();c.build(b.allPolygons());c.invert();this.polygons=c.allPolygons();},p.prototype.intersect=function(b){var c;c=new l(this.clone().polygons);b=new l(b.clone().polygons);return c.invert(),b.clipTo(c),b.invert(),c.clipTo(b),b.clipTo(c),c.build(b.allPolygons()),c.invert(),p.FromPolygons(c.allPolygons()).copyTransformAttributes(this);},p.prototype.intersectInPlace=function(b){var c;c=new l(this.polygons);b=new l(b.polygons);c.invert();b.clipTo(c);b.invert();c.clipTo(b);b.clipTo(c);c.build(b.allPolygons());c.invert();this.polygons=c.allPolygons();},p.prototype.inverse=function(){var b;b=this.clone();return b.inverseInPlace(),b;},p.prototype.inverseInPlace=function(){this.polygons.map(function(b){b.flip();});},p.prototype.copyTransformAttributes=function(b){return this.matrix=b.matrix,this.position=b.position,this.rotation=b.rotation,this.scaling=b.scaling,this.rotationQuaternion=b.rotationQuaternion,this;},p.prototype.buildMeshGeometry=function(c,d,f){var e,g,l,j,m,q,n,p,D,H,J,F,O,E,L,K,R;e=this.matrix.clone();e.invert();d=new b.Mesh(c,d);j=[],m=[],q=[],n=[],p=b.Vector3.Zero(),D=b.Vector3.Zero(),H=b.Vector2.Zero(),J=this.polygons,F=[0,0,0],O={},E=0,L={};f&&J.sort(function(b,c){y4tt.q9();return b.shared.meshId===c.shared.meshId?b.shared.subMeshId-c.shared.subMeshId:b.shared.meshId-c.shared.meshId;});for(var N=0,P=J.length;P>N;N++){g=J[N];L[g.shared.meshId]||(L[g.shared.meshId]={});L[g.shared.meshId][g.shared.subMeshId]||(L[g.shared.meshId][g.shared.subMeshId]={indexStart:+(1/0),indexEnd:-(1/0),materialIndex:g.shared.materialIndex});c=L[g.shared.meshId][g.shared.subMeshId];for(var M=2,I=g.vertices.length;I>M;M++){F[0]=0;F[1]=M-1;F[2]=M;for(var Q=0;3>Q;Q++){p.copyFrom(g.vertices[F[Q]].pos);D.copyFrom(g.vertices[F[Q]].normal);H.copyFrom(g.vertices[F[Q]].uv);K=b.Vector3.TransformCoordinates(p,e),R=b.Vector3.TransformNormal(D,e);l=O[K.x+","+K.y+","+K.z];"undefined"!=typeof l&&q[3*l]===R.x&&q[3*l+1]===R.y&&q[3*l+2]===R.z&&n[2*l]===H.x&&n[2*l+1]===H.y||(j.push(K.x,K.y,K.z),n.push(H.x,H.y),q.push(D.x,D.y,D.z),l=O[K.x+","+K.y+","+K.z]=j.length/3-1);m.push(l);c.indexStart=Math.min(E,c.indexStart);c.indexEnd=Math.max(E,c.indexEnd);E++;}}}if(d.setVerticesData(b.VertexBuffer.PositionKind,j),d.setVerticesData(b.VertexBuffer.NormalKind,q),d.setVerticesData(b.VertexBuffer.UVKind,n),d.setIndices(m),f){e=0;d.subMeshes=[];for(var Z in L){f=-1;for(var ba in L[Z])c=L[Z][ba],b.SubMesh.CreateFromIndices(c.materialIndex+e,c.indexStart,c.indexEnd-c.indexStart+1,d),f=Math.max(c.materialIndex,f);e+=++f;}}return d;},p.prototype.toMesh=function(b,c,d,f){b=this.buildMeshGeometry(b,d,f);return b.material=c,b.position.copyFrom(this.position),b.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(b.rotationQuaternion=this.rotationQuaternion.clone()),b.scaling.copyFrom(this.scaling),b.computeWorldMatrix(!0),b;},p);b.CSG=m;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.PostProcess;y4tt.q9();g=function(c,d,f,g){var j;j=this;e.call(this,c,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,g.postProcessScaleFactor,d,b.Texture.BILINEAR_SAMPLINGMODE,null,null);this._isRightEye=f;this._distortionFactors=g.distortionK;this._postProcessScaleFactor=g.postProcessScaleFactor;this._lensCenterOffset=g.lensCenterOffset;y4tt.q9();this.onSizeChangedObservable.add(function(){j.aspectRatio=0.5*j.width/j.height;j._scaleIn=new b.Vector2(2,2/j.aspectRatio);j._scaleFactor=new b.Vector2(0.5*(1/j._postProcessScaleFactor),0.5*(1/j._postProcessScaleFactor)*j.aspectRatio);j._lensCenter=new b.Vector2(j._isRightEye?0.5-0.5*j._lensCenterOffset:0.5+0.5*j._lensCenterOffset,0.5);});this.onApplyObservable.add(function(b){b.setFloat2("LensCenter",j._lensCenter.x,j._lensCenter.y);b.setFloat2("Scale",j._scaleFactor.x,j._scaleFactor.y);b.setFloat2("ScaleIn",j._scaleIn.x,j._scaleIn.y);b.setFloat4("HmdWarpParam",j._distortionFactors[0],j._distortionFactors[1],j._distortionFactors[2],j._distortionFactors[3]);});};g=(__extends(g,e),g);b.VRDistortionCorrectionPostProcess=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;g=b.JoystickAxis||(b.JoystickAxis={});g[g.X=0]="X";g[g.Y=1]="Y";g[g.Z=2]="Z";!0;e=b.JoystickAxis,c=function(d){var f;f=this;d?this._leftJoystick=!0:this._leftJoystick=!1;this._joystickIndex=c._globalJoystickIndex;c._globalJoystickIndex++;this._axisTargetedByLeftAndRight=e.X;this._axisTargetedByUpAndDown=e.Y;this.reverseUpDown=this.reverseLeftRight=!1;this._touches=new b.StringDictionary();this.deltaPosition=b.Vector3.Zero();this._joystickSensibility=25;this._inversedSensibility=1/(this._joystickSensibility/1E3);this._rotationSpeed=25;this._inverseRotationSpeed=1/(this._rotationSpeed/1E3);this._rotateOnAxisRelativeToMesh=!1;this._onResize=function(){c.vjCanvasWidth=window.innerWidth;c.vjCanvasHeight=window.innerHeight;c.vjCanvas.width=c.vjCanvasWidth;c.vjCanvas.height=c.vjCanvasHeight;y4tt.v9();c.halfWidth=c.vjCanvasWidth/2;c.halfHeight=c.vjCanvasHeight/2;};c.vjCanvas||(window.addEventListener("resize",this._onResize,!1),c.vjCanvas=document.createElement("canvas"),c.vjCanvasWidth=window.innerWidth,c.vjCanvasHeight=window.innerHeight,c.vjCanvas.width=window.innerWidth,c.vjCanvas.height=window.innerHeight,c.vjCanvas.style.width="100%",c.vjCanvas.style.height="100%",c.vjCanvas.style.position="absolute",c.vjCanvas.style.backgroundColor="transparent",c.vjCanvas.style.top="0px",c.vjCanvas.style.left="0px",c.vjCanvas.style.zIndex="5",c.vjCanvas.style.msTouchAction="none",c.vjCanvas.setAttribute("touch-action","none"),c.vjCanvasContext=c.vjCanvas.getContext("2d"),c.vjCanvasContext.strokeStyle="#ffffff",c.vjCanvasContext.lineWidth=2,document.body.appendChild(c.vjCanvas));c.halfWidth=c.vjCanvas.width/2;c.halfHeight=c.vjCanvas.height/2;this.pressed=!1;this._joystickColor="cyan";this._joystickPointerID=-1;this._joystickPointerPos=new b.Vector2(0,0);this._joystickPreviousPointerPos=new b.Vector2(0,0);this._joystickPointerStartPos=new b.Vector2(0,0);this._deltaJoystickVector=new b.Vector2(0,0);this._onPointerDownHandlerRef=function(b){f._onPointerDown(b);};this._onPointerMoveHandlerRef=function(b){y4tt.v9();f._onPointerMove(b);};this._onPointerOutHandlerRef=function(b){y4tt.v9();f._onPointerUp(b);};this._onPointerUpHandlerRef=function(b){y4tt.q9();f._onPointerUp(b);};c.vjCanvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1);c.vjCanvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1);c.vjCanvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1);c.vjCanvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1);c.vjCanvas.addEventListener("contextmenu",function(b){b.preventDefault();},!1);requestAnimationFrame(function(){f._drawVirtualJoystick();});},g=(c.prototype.setJoystickSensibility=function(b){this._joystickSensibility=b;y4tt.q9();this._inversedSensibility=1/(this._joystickSensibility/1E3);},c.prototype._onPointerDown=function(b){b.preventDefault();y4tt.q9();(!0===this._leftJoystick?b.clientX<c.halfWidth:b.clientX>c.halfWidth)&&0>this._joystickPointerID?(this._joystickPointerID=b.pointerId,this._joystickPointerStartPos.x=b.clientX,this._joystickPointerStartPos.y=b.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(b.pointerId.toString(),b)):2>c._globalJoystickIndex&&this._action&&(this._action(),this._touches.add(b.pointerId.toString(),{x:b.clientX,y:b.clientY,prevX:b.clientX,prevY:b.clientY}));},c.prototype._onPointerMove=function(b){var c;if(this._joystickPointerID==b.pointerId){this._joystickPointerPos.x=b.clientX;this._joystickPointerPos.y=b.clientY;this._deltaJoystickVector=this._joystickPointerPos.clone();this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);b=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case e.X:this.deltaPosition.x=Math.min(1,Math.max(-1,b));break;case e.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,b));break;case e.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,b));}b=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case e.X:this.deltaPosition.x=Math.min(1,Math.max(-1,b));break;case e.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,b));break;case e.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,b));}}else{c=this._touches.get(b.pointerId.toString());c&&(c.x=b.clientX,c.y=b.clientY);}},c.prototype._onPointerUp=function(b){var f;y4tt.v9();if(this._joystickPointerID==b.pointerId)c.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-63,this._joystickPointerStartPos.y-63,126,126),c.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-41,this._joystickPreviousPointerPos.y-41,82,82),this._joystickPointerID=-1,this.pressed=!1;else{f=this._touches.get(b.pointerId.toString());f&&c.vjCanvasContext.clearRect(f.prevX-43,f.prevY-43,86,86);}this._deltaJoystickVector.x=0;this._deltaJoystickVector.y=0;this._touches.remove(b.pointerId.toString());},c.prototype.setJoystickColor=function(b){this._joystickColor=b;},c.prototype.setActionOnTouch=function(b){y4tt.v9();this._action=b;},c.prototype.setAxisForLeftRight=function(b){y4tt.v9();switch(b){case e.X:case e.Y:case e.Z:this._axisTargetedByLeftAndRight=b;break;default:this._axisTargetedByLeftAndRight=e.X;}},c.prototype.setAxisForUpDown=function(b){y4tt.q9();switch(b){case e.X:case e.Y:case e.Z:this._axisTargetedByUpAndDown=b;break;default:this._axisTargetedByUpAndDown=e.Y;}},c.prototype._clearCanvas=function(){y4tt.v9();this._leftJoystick?c.vjCanvasContext.clearRect(0,0,c.vjCanvasWidth/2,c.vjCanvasHeight):c.vjCanvasContext.clearRect(c.vjCanvasWidth/2,0,c.vjCanvasWidth,c.vjCanvasHeight);},c.prototype._drawVirtualJoystick=function(){var b;b=this;y4tt.q9();this.pressed&&this._touches.forEach(function(f){f.pointerId===b._joystickPointerID?(c.vjCanvasContext.clearRect(b._joystickPointerStartPos.x-63,b._joystickPointerStartPos.y-63,126,126),c.vjCanvasContext.clearRect(b._joystickPreviousPointerPos.x-41,b._joystickPreviousPointerPos.y-41,82,82),c.vjCanvasContext.beginPath(),c.vjCanvasContext.lineWidth=6,c.vjCanvasContext.strokeStyle=b._joystickColor,c.vjCanvasContext.arc(b._joystickPointerStartPos.x,b._joystickPointerStartPos.y,40,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath(),c.vjCanvasContext.beginPath(),c.vjCanvasContext.strokeStyle=b._joystickColor,c.vjCanvasContext.lineWidth=2,c.vjCanvasContext.arc(b._joystickPointerStartPos.x,b._joystickPointerStartPos.y,60,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath(),c.vjCanvasContext.beginPath(),c.vjCanvasContext.strokeStyle=b._joystickColor,c.vjCanvasContext.arc(b._joystickPointerPos.x,b._joystickPointerPos.y,40,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath(),b._joystickPreviousPointerPos=b._joystickPointerPos.clone()):(c.vjCanvasContext.clearRect(f.prevX-43,f.prevY-43,86,86),c.vjCanvasContext.beginPath(),c.vjCanvasContext.fillStyle="white",c.vjCanvasContext.beginPath(),c.vjCanvasContext.strokeStyle="red",c.vjCanvasContext.lineWidth=6,c.vjCanvasContext.arc(f.x,f.y,40,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath(),f.prevX=f.x,f.prevY=f.y);});requestAnimationFrame(function(){y4tt.v9();b._drawVirtualJoystick();});},c.prototype.releaseCanvas=function(){y4tt.v9();c.vjCanvas&&(c.vjCanvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),c.vjCanvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),c.vjCanvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),c.vjCanvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(c.vjCanvas),c.vjCanvas=null);},c._globalJoystickIndex=0,c);b.VirtualJoystick=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.FreeCamera;g=function(b,d,f){e.call(this,b,d,f);this.inputs.addVirtualJoystick();};g=(__extends(g,e),g);b.VirtualJoysticksCamera=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(){};g=(g.prototype.getLeftJoystick=function(){return this._leftjoystick;},g.prototype.getRightJoystick=function(){return this._rightjoystick;},g.prototype.checkInputs=function(){var e,c,d;if(this._leftjoystick){e=this.camera,c=50*e._computeLocalCameraSpeed(),d=b.Matrix.RotationYawPitchRoll(e.rotation.y,e.rotation.x,0),c=b.Vector3.TransformCoordinates(new b.Vector3(this._leftjoystick.deltaPosition.x*c,this._leftjoystick.deltaPosition.y*c,this._leftjoystick.deltaPosition.z*c),d);e.cameraDirection=e.cameraDirection.add(c);e.cameraRotation=e.cameraRotation.addVector3(this._rightjoystick.deltaPosition);this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(0.9));this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(0.9));}},g.prototype.attachControl=function(){this._leftjoystick=new b.VirtualJoystick(!0);this._leftjoystick.setAxisForUpDown(b.JoystickAxis.Z);this._leftjoystick.setAxisForLeftRight(b.JoystickAxis.X);this._leftjoystick.setJoystickSensibility(0.15);this._rightjoystick=new b.VirtualJoystick(!1);this._rightjoystick.setAxisForUpDown(b.JoystickAxis.X);this._rightjoystick.setAxisForLeftRight(b.JoystickAxis.Y);this._rightjoystick.reverseUpDown=!0;this._rightjoystick.setJoystickSensibility(0.05);this._rightjoystick.setJoystickColor("yellow");},g.prototype.detachControl=function(){this._leftjoystick.releaseCanvas();this._rightjoystick.releaseCanvas();},g.prototype.getTypeName=function(){return"FreeCameraVirtualJoystickInput";},g.prototype.getSimpleName=function(){return"virtualJoystick";},g);b.FreeCameraVirtualJoystickInput=g;y4tt.v9();b.CameraInputTypes.FreeCameraVirtualJoystickInput=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.PostProcess;g=function(b,d,f,g,j,l){var n;n=this;e.call(this,b,"anaglyph",null,["leftSampler"],d,f[1],g,j,l);y4tt.q9();this._passedProcess=f[0]._rigPostProcess;this.onApplyObservable.add(function(b){b.setTextureFromPostProcess("leftSampler",n._passedProcess);});};g=(__extends(g,e),g);b.AnaglyphPostProcess=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(b){this._scene=b;};y4tt.v9();g=(g.prototype.render=function(e,c,d){var f,g,j,l,n,m;f=this;void 0===d&&(d=!1);g=this._scene,j=this._scene.getEngine(),l=null!==j.getCaps().instancedArrays&&null!==c.visibleInstances[e._id]&&void 0!==c.visibleInstances[e._id];if(this.isReady(e,l)){n=e.getRenderingMesh(),m=e.getMaterial();if(j.enableEffect(this._effect),this._effect.setFloat("offset",d?0:n.outlineWidth),this._effect.setColor4("color",d?n.overlayColor:n.outlineColor,d?n.overlayAlpha:1),this._effect.setMatrix("viewProjection",g.getTransformMatrix()),n.useBones&&n.computeBonesUsingShaders&&this._effect.setMatrices("mBones",n.skeleton.getTransformMatrices(n)),n._bind(e,this._effect,b.Material.TriangleFillMode),m&&m.needAlphaTesting())d=m.getAlphaTestTexture(),this._effect.setTexture("diffuseSampler",d),this._effect.setMatrix("diffuseMatrix",d.getTextureMatrix());n._processRendering(e,this._effect,b.Material.TriangleFillMode,c,l,function(b,c){f._effect.setMatrix("world",c);});}},g.prototype.isReady=function(e,c){var d,f,g,j;d=[],f=[b.VertexBuffer.PositionKind,b.VertexBuffer.NormalKind],g=e.getMesh(),j=e.getMaterial();j&&j.needAlphaTesting()&&(d.push("#define ALPHATEST"),g.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(f.push(b.VertexBuffer.UVKind),d.push("#define UV1")),g.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(f.push(b.VertexBuffer.UV2Kind),d.push("#define UV2")));g.useBones&&g.computeBonesUsingShaders?(f.push(b.VertexBuffer.MatricesIndicesKind),f.push(b.VertexBuffer.MatricesWeightsKind),4<g.numBoneInfluencers&&(f.push(b.VertexBuffer.MatricesIndicesExtraKind),f.push(b.VertexBuffer.MatricesWeightsExtraKind)),d.push("#define NUM_BONE_INFLUENCERS "+g.numBoneInfluencers),d.push("#define BonesPerMesh "+(g.skeleton.bones.length+1))):d.push("#define NUM_BONE_INFLUENCERS 0");c&&(d.push("#define INSTANCES"),f.push("world0"),f.push("world1"),f.push("world2"),f.push("world3"));d=d.join("\n");return this._cachedDefines!==d&&(this._cachedDefines=d,this._effect=this._scene.getEngine().createEffect("outline",f,"world mBones viewProjection diffuseMatrix offset color".split(" "),["diffuseSampler"],d)),this._effect.isReady();},g);b.OutlineRenderer=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q;e=function(b,c,d,f){this.name=b;this.meshesNames=c;y4tt.q9();this.rootUrl=d;this.sceneFilename=f;this.isCompleted=!1;};g=(e.prototype.run=function(c,d,f){var e;e=this;b.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,c,function(b,c,f){e.loadedMeshes=b;e.loadedParticleSystems=c;e.loadedSkeletons=f;e.isCompleted=!0;e.onSuccess&&e.onSuccess(e);d();},null,function(){e.onError&&e.onError(e);f();});},e);b.MeshAssetTask=g;e=function(b,c){y4tt.v9();this.name=b;this.url=c;this.isCompleted=!1;};c=(e.prototype.run=function(c,d,f){var e;e=this;b.Tools.LoadFile(this.url,function(b){e.text=b;e.isCompleted=!0;y4tt.v9();e.onSuccess&&e.onSuccess(e);d();},null,c.database,!1,function(){e.onError&&e.onError(e);f();});},e);y4tt.v9();b.TextFileAssetTask=c;e=function(b,c){y4tt.q9();this.name=b;this.url=c;this.isCompleted=!1;};d=(e.prototype.run=function(c,d,f){var e;y4tt.q9();e=this;b.Tools.LoadFile(this.url,function(b){e.data=b;e.isCompleted=!0;e.onSuccess&&e.onSuccess(e);d();},null,c.database,!0,function(){e.onError&&e.onError(e);y4tt.v9();f();});},e);b.BinaryFileAssetTask=d;e=function(b,c){this.name=b;this.url=c;this.isCompleted=!1;};f=(e.prototype.run=function(b,c,d){var f,e;f=this,e=new Image();e.onload=function(){f.image=e;f.isCompleted=!0;f.onSuccess&&f.onSuccess(f);c();};e.onerror=function(){f.onError&&f.onError(f);y4tt.q9();d();};e.src=this.url;},e);b.ImageAssetTask=f;e=function(c,d,f,e,g){void 0===g&&(g=b.Texture.TRILINEAR_SAMPLINGMODE);this.name=c;y4tt.v9();this.url=d;this.noMipmap=f;this.invertY=e;this.samplingMode=g;this.isCompleted=!1;};q=(e.prototype.run=function(c,d,f){var e;e=this;this.texture=new b.Texture(this.url,c,this.noMipmap,this.invertY,this.samplingMode,function(){y4tt.v9();e.isCompleted=!0;e.onSuccess&&e.onSuccess(e);d();},function(){e.onError&&e.onError(e);f();});},e);b.TextureAssetTask=q;e=function(b){y4tt.q9();this._tasks=[];this._waitingTasksCount=0;this.useDefaultLoadingScreen=!0;this._scene=b;};e=(e.prototype.addMeshTask=function(b,c,d,f){b=new g(b,c,d,f);return this._tasks.push(b),b;},e.prototype.addTextFileTask=function(b,d){var f;f=new c(b,d);return this._tasks.push(f),f;},e.prototype.addBinaryFileTask=function(b,c){var f;f=new d(b,c);y4tt.q9();return this._tasks.push(f),f;},e.prototype.addImageTask=function(b,c){var d;d=new f(b,c);y4tt.q9();return this._tasks.push(d),d;},e.prototype.addTextureTask=function(c,d,f,e,g){void 0===g&&(g=b.Texture.TRILINEAR_SAMPLINGMODE);c=new q(c,d,f,e,g);y4tt.v9();return this._tasks.push(c),c;},e.prototype._decreaseWaitingTasksCount=function(){this._waitingTasksCount--;y4tt.v9();0===this._waitingTasksCount&&(this.onFinish&&this.onFinish(this._tasks),this._scene.getEngine().hideLoadingUI());},e.prototype._runTask=function(b){var c;c=this;y4tt.v9();b.run(this._scene,function(){c.onTaskSuccess&&c.onTaskSuccess(b);y4tt.q9();c._decreaseWaitingTasksCount();},function(){c.onTaskError&&c.onTaskError(b);c._decreaseWaitingTasksCount();});},e.prototype.reset=function(){y4tt.v9();return this._tasks=[],this;},e.prototype.load=function(){if(this._waitingTasksCount=this._tasks.length,0===this._waitingTasksCount)return this.onFinish&&this.onFinish(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var b=0;b<this._tasks.length;b++)this._runTask(this._tasks[b]);y4tt.v9();return this;},e);b.AssetsManager=e;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(){y4tt.q9();this.compensateDistortion=!0;};g=(Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution);},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance));},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftHMatrix",{get:function(){return b.Matrix.Translation(4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize,0,0);},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightHMatrix",{get:function(){return b.Matrix.Translation(-(4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize),0,0);},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftPreViewMatrix",{get:function(){return b.Matrix.Translation(0.5*this.interpupillaryDistance,0,0);},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightPreViewMatrix",{get:function(){y4tt.q9();return b.Matrix.Translation(-0.5*this.interpupillaryDistance,0,0);},enumerable:!0,configurable:!0}),e.GetDefault=function(){var b;b=new e();return b.hResolution=1280,b.vResolution=800,b.hScreenSize=0.149759993,b.vScreenSize=0.0935999975,b.vScreenCenter=0.0467999987,b.eyeToScreenDistance=0.0410000011,b.lensSeparationDistance=0.063500002,b.interpupillaryDistance=0.064000003,b.distortionK=[1,0.219999999,0.239999995,0],b.chromaAbCorrection=[0.995999992,-0.00400000019,1.01400006,0],b.postProcessScaleFactor=1.714605507808412,b.lensCenterOffset=0.151976421,b;},e);y4tt.v9();b.VRCameraMetrics=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.FreeCamera;g=function(c,f,g,j){void 0===j&&(j=!0);e.call(this,c,f,g);this.rotationQuaternion=new b.Quaternion();c=b.VRCameraMetrics.GetDefault();c.compensateDistortion=j;this.setCameraRigMode(b.Camera.RIG_MODE_VR,{vrCameraMetrics:c});y4tt.q9();this.inputs.addDeviceOrientation();};g=(__extends(g,e),g.prototype.getTypeName=function(){y4tt.q9();return"VRDeviceOrientationFreeCamera";},g);b.VRDeviceOrientationFreeCamera=g;c=b.ArcRotateCamera;g=function(d,f,e,g,l,n,m){void 0===m&&(m=!0);c.call(this,d,f,e,g,l,n);d=b.VRCameraMetrics.GetDefault();d.compensateDistortion=m;this.setCameraRigMode(b.Camera.RIG_MODE_VR,{vrCameraMetrics:d});this.inputs.addVRDeviceOrientation();};g=(__extends(g,c),g.prototype.getTypeName=function(){return"VRDeviceOrientationArcRotateCamera";},g);b.VRDeviceOrientationArcRotateCamera=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.FreeCamera;g=function(c,d,f,g){void 0===g&&(g=!0);e.call(this,c,d,f);this._cacheState=this._sensorDevice=this._hmdDevice=null;this._vrEnabled=!1;c=b.VRCameraMetrics.GetDefault();c.compensateDistortion=g;this.setCameraRigMode(b.Camera.RIG_MODE_VR,{vrCameraMetrics:c});this._getWebVRDevices=this._getWebVRDevices.bind(this);this.rotationQuaternion=new b.Quaternion();};g=(__extends(g,e),g.prototype._getWebVRDevices=function(b){var d,f;d=b.length,f=0;for(this._hmdDevice=this._sensorDevice=null;d>f&&null===this._hmdDevice;)b[f]instanceof HMDVRDevice&&(this._hmdDevice=b[f]),f++;y4tt.q9();for(f=0;d>f&&null===this._sensorDevice;)b[f]instanceof PositionSensorVRDevice&&(!this._hmdDevice||b[f].hardwareUnitId===this._hmdDevice.hardwareUnitId)&&(this._sensorDevice=b[f]),f++;this._vrEnabled=!(!this._sensorDevice||!this._hmdDevice);},g.prototype._checkInputs=function(){y4tt.v9();this._vrEnabled&&(this._cacheState=this._sensorDevice.getState(),this.rotationQuaternion.copyFrom(this._cacheState.orientation),this.rotationQuaternion.z*=-1,this.rotationQuaternion.w*=-1);e.prototype._checkInputs.call(this);},g.prototype.attachControl=function(b,d){e.prototype.attachControl.call(this,b,d);navigator.getVRDevices?navigator.getVRDevices().then(this._getWebVRDevices):navigator.mozGetVRDevices&&navigator.mozGetVRDevices(this._getWebVRDevices);},g.prototype.detachControl=function(b){y4tt.q9();e.prototype.detachControl.call(this,b);this._vrEnabled=!1;},g.prototype.requestVRFullscreen=function(b){this._hmdDevice&&this.getEngine().switchFullscreen(b,{vrDisplay:this._hmdDevice});},g.prototype.getTypeName=function(){return"WebVRFreeCamera";},g);b.WebVRFreeCamera=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j,l,n,m,p,r,s,t;g=function(b){void 0===b&&(b=0);this.priority=b;this.apply=function(){y4tt.q9();return!0;};};b.SceneOptimization=g;y4tt.q9();c=function(b,c){var d;d=this;void 0===b&&(b=0);void 0===c&&(c=1024);g.call(this,b);y4tt.q9();this.priority=b;this.maximumSize=c;this.apply=function(b){var e,g;for(var c=!0,f=0;f<b.textures.length;f++){e=b.textures[f];if(e.canRescale){g=e.getSize();Math.max(g.width,g.height)>d.maximumSize&&(e.scale(0.5),c=!1);}}return c;};};e=(__extends(c,g),c);b.TextureOptimization=e;c=function(b,c){var d;d=this;void 0===b&&(b=0);void 0===c&&(c=2);g.call(this,b);this.priority=b;this.maximumScale=c;this._currentScale=1;this.apply=function(b){return d._currentScale++,b.getEngine().setHardwareScalingLevel(d._currentScale),d._currentScale>=d.maximumScale;};};d=(__extends(c,g),c);b.HardwareScalingOptimization=d;c=function(){g.apply(this,arguments);this.apply=function(b){y4tt.q9();return b.shadowsEnabled=!1,!0;};};f=(__extends(c,g),c);b.ShadowsOptimization=f;c=function(){g.apply(this,arguments);this.apply=function(b){return b.postProcessesEnabled=!1,!0;};};q=(__extends(c,g),c);b.PostProcessesOptimization=q;c=function(){g.apply(this,arguments);this.apply=function(b){y4tt.q9();return b.lensFlaresEnabled=!1,!0;};};j=(__extends(c,g),c);b.LensFlaresOptimization=j;c=function(){y4tt.q9();g.apply(this,arguments);this.apply=function(b){return b.particlesEnabled=!1,!0;};};l=(__extends(c,g),c);b.ParticlesOptimization=l;c=function(){g.apply(this,arguments);this.apply=function(b){return b.renderTargetsEnabled=!1,!0;};};n=(__extends(c,g),c);b.RenderTargetsOptimization=n;p=function(){var c;c=this;y4tt.q9();g.apply(this,arguments);this._canBeMerged=function(c){return!(c instanceof b.Mesh)?!1:c.isVisible&&c.isEnabled()?0<c.instances.length?!1:c.skeleton||c.hasLODLevels?!1:!c.parent:!1;};this.apply=function(d,f){var j,m,n;for(var e=d.meshes.slice(0),g=e.length,l=0;g>l;l++){j=[],m=e[l];if(c._canBeMerged(m)){j.push(m);for(var q=l+1;g>q;q++){n=e[q];c._canBeMerged(n)&&n.material===m.material&&n.checkCollisions===m.checkCollisions&&(j.push(n),g--,e.splice(q,1),q--);}2>j.length||b.Mesh.MergeMeshes(j);}}y4tt.q9();return void 0!=f?f&&d.createOrUpdateSelectionOctree():p.UpdateSelectionTree&&d.createOrUpdateSelectionOctree(),!0;};};m=(__extends(p,g),Object.defineProperty(p,"UpdateSelectionTree",{get:function(){return p._UpdateSelectionTree;},set:function(b){p._UpdateSelectionTree=b;},enumerable:!0,configurable:!0}),p._UpdateSelectionTree=!1,p);b.MergeMeshesOptimization=m;s=function(b,c){void 0===b&&(b=60);void 0===c&&(c=2E3);this.targetFrameRate=b;y4tt.v9();this.trackerDuration=c;this.optimizations=[];};r=(s.LowDegradationAllowed=function(b){var c;b=new s(b);c=0;y4tt.q9();return b.optimizations.push(new m(c)),b.optimizations.push(new f(c)),b.optimizations.push(new j(c)),c++,b.optimizations.push(new q(c)),b.optimizations.push(new l(c)),c++,b.optimizations.push(new e(c,1024)),b;},s.ModerateDegradationAllowed=function(b){var c;b=new s(b);c=0;return b.optimizations.push(new m(c)),b.optimizations.push(new f(c)),b.optimizations.push(new j(c)),c++,b.optimizations.push(new q(c)),b.optimizations.push(new l(c)),c++,b.optimizations.push(new e(c,512)),c++,b.optimizations.push(new n(c)),c++,b.optimizations.push(new d(c,2)),b;},s.HighDegradationAllowed=function(b){var c;b=new s(b);y4tt.v9();c=0;return b.optimizations.push(new m(c)),b.optimizations.push(new f(c)),b.optimizations.push(new j(c)),c++,b.optimizations.push(new q(c)),b.optimizations.push(new l(c)),c++,b.optimizations.push(new e(c,256)),c++,b.optimizations.push(new n(c)),c++,b.optimizations.push(new d(c,4)),b;},s);b.SceneOptimizerOptions=r;t=function(){},c=(t._CheckCurrentState=function(b,c,d,f,e){var m;if(b.getEngine().getFps()>=c.targetFrameRate)return void(f&&f());for(var g=!0,l=!0,j=0;j<c.optimizations.length;j++){m=c.optimizations[j];m.priority===d&&(l=!1,g=g&&m.apply(b));}y4tt.q9();return l?void(e&&e()):(g&&d++,void b.executeWhenReady(function(){y4tt.q9();setTimeout(function(){y4tt.v9();t._CheckCurrentState(b,c,d,f,e);},c.trackerDuration);}));},t.OptimizeAsync=function(b,c,d,f){c||(c=r.ModerateDegradationAllowed());b.executeWhenReady(function(){y4tt.q9();setTimeout(function(){t._CheckCurrentState(b,c,0,d,f);},c.trackerDuration);});},t);b.SceneOptimizer=c;}(BABYLON||(BABYLON={}));!function(b){y4tt.v9();(b.Internals||(b.Internals={})).MeshLODLevel=function(b,e){this.distance=b;this.mesh=e;};!0;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.Texture,c=function(c,f,g,j,l,n,m,p){void 0===n&&(n=!0);void 0===m&&(m=!1);void 0===p&&(p=b.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,l,!n,m);this.format=j;this._texture=l.getEngine().createRawTexture(c,f,g,j,n,m,p);this.wrapV=this.wrapU=b.Texture.CLAMP_ADDRESSMODE;};g=(__extends(c,e),c.prototype.update=function(b){y4tt.v9();this.getScene().getEngine().updateRawTexture(this._texture,b,this.format,this._invertY);},c.CreateLuminanceTexture=function(d,f,e,g,l,n,m){y4tt.v9();return void 0===l&&(l=!0),void 0===n&&(n=!1),void 0===m&&(m=b.Texture.TRILINEAR_SAMPLINGMODE),new c(d,f,e,b.Engine.TEXTUREFORMAT_LUMINANCE,g,l,n,m);},c.CreateLuminanceAlphaTexture=function(d,f,e,g,l,n,m){y4tt.v9();return void 0===l&&(l=!0),void 0===n&&(n=!1),void 0===m&&(m=b.Texture.TRILINEAR_SAMPLINGMODE),new c(d,f,e,b.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,g,l,n,m);},c.CreateAlphaTexture=function(d,f,e,g,l,n,m){return void 0===l&&(l=!0),void 0===n&&(n=!1),void 0===m&&(m=b.Texture.TRILINEAR_SAMPLINGMODE),new c(d,f,e,b.Engine.TEXTUREFORMAT_ALPHA,g,l,n,m);},c.CreateRGBTexture=function(d,f,e,g,l,n,m){return void 0===l&&(l=!0),void 0===n&&(n=!1),void 0===m&&(m=b.Texture.TRILINEAR_SAMPLINGMODE),new c(d,f,e,b.Engine.TEXTUREFORMAT_RGB,g,l,n,m);},c.CreateRGBATexture=function(d,f,e,g,l,n,m){return void 0===l&&(l=!0),void 0===n&&(n=!1),void 0===m&&(m=b.Texture.TRILINEAR_SAMPLINGMODE),new c(d,f,e,b.Engine.TEXTUREFORMAT_RGBA,g,l,n,m);},c);b.RawTexture=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d;e=b.Vector2,c=function(b,c){y4tt.q9();e.call(this,b.x,b.y);this.index=c;};g=(__extends(c,e),c);c=function(){this.elements=[];};d=(c.prototype.add=function(b){var c,d;c=this,d=[];return b.forEach(function(b){y4tt.q9();if(0===d.length||!b.equalsWithEpsilon(d[0]))b=new g(b,c.elements.length),d.push(b),c.elements.push(b);}),d;},c.prototype.computeBounds=function(){var c,d;y4tt.q9();c=new b.Vector2(this.elements[0].x,this.elements[0].y),d=new b.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(b){b.x<c.x?c.x=b.x:b.x>d.x&&(d.x=b.x);b.y<c.y?c.y=b.y:b.y>d.y&&(d.y=b.y);}),{min:c,max:d,width:d.x-c.x,height:d.y-c.y};},c);c=function(){};c=(c.Rectangle=function(c,d,e,g){return[new b.Vector2(c,d),new b.Vector2(e,d),new b.Vector2(e,g),new b.Vector2(c,g)];},c.Circle=function(c,d,e,g){void 0===d&&(d=0);void 0===e&&(e=0);void 0===g&&(g=32);y4tt.v9();for(var n=[],m=0,p=2*Math.PI/g,r=0;g>r;r++)n.push(new b.Vector2(d+Math.cos(m)*c,e+Math.sin(m)*c)),m-=p;return n;},c.Parse=function(c){var d,e;d=c.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(b){y4tt.v9();return!isNaN(b);}),e=[];for(c=0;c<(2147483646&d.length);c+=2)e.push(new b.Vector2(d[c],d[c+1]));return e;},c.StartingAt=function(c,d){y4tt.v9();return b.Path2.StartingAt(c,d);},c);b.Polygon=c;c=function(c,e,g){this._points=new d();this._outlinepoints=new d();this._holes=[];this._epoints=[];this._eholes=[];this._name=c;this._scene=g;c=e instanceof b.Path2?e.getPoints():e;this._addToepoint(c);this._points.add(c);this._outlinepoints.add(c);};c=(c.prototype._addToepoint=function(b){var d;for(var c=0;c<b.length;c++){d=b[c];this._epoints.push(d.x,d.y);}},c.prototype.addHole=function(b){var c;this._points.add(b);c=new d();return c.add(b),this._holes.push(c),this._eholes.push(this._epoints.length/2),this._addToepoint(b),this;},c.prototype.build=function(c,d){var e,g,n,m,p,r,x,z;e=this;void 0===c&&(c=!1);g=new b.Mesh(this._name,this._scene),n=[],m=[],p=[],r=this._points.computeBounds();this._points.elements.forEach(function(b){n.push(0,1,0);m.push(b.x,0,b.y);p.push((b.x-r.min.x)/r.width,(b.y-r.min.y)/r.height);});for(var s=[],t=Earcut.earcut(this._epoints,this._eholes,2),v=0;v<t.length;v++)s.push(t[v]);if(0<d){t=m.length/3;this._points.elements.forEach(function(b){n.push(0,-1,0);m.push(b.x,-d,b.y);y4tt.q9();p.push(1-(b.x-r.min.x)/r.width,1-(b.y-r.min.y)/r.height);});for(var y=s.length,v=0;y>v;v+=3){x=s[v+0],z=s[v+1];s.push(s[v+2]+t);s.push(z+t);s.push(x+t);}this.addSide(m,n,p,s,r,this._outlinepoints,d,!1);this._holes.forEach(function(b){e.addSide(m,n,p,s,r,b,d,!0);});}return g.setVerticesData(b.VertexBuffer.PositionKind,m,c),g.setVerticesData(b.VertexBuffer.NormalKind,n,c),g.setVerticesData(b.VertexBuffer.UVKind,p,c),g.setIndices(s),g;},c.prototype.addSide=function(c,d,e,g,n,m,p,r){var y,x;for(var s=c.length/3,t=0,v=0;v<m.elements.length;v++){x=m.elements[v];y=v+1>m.elements.length-1?m.elements[0]:m.elements[v+1];c.push(x.x,0,x.y);c.push(x.x,-p,x.y);c.push(y.x,0,y.y);c.push(y.x,-p,y.y);x=new b.Vector3(x.x,0,x.y);y=new b.Vector3(y.x,0,y.y).subtract(x);x=new b.Vector3(0,1,0);x=b.Vector3.Cross(y,x);x=x.normalize();e.push(t/n.width,0);e.push(t/n.width,1);t+=y.length();e.push(t/n.width,0);e.push(t/n.width,1);r?(d.push(x.x,x.y,x.z),d.push(x.x,x.y,x.z),d.push(x.x,x.y,x.z),d.push(x.x,x.y,x.z),g.push(s),g.push(s+2),g.push(s+1),g.push(s+1),g.push(s+2),g.push(s+3)):(d.push(-x.x,-x.y,-x.z),d.push(-x.x,-x.y,-x.z),d.push(-x.x,-x.y,-x.z),d.push(-x.x,-x.y,-x.z),g.push(s),g.push(s+1),g.push(s+2),g.push(s+1),g.push(s+3),g.push(s+2));s+=4;}},c);b.PolygonMeshBuilder=c;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(c,d,f){void 0===f&&(f=2);this.maxDepth=f;this.dynamicContent=[];y4tt.v9();this._maxBlockCapacity=d||64;this._selectionContent=new b.SmartArray(1024);this._creationFunc=c;};g=(e.prototype.update=function(b,d,f){y4tt.v9();e._CreateBlocks(b,d,f,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc);},e.prototype.addMesh=function(b){y4tt.v9();for(var d=0;d<this.blocks.length;d++)this.blocks[d].addEntry(b);},e.prototype.select=function(b,d){this._selectionContent.reset();for(var f=0;f<this.blocks.length;f++)this.blocks[f].select(b,this._selectionContent,d);return d?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent;},e.prototype.intersects=function(b,d,f){this._selectionContent.reset();for(var e=0;e<this.blocks.length;e++)this.blocks[e].intersects(b,d,this._selectionContent,f);return f?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent;},e.prototype.intersectsRay=function(b){this._selectionContent.reset();for(var d=0;d<this.blocks.length;d++)this.blocks[d].intersectsRay(b,this._selectionContent);return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent;},e._CreateBlocks=function(c,d,f,e,g,l,n,m){var t,v;n.blocks=[];d=new b.Vector3((d.x-c.x)/2,(d.y-c.y)/2,(d.z-c.z)/2);y4tt.v9();for(var p=0;2>p;p++)for(var r=0;2>r;r++)for(var s=0;2>s;s++){t=c.add(d.multiplyByFloats(p,r,s)),v=c.add(d.multiplyByFloats(p+1,r+1,s+1)),t=new b.OctreeBlock(t,v,e,g+1,l,m);t.addEntries(f);n.blocks.push(t);}},e.CreationFuncForMeshes=function(b,d){!b.isBlocked&&b.getBoundingInfo().boundingBox.intersectsMinMax(d.minPoint,d.maxPoint)&&d.entries.push(b);},e.CreationFuncForSubMeshes=function(b,d){y4tt.v9();b.getBoundingInfo().boundingBox.intersectsMinMax(d.minPoint,d.maxPoint)&&d.entries.push(b);},e);b.Octree=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(b,c,d,f,g,j){this.entries=[];this._boundingVectors=[];this._capacity=d;this._depth=f;this._maxDepth=g;this._creationFunc=j;this._minPoint=b;this._maxPoint=c;this._boundingVectors.push(b.clone());this._boundingVectors.push(c.clone());this._boundingVectors.push(b.clone());this._boundingVectors[2].x=c.x;this._boundingVectors.push(b.clone());this._boundingVectors[3].y=c.y;this._boundingVectors.push(b.clone());this._boundingVectors[4].z=c.z;this._boundingVectors.push(c.clone());this._boundingVectors[5].z=b.z;this._boundingVectors.push(c.clone());this._boundingVectors[6].x=b.x;this._boundingVectors.push(c.clone());this._boundingVectors[7].y=b.y;};y4tt.q9();g=(Object.defineProperty(g.prototype,"capacity",{get:function(){return this._capacity;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"minPoint",{get:function(){y4tt.q9();return this._minPoint;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"maxPoint",{get:function(){return this._maxPoint;},enumerable:!0,configurable:!0}),g.prototype.addEntry=function(b){y4tt.v9();if(this.blocks)for(var c=0;c<this.blocks.length;c++)this.blocks[c].addEntry(b);else this._creationFunc(b,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks();},g.prototype.addEntries=function(b){for(var c=0;c<b.length;c++)this.addEntry(b[c]);},g.prototype.select=function(e,c,d){y4tt.v9();if(b.BoundingBox.IsInFrustum(this._boundingVectors,e))if(this.blocks)for(var f=0;f<this.blocks.length;f++)this.blocks[f].select(e,c,d);else d?c.concat(this.entries):c.concatWithNoDuplicate(this.entries);},g.prototype.intersects=function(e,c,d,f){y4tt.q9();if(b.BoundingBox.IntersectsSphere(this._minPoint,this._maxPoint,e,c))if(this.blocks)for(var g=0;g<this.blocks.length;g++)this.blocks[g].intersects(e,c,d,f);else f?d.concat(this.entries):d.concatWithNoDuplicate(this.entries);},g.prototype.intersectsRay=function(b,c){if(b.intersectsBoxMinMax(this._minPoint,this._maxPoint))if(this.blocks)for(var d=0;d<this.blocks.length;d++)this.blocks[d].intersectsRay(b,c);else c.concatWithNoDuplicate(this.entries);},g.prototype.createInnerBlocks=function(){b.Octree._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc);},g);b.OctreeBlock=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.PostProcess;g=function(c,d,f,g,j,l,n,m){var p;p=this;void 0===l&&(l=b.Texture.BILINEAR_SAMPLINGMODE);e.call(this,c,"blur",["screenSize","direction","blurWidth"],null,g,j,l,n,m);this.direction=d;this.blurWidth=f;this.onApplyObservable.add(function(b){y4tt.v9();b.setFloat2("screenSize",p.width,p.height);b.setVector2("direction",p.direction);b.setFloat("blurWidth",p.blurWidth);});};g=(__extends(g,e),g);b.BlurPostProcess=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.PostProcess;g=function(c,d,f,g,j,l,n,m,p,r){var s;s=this;e.call(this,c,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],l,n,m,p,r);y4tt.v9();this.color=f;this.depth=g;this.colorLevel=j;this.onActivateObservable.add(function(c){y4tt.q9();s._refRexture=s._refRexture||new b.Texture(d,c.getScene());});this.onApplyObservable.add(function(b){b.setColor3("baseColor",s.color);b.setFloat("depth",s.depth);b.setFloat("colorLevel",s.colorLevel);b.setTexture("refractionSampler",s._refRexture);});};g=(__extends(g,e),g.prototype.dispose=function(b){this._refRexture&&this._refRexture.dispose();e.prototype.dispose.call(this,b);},g);b.RefractionPostProcess=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.PostProcess;g=function(b,d,f,g,j,l){e.call(this,b,"blackAndWhite",null,null,d,f,g,j,l);};g=(__extends(g,e),g);b.BlackAndWhitePostProcess=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.PostProcess;g=function(b,d,f,g,j,l,n){var m;m=this;y4tt.v9();e.call(this,b,"convolution",["kernel","screenSize"],null,f,g,j,l,n);this.kernel=d;this.onApply=function(b){b.setFloat2("screenSize",m.width,m.height);y4tt.q9();b.setArray("kernel",m.kernel);};};g=(__extends(g,e),g.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],g.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],g.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],g.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],g.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],g.GaussianKernel=[0,1,0,1,1,1,0,1,0],g);b.ConvolutionPostProcess=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.PostProcess;g=function(b,d,f,g,j,l,n){var m;m=this;e.call(this,b,"filter",["kernelMatrix"],null,f,g,j,l,n);this.kernelMatrix=d;y4tt.v9();this.onApply=function(b){b.setMatrix("kernelMatrix",m.kernelMatrix);};};g=(__extends(g,e),g);b.FilterPostProcess=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.PostProcess;g=function(b,d,f,g,j,l){var n;n=this;e.call(this,b,"fxaa",["texelSize"],null,d,f,g,j,l);this.onSizeChangedObservable.add(function(){y4tt.v9();n.texelWidth=1/n.width;n.texelHeight=1/n.height;});y4tt.v9();this.onApplyObservable.add(function(b){y4tt.q9();b.setFloat2("texelSize",n.texelWidth,n.texelHeight);});};g=(__extends(g,e),g);b.FxaaPostProcess=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.PostProcess;g=function(c,d,f,g,j,l){var n;n=this;e.call(this,c,"stereoscopicInterlace",["stepSize"],["camASampler"],1,d[1],g,j,l,f?"#define IS_STEREOSCOPIC_HORIZ 1":void 0);this._passedProcess=d[0]._rigPostProcess;this._stepSize=new b.Vector2(1/this.width,1/this.height);this.onSizeChangedObservable.add(function(){n._stepSize=new b.Vector2(1/n.width,1/n.height);});this.onApplyObservable.add(function(b){b.setTextureFromPostProcess("camASampler",n._passedProcess);b.setFloat2("stepSize",n._stepSize.x,n._stepSize.y);});};g=(__extends(g,e),g);b.StereoscopicInterlacePostProcess=g;}(BABYLON||(BABYLON={}));!function(b){b.LensFlare=function(g,e,c,d,f){this.size=g;this.position=e;y4tt.q9();this.dispose=function(){var b;this.texture&&this.texture.dispose();b=this._system.lensFlares.indexOf(this);y4tt.q9();this._system.lensFlares.splice(b,1);};this.color=c||new b.Color3(1,1,1);this.texture=d?new b.Texture(d,f.getScene(),!0):null;this._system=f;f.lensFlares.push(this);};}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(c,d,f){this.name=c;this.lensFlares=[];this.borderLimit=300;this.layerMask=268435455;this._vertexBuffers={};this._isEnabled=!0;this._scene=f;this._emitter=d;this.id=c;f.lensFlareSystems.push(this);this.meshesSelectionPredicate=function(b){y4tt.v9();return b.material&&b.isVisible&&b.isEnabled()&&b.isBlocker&&0!=(b.layerMask&f.activeCamera.layerMask);};c=f.getEngine();d=[];d.push(1,1);d.push(-1,1);d.push(-1,-1);d.push(1,-1);this._vertexBuffers[b.VertexBuffer.PositionKind]=new b.VertexBuffer(c,d,b.VertexBuffer.PositionKind,!1,!1,2);d=[];y4tt.v9();d.push(0);d.push(1);d.push(2);d.push(0);d.push(2);d.push(3);this._indexBuffer=c.createIndexBuffer(d);this._effect=c.createEffect("lensFlare",[b.VertexBuffer.PositionKind],["color","viewportMatrix"],["textureSampler"],"");};y4tt.v9();g=(Object.defineProperty(e.prototype,"isEnabled",{get:function(){y4tt.q9();return this._isEnabled;},set:function(b){this._isEnabled=b;},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene;},e.prototype.getEmitter=function(){y4tt.v9();return this._emitter;},e.prototype.setEmitter=function(b){y4tt.q9();this._emitter=b;},e.prototype.getEmitterPosition=function(){y4tt.v9();return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position;},e.prototype.computeEffectivePosition=function(c){var d;d=this.getEmitterPosition();return d=b.Vector3.Project(d,b.Matrix.Identity(),this._scene.getTransformMatrix(),c),this._positionX=d.x,this._positionY=d.y,d=b.Vector3.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),0<d.z&&this._positionX>c.x&&this._positionX<c.x+c.width&&this._positionY>c.y&&this._positionY<c.y+c.height;},e.prototype._isVisible=function(){var c,d;if(!this._isEnabled)return!1;c=this.getEmitterPosition().subtract(this._scene.activeCamera.position),d=c.length();c.normalize();c=new b.Ray(this._scene.activeCamera.position,c);c=this._scene.pickWithRay(c,this.meshesSelectionPredicate,!0);return!c.hit||c.distance>d;},e.prototype.render=function(){var c,d,f,e,g,l,n,p,r,s,t,v;if(!this._effect.isReady())return!1;c=this._scene.getEngine(),d=this._scene.activeCamera.viewport.toGlobal(c.getRenderWidth(!0),c.getRenderHeight(!0));if(!this.computeEffectivePosition(d)||!this._isVisible())return!1;f=this._positionX<this.borderLimit+d.x?this.borderLimit+d.x-this._positionX:this._positionX>d.x+d.width-this.borderLimit?this._positionX-d.x-d.width+this.borderLimit:0;e=this._positionY<this.borderLimit+d.y?this.borderLimit+d.y-this._positionY:this._positionY>d.y+d.height-this.borderLimit?this._positionY-d.y-d.height+this.borderLimit:0;f=f>e?f:e;f>this.borderLimit&&(f=this.borderLimit);f=1-f/this.borderLimit;if(0>f)return!1;1<f&&(f=1);e=d.x+d.width/2;g=d.y+d.height/2,l=e-this._positionX,n=g-this._positionY;c.enableEffect(this._effect);c.setState(!1);c.setDepthBuffer(!1);c.setAlphaMode(b.Engine.ALPHA_ONEONE);c.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var m=0;m<this.lensFlares.length;m++){p=this.lensFlares[m],r=e-l*p.position,s=g-n*p.position,t=p.size,v=p.size*c.getAspectRatio(this._scene.activeCamera,!0),r=b.Matrix.FromValues(t/2,0,0,0,0,v/2,0,0,0,0,1,0,2*(r/d.width)-1,1-2*(s/d.height),0,1);this._effect.setMatrix("viewportMatrix",r);this._effect.setTexture("textureSampler",p.texture);this._effect.setFloat4("color",p.color.r*f,p.color.g*f,p.color.b*f,1);c.draw(!0,0,6);}return c.setDepthBuffer(!0),c.setAlphaMode(b.Engine.ALPHA_DISABLE),!0;},e.prototype.dispose=function(){var c;y4tt.v9();c=this._vertexBuffers[b.VertexBuffer.PositionKind];c&&(c.dispose(),this._vertexBuffers[b.VertexBuffer.PositionKind]=null);for(this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();c=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(c,1);},e.Parse=function(c,d,f){var g,j;g=d.getLastEntryByID(c.emitterId),j=c.name||"lensFlareSystem#"+c.emitterId;d=new e(j,g,d);y4tt.v9();d.id=c.id||j;d.borderLimit=c.borderLimit;for(j=0;j<c.flares.length;j++)g=c.flares[j],new b.LensFlare(g.size,g.position,b.Color3.FromArray(g.color),f+g.textureName,d);return d;},e.prototype.serialize=function(){var c,f;c={};c.id=this.id;c.name=this.name;c.emitterId=this.getEmitter().id;y4tt.q9();c.borderLimit=this.borderLimit;c.flares=[];for(var d=0;d<this.lensFlares.length;d++){f=this.lensFlares[d];c.flares.push({size:f.size,position:f.position,color:f.color.asArray(),textureName:b.Tools.GetFilename(f.texture.name)});}return c;},e);b.LensFlareSystem=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.FreeCamera;g=function(b,d,f){y4tt.q9();e.call(this,b,d,f);this.inputs.addDeviceOrientation();};g=(__extends(g,e),Object.defineProperty(g.prototype,"angularSensibility",{get:function(){return 0;},set:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"moveSensibility",{get:function(){return 0;},set:function(){},enumerable:!0,configurable:!0}),g.prototype.getTypeName=function(){y4tt.q9();return"DeviceOrientationCamera";},g);b.DeviceOrientationCamera=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.TouchCamera;y4tt.q9();g=function(b,d,f){e.call(this,b,d,f);this.inputs.addGamepad();};g=(__extends(g,e),Object.defineProperty(g.prototype,"gamepadAngularSensibility",{get:function(){var b;b=this.inputs.attached.gamepad;y4tt.q9();return b?b.gamepadAngularSensibility:void 0;},set:function(b){var d;y4tt.v9();d=this.inputs.attached.gamepad;d&&(d.gamepadAngularSensibility=b);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"gamepadMoveSensibility",{get:function(){var b;b=this.inputs.attached.gamepad;return b?b.gamepadMoveSensibility:void 0;},set:function(b){var d;d=this.inputs.attached.gamepad;d&&(d.gamepadMoveSensibility=b);},enumerable:!0,configurable:!0}),g.prototype.getTypeName=function(){return"UniversalCamera";},g);b.UniversalCamera=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j;e=function(b){var c;c=this;this.babylonGamepads=[];this.isMonitoring=this.oneGamepadConnected=!1;this.gamepadEventSupported="GamepadEvent"in window;this.gamepadSupportAvailable=navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.msGetGamepads||!!navigator.webkitGamepads;this._callbackGamepadConnected=b;this.gamepadSupportAvailable&&(this.gamepadEventSupported?(this._onGamepadConnectedEvent=function(b){y4tt.v9();c._onGamepadConnected(b);},this._onGamepadDisonnectedEvent=function(b){y4tt.v9();c._onGamepadDisconnected(b);},window.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisonnectedEvent,!1)):this._startMonitoringGamepads());};g=(e.prototype.dispose=function(){y4tt.q9();e.gamepadDOMInfo&&document.body.removeChild(e.gamepadDOMInfo);this._onGamepadConnectedEvent&&(window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.removeEventListener("gamepaddisconnected",this._onGamepadDisonnectedEvent,!1),this._onGamepadConnectedEvent=null,this._onGamepadDisonnectedEvent=null);},e.prototype._onGamepadConnected=function(b){b=this._addNewGamepad(b.gamepad);this._callbackGamepadConnected&&this._callbackGamepadConnected(b);this._startMonitoringGamepads();},e.prototype._addNewGamepad=function(b){var c;this.oneGamepadConnected||(this.oneGamepadConnected=!0,e.gamepadDOMInfo&&(document.body.removeChild(e.gamepadDOMInfo),e.gamepadDOMInfo=null));return c=-1!==b.id.search("Xbox 360")||-1!==b.id.search("xinput")?new j(b.id,b.index,b):new d(b.id,b.index,b),this.babylonGamepads.push(c),c;},e.prototype._onGamepadDisconnected=function(b){for(var c in this.babylonGamepads)if(this.babylonGamepads[c].index==b.gamepad.index){this.babylonGamepads.splice(+c,1);break;}0==this.babylonGamepads.length&&this._stopMonitoringGamepads();},e.prototype._startMonitoringGamepads=function(){this.isMonitoring||(this.isMonitoring=!0,this._checkGamepadsStatus());},e.prototype._stopMonitoringGamepads=function(){y4tt.q9();this.isMonitoring=!1;},e.prototype._checkGamepadsStatus=function(){var b;b=this;this._updateGamepadObjects();y4tt.q9();for(var c in this.babylonGamepads)this.babylonGamepads[c].update();this.isMonitoring&&(window.requestAnimationFrame?window.requestAnimationFrame(function(){y4tt.v9();b._checkGamepadsStatus();}):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(function(){y4tt.q9();b._checkGamepadsStatus();}):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(function(){b._checkGamepadsStatus();}));},e.prototype._updateGamepadObjects=function(){var d;y4tt.v9();for(var b=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],c=0;c<b.length;c++)if(b[c])if(b[c].index in this.babylonGamepads)this.babylonGamepads[c].browserGamepad=b[c];else{d=this._addNewGamepad(b[c]);this._callbackGamepadConnected&&this._callbackGamepadConnected(d);}},e);b.Gamepads=g;b.StickValues=function(b,c){this.x=b;y4tt.v9();this.y=c;};g=function(b,c,d){y4tt.q9();this.id=b;this.index=c;this.browserGamepad=d;2<=this.browserGamepad.axes.length&&(this._leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]});4<=this.browserGamepad.axes.length&&(this._rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]});};c=(g.prototype.onleftstickchanged=function(b){y4tt.v9();this._onleftstickchanged=b;},g.prototype.onrightstickchanged=function(b){y4tt.v9();this._onrightstickchanged=b;},Object.defineProperty(g.prototype,"leftStick",{get:function(){y4tt.v9();return this._leftStick;},set:function(b){y4tt.v9();!this._onleftstickchanged||this._leftStick.x===b.x&&this._leftStick.y===b.y||this._onleftstickchanged(b);this._leftStick=b;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"rightStick",{get:function(){return this._rightStick;},set:function(b){!this._onrightstickchanged||this._rightStick.x===b.x&&this._rightStick.y===b.y||this._onrightstickchanged(b);this._rightStick=b;},enumerable:!0,configurable:!0}),g.prototype.update=function(){y4tt.q9();this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]});this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]});},g);b.Gamepad=c;g=function(b,d,f){c.call(this,b,d,f);this.id=b;this.index=d;this.gamepad=f;this._buttons=Array(f.buttons.length);};d=(__extends(g,c),g.prototype.onbuttondown=function(b){this._onbuttondown=b;},g.prototype.onbuttonup=function(b){this._onbuttonup=b;},g.prototype._setButtonValue=function(b,c,d){y4tt.v9();return b!==c&&(this._onbuttondown&&1===b&&this._onbuttondown(d),this._onbuttonup&&0===b&&this._onbuttonup(d)),b;},g.prototype.update=function(){y4tt.v9();c.prototype.update.call(this);for(var b=0;b<this._buttons.length;b++)this._buttons[b]=this._setButtonValue(this.gamepad.buttons[b].value,this._buttons[b],b);},g);b.GenericPad=d;g=b.Xbox360Button||(b.Xbox360Button={});g[g.A=0]="A";g[g.B=1]="B";g[g.X=2]="X";g[g.Y=3]=5450==(9581,4960)?("u","C"):"Y";g[g.Start=4]="Start";g[g.Back=5]="Back";g[g.LB=6]="LB";g[g.RB=7]="RB";g[g.LeftStick=8]="LeftStick";g[g.RightStick=9]="RightStick";f=b.Xbox360Button;g=b.Xbox360Dpad||(b.Xbox360Dpad={});g[g.Up=0]="Up";g[g.Down=1]="Down";g[g.Left=2]="Left";g[g.Right=3]="Right";!0;q=b.Xbox360Dpad;g=function(){c.apply(this,arguments);this._dPadRight=this._dPadLeft=this._dPadDown=this._dPadUp=this._buttonRightStick=this._buttonLeftStick=this._buttonRB=this._buttonLB=this._buttonStart=this._buttonBack=this._buttonY=this._buttonX=this._buttonB=this._buttonA=this._rightTrigger=this._leftTrigger=0;};j=(__extends(g,c),g.prototype.onlefttriggerchanged=function(b){y4tt.q9();this._onlefttriggerchanged=b;},g.prototype.onrighttriggerchanged=function(b){this._onrighttriggerchanged=b;},Object.defineProperty(g.prototype,"leftTrigger",{get:function(){return this._leftTrigger;},set:function(b){this._onlefttriggerchanged&&this._leftTrigger!==b&&this._onlefttriggerchanged(b);this._leftTrigger=b;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"rightTrigger",{get:function(){y4tt.q9();return this._rightTrigger;},set:function(b){this._onrighttriggerchanged&&this._rightTrigger!==b&&this._onrighttriggerchanged(b);y4tt.q9();this._rightTrigger=b;},enumerable:!0,configurable:!0}),g.prototype.onbuttondown=function(b){this._onbuttondown=b;},g.prototype.onbuttonup=function(b){this._onbuttonup=b;},g.prototype.ondpaddown=function(b){y4tt.v9();this._ondpaddown=b;},g.prototype.ondpadup=function(b){y4tt.v9();this._ondpadup=b;},g.prototype._setButtonValue=function(b,c,d){y4tt.v9();return b!==c&&(this._onbuttondown&&1===b&&this._onbuttondown(d),this._onbuttonup&&0===b&&this._onbuttonup(d)),b;},g.prototype._setDPadValue=function(b,c,d){return b!==c&&(this._ondpaddown&&1===b&&this._ondpaddown(d),this._ondpadup&&0===b&&this._ondpadup(d)),b;},Object.defineProperty(g.prototype,"buttonA",{get:function(){return this._buttonA;},set:function(b){this._buttonA=this._setButtonValue(b,this._buttonA,f.A);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"buttonB",{get:function(){y4tt.q9();return this._buttonB;},set:function(b){this._buttonB=this._setButtonValue(b,this._buttonB,f.B);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"buttonX",{get:function(){y4tt.v9();return this._buttonX;},set:function(b){y4tt.q9();this._buttonX=this._setButtonValue(b,this._buttonX,f.X);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"buttonY",{get:function(){return this._buttonY;},set:function(b){this._buttonY=this._setButtonValue(b,this._buttonY,f.Y);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"buttonStart",{get:function(){y4tt.q9();return this._buttonStart;},set:function(b){this._buttonStart=this._setButtonValue(b,this._buttonStart,f.Start);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"buttonBack",{get:function(){return this._buttonBack;},set:function(b){this._buttonBack=this._setButtonValue(b,this._buttonBack,f.Back);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"buttonLB",{get:function(){y4tt.v9();return this._buttonLB;},set:function(b){this._buttonLB=this._setButtonValue(b,this._buttonLB,f.LB);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"buttonRB",{get:function(){return this._buttonRB;},set:function(b){this._buttonRB=this._setButtonValue(b,this._buttonRB,f.RB);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"buttonLeftStick",{get:function(){y4tt.q9();return this._buttonLeftStick;},set:function(b){y4tt.v9();this._buttonLeftStick=this._setButtonValue(b,this._buttonLeftStick,f.LeftStick);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"buttonRightStick",{get:function(){y4tt.q9();return this._buttonRightStick;},set:function(b){this._buttonRightStick=this._setButtonValue(b,this._buttonRightStick,f.RightStick);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"dPadUp",{get:function(){y4tt.v9();return this._dPadUp;},set:function(b){y4tt.v9();this._dPadUp=this._setDPadValue(b,this._dPadUp,q.Up);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"dPadDown",{get:function(){return this._dPadDown;},set:function(b){y4tt.q9();this._dPadDown=this._setDPadValue(b,this._dPadDown,q.Down);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"dPadLeft",{get:function(){y4tt.v9();return this._dPadLeft;},set:function(b){y4tt.v9();this._dPadLeft=this._setDPadValue(b,this._dPadLeft,q.Left);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"dPadRight",{get:function(){return this._dPadRight;},set:function(b){this._dPadRight=this._setDPadValue(b,this._dPadRight,q.Right);},enumerable:!0,configurable:!0}),g.prototype.update=function(){c.prototype.update.call(this);this.buttonA=this.browserGamepad.buttons[0].value;this.buttonB=this.browserGamepad.buttons[1].value;this.buttonX=this.browserGamepad.buttons[2].value;this.buttonY=this.browserGamepad.buttons[3].value;this.buttonLB=this.browserGamepad.buttons[4].value;this.buttonRB=this.browserGamepad.buttons[5].value;this.leftTrigger=this.browserGamepad.buttons[6].value;this.rightTrigger=this.browserGamepad.buttons[7].value;this.buttonBack=this.browserGamepad.buttons[8].value;this.buttonStart=this.browserGamepad.buttons[9].value;this.buttonLeftStick=this.browserGamepad.buttons[10].value;this.buttonRightStick=this.browserGamepad.buttons[11].value;this.dPadUp=this.browserGamepad.buttons[12].value;this.dPadDown=this.browserGamepad.buttons[13].value;this.dPadLeft=this.browserGamepad.buttons[14].value;this.dPadRight=this.browserGamepad.buttons[15].value;},g);b.Xbox360Pad=j;}(BABYLON||(BABYLON={}));!function(b){var g,e;y4tt.q9();e=b.UniversalCamera;g=function(c,d,f){b.Tools.Warn("Deprecated. Please use Universal Camera instead.");e.call(this,c,d,f);};g=(__extends(g,e),Object.defineProperty(g.prototype,"gamepadAngularSensibility",{get:function(){var b;y4tt.q9();b=this.inputs.attached.gamepad;return b?b.gamepadAngularSensibility:void 0;},set:function(b){var d;d=this.inputs.attached.gamepad;y4tt.v9();d&&(d.gamepadAngularSensibility=b);},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"gamepadMoveSensibility",{get:function(){var b;y4tt.q9();b=this.inputs.attached.gamepad;return b?b.gamepadMoveSensibility:void 0;},set:function(b){var d;d=this.inputs.attached.gamepad;y4tt.v9();d&&(d.gamepadMoveSensibility=b);},enumerable:!0,configurable:!0}),g.prototype.getTypeName=function(){y4tt.q9();return"GamepadCamera";},g);b.GamepadCamera=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(e){this.SMOOTHING=0.75;this.FFT_SIZE=512;this.BARGRAPHAMPLITUDE=256;this.DEBUGCANVASPOS={x:20,y:20};this.DEBUGCANVASSIZE={width:320,height:200};this._scene=e;this._audioEngine=b.Engine.audioEngine;this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount));};g=(g.prototype.getFrequencyBinCount=function(){y4tt.v9();return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0;},g.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs;},g.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime;},g.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs;},g.prototype.drawDebugCanvas=function(){var b,c,f,g,j,l;b=this;y4tt.v9();if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){b.drawDebugCanvas();},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc)){c=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)";this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var d=0;d<this.getFrequencyBinCount();d++){f=this.DEBUGCANVASSIZE.height*(c[d]/this.BARGRAPHAMPLITUDE),g=this.DEBUGCANVASSIZE.height-f-1,j=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),l=360*(d/this.getFrequencyBinCount());this._debugCanvasContext.fillStyle="hsl("+l+", 100%, 50%)";this._debugCanvasContext.fillRect(d*j,g,j,f);}}},g.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null,document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null);},g.prototype.connectAudioNodes=function(b,c){this._audioEngine.canUseWebAudio&&(b.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(c));},g.prototype.dispose=function(){y4tt.v9();this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect();},g);b.Analyser=g;}(BABYLON||(BABYLON={}));!function(b){var g;g=function(e,c){var d,f,g;d=this;void 0===c&&(c=b.Engine.TEXTURETYPE_FLOAT);this._viewMatrix=b.Matrix.Zero();this._projectionMatrix=b.Matrix.Zero();this._transformMatrix=b.Matrix.Zero();this._worldViewProjection=b.Matrix.Zero();this._scene=e;f=e.getEngine();this._depthMap=new b.RenderTargetTexture("depthMap",{width:f.getRenderWidth(),height:f.getRenderHeight()},this._scene,!1,!0,c);this._depthMap.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._depthMap.wrapV=b.Texture.CLAMP_ADDRESSMODE;this._depthMap.refreshRate=1;this._depthMap.renderParticles=!1;this._depthMap.renderList=null;this._depthMap.onClearObservable.add(function(c){y4tt.v9();c.clear(new b.Color4(1,1,1,1),!0,!0);});g=function(c){var f,e,g,q,r;f=c.getRenderingMesh(),e=d._scene,g=e.getEngine();g.setState(c.getMaterial().backFaceCulling);y4tt.v9();q=f._getInstancesRenderList(c._id);if(!q.mustReturn){r=null!==g.getCaps().instancedArrays&&null!==q.visibleInstances[c._id];if(d.isReady(c,r)){g.enableEffect(d._effect);f._bind(c,d._effect,b.Material.TriangleFillMode);g=c.getMaterial();if(d._effect.setMatrix("viewProjection",e.getTransformMatrix()),d._effect.setFloat("far",e.activeCamera.maxZ),g&&g.needAlphaTesting())e=g.getAlphaTestTexture(),d._effect.setTexture("diffuseSampler",e),d._effect.setMatrix("diffuseMatrix",e.getTextureMatrix());f.useBones&&f.computeBonesUsingShaders&&d._effect.setMatrices("mBones",f.skeleton.getTransformMatrices(f));f._processRendering(c,d._effect,b.Material.TriangleFillMode,q,r,function(b,c){return d._effect.setMatrix("world",c);});}}};this._depthMap.customRenderFunction=function(b,c){var d;for(d=0;d<b.length;d++)g(b.data[d]);y4tt.q9();for(d=0;d<c.length;d++)g(c.data[d]);};};g=(g.prototype.isReady=function(e,c){var d,f,g,j;d=e.getMaterial();if(d.disableDepthWrite)return!1;f=[],g=[b.VertexBuffer.PositionKind],j=e.getMesh();j.getScene();d&&d.needAlphaTesting()&&(f.push("#define ALPHATEST"),j.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(g.push(b.VertexBuffer.UVKind),f.push("#define UV1")),j.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(g.push(b.VertexBuffer.UV2Kind),f.push("#define UV2")));j.useBones&&j.computeBonesUsingShaders?(g.push(b.VertexBuffer.MatricesIndicesKind),g.push(b.VertexBuffer.MatricesWeightsKind),4<j.numBoneInfluencers&&(g.push(b.VertexBuffer.MatricesIndicesExtraKind),g.push(b.VertexBuffer.MatricesWeightsExtraKind)),f.push("#define NUM_BONE_INFLUENCERS "+j.numBoneInfluencers),f.push("#define BonesPerMesh "+(j.skeleton.bones.length+1))):f.push("#define NUM_BONE_INFLUENCERS 0");c&&(f.push("#define INSTANCES"),g.push("world0"),g.push("world1"),g.push("world2"),g.push("world3"));d=f.join("\n");return this._cachedDefines!==d&&(this._cachedDefines=d,this._effect=this._scene.getEngine().createEffect("depth",g,["world","mBones","viewProjection","diffuseMatrix","far"],["diffuseSampler"],d)),this._effect.isReady();},g.prototype.getDepthMap=function(){y4tt.q9();return this._depthMap;},g.prototype.dispose=function(){y4tt.v9();this._depthMap.dispose();},g);b.DepthRenderer=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.PostProcessRenderPipeline;y4tt.q9();g=function(c,d,f,g){var j,l;j=this;e.call(this,d.getEngine(),c);this.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect";this.SSAORenderEffect="SSAORenderEffect";this.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect";this.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect";this.SSAOCombineRenderEffect="SSAOCombineRenderEffect";this.totalStrength=1;this.radius=1E-4;this.area=0.0075;this.fallOff=1E-6;this.base=0.5;this._firstUpdate=!0;this._scene=d;this._createRandomTexture();this._depthTexture=d.enableDepthRenderer().getDepthMap();l=f.ssaoRatio||f;f=f.combineRatio||f;this._ratio={ssaoRatio:l,combineRatio:f};this._originalColorPostProcess=new b.PassPostProcess("SSAOOriginalSceneColor",f,null,b.Texture.BILINEAR_SAMPLINGMODE,d.getEngine(),!1);this._createSSAOPostProcess(l);this._createBlurPostProcess(l);this._createSSAOCombinePostProcess(f);this.addEffect(new b.PostProcessRenderEffect(d.getEngine(),this.SSAOOriginalSceneColorEffect,function(){y4tt.q9();return j._originalColorPostProcess;},!0));this.addEffect(new b.PostProcessRenderEffect(d.getEngine(),this.SSAORenderEffect,function(){return j._ssaoPostProcess;},!0));this.addEffect(new b.PostProcessRenderEffect(d.getEngine(),this.SSAOBlurHRenderEffect,function(){return j._blurHPostProcess;},!0));this.addEffect(new b.PostProcessRenderEffect(d.getEngine(),this.SSAOBlurVRenderEffect,function(){return j._blurVPostProcess;},!0));this.addEffect(new b.PostProcessRenderEffect(d.getEngine(),this.SSAOCombineRenderEffect,function(){return j._ssaoCombinePostProcess;},!0));d.postProcessRenderPipelineManager.addPipeline(this);g&&d.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(c,g);};g=(__extends(g,e),g.prototype.getBlurHPostProcess=function(){y4tt.q9();return b.Tools.Error("SSAORenderinPipeline.getBlurHPostProcess() is deprecated, no more blur post-process exists"),null;},g.prototype.getBlurVPostProcess=function(){y4tt.v9();return b.Tools.Error("SSAORenderinPipeline.getBlurVPostProcess() is deprecated, no more blur post-process exists"),null;},g.prototype.dispose=function(b){var f;void 0===b&&(b=!1);for(var d=0;d<this._scene.cameras.length;d++){f=this._scene.cameras[d];this._originalColorPostProcess.dispose(f);this._ssaoPostProcess.dispose(f);this._blurHPostProcess.dispose(f);this._blurVPostProcess.dispose(f);this._ssaoCombinePostProcess.dispose(f);}this._randomTexture.dispose();y4tt.v9();b&&this._scene.disableDepthRenderer();this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras);},g.prototype._createBlurPostProcess=function(c){for(var d=this,f=[],e=-8;8>e;e++)f.push(2*e);this._blurHPostProcess=new b.PostProcess("BlurH","ssao",["outSize","samplerOffsets"],["depthSampler"],c,null,b.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16");this._blurHPostProcess.onApply=function(b){b.setFloat("outSize",d._ssaoCombinePostProcess.width);b.setTexture("depthSampler",d._depthTexture);d._firstUpdate&&b.setArray("samplerOffsets",f);};this._blurVPostProcess=new b.PostProcess("BlurV","ssao",["outSize","samplerOffsets"],["depthSampler"],c,null,b.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define SAMPLES 16");this._blurVPostProcess.onApply=function(b){b.setFloat("outSize",d._ssaoCombinePostProcess.height);y4tt.v9();b.setTexture("depthSampler",d._depthTexture);d._firstUpdate&&(b.setArray("samplerOffsets",f),d._firstUpdate=!1);};},g.prototype._createSSAOPostProcess=function(c){var d,f;d=this,f=[0.5381,0.1856,-0.4319,0.1379,0.2486,0.443,0.3371,0.5679,-0.0057,-0.6999,-0.0451,-0.0019,0.0689,-0.1598,-0.8547,0.056,0.0069,-0.1843,-0.0146,0.1402,0.0762,0.01,-0.1924,-0.0344,-0.3577,-0.5301,-0.4358,-0.3169,0.1063,0.0158,0.0103,-0.5869,0.0046,-0.0897,-0.494,0.3287,0.7119,-0.0154,-0.0918,-0.0533,0.0596,-0.5411,0.0352,-0.0631,0.546,-0.4776,0.2847,-0.0271];y4tt.q9();this._ssaoPostProcess=new b.PostProcess("ssao","ssao","sampleSphere samplesFactor randTextureTiles totalStrength radius area fallOff base range viewport".split((8490,70.19)<(7430,8063)?" ":(918.00,!"")),["randomSampler"],c,null,b.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES 16\n#define SSAO");new b.Vector2(0,0);this._ssaoPostProcess.onApply=function(b){d._firstUpdate&&(b.setArray3("sampleSphere",f),b.setFloat("samplesFactor",0.0625),b.setFloat("randTextureTiles",4));b.setFloat("totalStrength",d.totalStrength);b.setFloat("radius",d.radius);y4tt.v9();b.setFloat("area",d.area);b.setFloat("fallOff",d.fallOff);b.setFloat("base",d.base);b.setTexture("textureSampler",d._depthTexture);b.setTexture("randomSampler",d._randomTexture);};},g.prototype._createSSAOCombinePostProcess=function(c){var d;d=this;this._ssaoCombinePostProcess=new b.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor"],c,null,b.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1);this._ssaoCombinePostProcess.onApply=function(b){b.setTextureFromPostProcess("originalColor",d._originalColorPostProcess);};},g.prototype._createRandomTexture=function(){this._randomTexture=new b.DynamicTexture("SSAORandomTexture",512,this._scene,!1,b.Texture.TRILINEAR_SAMPLINGMODE);this._randomTexture.wrapU=b.Texture.WRAP_ADDRESSMODE;this._randomTexture.wrapV=b.Texture.WRAP_ADDRESSMODE;for(var c=this._randomTexture.getContext(),d=b.Vector3.Zero(),f=0;512>f;f++)for(var e=0;512>e;e++)d.x=Math.floor(255*(2*Math.random()+-1)),d.y=Math.floor(255*(2*Math.random()+-1)),d.z=Math.floor(255*(2*Math.random()+-1)),c.fillStyle="rgb("+d.x+", "+d.y+", "+d.z+")",c.fillRect(f,e,1,1);this._randomTexture.update(!1);},__decorate([b.serialize()],g.prototype,"totalStrength",void 0),__decorate([b.serialize()],g.prototype,"radius",void 0),__decorate([b.serialize()],g.prototype,"area",void 0),__decorate([b.serialize()],g.prototype,"fallOff",void 0),__decorate([b.serialize()],g.prototype,"base",void 0),__decorate([b.serialize()],g.prototype,"_ratio",void 0),g);b.SSAORenderingPipeline=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.PostProcess,c=function(d,f,g,j,l,n,m,p,r){var s;s=this;void 0===l&&(l=100);void 0===n&&(n=b.Texture.BILINEAR_SAMPLINGMODE);e.call(this,d,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],f.postProcessRatio||f,g,n,m,p,"#define NUM_SAMPLES "+l);this._screenCoordinates=b.Vector2.Zero();this.customMeshPosition=b.Vector3.Zero();this.useCustomMeshPosition=!1;this.invert=!0;this.excludedMeshes=[];this.exposure=0.3;y4tt.q9();this.decay=0.96815;this.weight=0.58767;this.density=0.926;r=null===g?r:g.getScene();m=r.getEngine();this._viewPort=new b.Viewport(0,0,1,1).toGlobal(m.getRenderWidth(),m.getRenderHeight());this.mesh=null!==j?j:c.CreateDefaultMesh("VolumetricLightScatteringMesh",r);this._createPass(r,f.passRatio||f);this.onActivate=function(b){s.isSupported||s.dispose(b);s.onActivate=null;};this.onApplyObservable.add(function(b){s._updateMeshScreenCoordinates(r);b.setTexture("lightScatteringSampler",s._volumetricLightScatteringRTT);b.setFloat("exposure",s.exposure);b.setFloat("decay",s.decay);b.setFloat("weight",s.weight);b.setFloat("density",s.density);b.setVector2("meshPositionOnScreen",s._screenCoordinates);});};g=(__extends(c,e),Object.defineProperty(c.prototype,"useDiffuseColor",{get:function(){return b.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1;},set:function(){y4tt.v9();b.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead");},enumerable:!0,configurable:!0}),c.prototype.isReady=function(c,f){var e,g,l,n;e=c.getMesh();if(e===this.mesh)return e.material.isReady(e);g=[],l=[b.VertexBuffer.PositionKind],n=c.getMaterial();n&&(n.needAlphaTesting()&&g.push("#define ALPHATEST"),e.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(l.push(b.VertexBuffer.UVKind),g.push("#define UV1")),e.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(l.push(b.VertexBuffer.UV2Kind),g.push("#define UV2")));e.useBones&&e.computeBonesUsingShaders?(l.push(b.VertexBuffer.MatricesIndicesKind),l.push(b.VertexBuffer.MatricesWeightsKind),g.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),g.push("#define BonesPerMesh "+(e.skeleton.bones.length+1))):g.push("#define NUM_BONE_INFLUENCERS 0");y4tt.v9();f&&(g.push("#define INSTANCES"),l.push("world0"),l.push("world1"),l.push("world2"),l.push("world3"));g=g.join("\n");return this._cachedDefines!==g&&(this._cachedDefines=g,this._volumetricLightScatteringPass=e.getScene().getEngine().createEffect({vertexElement:"depth",fragmentElement:"volumetricLightScatteringPass"},l,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],g)),this._volumetricLightScatteringPass.isReady();},c.prototype.setCustomMeshPosition=function(b){y4tt.v9();this.customMeshPosition=b;},c.prototype.getCustomMeshPosition=function(){return this.customMeshPosition;},c.prototype.dispose=function(b){var c;y4tt.q9();c=b.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==c&&b.getScene().customRenderTargets.splice(c,1);this._volumetricLightScatteringRTT.dispose();e.prototype.dispose.call(this,b);},c.prototype.getPass=function(){return this._volumetricLightScatteringRTT;},c.prototype._meshExcluded=function(b){return 0<this.excludedMeshes.length&&-1!==this.excludedMeshes.indexOf(b);},c.prototype._createPass=function(c,f){var e,g,l,n,m;e=this,g=c.getEngine();this._volumetricLightScatteringRTT=new b.RenderTargetTexture("volumetricLightScatteringMap",{width:g.getRenderWidth()*f,height:g.getRenderHeight()*f},c,!1,!0,b.Engine.TEXTURETYPE_UNSIGNED_INT);this._volumetricLightScatteringRTT.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._volumetricLightScatteringRTT.wrapV=b.Texture.CLAMP_ADDRESSMODE;this._volumetricLightScatteringRTT.renderList=null;this._volumetricLightScatteringRTT.renderParticles=!1;y4tt.q9();c.customRenderTargets.push(this._volumetricLightScatteringRTT);n=function(c){var d,f,g,l,j,m;d=c.getRenderingMesh();if(!e._meshExcluded(d)){f=d.getScene(),g=f.getEngine();g.setState(c.getMaterial().backFaceCulling);l=d._getInstancesRenderList(c._id);if(!l.mustReturn){j=null!==g.getCaps().instancedArrays&&null!==l.visibleInstances[c._id];if(e.isReady(c,j)){m=e._volumetricLightScatteringPass;if(d===e.mesh&&(m=c.getMaterial().getEffect()),g.enableEffect(m),d._bind(c,m,b.Material.TriangleFillMode),d===e.mesh)c.getMaterial().bind(d.getWorldMatrix(),d);else{g=c.getMaterial();if(e._volumetricLightScatteringPass.setMatrix("viewProjection",f.getTransformMatrix()),g&&g.needAlphaTesting())f=g.getAlphaTestTexture(),e._volumetricLightScatteringPass.setTexture("diffuseSampler",f),f&&e._volumetricLightScatteringPass.setMatrix("diffuseMatrix",f.getTextureMatrix());d.useBones&&d.computeBonesUsingShaders&&e._volumetricLightScatteringPass.setMatrices("mBones",d.skeleton.getTransformMatrices(d));}d._processRendering(c,e._volumetricLightScatteringPass,b.Material.TriangleFillMode,l,j,function(b,c){return m.setMatrix("world",c);});}}}},m=new b.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){l=c.clearColor;c.clearColor=m;});this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){y4tt.v9();c.clearColor=l;});this._volumetricLightScatteringRTT.customRenderFunction=function(f,e,g){var l,j;j=c.getEngine();for(l=0;l<f.length;l++)n(f.data[l]);j.setAlphaTesting(!0);for(l=0;l<e.length;l++)n(e.data[l]);y4tt.q9();if(j.setAlphaTesting(!1),g.length){for(l=0;l<g.length;l++)f=g.data[l],f._alphaIndex=f.getMesh().alphaIndex,f._distanceToCamera=f.getBoundingInfo().boundingSphere.centerWorld.subtract(c.activeCamera.position).length();g=g.data.slice(0,g.length);g.sort(function(b,c){y4tt.v9();return b._alphaIndex>c._alphaIndex?1:b._alphaIndex<c._alphaIndex?-1:b._distanceToCamera<c._distanceToCamera?1:b._distanceToCamera>c._distanceToCamera?-1:0;});j.setAlphaMode(b.Engine.ALPHA_COMBINE);for(l=0;l<g.length;l++)n(g[l]);j.setAlphaMode(b.Engine.ALPHA_DISABLE);}};},c.prototype._updateMeshScreenCoordinates=function(c){var f;f=c.getTransformMatrix();c=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;y4tt.q9();c=b.Vector3.Project(c,b.Matrix.Identity(),f,this._viewPort);this._screenCoordinates.x=c.x/this._viewPort.width;this._screenCoordinates.y=c.y/this._viewPort.height;this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y);},c.CreateDefaultMesh=function(c,f){var e,g;e=b.Mesh.CreatePlane(c,1,f);e.billboardMode=b.AbstractMesh.BILLBOARDMODE_ALL;g=new b.StandardMaterial(c+"Material",f);return g.emissiveColor=new b.Color3(1,1,1),e.material=g,e;},__decorate([b.serializeAsVector3()],c.prototype,"customMeshPosition",void 0),__decorate([b.serialize()],c.prototype,"useCustomMeshPosition",void 0),__decorate([b.serialize()],c.prototype,"invert",void 0),__decorate([b.serializeAsMeshReference()],c.prototype,"mesh",void 0),__decorate([b.serialize()],c.prototype,"excludedMeshes",void 0),__decorate([b.serialize()],c.prototype,"exposure",void 0),__decorate([b.serialize()],c.prototype,"decay",void 0),__decorate([b.serialize()],c.prototype,"weight",void 0),__decorate([b.serialize()],c.prototype,"density",void 0),c);b.VolumetricLightScatteringPostProcess=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.PostProcessRenderPipeline;g=function(c,d,f,g,j){var l;l=this;void 0===g&&(g=1);e.call(this,f.getEngine(),c);this.LensChromaticAberrationEffect="LensChromaticAberrationEffect";y4tt.v9();this.HighlightsEnhancingEffect="HighlightsEnhancingEffect";this.LensDepthOfFieldEffect="LensDepthOfFieldEffect";this._scene=f;this._depthTexture=f.enableDepthRenderer().getDepthMap();d.grain_texture?this._grainTexture=d.grain_texture:this._createGrainTexture();this._edgeBlur=d.edge_blur?d.edge_blur:0;this._grainAmount=d.grain_amount?d.grain_amount:0;this._chromaticAberration=d.chromatic_aberration?d.chromatic_aberration:0;this._distortion=d.distortion?d.distortion:0;this._highlightsGain=void 0!==d.dof_gain?d.dof_gain:-1;this._highlightsThreshold=d.dof_threshold?d.dof_threshold:1;this._dofDistance=void 0!==d.dof_focus_distance?d.dof_focus_distance:-1;this._dofAperture=d.dof_aperture?d.dof_aperture:1;this._dofDarken=d.dof_darken?d.dof_darken:0;this._dofPentagon=void 0!==d.dof_pentagon?d.dof_pentagon:!0;this._blurNoise=void 0!==d.blur_noise?d.blur_noise:!0;this._createChromaticAberrationPostProcess(g);this._createHighlightsPostProcess(g);this._createDepthOfFieldPostProcess(g/4);this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),this.LensChromaticAberrationEffect,function(){y4tt.v9();return l._chromaticAberrationPostProcess;},!0));this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),this.HighlightsEnhancingEffect,function(){return l._highlightsPostProcess;},!0));this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),this.LensDepthOfFieldEffect,function(){return l._depthOfFieldPostProcess;},!0));-1===this._highlightsGain&&this._disableEffect(this.HighlightsEnhancingEffect,null);f.postProcessRenderPipelineManager.addPipeline(this);j&&f.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(c,j);};g=(__extends(g,e),g.prototype.setEdgeBlur=function(b){y4tt.q9();this._edgeBlur=b;},g.prototype.disableEdgeBlur=function(){y4tt.v9();this._edgeBlur=0;},g.prototype.setGrainAmount=function(b){this._grainAmount=b;},g.prototype.disableGrain=function(){y4tt.v9();this._grainAmount=0;},g.prototype.setChromaticAberration=function(b){this._chromaticAberration=b;},g.prototype.disableChromaticAberration=function(){this._chromaticAberration=0;},g.prototype.setEdgeDistortion=function(b){this._distortion=b;},g.prototype.disableEdgeDistortion=function(){y4tt.q9();this._distortion=0;},g.prototype.setFocusDistance=function(b){this._dofDistance=b;},g.prototype.disableDepthOfField=function(){this._dofDistance=-1;},g.prototype.setAperture=function(b){this._dofAperture=b;},g.prototype.setDarkenOutOfFocus=function(b){y4tt.v9();this._dofDarken=b;},g.prototype.enablePentagonBokeh=function(){y4tt.v9();this._highlightsPostProcess.updateEffect("#define PENTAGON\n");},g.prototype.disablePentagonBokeh=function(){y4tt.q9();this._highlightsPostProcess.updateEffect();},g.prototype.enableNoiseBlur=function(){this._blurNoise=!0;},g.prototype.disableNoiseBlur=function(){y4tt.q9();this._blurNoise=!1;},g.prototype.setHighlightsGain=function(b){this._highlightsGain=b;},g.prototype.setHighlightsThreshold=function(b){-1===this._highlightsGain&&(this._highlightsGain=1);this._highlightsThreshold=b;},g.prototype.disableHighlights=function(){this._highlightsGain=-1;},g.prototype.dispose=function(b){void 0===b&&(b=!1);this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras);this._depthOfFieldPostProcess=this._highlightsPostProcess=this._chromaticAberrationPostProcess=void 0;this._grainTexture.dispose();b&&this._scene.disableDepthRenderer();},g.prototype._createChromaticAberrationPostProcess=function(c){var d;d=this;this._chromaticAberrationPostProcess=new b.PostProcess("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height"],[],c,null,b.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1);this._chromaticAberrationPostProcess.onApply=function(b){y4tt.v9();b.setFloat("chromatic_aberration",d._chromaticAberration);b.setFloat("screen_width",d._scene.getEngine().getRenderingCanvas().width);b.setFloat("screen_height",d._scene.getEngine().getRenderingCanvas().height);};},g.prototype._createHighlightsPostProcess=function(c){var d;d=this;y4tt.q9();this._highlightsPostProcess=new b.PostProcess("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],c,null,b.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?"#define PENTAGON\n":"");this._highlightsPostProcess.onApply=function(b){b.setFloat("gain",d._highlightsGain);b.setFloat("threshold",d._highlightsThreshold);b.setTextureFromPostProcess("textureSampler",d._chromaticAberrationPostProcess);y4tt.q9();b.setFloat("screen_width",d._scene.getEngine().getRenderingCanvas().width);b.setFloat("screen_height",d._scene.getEngine().getRenderingCanvas().height);};},g.prototype._createDepthOfFieldPostProcess=function(c){var d;d=this;this._depthOfFieldPostProcess=new b.PostProcess("LensDepthOfField","depthOfField","grain_amount blur_noise screen_width screen_height distortion dof_enabled screen_distance aperture darken edge_blur highlights near far".split(" "),["depthSampler","grainSampler","highlightsSampler"],c,null,b.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1);y4tt.v9();this._depthOfFieldPostProcess.onApply=function(b){b.setTexture("depthSampler",d._depthTexture);b.setTexture("grainSampler",d._grainTexture);b.setTextureFromPostProcess("textureSampler",d._highlightsPostProcess);b.setTextureFromPostProcess("highlightsSampler",d._depthOfFieldPostProcess);b.setFloat("grain_amount",d._grainAmount);b.setBool("blur_noise",d._blurNoise);b.setFloat("screen_width",d._scene.getEngine().getRenderingCanvas().width);b.setFloat("screen_height",d._scene.getEngine().getRenderingCanvas().height);b.setFloat("distortion",d._distortion);b.setBool("dof_enabled",-1!==d._dofDistance);b.setFloat("screen_distance",1/(0.1-1/d._dofDistance));b.setFloat("aperture",d._dofAperture);b.setFloat("darken",d._dofDarken);b.setFloat("edge_blur",d._edgeBlur);y4tt.q9();b.setBool("highlights",-1!==d._highlightsGain);b.setFloat("near",d._scene.activeCamera.minZ);b.setFloat("far",d._scene.activeCamera.maxZ);};},g.prototype._createGrainTexture=function(){y4tt.q9();this._grainTexture=new b.DynamicTexture("LensNoiseTexture",512,this._scene,!1,b.Texture.BILINEAR_SAMPLINGMODE);this._grainTexture.wrapU=b.Texture.WRAP_ADDRESSMODE;this._grainTexture.wrapV=b.Texture.WRAP_ADDRESSMODE;for(var c,d=this._grainTexture.getContext(),f=0;512>f;f++)for(var e=0;512>e;e++)c=Math.floor(255*(Math.random()*(0.58-0.42)+0.42)),d.fillStyle="rgb("+c+", "+c+", "+c+")",d.fillRect(f,e,1,1);this._grainTexture.update(!1);},g);y4tt.q9();b.LensRenderingPipeline=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=b.PostProcess;g=function(c,d,f,g,j,l,n){var m;m=this;e.call(this,c,"colorCorrection",null,["colorTable"],f,g,j,l,n);this._colorTableTexture=new b.Texture(d,g.getScene(),!0,!1,b.Texture.TRILINEAR_SAMPLINGMODE);this._colorTableTexture.anisotropicFilteringLevel=1;this._colorTableTexture.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._colorTableTexture.wrapV=b.Texture.CLAMP_ADDRESSMODE;this.onApply=function(b){y4tt.q9();b.setTexture("colorTable",m._colorTableTexture);};};y4tt.v9();g=(__extends(g,e),g);b.ColorCorrectionPostProcess=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f,q,j,l,n;e=b.FreeCamera;g=function(c,d,f,g){e.call(this,c,d,g);this.interaxialDistance=f;y4tt.q9();this.setCameraRigMode(b.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:f});};g=(__extends(g,e),g.prototype.getTypeName=function(){y4tt.q9();return"AnaglyphFreeCamera";},g);b.AnaglyphFreeCamera=g;c=b.ArcRotateCamera;g=function(d,f,e,g,l,j,n){c.call(this,d,f,e,g,l,n);this.interaxialDistance=j;this.setCameraRigMode(b.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:j});};g=(__extends(g,c),g.prototype.getTypeName=function(){return"AnaglyphArcRotateCamera";},g);b.AnaglyphArcRotateCamera=g;d=b.GamepadCamera;g=function(c,f,e,g){y4tt.q9();d.call(this,c,f,g);this.interaxialDistance=e;this.setCameraRigMode(b.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:e});};g=(__extends(g,d),g.prototype.getTypeName=function(){return"AnaglyphGamepadCamera";},g);b.AnaglyphGamepadCamera=g;f=b.UniversalCamera;g=function(c,d,e,g){f.call(this,c,d,g);this.interaxialDistance=e;this.setCameraRigMode(b.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:e});};g=(__extends(g,f),g.prototype.getTypeName=function(){y4tt.v9();return"AnaglyphUniversalCamera";},g);b.AnaglyphUniversalCamera=g;q=b.FreeCamera;g=function(c,d,f,e,g){q.call(this,c,d,g);this.interaxialDistance=f;y4tt.v9();this.isStereoscopicSideBySide=e;this.setCameraRigMode(e?b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:b.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:f});};g=(__extends(g,q),g.prototype.getTypeName=function(){y4tt.q9();return"StereoscopicFreeCamera";},g);b.StereoscopicFreeCamera=g;j=b.ArcRotateCamera;g=function(c,d,f,e,g,l,n,q){j.call(this,c,d,f,e,g,q);y4tt.q9();this.interaxialDistance=l;this.isStereoscopicSideBySide=n;this.setCameraRigMode(n?b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:b.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:l});};g=(__extends(g,j),g.prototype.getTypeName=function(){return"StereoscopicArcRotateCamera";},g);b.StereoscopicArcRotateCamera=g;l=b.GamepadCamera;g=function(c,d,f,e,g){l.call(this,c,d,g);this.interaxialDistance=f;this.isStereoscopicSideBySide=e;this.setCameraRigMode(e?b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:b.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:f});};g=(__extends(g,l),g.prototype.getTypeName=function(){y4tt.v9();return"StereoscopicGamepadCamera";},g);b.StereoscopicGamepadCamera=g;n=b.UniversalCamera;g=function(c,d,f,e,g){n.call(this,c,d,g);this.interaxialDistance=f;this.isStereoscopicSideBySide=e;this.setCameraRigMode(e?b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:b.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:f});};g=(__extends(g,n),g.prototype.getTypeName=function(){y4tt.v9();return"StereoscopicUniversalCamera";},g);b.StereoscopicUniversalCamera=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.PostProcessRenderPipeline,c=function(d,f,g,j,l){var n;y4tt.v9();n=this;void 0===j&&(j=null);e.call(this,f.getEngine(),d);this.gaussCoeff=0.3;this.gaussMean=1;this.gaussStandDev=0.8;this.gaussMultiplier=4;this.minimumLuminance=this.exposure=1;this.maximumLuminance=1E20;this.luminanceDecreaseRate=this.luminanceIncreaserate=0.5;this.brightThreshold=0.8;this._needUpdate=!0;this._scene=f;this._createBrightPassPostProcess(f,g);this._createDownSampleX4PostProcess(f,g);this._createGaussianBlurPostProcess(f,g);this._createTextureAdderPostProcess(f,g);this._createLuminanceGeneratorPostProcess(f);this._createHDRPostProcess(f,g);null===j?this._originalPostProcess=new b.PassPostProcess("hdr",g,null,b.Texture.BILINEAR_SAMPLINGMODE,f.getEngine(),!1):this._originalPostProcess=j;this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDRPassPostProcess",function(){y4tt.v9();return n._originalPostProcess;},!0));this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDRBrightPass",function(){y4tt.q9();return n._brightPassPostProcess;},!0));this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDRDownSampleX4",function(){return n._downSampleX4PostProcess;},!0));this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDRGaussianBlurH",function(){return n._guassianBlurHPostProcess;},!0));this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDRGaussianBlurV",function(){y4tt.v9();return n._guassianBlurVPostProcess;},!0));this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDRTextureAdder",function(){return n._textureAdderPostProcess;},!0));g=function(c){y4tt.q9();n.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDRDownSampler"+c,function(){y4tt.q9();return n._downSamplePostProcesses[c];},!0));};for(j=c.LUM_STEPS-1;0<=j;j--)g(j);this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDR",function(){y4tt.v9();return n._hdrPostProcess;},!0));f.postProcessRenderPipelineManager.addPipeline(this);null!==l&&f.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(d,l);this.update();};g=(__extends(c,e),c.prototype.update=function(){this._needUpdate=!0;},c.prototype.getCurrentLuminance=function(){return this._hdrCurrentLuminance;},c.prototype.getOutputLuminance=function(){y4tt.q9();return this._hdrOutputLuminance;},c.prototype.dispose=function(){this._textureAdderPostProcess=this._guassianBlurVPostProcess=this._guassianBlurHPostProcess=this._downSampleX4PostProcess=this._brightPassPostProcess=this._originalPostProcess=void 0;y4tt.q9();for(var b=c.LUM_STEPS-1;0<=b;b--)this._downSamplePostProcesses[b]=void 0;this._hdrPostProcess=void 0;this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras);},c.prototype._createHDRPostProcess=function(c,f){var e,g;e=this,g=0;this._hdrOutputLuminance=-1;this._hdrCurrentLuminance=1;this._hdrPostProcess=new b.PostProcess("hdr","hdr",["exposure","avgLuminance"],["otherSampler"],f,null,b.Texture.BILINEAR_SAMPLINGMODE,c.getEngine(),!1,"#define HDR");this._hdrPostProcess.onApply=function(f){var n;if(0>e._hdrOutputLuminance)e._hdrOutputLuminance=e._hdrCurrentLuminance;else{n=(g-(g+c.getEngine().getDeltaTime()))/1E3;e._hdrCurrentLuminance<e._hdrOutputLuminance+e.luminanceDecreaseRate*n?e._hdrOutputLuminance+=e.luminanceDecreaseRate*n:e._hdrCurrentLuminance>e._hdrOutputLuminance-e.luminanceIncreaserate*n?e._hdrOutputLuminance-=e.luminanceIncreaserate*n:e._hdrOutputLuminance=e._hdrCurrentLuminance;}e._hdrOutputLuminance=b.MathTools.Clamp(e._hdrOutputLuminance,e.minimumLuminance,e.maximumLuminance);g+=c.getEngine().getDeltaTime();f.setTextureFromPostProcess("textureSampler",e._textureAdderPostProcess);f.setTextureFromPostProcess("otherSampler",e._originalPostProcess);f.setFloat("exposure",e.exposure);f.setFloat("avgLuminance",e._hdrOutputLuminance);e._needUpdate=!1;};},c.prototype._createTextureAdderPostProcess=function(c,f){var e;e=this;this._textureAdderPostProcess=new b.PostProcess("hdr","hdr",[],["otherSampler"],f,null,b.Texture.BILINEAR_SAMPLINGMODE,c.getEngine(),!1,"#define TEXTURE_ADDER");y4tt.v9();this._textureAdderPostProcess.onApply=function(b){b.setTextureFromPostProcess("otherSampler",e._originalPostProcess);};},c.prototype._createDownSampleX4PostProcess=function(c,f){var e,g;e=this,g=Array(32);this._downSampleX4PostProcess=new b.PostProcess("hdr","hdr",["dsOffsets"],[],f/4,null,b.Texture.BILINEAR_SAMPLINGMODE,c.getEngine(),!1,"#define DOWN_SAMPLE_X4");this._downSampleX4PostProcess.onApply=function(b){y4tt.q9();if(e._needUpdate)for(var c=0,d=-2;2>d;d++)for(var f=-2;2>f;f++)g[c]=(d+0.5)*(1/e._downSampleX4PostProcess.width),g[c+1]=(f+0.5)*(1/e._downSampleX4PostProcess.height),c+=2;b.setArray2("dsOffsets",g);};},c.prototype._createBrightPassPostProcess=function(c,f){var e,g;e=this,g=Array(8);this._brightPassPostProcess=new b.PostProcess("hdr","hdr",["dsOffsets","brightThreshold"],[],f,null,b.Texture.BILINEAR_SAMPLINGMODE,c.getEngine(),!1,"#define BRIGHT_PASS");y4tt.q9();this._brightPassPostProcess.onApply=function(b){var c,d;if(e._needUpdate){c=1/e._brightPassPostProcess.width,d=1/e._brightPassPostProcess.height;g[0]=-0.5*c;g[1]=0.5*d;g[2]=0.5*c;g[3]=0.5*d;g[4]=-0.5*c;g[5]=-0.5*d;g[6]=0.5*c;g[7]=-0.5*d;}b.setArray2("dsOffsets",g);b.setFloat("brightThreshold",e.brightThreshold);};},c.prototype._createLuminanceGeneratorPostProcess=function(d){var f,e,g,l,n,m,p,r,s,t;e=this,g=c.LUM_STEPS,l=Array(8),n=Array(18);this._downSamplePostProcesses=Array(g);m=function(b,c){var d,f;d=1/b,f=1/c;l[0]=-0.5*d;l[1]=0.5*f;l[2]=0.5*d;l[3]=0.5*f;l[4]=-0.5*d;l[5]=-0.5*f;y4tt.q9();l[6]=0.5*d;l[7]=-0.5*f;},p=function(b){y4tt.q9();return function(c){m(e._downSamplePostProcesses[b].width,e._downSamplePostProcesses[b].height);y4tt.v9();for(var d=e._downSamplePostProcesses[b].width,g=e._downSamplePostProcesses[b].height,l=0,j=-1;2>j;j++)for(var p=-1;2>p;p++)n[l]=j/d,n[l+1]=p/g,l+=2;f=0.5/e._downSamplePostProcesses[b].width;c.setTextureFromPostProcess("textureSampler",e._downSamplePostProcesses[b+1]);c.setFloat("halfDestPixelSize",f);c.setArray2("dsOffsets",n);};},r=function(){var c,f;c=d.getEngine().readPixels(0,0,1,1),f=new b.Vector4(1/16581375,1/65025,1/255,1);e._hdrCurrentLuminance=(c[0]*f.x+c[1]*f.y+c[2]*f.z+c[3]*f.w)/100;},s={width:Math.pow(3,g-1),height:Math.pow(3,g-1)};this._downSamplePostProcesses[g-1]=new b.PostProcess("hdr","hdr",["lumOffsets"],[],s,null,b.Texture.NEAREST_SAMPLINGMODE,d.getEngine(),!1,"#define LUMINANCE_GENERATOR",b.Engine.TEXTURETYPE_FLOAT);this._downSamplePostProcesses[g-1].onApply=function(b){e._needUpdate&&m(e._textureAdderPostProcess.width,e._textureAdderPostProcess.height);b.setTextureFromPostProcess("textureSampler",e._textureAdderPostProcess);b.setArray2("lumOffsets",l);};for(g-=2;0<=g;g--){s=Math.pow(3,g),s={width:s,height:s},t="#define DOWN_SAMPLE\n";0===g&&(t+="#define FINAL_DOWN_SAMPLE\n");this._downSamplePostProcesses[g]=new b.PostProcess("hdr","hdr",["dsOffsets","halfDestPixelSize"],[],s,null,b.Texture.NEAREST_SAMPLINGMODE,d.getEngine(),!1,t,b.Engine.TEXTURETYPE_FLOAT);this._downSamplePostProcesses[g].onApply=p(g);0===g&&(this._downSamplePostProcesses[g].onAfterRender=r);}},c.prototype._createGaussianBlurPostProcess=function(c,f){var e,g,l,n,m,p;e=this,g=Array(9),l=Array(9),n=Array(9),m=["blurOffsets","blurWeights","multiplier"],p=function(b){return function(f){var x;if(e._needUpdate){for(var m=0,p=0;9>p;p++)m=(p-4)/4,n[p]=e.gaussCoeff*(1/Math.sqrt(2*Math.PI*e.gaussStandDev))*Math.exp(-((m-e.gaussMean)*(m-e.gaussMean))/(2*e.gaussStandDev*e.gaussStandDev));for(var m=c.getEngine().getRenderWidth(),p=c.getEngine().getRenderHeight(),y=0;9>y;y++){x=(y-4)*(1/(!0===b?p:m));b?l[y]=x:g[y]=x;}}f.setArray("blurOffsets",b?l:g);f.setArray("blurWeights",n);f.setFloat("multiplier",e.gaussMultiplier);};};this._guassianBlurHPostProcess=new b.PostProcess("hdr","hdr",m,[],f/4,null,b.Texture.BILINEAR_SAMPLINGMODE,c.getEngine(),!1,"#define GAUSSIAN_BLUR_H");this._guassianBlurHPostProcess.onApply=p(!1);this._guassianBlurVPostProcess=new b.PostProcess("hdr","hdr",m,[],f/4,null,b.Texture.BILINEAR_SAMPLINGMODE,c.getEngine(),!1,"#define GAUSSIAN_BLUR_V");y4tt.v9();this._guassianBlurVPostProcess.onApply=p(!0);},c.LUM_STEPS=6,c);b.HDRRenderingPipeline=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;y4tt.q9();g=function(){this.edges=[];this.edgesConnectedCount=0;};e=function(b,d,f){void 0===d&&(d=0.95);void 0===f&&(f=!1);this.edgesWidthScalerForOrthographic=1E3;this.edgesWidthScalerForPerspective=50;this._linesPositions=[];this._linesNormals=[];this._linesIndices=[];this._buffers={};this._checkVerticesInsteadOfIndices=!1;this._source=b;this._checkVerticesInsteadOfIndices=f;this._epsilon=d;this._prepareRessources();y4tt.q9();this._generateEdgesLines();};e=(e.prototype._prepareRessources=function(){y4tt.q9();this._lineShader||(this._lineShader=new b.ShaderMaterial("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1);},e.prototype.dispose=function(){var c;y4tt.v9();c=this._buffers[b.VertexBuffer.PositionKind];c&&(c.dispose(),this._buffers[b.VertexBuffer.PositionKind]=null);(c=this._buffers[b.VertexBuffer.NormalKind])&&(c.dispose(),this._buffers[b.VertexBuffer.NormalKind]=null);this._source.getScene().getEngine()._releaseBuffer(this._ib);this._lineShader.dispose();},e.prototype._processEdgeForAdjacencies=function(b,d,f,e,g){y4tt.q9();return b===f&&d===e||b===e&&d===f?0:b===e&&d===g||b===g&&d===e?1:b===g&&d===f||b===f&&d===g?2:-1;},e.prototype._processEdgeForAdjacenciesWithVertices=function(b,d,f,e,g){return b.equalsWithEpsilon(f)&&d.equalsWithEpsilon(e)||b.equalsWithEpsilon(e)&&d.equalsWithEpsilon(f)?0:b.equalsWithEpsilon(e)&&d.equalsWithEpsilon(g)||b.equalsWithEpsilon(g)&&d.equalsWithEpsilon(e)?1:b.equalsWithEpsilon(g)&&d.equalsWithEpsilon(f)||b.equalsWithEpsilon(f)&&d.equalsWithEpsilon(g)?2:-1;},e.prototype._checkEdge=function(c,d,f,e,g){if(void 0===d||b.Vector3.Dot(f[c],f[d])<this._epsilon)c=this._linesPositions.length/3,e.subtract(g).normalize(),this._linesPositions.push(e.x),this._linesPositions.push(e.y),this._linesPositions.push(e.z),this._linesPositions.push(e.x),this._linesPositions.push(e.y),this._linesPositions.push(e.z),this._linesPositions.push(g.x),this._linesPositions.push(g.y),this._linesPositions.push(g.z),this._linesPositions.push(g.x),this._linesPositions.push(g.y),this._linesPositions.push(g.z),this._linesNormals.push(g.x),this._linesNormals.push(g.y),this._linesNormals.push(g.z),this._linesNormals.push(-1),this._linesNormals.push(g.x),this._linesNormals.push(g.y),this._linesNormals.push(g.z),this._linesNormals.push(1),this._linesNormals.push(e.x),this._linesNormals.push(e.y),this._linesNormals.push(e.z),this._linesNormals.push(-1),this._linesNormals.push(e.x),this._linesNormals.push(e.y),this._linesNormals.push(e.z),this._linesNormals.push(1),this._linesIndices.push(c),this._linesIndices.push(c+1),this._linesIndices.push(c+2),this._linesIndices.push(c),this._linesIndices.push(c+2),this._linesIndices.push(c+3);},e.prototype._generateEdgesLines=function(){var c,d,f,e,j,l,n,m,p,t;f=this._source.getVerticesData(b.VertexBuffer.PositionKind),e=this._source.getIndices(),j=[],l=[];y4tt.v9();for(c=0;c<e.length;c+=3){d=new g();n=e[c],m=e[c+1],p=e[c+2];d.p0=new b.Vector3(f[3*n],f[3*n+1],f[3*n+2]);d.p1=new b.Vector3(f[3*m],f[3*m+1],f[3*m+2]);d.p2=new b.Vector3(f[3*p],f[3*p+1],f[3*p+2]);n=b.Vector3.Cross(d.p1.subtract(d.p0),d.p2.subtract(d.p1));n.normalize();l.push(n);j.push(d);}for(c=0;c<j.length;c++){d=j[c];for(f=c+1;f<j.length;f++){n=j[f];if(3===d.edgesConnectedCount)break;if(3!==n.edgesConnectedCount)for(var m=e[3*f],p=e[3*f+1],r=e[3*f+2],s=0;3>s;s++){if(void 0===d.edges[s]){switch(s){case 0:t=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p0,d.p1,n.p0,n.p1,n.p2):this._processEdgeForAdjacencies(e[3*c],e[3*c+1],m,p,r);break;case 1:t=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p1,d.p2,n.p0,n.p1,n.p2):this._processEdgeForAdjacencies(e[3*c+1],e[3*c+2],m,p,r);break;case 2:t=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p2,d.p0,n.p0,n.p1,n.p2):this._processEdgeForAdjacencies(e[3*c+2],e[3*c],m,p,r);}if(-1!==t&&(d.edges[s]=f,n.edges[t]=c,d.edgesConnectedCount++,n.edgesConnectedCount++,3===d.edgesConnectedCount))break;}}}}for(c=0;c<j.length;c++)d=j[c],this._checkEdge(c,d.edges[0],l,d.p0,d.p1),this._checkEdge(c,d.edges[1],l,d.p1,d.p2),this._checkEdge(c,d.edges[2],l,d.p2,d.p0);c=this._source.getScene().getEngine();this._buffers[b.VertexBuffer.PositionKind]=new b.VertexBuffer(c,this._linesPositions,b.VertexBuffer.PositionKind,!1);this._buffers[b.VertexBuffer.NormalKind]=new b.VertexBuffer(c,this._linesNormals,b.VertexBuffer.NormalKind,!1,!1,4);this._ib=c.createIndexBuffer(this._linesIndices);this._indicesCount=this._linesIndices.length;},e.prototype.render=function(){var c,d;y4tt.v9();if(this._lineShader.isReady()){c=this._source.getScene(),d=c.getEngine();this._lineShader._preBind();d.bindBuffers(this._buffers,this._ib,this._lineShader.getEffect());c.resetCachedMaterial();this._lineShader.setColor4("color",this._source.edgesColor);c.activeCamera.mode===b.Camera.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective);this._lineShader.setFloat("aspectRatio",d.getAspectRatio(c.activeCamera));this._lineShader.bind(this._source.getWorldMatrix());d.draw(!0,0,this._indicesCount);this._lineShader.unbind();d.setDepthWrite(!0);}},e);b.EdgesRenderer=e;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;g=b.TonemappingOperator||(b.TonemappingOperator={});g[g.Hable=0]="Hable";y4tt.q9();g[g.Reinhard=1]="Reinhard";g[g.HejiDawson=2]="HejiDawson";g[g.Photographic=3]="Photographic";!0;e=b.TonemappingOperator,c=b.PostProcess,g=function(d,f,g,j,l,n,m){var p,r;p=this;void 0===l&&(l=b.Texture.BILINEAR_SAMPLINGMODE);void 0===m&&(m=b.Engine.TEXTURETYPE_UNSIGNED_INT);c.call(this,d,"tonemap",["_ExposureAdjustment"],null,1,j,l,n,!0,r,m);this._operator=f;this.exposureAdjustment=g;r="#define ";this._operator===e.Hable?r+="HABLE_TONEMAPPING":this._operator===e.Reinhard?r+="REINHARD_TONEMAPPING":this._operator===e.HejiDawson?r+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":this._operator===e.Photographic&&(r+="PHOTOGRAPHIC_TONEMAPPING");this.updateEffect(r);this.onApply=function(b){y4tt.v9();b.setFloat("_ExposureAdjustment",p.exposureAdjustment);};},g=(__extends(g,c),g);b.TonemapPostProcess=g;}(BABYLON||(BABYLON={}));!function(b){var g;y4tt.q9();g=function(e,c,d,f){var g;g=this;void 0===f&&(f=!0);this.name=e;this._viewMatrix=b.Matrix.Identity();this._target=b.Vector3.Zero();this._add=b.Vector3.Zero();this.invertYAxis=!1;this.position=b.Vector3.Zero();this._scene=d;this._scene.reflectionProbes.push(this);this._renderTargetTexture=new b.RenderTargetTexture(e,c,d,f,!0,b.Engine.TEXTURETYPE_UNSIGNED_INT,!0);this._renderTargetTexture.onBeforeRenderObservable.add(function(c){switch(c){case 0:g._add.copyFromFloats(1,0,0);break;case 1:g._add.copyFromFloats(-1,0,0);break;case 2:g._add.copyFromFloats(0,g.invertYAxis?1:-1,0);break;case 3:g._add.copyFromFloats(0,g.invertYAxis?-1:1,0);break;case 4:g._add.copyFromFloats(0,0,1);break;case 5:g._add.copyFromFloats(0,0,-1);}g._attachedMesh&&g.position.copyFrom(g._attachedMesh.getAbsolutePosition());g.position.addToRef(g._add,g._target);b.Matrix.LookAtLHToRef(g.position,g._target,b.Vector3.Up(),g._viewMatrix);d.setTransformMatrix(g._viewMatrix,g._projectionMatrix);});this._renderTargetTexture.onAfterUnbindObservable.add(function(){d.updateTransformMatrix(!0);});this._projectionMatrix=b.Matrix.PerspectiveFovLH(Math.PI/2,1,d.activeCamera.minZ,d.activeCamera.maxZ);};g=(Object.defineProperty(g.prototype,"refreshRate",{get:function(){y4tt.v9();return this._renderTargetTexture.refreshRate;},set:function(b){this._renderTargetTexture.refreshRate=b;},enumerable:!0,configurable:!0}),g.prototype.getScene=function(){y4tt.q9();return this._scene;},Object.defineProperty(g.prototype,"cubeTexture",{get:function(){y4tt.q9();return this._renderTargetTexture;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"renderList",{get:function(){y4tt.v9();return this._renderTargetTexture.renderList;},enumerable:!0,configurable:!0}),g.prototype.attachToMesh=function(b){y4tt.v9();this._attachedMesh=b;},g.prototype.dispose=function(){var b;b=this._scene.reflectionProbes.indexOf(this);y4tt.v9();-1!==b&&this._scene.reflectionProbes.splice(b,1);this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null);},g);b.ReflectionProbe=g;}(BABYLON||(BABYLON={}));!function(b){var g;y4tt.q9();g=function(e,c,d,f,g){this.color=new b.Color4(1,1,1,1);this.position=b.Vector3.Zero();this.rotation=b.Vector3.Zero();this.scaling=new b.Vector3(1,1,1);this.uvs=new b.Vector4(0,0,1,1);this.velocity=b.Vector3.Zero();this.isVisible=this.alive=!0;this.idx=e;this._pos=c;this._model=d;y4tt.v9();this.shapeId=f;this.idxInShape=g;};g=(Object.defineProperty(g.prototype,"scale",{get:function(){y4tt.v9();return this.scaling;},set:function(b){this.scaling=b;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"quaternion",{get:function(){y4tt.q9();return this.rotationQuaternion;},set:function(b){y4tt.q9();this.rotationQuaternion=b;},enumerable:!0,configurable:!0}),g);b.SolidParticle=g;b.ModelShape=function(b,c,d,f,g){this.shapeID=b;this._shape=c;this._shapeUV=d;this._positionFunction=f;y4tt.q9();this._vertexFunction=g;};}(BABYLON||(BABYLON={}));!function(b){var g;g=function(e,c,d){this.particles=[];this.nbParticles=0;this.billboard=!1;this.counter=0;this.vars={};this._positions=[];this._indices=[];this._normals=[];this._colors=[];this._uvs=[];this._index=0;this._updatable=!0;this._alwaysVisible=this._isVisibilityBoxLocked=this._pickable=!1;this._shapeCounter=0;this._copy=new b.SolidParticle(null,null,null,null,null);this._color=new b.Color4(0,0,0,0);this._computeParticleRotation=this._computeParticleTexture=this._computeParticleColor=!0;this._computeBoundingBox=this._computeParticleVertex=!1;y4tt.q9();this._cam_axisZ=b.Vector3.Zero();this._cam_axisY=b.Vector3.Zero();this._cam_axisX=b.Vector3.Zero();this._axisX=b.Axis.X;this._axisY=b.Axis.Y;this._axisZ=b.Axis.Z;this._fakeCamPos=b.Vector3.Zero();this._rotMatrix=new b.Matrix();this._invertMatrix=new b.Matrix();this._rotated=b.Vector3.Zero();this._quaternion=new b.Quaternion();this._vertex=b.Vector3.Zero();this._normal=b.Vector3.Zero();this._w=this._cosYaw=this._sinYaw=this._cosPitch=this._sinPitch=this._cosRoll=this._sinRoll=this._halfyaw=this._halfpitch=this._halfroll=this._roll=this._pitch=this._yaw=0;this._minimum=b.Tmp.Vector3[0];this._maximum=b.Tmp.Vector3[1];this.name=e;this._scene=c;this._camera=c.activeCamera;this._pickable=d?d.isPickable:!1;d&&d.updatable?this._updatable=d.updatable:this._updatable=!0;this._pickable&&(this.pickedParticles=[]);};g=(g.prototype.buildMesh=function(){var e,c;if(0===this.nbParticles){e=b.MeshBuilder.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(e,1);e.dispose();}this._positions32=new Float32Array(this._positions);this._uvs32=new Float32Array(this._uvs);this._colors32=new Float32Array(this._colors);b.VertexData.ComputeNormals(this._positions32,this._indices,this._normals);this._normals32=new Float32Array(this._normals);this._fixedNormal32=new Float32Array(this._normals);e=new b.VertexData();e.set(this._positions32,b.VertexBuffer.PositionKind);e.indices=this._indices;e.set(this._normals32,b.VertexBuffer.NormalKind);this._uvs32&&e.set(this._uvs32,b.VertexBuffer.UVKind);y4tt.q9();this._colors32&&e.set(this._colors32,b.VertexBuffer.ColorKind);c=new b.Mesh(this.name,this._scene);return e.applyToMesh(c,this._updatable),this.mesh=c,this.mesh.isPickable=this._pickable,this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0),c;},g.prototype.digest=function(e,c){var d,f,g,j,l,n,m,p,r,A;y4tt.q9();d=c&&c.facetNb||1,f=c&&c.number,g=c&&c.delta||0,j=e.getVerticesData(b.VertexBuffer.PositionKind),l=e.getIndices(),n=e.getVerticesData(b.VertexBuffer.UVKind),m=e.getVerticesData(b.VertexBuffer.ColorKind),p=0,r=l.length/3;f?(f=f>r?r:f,d=Math.round(r/f),g=0):d=d>r?r:d;for(var f=[],s=[],t=[],v=[],y=b.Tmp.Vector3[0],x=d;r>p;){d=x+Math.floor((1+g)*Math.random());p>r-d&&(d=r-p);f.length=0;s.length=0;t.length=0;for(var z=v.length=0,B=3*p;3*(p+d)>B;B++){s.push(z);A=l[B];f.push(j[3*A],j[3*A+1],j[3*A+2]);n&&t.push(n[2*A],n[2*A+1]);m&&v.push(m[4*A],m[4*A+1],m[4*A+2],m[4*A+3]);z++;}for(var z=this.nbParticles,B=this._posToShape(f),C=this._uvsToShapeUV(t),A=0;A<B.length;A++)y.addInPlace(B[A]);y.scaleInPlace(1/B.length);for(A=0;A<B.length;A++)B[A].subtractInPlace(y);A=new b.ModelShape(this._shapeCounter,B,C,null,null);this._meshBuilder(this._index,B,this._positions,s,this._indices,t,this._uvs,v,this._colors,z,0,null);this._addParticle(z,this._positions.length,A,this._shapeCounter,0);this.particles[this.nbParticles].position.addInPlace(y);this._index+=B.length;this.nbParticles++;this._shapeCounter++;p+=d;}return this;},g.prototype._resetCopy=function(){this._copy.position.x=0;this._copy.position.y=0;this._copy.position.z=0;this._copy.rotation.x=0;this._copy.rotation.y=0;this._copy.rotation.z=0;this._copy.rotationQuaternion=null;this._copy.scaling.x=1;this._copy.scaling.y=1;this._copy.scaling.z=1;this._copy.uvs.x=0;this._copy.uvs.y=0;this._copy.uvs.z=1;this._copy.uvs.w=1;this._copy.color=null;},g.prototype._meshBuilder=function(e,c,d,f,g,j,l,n,m,p,r,s){var t,v;t=0,v=0;this._resetCopy();s&&s.positionFunction&&s.positionFunction(this._copy,p,r);this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR());this._quaternionToRotationMatrix();for(r=0;r<c.length;r++)this._vertex.x=c[r].x,this._vertex.y=c[r].y,this._vertex.z=c[r].z,s&&s.vertexFunction&&s.vertexFunction(this._copy,this._vertex,r),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,b.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),d.push(this._copy.position.x+this._rotated.x,this._copy.position.y+this._rotated.y,this._copy.position.z+this._rotated.z),j&&(l.push((this._copy.uvs.z-this._copy.uvs.x)*j[t]+this._copy.uvs.x,(this._copy.uvs.w-this._copy.uvs.y)*j[t+1]+this._copy.uvs.y),t+=2),this._copy.color?this._color=this._copy.color:n&&n[v]?(this._color.r=n[v],this._color.g=n[v+1],this._color.b=n[v+2],this._color.a=n[v+3]):(this._color.r=1,this._color.g=1,this._color.b=1,this._color.a=1),m.push(this._color.r,this._color.g,this._color.b,this._color.a),v+=4;for(r=0;r<f.length;r++)g.push(e+f[r]);if(this._pickable){e=f.length/3;for(r=0;e>r;r++)this.pickedParticles.push({idx:p,faceId:r});}},g.prototype._posToShape=function(e){y4tt.v9();for(var c=[],d=0;d<e.length;d+=3)c.push(new b.Vector3(e[d],e[d+1],e[d+2]));return c;},g.prototype._uvsToShapeUV=function(b){var c;c=[];if(b)for(var d=0;d<b.length;d++)c.push(b[d]);return c;},g.prototype._addParticle=function(e,c,d,f,g){y4tt.q9();this.particles.push(new b.SolidParticle(e,c,d,f,g));},g.prototype.addShape=function(e,c,d){var f,g,j;y4tt.v9();f=e.getVerticesData(b.VertexBuffer.PositionKind),g=e.getIndices(),j=e.getVerticesData(b.VertexBuffer.UVKind);e=e.getVerticesData(b.VertexBuffer.ColorKind);for(var f=this._posToShape(f),l=this._uvsToShapeUV(j),l=new b.ModelShape(this._shapeCounter,f,l,d?d.positionFunction:null,d?d.vertexFunction:null),n=this.nbParticles,m=0;c>m;m++)this._meshBuilder(this._index,f,this._positions,g,this._indices,j,this._uvs,e,this._colors,n,m,d),this._updatable&&this._addParticle(n,this._positions.length,l,this._shapeCounter,m),this._index+=f.length,n++;return this.nbParticles+=c,this._shapeCounter++,this._shapeCounter-1;},g.prototype._rebuildParticle=function(e){this._resetCopy();e._model._positionFunction&&e._model._positionFunction(this._copy,e.idx,e.idxInShape);this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR());this._quaternionToRotationMatrix();this._shape=e._model._shape;for(var c=0;c<this._shape.length;c++)this._vertex.x=this._shape[c].x,this._vertex.y=this._shape[c].y,this._vertex.z=this._shape[c].z,e._model._vertexFunction&&e._model._vertexFunction(this._copy,this._vertex,c),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,b.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),this._positions32[e._pos+3*c]=this._copy.position.x+this._rotated.x,this._positions32[e._pos+3*c+1]=this._copy.position.y+this._rotated.y,this._positions32[e._pos+3*c+2]=this._copy.position.z+this._rotated.z;e.position.x=0;e.position.y=0;e.position.z=0;e.rotation.x=0;e.rotation.y=0;e.rotation.z=0;e.rotationQuaternion=null;e.scaling.x=1;e.scaling.y=1;e.scaling.z=1;},g.prototype.rebuildMesh=function(){for(var e=0;e<this.particles.length;e++)this._rebuildParticle(this.particles[e]);this.mesh.updateVerticesData(b.VertexBuffer.PositionKind,this._positions32,!1,!1);},g.prototype.setParticles=function(e,c,d){var f,g,j,l,n,m,p;if(void 0===e&&(e=0),void 0===c&&(c=this.nbParticles-1),void 0===d&&(d=!0),this._updatable){this.beforeUpdateParticles(e,c,d);this._cam_axisX.x=1;this._cam_axisX.y=0;this._cam_axisX.z=0;this._cam_axisY.x=0;this._cam_axisY.y=1;this._cam_axisY.z=0;this._cam_axisZ.x=0;this._cam_axisZ.y=0;this._cam_axisZ.z=1;this.billboard&&(this._yaw=this.mesh.rotation.y,this._pitch=this.mesh.rotation.x,this._roll=this.mesh.rotation.z,this._quaternionRotationYPR(),this._quaternionToRotationMatrix(),this._rotMatrix.invertToRef(this._invertMatrix),b.Vector3.TransformCoordinatesToRef(this._camera.globalPosition,this._invertMatrix,this._fakeCamPos),this._fakeCamPos.subtractToRef(this.mesh.position,this._cam_axisZ),b.Vector3.CrossToRef(this._cam_axisZ,this._axisX,this._cam_axisY),b.Vector3.CrossToRef(this._cam_axisZ,this._cam_axisY,this._cam_axisX),this._cam_axisY.normalize(),this._cam_axisX.normalize(),this._cam_axisZ.normalize());b.Matrix.IdentityToRef(this._rotMatrix);f=0,g=0,j=0,l=0,n=0,m=0,p=0;this._computeBoundingBox&&(b.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this._minimum),b.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this._maximum));c=c>this.nbParticles-1?this.nbParticles-1:c;for(var r=e;c>=r;r++){if(this._particle=this.particles[r],this._shape=this._particle._model._shape,this._shapeUV=this._particle._model._shapeUV,this.updateParticle(this._particle),this._particle.isVisible){this.billboard&&(this._particle.rotation.x=0,this._particle.rotation.y=0);this._computeParticleRotation&&(this._particle.rotationQuaternion?this._quaternion.copyFrom(this._particle.rotationQuaternion):(this._yaw=this._particle.rotation.y,this._pitch=this._particle.rotation.x,this._roll=this._particle.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix());for(p=0;p<this._shape.length;p++)f=g+3*p,j=l+4*p,n=m+2*p,this._vertex.x=this._shape[p].x,this._vertex.y=this._shape[p].y,this._vertex.z=this._shape[p].z,this._computeParticleVertex&&this.updateParticleVertex(this._particle,this._vertex,p),this._vertex.x*=this._particle.scaling.x,this._vertex.y*=this._particle.scaling.y,this._vertex.z*=this._particle.scaling.z,this._w=this._vertex.x*this._rotMatrix.m[3]+this._vertex.y*this._rotMatrix.m[7]+this._vertex.z*this._rotMatrix.m[11]+this._rotMatrix.m[15],this._rotated.x=(this._vertex.x*this._rotMatrix.m[0]+this._vertex.y*this._rotMatrix.m[4]+this._vertex.z*this._rotMatrix.m[8]+this._rotMatrix.m[12])/this._w,this._rotated.y=(this._vertex.x*this._rotMatrix.m[1]+this._vertex.y*this._rotMatrix.m[5]+this._vertex.z*this._rotMatrix.m[9]+this._rotMatrix.m[13])/this._w,this._rotated.z=(this._vertex.x*this._rotMatrix.m[2]+this._vertex.y*this._rotMatrix.m[6]+this._vertex.z*this._rotMatrix.m[10]+this._rotMatrix.m[14])/this._w,this._positions32[f]=this._particle.position.x+this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._positions32[f+1]=this._particle.position.y+this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._positions32[f+2]=this._particle.position.z+this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z,this._computeBoundingBox&&(this._positions32[f]<this._minimum.x&&(this._minimum.x=this._positions32[f]),this._positions32[f]>this._maximum.x&&(this._maximum.x=this._positions32[f]),this._positions32[f+1]<this._minimum.y&&(this._minimum.y=this._positions32[f+1]),this._positions32[f+1]>this._maximum.y&&(this._maximum.y=this._positions32[f+1]),this._positions32[f+2]<this._minimum.z&&(this._minimum.z=this._positions32[f+2]),this._positions32[f+2]>this._maximum.z&&(this._maximum.z=this._positions32[f+2])),this._computeParticleVertex||this.billboard||(this._normal.x=this._fixedNormal32[f],this._normal.y=this._fixedNormal32[f+1],this._normal.z=this._fixedNormal32[f+2],this._w=this._normal.x*this._rotMatrix.m[3]+this._normal.y*this._rotMatrix.m[7]+this._normal.z*this._rotMatrix.m[11]+this._rotMatrix.m[15],this._rotated.x=(this._normal.x*this._rotMatrix.m[0]+this._normal.y*this._rotMatrix.m[4]+this._normal.z*this._rotMatrix.m[8]+this._rotMatrix.m[12])/this._w,this._rotated.y=(this._normal.x*this._rotMatrix.m[1]+this._normal.y*this._rotMatrix.m[5]+this._normal.z*this._rotMatrix.m[9]+this._rotMatrix.m[13])/this._w,this._rotated.z=(this._normal.x*this._rotMatrix.m[2]+this._normal.y*this._rotMatrix.m[6]+this._normal.z*this._rotMatrix.m[10]+this._rotMatrix.m[14])/this._w,this._normals32[f]=this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._normals32[f+1]=this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._normals32[f+2]=this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z),this._computeParticleColor&&(this._colors32[j]=this._particle.color.r,this._colors32[j+1]=this._particle.color.g,this._colors32[j+2]=this._particle.color.b,this._colors32[j+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[n]=this._shapeUV[2*p]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[n+1]=this._shapeUV[2*p+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);}else for(p=0;p<this._shape.length;p++)f=g+3*p,j=l+4*p,n=m+2*p,this._positions32[f]=this._camera.position.x,this._positions32[f+1]=this._camera.position.y,this._positions32[f+2]=this._camera.position.z,this._normals32[f]=0,this._normals32[f+1]=0,this._normals32[f+2]=0,this._computeParticleColor&&(this._colors32[j]=this._particle.color.r,this._colors32[j+1]=this._particle.color.g,this._colors32[j+2]=this._particle.color.b,this._colors32[j+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[n]=this._shapeUV[2*p]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[n+1]=this._shapeUV[2*p+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);g=f+3;l=j+4;m=n+2;}if(d&&(this._computeParticleColor&&this.mesh.updateVerticesData(b.VertexBuffer.ColorKind,this._colors32,!1,!1),this._computeParticleTexture&&this.mesh.updateVerticesData(b.VertexBuffer.UVKind,this._uvs32,!1,!1),this.mesh.updateVerticesData(b.VertexBuffer.PositionKind,this._positions32,!1,!1),!this.mesh.areNormalsFrozen)){if(this._computeParticleVertex||this.billboard){b.VertexData.ComputeNormals(this._positions32,this._indices,this._normals32);for(f=0;f<this._normals32.length;f++)this._fixedNormal32[f]=this._normals32[f];}this.mesh.updateVerticesData(b.VertexBuffer.NormalKind,this._normals32,!1,!1);}this._computeBoundingBox&&(this.mesh._boundingInfo=new b.BoundingInfo(this._minimum,this._maximum),this.mesh._boundingInfo.update(this.mesh._worldMatrix));this.afterUpdateParticles(e,c,d);}},g.prototype._quaternionRotationYPR=function(){this._halfroll=0.5*this._roll;this._halfpitch=0.5*this._pitch;this._halfyaw=0.5*this._yaw;this._sinRoll=Math.sin(this._halfroll);this._cosRoll=Math.cos(this._halfroll);this._sinPitch=Math.sin(this._halfpitch);this._cosPitch=Math.cos(this._halfpitch);this._sinYaw=Math.sin(this._halfyaw);this._cosYaw=Math.cos(this._halfyaw);this._quaternion.x=this._cosYaw*this._sinPitch*this._cosRoll+this._sinYaw*this._cosPitch*this._sinRoll;this._quaternion.y=this._sinYaw*this._cosPitch*this._cosRoll-this._cosYaw*this._sinPitch*this._sinRoll;this._quaternion.z=this._cosYaw*this._cosPitch*this._sinRoll-this._sinYaw*this._sinPitch*this._cosRoll;this._quaternion.w=this._cosYaw*this._cosPitch*this._cosRoll+this._sinYaw*this._sinPitch*this._sinRoll;},g.prototype._quaternionToRotationMatrix=function(){this._rotMatrix.m[0]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.z*this._quaternion.z);this._rotMatrix.m[1]=2*(this._quaternion.x*this._quaternion.y+this._quaternion.z*this._quaternion.w);this._rotMatrix.m[2]=2*(this._quaternion.z*this._quaternion.x-this._quaternion.y*this._quaternion.w);this._rotMatrix.m[3]=0;this._rotMatrix.m[4]=2*(this._quaternion.x*this._quaternion.y-this._quaternion.z*this._quaternion.w);this._rotMatrix.m[5]=1-2*(this._quaternion.z*this._quaternion.z+this._quaternion.x*this._quaternion.x);this._rotMatrix.m[6]=2*(this._quaternion.y*this._quaternion.z+this._quaternion.x*this._quaternion.w);this._rotMatrix.m[7]=0;this._rotMatrix.m[8]=2*(this._quaternion.z*this._quaternion.x+this._quaternion.y*this._quaternion.w);this._rotMatrix.m[9]=2*(this._quaternion.y*this._quaternion.z-this._quaternion.x*this._quaternion.w);this._rotMatrix.m[10]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.x*this._quaternion.x);this._rotMatrix.m[11]=0;this._rotMatrix.m[12]=0;this._rotMatrix.m[13]=0;this._rotMatrix.m[14]=0;this._rotMatrix.m[15]=1;},g.prototype.dispose=function(){this.mesh.dispose();y4tt.v9();this.pickedParticles=this._colors32=this._uvs32=this._fixedNormal32=this._normals32=this._positions32=this._colors=this._uvs=this._normals=this._indices=this._positions=this.vars=null;},g.prototype.refreshVisibleSize=function(){y4tt.v9();this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo();},g.prototype.setVisibilityBox=function(e){e/=2;this.mesh._boundingInfo=new b.BoundingInfo(new b.Vector3(-e,-e,-e),new b.Vector3(e,e,e));},Object.defineProperty(g.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible;},set:function(b){this._alwaysVisible=b;y4tt.q9();this.mesh.alwaysSelectAsActiveMesh=b;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"isVisibilityBoxLocked",{get:function(){y4tt.q9();return this._isVisibilityBoxLocked;},set:function(b){this._isVisibilityBoxLocked=b;this.mesh.getBoundingInfo().isLocked=b;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation;},set:function(b){y4tt.v9();this._computeParticleRotation=b;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"computeParticleColor",{get:function(){y4tt.q9();return this._computeParticleColor;},set:function(b){this._computeParticleColor=b;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"computeParticleTexture",{get:function(){y4tt.q9();return this._computeParticleTexture;},set:function(b){y4tt.q9();this._computeParticleTexture=b;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex;},set:function(b){this._computeParticleVertex=b;},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"computeBoundingBox",{get:function(){y4tt.q9();return this._computeBoundingBox;},set:function(b){y4tt.q9();this._computeBoundingBox=b;},enumerable:!0,configurable:!0}),g.prototype.initParticles=function(){},g.prototype.recycleParticle=function(b){y4tt.q9();return b;},g.prototype.updateParticle=function(b){y4tt.q9();return b;},g.prototype.updateParticleVertex=function(b,c){y4tt.v9();return c;},g.prototype.beforeUpdateParticles=function(){},g.prototype.afterUpdateParticles=function(){},g);b.SolidParticleSystem=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;g=b.Internals||(b.Internals={}),e=function(b,c,e,g){this.name=b;this.worldAxisForNormal=c;this.worldAxisForFileX=e;y4tt.v9();this.worldAxisForFileY=g;},c=function(){},e=(c.ConvertCubeMapToSphericalPolynomial=function(c){var y,x,z;y4tt.q9();for(var f=new b.SphericalHarmonics(),e=0,g=2/c.size,l=0.5*g-1,n=0;6>n;n++)for(var m=this.FileFaces[n],p=c[m.name],r=l,s=0;s<c.size;s++){for(var t=l,v=0;v<c.size;v++){y=m.worldAxisForFileX.scale(t).add(m.worldAxisForFileY.scale(r)).add(m.worldAxisForNormal);y.normalize();z=Math.pow(1+t*t+r*r,-1.5);x=new b.Color3(p[3*s*c.size+3*v+0],p[3*s*c.size+3*v+1],p[3*s*c.size+3*v+2]);f.addLight(y,x,z);e+=z;t+=g;}r+=g;}return f.scale(4*Math.PI/e),f.scale(1/Math.PI),b.SphericalPolynomial.getSphericalPolynomialFromHarmonics(f);},c.FileFaces=[new e("right",new b.Vector3(1,0,0),new b.Vector3(0,0,-1),new b.Vector3(0,-1,0)),new e("left",new b.Vector3(-1,0,0),new b.Vector3(0,0,1),new b.Vector3(0,-1,0)),new e("up",new b.Vector3(0,1,0),new b.Vector3(1,0,0),new b.Vector3(0,0,1)),new e("down",new b.Vector3(0,-1,0),new b.Vector3(1,0,0),new b.Vector3(0,0,-1)),new e("front",new b.Vector3(0,0,1),new b.Vector3(1,0,0),new b.Vector3(0,-1,0)),new e("back",new b.Vector3(0,0,-1),new b.Vector3(-1,0,0),new b.Vector3(0,-1,0))],c);g.CubeMapToSphericalPolynomialTools=e;!0;}(BABYLON||(BABYLON={}));!function(b){var g,e;g=b.Internals||(b.Internals={}),e=function(){};b=(e.ConvertPanoramaToCubemap=function(b,d,f,e){var g,l,n,m,p;if(!b)throw"ConvertPanoramaToCubemap: input cannot be null";if(b.length!=3*d*f)throw"ConvertPanoramaToCubemap: input size is wrong";g=this.CreateCubemapTexture(e,this.FACE_FRONT,b,d,f),l=this.CreateCubemapTexture(e,this.FACE_BACK,b,d,f),n=this.CreateCubemapTexture(e,this.FACE_LEFT,b,d,f),m=this.CreateCubemapTexture(e,this.FACE_RIGHT,b,d,f),p=this.CreateCubemapTexture(e,this.FACE_UP,b,d,f);b=this.CreateCubemapTexture(e,this.FACE_DOWN,b,d,f);return{front:g,back:l,left:n,right:m,up:p,down:b,size:e};},e.CreateCubemapTexture=function(b,d,f,e,g){var x;y4tt.q9();for(var l=new ArrayBuffer(12*b*b),l=new Float32Array(l),n=d[1].subtract(d[0]).scale(1/b),m=d[3].subtract(d[2]).scale(1/b),p=1/b,r=0,s=0;b>s;s++){for(var t=d[0],v=d[2],y=0;b>y;y++){x=v.subtract(t).scale(r).add(t);x.normalize();x=this.CalcProjectionSpherical(x,f,e,g);l[3*s*b+3*y+0]=x.r;l[3*s*b+3*y+1]=x.g;l[3*s*b+3*y+2]=x.b;t=t.add(n);v=v.add(m);}r+=p;}return l;},e.CalcProjectionSpherical=function(b,d,f,e){var g;g=Math.atan2(b.z,b.x);for(b=Math.acos(b.y);g<-Math.PI;)g+=2*Math.PI;for(;g>Math.PI;)g-=2*Math.PI;g/=Math.PI;b/=Math.PI;g=Math.round((0.5*g+0.5)*f);0>g?g=0:g>=f&&(g=f-1);b=Math.round(b*e);0>b?b=0:b>=e&&(b=e-1);e=e-b-1;return{r:d[3*e*f+3*g+0],g:d[3*e*f+3*g+1],b:d[3*e*f+3*g+2]};},e.FACE_FRONT=[new b.Vector3(-1,-1,-1),new b.Vector3(1,-1,-1),new b.Vector3(-1,1,-1),new b.Vector3(1,1,-1)],e.FACE_BACK=[new b.Vector3(1,-1,1),new b.Vector3(-1,-1,1),new b.Vector3(1,1,1),new b.Vector3(-1,1,1)],e.FACE_RIGHT=[new b.Vector3(1,-1,-1),new b.Vector3(1,-1,1),new b.Vector3(1,1,-1),new b.Vector3(1,1,1)],e.FACE_LEFT=[new b.Vector3(-1,-1,1),new b.Vector3(-1,-1,-1),new b.Vector3(-1,1,1),new b.Vector3(-1,1,-1)],e.FACE_DOWN=[new b.Vector3(-1,1,-1),new b.Vector3(1,1,-1),new b.Vector3(-1,1,1),new b.Vector3(1,1,1)],e.FACE_UP=[new b.Vector3(-1,-1,1),new b.Vector3(1,-1,1),new b.Vector3(-1,-1,-1),new b.Vector3(1,-1,-1)],e);g.PanoramaToCubeMapTools=b;!0;}(BABYLON||(BABYLON={}));!function(b){var g;g=b.Internals||(b.Internals={});b=function(){};b=(b.Ldexp=function(b,c){y4tt.v9();return 1023<c?b*Math.pow(2,1023)*Math.pow(2,c-1023):-1074>c?b*Math.pow(2,-1074)*Math.pow(2,c+1074):b*Math.pow(2,c);},b.Rgbe2float=function(b,c,d,f,g,j){0<g?(g=this.Ldexp(1,g-136),b[j+0]=c*g,b[j+1]=d*g,b[j+2]=f*g):(b[j+0]=0,b[j+1]=0,b[j+2]=0);},b.readStringLine=function(b,c){for(var d="",f="",g=c;g<b.length-c&&(f=String.fromCharCode(b[g]),"\n"!=f);g++)d+=f;y4tt.q9();return d;},b.RGBE_ReadHeader=function(b){var c,d,f,g,j;c=0,d=0,f=this.readStringLine(b,0);if("#"!=f[0]||"?"!=f[1])throw"Bad HDR Format.";g=c=!1,j=0;do j+=f.length+1,f=this.readStringLine(b,j),"FORMAT=32-bit_rle_rgbe"==f?g=!0:0==f.length&&(c=!0);while(!c);if(!g)throw"HDR Bad header format, unsupported FORMAT";j+=f.length+1;f=this.readStringLine(b,j);b=/^\-Y (.*) \+X (.*)$/g.exec(f);if(3>b.length)throw"HDR Bad header format, no size";if(d=parseInt(b[2]),c=parseInt(b[1]),8>d||32767<d)throw"HDR Bad header format, unsupported size";return j+=f.length+1,{height:c,width:d,dataPosition:j};},b.GetCubeMapTextureData=function(b,c){var d,f;d=new Uint8Array(b),f=this.RGBE_ReadHeader(d),d=this.RGBE_ReadPixels_RLE(d,f);return g.PanoramaToCubeMapTools.ConvertPanoramaToCubemap(d,f.width,f.height,c);},b.RGBE_ReadPixels=function(b,c){return this.RGBE_ReadPixels_RLE(b,c);},b.RGBE_ReadPixels_RLE=function(b,c){for(var d,f,g,j,l,n=c.height,m=c.width,p=c.dataPosition,r=j=0,s=0,t=new ArrayBuffer(4*m),t=new Uint8Array(t),s=new ArrayBuffer(12*c.width*c.height),v=new Float32Array(s);0<n;){if(d=b[p++],f=b[p++],g=b[p++],j=b[p++],2!=d||2!=f||128&g)throw"HDR Bad header format, not RLE";if((g<<8|j)!=m)throw"HDR Bad header format, wrong scan line width";for(s=j=0;4>s;s++)for(r=(s+1)*m;r>j;)if(d=b[p++],f=b[p++],128<d){if(l=d-128,0==l||l>r-j)throw"HDR Bad Format, bad scanline data (run)";for(;0<l--;)t[j++]=f;}else{if(l=d,0==l||l>r-j)throw"HDR Bad Format, bad scanline data (non-run)";if(t[j++]=f,0<--l)for(var y=0;l>y;y++)t[j++]=b[p++];}for(s=0;m>s;s++)d=t[s],f=t[s+m],g=t[s+2*m],j=t[s+3*m],this.Rgbe2float(v,d,f,g,j,3*(c.height-n)*m+3*s);n--;}return v;},b);g.HDRTools=b;!0;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f;g=b.Internals||(b.Internals={}),c=function(){this.min=new b.Vector3(0,0,0);this.max=new b.Vector3(0,0,0);y4tt.v9();this.clear();};e=(c.prototype.clear=function(){this.min.x=c.MAX;this.min.y=c.MAX;this.min.z=c.MAX;this.max.x=c.MIN;this.max.y=c.MIN;this.max.z=c.MIN;},c.prototype.augment=function(b,c,d){this.min.x=Math.min(this.min.x,b);this.min.y=Math.min(this.min.y,c);this.min.z=Math.min(this.min.z,d);this.max.x=Math.max(this.max.x,b);this.max.y=Math.max(this.max.y,c);this.max.z=Math.max(this.max.z,d);},c.prototype.clampMin=function(b,c,d){this.min.x=Math.max(this.min.x,b);this.min.y=Math.max(this.min.y,c);y4tt.q9();this.min.z=Math.max(this.min.z,d);},c.prototype.clampMax=function(b,c,d){this.max.x=Math.min(this.max.x,b);y4tt.v9();this.max.y=Math.min(this.max.y,c);this.max.z=Math.min(this.max.z,d);},c.prototype.empty=function(){return this.min.x>this.max.y||this.min.y>this.max.y||this.min.z>this.max.y;},c.MAX=Number.MAX_VALUE,c.MIN=Number.MIN_VALUE,c);f=function(b,c,d,f,e,g,r,s,t,v){this.input=b;this.inputSize=c;this.outputSize=d;this.maxNumMipLevels=f;this.numChannels=e;this.isFloat=g;this.specularPower=r;this.cosinePowerDropPerMip=s;this.excludeBase=t;this.fixup=v;this._outputSurface=[];this._numMipLevels=0;};d=(f.prototype.filterCubeMap=function(){return this.init(),this.filterCubeMapMipChain(),this._outputSurface;},f.prototype.init=function(){var b,c,d;0==this.maxNumMipLevels&&(this.maxNumMipLevels=f.CP_MAX_MIPLEVELS);d=this.outputSize;for(c=0;c<this.maxNumMipLevels;c++){this._outputSurface.length++;this._outputSurface[c]=[];for(b=0;6>b;b++)this._outputSurface[c].length++,this.isFloat?this._outputSurface[c][b]=new Float32Array(d*d*this.numChannels):this._outputSurface[c][b]=new Uint32Array(d*d*this.numChannels);if(d>>=1,this._numMipLevels++,0==d)return void(this.maxNumMipLevels=c);}},f.prototype.filterCubeMapMipChain=function(){var b,d,f,e,g;y4tt.v9();b=this.specularPower;this.precomputeFilterLookupTables(this.inputSize);for(var c=0;c<this._numMipLevels;c++){this.excludeBase&&0==c&&(b=1E5);d=this.input,f=this._outputSurface[c],e=this.outputSize>>c,g=this.getBaseFilterAngle(b);this.filterCubeSurfaces(d,this.inputSize,f,e,g,b);this.fixup&&this.fixupCubeEdges(f,e);this.excludeBase&&0==c&&(b=this.specularPower);b*=this.cosinePowerDropPerMip;}},f.prototype.getBaseFilterAngle=function(b){var c;c=180;y4tt.v9();return c=Math.acos(Math.pow(1E-6,1/b)),c*=180/Math.PI,2*c;},f.prototype.precomputeFilterLookupTables=function(b){y4tt.q9();this._normCubeMap=[];this.buildNormalizerSolidAngleCubemap(b);},f.prototype.buildNormalizerSolidAngleCubemap=function(b){var c,d,f,e;for(c=0;6>c;c++){this._normCubeMap.push(new Float32Array(4*b*b));this.input[c];for(f=0;b>f;f++)for(d=0;b>d;d++){e=this.texelCoordToVect(c,d,f,b,this.fixup);this._normCubeMap[c][4*(f*b+d)+0]=e.x;this._normCubeMap[c][4*(f*b+d)+1]=e.y;this._normCubeMap[c][4*(f*b+d)+2]=e.z;e=this.texelCoordSolidAngle(c,d,f,b);this._normCubeMap[c][4*(f*b+d)+4]=e;}}},f.prototype.texelCoordToVect=function(b,c,d,e,g){if(c=2*(c+0.5)/e-1,d=2*(d+0.5)/e-1,g&&1<e)e=Math.pow(e,2)/Math.pow(e-1,3),c=e*Math.pow(c,3)+c,d=e*Math.pow(d,3)+d;e=f._sgFace2DMapping[b][f.CP_UDIR];f._vectorTemp.x=e[0]*c;f._vectorTemp.y=e[1]*c;f._vectorTemp.z=e[2]*c;c=f._sgFace2DMapping[b][f.CP_VDIR];f._vectorTemp.x+=c[0]*d;f._vectorTemp.y+=c[1]*d;f._vectorTemp.z+=c[2]*d;b=f._sgFace2DMapping[b][f.CP_FACEAXIS];return f._vectorTemp.x+=b[0],f._vectorTemp.y+=b[1],f._vectorTemp.z+=b[2],f._vectorTemp.normalize(),f._vectorTemp;},f.prototype.vectToTexelCoord=function(b,c,d,e){var g,p,r,s,t;r=Math.abs(b),s=Math.abs(c),t=Math.abs(d);r>=s&&r>=t?(g=r,p=0<=b?f.CP_FACE_X_POS:f.CP_FACE_X_NEG):s>=r&&s>=t?(g=s,p=0<=c?f.CP_FACE_Y_POS:f.CP_FACE_Y_NEG):(g=t,p=0<=d?f.CP_FACE_Z_POS:f.CP_FACE_Z_NEG);g=1/g;b*=g;c*=g;d*=g;y4tt.v9();g=f._sgFace2DMapping[p][f.CP_UDIR];r=g[0]*b+g[1]*c+g[2]*d;g=f._sgFace2DMapping[p][f.CP_VDIR];r=Math.floor(0.5*(e-1)*(r+1));b=Math.floor(0.5*(e-1)*(g[0]*b+g[1]*c+g[2]*d+1));return f._vectorTemp.x=p,f._vectorTemp.y=r,f._vectorTemp.z=b,f._vectorTemp;},f.prototype.areaElement=function(b,c){return Math.atan2(b*c,Math.sqrt(b*b+c*c+1));},f.prototype.texelCoordSolidAngle=function(b,c,d,f){var e;y4tt.q9();c=2*(c+0.5)/f-1;d=2*(d+0.5)/f-1;e=1/f;b=c-e;f=d-e;c+=e;d+=e;return this.areaElement(b,f)-this.areaElement(b,d)-this.areaElement(c,f)+this.areaElement(c,d);},f.prototype.filterCubeSurfaces=function(b,c,d,f,g,p){var r,s,t,v,y,x;v=[];for(r=0;6>r;r++)v.push(new e());r=180/Math.PI*Math.atan2(1,c);s=g/2;r>s&&(s=r);90<s&&(s=90);g=Math.ceil(s/r);1>g&&(g=1);y=Math.cos(Math.PI/180*s);for(r=0;6>r;r++)for(t=0;f>t;t++)for(s=0;f>s;s++){x=this.texelCoordToVect(r,s,t,f,this.fixup).clone();this.clearFilterExtents(v);this.determineFilterExtents(x,c,g,v);x=this.processFilterExtents(x,y,v,b,c,p);d[r][(t*f+s)*this.numChannels+0]=x.x;d[r][(t*f+s)*this.numChannels+1]=x.y;d[r][(t*f+s)*this.numChannels+2]=x.z;}},f.prototype.clearFilterExtents=function(b){for(var c=0;6>c;c++)b[c].clear();},f.prototype.determineFilterExtents=function(b,c,d,e){var g,p,r,s,t,v,y,x,z,B,A;r=[0,0,0,0],s=[0,0,0,0],t=[0,0,0,0],v=this.vectToTexelCoord(b.x,b.y,b.z,c);b=v.x;y=v.y,v=v.z;e[b].augment(y-d,v-d,0);e[b].augment(y+d,v+d,0);e[b].clampMin(0,0,0);e[b].clampMax(c-1,c-1,0);x=e[b].min.x,z=e[b].min.y,B=e[b].max.x,A=e[b].max.y;r[0]=d-y;s[0]=z;t[0]=A;r[1]=y+d-(c-1);s[1]=z;t[1]=A;r[2]=d-v;s[2]=x;t[2]=B;r[3]=v+d-(c-1);s[3]=x;y4tt.v9();t[3]=B;for(y=0;4>y;y++){if(0<r[y]){switch(d=f._sgCubeNgh[b][y][0],g=f._sgCubeNgh[b][y][1],y!=g&&3!=y+g||(s[y]=c-1-s[y],t[y]=c-1-t[y]),f._sgCubeNgh[b][y][1]){case f.CP_EDGE_LEFT:e[d].augment(0,s[y],0);e[d].augment(r[y],t[y],0);break;case f.CP_EDGE_RIGHT:e[d].augment(c-1,s[y],0);e[d].augment(c-1-r[y],t[y],0);break;case f.CP_EDGE_TOP:e[d].augment(s[y],0,0);e[d].augment(t[y],r[y],0);break;case f.CP_EDGE_BOTTOM:e[d].augment(s[y],c-1,0),e[d].augment(t[y],c-1-r[y],0);}e[d].clampMin(0,0,0);e[d].clampMax(c-1,c-1,0);}if(r[y]>c){switch(b){case f.CP_FACE_X_POS:p=f.CP_FACE_X_NEG;break;case f.CP_FACE_X_NEG:p=f.CP_FACE_X_POS;break;case f.CP_FACE_Y_POS:p=f.CP_FACE_Y_NEG;break;case f.CP_FACE_Y_NEG:p=f.CP_FACE_Y_POS;break;case f.CP_FACE_Z_POS:p=f.CP_FACE_Z_NEG;break;case f.CP_FACE_Z_NEG:p=f.CP_FACE_Z_POS;}e[p].augment(0,0,0);e[p].augment(c-1,c-1,0);}}},f.prototype.processFilterExtents=function(b,c,d,e,g,p){for(var r=[0,0,0,0],s=0,t=0,v=this.numChannels,y=4*g,x=g*this.numChannels,z=0;6>z;z++)if(!d[z].empty())for(var B=d[z].min.x,A=d[z].min.y,C=d[z].max.x,G=d[z].max.y,D=4*(A*g+B),H=this.numChannels*(A*g+B);G>=A;A++){for(var J=0,F=0,O=B;C>=O;O++){t=this._normCubeMap[z][D+J+0]*b.x+this._normCubeMap[z][D+J+1]*b.y+this._normCubeMap[z][D+J+2]*b.z;if(t>=c&&0<t){for(var E=this._normCubeMap[z][D+J+3],E=E*Math.pow(t,p+1),t=0;v>t;t++)r[t]+=E*e[z][H+F],F++;s+=E;}else F+=v;J+=4;}D+=y;H+=x;}0!=s?(f._vectorTemp.x=r[0]/s,f._vectorTemp.y=r[1]/s,f._vectorTemp.z=r[2]/s,3<this.numChannels&&(f._vectorTemp.w=r[3]/s)):(b=this.vectToTexelCoord(b.x,b.y,b.z,g).clone(),f._vectorTemp.x=e[b.x][this.numChannels*(b.z*g+b.y)+0],f._vectorTemp.y=e[b.x][this.numChannels*(b.z*g+b.y)+1],f._vectorTemp.z=e[b.x][this.numChannels*(b.z*g+b.y)+2],3<this.numChannels&&(f._vectorTemp.z=e[b.x][this.numChannels*(b.z*g+b.y)+3]));return f._vectorTemp;},f.prototype.fixupCubeEdges=function(b,c){var d,e,g,p,r,s,t,v,y,x;y4tt.v9();p=0;d=[0,0,0,0,0,0,0,0];r=[[],[],[],[]],s=[[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]]];if(!(1>c))if(1!=c){for(g=0;6>g;g++){r[0]=[g,0];r[1]=[g,(c-1)*this.numChannels];r[2]=[g,c*(c-1)*this.numChannels];r[3]=[g,(c*(c-1)+(c-1))*this.numChannels];for(p=0;4>p;p++){t=f._sgCubeCornerList[g][p];s[t][d[t]]=r[p];d[t]++;}}for(p=0;8>p;p++)for(d=0;d<this.numChannels;d++){for(g=r=0;3>g;g++)r+=b[s[p][g][0]][s[p][g][1]+d];r*=1/3;for(g=0;3>g;g++)b[s[p][g][0]][s[p][g][1]+d]=r;}for(g=0;12>g;g++){p=f._sgCubeEdgeList[g][0];d=f._sgCubeEdgeList[g][1];s=f._sgCubeNgh[p][d][0];e=f._sgCubeNgh[p][d][1];v=t=r=0,y=0;switch(d){case f.CP_EDGE_LEFT:v=this.numChannels*c;break;case f.CP_EDGE_RIGHT:r+=(c-1)*this.numChannels;v=this.numChannels*c;break;case f.CP_EDGE_TOP:v=this.numChannels;break;case f.CP_EDGE_BOTTOM:r+=c*(c-1)*this.numChannels,v=this.numChannels;}if(d==e||3==d+e)switch(e){case f.CP_EDGE_LEFT:t+=(c-1)*c*this.numChannels;y=-(this.numChannels*c);break;case f.CP_EDGE_RIGHT:t+=((c-1)*c+(c-1))*this.numChannels;y=-(this.numChannels*c);break;case f.CP_EDGE_TOP:t+=(c-1)*this.numChannels;y=-this.numChannels;break;case f.CP_EDGE_BOTTOM:t+=((c-1)*c+(c-1))*this.numChannels,y=-this.numChannels;}else switch(e){case f.CP_EDGE_LEFT:y=this.numChannels*c;break;case f.CP_EDGE_RIGHT:t+=(c-1)*this.numChannels;y=this.numChannels*c;break;case f.CP_EDGE_TOP:y=this.numChannels;break;case f.CP_EDGE_BOTTOM:t+=c*(c-1)*this.numChannels,y=this.numChannels;}r+=v;t+=y;for(e=1;c-1>e;e++){for(d=0;d<this.numChannels;d++){x=0.5*(b[p][r+d]+b[s][t+d]);b[p][r+d]=x;b[s][t+d]=x;}r+=v;t+=y;}}}else for(d=0;d<this.numChannels;d++){for(g=p=0;6>g;g++)p+=b[g][d];p/=6;for(g=0;6>g;g++)b[g][d]=p;}},f.CP_MAX_MIPLEVELS=16,f.CP_UDIR=0,f.CP_VDIR=1,f.CP_FACEAXIS=2,f.CP_FACE_X_POS=0,f.CP_FACE_X_NEG=1,f.CP_FACE_Y_POS=2,f.CP_FACE_Y_NEG=3,f.CP_FACE_Z_POS=4,f.CP_FACE_Z_NEG=5,f.CP_EDGE_LEFT=0,f.CP_EDGE_RIGHT=1,f.CP_EDGE_TOP=2,f.CP_EDGE_BOTTOM=3,f.CP_CORNER_NNN=0,f.CP_CORNER_NNP=1,f.CP_CORNER_NPN=2,f.CP_CORNER_NPP=3,f.CP_CORNER_PNN=4,f.CP_CORNER_PNP=5,f.CP_CORNER_PPN=6,f.CP_CORNER_PPP=7,f._vectorTemp=new b.Vector4(0,0,0,0),f._sgFace2DMapping=[[[0,0,-1],[0,-1,0],[1,0,0]],[[0,0,1],[0,-1,0],[-1,0,0]],[[1,0,0],[0,0,1],[0,1,0]],[[1,0,0],[0,0,-1],[0,-1,0]],[[1,0,0],[0,-1,0],[0,0,1]],[[-1,0,0],[0,-1,0],[0,0,-1]]],f._sgCubeNgh=[[[f.CP_FACE_Z_POS,f.CP_EDGE_RIGHT],[f.CP_FACE_Z_NEG,f.CP_EDGE_LEFT],[f.CP_FACE_Y_POS,f.CP_EDGE_RIGHT],[f.CP_FACE_Y_NEG,f.CP_EDGE_RIGHT]],[[f.CP_FACE_Z_NEG,f.CP_EDGE_RIGHT],[f.CP_FACE_Z_POS,f.CP_EDGE_LEFT],[f.CP_FACE_Y_POS,f.CP_EDGE_LEFT],[f.CP_FACE_Y_NEG,f.CP_EDGE_LEFT]],[[f.CP_FACE_X_NEG,f.CP_EDGE_TOP],[f.CP_FACE_X_POS,f.CP_EDGE_TOP],[f.CP_FACE_Z_NEG,f.CP_EDGE_TOP],[f.CP_FACE_Z_POS,f.CP_EDGE_TOP]],[[f.CP_FACE_X_NEG,f.CP_EDGE_BOTTOM],[f.CP_FACE_X_POS,f.CP_EDGE_BOTTOM],[f.CP_FACE_Z_POS,f.CP_EDGE_BOTTOM],[f.CP_FACE_Z_NEG,f.CP_EDGE_BOTTOM]],[[f.CP_FACE_X_NEG,f.CP_EDGE_RIGHT],[f.CP_FACE_X_POS,f.CP_EDGE_LEFT],[f.CP_FACE_Y_POS,f.CP_EDGE_BOTTOM],[f.CP_FACE_Y_NEG,f.CP_EDGE_TOP]],[[f.CP_FACE_X_POS,f.CP_EDGE_RIGHT],[f.CP_FACE_X_NEG,f.CP_EDGE_LEFT],[f.CP_FACE_Y_POS,f.CP_EDGE_TOP],[f.CP_FACE_Y_NEG,f.CP_EDGE_BOTTOM]]],f._sgCubeEdgeList=[[f.CP_FACE_X_POS,f.CP_EDGE_LEFT],[f.CP_FACE_X_POS,f.CP_EDGE_RIGHT],[f.CP_FACE_X_POS,f.CP_EDGE_TOP],[f.CP_FACE_X_POS,f.CP_EDGE_BOTTOM],[f.CP_FACE_X_NEG,f.CP_EDGE_LEFT],[f.CP_FACE_X_NEG,f.CP_EDGE_RIGHT],[f.CP_FACE_X_NEG,f.CP_EDGE_TOP],[f.CP_FACE_X_NEG,f.CP_EDGE_BOTTOM],[f.CP_FACE_Z_POS,f.CP_EDGE_TOP],[f.CP_FACE_Z_POS,f.CP_EDGE_BOTTOM],[f.CP_FACE_Z_NEG,f.CP_EDGE_TOP],[f.CP_FACE_Z_NEG,f.CP_EDGE_BOTTOM]],f._sgCubeCornerList=[[f.CP_CORNER_PPP,f.CP_CORNER_PPN,f.CP_CORNER_PNP,f.CP_CORNER_PNN],[f.CP_CORNER_NPN,f.CP_CORNER_NPP,f.CP_CORNER_NNN,f.CP_CORNER_NNP],[f.CP_CORNER_NPN,f.CP_CORNER_PPN,f.CP_CORNER_NPP,f.CP_CORNER_PPP],[f.CP_CORNER_NNP,f.CP_CORNER_PNP,f.CP_CORNER_NNN,f.CP_CORNER_PNN],[f.CP_CORNER_NPP,f.CP_CORNER_PPP,f.CP_CORNER_NNP,f.CP_CORNER_PNP],[f.CP_CORNER_PPN,f.CP_CORNER_NPN,f.CP_CORNER_PNN,f.CP_CORNER_NNN]],f);g.PMREMGenerator=d;y4tt.q9();!0;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.BaseTexture,c=function(c,f,g,j,l,n,m){void 0===j&&(j=!1);void 0===n&&(n=!1);void 0===m&&(m=!1);e.call(this,f);this._useInGammaSpace=!1;this._generateHarmonics=!0;this._isBABYLONPreprocessed=!1;this.coordinatesMode=b.Texture.CUBIC_MODE;this.sphericalPolynomial=null;this.isPMREM=!1;c&&(this.name=c,this.url=c,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=b.Matrix.Identity(),g?(this._isBABYLONPreprocessed=!1,this._noMipmap=j,this._size=g,this._useInGammaSpace=n,this._usePMREMGenerator=m&&f.getEngine().getCaps().textureLOD&&this.getScene().getEngine().getCaps().textureFloat&&!this._useInGammaSpace):(this._isBABYLONPreprocessed=!0,this._noMipmap=!1,this._useInGammaSpace=!1,this._usePMREMGenerator=f.getEngine().getCaps().textureLOD&&this.getScene().getEngine().getCaps().textureFloat&&!this._useInGammaSpace),this.isPMREM=this._usePMREMGenerator,this._texture=this._getFromCache(c,this._noMipmap),this._texture||(f.useDelayedTextureLoading?this.delayLoadState=b.Engine.DELAYLOADSTATE_NOTLOADED:this.loadTexture()));};g=(__extends(c,e),c.prototype.loadBabylonTexture=function(){var c,f,e,g;c=this,f=0,e=null,g=!this._useInGammaSpace&&this.getScene().getEngine().getCaps().textureFloat?function(){var s;for(var b=[],g=30,j=0;f>j;j++){b.push([]);for(var p=3*Math.pow(c._size>>j,2),r=0;6>r;r++){s=e.subarray(g,g+p);b[j].push(s);g+=p;}}return b;}:null;this._texture=this.getScene().getEngine().createRawCubeTexture(this.url,this.getScene(),this._size,b.Engine.TEXTUREFORMAT_RGB,this.getScene().getEngine().getCaps().textureFloat?b.Engine.TEXTURETYPE_FLOAT:b.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(l){var n,m,s,v,y,x,z;n=new Int32Array(l);e=new Float32Array(l);n[0];c._size=n[1];c.getScene().getEngine().updateTextureSize(c._texture,c._size,c._size);c.sphericalPolynomial=new b.SphericalPolynomial();c.sphericalPolynomial.x.copyFromFloats(e[2],e[3],e[4]);c.sphericalPolynomial.y.copyFromFloats(e[5],e[6],e[7]);c.sphericalPolynomial.z.copyFromFloats(e[8],e[9],e[10]);c.sphericalPolynomial.xx.copyFromFloats(e[11],e[12],e[13]);c.sphericalPolynomial.yy.copyFromFloats(e[14],e[15],e[16]);c.sphericalPolynomial.zz.copyFromFloats(e[17],e[18],e[19]);c.sphericalPolynomial.xy.copyFromFloats(e[20],e[21],e[22]);c.sphericalPolynomial.yz.copyFromFloats(e[23],e[24],e[25]);c.sphericalPolynomial.zx.copyFromFloats(e[26],e[27],e[28]);f=n[29];m=30;l=[];for(var n=3*Math.pow(c._size,2),p=0;6>p;p++)l.push(e.subarray(m,m+n)),m+=n;for(var m=[],r=null,p=0;6>p;p++){s=null;if(g)s=l[p];else{if(s=l[[0,2,4,1,3,5][p]],!c.getScene().getEngine().getCaps().textureFloat)r=new ArrayBuffer(n),r=new Uint8Array(r);for(var t=0;t<c._size*c._size;t++)if(c._useInGammaSpace&&(s[3*t+0]=Math.pow(s[3*t+0],b.ToGammaSpace),s[3*t+1]=Math.pow(s[3*t+1],b.ToGammaSpace),s[3*t+2]=Math.pow(s[3*t+2],b.ToGammaSpace)),r){v=Math.max(255*s[3*t+0],0),y=Math.max(255*s[3*t+1],0),x=Math.max(255*s[3*t+2],0),z=Math.max(Math.max(v,y),x);255<z&&(z=255/z,v*=z,y*=z,x*=z);r[3*t+0]=v;r[3*t+1]=y;r[3*t+2]=x;}}r?m.push(r):m.push(s);}return m;},g);},c.prototype.loadHDRTexture=function(){var d,f;d=this,f=null;!this._noMipmap&&this._usePMREMGenerator&&(f=function(c){return new b.Internals.PMREMGenerator(c,d._size,d._size,0,3,d.getScene().getEngine().getCaps().textureFloat,2048,0.25,!1,!0).filterCubeMap();});y4tt.v9();this._texture=this.getScene().getEngine().createRawCubeTexture(this.url,this.getScene(),this._size,b.Engine.TEXTUREFORMAT_RGB,this.getScene().getEngine().getCaps().textureFloat?b.Engine.TEXTURETYPE_FLOAT:b.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(f){var m,r,s,t,v;f=b.Internals.HDRTools.GetCubeMapTextureData(f,d._size);d._generateHarmonics&&(d.sphericalPolynomial=b.Internals.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(f));for(var e=[],g=null,n=0;6>n;n++){d.getScene().getEngine().getCaps().textureFloat||(g=new ArrayBuffer(3*d._size*d._size),g=new Uint8Array(g));m=f[c._facesMapping[n]];if(d._useInGammaSpace||g)for(var p=0;p<d._size*d._size;p++)if(d._useInGammaSpace&&(m[3*p+0]=Math.pow(m[3*p+0],b.ToGammaSpace),m[3*p+1]=Math.pow(m[3*p+1],b.ToGammaSpace),m[3*p+2]=Math.pow(m[3*p+2],b.ToGammaSpace)),g){r=Math.max(255*m[3*p+0],0),s=Math.max(255*m[3*p+1],0),t=Math.max(255*m[3*p+2],0),v=Math.max(Math.max(r,s),t);255<v&&(v=255/v,r*=v,s*=v,t*=v);g[3*p+0]=r;g[3*p+1]=s;g[3*p+2]=t;}g?e.push(g):e.push(m);}return e;},f);},c.prototype.loadTexture=function(){y4tt.q9();this._isBABYLONPreprocessed?this.loadBabylonTexture():this.loadHDRTexture();},c.prototype.clone=function(){var b;b=this._isBABYLONPreprocessed?null:this._size,b=new c(this.url,this.getScene(),b,this._noMipmap,this._generateHarmonics,this._useInGammaSpace,this._usePMREMGenerator);return b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b.coordinatesIndex=this.coordinatesIndex,b.coordinatesMode=this.coordinatesMode,b;},c.prototype.delayLoad=function(){y4tt.q9();this.delayLoadState===b.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=b.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture());},c.prototype.getReflectionTextureMatrix=function(){y4tt.q9();return this._textureMatrix;},c.Parse=function(c,f,e){var g;g=null;c.name&&!c.isRenderTarget&&(g=new b.HDRCubeTexture(e+c.name,f,c.isBABYLONPreprocessed?null:c.size,g.generateHarmonics,g.useInGammaSpace,g.usePMREMGenerator),g.name=c.name,g.hasAlpha=c.hasAlpha,g.level=c.level,g.coordinatesMode=c.coordinatesMode);y4tt.q9();return g;},c.prototype.serialize=function(){var b;y4tt.q9();if(!this.name)return null;b={};return b.name=this.name,b.hasAlpha=this.hasAlpha,b.isCube=!0,b.level=this.level,b.size=this._size,b.coordinatesMode=this.coordinatesMode,b.useInGammaSpace=this._useInGammaSpace,b.generateHarmonics=this._generateHarmonics,b.usePMREMGenerator=this._usePMREMGenerator,b.isBABYLONPreprocessed=this._isBABYLONPreprocessed,b;},c.generateBabylonHDROnDisk=function(b,f,e){void 0===e&&(e=null);c.generateBabylonHDR(b,f,function(b){var c;b=new Blob([b],{type:"application/octet-stream"});b=window.URL.createObjectURL(b);c=document.createElement("a");document.body.appendChild(c);c.style.display="none";c.href=b;c.download="envmap.babylon.hdr";c.click();},e);},c.generateBabylonHDR=function(c,e,g,j){if((void 0===j&&(j=null),!c)||!b.Tools.IsExponentOfTwo(e))return null;y4tt.v9();b.Tools.LoadFile(c,function(c){var d,j,p,r;c=b.Internals.HDRTools.GetCubeMapTextureData(c,e);d=b.Internals.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(c),j=[];j.push(c.right);j.push(c.left);j.push(c.up);j.push(c.down);j.push(c.front);j.push(c.back);c=new b.Internals.PMREMGenerator(j,e,e,0,3,!0,2048,0.25,!1,!0).filterCubeMap();p=116;p+=4;for(j=0;j<c.length;j++){r=e>>j;p+=12*6*r*r;}p=new ArrayBuffer(p);j=new Int32Array(p);r=new Float32Array(p);j[0]=1;j[1]=e;d.x.toArray(r,2);d.y.toArray(r,5);d.z.toArray(r,8);d.xx.toArray(r,11);d.yy.toArray(r,14);d.zz.toArray(r,17);d.xy.toArray(r,20);d.yz.toArray(r,23);d.zx.toArray(r,26);j[29]=c.length;d=30;for(j=0;j<c.length;j++)for(var s=3*Math.pow(e>>j,2),t=0;6>t;t++)r.set(c[j][t],d),d+=s;g(p);},null,null,!0,j);},c._facesMapping="right up front left down back".split(" "),c);b.HDRCubeTexture=g;}(BABYLON||(BABYLON={}));!function(b){var g,e;g=b.Debug||(b.Debug={});e=function(c,d,e,g,j){void 0===g&&(g=!0);void 0===j&&(j=1);this.skeleton=c;this.mesh=d;this.autoUpdateBonesMatrices=g;this.renderingGroupId=j;this.color=b.Color3.White();y4tt.v9();this._debugLines=[];this._isEnabled=!1;this._scene=e;this.update();this._renderFunction=this.update.bind(this);};e=(Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled;},set:function(b){y4tt.q9();this._isEnabled!==b&&(this._isEnabled=b,b?this._scene.registerBeforeRender(this._renderFunction):this._scene.unregisterBeforeRender(this._renderFunction));},enumerable:!0,configurable:!0}),e.prototype._getBonePosition=function(c,d,e,g,j,l){var n,m;void 0===g&&(g=0);void 0===j&&(j=0);void 0===l&&(l=0);n=b.Tmp.Matrix[0],m=d.getParent();if(n.copyFrom(d.getLocalMatrix()),0!==g||0!==j||0!==l)d=b.Tmp.Matrix[1],b.Matrix.IdentityToRef(d),d.m[12]=g,d.m[13]=j,d.m[14]=l,d.multiplyToRef(n,n);m&&n.multiplyToRef(m.getAbsoluteTransform(),n);n.multiplyToRef(e,n);c.x=n.m[12];c.y=n.m[13];c.z=n.m[14];},e.prototype._getLinesForBonesWithLength=function(c,d){var j,l;for(var e=c.length,g=0;e>g;g++){j=c[g],l=this._debugLines[g];l||(l=[b.Vector3.Zero(),b.Vector3.Zero()],this._debugLines[g]=l);this._getBonePosition(l[0],j,d);this._getBonePosition(l[1],j,d,0,j.length,0);}},e.prototype._getLinesForBonesNoLength=function(c,d){var j,l,n;y4tt.v9();for(var e=0,g=c.length-1;0<=g;g--){j=c[g],l=j.getParent();if(l){n=this._debugLines[e];n||(n=[b.Vector3.Zero(),b.Vector3.Zero()],this._debugLines[e]=n);this._getBonePosition(n[0],j,d);this._getBonePosition(n[1],l,d);e++;}}},e.prototype.update=function(){this.autoUpdateBonesMatrices&&this._updateBoneMatrix(this.skeleton.bones[0]);y4tt.q9();void 0===this.skeleton.bones[0].length?this._getLinesForBonesNoLength(this.skeleton.bones,this.mesh.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,this.mesh.getWorldMatrix());this._debugMesh?b.MeshBuilder.CreateLineSystem(null,{lines:this._debugLines,updatable:!0,instance:this._debugMesh},this._scene):(this._debugMesh=b.MeshBuilder.CreateLineSystem(null,{lines:this._debugLines,updatable:!0},this._scene),this._debugMesh.renderingGroupId=this.renderingGroupId);this._debugMesh.color=this.color;},e.prototype._updateBoneMatrix=function(b){b.getParent()&&b.getLocalMatrix().multiplyToRef(b.getParent().getAbsoluteTransform(),b.getAbsoluteTransform());b=b.children;for(var d=b.length,e=0;d>e;e++)this._updateBoneMatrix(b[e]);},e.prototype.dispose=function(){this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null);},e);g.SkeletonViewer=e;!0;}(BABYLON||(BABYLON={}));!function(b){var g,e;e=function(){this._dirty=!0;this._tempColor=new b.Color4(0,0,0,0);this._globalCurve=new b.Color4(0,0,0,0);this._highlightsCurve=new b.Color4(0,0,0,0);this._midtonesCurve=new b.Color4(0,0,0,0);this._shadowsCurve=new b.Color4(0,0,0,0);y4tt.q9();this._positiveCurve=new b.Color4(0,0,0,0);this._negativeCurve=new b.Color4(0,0,0,0);this._globalHue=30;this._globalExposure=this._globalSaturation=this._globalDensity=0;this._highlightsHue=30;this._highlightsExposure=this._highlightsSaturation=this._highlightsDensity=0;this._midtonesHue=30;this._midtonesExposure=this._midtonesSaturation=this._midtonesDensity=0;this._shadowsHue=30;this._shadowsExposure=this._shadowsSaturation=this._shadowsDensity=0;};y4tt.q9();g=(Object.defineProperty(e.prototype,"GlobalHue",{get:function(){y4tt.q9();return this._globalHue;},set:function(b){this._globalHue=b;y4tt.q9();this._dirty=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"GlobalDensity",{get:function(){y4tt.v9();return this._globalDensity;},set:function(b){this._globalDensity=b;this._dirty=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"GlobalSaturation",{get:function(){y4tt.v9();return this._globalSaturation;},set:function(b){y4tt.v9();this._globalSaturation=b;this._dirty=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HighlightsHue",{get:function(){y4tt.q9();return this._highlightsHue;},set:function(b){y4tt.q9();this._highlightsHue=b;this._dirty=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HighlightsDensity",{get:function(){return this._highlightsDensity;},set:function(b){this._highlightsDensity=b;this._dirty=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HighlightsSaturation",{get:function(){y4tt.q9();return this._highlightsSaturation;},set:function(b){y4tt.q9();this._highlightsSaturation=b;this._dirty=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HighlightsExposure",{get:function(){return this._highlightsExposure;},set:function(b){this._highlightsExposure=b;y4tt.q9();this._dirty=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"MidtonesHue",{get:function(){return this._midtonesHue;},set:function(b){this._midtonesHue=b;this._dirty=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"MidtonesDensity",{get:function(){y4tt.q9();return this._midtonesDensity;},set:function(b){this._midtonesDensity=b;this._dirty=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"MidtonesSaturation",{get:function(){return this._midtonesSaturation;},set:function(b){this._midtonesSaturation=b;y4tt.q9();this._dirty=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"MidtonesExposure",{get:function(){return this._midtonesExposure;},set:function(b){y4tt.v9();this._midtonesExposure=b;this._dirty=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ShadowsHue",{get:function(){y4tt.v9();return this._shadowsHue;},set:function(b){this._shadowsHue=b;this._dirty=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ShadowsDensity",{get:function(){return this._shadowsDensity;},set:function(b){this._shadowsDensity=b;y4tt.v9();this._dirty=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ShadowsSaturation",{get:function(){return this._shadowsSaturation;},set:function(b){y4tt.q9();this._shadowsSaturation=b;this._dirty=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ShadowsExposure",{get:function(){y4tt.q9();return this._shadowsExposure;},set:function(b){y4tt.q9();this._shadowsExposure=b;this._dirty=!0;},enumerable:!0,configurable:!0}),e.Bind=function(b,d){y4tt.q9();b._dirty&&(b._dirty=!1,b.getColorGradingDataToRef(b._globalHue,b._globalDensity,b._globalSaturation,b._globalExposure,b._globalCurve),b.getColorGradingDataToRef(b._highlightsHue,b._highlightsDensity,b._highlightsSaturation,b._highlightsExposure,b._tempColor),b._tempColor.multiplyToRef(b._globalCurve,b._highlightsCurve),b.getColorGradingDataToRef(b._midtonesHue,b._midtonesDensity,b._midtonesSaturation,b._midtonesExposure,b._tempColor),b._tempColor.multiplyToRef(b._globalCurve,b._midtonesCurve),b.getColorGradingDataToRef(b._shadowsHue,b._shadowsDensity,b._shadowsSaturation,b._shadowsExposure,b._tempColor),b._tempColor.multiplyToRef(b._globalCurve,b._shadowsCurve),b._highlightsCurve.subtractToRef(b._midtonesCurve,b._positiveCurve),b._midtonesCurve.subtractToRef(b._shadowsCurve,b._negativeCurve));d.setFloat4("vCameraColorCurvePositive",b._positiveCurve.r,b._positiveCurve.g,b._positiveCurve.b,b._positiveCurve.a);d.setFloat4("vCameraColorCurveNeutral",b._midtonesCurve.r,b._midtonesCurve.g,b._midtonesCurve.b,b._midtonesCurve.a);d.setFloat4("vCameraColorCurveNegative",b._negativeCurve.r,b._negativeCurve.g,b._negativeCurve.b,b._negativeCurve.a);},e.PrepareUniforms=function(b){y4tt.q9();b.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative");},e.prototype.getColorGradingDataToRef=function(b,d,f,g,j){null!=b&&(b=e.clamp(b,0,360),d=e.clamp(d,-100,100),f=e.clamp(f,-100,100),g=e.clamp(g,-100,100),d=e.applyColorGradingSliderNonlinear(d),d*=0.5,g=e.applyColorGradingSliderNonlinear(g),0>d&&(d*=-1,b=(b+180)%360),e.fromHSBToRef(b,d,50+0.25*g,j),j.scaleToRef(2,j),j.a=1+0.01*f);},e.applyColorGradingSliderNonlinear=function(b){var d;b/=100;d=Math.abs(b);return d=Math.pow(d,2),0>b&&(d*=-1),100*d;},e.fromHSBToRef=function(b,d,f,g){var j,l,n;j=e.clamp(b,0,360);d=e.clamp(d/100,0,1);f=e.clamp(f/100,0,1);if(0===d)g.r=f,g.g=f,g.b=f;else{j/=60;b=Math.floor(j);l=j-b,j=f*(1-d),n=f*(1-d*l);d=f*(1-d*(1-l));switch(b){case 0:g.r=f;g.g=d;g.b=j;break;case 1:g.r=n;g.g=f;g.b=j;break;case 2:g.r=j;g.g=f;g.b=d;break;case 3:g.r=j;g.g=n;g.b=f;break;case 4:g.r=d;g.g=j;g.b=f;break;default:g.r=f,g.g=j,g.b=n;}}g.a=1;},e.clamp=function(b,d,e){y4tt.q9();return Math.min(Math.max(b,d),e);},e.prototype.clone=function(){y4tt.v9();return b.SerializationHelper.Clone(function(){return new e();},this);},e.prototype.serialize=function(){return b.SerializationHelper.Serialize(this);},e.Parse=function(c){return b.SerializationHelper.Parse(function(){y4tt.v9();return new e();},c,null,null);},__decorate([b.serialize()],e.prototype,"_globalHue",void 0),__decorate([b.serialize()],e.prototype,"_globalDensity",void 0),__decorate([b.serialize()],e.prototype,"_globalSaturation",void 0),__decorate([b.serialize()],e.prototype,"_globalExposure",void 0),__decorate([b.serialize()],e.prototype,"_highlightsHue",void 0),__decorate([b.serialize()],e.prototype,"_highlightsDensity",void 0),__decorate([b.serialize()],e.prototype,"_highlightsSaturation",void 0),__decorate([b.serialize()],e.prototype,"_highlightsExposure",void 0),__decorate([b.serialize()],e.prototype,"_midtonesHue",void 0),__decorate([b.serialize()],e.prototype,"_midtonesDensity",void 0),__decorate([b.serialize()],e.prototype,"_midtonesSaturation",void 0),__decorate([b.serialize()],e.prototype,"_midtonesExposure",void 0),e);b.ColorCurves=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c;e=b.BaseTexture,c=function(c,f){e.call(this,f);c&&(this._textureMatrix=b.Matrix.Identity(),this.name=c,this.url=c,this.hasAlpha=!1,this.isCube=!1,this.wrapU=b.Texture.CLAMP_ADDRESSMODE,this.wrapV=b.Texture.CLAMP_ADDRESSMODE,this.anisotropicFilteringLevel=1,this._texture=this._getFromCache(c,!0),this._texture||(f.useDelayedTextureLoading?this.delayLoadState=b.Engine.DELAYLOADSTATE_NOTLOADED:this.loadTexture()));};g=(__extends(c,e),c.prototype.getTextureMatrix=function(){return this._textureMatrix;},c.prototype.load3dlTexture=function(){var d,e;d=this,e=this.getScene().getEngine().createRawTexture(null,1,1,b.Engine.TEXTUREFORMAT_RGBA,!1,!1,b.Texture.BILINEAR_SAMPLINGMODE);this._texture=e;return b.Tools.LoadFile(this.url,function(g){var j,l,n,y,x,z,t,B;g=g.split("\n");for(var m=0,p=0,r=0,s=0,t=0,v=0;v<g.length;v++)if(n=g[v],c._noneEmptyLineRegex.test(n)&&0!==n.indexOf("#")){y=n.split(" ");if(0!==m){if(0!=m){x=Math.max(parseInt(y[0]),0),z=Math.max(parseInt(y[1]),0),y=Math.max(parseInt(y[2]),0),t=Math.max(x,t),t=Math.max(z,t),t=Math.max(y,t),B=4*(p+s*m+r*m*m);l[B+0]=x;l[B+1]=z;l[B+2]=y;l[B+3]=0;s++;0==s%m&&(r++,s=0,0==r%m&&(p++,r=0));}}else m=y.length,j=new Uint8Array(4*m*m*m),l=new Float32Array(4*m*m*m);}for(v=0;v<l.length;v++)j[v]=255*(l[v]/t);d.getScene().getEngine().updateTextureSize(e,m*m,m);d.getScene().getEngine().updateRawTexture(e,j,b.Engine.TEXTUREFORMAT_RGBA,!1);}),this._texture;},c.prototype.loadTexture=function(){y4tt.q9();this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture();},c.prototype.clone=function(){var b;b=new c(this.url,this.getScene());return b.level=this.level,b;},c.prototype.delayLoad=function(){this.delayLoadState===b.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=b.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture());},c.Parse=function(c,e){var g;g=null;y4tt.q9();return c.name&&!c.isRenderTarget&&(g=new b.ColorGradingTexture(c.name,e),g.name=c.name,g.level=c.level),g;},c.prototype.serialize=function(){var b;if(!this.name)return null;y4tt.v9();b={};return b.name=this.name,b.level=this.level,b;},c._noneEmptyLineRegex=/\S+/,c);b.ColorGradingTexture=g;}(BABYLON||(BABYLON={}));!function(b){var g,e,c,d,f;e=b.MaterialDefines,c=function(){e.call(this);this.VERTEXALPHA=this.VERTEXCOLOR=this.UV2=this.UV1=this.NORMAL=this.FRESNEL=this.EMISSIVEFRESNEL=this.OPACITYFRESNEL=this.SPECULARTERM=this.FOG=this.POINTSIZE=this.ALPHAFROMALBEDO=this.ALPHATEST=this.CLIPPLANE=this.SPECULAROVERALPHA=this.PARALLAXOCCLUSION=this.PARALLAX=this.BUMP=this.REFLECTIVITY=this.EMISSIVE=this.REFLECTION=this.OPACITYRGB=this.OPACITY=this.AMBIENT=this.ALBEDO=!1;y4tt.v9();this.BonesPerMesh=this.NUM_BONE_INFLUENCERS=0;this.INVERTNORMALMAPY=this.INVERTNORMALMAPX=this.OPENGLNORMALMAP=this.USEPMREMREFRACTION=this.USEPMREMREFLECTION=this.RADIANCEOVERALPHA=this.USEPHYSICALLIGHTFALLOFF=this.LODBASEDMICROSFURACE=this.REFRACTIONMAPINLINEARSPACE=this.LINKREFRACTIONTOTRANSPARENCY=this.REFRACTIONMAP_3D=this.REFRACTION=this.USESPHERICALFROMREFLECTIONMAP=this.OVERLOADEDSHADOWVALUES=this.OVERLOADEDVALUES=this.CAMERACOLORCURVES=this.CAMERACOLORGRADING=this.CAMERACONTRAST=this.CAMERATONEMAP=this.LOGARITHMICDEPTH=this.INVERTCUBICMAP=this.REFLECTIONMAP_EQUIRECTANGULAR=this.REFLECTIONMAP_EXPLICIT=this.REFLECTIONMAP_SKYBOX=this.REFLECTIONMAP_PROJECTION=this.REFLECTIONMAP_CUBIC=this.REFLECTIONMAP_PLANAR=this.REFLECTIONMAP_SPHERICAL=this.REFLECTIONMAP_3D=this.USELIGHTMAPASSHADOWMAP=this.LIGHTMAP=this.LINKEMISSIVEWITHALBEDO=this.EMISSIVEASILLUMINATION=this.MICROSURFACEAUTOMATIC=this.MICROSURFACEFROMREFLECTIVITYMAP=this.INSTANCES=!1;this.rebuild();};g=(__extends(c,e),c);d=b.Material,f=function(c,e){var f;f=this;d.call(this,c,e);this.specularIntensity=this.environmentIntensity=this.emissiveIntensity=this.directIntensity=1;this._lightingInfos=new b.Vector4(this.directIntensity,this.emissiveIntensity,this.environmentIntensity,this.specularIntensity);this.disableBumpMap=!1;this.overloadedShadeIntensity=this.overloadedShadowIntensity=1;this._overloadedShadowInfos=new b.Vector4(this.overloadedShadowIntensity,this.overloadedShadeIntensity,0,0);this.cameraContrast=this.cameraExposure=1;this.cameraColorGradingTexture=null;this._cameraColorGradingScaleOffset=new b.Vector4(1,1,0,0);this._cameraColorGradingInfos=new b.Vector4(1,1,0,0);this.cameraColorCurves=null;this._cameraInfos=new b.Vector4(1,1,0,0);this._microsurfaceTextureLods=new b.Vector2(0,0);this.overloadedAmbient=b.Color3.White();this.overloadedAmbientIntensity=0;this.overloadedAlbedo=b.Color3.White();this.overloadedAlbedoIntensity=0;this.overloadedReflectivity=new b.Color3(0.3,0.3,0.3);this.overloadedReflectivityIntensity=0;this.overloadedEmissive=b.Color3.White();this.overloadedEmissiveIntensity=0;this._overloadedIntensity=new b.Vector4(this.overloadedAmbientIntensity,this.overloadedAlbedoIntensity,this.overloadedReflectivityIntensity,this.overloadedEmissiveIntensity);this.overloadedReflection=b.Color3.White();this.overloadedMicroSurfaceIntensity=this.overloadedMicroSurface=this.overloadedReflectionIntensity=0;this._overloadedMicroSurface=new b.Vector3(this.overloadedMicroSurface,this.overloadedMicroSurfaceIntensity,this.overloadedReflectionIntensity);this.ambientColor=new b.Color3(0,0,0);this.albedoColor=new b.Color3(1,1,1);y4tt.q9();this.reflectivityColor=new b.Color3(1,1,1);this.reflectionColor=new b.Color3(0.5,0.5,0.5);this.emissiveColor=new b.Color3(0,0,0);this.microSurface=0.9;this.indexOfRefraction=0.66;this.useAlphaFromAlbedoTexture=this.useEmissiveAsIllumination=this.useLightmapAsShadowmap=this.linkEmissiveWithAlbedo=this.linkRefractionWithTransparency=this.invertRefractionY=!1;this.useSpecularOverAlpha=!0;this.useScalarInLinearSpace=this.useAutoMicroSurfaceFromReflectivityMap=this.useMicroSurfaceFromReflectivityMapAlpha=!1;this.useRadianceOverAlpha=this.usePhysicalLightFalloff=!0;this.useParallaxOcclusion=this.useParallax=!1;this.parallaxScaleBias=0.05;this.disableLighting=!1;this.maxSimultaneousLights=4;this.invertNormalMapY=this.invertNormalMapX=!1;this._renderTargets=new b.SmartArray(16);this._worldViewProjectionMatrix=b.Matrix.Zero();this._globalAmbientColor=new b.Color3(0,0,0);this._tempColor=new b.Color3();this._defines=new g();this._cachedDefines=new g();this._myShadowGenerator=this._myScene=null;this._cachedDefines.BonesPerMesh=-1;this.getRenderTargetTextures=function(){return f._renderTargets.reset(),f.reflectionTexture&&f.reflectionTexture.isRenderTarget&&f._renderTargets.push(f.reflectionTexture),f.refractionTexture&&f.refractionTexture.isRenderTarget&&f._renderTargets.push(f.refractionTexture),f._renderTargets;};},c=(__extends(f,d),Object.defineProperty(f.prototype,"useLogarithmicDepth",{get:function(){y4tt.v9();return this._useLogarithmicDepth;},set:function(b){this._useLogarithmicDepth=b&&this.getScene().getEngine().getCaps().fragmentDepthSupported;},enumerable:!0,configurable:!0}),f.prototype.needAlphaBlending=function(){y4tt.v9();return this.linkRefractionWithTransparency?!1:1>this.alpha||null!=this.opacityTexture||this._shouldUseAlphaFromAlbedoTexture()||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled;},f.prototype.needAlphaTesting=function(){return this.linkRefractionWithTransparency?!1:null!=this.albedoTexture&&this.albedoTexture.hasAlpha;},f.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this.albedoTexture&&this.albedoTexture.hasAlpha&&this.useAlphaFromAlbedoTexture;},f.prototype.getAlphaTestTexture=function(){y4tt.v9();return this.albedoTexture;},f.prototype._checkCache=function(b,c,d){return c?this._defines.INSTANCES!==d?!1:!(!c._materialDefines||!c._materialDefines.isEqual(this._defines)):!0;},f.prototype.convertColorToLinearSpaceToRef=function(b,c){f.convertColorToLinearSpaceToRef(b,c,this.useScalarInLinearSpace);},f.convertColorToLinearSpaceToRef=function(b,c,d){y4tt.v9();d?(c.r=b.r,c.g=b.g,c.b=b.b):b.toLinearSpaceToRef(c);},f.BindLights=function(c,d,e,g,m,p,r){var y;for(var s=0,t=!1,v=0;v<c.lights.length;v++){y=c.lights[v];if(y.isEnabled()&&y.canAffectMesh(d)&&(b.MaterialHelper.BindLightProperties(y,e,s),this.convertColorToLinearSpaceToRef(y.diffuse,f._scaledAlbedo,m),f._scaledAlbedo.scaleToRef(y.intensity,f._scaledAlbedo),e.setColor4("vLightDiffuse"+s,f._scaledAlbedo,r?y.radius:y.range),g.SPECULARTERM&&(this.convertColorToLinearSpaceToRef(y.specular,f._scaledReflectivity,m),f._scaledReflectivity.scaleToRef(y.intensity,f._scaledReflectivity),e.setColor3("vLightSpecular"+s,f._scaledReflectivity)),c.shadowsEnabled&&(t=b.MaterialHelper.BindLightShadow(y,c,d,s,e,t)),s++,s===p))break;}},f.prototype.isReady=function(c,d){var e,f,m,p,r,s,t;if(this.checkReadyOnlyOnce&&this._wasPreviouslyReady)return!0;e=this.getScene();if(!this.checkReadyOnEveryCall&&this._renderId===e.getRenderId()&&this._checkCache(e,c,d))return!0;f=e.getEngine(),m=!1,p=!1;if(this._defines.reset(),e.texturesEnabled){if(e.texturesEnabled){if(e.getEngine().getCaps().textureLOD&&(this._defines.LODBASEDMICROSFURACE=!0),this.albedoTexture&&b.StandardMaterial.DiffuseTextureEnabled){if(!this.albedoTexture.isReady())return!1;p=!0;this._defines.ALBEDO=!0;}if(this.ambientTexture&&b.StandardMaterial.AmbientTextureEnabled){if(!this.ambientTexture.isReady())return!1;p=!0;this._defines.AMBIENT=!0;}if(this.opacityTexture&&b.StandardMaterial.OpacityTextureEnabled){if(!this.opacityTexture.isReady())return!1;p=!0;this._defines.OPACITY=!0;this.opacityTexture.getAlphaFromRGB&&(this._defines.OPACITYRGB=!0);}if(this.reflectionTexture&&b.StandardMaterial.ReflectionTextureEnabled){if(!this.reflectionTexture.isReady())return!1;switch(m=!0,this._defines.REFLECTION=!0,this.reflectionTexture.coordinatesMode===b.Texture.INVCUBIC_MODE&&(this._defines.INVERTCUBICMAP=!0),this._defines.REFLECTIONMAP_3D=this.reflectionTexture.isCube,this.reflectionTexture.coordinatesMode){case b.Texture.CUBIC_MODE:case b.Texture.INVCUBIC_MODE:this._defines.REFLECTIONMAP_CUBIC=!0;break;case b.Texture.EXPLICIT_MODE:this._defines.REFLECTIONMAP_EXPLICIT=!0;break;case b.Texture.PLANAR_MODE:this._defines.REFLECTIONMAP_PLANAR=!0;break;case b.Texture.PROJECTION_MODE:this._defines.REFLECTIONMAP_PROJECTION=!0;break;case b.Texture.SKYBOX_MODE:this._defines.REFLECTIONMAP_SKYBOX=!0;break;case b.Texture.SPHERICAL_MODE:this._defines.REFLECTIONMAP_SPHERICAL=!0;break;case b.Texture.EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR=!0;}this.reflectionTexture instanceof b.HDRCubeTexture&&this.reflectionTexture&&(this._defines.USESPHERICALFROMREFLECTIONMAP=!0,m=!0,this.reflectionTexture.isPMREM&&(this._defines.USEPMREMREFLECTION=!0));}if(this.lightmapTexture&&b.StandardMaterial.LightmapTextureEnabled){if(!this.lightmapTexture.isReady())return!1;p=!0;this._defines.LIGHTMAP=!0;this._defines.USELIGHTMAPASSHADOWMAP=this.useLightmapAsShadowmap;}if(this.emissiveTexture&&b.StandardMaterial.EmissiveTextureEnabled){if(!this.emissiveTexture.isReady())return!1;p=!0;this._defines.EMISSIVE=!0;}if(this.reflectivityTexture&&b.StandardMaterial.SpecularTextureEnabled){if(!this.reflectivityTexture.isReady())return!1;p=!0;this._defines.REFLECTIVITY=!0;this._defines.MICROSURFACEFROMREFLECTIVITYMAP=this.useMicroSurfaceFromReflectivityMapAlpha;this._defines.MICROSURFACEAUTOMATIC=this.useAutoMicroSurfaceFromReflectivityMap;}}if(e.getEngine().getCaps().standardDerivatives&&this.bumpTexture&&b.StandardMaterial.BumpTextureEnabled&&!this.disableBumpMap){if(!this.bumpTexture.isReady())return!1;p=!0;this._defines.BUMP=!0;this.useParallax&&(this._defines.PARALLAX=!0,this.useParallaxOcclusion&&(this._defines.PARALLAXOCCLUSION=!0));this.invertNormalMapX&&(this._defines.INVERTNORMALMAPX=!0);this.invertNormalMapY&&(this._defines.INVERTNORMALMAPY=!0);}if(this.refractionTexture&&b.StandardMaterial.RefractionTextureEnabled){if(!this.refractionTexture.isReady())return!1;p=!0;this._defines.REFRACTION=!0;this._defines.REFRACTIONMAP_3D=this.refractionTexture.isCube;this.linkRefractionWithTransparency&&(this._defines.LINKREFRACTIONTOTRANSPARENCY=!0);this.refractionTexture instanceof b.HDRCubeTexture&&(this._defines.REFRACTIONMAPINLINEARSPACE=!0,this.refractionTexture.isPMREM&&(this._defines.USEPMREMREFRACTION=!0));}if(this.cameraColorGradingTexture){if(!this.cameraColorGradingTexture.isReady())return!1;this._defines.CAMERACOLORGRADING=!0;}}if(e.clipPlane&&(this._defines.CLIPPLANE=!0),f.getAlphaTesting()&&(this._defines.ALPHATEST=!0),this._shouldUseAlphaFromAlbedoTexture()&&(this._defines.ALPHAFROMALBEDO=!0),this.useEmissiveAsIllumination&&(this._defines.EMISSIVEASILLUMINATION=!0),this.linkEmissiveWithAlbedo&&(this._defines.LINKEMISSIVEWITHALBEDO=!0),this.useLogarithmicDepth&&(this._defines.LOGARITHMICDEPTH=!0),1!=this.cameraContrast&&(this._defines.CAMERACONTRAST=!0),1!=this.cameraExposure&&(this._defines.CAMERATONEMAP=!0),this.cameraColorCurves&&(this._defines.CAMERACOLORCURVES=!0),1==this.overloadedShadeIntensity&&1==this.overloadedShadowIntensity||(this._defines.OVERLOADEDSHADOWVALUES=!0),(0<this.overloadedMicroSurfaceIntensity||0<this.overloadedEmissiveIntensity||0<this.overloadedReflectivityIntensity||0<this.overloadedAlbedoIntensity||0<this.overloadedAmbientIntensity||0<this.overloadedReflectionIntensity)&&(this._defines.OVERLOADEDVALUES=!0),(this.pointsCloud||e.forcePointsCloud)&&(this._defines.POINTSIZE=!0),e.fogEnabled&&c&&c.applyFog&&e.fogMode!==b.Scene.FOGMODE_NONE&&this.fogEnabled&&(this._defines.FOG=!0),e.lightsEnabled&&!this.disableLighting&&(m=b.MaterialHelper.PrepareDefinesForLights(e,c,this._defines,this.maxSimultaneousLights)||m),b.StandardMaterial.FresnelEnabled&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled||this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled)&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&(this._defines.OPACITYFRESNEL=!0),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._defines.EMISSIVEFRESNEL=!0),m=!0,this._defines.FRESNEL=!0),this._defines.SPECULARTERM&&this.useSpecularOverAlpha&&(this._defines.SPECULAROVERALPHA=!0),this.usePhysicalLightFalloff&&(this._defines.USEPHYSICALLIGHTFALLOFF=!0),this.useRadianceOverAlpha&&(this._defines.RADIANCEOVERALPHA=!0),c&&(m&&c.isVerticesDataPresent(b.VertexBuffer.NormalKind)&&(this._defines.NORMAL=!0),p&&(c.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(this._defines.UV1=!0),c.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(this._defines.UV2=!0)),c.useVertexColors&&c.isVerticesDataPresent(b.VertexBuffer.ColorKind)&&(this._defines.VERTEXCOLOR=!0,c.hasVertexAlpha&&(this._defines.VERTEXALPHA=!0)),c.useBones&&c.computeBonesUsingShaders&&(this._defines.NUM_BONE_INFLUENCERS=c.numBoneInfluencers,this._defines.BonesPerMesh=c.skeleton.bones.length+1),d&&(this._defines.INSTANCES=!0)),!this._defines.isEqual(this._cachedDefines)){this._defines.cloneTo(this._cachedDefines);e.resetCachedMaterial();f=new b.EffectFallbacks();this._defines.REFLECTION&&f.addFallback(0,"REFLECTION");this._defines.REFRACTION&&f.addFallback(0,"REFRACTION");this._defines.REFLECTIVITY&&f.addFallback(0,"REFLECTIVITY");this._defines.BUMP&&f.addFallback(0,"BUMP");this._defines.PARALLAX&&f.addFallback(1,"PARALLAX");this._defines.PARALLAXOCCLUSION&&f.addFallback(0,"PARALLAXOCCLUSION");this._defines.SPECULAROVERALPHA&&f.addFallback(0,"SPECULAROVERALPHA");this._defines.FOG&&f.addFallback(1,"FOG");this._defines.POINTSIZE&&f.addFallback(0,"POINTSIZE");this._defines.LOGARITHMICDEPTH&&f.addFallback(0,"LOGARITHMICDEPTH");b.MaterialHelper.HandleFallbacksForShadows(this._defines,f,this.maxSimultaneousLights);this._defines.SPECULARTERM&&f.addFallback(0,"SPECULARTERM");this._defines.OPACITYFRESNEL&&f.addFallback(1,"OPACITYFRESNEL");this._defines.EMISSIVEFRESNEL&&f.addFallback(2,"EMISSIVEFRESNEL");this._defines.FRESNEL&&f.addFallback(3,"FRESNEL");0<this._defines.NUM_BONE_INFLUENCERS&&f.addCPUSkinningFallback(0,c);m=[b.VertexBuffer.PositionKind];this._defines.NORMAL&&m.push(b.VertexBuffer.NormalKind);this._defines.UV1&&m.push(b.VertexBuffer.UVKind);this._defines.UV2&&m.push(b.VertexBuffer.UV2Kind);this._defines.VERTEXCOLOR&&m.push(b.VertexBuffer.ColorKind);b.MaterialHelper.PrepareAttributesForBones(m,c,this._defines,f);b.MaterialHelper.PrepareAttributesForInstances(m,this._defines);p="pbr";e.getEngine().getCaps().standardDerivatives||(p="legacypbr");r=this._defines.toString(),s="world view viewProjection vEyePosition vLightsType vAmbientColor vAlbedoColor vReflectivityColor vEmissiveColor vReflectionColor vFogInfos vFogColor pointSize vAlbedoInfos vAmbientInfos vOpacityInfos vReflectionInfos vEmissiveInfos vReflectivityInfos vBumpInfos vLightmapInfos vRefractionInfos mBones vClipPlane albedoMatrix ambientMatrix opacityMatrix reflectionMatrix emissiveMatrix reflectivityMatrix bumpMatrix lightmapMatrix refractionMatrix depthValues opacityParts emissiveLeftColor emissiveRightColor vLightingIntensity vOverloadedShadowIntensity vOverloadedIntensity vOverloadedAlbedo vOverloadedReflection vOverloadedReflectivity vOverloadedEmissive vOverloadedMicroSurface logarithmicDepthConstant vSphericalX vSphericalY vSphericalZ vSphericalXX vSphericalYY vSphericalZZ vSphericalXY vSphericalYZ vSphericalZX vMicrosurfaceTextureLods vCameraInfos vCameraColorGradingInfos vCameraColorGradingScaleOffset".split(" "),t="albedoSampler ambientSampler opacitySampler reflectionCubeSampler reflection2DSampler emissiveSampler reflectivitySampler bumpSampler lightmapSampler refractionCubeSampler refraction2DSampler cameraColorGrading2DSampler".split(" ");b.ColorCurves.PrepareUniforms(s);b.MaterialHelper.PrepareUniformsAndSamplersList(s,t,this._defines,this.maxSimultaneousLights);this._effect=e.getEngine().createEffect(p,m,s,t,r,f,this.onCompiled,this.onError,{maxSimultaneousLights:this.maxSimultaneousLights});}return this._effect.isReady()?(this._renderId=e.getRenderId(),this._wasPreviouslyReady=!0,c&&(c._materialDefines||(c._materialDefines=new g()),this._defines.cloneTo(c._materialDefines)),!0):!1;},f.prototype.unbind=function(){this.reflectionTexture&&this.reflectionTexture.isRenderTarget&&this._effect.setTexture("reflection2DSampler",null);this.refractionTexture&&this.refractionTexture.isRenderTarget&&this._effect.setTexture("refraction2DSampler",null);y4tt.v9();d.prototype.unbind.call(this);},f.prototype.bindOnlyWorldMatrix=function(b){this._effect.setMatrix("world",b);},f.prototype.bind=function(c,e){var g,n;if(this._myScene=this.getScene(),this.bindOnlyWorldMatrix(c),b.MaterialHelper.BindBonesParameters(e,this._effect),this._myScene.getCachedMaterial()!==this){if(this._effect.setMatrix("viewProjection",this._myScene.getTransformMatrix()),b.StandardMaterial.FresnelEnabled&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._effect.setColor4("opacityParts",new b.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._effect.setColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._effect.setColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),this._myScene.texturesEnabled){if(this.albedoTexture&&b.StandardMaterial.DiffuseTextureEnabled&&(this._effect.setTexture("albedoSampler",this.albedoTexture),this._effect.setFloat2("vAlbedoInfos",this.albedoTexture.coordinatesIndex,this.albedoTexture.level),this._effect.setMatrix("albedoMatrix",this.albedoTexture.getTextureMatrix())),this.ambientTexture&&b.StandardMaterial.AmbientTextureEnabled&&(this._effect.setTexture("ambientSampler",this.ambientTexture),this._effect.setFloat2("vAmbientInfos",this.ambientTexture.coordinatesIndex,this.ambientTexture.level),this._effect.setMatrix("ambientMatrix",this.ambientTexture.getTextureMatrix())),this.opacityTexture&&b.StandardMaterial.OpacityTextureEnabled&&(this._effect.setTexture("opacitySampler",this.opacityTexture),this._effect.setFloat2("vOpacityInfos",this.opacityTexture.coordinatesIndex,this.opacityTexture.level),this._effect.setMatrix("opacityMatrix",this.opacityTexture.getTextureMatrix())),this.reflectionTexture&&b.StandardMaterial.ReflectionTextureEnabled&&(this._microsurfaceTextureLods.x=Math.round(Math.log(this.reflectionTexture.getSize().width)*Math.LOG2E),this.reflectionTexture.isCube?this._effect.setTexture("reflectionCubeSampler",this.reflectionTexture):this._effect.setTexture("reflection2DSampler",this.reflectionTexture),this._effect.setMatrix("reflectionMatrix",this.reflectionTexture.getReflectionTextureMatrix()),this._effect.setFloat2("vReflectionInfos",this.reflectionTexture.level,0),this._defines.USESPHERICALFROMREFLECTIONMAP&&(this._effect.setFloat3("vSphericalX",this.reflectionTexture.sphericalPolynomial.x.x,this.reflectionTexture.sphericalPolynomial.x.y,this.reflectionTexture.sphericalPolynomial.x.z),this._effect.setFloat3("vSphericalY",this.reflectionTexture.sphericalPolynomial.y.x,this.reflectionTexture.sphericalPolynomial.y.y,this.reflectionTexture.sphericalPolynomial.y.z),this._effect.setFloat3("vSphericalZ",this.reflectionTexture.sphericalPolynomial.z.x,this.reflectionTexture.sphericalPolynomial.z.y,this.reflectionTexture.sphericalPolynomial.z.z),this._effect.setFloat3("vSphericalXX",this.reflectionTexture.sphericalPolynomial.xx.x,this.reflectionTexture.sphericalPolynomial.xx.y,this.reflectionTexture.sphericalPolynomial.xx.z),this._effect.setFloat3("vSphericalYY",this.reflectionTexture.sphericalPolynomial.yy.x,this.reflectionTexture.sphericalPolynomial.yy.y,this.reflectionTexture.sphericalPolynomial.yy.z),this._effect.setFloat3("vSphericalZZ",this.reflectionTexture.sphericalPolynomial.zz.x,this.reflectionTexture.sphericalPolynomial.zz.y,this.reflectionTexture.sphericalPolynomial.zz.z),this._effect.setFloat3("vSphericalXY",this.reflectionTexture.sphericalPolynomial.xy.x,this.reflectionTexture.sphericalPolynomial.xy.y,this.reflectionTexture.sphericalPolynomial.xy.z),this._effect.setFloat3("vSphericalYZ",this.reflectionTexture.sphericalPolynomial.yz.x,this.reflectionTexture.sphericalPolynomial.yz.y,this.reflectionTexture.sphericalPolynomial.yz.z),this._effect.setFloat3("vSphericalZX",this.reflectionTexture.sphericalPolynomial.zx.x,this.reflectionTexture.sphericalPolynomial.zx.y,this.reflectionTexture.sphericalPolynomial.zx.z))),this.emissiveTexture&&b.StandardMaterial.EmissiveTextureEnabled&&(this._effect.setTexture("emissiveSampler",this.emissiveTexture),this._effect.setFloat2("vEmissiveInfos",this.emissiveTexture.coordinatesIndex,this.emissiveTexture.level),this._effect.setMatrix("emissiveMatrix",this.emissiveTexture.getTextureMatrix())),this.lightmapTexture&&b.StandardMaterial.LightmapTextureEnabled&&(this._effect.setTexture("lightmapSampler",this.lightmapTexture),this._effect.setFloat2("vLightmapInfos",this.lightmapTexture.coordinatesIndex,this.lightmapTexture.level),this._effect.setMatrix("lightmapMatrix",this.lightmapTexture.getTextureMatrix())),this.reflectivityTexture&&b.StandardMaterial.SpecularTextureEnabled&&(this._effect.setTexture("reflectivitySampler",this.reflectivityTexture),this._effect.setFloat2("vReflectivityInfos",this.reflectivityTexture.coordinatesIndex,this.reflectivityTexture.level),this._effect.setMatrix("reflectivityMatrix",this.reflectivityTexture.getTextureMatrix())),this.bumpTexture&&this._myScene.getEngine().getCaps().standardDerivatives&&b.StandardMaterial.BumpTextureEnabled&&!this.disableBumpMap&&(this._effect.setTexture("bumpSampler",this.bumpTexture),this._effect.setFloat3("vBumpInfos",this.bumpTexture.coordinatesIndex,1/this.bumpTexture.level,this.parallaxScaleBias),this._effect.setMatrix("bumpMatrix",this.bumpTexture.getTextureMatrix())),this.refractionTexture&&b.StandardMaterial.RefractionTextureEnabled){this._microsurfaceTextureLods.y=Math.round(Math.log(this.refractionTexture.getSize().width)*Math.LOG2E);g=1;this.refractionTexture.isCube?this._effect.setTexture("refractionCubeSampler",this.refractionTexture):(this._effect.setTexture("refraction2DSampler",this.refractionTexture),this._effect.setMatrix("refractionMatrix",this.refractionTexture.getReflectionTextureMatrix()),this.refractionTexture.depth&&(g=this.refractionTexture.depth));this._effect.setFloat4("vRefractionInfos",this.refractionTexture.level,this.indexOfRefraction,g,this.invertRefractionY?-1:1);}if((this.reflectionTexture||this.refractionTexture)&&this._effect.setFloat2("vMicrosurfaceTextureLods",this._microsurfaceTextureLods.x,this._microsurfaceTextureLods.y),this.cameraColorGradingTexture){this._effect.setTexture("cameraColorGrading2DSampler",this.cameraColorGradingTexture);this._cameraColorGradingInfos.x=this.cameraColorGradingTexture.level;this._cameraColorGradingInfos.y=this.cameraColorGradingTexture.getSize().height;this._cameraColorGradingInfos.z=this._cameraColorGradingInfos.y-1;this._cameraColorGradingInfos.w=1/this._cameraColorGradingInfos.y;this._effect.setFloat4("vCameraColorGradingInfos",this._cameraColorGradingInfos.x,this._cameraColorGradingInfos.y,this._cameraColorGradingInfos.z,this._cameraColorGradingInfos.w);g=this._cameraColorGradingInfos.w/this._cameraColorGradingInfos.y,n=1/this._cameraColorGradingInfos.y;this._cameraColorGradingScaleOffset.x=this._cameraColorGradingInfos.z*g;this._cameraColorGradingScaleOffset.y=this._cameraColorGradingInfos.z/this._cameraColorGradingInfos.y;this._cameraColorGradingScaleOffset.z=0.5*g;this._cameraColorGradingScaleOffset.w=0.5*n;this._effect.setFloat4("vCameraColorGradingScaleOffset",this._cameraColorGradingScaleOffset.x,this._cameraColorGradingScaleOffset.y,this._cameraColorGradingScaleOffset.z,this._cameraColorGradingScaleOffset.w);}}b.MaterialHelper.BindClipPlane(this._effect,this._myScene);this.pointsCloud&&this._effect.setFloat("pointSize",this.pointSize);this._myScene.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor);this.convertColorToLinearSpaceToRef(this.reflectivityColor,f._scaledReflectivity);this._effect.setVector3("vEyePosition",this._myScene._mirroredCameraPosition?this._myScene._mirroredCameraPosition:this._myScene.activeCamera.position);this._effect.setColor3("vAmbientColor",this._globalAmbientColor);this._effect.setColor4("vReflectivityColor",f._scaledReflectivity,this.microSurface);this.convertColorToLinearSpaceToRef(this.emissiveColor,f._scaledEmissive);this._effect.setColor3("vEmissiveColor",f._scaledEmissive);this.convertColorToLinearSpaceToRef(this.reflectionColor,f._scaledReflection);this._effect.setColor3("vReflectionColor",f._scaledReflection);}this._myScene.getCachedMaterial()===this&&this.isFrozen||(this.convertColorToLinearSpaceToRef(this.albedoColor,f._scaledAlbedo),this._effect.setColor4("vAlbedoColor",f._scaledAlbedo,this.alpha*e.visibility),this._myScene.lightsEnabled&&!this.disableLighting&&f.BindLights(this._myScene,e,this._effect,this._defines,this.useScalarInLinearSpace,this.maxSimultaneousLights,this.usePhysicalLightFalloff),(this._myScene.fogEnabled&&e.applyFog&&this._myScene.fogMode!==b.Scene.FOGMODE_NONE||this.reflectionTexture)&&this._effect.setMatrix("view",this._myScene.getViewMatrix()),b.MaterialHelper.BindFogParameters(this._myScene,e,this._effect),this._lightingInfos.x=this.directIntensity,this._lightingInfos.y=this.emissiveIntensity,this._lightingInfos.z=this.environmentIntensity,this._lightingInfos.w=this.specularIntensity,this._effect.setVector4("vLightingIntensity",this._lightingInfos),this._overloadedShadowInfos.x=this.overloadedShadowIntensity,this._overloadedShadowInfos.y=this.overloadedShadeIntensity,this._effect.setVector4("vOverloadedShadowIntensity",this._overloadedShadowInfos),this._cameraInfos.x=this.cameraExposure,this._cameraInfos.y=this.cameraContrast,this._effect.setVector4("vCameraInfos",this._cameraInfos),this.cameraColorCurves&&b.ColorCurves.Bind(this.cameraColorCurves,this._effect),this._overloadedIntensity.x=this.overloadedAmbientIntensity,this._overloadedIntensity.y=this.overloadedAlbedoIntensity,this._overloadedIntensity.z=this.overloadedReflectivityIntensity,this._overloadedIntensity.w=this.overloadedEmissiveIntensity,this._effect.setVector4("vOverloadedIntensity",this._overloadedIntensity),this.convertColorToLinearSpaceToRef(this.overloadedAmbient,this._tempColor),this._effect.setColor3("vOverloadedAmbient",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedAlbedo,this._tempColor),this._effect.setColor3("vOverloadedAlbedo",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedReflectivity,this._tempColor),this._effect.setColor3("vOverloadedReflectivity",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedEmissive,this._tempColor),this._effect.setColor3("vOverloadedEmissive",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedReflection,this._tempColor),this._effect.setColor3("vOverloadedReflection",this._tempColor),this._overloadedMicroSurface.x=this.overloadedMicroSurface,this._overloadedMicroSurface.y=this.overloadedMicroSurfaceIntensity,this._overloadedMicroSurface.z=this.overloadedReflectionIntensity,this._effect.setVector3("vOverloadedMicroSurface",this._overloadedMicroSurface),b.MaterialHelper.BindLogDepth(this._defines,this._effect,this._myScene));y4tt.v9();d.prototype.bind.call(this,c,e);this._myScene=null;},f.prototype.getAnimatables=function(){var b;b=[];return this.albedoTexture&&this.albedoTexture.animations&&0<this.albedoTexture.animations.length&&b.push(this.albedoTexture),this.ambientTexture&&this.ambientTexture.animations&&0<this.ambientTexture.animations.length&&b.push(this.ambientTexture),this.opacityTexture&&this.opacityTexture.animations&&0<this.opacityTexture.animations.length&&b.push(this.opacityTexture),this.reflectionTexture&&this.reflectionTexture.animations&&0<this.reflectionTexture.animations.length&&b.push(this.reflectionTexture),this.emissiveTexture&&this.emissiveTexture.animations&&0<this.emissiveTexture.animations.length&&b.push(this.emissiveTexture),this.reflectivityTexture&&this.reflectivityTexture.animations&&0<this.reflectivityTexture.animations.length&&b.push(this.reflectivityTexture),this.bumpTexture&&this.bumpTexture.animations&&0<this.bumpTexture.animations.length&&b.push(this.bumpTexture),this.lightmapTexture&&this.lightmapTexture.animations&&0<this.lightmapTexture.animations.length&&b.push(this.lightmapTexture),this.refractionTexture&&this.refractionTexture.animations&&0<this.refractionTexture.animations.length&&b.push(this.refractionTexture),this.cameraColorGradingTexture&&this.cameraColorGradingTexture.animations&&0<this.cameraColorGradingTexture.animations.length&&b.push(this.cameraColorGradingTexture),b;},f.prototype.dispose=function(b,c){c&&(this.albedoTexture&&this.albedoTexture.dispose(),this.ambientTexture&&this.ambientTexture.dispose(),this.opacityTexture&&this.opacityTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose(),this.emissiveTexture&&this.emissiveTexture.dispose(),this.reflectivityTexture&&this.reflectivityTexture.dispose(),this.bumpTexture&&this.bumpTexture.dispose(),this.lightmapTexture&&this.lightmapTexture.dispose(),this.refractionTexture&&this.refractionTexture.dispose(),this.cameraColorGradingTexture&&this.cameraColorGradingTexture.dispose());d.prototype.dispose.call(this,b,c);},f.prototype.clone=function(c){var d;d=this;return b.SerializationHelper.Clone(function(){y4tt.q9();return new f(c,d.getScene());},this);},f.prototype.serialize=function(){var c;c=b.SerializationHelper.Serialize(this);return c.customType="BABYLON.PBRMaterial",c;},f.Parse=function(c,d,e){y4tt.v9();return b.SerializationHelper.Parse(function(){y4tt.q9();return new f(c.name,d);},c,d,e);},f._scaledAlbedo=new b.Color3(),f._scaledReflectivity=new b.Color3(),f._scaledEmissive=new b.Color3(),f._scaledReflection=new b.Color3(),__decorate([b.serialize()],f.prototype,"directIntensity",void 0),__decorate([b.serialize()],f.prototype,"emissiveIntensity",void 0),__decorate([b.serialize()],f.prototype,"environmentIntensity",void 0),__decorate([b.serialize()],f.prototype,"specularIntensity",void 0),__decorate([b.serialize()],f.prototype,"disableBumpMap",void 0),__decorate([b.serialize()],f.prototype,"overloadedShadowIntensity",void 0),__decorate([b.serialize()],f.prototype,"overloadedShadeIntensity",void 0),__decorate([b.serialize()],f.prototype,"cameraExposure",void 0),__decorate([b.serialize()],f.prototype,"cameraContrast",void 0),__decorate([b.serializeAsTexture()],f.prototype,"cameraColorGradingTexture",void 0),__decorate([b.serializeAsColorCurves()],f.prototype,"cameraColorCurves",void 0),__decorate([b.serializeAsColor3()],f.prototype,"overloadedAmbient",void 0),__decorate([b.serialize()],f.prototype,"overloadedAmbientIntensity",void 0),__decorate([b.serializeAsColor3()],f.prototype,"overloadedAlbedo",void 0),__decorate([b.serialize()],f.prototype,"overloadedAlbedoIntensity",void 0),__decorate([b.serializeAsColor3()],f.prototype,"overloadedReflectivity",void 0),__decorate([b.serialize()],f.prototype,"overloadedReflectivityIntensity",void 0),__decorate([b.serializeAsColor3()],f.prototype,"overloadedEmissive",void 0),__decorate([b.serialize()],f.prototype,"overloadedEmissiveIntensity",void 0),__decorate([b.serializeAsColor3()],f.prototype,"overloadedReflection",void 0),__decorate([b.serialize()],f.prototype,"overloadedReflectionIntensity",void 0),__decorate([b.serialize()],f.prototype,"overloadedMicroSurface",void 0),__decorate([b.serialize()],f.prototype,"overloadedMicroSurfaceIntensity",void 0),__decorate([b.serializeAsTexture()],f.prototype,"albedoTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"ambientTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"opacityTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"reflectionTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"emissiveTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"reflectivityTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"bumpTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"lightmapTexture",void 0),__decorate([b.serializeAsTexture()],f.prototype,"refractionTexture",void 0),__decorate([b.serializeAsColor3("ambient")],f.prototype,"ambientColor",void 0),__decorate([b.serializeAsColor3("albedo")],f.prototype,"albedoColor",void 0),__decorate([b.serializeAsColor3("reflectivity")],f.prototype,"reflectivityColor",void 0),__decorate([b.serializeAsColor3("reflection")],f.prototype,"reflectionColor",void 0),__decorate([b.serializeAsColor3("emissive")],f.prototype,"emissiveColor",void 0),__decorate([b.serialize()],f.prototype,"microSurface",void 0),__decorate([b.serialize()],f.prototype,"indexOfRefraction",void 0),__decorate([b.serialize()],f.prototype,"invertRefractionY",void 0),__decorate([b.serializeAsFresnelParameters()],f.prototype,"opacityFresnelParameters",void 0),__decorate([b.serializeAsFresnelParameters()],f.prototype,"emissiveFresnelParameters",void 0),__decorate([b.serialize()],f.prototype,"linkRefractionWithTransparency",void 0),__decorate([b.serialize()],f.prototype,"linkEmissiveWithAlbedo",void 0),__decorate([b.serialize()],f.prototype,"useLightmapAsShadowmap",void 0),__decorate([b.serialize()],f.prototype,"useEmissiveAsIllumination",void 0),__decorate([b.serialize()],f.prototype,"useAlphaFromAlbedoTexture",void 0),__decorate([b.serialize()],f.prototype,"useSpecularOverAlpha",void 0),__decorate([b.serialize()],f.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),__decorate([b.serialize()],f.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),__decorate([b.serialize()],f.prototype,"useScalarInLinearSpace",void 0),__decorate([b.serialize()],f.prototype,"usePhysicalLightFalloff",void 0),__decorate([b.serialize()],f.prototype,"useRadianceOverAlpha",void 0),__decorate([b.serialize()],f.prototype,"useParallax",void 0),__decorate([b.serialize()],f.prototype,"useParallaxOcclusion",void 0),__decorate([b.serialize()],f.prototype,"parallaxScaleBias",void 0),__decorate([b.serialize()],f.prototype,"disableLighting",void 0),__decorate([b.serialize()],f.prototype,"maxSimultaneousLights",void 0),__decorate([b.serialize()],f.prototype,"invertNormalMapX",void 0),__decorate([b.serialize()],f.prototype,"invertNormalMapY",void 0),__decorate([b.serialize()],f.prototype,"useLogarithmicDepth",null),f);b.PBRMaterial=c;}(BABYLON||(BABYLON={}));!function(b){var g;y4tt.v9();g=function(e){var c;c=this;this._transformationMatrix=b.Matrix.Identity();this._labelsEnabled=this._enabled=!1;this._displayStatistics=!0;this._displayLogs=this._displayTree=!1;this._skeletonViewers=[];this._identityMatrix=b.Matrix.Identity();this.axisRatio=0.02;this.accentColor="orange";this._scene=e;this._syncPositions=function(){var b,e;b=c._scene.getEngine(),e=b.getRenderingCanvasClientRect();c._showUI&&(c._statsDiv.style.left=e.width-410+"px",c._statsDiv.style.top=e.height-290+"px",c._statsDiv.style.width="400px",c._statsDiv.style.height="auto",c._statsSubsetDiv.style.maxHeight="240px",c._optionsDiv.style.left="0px",c._optionsDiv.style.top="10px",c._optionsDiv.style.width="200px",c._optionsDiv.style.height="auto",c._optionsSubsetDiv.style.maxHeight=e.height-225+"px",c._logDiv.style.left="0px",c._logDiv.style.top=e.height-170+"px",c._logDiv.style.width="600px",c._logDiv.style.height="160px",c._treeDiv.style.left=e.width-310+"px",c._treeDiv.style.top="10px",c._treeDiv.style.width="300px",c._treeDiv.style.height="auto",c._treeSubsetDiv.style.maxHeight=e.height-340+"px");c._globalDiv.style.left=e.left+"px";c._globalDiv.style.top=e.top+"px";c._drawingCanvas.style.left="0px";c._drawingCanvas.style.top="0px";c._drawingCanvas.style.width=b.getRenderWidth()+"px";c._drawingCanvas.style.height=b.getRenderHeight()+"px";e=c._drawingContext;c._ratio=(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1);c._drawingCanvas.width=b.getRenderWidth()*c._ratio;c._drawingCanvas.height=b.getRenderHeight()*c._ratio;};this._onCanvasClick=function(b){y4tt.v9();c._clickPosition={x:b.clientX*c._ratio,y:b.clientY*c._ratio};};this._syncUI=function(){c._showUI&&(c._displayStatistics?(c._displayStats(),c._statsDiv.style.display=""):c._statsDiv.style.display="none",c._displayLogs?c._logDiv.style.display="":c._logDiv.style.display="none",c._displayTree?(c._treeDiv.style.display="",c._needToRefreshMeshesTree&&(c._needToRefreshMeshesTree=!1,c._refreshMeshesTreeContent())):c._treeDiv.style.display="none");};this._syncData=function(){var d,e,g,j,l,n,m,p;if(c._labelsEnabled||!c._showUI){c._camera.getViewMatrix().multiplyToRef(c._camera.getProjectionMatrix(),c._transformationMatrix);c._drawingContext.clearRect(0,0,c._drawingCanvas.width,c._drawingCanvas.height);g=c._scene.getEngine(),j=c._camera.viewport.toGlobal(g.getRenderWidth(),g.getRenderHeight()),l=c._camera.getActiveMeshes();for(d=0;d<l.length;d++){n=l.data[d];e=n.getBoundingInfo().boundingSphere.center;e=b.Vector3.Project(e,n.getWorldMatrix(),c._transformationMatrix,j);(n.renderOverlay||c.shouldDisplayAxis&&c.shouldDisplayAxis(n))&&c._renderAxis(e,n,j);c.shouldDisplayLabel&&!c.shouldDisplayLabel(n)||c._renderLabel(n.name,e,12,function(){y4tt.v9();n.renderOverlay=!n.renderOverlay;},function(){return n.renderOverlay?"red":"black";});}l=c._scene.cameras;for(d=0;d<l.length;d++){m=l[d];m!==c._camera&&(e=b.Vector3.Project(b.Vector3.Zero(),m.getWorldMatrix(),c._transformationMatrix,j),c.shouldDisplayLabel&&!c.shouldDisplayLabel(m)||c._renderLabel(m.name,e,12,function(){c._camera.detachControl(g.getRenderingCanvas());c._camera=m;y4tt.q9();c._camera.attachControl(g.getRenderingCanvas());},function(){y4tt.v9();return"purple";}));}l=c._scene.lights;for(d=0;d<l.length;d++){p=l[d];p.position&&(e=b.Vector3.Project(p.getAbsolutePosition(),c._identityMatrix,c._transformationMatrix,j),c.shouldDisplayLabel&&!c.shouldDisplayLabel(p)||c._renderLabel(p.name,e,-20,function(){y4tt.q9();p.setEnabled(!p.isEnabled());},function(){return p.isEnabled()?"orange":"gray";}));}}c._clickPosition=void 0;};};g=(g.prototype._refreshMeshesTreeContent=function(){var b,d;for(;this._treeSubsetDiv.hasChildNodes();)this._treeSubsetDiv.removeChild(this._treeSubsetDiv.lastChild);y4tt.v9();b=this._scene.meshes.slice(0,this._scene.meshes.length);b.sort(function(b,c){return b.name===c.name?0:b.name>c.name?1:-1;});for(var c=0;c<b.length;c++){d=b[c];d.isEnabled()&&this._generateAdvancedCheckBox(this._treeSubsetDiv,d.name,d.getTotalVertices()+" verts",d.isVisible,function(b,c){c.isVisible=b.checked;},d);}},g.prototype._renderSingleAxis=function(b,c,d,f,g){this._drawingContext.beginPath();this._drawingContext.moveTo(b.x,b.y);this._drawingContext.lineTo(c.x,c.y);this._drawingContext.strokeStyle=g;this._drawingContext.lineWidth=4;this._drawingContext.stroke();this._drawingContext.font="normal 14px Segoe UI";this._drawingContext.fillStyle=g;this._drawingContext.fillText(f,d.x,d.y);},g.prototype._renderAxis=function(e,c,d){var f,g,j,l;f=c.getBoundingInfo().boundingSphere.center;c=c.getWorldMatrix();g=b.Vector3.UnprojectFromTransform(e.add(new b.Vector3(this._drawingCanvas.width*this.axisRatio,0,0)),d.width,d.height,c,this._transformationMatrix).subtract(f).length(),j=b.Vector3.Project(f.add(new b.Vector3(g,0,0)),c,this._transformationMatrix,d),l=b.Vector3.Project(f.add(new b.Vector3(1.5*g,0,0)),c,this._transformationMatrix,d);this._renderSingleAxis(e,j,l,"x","#FF0000");j=b.Vector3.Project(f.add(new b.Vector3(0,g,0)),c,this._transformationMatrix,d);l=b.Vector3.Project(f.add(new b.Vector3(0,1.5*g,0)),c,this._transformationMatrix,d);this._renderSingleAxis(e,j,l,"y","#00FF00");j=b.Vector3.Project(f.add(new b.Vector3(0,0,g)),c,this._transformationMatrix,d);d=b.Vector3.Project(f.add(new b.Vector3(0,0,1.5*g)),c,this._transformationMatrix,d);this._renderSingleAxis(e,j,d,"z","#0000FF");},g.prototype._renderLabel=function(b,c,d,f,g){var j,l,n,m;y4tt.v9();if(0<c.z&&1>c.z){this._drawingContext.font="normal 12px Segoe UI";j=this._drawingContext.measureText(b),l=c.x-j.width/2,n=c.y,m=this._drawingCanvas.getBoundingClientRect();this._showUI&&this._isClickInsideRect(m.left*this._ratio+l-5,m.top*this._ratio+n-d-12,j.width+10,17)&&f();this._drawingContext.beginPath();this._drawingContext.rect(l-5,n-d-12,j.width+10,17);this._drawingContext.fillStyle=g();this._drawingContext.globalAlpha=0.5;this._drawingContext.fill();this._drawingContext.globalAlpha=1;this._drawingContext.strokeStyle="#FFFFFF";this._drawingContext.lineWidth=1;this._drawingContext.stroke();this._drawingContext.fillStyle="#FFFFFF";this._drawingContext.fillText(b,l,n-d);this._drawingContext.beginPath();this._drawingContext.arc(c.x,n,5,0,2*Math.PI,!1);this._drawingContext.fill();}},g.prototype._isClickInsideRect=function(b,c,d,f){return this._clickPosition?this._clickPosition.x<b||this._clickPosition.x>b+d?!1:!(this._clickPosition.y<c||this._clickPosition.y>c+f):!1;},g.prototype.isVisible=function(){y4tt.q9();return this._enabled;},g.prototype.hide=function(){var e;y4tt.v9();if(this._enabled){this._enabled=!1;e=this._scene.getEngine();this._scene.unregisterBeforeRender(this._syncData);this._scene.unregisterAfterRender(this._syncUI);this._rootElement.removeChild(this._globalDiv);this._scene.forceShowBoundingBoxes=!1;this._scene.forceWireframe=!1;b.StandardMaterial.DiffuseTextureEnabled=!0;b.StandardMaterial.AmbientTextureEnabled=!0;b.StandardMaterial.SpecularTextureEnabled=!0;b.StandardMaterial.EmissiveTextureEnabled=!0;b.StandardMaterial.BumpTextureEnabled=!0;b.StandardMaterial.OpacityTextureEnabled=!0;b.StandardMaterial.ReflectionTextureEnabled=!0;b.StandardMaterial.LightmapTextureEnabled=!0;b.StandardMaterial.RefractionTextureEnabled=!0;this._scene.shadowsEnabled=!0;this._scene.particlesEnabled=!0;this._scene.postProcessesEnabled=!0;this._scene.collisionsEnabled=!0;this._scene.lightsEnabled=!0;this._scene.texturesEnabled=!0;this._scene.lensFlaresEnabled=!0;this._scene.proceduralTexturesEnabled=!0;this._scene.renderTargetsEnabled=!0;this._scene.probesEnabled=!0;e.getRenderingCanvas().removeEventListener("click",this._onCanvasClick);this._clearSkeletonViewers();}},g.prototype._clearSkeletonViewers=function(){for(var b=0;b<this._skeletonViewers.length;b++)this._skeletonViewers[b].dispose();y4tt.q9();this._skeletonViewers=[];},g.prototype.show=function(b,c,d){y4tt.v9();if(void 0===b&&(b=!0),void 0===c&&(c=null),void 0===d&&(d=null),!this._enabled)this._enabled=!0,c?this._camera=c:this._camera=this._scene.activeCamera,this._showUI=b,b=this._scene.getEngine(),this._globalDiv=document.createElement("div"),this._rootElement=d||document.body,this._rootElement.appendChild(this._globalDiv),this._generateDOMelements(),b.getRenderingCanvas().addEventListener("click",this._onCanvasClick),this._syncPositions(),this._scene.registerBeforeRender(this._syncData),this._scene.registerAfterRender(this._syncUI);},g.prototype._clearLabels=function(){this._drawingContext.clearRect(0,0,this._drawingCanvas.width,this._drawingCanvas.height);for(var b=0;b<this._scene.meshes.length;b++)this._scene.meshes[b].renderOverlay=!1;},g.prototype._generateheader=function(b,c){var d;d=document.createElement("div");d.innerHTML=c+"&nbsp;";d.style.textAlign="right";d.style.width="100%";d.style.color="white";d.style.backgroundColor="Black";d.style.padding="5px 5px 4px 0px";d.style.marginLeft="-5px";d.style.fontWeight="bold";y4tt.v9();b.appendChild(d);},g.prototype._generateTexBox=function(b,c,d){var f;f=document.createElement("label");f.style.display="inline";y4tt.q9();f.innerHTML=c;f.style.color=d;b.appendChild(f);b.appendChild(document.createElement("br"));},g.prototype._generateAdvancedCheckBox=function(b,c,d,f,g,j){var l,n,m;void 0===j&&(j=null);l=document.createElement("label");l.style.display="inline";n=document.createElement("input");n.type="checkbox";n.checked=f;n.style.display="inline";n.style.margin="0px 5px 0px 0px";y4tt.q9();n.style.verticalAlign="sub";n.addEventListener("change",function(b){y4tt.v9();g(b.target,j);});l.appendChild(n);f=document.createElement("span");n=document.createElement("span"),m=document.createElement("span");m.style.cssFloat="right";n.innerHTML=c;m.innerHTML=d;m.style.fontSize="12px";m.style.maxWidth="200px";f.appendChild(n);f.appendChild(m);l.appendChild(f);b.appendChild(l);b.appendChild(document.createElement("br"));},g.prototype._generateCheckBox=function(b,c,d,f,g){var j,l;void 0===g&&(g=null);j=document.createElement("label");j.style.display="inline";l=document.createElement("input");l.type="checkbox";l.checked=d;l.style.display="inline";l.style.margin="0px 5px 0px 0px";l.style.verticalAlign="sub";l.addEventListener("change",function(b){f(b.target,g);});j.appendChild(l);j.appendChild(document.createTextNode(c));b.appendChild(j);y4tt.q9();b.appendChild(document.createElement("br"));},g.prototype._generateButton=function(b,c,d,f){var g;void 0===f&&(f=null);g=document.createElement("button");g.innerHTML=c;g.style.height="24px";g.style.width="150px";g.style.marginBottom="5px";g.style.color="#444444";g.style.border="1px solid white";g.className="debugLayerButton";g.addEventListener("click",function(b){y4tt.q9();d(b.target,f);});y4tt.v9();b.appendChild(g);b.appendChild(document.createElement("br"));},g.prototype._generateRadio=function(b,c,d,f,g,j){var l,n;void 0===j&&(j=null);l=document.createElement("label");l.style.display="inline";n=document.createElement("input");n.type="radio";n.name=d;n.checked=f;n.style.display="inline";y4tt.v9();n.style.margin="0px 5px 0px 0px";n.style.verticalAlign="sub";n.addEventListener("change",function(b){y4tt.q9();g(b.target,j);});l.appendChild(n);l.appendChild(document.createTextNode(c));b.appendChild(l);b.appendChild(document.createElement("br"));},g.prototype._generateDOMelements=function(){var e;e=this;y4tt.v9();if(this._globalDiv.id="DebugLayer",this._globalDiv.style.position="absolute",this._globalDiv.style.fontFamily="Segoe UI, Arial",this._globalDiv.style.fontSize="14px",this._globalDiv.style.color="white",this._drawingCanvas=document.createElement("canvas"),this._drawingCanvas.id="DebugLayerDrawingCanvas",this._drawingCanvas.style.position="absolute",this._drawingCanvas.style.pointerEvents="none",this._drawingCanvas.style.backgroundColor="transparent",this._drawingContext=this._drawingCanvas.getContext("2d"),this._globalDiv.appendChild(this._drawingCanvas),this._showUI)this._statsDiv=document.createElement("div"),this._statsDiv.id="DebugLayerStats",this._statsDiv.style.border="rgb(180, 180, 180) solid 1px",this._statsDiv.style.position="absolute",this._statsDiv.style.background="rgba(128, 128, 128, 0.4)",this._statsDiv.style.padding="0px 0px 0px 5px",this._generateheader(this._statsDiv,"STATISTICS"),this._statsSubsetDiv=document.createElement("div"),this._statsSubsetDiv.style.paddingTop="5px",this._statsSubsetDiv.style.paddingBottom="5px",this._statsSubsetDiv.style.overflowY="auto",this._statsDiv.appendChild(this._statsSubsetDiv),this._treeDiv=document.createElement("div"),this._treeDiv.id="DebugLayerTree",this._treeDiv.style.border="rgb(180, 180, 180) solid 1px",this._treeDiv.style.position="absolute",this._treeDiv.style.background="rgba(128, 128, 128, 0.4)",this._treeDiv.style.padding="0px 0px 0px 5px",this._treeDiv.style.display="none",this._generateheader(this._treeDiv,"MESHES TREE"),this._treeSubsetDiv=document.createElement("div"),this._treeSubsetDiv.style.paddingTop="5px",this._treeSubsetDiv.style.paddingRight="5px",this._treeSubsetDiv.style.overflowY="auto",this._treeSubsetDiv.style.maxHeight="300px",this._treeDiv.appendChild(this._treeSubsetDiv),this._needToRefreshMeshesTree=!0,this._logDiv=document.createElement("div"),this._logDiv.style.border="rgb(180, 180, 180) solid 1px",this._logDiv.id="DebugLayerLogs",this._logDiv.style.position="absolute",this._logDiv.style.background="rgba(128, 128, 128, 0.4)",this._logDiv.style.padding="0px 0px 0px 5px",this._logDiv.style.display="none",this._generateheader(this._logDiv,"LOGS"),this._logSubsetDiv=document.createElement("div"),this._logSubsetDiv.style.height="127px",this._logSubsetDiv.style.paddingTop="5px",this._logSubsetDiv.style.overflowY="auto",this._logSubsetDiv.style.fontSize="12px",this._logSubsetDiv.style.fontFamily="consolas",this._logSubsetDiv.innerHTML=b.Tools.LogCache,this._logDiv.appendChild(this._logSubsetDiv),b.Tools.OnNewCacheEntry=function(b){e._logSubsetDiv.innerHTML=b+e._logSubsetDiv.innerHTML;},this._optionsDiv=document.createElement("div"),this._optionsDiv.id="DebugLayerOptions",this._optionsDiv.style.border="rgb(180, 180, 180) solid 1px",this._optionsDiv.style.position="absolute",this._optionsDiv.style.background="rgba(128, 128, 128, 0.4)",this._optionsDiv.style.padding="0px 0px 0px 5px",this._optionsDiv.style.overflowY="auto",this._generateheader(this._optionsDiv,"OPTIONS"),this._optionsSubsetDiv=document.createElement("div"),this._optionsSubsetDiv.style.paddingTop="5px",this._optionsSubsetDiv.style.paddingBottom="5px",this._optionsSubsetDiv.style.overflowY="auto",this._optionsSubsetDiv.style.maxHeight="200px",this._optionsDiv.appendChild(this._optionsSubsetDiv),this._generateTexBox(this._optionsSubsetDiv,"<b>Windows:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Statistics",this._displayStatistics,function(b){e._displayStatistics=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Logs",this._displayLogs,function(b){e._displayLogs=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Meshes tree",this._displayTree,function(b){e._displayTree=b.checked;e._needToRefreshMeshesTree=!0;}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>General:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Bounding boxes",this._scene.forceShowBoundingBoxes,function(b){y4tt.v9();e._scene.forceShowBoundingBoxes=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Clickable labels",this._labelsEnabled,function(b){e._labelsEnabled=b.checked;y4tt.v9();e._labelsEnabled||e._clearLabels();}),this._generateCheckBox(this._optionsSubsetDiv,"Generate user marks (F12)",b.Tools.PerformanceLogLevel===b.Tools.PerformanceUserMarkLogLevel,function(c){c.checked?b.Tools.PerformanceLogLevel=b.Tools.PerformanceUserMarkLogLevel:b.Tools.PerformanceLogLevel=b.Tools.PerformanceNoneLogLevel;}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Rendering mode:</b>",this.accentColor),this._generateRadio(this._optionsSubsetDiv,"Solid","renderMode",!this._scene.forceWireframe&&!this._scene.forcePointsCloud,function(b){y4tt.q9();b.checked&&(e._scene.forceWireframe=!1,e._scene.forcePointsCloud=!1);}),this._generateRadio(this._optionsSubsetDiv,"Wireframe","renderMode",this._scene.forceWireframe,function(b){y4tt.v9();b.checked&&(e._scene.forceWireframe=!0,e._scene.forcePointsCloud=!1);}),this._generateRadio(this._optionsSubsetDiv,"Point","renderMode",this._scene.forcePointsCloud,function(b){y4tt.v9();b.checked&&(e._scene.forceWireframe=!1,e._scene.forcePointsCloud=!0);}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Texture channels:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Diffuse",b.StandardMaterial.DiffuseTextureEnabled,function(c){b.StandardMaterial.DiffuseTextureEnabled=c.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Ambient",b.StandardMaterial.AmbientTextureEnabled,function(c){b.StandardMaterial.AmbientTextureEnabled=c.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Specular",b.StandardMaterial.SpecularTextureEnabled,function(c){y4tt.q9();b.StandardMaterial.SpecularTextureEnabled=c.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Emissive",b.StandardMaterial.EmissiveTextureEnabled,function(c){b.StandardMaterial.EmissiveTextureEnabled=c.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Bump",b.StandardMaterial.BumpTextureEnabled,function(c){y4tt.v9();b.StandardMaterial.BumpTextureEnabled=c.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Opacity",b.StandardMaterial.OpacityTextureEnabled,function(c){y4tt.q9();b.StandardMaterial.OpacityTextureEnabled=c.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Reflection",b.StandardMaterial.ReflectionTextureEnabled,function(c){b.StandardMaterial.ReflectionTextureEnabled=c.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Refraction",b.StandardMaterial.RefractionTextureEnabled,function(c){b.StandardMaterial.RefractionTextureEnabled=c.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Lightmap",b.StandardMaterial.LightmapTextureEnabled,function(c){b.StandardMaterial.LightmapTextureEnabled=c.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Fresnel",b.StandardMaterial.FresnelEnabled,function(c){y4tt.q9();b.StandardMaterial.FresnelEnabled=c.checked;}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Options:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Animations",this._scene.animationsEnabled,function(b){y4tt.v9();e._scene.animationsEnabled=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Collisions",this._scene.collisionsEnabled,function(b){y4tt.q9();e._scene.collisionsEnabled=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Fog",this._scene.fogEnabled,function(b){y4tt.q9();e._scene.fogEnabled=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Lens flares",this._scene.lensFlaresEnabled,function(b){y4tt.q9();e._scene.lensFlaresEnabled=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Lights",this._scene.lightsEnabled,function(b){y4tt.v9();e._scene.lightsEnabled=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Particles",this._scene.particlesEnabled,function(b){e._scene.particlesEnabled=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Post-processes",this._scene.postProcessesEnabled,function(b){e._scene.postProcessesEnabled=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Probes",this._scene.probesEnabled,function(b){y4tt.v9();e._scene.probesEnabled=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Procedural textures",this._scene.proceduralTexturesEnabled,function(b){y4tt.v9();e._scene.proceduralTexturesEnabled=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Render targets",this._scene.renderTargetsEnabled,function(b){y4tt.q9();e._scene.renderTargetsEnabled=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Shadows",this._scene.shadowsEnabled,function(b){y4tt.v9();e._scene.shadowsEnabled=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Skeletons",this._scene.skeletonsEnabled,function(b){e._scene.skeletonsEnabled=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Sprites",this._scene.spritesEnabled,function(b){e._scene.spritesEnabled=b.checked;}),this._generateCheckBox(this._optionsSubsetDiv,"Textures",this._scene.texturesEnabled,function(b){e._scene.texturesEnabled=b.checked;}),b.AudioEngine&&b.Engine.audioEngine.canUseWebAudio&&(this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Audio:</b>",this.accentColor),this._generateRadio(this._optionsSubsetDiv,"Headphones","panningModel",this._scene.headphone,function(b){y4tt.q9();b.checked&&(e._scene.headphone=!0);}),this._generateRadio(this._optionsSubsetDiv,"Normal Speakers","panningModel",!this._scene.headphone,function(b){y4tt.v9();b.checked&&(e._scene.headphone=!1);}),this._generateCheckBox(this._optionsSubsetDiv,"Disable audio",!this._scene.audioEnabled,function(b){e._scene.audioEnabled=!b.checked;})),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Viewers:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Skeletons",!1,function(c){var d;if(!c.checked)return void e._clearSkeletonViewers();for(c=0;c<e._scene.meshes.length;c++){d=e._scene.meshes[c];if(d.skeleton){for(var f=!1,g=0;g<e._skeletonViewers.length;g++)if(e._skeletonViewers[g].skeleton===d.skeleton){f=!0;break;}f||(d=new b.Debug.SkeletonViewer(d.skeleton,d,e._scene),d.isEnabled=!0,e._skeletonViewers.push(d));}}}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Tools:</b>",this.accentColor),this._generateButton(this._optionsSubsetDiv,"Dump rendertargets",function(){y4tt.v9();e._scene.dumpNextRenderTargets=!0;}),this._generateButton(this._optionsSubsetDiv,"Run SceneOptimizer",function(){b.SceneOptimizer.OptimizeAsync(e._scene);}),this._generateButton(this._optionsSubsetDiv,"Log camera object",function(){e._camera?console.log(e._camera):console.warn("No camera defined, or debug layer created before camera creation!");}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._globalDiv.appendChild(this._statsDiv),this._globalDiv.appendChild(this._logDiv),this._globalDiv.appendChild(this._optionsDiv),this._globalDiv.appendChild(this._treeDiv);},g.prototype._displayStats=function(){var e,c,d;e=this._scene,c=e.getEngine(),d=c.getGlInfo();this._statsSubsetDiv.innerHTML="Babylon.js v"+b.Engine.Version+" - <b>"+b.Tools.Format(c.getFps(),0)+" fps</b><br><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Count</b><br>Total meshes: "+e.meshes.length+"<br>Total lights: "+e.lights.length+"<br>Total vertices: "+e.getTotalVertices()+"<br>Total materials: "+e.materials.length+"<br>Total textures: "+e.textures.length+"<br>Active meshes: "+e.getActiveMeshes().length+"<br>Active indices: "+e.getActiveIndices()+"<br>Active bones: "+e.getActiveBones()+"<br>Active particles: "+e.getActiveParticles()+"<br><b>Draw calls: "+c.drawCalls+"</b><br><br><b>Duration</b><br>Meshes selection:</i> "+b.Tools.Format(e.getEvaluateActiveMeshesDuration())+" ms<br>Render Targets: "+b.Tools.Format(e.getRenderTargetsDuration())+" ms<br>Particles: "+b.Tools.Format(e.getParticlesDuration())+" ms<br>Sprites: "+b.Tools.Format(e.getSpritesDuration())+" ms<br><br>Render: <b>"+b.Tools.Format(e.getRenderDuration())+" ms</b><br>Frame: "+b.Tools.Format(e.getLastFrameDuration())+" ms<br>Potential FPS: "+b.Tools.Format(1E3/e.getLastFrameDuration(),0)+"<br>Resolution: "+c.getRenderWidth()+"x"+c.getRenderHeight()+"<br><br></div><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Extensions</b><br>Std derivatives: "+(c.getCaps().standardDerivatives?"Yes":"No")+"<br>Compressed textures: "+(c.getCaps().s3tc?"Yes":"No")+"<br>Hardware instances: "+(c.getCaps().instancedArrays?"Yes":"No")+"<br>Texture float: "+(c.getCaps().textureFloat?"Yes":"No")+"<br><br>32bits indices: "+(c.getCaps().uintIndices?"Yes":"No")+"<br>Fragment depth: "+(c.getCaps().fragmentDepthSupported?"Yes":"No")+"<br>High precision shaders: "+(c.getCaps().highPrecisionShaderSupported?"Yes":"No")+"<br>Draw buffers: "+(c.getCaps().drawBuffersExtension?"Yes":"No")+"<br></div><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Caps.</b><br>Max textures units: "+c.getCaps().maxTexturesImageUnits+"<br>Max textures size: "+c.getCaps().maxTextureSize+"<br>Max anisotropy: "+c.getCaps().maxAnisotropy+"<br><b>Info</b><br>WebGL feature level: "+c.webGLVersion+"<br>"+d.version+"<br></div><br>"+d.renderer+"<br>";this.customStatsFunction&&(this._statsSubsetDiv.innerHTML+=this.customStatsFunction());},g);b.DebugLayer=g;}(BABYLON||(BABYLON={}));BABYLON.Effect.ShadersStore={anaglyphPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}",blackAndWhitePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\nfloat luminance=dot(texture2D(textureSampler,vUV).rgb,vec3(0.3,0.59,0.11));\ngl_FragColor=vec4(luminance,luminance,luminance,1.0);\n}",blurPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\nbaseColor+=texture2D(textureSampler,start+texelOffset)*weights[i];\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}",chromaticAberrationPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float chromatic_aberration;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\nif (chromatic_aberration>0.0) {\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*radius*17.0/screen_width;\nfloat ref_shiftY=chromatic_aberration*radius*17.0/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\n}\ngl_FragColor=original;\n}",colorPixelShader:"uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",colorVertexShader:"\nattribute vec3 position;\n\nuniform mat4 worldViewProjection;\nvoid main(void) {\ngl_Position=worldViewProjection*vec4(position,1.0);\n}",colorCorrectionPixelShader:"\nuniform sampler2D textureSampler; \nuniform sampler2D colorTable; \n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0; \n\nvec4 sampleAs3DTexture(sampler2D texture,vec3 uv,float width) {\nfloat sliceSize=1.0/width; \nfloat slicePixelSize=sliceSize/width; \nfloat sliceInnerSize=slicePixelSize*(width-1.0); \nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(texture,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(texture,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}",convolutionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}",defaultPixelShader:"#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#include<reflectionFunction>\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef DIFFUSE\nvec2 diffuseUV=vDiffuseUV;\n#endif\n#include<bumpFragment>\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,diffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#endif\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb*vRefractionInfos.x;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb*vRefractionInfos.x;\n#endif\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb*vReflectionInfos.x;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV).rgb*vLightmapInfos.y;\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n}",defaultVertexShader:"\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#include<pointCloudVertexDeclaration>\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n}",depthPixelShader:"#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform float far;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=(gl_FragCoord.z/gl_FragCoord.w)/far;\ngl_FragColor=vec4(depth,depth*depth,0.0,1.0);\n}",depthVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",depthBoxBlurPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}",depthOfFieldPixelShader:"\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance; \nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1 \n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight; \n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV); \nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height); \nfloat depth=texture2D(depthSampler,distorted_coords).r; \nfloat distance=near+(far-near)*depth; \nvec4 color=texture2D(textureSampler,vUV); \n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n",displayPassPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}",ellipse2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",ellipse2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef Border\natt float borderThickness;\n#endif\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n\natt vec3 properties;\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nfloat ms=properties.z;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<ms) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=ms;\n}\nfloat angle=TWOPI*segi/ms;\npos2.x=(cos(angle)/2.0)+0.5;\npos2.y=(sin(angle)/2.0)+0.5;\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse {\nfloat ms=properties.z;\nfloat angle=TWOPI*(index-1.0)/ms;\npos2.x=(cos(angle)/2.0)+0.5;\npos2.y=(sin(angle)/2.0)+0.5;\n}\n#endif\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4(pos2.xy,1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4(pos2.xy,1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=pos2.xy*properties.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",filterPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}",fxaaPixelShader:"#define FXAA_REDUCE_MIN (1.0/128.0)\n#define FXAA_REDUCE_MUL (1.0/8.0)\n#define FXAA_SPAN_MAX 8.0\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvoid main(){\nvec2 localTexelSize=texelSize;\nvec4 rgbNW=texture2D(textureSampler,(vUV+vec2(-1.0,-1.0)*localTexelSize));\nvec4 rgbNE=texture2D(textureSampler,(vUV+vec2(1.0,-1.0)*localTexelSize));\nvec4 rgbSW=texture2D(textureSampler,(vUV+vec2(-1.0,1.0)*localTexelSize));\nvec4 rgbSE=texture2D(textureSampler,(vUV+vec2(1.0,1.0)*localTexelSize));\nvec4 rgbM=texture2D(textureSampler,vUV);\nvec4 luma=vec4(0.299,0.587,0.114,1.0);\nfloat lumaNW=dot(rgbNW,luma);\nfloat lumaNE=dot(rgbNE,luma);\nfloat lumaSW=dot(rgbSW,luma);\nfloat lumaSE=dot(rgbSE,luma);\nfloat lumaM=dot(rgbM,luma);\nfloat lumaMin=min(lumaM,min(min(lumaNW,lumaNE),min(lumaSW,lumaSE)));\nfloat lumaMax=max(lumaM,max(max(lumaNW,lumaNE),max(lumaSW,lumaSE)));\nvec2 dir=vec2(-((lumaNW+lumaNE)-(lumaSW+lumaSE)),((lumaNW+lumaSW)-(lumaNE+lumaSE)));\nfloat dirReduce=max(\n(lumaNW+lumaNE+lumaSW+lumaSE)*(0.25*FXAA_REDUCE_MUL),\nFXAA_REDUCE_MIN);\nfloat rcpDirMin=1.0/(min(abs(dir.x),abs(dir.y))+dirReduce);\ndir=min(vec2(FXAA_SPAN_MAX,FXAA_SPAN_MAX),\nmax(vec2(-FXAA_SPAN_MAX,-FXAA_SPAN_MAX),\ndir*rcpDirMin))*localTexelSize;\nvec4 rgbA=0.5*(\ntexture2D(textureSampler,vUV+dir*(1.0/3.0-0.5)) +\ntexture2D(textureSampler,vUV+dir*(2.0/3.0-0.5)));\nvec4 rgbB=rgbA*0.5+0.25*(\ntexture2D(textureSampler,vUV+dir*-0.5) +\ntexture2D(textureSampler,vUV+dir*0.5));\nfloat lumaB=dot(rgbB,luma);\nif ((lumaB<lumaMin) || (lumaB>lumaMax)) {\ngl_FragColor=rgbA;\n}\nelse {\ngl_FragColor=rgbB;\n}\n}",hdrPixelShader:"uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(GAUSSIAN_BLUR_H) || defined(GAUSSIAN_BLUR_V)\nuniform float blurOffsets[9];\nuniform float blurWeights[9];\nuniform float multiplier;\nvoid main(void) {\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfor (int i=0; i<9; i++) {\n#ifdef GAUSSIAN_BLUR_H\ncolor+=(texture2D(textureSampler,vUV+vec2(blurOffsets[i]*multiplier,0.0))*blurWeights[i]);\n#else\ncolor+=(texture2D(textureSampler,vUV+vec2(0.0,blurOffsets[i]*multiplier))*blurWeights[i]);\n#endif\n}\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nvoid main() {\nvec4 sum=texture2D(textureSampler,vUV)+texture2D(otherSampler,vUV);\nsum.a=clamp(sum.a,0.0,1.0);\ngl_FragColor=sum;\n}\n#endif\n#if defined(LUMINANCE_GENERATOR)\nuniform vec2 lumOffsets[4];\nvoid main() {\nfloat average=0.0;\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfloat maximum=-1e20;\nfor (int i=0; i<4; i++) {\ncolor=texture2D(textureSampler,vUV+lumOffsets[i]);\nfloat GreyValue=length(color.rgb);\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLE\nvec4 pack(float value) {\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(value*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvoid main() {\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++) {\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifndef FINAL_DOWN_SAMPLE\ngl_FragColor=vec4(average,average,0.0,1.0);\n#else\ngl_FragColor=pack(average);\n#endif\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main() {\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main() {\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(HDR)\nuniform sampler2D otherSampler;\nuniform float exposure;\nuniform float avgLuminance;\nvoid main() {\nvec4 color=texture2D(textureSampler,vUV)+texture2D(otherSampler,vUV);\nvec4 adjustedColor=color/avgLuminance*exposure;\ncolor=adjustedColor;\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n",layerPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}",layerVertexShader:"\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}",legacydefaultPixelShader:"#define MAP_PROJECTION 4.\n\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef REFLECTION\nvarying vec3 vReflectionUVW;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\nuniform vec2 vReflectionInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 normalW=normalize(vNormalW);\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\nglossiness=vSpecularColor.a;\n#endif\nfloat shadow=1.;\n#include<lightFragment>[0..3]\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n\nfloat alpha=vDiffuseColor.a;\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef SPECULARTERM\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nspecularColor=texture2D(specularSampler,vSpecularUV).rgb*vSpecularInfos.y;\n#endif\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}",legacydefaultVertexShader:"\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec2 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTION\nuniform vec3 vEyePosition;\nvarying vec3 vReflectionUVW;\nuniform mat4 reflectionMatrix;\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 coords=vec3(view*vec4(worldNormal,0.0));\nreturn vec3(reflectionMatrix*vec4(coords,1.0));\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef INVERTCUBICMAP\ncoords.y=1.0-coords.y;\n#endif\nreturn vec3(reflectionMatrix*vec4(coords,0));\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn position;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif\nvoid main(void) {\nmat4 finalWorld=world;\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef REFLECTION\nvReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),vNormalW);\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n}",legacypbrPixelShader:"precision mediump float;\n\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vAlbedoColor;\nuniform vec3 vReflectionColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vCameraInfos;\n#ifdef OVERLOADEDVALUES\nuniform vec4 vOverloadedIntensity;\nuniform vec3 vOverloadedAmbient;\nuniform vec3 vOverloadedAlbedo;\nuniform vec3 vOverloadedReflectivity;\nuniform vec3 vOverloadedEmissive;\nuniform vec3 vOverloadedReflection;\nuniform vec3 vOverloadedMicroSurface;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nuniform vec4 vOverloadedShadowIntensity;\n#endif\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform sampler2D albedoSampler;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform sampler2D reflectivitySampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#ifdef CAMERACOLORGRADING\nuniform sampler2D cameraColorGrading2DSampler;\nuniform vec4 vCameraColorGradingInfos;\nuniform vec4 vCameraColorGradingScaleOffset;\n#endif\n\n#include<pbrFunctions>\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 surfaceAlbedo=vec4(1.,1.,1.,1.);\nvec3 surfaceAlbedoContribution=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nsurfaceAlbedo=texture2D(albedoSampler,vAlbedoUV);\nsurfaceAlbedo=vec4(toLinearSpace(surfaceAlbedo.rgb),surfaceAlbedo.a);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMALBEDO\nalpha*=surfaceAlbedo.a;\n#endif\nsurfaceAlbedo.rgb*=vAlbedoInfos.y;\n#else\n\nsurfaceAlbedo.rgb=surfaceAlbedoContribution;\nsurfaceAlbedoContribution=vec3(1.,1.,1.);\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,vOverloadedAlbedo,vOverloadedIntensity.y);\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 ambientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nambientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#ifdef OVERLOADEDVALUES\nambientColor.rgb=mix(ambientColor.rgb,vOverloadedAmbient,vOverloadedIntensity.x);\n#endif\n#endif\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor.rgb=mix(surfaceReflectivityColor.rgb,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV);\nsurfaceReflectivityColor=surfaceReflectivityColorMap.rgb;\nsurfaceReflectivityColor=toLinearSpace(surfaceReflectivityColor);\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor=mix(surfaceReflectivityColor,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface=surfaceReflectivityColorMap.a;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nmicroSurface=mix(microSurface,vOverloadedMicroSurface.x,vOverloadedMicroSurface.y);\n#endif\n\nfloat NdotV=max(0.00000000001,dot(normalW,viewDirectionW));\n\nmicroSurface=clamp(microSurface,0.,1.)*0.98;\n\nfloat roughness=clamp(1.-microSurface,0.000001,1.0);\n\nvec3 lightDiffuseContribution=vec3(0.,0.,0.);\n#ifdef OVERLOADEDSHADOWVALUES\nvec3 shadowedOnlyLightDiffuseContribution=vec3(1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nvec3 lightSpecularContribution= vec3(0.,0.,0.);\n#endif\nfloat notShadowLevel=1.; \nfloat NdotL=-1.;\nlightingInfo info;\n#include<pbrLightFunctionsCall>[0..maxSimultaneousLights]\n#ifdef SPECULARTERM\nlightSpecularContribution*=vLightingIntensity.w;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n\nvec3 environmentRadiance=vReflectionColor.rgb;\nvec3 environmentIrradiance=vReflectionColor.rgb;\n#ifdef OVERLOADEDVALUES\nenvironmentIrradiance=mix(environmentIrradiance,vOverloadedReflection,vOverloadedMicroSurface.z);\nenvironmentRadiance=mix(environmentRadiance,vOverloadedReflection,vOverloadedMicroSurface.z);\n#endif\nenvironmentRadiance*=vLightingIntensity.z;\nenvironmentIrradiance*=vLightingIntensity.z;\n\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);\nvec3 specularEnvironmentReflectance=FresnelSchlickEnvironmentGGX(clamp(NdotV,0.,1.),specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\nenvironmentRadiance*=specularEnvironmentReflectance;\n\nvec3 surfaceEmissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV).rgb;\nsurfaceEmissiveColor=toLinearSpace(emissiveColorTex.rgb)*surfaceEmissiveColor*vEmissiveInfos.y;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceEmissiveColor=mix(surfaceEmissiveColor,vOverloadedEmissive,vOverloadedIntensity.w);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\n#ifdef LINKEMISSIVEWITHALBEDO\nvec3 finalDiffuse=max((lightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max((shadowedOnlyLightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nfinalDiffuse=mix(finalDiffuse,shadowedOnlyLightDiffuseContribution,(1.0-vOverloadedShadowIntensity.y));\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=lightSpecularContribution*surfaceReflectivityColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+getLuminance(finalSpecular),0.,1.);\n#endif\n#ifdef RADIANCEOVERALPHA\nalpha=clamp(alpha+getLuminance(environmentRadiance),0.,1.);\n#endif\n\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+surfaceEmissiveColor*vLightingIntensity.y,alpha);\n#else\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance,alpha);\n#endif\nfinalColor=max(finalColor,0.0);\n#ifdef CAMERATONEMAP\nfinalColor.rgb=toneMaps(finalColor.rgb);\n#endif\nfinalColor.rgb=toGammaSpace(finalColor.rgb);\n#ifdef CAMERACONTRAST\nfinalColor=contrasts(finalColor);\n#endif\nfinalColor.rgb=clamp(finalColor.rgb,0.,1.);\n#ifdef CAMERACOLORGRADING\nfinalColor=colorGrades(finalColor,cameraColorGrading2DSampler,vCameraColorGradingInfos,vCameraColorGradingScaleOffset);\n#endif\ngl_FragColor=finalColor;\n}",legacypbrVertexShader:"precision mediump float;\n\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\nvoid main(void) {\nmat4 finalWorld=world;\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef ALBEDO\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY)\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n}",lensFlarePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\ngl_FragColor=baseColor*color;\n}",lensFlareVertexShader:"\nattribute vec2 position;\n\nuniform mat4 viewportMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=position*madd+madd;\ngl_Position=viewportMatrix*vec4(position,0.0,1.0);\n}",lensHighlightsPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}",linePixelShader:"uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",lineVertexShader:"\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 worldViewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}",lines2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",lines2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute vec2 position;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec2 boundingMin;\natt vec2 boundingMax;\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4((position.xy-boundingMin)/(boundingMax-boundingMin),1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4((position.xy-boundingMin)/(boundingMax-boundingMin),1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=position.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",outlinePixelShader:"uniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragColor=color;\n}",outlineVertexShader:"\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\nvec3 offsetPosition=position+normal*offset;\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}\n",particlesPixelShader:"\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\nvoid main(void) {\n#ifdef CLIPPLANE\nif (fClipDistance>0.0)\ndiscard;\n#endif\nvec4 baseColor=texture2D(diffuseSampler,vUV);\ngl_FragColor=(baseColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n}",particlesVertexShader:"\nattribute vec3 position;\nattribute vec4 color;\nattribute vec4 options;\n\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nuniform mat4 invView;\nvarying float fClipDistance;\n#endif\nvoid main(void) { \nvec3 viewPos=(view*vec4(position,1.0)).xyz; \nvec3 cornerPos;\nfloat size=options.y;\nfloat angle=options.x;\nvec2 offset=options.zw;\ncornerPos=vec3(offset.x-0.5,offset.y-0.5,0.)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \nvColor=color;\nvUV=offset;\n\n#ifdef CLIPPLANE\nvec4 worldPos=invView*vec4(viewPos,1.0);\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n}",passPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}",pbrPixelShader:"#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vCameraInfos;\n#ifdef OVERLOADEDVALUES\nuniform vec4 vOverloadedIntensity;\nuniform vec3 vOverloadedAmbient;\nuniform vec3 vOverloadedAlbedo;\nuniform vec3 vOverloadedReflectivity;\nuniform vec3 vOverloadedEmissive;\nuniform vec3 vOverloadedReflection;\nuniform vec3 vOverloadedMicroSurface;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nuniform vec4 vOverloadedShadowIntensity;\n#endif\n#if defined(REFLECTION) || defined(REFRACTION)\nuniform vec2 vMicrosurfaceTextureLods;\n#endif\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform sampler2D albedoSampler;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform sampler2D reflectivitySampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\nuniform mat4 refractionMatrix;\n#endif\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#ifdef CAMERACOLORGRADING\n#include<colorGradingDefinition>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurvesDefinition>\n#endif\n\n#include<pbrShadowFunctions>\n#include<pbrFunctions>\n#ifdef CAMERACOLORGRADING\n#include<colorGrading>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurves>\n#endif\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 surfaceAlbedo=vec4(1.,1.,1.,1.);\nvec3 surfaceAlbedoContribution=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nsurfaceAlbedo=texture2D(albedoSampler,vAlbedoUV);\nsurfaceAlbedo=vec4(toLinearSpace(surfaceAlbedo.rgb),surfaceAlbedo.a);\n#ifndef LINKREFRACTIONTOTRANSPARENCY\n#ifdef ALPHATEST\nif (surfaceAlbedo.a<0.4)\ndiscard;\n#endif\n#endif\n#ifdef ALPHAFROMALBEDO\nalpha*=surfaceAlbedo.a;\n#endif\nsurfaceAlbedo.rgb*=vAlbedoInfos.y;\n#else\n\nsurfaceAlbedo.rgb=surfaceAlbedoContribution;\nsurfaceAlbedoContribution=vec3(1.,1.,1.);\n#endif\n#ifdef VERTEXCOLOR\nsurfaceAlbedo.rgb*=vColor.rgb;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,vOverloadedAlbedo,vOverloadedIntensity.y);\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#include<bumpFragment>\n\nvec3 ambientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nambientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#ifdef OVERLOADEDVALUES\nambientColor.rgb=mix(ambientColor.rgb,vOverloadedAmbient,vOverloadedIntensity.x);\n#endif\n#endif\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor.rgb=mix(surfaceReflectivityColor.rgb,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV);\nsurfaceReflectivityColor=surfaceReflectivityColorMap.rgb;\nsurfaceReflectivityColor=toLinearSpace(surfaceReflectivityColor);\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor=mix(surfaceReflectivityColor,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface=surfaceReflectivityColorMap.a;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nmicroSurface=mix(microSurface,vOverloadedMicroSurface.x,vOverloadedMicroSurface.y);\n#endif\n\nfloat NdotV=max(0.00000000001,dot(normalW,viewDirectionW));\n\nmicroSurface=clamp(microSurface,0.,1.)*0.98;\n\nfloat roughness=clamp(1.-microSurface,0.000001,1.0);\n\nvec3 lightDiffuseContribution=vec3(0.,0.,0.);\n#ifdef OVERLOADEDSHADOWVALUES\nvec3 shadowedOnlyLightDiffuseContribution=vec3(1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nvec3 lightSpecularContribution=vec3(0.,0.,0.);\n#endif\nfloat notShadowLevel=1.; \nfloat NdotL=-1.;\nlightingInfo info;\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\n\n\nfloat reflectance90=clamp(reflectance*25.0,0.0,1.0);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n#include<pbrLightFunctionsCall>[0..maxSimultaneousLights]\n#ifdef SPECULARTERM\nlightSpecularContribution*=vLightingIntensity.w;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 surfaceRefractionColor=vec3(0.,0.,0.);\n\n#ifdef LODBASEDMICROSFURACE\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n#endif\n#ifdef REFRACTION\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFRACTION\nfloat lodRefraction=getMipMapIndexFromAverageSlopeWithPMREM(vMicrosurfaceTextureLods.y,alphaG);\n#else\nfloat lodRefraction=getMipMapIndexFromAverageSlope(vMicrosurfaceTextureLods.y,alphaG);\n#endif\n#else\nfloat biasRefraction=(vMicrosurfaceTextureLods.y+2.)*(1.0-microSurface);\n#endif\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFRACTION\n\nif ((vMicrosurfaceTextureLods.y-lodRefraction)>4.0)\n{\n\nfloat scaleRefraction=1.-exp2(lodRefraction)/exp2(vMicrosurfaceTextureLods.y); \nfloat maxRefraction=max(max(abs(refractionVector.x),abs(refractionVector.y)),abs(refractionVector.z));\nif (abs(refractionVector.x) != maxRefraction) refractionVector.x*=scaleRefraction;\nif (abs(refractionVector.y) != maxRefraction) refractionVector.y*=scaleRefraction;\nif (abs(refractionVector.z) != maxRefraction) refractionVector.z*=scaleRefraction;\n}\n#endif\nsurfaceRefractionColor=textureCubeLodEXT(refractionCubeSampler,refractionVector,lodRefraction).rgb*vRefractionInfos.x;\n#else\nsurfaceRefractionColor=textureCube(refractionCubeSampler,refractionVector,biasRefraction).rgb*vRefractionInfos.x;\n#endif\n}\n#ifndef REFRACTIONMAPINLINEARSPACE\nsurfaceRefractionColor=toLinearSpace(surfaceRefractionColor.rgb);\n#endif\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#ifdef LODBASEDMICROSFURACE\nsurfaceRefractionColor=texture2DLodEXT(refraction2DSampler,refractionCoords,lodRefraction).rgb*vRefractionInfos.x;\n#else\nsurfaceRefractionColor=texture2D(refraction2DSampler,refractionCoords,biasRefraction).rgb*vRefractionInfos.x;\n#endif \nsurfaceRefractionColor=toLinearSpace(surfaceRefractionColor.rgb);\n#endif\n#endif\n\nvec3 environmentRadiance=vReflectionColor.rgb;\nvec3 environmentIrradiance=vReflectionColor.rgb;\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFLECTION\nfloat lodReflection=getMipMapIndexFromAverageSlopeWithPMREM(vMicrosurfaceTextureLods.x,alphaG);\n#else\nfloat lodReflection=getMipMapIndexFromAverageSlope(vMicrosurfaceTextureLods.x,alphaG);\n#endif\n#else\nfloat biasReflection=(vMicrosurfaceTextureLods.x+2.)*(1.0-microSurface);\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFLECTION\n\nif ((vMicrosurfaceTextureLods.y-lodReflection)>4.0)\n{\n\nfloat scaleReflection=1.-exp2(lodReflection)/exp2(vMicrosurfaceTextureLods.x); \nfloat maxReflection=max(max(abs(vReflectionUVW.x),abs(vReflectionUVW.y)),abs(vReflectionUVW.z));\nif (abs(vReflectionUVW.x) != maxReflection) vReflectionUVW.x*=scaleReflection;\nif (abs(vReflectionUVW.y) != maxReflection) vReflectionUVW.y*=scaleReflection;\nif (abs(vReflectionUVW.z) != maxReflection) vReflectionUVW.z*=scaleReflection;\n}\n#endif\nenvironmentRadiance=textureCubeLodEXT(reflectionCubeSampler,vReflectionUVW,lodReflection).rgb*vReflectionInfos.x;\n#else\nenvironmentRadiance=textureCube(reflectionCubeSampler,vReflectionUVW,biasReflection).rgb*vReflectionInfos.x;\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifndef REFLECTIONMAP_SKYBOX\nvec3 normalEnvironmentSpace=(reflectionMatrix*vec4(normalW,1)).xyz;\nenvironmentIrradiance=EnvironmentIrradiance(normalEnvironmentSpace);\n#endif\n#else\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\nenvironmentIrradiance=textureCube(reflectionCubeSampler,normalW,20.).rgb*vReflectionInfos.x;\nenvironmentIrradiance=toLinearSpace(environmentIrradiance.rgb);\nenvironmentIrradiance*=0.2; \n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\n#ifdef LODBASEDMICROSFURACE\nenvironmentRadiance=texture2DLodEXT(reflection2DSampler,coords,lodReflection).rgb*vReflectionInfos.x;\n#else\nenvironmentRadiance=texture2D(reflection2DSampler,coords,biasReflection).rgb*vReflectionInfos.x;\n#endif\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\nenvironmentIrradiance=texture2D(reflection2DSampler,coords,20.).rgb*vReflectionInfos.x;\nenvironmentIrradiance=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nenvironmentIrradiance=mix(environmentIrradiance,vOverloadedReflection,vOverloadedMicroSurface.z);\nenvironmentRadiance=mix(environmentRadiance,vOverloadedReflection,vOverloadedMicroSurface.z);\n#endif\nenvironmentRadiance*=vLightingIntensity.z;\nenvironmentIrradiance*=vLightingIntensity.z;\n\nvec3 specularEnvironmentReflectance=FresnelSchlickEnvironmentGGX(clamp(NdotV,0.,1.),specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n\nvec3 refractance=vec3(0.0,0.0,0.0);\n#ifdef REFRACTION\nvec3 transmission=vec3(1.0,1.0,1.0);\n#ifdef LINKREFRACTIONTOTRANSPARENCY\n\ntransmission*=(1.0-alpha);\n\n\nvec3 mixedAlbedo=surfaceAlbedoContribution.rgb*surfaceAlbedo.rgb;\nfloat maxChannel=max(max(mixedAlbedo.r,mixedAlbedo.g),mixedAlbedo.b);\nvec3 tint=clamp(maxChannel*mixedAlbedo,0.0,1.0);\n\nsurfaceAlbedoContribution*=alpha;\n\nenvironmentIrradiance*=alpha;\n\nsurfaceRefractionColor*=tint;\n\nalpha=1.0;\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,alpha);\n\ntransmission*=1.0-specularEnvironmentReflectance;\n\nrefractance=surfaceRefractionColor*transmission;\n#endif\n\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\nrefractance*=vLightingIntensity.z;\nenvironmentRadiance*=specularEnvironmentReflectance;\n\nvec3 surfaceEmissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV).rgb;\nsurfaceEmissiveColor=toLinearSpace(emissiveColorTex.rgb)*surfaceEmissiveColor*vEmissiveInfos.y;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceEmissiveColor=mix(surfaceEmissiveColor,vOverloadedEmissive,vOverloadedIntensity.w);\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nsurfaceEmissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\n#ifdef LINKEMISSIVEWITHALBEDO\nvec3 finalDiffuse=max((lightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max((shadowedOnlyLightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nfinalDiffuse=mix(finalDiffuse,shadowedOnlyLightDiffuseContribution,(1.0-vOverloadedShadowIntensity.y));\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=lightSpecularContribution*surfaceReflectivityColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+getLuminance(finalSpecular),0.,1.);\n#endif\n#ifdef RADIANCEOVERALPHA\nalpha=clamp(alpha+getLuminance(environmentRadiance),0.,1.);\n#endif\n\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+surfaceEmissiveColor*vLightingIntensity.y+refractance,alpha);\n#else\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+refractance,alpha);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV).rgb*vLightmapInfos.y;\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\nfinalColor=max(finalColor,0.0);\n#ifdef CAMERATONEMAP\nfinalColor.rgb=toneMaps(finalColor.rgb);\n#endif\nfinalColor.rgb=toGammaSpace(finalColor.rgb);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef CAMERACONTRAST\nfinalColor=contrasts(finalColor);\n#endif\nfinalColor.rgb=clamp(finalColor.rgb,0.,1.);\n#ifdef CAMERACOLORGRADING\nfinalColor=colorGrades(finalColor);\n#endif\n#ifdef CAMERACOLORCURVES\nfinalColor.rgb=applyColorCurves(finalColor.rgb);\n#endif\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ngl_FragColor=finalColor;\n}",pbrVertexShader:"precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef ALBEDO\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY)\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n}",postprocessVertexShader:"\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}",proceduralVertexShader:"\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}",rect2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",rect2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef Border\natt float borderThickness;\n#endif\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n\natt vec3 properties;\n\n#define rsub0 17.0\n#define rsub1 33.0\n#define rsub2 49.0\n#define rsub3 65.0\n#define rsub 64.0\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nif (properties.z == 0.0) {\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<4.0) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=4.0;\n}\nif (segi == 0.0) {\npos2=vec2(1.0,1.0);\n} \nelse if (segi == 1.0) {\npos2=vec2(1.0,0.0);\n}\nelse if (segi == 2.0) {\npos2=vec2(0.0,0.0);\n} \nelse {\npos2=vec2(0.0,1.0);\n}\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse if (index == 1.0) {\npos2=vec2(1.0,1.0);\n}\nelse if (index == 2.0) {\npos2=vec2(1.0,0.0);\n}\nelse if (index == 3.0) {\npos2=vec2(0.0,0.0);\n}\nelse {\npos2=vec2(0.0,1.0);\n}\n#endif\n}\nelse\n{\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nfloat r=properties.z;\nfloat nru=r/w;\nfloat nrv=r/h;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<rsub) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=rsub;\n}\n\nif (segi<rsub0) {\npos2=vec2(1.0-nru,nrv);\n}\n\nelse if (segi<rsub1) {\npos2=vec2(nru,nrv);\n}\n\nelse if (segi<rsub2) {\npos2=vec2(nru,1.0-nrv);\n}\n\nelse {\npos2=vec2(1.0-nru,1.0-nrv);\n}\nfloat angle=TWOPI-((index-1.0)*TWOPI/(rsub-0.5));\npos2.x+=cos(angle)*nru;\npos2.y+=sin(angle)*nrv;\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse {\nfloat w=properties.x;\nfloat h=properties.y;\nfloat r=properties.z;\nfloat nru=r/w;\nfloat nrv=r/h;\n\nif (index<rsub0) {\npos2=vec2(1.0-nru,nrv);\n}\n\nelse if (index<rsub1) {\npos2=vec2(nru,nrv);\n}\n\nelse if (index<rsub2) {\npos2=vec2(nru,1.0-nrv);\n}\n\nelse {\npos2=vec2(1.0-nru,1.0-nrv);\n}\nfloat angle=TWOPI-((index-1.0)*TWOPI/(rsub-0.5));\npos2.x+=cos(angle)*nru;\npos2.y+=sin(angle)*nrv;\n}\n#endif\n}\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4(pos2.xy,1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4(pos2.xy,1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=pos2.xy*properties.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",refractionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}",shadowMapPixelShader:"vec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n\nvec2 packHalf(float depth) \n{ \nconst vec2 bitOffset=vec2(1.0/255.,0.);\nvec2 color=vec2(depth,fract(depth*255.));\nreturn color-(color.yy*bitOffset);\n}\nvarying vec4 vPosition;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef CUBEMAP\nuniform vec3 lightPosition;\nuniform vec2 depthValues;\n#endif\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#ifdef CUBEMAP\nvec3 directionToLight=vPosition.xyz-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\n#else\nfloat depth=vPosition.z/vPosition.w;\ndepth=depth*0.5+0.5;\n#endif\n#ifdef VSM\nfloat moment1=depth;\nfloat moment2=moment1*moment1;\ngl_FragColor=vec4(packHalf(moment1),packHalf(moment2));\n#else\ngl_FragColor=pack(depth);\n#endif\n}",shadowMapVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(position,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",sprite2dPixelShader:"varying vec2 vUV;\nuniform sampler2D diffuseSampler;\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (color.a == 0.05) {\ndiscard;\n}\ngl_FragColor=color;\n}",sprite2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\n\nattribute float index;\natt vec2 topLeftUV;\natt vec2 sizeUV;\natt vec2 textureSize;\n\natt vec3 properties;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nvec2 off=vec2(0.0,0.0);\nfloat frame=properties.x;\nfloat invertY=properties.y;\nfloat alignToPixel=properties.z;\n\nif (index == 0.0) {\npos2=vec2(0.0,0.0);\nvUV=vec2(topLeftUV.x+(frame*sizeUV.x)+off.x,topLeftUV.y-off.y);\n}\n\nelse if (index == 1.0) {\npos2=vec2(0.0,1.0);\nvUV=vec2(topLeftUV.x+(frame*sizeUV.x)+off.x,(topLeftUV.y+sizeUV.y));\n}\n\nelse if (index == 2.0) {\npos2=vec2( 1.0,1.0);\nvUV=vec2(topLeftUV.x+sizeUV.x+(frame*sizeUV.x),(topLeftUV.y+sizeUV.y));\n}\n\nelse if (index == 3.0) {\npos2=vec2( 1.0,0.0);\nvUV=vec2(topLeftUV.x+sizeUV.x+(frame*sizeUV.x),topLeftUV.y-off.y);\n}\nif (invertY == 1.0) {\nvUV.y=1.0-vUV.y;\n}\nvec4 pos;\nif (alignToPixel == 1.0)\n{\npos.xy=floor(pos2.xy*sizeUV*textureSize);\n} else {\npos.xy=pos2.xy*sizeUV*textureSize;\n}\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n} ",spritesPixelShader:"uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest) \n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}",spritesVertexShader:"\nattribute vec4 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) { \nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; \nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\nvec2 uvScale=textureInfos.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));\nvUV=(uvOffset+cellInfo.zw)*uvScale;\n\n#ifdef FOG\nfFogDistance=viewPos.z;\n#endif\n}",ssaoPixelShader:"\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvoid main()\n{\nfloat texelsize=1.0/outSize;\nfloat compareDepth=texture2D(depthSampler,vUV).r;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=texture2D(depthSampler,samplePos).r;\nfloat weight=(1.0/(0.0001+abs(compareDepth-sampleDepth)));\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n}\n#endif\n",ssaoCombinePixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,vUV);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n",stereoscopicInterlacePixelShader:"const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else{\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}",text2dPixelShader:"varying vec4 vColor;\nvarying vec2 vUV;\n\nuniform sampler2D diffuseSampler;\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (color.a<0.05)\ndiscard;\ngl_FragColor=color*vColor;\n}",text2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\n\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\natt vec2 topLeftUV;\natt vec2 sizeUV;\natt vec2 textureSize;\natt vec4 color;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nif (index == 0.0) {\npos2=vec2(0.0,0.0);\nvUV=vec2(topLeftUV.x,topLeftUV.y+sizeUV.y);\n}\n\nelse if (index == 1.0) {\npos2=vec2(0.0,1.0);\nvUV=vec2(topLeftUV.x,topLeftUV.y);\n}\n\nelse if (index == 2.0) {\npos2=vec2(1.0,1.0);\nvUV=vec2(topLeftUV.x+sizeUV.x,topLeftUV.y);\n}\n\nelse if (index == 3.0) {\npos2=vec2(1.0,0.0);\nvUV=vec2(topLeftUV.x+sizeUV.x,topLeftUV.y+sizeUV.y);\n}\n\nvUV=(floor(vUV*textureSize)+vec2(0.0,0.0))/textureSize;\nvColor=color;\nvec4 pos;\npos.xy=floor(pos2.xy*sizeUV*textureSize); \npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",tonemapPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void) \n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb); \nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm); \ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}",volumetricLightScatteringPixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 sample=texture2D(lightScatteringSampler,tc)*0.4;\nsample*=illuminationDecay*weight;\ncolor+=sample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n",volumetricLightScatteringPassPixelShader:"#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n",vrDistortionCorrectionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn; \nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nelse{\ngl_FragColor=vec4(texture2D(textureSampler,tc).rgb,1.0);\n}\n}"};BABYLON.Effect.IncludesShadersStore={bonesDeclaration:"#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#endif",bonesVertex:"#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif \nfinalWorld=finalWorld*influence;\n#endif",bumpFragment:"#ifdef BUMP\nvec2 bumpUV=vBumpUV;\n#endif\n#if defined(BUMP) || defined(PARALLAX)\nmat3 TBN=cotangent_frame(normalW*vBumpInfos.y,-viewDirectionW,bumpUV);\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nvec2 uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,bumpUV,vBumpInfos.z);\n#else\nvec2 uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\ndiffuseUV+=uvOffset;\nbumpUV+=uvOffset;\n#endif\n#ifdef BUMP\nnormalW=perturbNormal(viewDirectionW,TBN,bumpUV);\n#endif",bumpFragmentFunctions:"#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform sampler2D bumpSampler;\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));\nreturn mat3(tangent*invmax,binormal*invmax,normal);\n}\nvec3 perturbNormal(vec3 viewDir,mat3 cotangentFrame,vec2 uv)\n{\nvec3 map=texture2D(bumpSampler,uv).xyz;\n#ifdef INVERTNORMALMAPX\nmap.x=1.0-map.x;\n#endif\n#ifdef INVERTNORMALMAPY\nmap.y=1.0-map.y;\n#endif\nmap=map*255./127.-128./127.;\nreturn normalize(cotangentFrame*map);\n}\n#ifdef PARALLAX\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n#endif",clipPlaneFragment:"#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif",clipPlaneFragmentDeclaration:"#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif",clipPlaneVertex:"#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif",clipPlaneVertexDeclaration:"#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif",colorCurves:"const vec3 HDTVRec709_RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvec3 applyColorCurves(vec3 original) {\nvec3 result=original;\n\n\n\nfloat luma=dot(result.rgb,HDTVRec709_RGBLuminanceCoefficients);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0,0.0),vec2(1.0,1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma,luma,luma),result.rgb,colorCurve.a);\nreturn result;\n}",colorCurvesDefinition:"uniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\nuniform vec4 vCameraColorCurveNegative;",colorGrading:"vec4 colorGrades(vec4 color) \n{ \n\nfloat sliceContinuous=color.z*vCameraColorGradingInfos.z;\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger; \n\nvec2 sliceUV=color.xy*vCameraColorGradingScaleOffset.xy+vCameraColorGradingScaleOffset.zw;\n\n\nsliceUV.x+=sliceInteger*vCameraColorGradingInfos.w;\nvec4 slice0Color=texture2D(cameraColorGrading2DSampler,sliceUV);\nsliceUV.x+=vCameraColorGradingInfos.w;\nvec4 slice1Color=texture2D(cameraColorGrading2DSampler,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\ncolor.rgb=mix(color.rgb,result,vCameraColorGradingInfos.x);\nreturn color;\n}",colorGradingDefinition:"uniform sampler2D cameraColorGrading2DSampler;\nuniform vec4 vCameraColorGradingInfos;\nuniform vec4 vCameraColorGradingScaleOffset;",fogFragment:"#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif",fogFragmentDeclaration:"#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying float fFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fFogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fFogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fFogDistance*fFogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif",fogVertex:"#ifdef FOG\nfFogDistance=(view*worldPos).z;\n#endif",fogVertexDeclaration:"#ifdef FOG\nvarying float fFogDistance;\n#endif",fresnelFunction:"#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif",harmonicsFunctions:"#ifdef USESPHERICALFROMREFLECTIONMAP\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX;\nuniform vec3 vSphericalYY;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\nvec3 EnvironmentIrradiance(vec3 normal)\n{\n\n\n\nvec3 result =\nvSphericalX*normal.x +\nvSphericalY*normal.y +\nvSphericalZ*normal.z +\nvSphericalXX*normal.x*normal.x +\nvSphericalYY*normal.y*normal.y +\nvSphericalZZ*normal.z*normal.z +\nvSphericalYZ*normal.y*normal.z +\nvSphericalZX*normal.z*normal.x +\nvSphericalXY*normal.x*normal.y;\nreturn result.rgb;\n}\n#endif",helperFunctions:"mat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}",instancesDeclaration:"#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif",instancesVertex:"#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif",lightFragment:"#ifdef LIGHT{X}\n#ifndef SPECULARTERM\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,vLightData{X},vLightDirection{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,glossiness);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightGround{X},glossiness);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,glossiness);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWVSM{X}\nshadow=computeShadowWithVSM(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\n#ifdef SHADOWPCF{X}\n#if defined(POINTLIGHT{X})\nshadow=computeShadowWithPCFCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\nshadow=computeShadowWithPCF(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#endif\n#else\n#if defined(POINTLIGHT{X})\nshadow=computeShadowCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#else\nshadow=computeShadow(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#endif\n#endif\n#endif\n#else\nshadow=1.;\n#endif\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#endif",lightFragmentDeclaration:"#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#endif\n#ifdef SHADOW{X}\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nvarying vec4 vPositionFromLight{X};\nuniform sampler2D shadowSampler{X};\n#else\nuniform samplerCube shadowSampler{X};\n#endif\nuniform vec3 shadowsInfo{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\n#endif\n#ifdef HEMILIGHT{X}\nuniform vec3 vLightGround{X};\n#endif\n#endif",lightsFragmentFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(-lightDirection.xyz,lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,-lightDirection.xyz));\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW-lightDirection.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\n",logDepthDeclaration:"#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif",logDepthFragment:"#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif",logDepthVertex:"#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif",pbrFunctions:"\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\nconst float kPi=3.1415926535897932384626433832795;\nconst float kRougnhessToAlphaScale=0.1;\nconst float kRougnhessToAlphaOffset=0.29248125;\nfloat Square(float value)\n{\nreturn value*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);\n}\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nconst float kMinimumVariance=0.0005;\nfloat alphaG=Square(roughness)+kMinimumVariance;\nreturn alphaG;\n}\n\nfloat getMipMapIndexFromAverageSlope(float maxMipLevel,float alpha)\n{\n\n\n\n\n\n\n\nfloat mip=kRougnhessToAlphaOffset+maxMipLevel+(maxMipLevel*kRougnhessToAlphaScale*log2(alpha));\nreturn clamp(mip,0.,maxMipLevel);\n}\nfloat getMipMapIndexFromAverageSlopeWithPMREM(float maxMipLevel,float alphaG)\n{\nfloat specularPower=clamp(2./alphaG-2.,0.000001,2048.);\n\nreturn clamp(- 0.5*log2(specularPower)+5.5,0.,maxMipLevel);\n}\n\nfloat smithVisibilityG1_TrowbridgeReitzGGX(float dot,float alphaG)\n{\nfloat tanSquared=(1.0-dot*dot)/(dot*dot);\nreturn 2.0/(1.0+sqrt(1.0+alphaG*alphaG*tanSquared));\n}\nfloat smithVisibilityG_TrowbridgeReitzGGX_Walter(float NdotL,float NdotV,float alphaG)\n{\nreturn smithVisibilityG1_TrowbridgeReitzGGX(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGX(NdotV,alphaG);\n}\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=Square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(kPi*d*d);\n}\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-VdotH,0.,1.),5.0);\n}\nvec3 FresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n\nvec3 computeSpecularTerm(float NdotH,float NdotL,float NdotV,float VdotH,float roughness,vec3 specularColor,vec3 reflectance90)\n{\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\nfloat visibility=smithVisibilityG_TrowbridgeReitzGGX_Walter(NdotL,NdotV,alphaG);\nvisibility/=(4.0*NdotL*NdotV); \nvec3 fresnel=fresnelSchlickGGX(VdotH,specularColor,reflectance90);\nfloat specTerm=max(0.,visibility*distribution)*NdotL;\nreturn fresnel*specTerm*kPi; \n}\nfloat computeDiffuseTerm(float NdotL,float NdotV,float VdotH,float roughness)\n{\n\n\nfloat diffuseFresnelNV=pow(clamp(1.0-NdotL,0.000001,1.),5.0);\nfloat diffuseFresnelNL=pow(clamp(1.0-NdotV,0.000001,1.),5.0);\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat diffuseFresnelTerm =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn diffuseFresnelTerm*NdotL;\n\n\n}\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=clamp(lightRoughness+roughness,0.,1.);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nfloat kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn vec3(pow(color.r,2.2),pow(color.g,2.2),pow(color.b,2.2));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn vec3(pow(color.r,1.0/2.2),pow(color.g,1.0/2.2),pow(color.b,1.0/2.2));\n}\n#ifdef CAMERATONEMAP\nvec3 toneMaps(vec3 color)\n{\ncolor=max(color,0.0);\n\ncolor.rgb=color.rgb*vCameraInfos.x;\nfloat tuning=1.5; \n\n\nvec3 tonemapped=1.0-exp2(-color.rgb*tuning); \ncolor.rgb=mix(color.rgb,tonemapped,1.0);\nreturn color;\n}\n#endif\n#ifdef CAMERACONTRAST\nvec4 contrasts(vec4 color)\n{\ncolor=clamp(color,0.0,1.0);\nvec3 resultHighContrast=color.rgb*color.rgb*(3.0-2.0*color.rgb);\nfloat contrast=vCameraInfos.y;\nif (contrast<1.0)\n{\n\ncolor.rgb=mix(vec3(0.5,0.5,0.5),color.rgb,contrast);\n}\nelse\n{\n\ncolor.rgb=mix(color.rgb,resultHighContrast,contrast-1.0);\n}\nreturn color;\n}\n#endif",pbrLightFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range)\n{ \n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat lightDistanceFalloff=1.0/((lightDistanceSquared+0.0001));\n#else\nfloat lightDistanceFalloff=max(0.,1.0-length(lightOffset)/range);\n#endif\nreturn lightDistanceFalloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngle,float exponent)\n{\nfloat falloff=0.0;\n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat cosHalfAngle=cos(lightAngle*0.5);\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfalloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\n#else\nfloat cosAngle=max(0.000000000000001,dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=lightAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\n#endif\nreturn falloff;\n}\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightDirection;\nfloat attenuation=1.0;\nfloat lightDistance;\n\nif (lightData.w == 0.)\n{\nvec3 lightOffset=lightData.xyz-vPositionW;\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nattenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\nlightDistance=sqrt(lightDistanceSquared);\nlightDirection=normalize(lightOffset);\n}\n\nelse\n{\nlightDistance=length(-lightData.xyz);\nlightDirection=normalize(-lightData.xyz);\n}\n\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=max(0.00000000001,dot(vNormal,lightDirection));\nfloat VdotH=clamp(0.00000000001,1.0,dot(viewDirectionW,H));\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightOffset=lightData.xyz-vPositionW;\nvec3 directionToLightCenterW=normalize(lightOffset);\n\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nfloat attenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\n\nfloat directionalAttenuation=computeDirectionalLightFalloff(lightDirection.xyz,directionToLightCenterW,lightDirection.w,lightData.w);\nattenuation*=directionalAttenuation;\n\nfloat lightDistance=sqrt(lightDistanceSquared);\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW-lightDirection.xyz);\nNdotL=max(0.00000000001,dot(vNormal,-lightDirection.xyz));\nfloat VdotH=clamp(dot(viewDirectionW,H),0.00000000001,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\n\n\n\nNdotL=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,NdotL);\n#ifdef SPECULARTERM\n\nvec3 lightVectorW=normalize(lightData.xyz);\nvec3 H=normalize(viewDirectionW+lightVectorW);\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nNdotL=max(0.00000000001,NdotL);\nfloat VdotH=clamp(0.00000000001,1.0,dot(viewDirectionW,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm;\n#endif\nreturn result;\n}",pbrLightFunctionsCall:"#ifdef LIGHT{X}\n#ifndef SPECULARTERM\nvec3 vLightSpecular{X}=vec3(0.0);\n#endif\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,vLightData{X},vLightDirection{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightGround{X},roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWVSM{X}\nnotShadowLevel=computeShadowWithVSM(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\n#ifdef SHADOWPCF{X}\n#if defined(POINTLIGHT{X})\nnotShadowLevel=computeShadowWithPCFCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\nnotShadowLevel=computeShadowWithPCF(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#endif\n#else\n#if defined(POINTLIGHT{X})\nnotShadowLevel=computeShadowCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#else\nnotShadowLevel=computeShadow(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#endif\n#endif\n#endif\n#else\nnotShadowLevel=1.;\n#endif\nlightDiffuseContribution+=info.diffuse*notShadowLevel;\n#ifdef OVERLOADEDSHADOWVALUES\nif (NdotL<0.000000000011)\n{\nnotShadowLevel=1.;\n}\nshadowedOnlyLightDiffuseContribution*=notShadowLevel;\n#endif\n#ifdef SPECULARTERM\nlightSpecularContribution+=info.specular*notShadowLevel;\n#endif\n#endif",pbrShadowFunctions:"\n#ifdef SHADOWS\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nuniform vec2 depthValues;\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float bias)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y =-directionToLight.y;\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight))+bias;\nif (depth>shadow)\n{\n#ifdef OVERLOADEDSHADOWVALUES\nreturn mix(1.0,darkness,vOverloadedShadowIntensity.x);\n#else\nreturn darkness;\n#endif\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\nfloat biasedDepth=depth-bias;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,visibility+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,visibility+darkness);\n#endif\n}\nfloat computeShadow(vec4 vPositionFromLight,sampler2D shadowSampler,float darkness,float bias)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadow=unpack(texture2D(shadowSampler,uv))+bias;\nif (depth.z>shadow)\n{\n#ifdef OVERLOADEDSHADOWVALUES\nreturn mix(1.0,darkness,vOverloadedShadowIntensity.x);\n#else\nreturn darkness;\n#endif\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,sampler2D shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\nfloat biasedDepth=depth.z-bias;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,visibility+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,visibility+darkness);\n#endif\n}\n\nfloat unpackHalf(vec2 color)\n{\nreturn color.x+(color.y/255.0);\n}\nfloat linstep(float low,float high,float v) {\nreturn clamp((v-low)/(high-low),0.0,1.0);\n}\nfloat ChebychevInequality(vec2 moments,float compare,float bias)\n{\nfloat p=smoothstep(compare-bias,compare,moments.x);\nfloat variance=max(moments.y-moments.x*moments.x,0.02);\nfloat d=compare-moments.x;\nfloat p_max=linstep(0.2,1.0,variance/(variance+d*d));\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat computeShadowWithVSM(vec4 vPositionFromLight,sampler2D shadowSampler,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0 || depth.z>=1.0)\n{\nreturn 1.0;\n}\nvec4 texel=texture2D(shadowSampler,uv);\nvec2 moments=vec2(unpackHalf(texel.xy),unpackHalf(texel.zw));\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness);\n#endif\n}\n#endif",pointCloudVertex:"#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif",pointCloudVertexDeclaration:"#ifdef POINTSIZE\nuniform float pointSize;\n#endif",reflectionFunction:"vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nfloat t=clamp(direction.y*-0.5+0.5,0.,1.0);\nfloat s=atan(direction.z,direction.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition);\nvec3 r=reflect(cameraToVertex,worldNormal);\nfloat t=clamp(r.y*-0.5+0.5,0.,1.0);\nfloat s=atan(r.z,r.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef INVERTCUBICMAP\ncoords.y=1.0-coords.y;\n#endif\nreturn vec3(reflectionMatrix*vec4(coords,0));\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}",shadowsFragmentFunctions:"#ifdef SHADOWS\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nuniform vec2 depthValues;\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float bias)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight))+bias;\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\nfloat biasedDepth=depth-bias;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadow(vec4 vPositionFromLight,sampler2D shadowSampler,float darkness,float bias)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadow=unpack(texture2D(shadowSampler,uv))+bias;\nif (depth.z>shadow)\n{\nreturn darkness;\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,sampler2D shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\nfloat biasedDepth=depth.z-bias;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\nreturn min(1.0,visibility+darkness);\n}\n\nfloat unpackHalf(vec2 color)\n{\nreturn color.x+(color.y/255.0);\n}\nfloat linstep(float low,float high,float v) {\nreturn clamp((v-low)/(high-low),0.0,1.0);\n}\nfloat ChebychevInequality(vec2 moments,float compare,float bias)\n{\nfloat p=smoothstep(compare-bias,compare,moments.x);\nfloat variance=max(moments.y-moments.x*moments.x,0.02);\nfloat d=compare-moments.x;\nfloat p_max=linstep(0.2,1.0,variance/(variance+d*d));\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat computeShadowWithVSM(vec4 vPositionFromLight,sampler2D shadowSampler,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0 || depth.z>=1.0)\n{\nreturn 1.0;\n}\nvec4 texel=texture2D(shadowSampler,uv);\nvec2 moments=vec2(unpackHalf(texel.xy),unpackHalf(texel.zw));\nreturn min(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness);\n}\n#endif",shadowsVertex:"#ifdef SHADOWS\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#endif\n#endif",shadowsVertexDeclaration:"#ifdef SHADOWS\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nuniform mat4 lightMatrix{X};\nvarying vec4 vPositionFromLight{X};\n#endif\n#endif\n"};BABYLON.CollisionWorker='var BABYLON;!function(t){var e=function(t,e,o,i){return t.x>o.x+i?!1:o.x-i>e.x?!1:t.y>o.y+i?!1:o.y-i>e.y?!1:t.z>o.z+i?!1:!(o.z-i>e.z)},o=function(t,e,o,i){var s=e*e-4*t*o,r={root:0,found:!1};if(0>s)return r;var n=Math.sqrt(s),c=(-e-n)/(2*t),h=(-e+n)/(2*t);if(c>h){var a=h;h=c,c=a}return c>0&&i>c?(r.root=c,r.found=!0,r):h>0&&i>h?(r.root=h,r.found=!0,r):r},i=function(){function i(){this.radius=new t.Vector3(1,1,1),this.retry=0,this.basePointWorld=t.Vector3.Zero(),this.velocityWorld=t.Vector3.Zero(),this.normalizedVelocity=t.Vector3.Zero(),this._collisionPoint=t.Vector3.Zero(),this._planeIntersectionPoint=t.Vector3.Zero(),this._tempVector=t.Vector3.Zero(),this._tempVector2=t.Vector3.Zero(),this._tempVector3=t.Vector3.Zero(),this._tempVector4=t.Vector3.Zero(),this._edge=t.Vector3.Zero(),this._baseToVertex=t.Vector3.Zero(),this._destinationPoint=t.Vector3.Zero(),this._slidePlaneNormal=t.Vector3.Zero(),this._displacementVector=t.Vector3.Zero()}return i.prototype._initialize=function(e,o,i){this.velocity=o,t.Vector3.NormalizeToRef(o,this.normalizedVelocity),this.basePoint=e,e.multiplyToRef(this.radius,this.basePointWorld),o.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=i,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(e,o,i,s,r){o.subtractToRef(e,this._tempVector),i.subtractToRef(e,this._tempVector2),t.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var n=t.Vector3.Dot(this._tempVector4,r);return 0>n?!1:(s.subtractToRef(e,this._tempVector3),t.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),0>n?!1:(t.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),n>=0))},i.prototype._canDoCollision=function(o,i,s,r){var n=t.Vector3.Distance(this.basePointWorld,o),c=Math.max(this.radius.x,this.radius.y,this.radius.z);return n>this.velocityWorldLength+c+i?!1:!!e(s,r,this.basePointWorld,this.velocityWorldLength+c)},i.prototype._testTriangle=function(e,i,s,r,n,c){var h,a=!1;i||(i=[]),i[e]||(i[e]=new t.Plane(0,0,0,0),i[e].copyFromPoints(s,r,n));var l=i[e];if(c||l.isFrontFacingTo(this.normalizedVelocity,0)){var _=l.signedDistanceTo(this.basePoint),d=t.Vector3.Dot(l.normal,this.velocity);if(0==d){if(Math.abs(_)>=1)return;a=!0,h=0}else{h=(-1-_)/d;var V=(1-_)/d;if(h>V){var u=V;V=h,h=u}if(h>1||0>V)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var P=!1,p=1;if(a||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,s,r,n,l.normal)&&(P=!0,p=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!P){var m=this.velocity.lengthSquared(),f=m;this.basePoint.subtractToRef(s,this._tempVector);var T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p);y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(s)),this.basePoint.subtractToRef(r,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(r)),this.basePoint.subtractToRef(n,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(n)),r.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex);var g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex);if(f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found){var D=(v*y.root-R)/g;D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),s.addToRef(this._edge,this._collisionPoint))}n.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),r.addToRef(this._edge,this._collisionPoint))),s.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),n.addToRef(this._edge,this._collisionPoint)))}if(P){var x=p*this.velocity.length();(!this.collisionFound||x<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=x,this.collisionFound=!0)}}},i.prototype._collide=function(t,e,o,i,s,r,n){for(var c=i;s>c;c+=3){var h=e[o[c]-r],a=e[o[c+1]-r],l=e[o[c+2]-r];this._testTriangle(c,t,l,a,h,n)}},i.prototype._getResponse=function(e,o){e.addToRef(o,this._destinationPoint),o.scaleInPlace(this.nearestDistance/o.length()),this.basePoint.addToRef(o,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,o)},i}();t.Collider=i}(BABYLON||(BABYLON={}));var BABYLON;!function(o){o.WorkerIncluded=!0;var e=function(){function o(){this._meshes={},this._geometries={}}return o.prototype.getMeshes=function(){return this._meshes},o.prototype.getGeometries=function(){return this._geometries},o.prototype.getMesh=function(o){return this._meshes[o]},o.prototype.addMesh=function(o){this._meshes[o.uniqueId]=o},o.prototype.removeMesh=function(o){delete this._meshes[o]},o.prototype.getGeometry=function(o){return this._geometries[o]},o.prototype.addGeometry=function(o){this._geometries[o.id]=o},o.prototype.removeGeometry=function(o){delete this._geometries[o]},o}();o.CollisionCache=e;var i=function(){function e(e,i,r){this.collider=e,this._collisionCache=i,this.finalPosition=r,this.collisionsScalingMatrix=o.Matrix.Zero(),this.collisionTranformationMatrix=o.Matrix.Zero()}return e.prototype.collideWithWorld=function(o,e,i,r){var t=.01;if(this.collider.retry>=i)return void this.finalPosition.copyFrom(o);this.collider._initialize(o,e,t);for(var s,l=this._collisionCache.getMeshes(),n=Object.keys(l),a=n.length,c=0;a>c;++c)if(s=n[c],parseInt(s)!=r){var d=l[s];d.checkCollisions&&this.checkCollision(d)}return this.collider.collisionFound?(0===e.x&&0===e.y&&0===e.z||this.collider._getResponse(o,e),e.length()<=t?void this.finalPosition.copyFrom(o):(this.collider.retry++,void this.collideWithWorld(o,e,i,r))):void o.addToRef(e,this.finalPosition)},e.prototype.checkCollision=function(e){if(this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))){o.Matrix.ScalingToRef(1/this.collider.radius.x,1/this.collider.radius.y,1/this.collider.radius.z,this.collisionsScalingMatrix);var i=o.Matrix.FromArray(e.worldMatrixFromCache);i.multiplyToRef(this.collisionsScalingMatrix,this.collisionTranformationMatrix),this.processCollisionsForSubMeshes(this.collisionTranformationMatrix,e)}},e.prototype.processCollisionsForSubMeshes=function(o,e){var i=e.subMeshes,r=i.length;if(!e.geometryId)return void console.log("no mesh geometry id");var t=this._collisionCache.getGeometry(e.geometryId);if(!t)return void console.log("couldn\'t find geometry",e.geometryId);for(var s=0;r>s;s++){var l=i[s];r>1&&!this.checkSubmeshCollision(l)||(this.collideForSubMesh(l,o,t),this.collider.collisionFound&&(this.collider.collidedMesh=e.uniqueId))}},e.prototype.collideForSubMesh=function(e,i,r){if(!r.positionsArray){r.positionsArray=[];for(var t=0,s=r.positions.length;s>t;t+=3){var l=o.Vector3.FromArray([r.positions[t],r.positions[t+1],r.positions[t+2]]);r.positionsArray.push(l)}}if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(i)){e._lastColliderTransformMatrix=i.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var n=e.verticesStart,a=e.verticesStart+e.verticesCount,t=n;a>t;t++)e._lastColliderWorldVertices.push(o.Vector3.TransformCoordinates(r.positionsArray[t],i))}this.collider._collide(e._trianglePlanes,e._lastColliderWorldVertices,r.indices,e.indexStart,e.indexStart+e.indexCount,e.verticesStart,e.hasMaterial)},e.prototype.checkSubmeshCollision=function(e){return this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))},e}();o.CollideWorker=i;var r=function(){function r(){}return r.prototype.onInit=function(i){this._collisionCache=new e;var r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.INIT};postMessage(r,void 0)},r.prototype.onUpdate=function(e){var i=this,r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.UPDATE};try{for(var t in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(t)&&this._collisionCache.addGeometry(e.updatedGeometries[t]);for(var s in e.updatedMeshes)e.updatedMeshes.hasOwnProperty(s)&&this._collisionCache.addMesh(e.updatedMeshes[s]);e.removedGeometries.forEach(function(o){i._collisionCache.removeGeometry(o)}),e.removedMeshes.forEach(function(o){i._collisionCache.removeMesh(o)})}catch(l){r.error=o.WorkerReplyType.UNKNOWN_ERROR}postMessage(r,void 0)},r.prototype.onCollision=function(e){var r=o.Vector3.Zero(),t=new o.Collider;t.radius=o.Vector3.FromArray(e.collider.radius);var s=new i(t,this._collisionCache,r);s.collideWithWorld(o.Vector3.FromArray(e.collider.position),o.Vector3.FromArray(e.collider.velocity),e.maximumRetry,e.excludedMeshUniqueId);var l={collidedMeshUniqueId:t.collidedMesh,collisionId:e.collisionId,newPosition:r.asArray()},n={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.COLLIDE,payload:l};postMessage(n,void 0)},r}();o.CollisionDetectorTransferable=r;try{if(self&&self instanceof WorkerGlobalScope){window={},o.Collider||(importScripts("./babylon.collisionCoordinator.js"),importScripts("./babylon.collider.js"),importScripts("../Math/babylon.math.js"));var t=new r,s=function(e){var i=e.data;switch(i.taskType){case o.WorkerTaskType.INIT:t.onInit(i.payload);break;case o.WorkerTaskType.COLLIDE:t.onCollision(i.payload);break;case o.WorkerTaskType.UPDATE:t.onUpdate(i.payload)}};self.onmessage=s}}catch(l){console.log("single worker init")}}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker="",function(e){e[e.INIT=0]="INIT",e[e.UPDATE=1]="UPDATE",e[e.COLLIDE=2]="COLLIDE"}(e.WorkerTaskType||(e.WorkerTaskType={}));var o=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.UNKNOWN_ERROR=1]="UNKNOWN_ERROR"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,t=function(){function t(){var r=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){r._addUpdateMeshesList[e.uniqueId]=t.SerializeMesh(e)},this.onGeometryUpdated=function(e){r._addUpdateGeometriesList[e.id]=t.SerializeGeometry(e)},this._afterRender=function(){if(r._init&&!(0==r._toRemoveGeometryArray.length&&0==r._toRemoveMeshesArray.length&&0==Object.keys(r._addUpdateGeometriesList).length&&0==Object.keys(r._addUpdateMeshesList).length||r._runningUpdated>4)){++r._runningUpdated;var e={updatedMeshes:r._addUpdateMeshesList,updatedGeometries:r._addUpdateGeometriesList,removedGeometries:r._toRemoveGeometryArray,removedMeshes:r._toRemoveMeshesArray},i={payload:e,taskType:o.UPDATE},t=[];for(var s in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(s)&&(t.push(i.payload.updatedGeometries[s].indices.buffer),t.push(i.payload.updatedGeometries[s].normals.buffer),t.push(i.payload.updatedGeometries[s].positions.buffer));r._worker.postMessage(i,t),r._addUpdateMeshesList={},r._addUpdateGeometriesList={},r._toRemoveGeometryArray=[],r._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(t){var s=t.data;if(s.error!=i.SUCCESS)return void e.Tools.Warn("error returned from worker!");switch(s.taskType){case o.INIT:r._init=!0,r._scene.meshes.forEach(function(e){r.onMeshAdded(e)}),r._scene.getGeometries().forEach(function(e){r.onGeometryAdded(e)});break;case o.UPDATE:r._runningUpdated--;break;case o.COLLIDE:r._runningCollisionTask=!1;var n=s.payload;if(!r._collisionsCallbackArray[n.collisionId])return;r._collisionsCallbackArray[n.collisionId](n.collisionId,e.Vector3.FromArray(n.newPosition),r._scene.getMeshByUniqueID(n.collidedMeshUniqueId)),r._collisionsCallbackArray[n.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return t.prototype.getNewPosition=function(e,i,t,r,s,n,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(t.radius,this._scaledPosition),i.divideToRef(t.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=n;var d={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:t.radius.asArray()},collisionId:a,excludedMeshUniqueId:s?s.uniqueId:null,maximumRetry:r},l={payload:d,taskType:o.COLLIDE};this._worker.postMessage(l)}},t.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var t=e.WorkerIncluded?e.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([e.CollisionWorker],{type:"application/javascript"}));this._worker=new Worker(t),this._worker.onmessage=this._onMessageFromWorker;var r={payload:{},taskType:o.INIT};this._worker.postMessage(r)},t.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},t.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},t.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},t.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},t.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},t.SerializeMesh=function(o){var i=[];o.subMeshes&&(i=o.subMeshes.map(function(e,o){return{position:o,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var t=null;return o instanceof e.Mesh?t=o.geometry?o.geometry.id:null:o instanceof e.InstancedMesh&&(t=o.sourceMesh&&o.sourceMesh.geometry?o.sourceMesh.geometry.id:null),{uniqueId:o.uniqueId,id:o.id,name:o.name,geometryId:t,sphereCenter:o.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:o.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:o.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:o.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:o.worldMatrixFromCache.asArray(),subMeshes:i,checkCollisions:o.checkCollisions}},t.SerializeGeometry=function(o){return{id:o.id,positions:new Float32Array(o.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(o.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(o.getIndices()||[])}},t}();e.CollisionCoordinatorWorker=t;var r=function(){function o(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return o.prototype.getNewPosition=function(e,o,i,t,r,s,n){e.divideToRef(i.radius,this._scaledPosition),o.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,t,this._finalPosition,r),this._finalPosition.multiplyInPlace(i.radius),s(n,this._finalPosition,i.collidedMesh)},o.prototype.init=function(e){this._scene=e},o.prototype.destroy=function(){},o.prototype.onMeshAdded=function(e){},o.prototype.onMeshUpdated=function(e){},o.prototype.onMeshRemoved=function(e){},o.prototype.onGeometryAdded=function(e){},o.prototype.onGeometryUpdated=function(e){},o.prototype.onGeometryDeleted=function(e){},o.prototype._collideWithWorld=function(o,i,t,r,s,n){void 0===n&&(n=null);var a=10*e.Engine.CollisionsEpsilon;if(t.retry>=r)return void s.copyFrom(o);t._initialize(o,i,a);for(var d=0;d<this._scene.meshes.length;d++){var l=this._scene.meshes[d];l.isEnabled()&&l.checkCollisions&&l.subMeshes&&l!==n&&l._checkCollision(t)}return t.collisionFound?(0===i.x&&0===i.y&&0===i.z||t._getResponse(o,i),i.length()<=a?void s.copyFrom(o):(t.retry++,void this._collideWithWorld(o,i,t,r,s,n))):void o.addToRef(i,s)},o}();e.CollisionCoordinatorLegacy=r}(BABYLON||(BABYLON={}));var BABYLON;!function(t){t.ToGammaSpace=1/2.2,t.ToLinearSpace=2.2,t.Epsilon=.001;var i=function(){function t(){}return t.WithinEpsilon=function(t,i,n){void 0===n&&(n=1.401298e-45);var r=t-i;return r>=-n&&n>=r},t.ToHex=function(t){var i=t.toString(16);return 15>=t?("0"+i).toUpperCase():i.toUpperCase()},t.Sign=function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},t.Clamp=function(t,i,n){return void 0===i&&(i=0),void 0===n&&(n=1),Math.min(n,Math.max(i,t))},t}();t.MathTools=i;var n=function(){function n(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.r=t,this.g=i,this.b=n}return n.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},n.prototype.getClassName=function(){return"Color3"},n.prototype.getHashCode=function(){var t=this.r||0;return t=397*t^(this.g||0),t=397*t^(this.b||0)},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this},n.prototype.toColor4=function(t){return void 0===t&&(t=1),new r(this.r,this.g,this.b,t)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},n.prototype.multiply=function(t){return new n(this.r*t.r,this.g*t.g,this.b*t.b)},n.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,this},n.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},n.prototype.equalsFloats=function(t,i,n){return this.r===t&&this.g===i&&this.b===n},n.prototype.scale=function(t){return new n(this.r*t,this.g*t,this.b*t)},n.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,this},n.prototype.add=function(t){return new n(this.r+t.r,this.g+t.g,this.b+t.b)},n.prototype.addToRef=function(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,this},n.prototype.subtract=function(t){return new n(this.r-t.r,this.g-t.g,this.b-t.b)},n.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,this},n.prototype.clone=function(){return new n(this.r,this.g,this.b)},n.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},n.prototype.copyFromFloats=function(t,i,n){return this.r=t,this.g=i,this.b=n,this},n.prototype.toHexString=function(){var t=255*this.r|0,n=255*this.g|0,r=255*this.b|0;return"#"+i.ToHex(t)+i.ToHex(n)+i.ToHex(r)},n.prototype.toLinearSpace=function(){var t=new n;return this.toLinearSpaceToRef(t),t},n.prototype.toLinearSpaceToRef=function(i){return i.r=Math.pow(this.r,t.ToLinearSpace),i.g=Math.pow(this.g,t.ToLinearSpace),i.b=Math.pow(this.b,t.ToLinearSpace),this},n.prototype.toGammaSpace=function(){var t=new n;return this.toGammaSpaceToRef(t),t},n.prototype.toGammaSpaceToRef=function(i){return i.r=Math.pow(this.r,t.ToGammaSpace),i.g=Math.pow(this.g,t.ToGammaSpace),i.b=Math.pow(this.b,t.ToGammaSpace),this},n.FromHexString=function(t){if("#"!==t.substring(0,1)||7!==t.length)return new n(0,0,0);var i=parseInt(t.substring(1,3),16),r=parseInt(t.substring(3,5),16),o=parseInt(t.substring(5,7),16);return n.FromInts(i,r,o)},n.FromArray=function(t,i){return void 0===i&&(i=0),new n(t[i],t[i+1],t[i+2])},n.FromInts=function(t,i,r){return new n(t/255,i/255,r/255)},n.Lerp=function(t,i,r){var o=t.r+(i.r-t.r)*r,s=t.g+(i.g-t.g)*r,e=t.b+(i.b-t.b)*r;return new n(o,s,e)},n.Red=function(){return new n(1,0,0)},n.Green=function(){return new n(0,1,0)},n.Blue=function(){return new n(0,0,1)},n.Black=function(){return new n(0,0,0)},n.White=function(){return new n(1,1,1)},n.Purple=function(){return new n(.5,0,.5)},n.Magenta=function(){return new n(1,0,1)},n.Yellow=function(){return new n(1,1,0)},n.Gray=function(){return new n(.5,.5,.5)},n}();t.Color3=n;var r=function(){function t(t,i,n,r){this.r=t,this.g=i,this.b=n,this.a=r}return t.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b,this.a+i.a)},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b,this.a-i.a)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i.a=this.a-t.a,this},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i,this.a*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i.a=this.a*t,this},t.prototype.multiply=function(i){return new t(this.r*i.r,this.g*i.g,this.b*i.b,this.a*i.a)},t.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,i.a=this.a*t.a,i},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.getClassName=function(){return"Color4"},t.prototype.getHashCode=function(){var t=this.r||0;return t=397*t^(this.g||0),t=397*t^(this.b||0),t=397*t^(this.a||0)},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.toHexString=function(){var t=255*this.r|0,n=255*this.g|0,r=255*this.b|0,o=255*this.a|0;return"#"+i.ToHex(t)+i.ToHex(n)+i.ToHex(r)+i.ToHex(o)},t.FromHexString=function(i){if("#"!==i.substring(0,1)||9!==i.length)return new t(0,0,0,0);var n=parseInt(i.substring(1,3),16),r=parseInt(i.substring(3,5),16),o=parseInt(i.substring(5,7),16),s=parseInt(i.substring(7,9),16);return t.FromInts(n,r,o,s)},t.Lerp=function(i,n,r){var o=new t(0,0,0,0);return t.LerpToRef(i,n,r,o),o},t.LerpToRef=function(t,i,n,r){r.r=t.r+(i.r-t.r)*n,r.g=t.g+(i.g-t.g)*n,r.b=t.b+(i.b-t.b)*n,r.a=t.a+(i.a-t.a)*n},t.FromArray=function(i,n){return void 0===n&&(n=0),new t(i[n],i[n+1],i[n+2],i[n+3])},t.FromInts=function(i,n,r,o){return new t(i/255,n/255,r/255,o/255)},t.CheckColors4=function(t,i){if(t.length===3*i){for(var n=[],r=0;r<t.length;r+=3){var o=r/3*4;n[o]=t[r],n[o+1]=t[r+1],n[o+2]=t[r+2],n[o+3]=1}return n}return t},t}();t.Color4=r;var o=function(){function n(t,i){this.x=t,this.y=i}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},n.prototype.getClassName=function(){return"Vector2"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0)},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,this},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},n.prototype.copyFromFloats=function(t,i){return this.x=t,this.y=i,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,this},n.prototype.addVector3=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,this},n.prototype.multiplyByFloats=function(t,i){return new n(this.x*t,this.y*i)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,this},n.prototype.negate=function(){return new n(-this.x,-this.y)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t)},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},n.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this},n.prototype.clone=function(){return new n(this.x,this.y)},n.Zero=function(){return new n(0,0)},n.FromArray=function(t,i){return void 0===i&&(i=0),new n(t[i],t[i+1])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1]},n.CatmullRom=function(t,i,r,o,s){var e=s*s,h=s*e,a=.5*(2*i.x+(-t.x+r.x)*s+(2*t.x-5*i.x+4*r.x-o.x)*e+(-t.x+3*i.x-3*r.x+o.x)*h),u=.5*(2*i.y+(-t.y+r.y)*s+(2*t.y-5*i.y+4*r.y-o.y)*e+(-t.y+3*i.y-3*r.y+o.y)*h);return new n(a,u)},n.Clamp=function(t,i,r){var o=t.x;o=o>r.x?r.x:o,o=o<i.x?i.x:o;var s=t.y;return s=s>r.y?r.y:s,s=s<i.y?i.y:s,new n(o,s)},n.Hermite=function(t,i,r,o,s){var e=s*s,h=s*e,a=2*h-3*e+1,u=-2*h+3*e,m=h-2*e+s,y=h-e,c=t.x*a+r.x*u+i.x*m+o.x*y,p=t.y*a+r.y*u+i.y*m+o.y*y;return new n(c,p)},n.Lerp=function(t,i,r){var o=t.x+(i.x-t.x)*r,s=t.y+(i.y-t.y)*r;return new n(o,s)},n.Dot=function(t,i){return t.x*i.x+t.y*i.y},n.Normalize=function(t){var i=t.clone();return i.normalize(),i},n.Minimize=function(t,i){var r=t.x<i.x?t.x:i.x,o=t.y<i.y?t.y:i.y;return new n(r,o)},n.Maximize=function(t,i){var r=t.x>i.x?t.x:i.x,o=t.y>i.y?t.y:i.y;return new n(r,o)},n.Transform=function(t,i){var r=n.Zero();return n.TransformToRef(t,i,r),r},n.TransformToRef=function(t,i,n){var r=t.x*i.m[0]+t.y*i.m[4]+i.m[12],o=t.x*i.m[1]+t.y*i.m[5]+i.m[13];n.x=r,n.y=o},n.PointInTriangle=function(t,i,n,r){var o=.5*(-n.y*r.x+i.y*(-n.x+r.x)+i.x*(n.y-r.y)+n.x*r.y),s=0>o?-1:1,e=(i.y*r.x-i.x*r.y+(r.y-i.y)*t.x+(i.x-r.x)*t.y)*s,h=(i.x*n.y-i.y*n.x+(i.y-n.y)*t.x+(n.x-i.x)*t.y)*s;return e>0&&h>0&&2*o*s>e+h},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y;return n*n+r*r},n.DistanceOfPointFromSegment=function(t,i,r){var o=n.DistanceSquared(i,r);if(0===o)return n.Distance(t,i);var s=r.subtract(i),e=Math.max(0,Math.min(1,n.Dot(t.subtract(i),s)/o)),h=i.add(s.multiplyByFloats(e,e));return n.Distance(t,h)},n}();t.Vector2=o;var s=function(){function n(t,i,n){this.x=t,this.y=i,this.z=n}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},n.prototype.getClassName=function(){return"Vector3"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,this},n.prototype.toQuaternion=function(){var t=new a(0,0,0,1),i=Math.cos(.5*(this.x+this.z)),n=Math.sin(.5*(this.x+this.z)),r=Math.cos(.5*(this.z-this.x)),o=Math.sin(.5*(this.z-this.x)),s=Math.cos(.5*this.y),e=Math.sin(.5*this.y);return t.x=r*e,t.y=-o*e,t.z=n*s,t.w=i*s,t},n.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,this},n.prototype.subtractFromFloats=function(t,i,r){return new n(this.x-t,this.y-i,this.z-r)},n.prototype.subtractFromFloatsToRef=function(t,i,n,r){return r.x=this.x-t,r.y=this.y-i,r.z=this.z-n,this},n.prototype.negate=function(){return new n(-this.x,-this.y,-this.z)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t,this.z*t)},n.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)&&i.WithinEpsilon(this.z,n.z,r)},n.prototype.equalsToFloats=function(t,i,n){return this.x===t&&this.y===i&&this.z===n},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y,this.z*t.z)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,this},n.prototype.multiplyByFloats=function(t,i,r){return new n(this.x*t,this.y*i,this.z*r)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y,this.z/t.z)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,this},n.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},n.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.prototype.normalize=function(){var t=this.length();if(0===t||1===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this},n.prototype.clone=function(){return new n(this.x,this.y,this.z)},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},n.prototype.copyFromFloats=function(t,i,n){return this.x=t,this.y=i,this.z=n,this},n.GetClipFactor=function(t,i,r,o){var s=n.Dot(t,r)-o,e=n.Dot(i,r)-o,h=s/(s-e);return h},n.FromArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2])},n.FromFloatArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2]},n.FromFloatArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2]},n.FromFloatsToRef=function(t,i,n,r){r.x=t,r.y=i,r.z=n},n.Zero=function(){return new n(0,0,0)},n.Up=function(){return new n(0,1,0)},n.TransformCoordinates=function(t,i){var r=n.Zero();return n.TransformCoordinatesToRef(t,i,r),r},n.TransformCoordinatesToRef=function(t,i,n){var r=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8]+i.m[12],o=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9]+i.m[13],s=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]+i.m[14],e=t.x*i.m[3]+t.y*i.m[7]+t.z*i.m[11]+i.m[15];n.x=r/e,n.y=o/e,n.z=s/e},n.TransformCoordinatesFromFloatsToRef=function(t,i,n,r,o){var s=t*r.m[0]+i*r.m[4]+n*r.m[8]+r.m[12],e=t*r.m[1]+i*r.m[5]+n*r.m[9]+r.m[13],h=t*r.m[2]+i*r.m[6]+n*r.m[10]+r.m[14],a=t*r.m[3]+i*r.m[7]+n*r.m[11]+r.m[15];o.x=s/a,o.y=e/a,o.z=h/a},n.TransformNormal=function(t,i){var r=n.Zero();return n.TransformNormalToRef(t,i,r),r},n.TransformNormalToRef=function(t,i,n){n.x=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8],n.y=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9],n.z=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]},n.TransformNormalFromFloatsToRef=function(t,i,n,r,o){o.x=t*r.m[0]+i*r.m[4]+n*r.m[8],o.y=t*r.m[1]+i*r.m[5]+n*r.m[9],o.z=t*r.m[2]+i*r.m[6]+n*r.m[10]},n.CatmullRom=function(t,i,r,o,s){var e=s*s,h=s*e,a=.5*(2*i.x+(-t.x+r.x)*s+(2*t.x-5*i.x+4*r.x-o.x)*e+(-t.x+3*i.x-3*r.x+o.x)*h),u=.5*(2*i.y+(-t.y+r.y)*s+(2*t.y-5*i.y+4*r.y-o.y)*e+(-t.y+3*i.y-3*r.y+o.y)*h),m=.5*(2*i.z+(-t.z+r.z)*s+(2*t.z-5*i.z+4*r.z-o.z)*e+(-t.z+3*i.z-3*r.z+o.z)*h);return new n(a,u,m)},n.Clamp=function(t,i,r){var o=t.x;o=o>r.x?r.x:o,o=o<i.x?i.x:o;var s=t.y;s=s>r.y?r.y:s,s=s<i.y?i.y:s;var e=t.z;return e=e>r.z?r.z:e,e=e<i.z?i.z:e,new n(o,s,e)},n.Hermite=function(t,i,r,o,s){var e=s*s,h=s*e,a=2*h-3*e+1,u=-2*h+3*e,m=h-2*e+s,y=h-e,c=t.x*a+r.x*u+i.x*m+o.x*y,p=t.y*a+r.y*u+i.y*m+o.y*y,f=t.z*a+r.z*u+i.z*m+o.z*y;return new n(c,p,f)},n.Lerp=function(t,i,r){var o=t.x+(i.x-t.x)*r,s=t.y+(i.y-t.y)*r,e=t.z+(i.z-t.z)*r;return new n(o,s,e)},n.Dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},n.Cross=function(t,i){var r=n.Zero();return n.CrossToRef(t,i,r),r},n.CrossToRef=function(t,i,n){M.Vector3[0].x=t.y*i.z-t.z*i.y,M.Vector3[0].y=t.z*i.x-t.x*i.z,M.Vector3[0].z=t.x*i.y-t.y*i.x,n.copyFrom(M.Vector3[0])},n.Normalize=function(t){var i=n.Zero();return n.NormalizeToRef(t,i),i},n.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},n.Project=function(t,i,r,o){var s=o.width,e=o.height,h=o.x,a=o.y,m=u.FromValues(s/2,0,0,0,0,-e/2,0,0,0,0,1,0,h+s/2,e/2+a,0,1),y=i.multiply(r).multiply(m);return n.TransformCoordinates(t,y)},n.UnprojectFromTransform=function(t,r,o,s,e){var h=s.multiply(e);h.invert(),t.x=t.x/r*2-1,t.y=-(t.y/o*2-1);var a=n.TransformCoordinates(t,h),u=t.x*h.m[3]+t.y*h.m[7]+t.z*h.m[11]+h.m[15];return i.WithinEpsilon(u,1)&&(a=a.scale(1/u)),a},n.Unproject=function(t,r,o,s,e,h){var a=s.multiply(e).multiply(h);a.invert();var u=new n(t.x/r*2-1,-(t.y/o*2-1),t.z),m=n.TransformCoordinates(u,a),y=u.x*a.m[3]+u.y*a.m[7]+u.z*a.m[11]+a.m[15];return i.WithinEpsilon(y,1)&&(m=m.scale(1/y)),m},n.Minimize=function(t,i){var n=t.clone();return n.MinimizeInPlace(i),n},n.Maximize=function(t,i){var n=t.clone();return n.MaximizeInPlace(i),n},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y,o=t.z-i.z;return n*n+r*r+o*o},n.Center=function(t,i){var n=t.add(i);return n.scaleInPlace(.5),n},n.RotationFromAxis=function(t,i,r){var o=n.Zero();return n.RotationFromAxisToRef(t,i,r,o),o},n.RotationFromAxisToRef=function(r,o,s,e){var h=r.normalize(),a=s.normalize(),u=p.X,m=p.Y,y=0,c=0,f=0,l=0,x=0,z=0,w=0,v=-1,d=0,g=M.Vector3[0],T=0,R=M.Vector3[1];i.WithinEpsilon(a.z,0,t.Epsilon)?z=1:i.WithinEpsilon(a.x,0,t.Epsilon)?l=1:(w=a.z/a.x,l=-w*Math.sqrt(1/(1+w*w)),z=Math.sqrt(1/(1+w*w))),R.x=l,R.y=x,R.z=z,R.normalize(),n.CrossToRef(h,R,g),g.normalize(),n.Dot(a,g)<0&&(v=1),T=n.Dot(h,R),T=Math.min(1,Math.max(-1,T)),f=Math.acos(T)*v,n.Dot(R,u)<0&&(f=Math.PI+f,R=R.scaleInPlace(-1),d++);var _=M.Vector3[2],b=M.Vector3[3];l=0,x=0,z=0,v=-1,i.WithinEpsilon(a.z,0,t.Epsilon)?l=1:(w=R.z/R.x,l=-w*Math.sqrt(1/(1+w*w)),z=Math.sqrt(1/(1+w*w))),_.x=l,_.y=x,_.z=z,_.normalize(),n.CrossToRef(_,R,b),b.normalize(),n.CrossToRef(a,_,g),g.normalize(),n.Dot(R,g)<0&&(v=1),T=n.Dot(a,_),T=Math.min(1,Math.max(-1,T)),c=Math.acos(T)*v,n.Dot(b,m)<0&&(c=Math.PI+c,d++),v=-1,n.CrossToRef(u,R,g),g.normalize(),n.Dot(g,m)<0&&(v=1),T=n.Dot(R,u),T=Math.min(1,Math.max(-1,T)),y=-Math.acos(T)*v,0>T&&2>d&&(y=Math.PI+y),e.x=c,e.y=y,e.z=f},n}();t.Vector3=s;var e=function(){function n(t,i,n,r){this.x=t,this.y=i,this.z=n,this.w=r}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"W:"+this.w+"}"},n.prototype.getClassName=function(){return"Vector4"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0),t=397*t^(this.w||0)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this},n.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,i.w=this.w+t.w,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.w=this.w-t.w,this},n.prototype.subtractFromFloats=function(t,i,r,o){return new n(this.x-t,this.y-i,this.z-r,this.w-o)},n.prototype.subtractFromFloatsToRef=function(t,i,n,r,o){return o.x=this.x-t,o.y=this.y-i,o.z=this.z-n,o.w=this.w-r,this},n.prototype.negate=function(){return new n(-this.x,-this.y,-this.z,-this.w)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t,this.z*t,this.w*t)},n.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t,i.w=this.w*t},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)&&i.WithinEpsilon(this.z,n.z,r)&&i.WithinEpsilon(this.w,n.w,r)},n.prototype.equalsToFloats=function(t,i,n,r){return this.x===t&&this.y===i&&this.z===n&&this.w===r},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,i.w=this.w*t.w,this},n.prototype.multiplyByFloats=function(t,i,r,o){return new n(this.x*t,this.y*i,this.z*r,this.w*o)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,i.w=this.w/t.w,this},n.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},n.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},n.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},n.prototype.toVector3=function(){return new s(this.x,this.y,this.z)},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.prototype.copyFromFloats=function(t,i,n,r){return this.x=t,this.y=i,this.z=n,this.w=r,this},n.FromArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2],t[i+3])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2],n.w=t[i+3]},n.FromFloatArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2],n.w=t[i+3]},n.FromFloatsToRef=function(t,i,n,r,o){o.x=t,o.y=i,o.z=n,o.w=r},n.Zero=function(){return new n(0,0,0,0)},n.Normalize=function(t){var i=n.Zero();return n.NormalizeToRef(t,i),i},n.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},n.Minimize=function(t,i){var n=t.clone();return n.MinimizeInPlace(i),n},n.Maximize=function(t,i){var n=t.clone();return n.MaximizeInPlace(i),n},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y,o=t.z-i.z,s=t.w-i.w;return n*n+r*r+o*o+s*s},n.Center=function(t,i){var n=t.add(i);return n.scaleInPlace(.5),n},n}();t.Vector4=e;var h=function(){function t(t,i){this.width=t,this.height=i}return t.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},t.prototype.getClassName=function(){return"Size"},t.prototype.getHashCode=function(){var t=this.width||0;return t=397*t^(this.height||0)},t.prototype.copyFrom=function(t){this.width=t.width,this.height=t.height},t.prototype.clone=function(){return new t(this.width,this.height)},t.prototype.equals=function(t){return t?this.width===t.width&&this.height===t.height:!1},Object.defineProperty(t.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),t.Zero=function(){return new t(0,0)},t.prototype.add=function(i){var n=new t(this.width+i.width,this.height+i.height);return n},t.prototype.substract=function(i){var n=new t(this.width-i.width,this.height-i.height);return n},t.Lerp=function(i,n,r){var o=i.width+(n.width-i.width)*r,s=i.height+(n.height-i.height)*r;return new t(o,s)},t}();t.Size=h;var a=function(){function t(t,i,n,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),this.x=t,this.y=i,this.z=n,this.w=r}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Quaternion"},t.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0),t=397*t^(this.w||0)},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,i,n,r){return this.x=t,this.y=i,this.z=n,this.w=r,this},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z,this.w+i.w)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z,this.w-i.w)},t.prototype.scale=function(i){return new t(this.x*i,this.y*i,this.z*i,this.w*i)},t.prototype.multiply=function(i){var n=new t(0,0,0,1);return this.multiplyToRef(i,n),n},t.prototype.multiplyToRef=function(t,i){var n=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,r=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,o=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,s=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;return i.copyFromFloats(n,r,o,s),this},t.prototype.multiplyInPlace=function(t){return this.multiplyToRef(t,this),this},t.prototype.conjugateToRef=function(t){return t.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},t.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.conjugate=function(){var i=new t(-this.x,-this.y,-this.z,this.w);return i},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toEulerAngles=function(t){void 0===t&&(t="YZX");var i=s.Zero();return this.toEulerAnglesToRef(i,t),i},t.prototype.toEulerAnglesToRef=function(t,i){void 0===i&&(i="YZX");var n,r,o,s=this.x,e=this.y,h=this.z,a=this.w;switch(i){case"YZX":var u=s*e+h*a;if(u>.499&&(n=2*Math.atan2(s,a),r=Math.PI/2,o=0),-.499>u&&(n=-2*Math.atan2(s,a),r=-Math.PI/2,o=0),isNaN(n)){var m=s*s,y=e*e,c=h*h;n=Math.atan2(2*e*a-2*s*h,1-2*y-2*c),r=Math.asin(2*u),o=Math.atan2(2*s*a-2*e*h,1-2*m-2*c)}break;default:throw new Error("Euler order "+i+" not supported yet.")}return t.y=n,t.z=r,t.x=o,this},t.prototype.toRotationMatrix=function(t){var i=this.x*this.x,n=this.y*this.y,r=this.z*this.z,o=this.x*this.y,s=this.z*this.w,e=this.z*this.x,h=this.y*this.w,a=this.y*this.z,u=this.x*this.w;return t.m[0]=1-2*(n+r),t.m[1]=2*(o+s),t.m[2]=2*(e-h),t.m[3]=0,t.m[4]=2*(o-s),t.m[5]=1-2*(r+i),t.m[6]=2*(a+u),t.m[7]=0,t.m[8]=2*(e+h),t.m[9]=2*(a-u),t.m[10]=1-2*(n+i),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1,this},t.prototype.fromRotationMatrix=function(i){return t.FromRotationMatrixToRef(i,this),this},t.FromRotationMatrix=function(i){var n=new t;return t.FromRotationMatrixToRef(i,n),n},t.FromRotationMatrixToRef=function(t,i){var n,r=t.m,o=r[0],s=r[4],e=r[8],h=r[1],a=r[5],u=r[9],m=r[2],y=r[6],c=r[10],p=o+a+c;p>0?(n=.5/Math.sqrt(p+1),i.w=.25/n,i.x=(y-u)*n,i.y=(e-m)*n,i.z=(h-s)*n):o>a&&o>c?(n=2*Math.sqrt(1+o-a-c),i.w=(y-u)/n,i.x=.25*n,i.y=(s+h)/n,i.z=(e+m)/n):a>c?(n=2*Math.sqrt(1+a-o-c),i.w=(e-m)/n,i.x=(s+h)/n,i.y=.25*n,i.z=(u+y)/n):(n=2*Math.sqrt(1+c-o-a),i.w=(h-s)/n,i.x=(e+m)/n,i.y=(u+y)/n,i.z=.25*n)},t.Inverse=function(i){return new t(-i.x,-i.y,-i.z,i.w)},t.Identity=function(){return new t(0,0,0,1)},t.RotationAxis=function(i,n){var r=new t,o=Math.sin(n/2);return i.normalize(),r.w=Math.cos(n/2),r.x=i.x*o,r.y=i.y*o,r.z=i.z*o,r},t.FromArray=function(i,n){return n||(n=0),new t(i[n],i[n+1],i[n+2],i[n+3])},t.RotationYawPitchRoll=function(i,n,r){var o=new t;return t.RotationYawPitchRollToRef(i,n,r,o),o},t.RotationYawPitchRollToRef=function(t,i,n,r){var o=.5*n,s=.5*i,e=.5*t,h=Math.sin(o),a=Math.cos(o),u=Math.sin(s),m=Math.cos(s),y=Math.sin(e),c=Math.cos(e);r.x=c*u*a+y*m*h,r.y=y*m*a-c*u*h,r.z=c*m*h-y*u*a,r.w=c*m*a+y*u*h},t.RotationAlphaBetaGamma=function(i,n,r){var o=new t;return t.RotationAlphaBetaGammaToRef(i,n,r,o),o},t.RotationAlphaBetaGammaToRef=function(t,i,n,r){var o=.5*(n+t),s=.5*(n-t),e=.5*i;r.x=Math.cos(s)*Math.sin(e),r.y=Math.sin(s)*Math.sin(e),r.z=Math.sin(o)*Math.cos(e),r.w=Math.cos(o)*Math.cos(e)},t.Slerp=function(i,n,r){var o,s,e=r,h=i.x*n.x+i.y*n.y+i.z*n.z+i.w*n.w,a=!1;if(0>h&&(a=!0,h=-h),h>.999999)s=1-e,o=a?-e:e;else{var u=Math.acos(h),m=1/Math.sin(u);s=Math.sin((1-e)*u)*m,o=a?-Math.sin(e*u)*m:Math.sin(e*u)*m}return new t(s*i.x+o*n.x,s*i.y+o*n.y,s*i.z+o*n.z,s*i.w+o*n.w)},t}();t.Quaternion=a;var u=function(){function t(){this.m=new Float32Array(16)}return t.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0===this.m[1]&&0===this.m[2]&&0===this.m[3]&&0===this.m[4]&&0===this.m[6]&&0===this.m[7]&&0===this.m[8]&&0===this.m[9]&&0===this.m[11]&&0===this.m[12]&&0===this.m[13]&&0===this.m[14]},t.prototype.determinant=function(){var t=this.m[10]*this.m[15]-this.m[11]*this.m[14],i=this.m[9]*this.m[15]-this.m[11]*this.m[13],n=this.m[9]*this.m[14]-this.m[10]*this.m[13],r=this.m[8]*this.m[15]-this.m[11]*this.m[12],o=this.m[8]*this.m[14]-this.m[10]*this.m[12],s=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*t-this.m[6]*i+this.m[7]*n)-this.m[1]*(this.m[4]*t-this.m[6]*r+this.m[7]*o)+this.m[2]*(this.m[4]*i-this.m[5]*r+this.m[7]*s)-this.m[3]*(this.m[4]*n-this.m[5]*o+this.m[6]*s)},t.prototype.toArray=function(){return this.m},t.prototype.asArray=function(){return this.toArray()},t.prototype.invert=function(){return this.invertToRef(this),this},t.prototype.reset=function(){for(var t=0;16>t;t++)this.m[t]=0;return this},t.prototype.add=function(i){var n=new t;return this.addToRef(i,n),n},t.prototype.addToRef=function(t,i){for(var n=0;16>n;n++)i.m[n]=this.m[n]+t.m[n];return this},t.prototype.addToSelf=function(t){for(var i=0;16>i;i++)this.m[i]+=t.m[i];return this},t.prototype.invertToRef=function(t){var i=this.m[0],n=this.m[1],r=this.m[2],o=this.m[3],s=this.m[4],e=this.m[5],h=this.m[6],a=this.m[7],u=this.m[8],m=this.m[9],y=this.m[10],c=this.m[11],p=this.m[12],f=this.m[13],l=this.m[14],x=this.m[15],z=y*x-c*l,w=m*x-c*f,v=m*l-y*f,d=u*x-c*p,g=u*l-y*p,T=u*f-m*p,R=e*z-h*w+a*v,_=-(s*z-h*d+a*g),M=s*w-e*d+a*T,b=-(s*v-e*g+h*T),F=1/(i*R+n*_+r*M+o*b),A=h*x-a*l,L=e*x-a*f,P=e*l-h*f,C=s*x-a*p,Z=s*l-h*p,S=s*f-e*p,I=h*c-a*y,q=e*c-a*m,H=e*y-h*m,N=s*c-a*u,V=s*y-h*u,D=s*m-e*u;return t.m[0]=R*F,t.m[4]=_*F,t.m[8]=M*F,t.m[12]=b*F,t.m[1]=-(n*z-r*w+o*v)*F,t.m[5]=(i*z-r*d+o*g)*F,t.m[9]=-(i*w-n*d+o*T)*F,t.m[13]=(i*v-n*g+r*T)*F,t.m[2]=(n*A-r*L+o*P)*F,t.m[6]=-(i*A-r*C+o*Z)*F,t.m[10]=(i*L-n*C+o*S)*F,t.m[14]=-(i*P-n*Z+r*S)*F,t.m[3]=-(n*I-r*q+o*H)*F,t.m[7]=(i*I-r*N+o*V)*F,t.m[11]=-(i*q-n*N+o*D)*F,t.m[15]=(i*H-n*V+r*D)*F,this},t.prototype.setTranslation=function(t){return this.m[12]=t.x,this.m[13]=t.y,this.m[14]=t.z,this},t.prototype.getTranslation=function(){return new s(this.m[12],this.m[13],this.m[14])},t.prototype.multiply=function(i){var n=new t;return this.multiplyToRef(i,n),n},t.prototype.copyFrom=function(t){for(var i=0;16>i;i++)this.m[i]=t.m[i];return this},t.prototype.copyToArray=function(t,i){void 0===i&&(i=0);for(var n=0;16>n;n++)t[i+n]=this.m[n];return this},t.prototype.multiplyToRef=function(t,i){return this.multiplyToArray(t,i.m,0),this},t.prototype.multiplyToArray=function(t,i,n){var r=this.m[0],o=this.m[1],s=this.m[2],e=this.m[3],h=this.m[4],a=this.m[5],u=this.m[6],m=this.m[7],y=this.m[8],c=this.m[9],p=this.m[10],f=this.m[11],l=this.m[12],x=this.m[13],z=this.m[14],w=this.m[15],v=t.m[0],d=t.m[1],g=t.m[2],T=t.m[3],R=t.m[4],_=t.m[5],M=t.m[6],b=t.m[7],F=t.m[8],A=t.m[9],L=t.m[10],P=t.m[11],C=t.m[12],Z=t.m[13],S=t.m[14],I=t.m[15];return i[n]=r*v+o*R+s*F+e*C,i[n+1]=r*d+o*_+s*A+e*Z,i[n+2]=r*g+o*M+s*L+e*S,i[n+3]=r*T+o*b+s*P+e*I,i[n+4]=h*v+a*R+u*F+m*C,i[n+5]=h*d+a*_+u*A+m*Z,i[n+6]=h*g+a*M+u*L+m*S,i[n+7]=h*T+a*b+u*P+m*I,i[n+8]=y*v+c*R+p*F+f*C,\ni[n+9]=y*d+c*_+p*A+f*Z,i[n+10]=y*g+c*M+p*L+f*S,i[n+11]=y*T+c*b+p*P+f*I,i[n+12]=l*v+x*R+z*F+w*C,i[n+13]=l*d+x*_+z*A+w*Z,i[n+14]=l*g+x*M+z*L+w*S,i[n+15]=l*T+x*b+z*P+w*I,this},t.prototype.equals=function(t){return t&&this.m[0]===t.m[0]&&this.m[1]===t.m[1]&&this.m[2]===t.m[2]&&this.m[3]===t.m[3]&&this.m[4]===t.m[4]&&this.m[5]===t.m[5]&&this.m[6]===t.m[6]&&this.m[7]===t.m[7]&&this.m[8]===t.m[8]&&this.m[9]===t.m[9]&&this.m[10]===t.m[10]&&this.m[11]===t.m[11]&&this.m[12]===t.m[12]&&this.m[13]===t.m[13]&&this.m[14]===t.m[14]&&this.m[15]===t.m[15]},t.prototype.clone=function(){return t.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},t.prototype.getClassName=function(){return"Matrix"},t.prototype.getHashCode=function(){for(var t=this.m[0]||0,i=1;16>i;i++)t=397*t^(this.m[i]||0);return t},t.prototype.decompose=function(n,r,o){o.x=this.m[12],o.y=this.m[13],o.z=this.m[14];var s=i.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,e=i.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=i.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(n.x=s*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),n.y=e*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),n.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===n.x||0===n.y||0===n.z)return r.x=0,r.y=0,r.z=0,r.w=1,!1;var u=t.FromValues(this.m[0]/n.x,this.m[1]/n.x,this.m[2]/n.x,0,this.m[4]/n.y,this.m[5]/n.y,this.m[6]/n.y,0,this.m[8]/n.z,this.m[9]/n.z,this.m[10]/n.z,0,0,0,0,1);return a.FromRotationMatrixToRef(u,r),!0},t.FromArray=function(i,n){var r=new t;return n||(n=0),t.FromArrayToRef(i,n,r),r},t.FromArrayToRef=function(t,i,n){for(var r=0;16>r;r++)n.m[r]=t[r+i]},t.FromFloat32ArrayToRefScaled=function(t,i,n,r){for(var o=0;16>o;o++)r.m[o]=t[o+i]*n},t.FromValuesToRef=function(t,i,n,r,o,s,e,h,a,u,m,y,c,p,f,l,x){x.m[0]=t,x.m[1]=i,x.m[2]=n,x.m[3]=r,x.m[4]=o,x.m[5]=s,x.m[6]=e,x.m[7]=h,x.m[8]=a,x.m[9]=u,x.m[10]=m,x.m[11]=y,x.m[12]=c,x.m[13]=p,x.m[14]=f,x.m[15]=l},t.prototype.getRow=function(t){if(0>t||t>3)return null;var i=4*t;return new e(this.m[i+0],this.m[i+1],this.m[i+2],this.m[i+3])},t.prototype.setRow=function(t,i){if(0>t||t>3)return this;var n=4*t;return this.m[n+0]=i.x,this.m[n+1]=i.y,this.m[n+2]=i.z,this.m[n+3]=i.w,this},t.FromValues=function(i,n,r,o,s,e,h,a,u,m,y,c,p,f,l,x){var z=new t;return z.m[0]=i,z.m[1]=n,z.m[2]=r,z.m[3]=o,z.m[4]=s,z.m[5]=e,z.m[6]=h,z.m[7]=a,z.m[8]=u,z.m[9]=m,z.m[10]=y,z.m[11]=c,z.m[12]=p,z.m[13]=f,z.m[14]=l,z.m[15]=x,z},t.Compose=function(i,n,r){var o=t.FromValues(i.x,0,0,0,0,i.y,0,0,0,0,i.z,0,0,0,0,1),s=t.Identity();return n.toRotationMatrix(s),o=o.multiply(s),o.setTranslation(r),o},t.Identity=function(){return t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.IdentityToRef=function(i){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,i)},t.Zero=function(){return t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},t.RotationX=function(i){var n=new t;return t.RotationXToRef(i,n),n},t.Invert=function(i){var n=new t;return i.invertToRef(n),n},t.RotationXToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[0]=1,i.m[15]=1,i.m[5]=r,i.m[10]=r,i.m[9]=-n,i.m[6]=n,i.m[1]=0,i.m[2]=0,i.m[3]=0,i.m[4]=0,i.m[7]=0,i.m[8]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationY=function(i){var n=new t;return t.RotationYToRef(i,n),n},t.RotationYToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[5]=1,i.m[15]=1,i.m[0]=r,i.m[2]=-n,i.m[8]=n,i.m[10]=r,i.m[1]=0,i.m[3]=0,i.m[4]=0,i.m[6]=0,i.m[7]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationZ=function(i){var n=new t;return t.RotationZToRef(i,n),n},t.RotationZToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[10]=1,i.m[15]=1,i.m[0]=r,i.m[1]=n,i.m[4]=-n,i.m[5]=r,i.m[2]=0,i.m[3]=0,i.m[6]=0,i.m[7]=0,i.m[8]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationAxis=function(i,n){var r=t.Zero();return t.RotationAxisToRef(i,n,r),r},t.RotationAxisToRef=function(t,i,n){var r=Math.sin(-i),o=Math.cos(-i),s=1-o;t.normalize(),n.m[0]=t.x*t.x*s+o,n.m[1]=t.x*t.y*s-t.z*r,n.m[2]=t.x*t.z*s+t.y*r,n.m[3]=0,n.m[4]=t.y*t.x*s+t.z*r,n.m[5]=t.y*t.y*s+o,n.m[6]=t.y*t.z*s-t.x*r,n.m[7]=0,n.m[8]=t.z*t.x*s-t.y*r,n.m[9]=t.z*t.y*s+t.x*r,n.m[10]=t.z*t.z*s+o,n.m[11]=0,n.m[15]=1},t.RotationYawPitchRoll=function(i,n,r){var o=new t;return t.RotationYawPitchRollToRef(i,n,r,o),o},t.RotationYawPitchRollToRef=function(t,i,n,r){a.RotationYawPitchRollToRef(t,i,n,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(r)},t.Scaling=function(i,n,r){var o=t.Zero();return t.ScalingToRef(i,n,r,o),o},t.ScalingToRef=function(t,i,n,r){r.m[0]=t,r.m[1]=0,r.m[2]=0,r.m[3]=0,r.m[4]=0,r.m[5]=i,r.m[6]=0,r.m[7]=0,r.m[8]=0,r.m[9]=0,r.m[10]=n,r.m[11]=0,r.m[12]=0,r.m[13]=0,r.m[14]=0,r.m[15]=1},t.Translation=function(i,n,r){var o=t.Identity();return t.TranslationToRef(i,n,r,o),o},t.TranslationToRef=function(i,n,r,o){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,i,n,r,1,o)},t.Lerp=function(i,n,r){for(var o=t.Zero(),s=0;16>s;s++)o.m[s]=i.m[s]*(1-r)+n.m[s]*r;return o},t.DecomposeLerp=function(i,n,r){var o=new s(0,0,0),e=new a,h=new s(0,0,0);i.decompose(o,e,h);var u=new s(0,0,0),m=new a,y=new s(0,0,0);n.decompose(u,m,y);var c=s.Lerp(o,u,r),p=a.Slerp(e,m,r),f=s.Lerp(h,y,r);return t.Compose(c,p,f)},t.LookAtLH=function(i,n,r){var o=t.Zero();return t.LookAtLHToRef(i,n,r,o),o},t.LookAtLHToRef=function(i,n,r,o){n.subtractToRef(i,this._zAxis),this._zAxis.normalize(),s.CrossToRef(r,this._zAxis,this._xAxis),0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize(),s.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var e=-s.Dot(this._xAxis,i),h=-s.Dot(this._yAxis,i),a=-s.Dot(this._zAxis,i);return t.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,e,h,a,1,o)},t.OrthoLH=function(i,n,r,o){var s=t.Zero();return t.OrthoLHToRef(i,n,r,o,s),s},t.OrthoLHToRef=function(i,n,r,o,s){var e=2/i,h=2/n,a=1/(o-r),u=r/(r-o);t.FromValuesToRef(e,0,0,0,0,h,0,0,0,0,a,0,0,0,u,1,s)},t.OrthoOffCenterLH=function(i,n,r,o,s,e){var h=t.Zero();return t.OrthoOffCenterLHToRef(i,n,r,o,s,e,h),h},t.OrthoOffCenterLHToRef=function(t,i,n,r,o,s,e){e.m[0]=2/(i-t),e.m[1]=e.m[2]=e.m[3]=0,e.m[5]=2/(r-n),e.m[4]=e.m[6]=e.m[7]=0,e.m[10]=-1/(o-s),e.m[8]=e.m[9]=e.m[11]=0,e.m[12]=(t+i)/(t-i),e.m[13]=(r+n)/(n-r),e.m[14]=o/(o-s),e.m[15]=1},t.PerspectiveLH=function(i,n,r,o){var s=t.Zero();return s.m[0]=2*r/i,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2*r/n,s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-o/(r-o),s.m[8]=s.m[9]=0,s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=r*o/(r-o),s},t.PerspectiveFovLH=function(i,n,r,o){var s=t.Zero();return t.PerspectiveFovLHToRef(i,n,r,o,s),s},t.PerspectiveFovLHToRef=function(t,i,n,r,o,s){void 0===s&&(s=!0);var e=1/Math.tan(.5*t);s?o.m[0]=e/i:o.m[0]=e,o.m[1]=o.m[2]=o.m[3]=0,s?o.m[5]=e:o.m[5]=e*i,o.m[4]=o.m[6]=o.m[7]=0,o.m[8]=o.m[9]=0,o.m[10]=-r/(n-r),o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=n*r/(n-r)},t.GetFinalMatrix=function(i,n,r,o,s,e){var h=i.width,a=i.height,u=i.x,m=i.y,y=t.FromValues(h/2,0,0,0,0,-a/2,0,0,0,0,e-s,0,u+h/2,a/2+m,s,1);return n.multiply(r).multiply(o).multiply(y)},t.GetAsMatrix2x2=function(t){return new Float32Array([t.m[0],t.m[1],t.m[4],t.m[5]])},t.GetAsMatrix3x3=function(t){return new Float32Array([t.m[0],t.m[1],t.m[2],t.m[4],t.m[5],t.m[6],t.m[8],t.m[9],t.m[10]])},t.Transpose=function(i){var n=new t;return n.m[0]=i.m[0],n.m[1]=i.m[4],n.m[2]=i.m[8],n.m[3]=i.m[12],n.m[4]=i.m[1],n.m[5]=i.m[5],n.m[6]=i.m[9],n.m[7]=i.m[13],n.m[8]=i.m[2],n.m[9]=i.m[6],n.m[10]=i.m[10],n.m[11]=i.m[14],n.m[12]=i.m[3],n.m[13]=i.m[7],n.m[14]=i.m[11],n.m[15]=i.m[15],n},t.Reflection=function(i){var n=new t;return t.ReflectionToRef(i,n),n},t.ReflectionToRef=function(t,i){t.normalize();var n=t.normal.x,r=t.normal.y,o=t.normal.z,s=-2*n,e=-2*r,h=-2*o;i.m[0]=s*n+1,i.m[1]=e*n,i.m[2]=h*n,i.m[3]=0,i.m[4]=s*r,i.m[5]=e*r+1,i.m[6]=h*r,i.m[7]=0,i.m[8]=s*o,i.m[9]=e*o,i.m[10]=h*o+1,i.m[11]=0,i.m[12]=s*t.d,i.m[13]=e*t.d,i.m[14]=h*t.d,i.m[15]=1},t._tempQuaternion=new a,t._xAxis=s.Zero(),t._yAxis=s.Zero(),t._zAxis=s.Zero(),t}();t.Matrix=u;var m=function(){function t(t,i,n,r){this.normal=new s(t,i,n),this.d=r}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.getClassName=function(){return"Plane"},t.prototype.getHashCode=function(){var t=this.normal.getHashCode();return t=397*t^(this.d||0)},t.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),i=0;return 0!==t&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this},t.prototype.transform=function(i){var n=u.Transpose(i),r=this.normal.x,o=this.normal.y,s=this.normal.z,e=this.d,h=r*n.m[0]+o*n.m[1]+s*n.m[2]+e*n.m[3],a=r*n.m[4]+o*n.m[5]+s*n.m[6]+e*n.m[7],m=r*n.m[8]+o*n.m[9]+s*n.m[10]+e*n.m[11],y=r*n.m[12]+o*n.m[13]+s*n.m[14]+e*n.m[15];return new t(h,a,m,y)},t.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},t.prototype.copyFromPoints=function(t,i,n){var r,o=i.x-t.x,s=i.y-t.y,e=i.z-t.z,h=n.x-t.x,a=n.y-t.y,u=n.z-t.z,m=s*u-e*a,y=e*h-o*u,c=o*a-s*h,p=Math.sqrt(m*m+y*y+c*c);return r=0!==p?1/p:0,this.normal.x=m*r,this.normal.y=y*r,this.normal.z=c*r,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},t.prototype.isFrontFacingTo=function(t,i){var n=s.Dot(this.normal,t);return i>=n},t.prototype.signedDistanceTo=function(t){return s.Dot(t,this.normal)+this.d},t.FromArray=function(i){return new t(i[0],i[1],i[2],i[3])},t.FromPoints=function(i,n,r){var o=new t(0,0,0,0);return o.copyFromPoints(i,n,r),o},t.FromPositionAndNormal=function(i,n){var r=new t(0,0,0,0);return n.normalize(),r.normal=n,r.d=-(n.x*i.x+n.y*i.y+n.z*i.z),r},t.SignedDistanceToPlaneFromPositionAndNormal=function(t,i,n){var r=-(i.x*t.x+i.y*t.y+i.z*t.z);return s.Dot(n,i)+r},t}();t.Plane=m;var y=function(){function t(t,i,n,r){this.x=t,this.y=i,this.width=n,this.height=r}return t.prototype.toGlobal=function(i,n){return new t(this.x*i,this.y*n,this.width*i,this.height*n)},t}();t.Viewport=y;var c=function(){function t(){}return t.GetPlanes=function(i){for(var n=[],r=0;6>r;r++)n.push(new m(0,0,0,0));return t.GetPlanesToRef(i,n),n},t.GetPlanesToRef=function(t,i){i[0].normal.x=t.m[3]+t.m[2],i[0].normal.y=t.m[7]+t.m[6],i[0].normal.z=t.m[11]+t.m[10],i[0].d=t.m[15]+t.m[14],i[0].normalize(),i[1].normal.x=t.m[3]-t.m[2],i[1].normal.y=t.m[7]-t.m[6],i[1].normal.z=t.m[11]-t.m[10],i[1].d=t.m[15]-t.m[14],i[1].normalize(),i[2].normal.x=t.m[3]+t.m[0],i[2].normal.y=t.m[7]+t.m[4],i[2].normal.z=t.m[11]+t.m[8],i[2].d=t.m[15]+t.m[12],i[2].normalize(),i[3].normal.x=t.m[3]-t.m[0],i[3].normal.y=t.m[7]-t.m[4],i[3].normal.z=t.m[11]-t.m[8],i[3].d=t.m[15]-t.m[12],i[3].normalize(),i[4].normal.x=t.m[3]-t.m[1],i[4].normal.y=t.m[7]-t.m[5],i[4].normal.z=t.m[11]-t.m[9],i[4].d=t.m[15]-t.m[13],i[4].normalize(),i[5].normal.x=t.m[3]+t.m[1],i[5].normal.y=t.m[7]+t.m[5],i[5].normal.z=t.m[11]+t.m[9],i[5].d=t.m[15]+t.m[13],i[5].normalize()},t}();t.Frustum=c,function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD"}(t.Space||(t.Space={}));var p=(t.Space,function(){function t(){}return t.X=new s(1,0,0),t.Y=new s(0,1,0),t.Z=new s(0,0,1),t}());t.Axis=p;var f=function(){function t(){}return t.interpolate=function(t,i,n,r,o){for(var s=1-3*r+3*i,e=3*r-6*i,h=3*i,a=t,u=0;5>u;u++){var m=a*a,y=m*a,c=s*y+e*m+h*a,p=1/(3*s*m+2*e*a+h);a-=(c-t)*p,a=Math.min(1,Math.max(0,a))}return 3*Math.pow(1-a,2)*a*n+3*(1-a)*Math.pow(a,2)*o+Math.pow(a,3)},t}();t.BezierCurve=f,function(t){t[t.CW=0]="CW",t[t.CCW=1]="CCW"}(t.Orientation||(t.Orientation={}));var l=t.Orientation,x=function(){function t(t){var i=this;this.degrees=function(){return 180*i._radians/Math.PI},this.radians=function(){return i._radians},this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(i,n){var r=n.subtract(i),o=Math.atan2(r.y,r.x);return new t(o)},t.FromRadians=function(i){return new t(i)},t.FromDegrees=function(i){return new t(i*Math.PI/180)},t}();t.Angle=x;var z=function(){function t(t,i,n){this.startPoint=t,this.midPoint=i,this.endPoint=n;var r=Math.pow(i.x,2)+Math.pow(i.y,2),s=(Math.pow(t.x,2)+Math.pow(t.y,2)-r)/2,e=(r-Math.pow(n.x,2)-Math.pow(n.y,2))/2,h=(t.x-i.x)*(i.y-n.y)-(i.x-n.x)*(t.y-i.y);this.centerPoint=new o((s*(i.y-n.y)-e*(t.y-i.y))/h,((t.x-i.x)*e-(i.x-n.x)*s)/h),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=x.BetweenTwoPoints(this.centerPoint,this.startPoint);var a=this.startAngle.degrees(),u=x.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),m=x.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-a>180&&(u-=360),-180>u-a&&(u+=360),m-u>180&&(m-=360),-180>m-u&&(m+=360),this.orientation=0>u-a?l.CW:l.CCW,this.angle=x.FromDegrees(this.orientation===l.CW?a-m:m-a)}return t}();t.Arc2=z;var w=function(){function t(t,i){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new o(t,i))}return t.prototype.addLineTo=function(t,i){if(closed)return this;var n=new o(t,i),r=this._points[this._points.length-1];return this._points.push(n),this._length+=n.subtract(r).length(),this},t.prototype.addArcTo=function(t,i,n,r,s){if(void 0===s&&(s=36),closed)return this;var e=this._points[this._points.length-1],h=new o(t,i),a=new o(n,r),u=new z(e,h,a),m=u.angle.radians()/s;u.orientation===l.CW&&(m*=-1);for(var y=u.startAngle.radians()+m,c=0;s>c;c++){var p=Math.cos(y)*u.radius+u.centerPoint.x,f=Math.sin(y)*u.radius+u.centerPoint.y;this.addLineTo(p,f),y+=m}return this},t.prototype.close=function(){return this.closed=!0,this},t.prototype.length=function(){var t=this._length;if(!this.closed){var i=this._points[this._points.length-1],n=this._points[0];t+=n.subtract(i).length()}return t},t.prototype.getPoints=function(){return this._points},t.prototype.getPointAtLengthPosition=function(t){if(0>t||t>1)return o.Zero();for(var i=t*this.length(),n=0,r=0;r<this._points.length;r++){var s=(r+1)%this._points.length,e=this._points[r],h=this._points[s],a=h.subtract(e),u=a.length()+n;if(i>=n&&u>=i){var m=a.normalize(),y=i-n;return new o(e.x+m.x*y,e.y+m.y*y)}n=u}return o.Zero()},t.StartingAt=function(i,n){return new t(i,n)},t}();t.Path2=w;var v=function(){function n(t,i,n){this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var r=0;r<t.length;r++)this._curve[r]=t[r].clone();this._raw=n||!1,this._compute(i)}return n.prototype.getCurve=function(){return this._curve},n.prototype.getTangents=function(){return this._tangents},n.prototype.getNormals=function(){return this._normals},n.prototype.getBinormals=function(){return this._binormals},n.prototype.getDistances=function(){return this._distances},n.prototype.update=function(t,i){for(var n=0;n<t.length;n++)this._curve[n].x=t[n].x,this._curve[n].y=t[n].y,this._curve[n].z=t[n].z;return this._compute(i),this},n.prototype._compute=function(t){var i=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._raw||this._tangents[i-1].normalize();var n=this._tangents[0],r=this._normalVector(this._curve[0],n,t);this._normals[0]=r,this._raw||this._normals[0].normalize(),this._binormals[0]=s.Cross(n,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var o,e,h,a,u=1;i>u;u++)o=this._getLastNonNullVector(u),i-1>u&&(e=this._getFirstNonNullVector(u),this._tangents[u]=o.add(e),this._tangents[u].normalize()),this._distances[u]=this._distances[u-1]+o.length(),h=this._tangents[u],a=this._binormals[u-1],this._normals[u]=s.Cross(a,h),this._raw||this._normals[u].normalize(),this._binormals[u]=s.Cross(h,this._normals[u]),this._raw||this._binormals[u].normalize()},n.prototype._getFirstNonNullVector=function(t){for(var i=1,n=this._curve[t+i].subtract(this._curve[t]);0===n.length()&&t+i+1<this._curve.length;)i++,n=this._curve[t+i].subtract(this._curve[t]);return n},n.prototype._getLastNonNullVector=function(t){for(var i=1,n=this._curve[t].subtract(this._curve[t-i]);0===n.length()&&t>i+1;)i++,n=this._curve[t].subtract(this._curve[t-i]);return n},n.prototype._normalVector=function(n,r,o){var e;if(void 0===o||null===o){var h;i.WithinEpsilon(r.y,1,t.Epsilon)?i.WithinEpsilon(r.x,1,t.Epsilon)?i.WithinEpsilon(r.z,1,t.Epsilon)||(h=new s(0,0,1)):h=new s(1,0,0):h=new s(0,-1,0),e=s.Cross(r,h)}else e=s.Cross(r,o),s.CrossToRef(e,r,e);return e.normalize(),e},n}();t.Path3D=v;var d=function(){function t(t){this._length=0,this._points=t,this._length=this._computeLength(t)}return t.CreateQuadraticBezier=function(i,n,r,o){o=o>2?o:3;for(var e=new Array,h=function(t,i,n,r){var o=(1-t)*(1-t)*i+2*t*(1-t)*n+t*t*r;return o},a=0;o>=a;a++)e.push(new s(h(a/o,i.x,n.x,r.x),h(a/o,i.y,n.y,r.y),h(a/o,i.z,n.z,r.z)));return new t(e)},t.CreateCubicBezier=function(i,n,r,o,e){e=e>3?e:4;for(var h=new Array,a=function(t,i,n,r,o){var s=(1-t)*(1-t)*(1-t)*i+3*t*(1-t)*(1-t)*n+3*t*t*(1-t)*r+t*t*t*o;return s},u=0;e>=u;u++)h.push(new s(a(u/e,i.x,n.x,r.x,o.x),a(u/e,i.y,n.y,r.y,o.y),a(u/e,i.z,n.z,r.z,o.z)));return new t(h)},t.CreateHermiteSpline=function(i,n,r,o,e){for(var h=new Array,a=1/e,u=0;e>=u;u++)h.push(s.Hermite(i,n,r,o,u*a));return new t(h)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype["continue"]=function(i){for(var n=this._points[this._points.length-1],r=this._points.slice(),o=i.getPoints(),s=1;s<o.length;s++)r.push(o[s].subtract(o[0]).add(n));var e=new t(r);return e},t.prototype._computeLength=function(t){for(var i=0,n=1;n<t.length;n++)i+=t[n].subtract(t[n-1]).length();return i},t}();t.Curve3=d;var g=function(){function t(){this.L00=s.Zero(),this.L1_1=s.Zero(),this.L10=s.Zero(),this.L11=s.Zero(),this.L2_2=s.Zero(),this.L2_1=s.Zero(),this.L20=s.Zero(),this.L21=s.Zero(),this.L22=s.Zero()}return t.prototype.addLight=function(t,i,n){var r=new s(i.r,i.g,i.b),o=r.scale(n);this.L00=this.L00.add(o.scale(.282095)),this.L1_1=this.L1_1.add(o.scale(.488603*t.y)),this.L10=this.L10.add(o.scale(.488603*t.z)),this.L11=this.L11.add(o.scale(.488603*t.x)),this.L2_2=this.L2_2.add(o.scale(1.092548*t.x*t.y)),this.L2_1=this.L2_1.add(o.scale(1.092548*t.y*t.z)),this.L21=this.L21.add(o.scale(1.092548*t.x*t.z)),this.L20=this.L20.add(o.scale(.315392*(3*t.z*t.z-1))),this.L22=this.L22.add(o.scale(.546274*(t.x*t.x-t.y*t.y)))},t.prototype.scale=function(t){this.L00=this.L00.scale(t),this.L1_1=this.L1_1.scale(t),this.L10=this.L10.scale(t),this.L11=this.L11.scale(t),this.L2_2=this.L2_2.scale(t),this.L2_1=this.L2_1.scale(t),this.L20=this.L20.scale(t),this.L21=this.L21.scale(t),this.L22=this.L22.scale(t)},t}();t.SphericalHarmonics=g;var T=function(){function t(){this.x=s.Zero(),this.y=s.Zero(),this.z=s.Zero(),this.xx=s.Zero(),this.yy=s.Zero(),this.zz=s.Zero(),this.xy=s.Zero(),this.yz=s.Zero(),this.zx=s.Zero()}return t.prototype.addAmbient=function(t){var i=new s(t.r,t.g,t.b);this.xx=this.xx.add(i),this.yy=this.yy.add(i),this.zz=this.zz.add(i)},t.getSphericalPolynomialFromHarmonics=function(i){var n=new t;return n.x=i.L11.scale(1.02333),n.y=i.L1_1.scale(1.02333),n.z=i.L10.scale(1.02333),n.xx=i.L00.scale(.886277).subtract(i.L20.scale(.247708)).add(i.L22.scale(.429043)),n.yy=i.L00.scale(.886277).subtract(i.L20.scale(.247708)).subtract(i.L22.scale(.429043)),n.zz=i.L00.scale(.886277).add(i.L20.scale(.495417)),n.yz=i.L2_1.scale(.858086),n.zx=i.L21.scale(.858086),n.xy=i.L2_2.scale(.858086),n},t}();t.SphericalPolynomial=T;var R=function(){function t(t,i){void 0===t&&(t=s.Zero()),void 0===i&&(i=s.Up()),this.position=t,this.normal=i}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())},t}();t.PositionNormalVertex=R;var _=function(){function t(t,i,n){void 0===t&&(t=s.Zero()),void 0===i&&(i=s.Up()),void 0===n&&(n=o.Zero()),this.position=t,this.normal=i,this.uv=n}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())},t}();t.PositionNormalTextureVertex=_;var M=function(){function t(){}return t.Color3=[n.Black(),n.Black(),n.Black()],t.Vector2=[o.Zero(),o.Zero(),o.Zero()],t.Vector3=[s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero()],t.Vector4=[e.Zero(),e.Zero(),e.Zero()],t.Quaternion=[new a(0,0,0,0)],t.Matrix=[u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero()],t}();t.Tmp=M}(BABYLON||(BABYLON={}));';("undefined"!=typeof window&&window.module||"undefined"!=typeof module)&&"undefined"!=typeof module.exports&&(module.exports=BABYLON);ie=getInternetExplorerVersion();;this.jukebox={};jukebox.Player=function(b,g){this.id=++jukebox.__jukeboxId;this.origin=g||null;this.settings={};for(var e in this.defaults)this.settings[e]=this.defaults[e];if("[object Object]"===Object.prototype.toString.call(b))for(var c in b)this.settings[c]=b[c];"[object Function]"===Object.prototype.toString.call(jukebox.Manager)&&(jukebox.Manager=new jukebox.Manager());this.resource=this.isPlaying=null;this.resource="[object Object]"===Object.prototype.toString.call(jukebox.Manager)?jukebox.Manager.getPlayableResource(this.settings.resources):this.settings.resources[0]||null;if(null===this.resource)throw"Your browser can't playback the given resources - or you have missed to include jukebox.Manager";this.__init();return this;};jukebox.__jukeboxId=0;jukebox.Player.prototype={defaults:{resources:[],autoplay:!1,spritemap:{},flashMediaElement:"./swf/FlashMediaElement.swf",timeout:1E3},__addToManager:function(){y4tt.v9();!0!==this.__wasAddedToManager&&(jukebox.Manager.add(this),this.__wasAddedToManager=!0);},__init:function(){var b,g,e,c,d;b=this,g=this.settings,e={};jukebox.Manager&&void 0!==jukebox.Manager.features&&(e=jukebox.Manager.features);y4tt.q9();if(!0===e.html5audio){this.context=new Audio();this.context.src=this.resource;if(null===this.origin){d=function(c){b.__addToManager(c);};this.context.addEventListener("canplaythrough",d,!0);window.setTimeout(function(){b.context.removeEventListener("canplaythrough",d,!0);y4tt.v9();d("timeout");},g.timeout);}this.context.autobuffer=!0;this.context.preload=!0;for(c in this.HTML5API)this[c]=this.HTML5API[c];1<e.channels?!0===g.autoplay?this.context.autoplay=!0:void 0!==g.spritemap[g.autoplay]&&this.play(g.autoplay):1===e.channels&&void 0!==g.spritemap[g.autoplay]&&(this.backgroundMusic=g.spritemap[g.autoplay],this.backgroundMusic.started=Date.now?Date.now():+new Date(),this.play(g.autoplay));1==e.channels&&!0!==g.canPlayBackground&&(window.addEventListener("pagehide",function(){y4tt.q9();null!==b.isPlaying&&(b.pause(),b.__wasAutoPaused=!0);}),window.addEventListener("pageshow",function(){y4tt.q9();b.__wasAutoPaused&&(b.resume(),delete b._wasAutoPaused);}));}else if(!0===e.flashaudio){for(c in this.FLASHAPI)this[c]=this.FLASHAPI[c];e=["id=jukebox-flashstream-"+this.id,"autoplay="+g.autoplay,"file="+window.encodeURIComponent(this.resource)];this.__initFlashContext(e);!0===g.autoplay?this.play(0):g.spritemap[g.autoplay]&&this.play(g.autoplay);}else throw"Your Browser does not support Flash Audio or HTML5 Audio.";},__initFlashContext:function(b){var g,e,c,d,f;e=this.settings.flashMediaElement,d={flashvars:b.join("&"),quality:"high",bgcolor:"#000000",wmode:"transparent",allowscriptaccess:"always",allowfullscreen:"true"};if(navigator.userAgent.match(/MSIE/)){g=document.createElement("div");document.getElementsByTagName("body")[0].appendChild(g);f=document.createElement("object");f.id="jukebox-flashstream-"+this.id;f.setAttribute("type","application/x-shockwave-flash");f.setAttribute("classid","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000");f.setAttribute("width","0");f.setAttribute("height","0");d.movie=e+"?x="+(Date.now?Date.now():+new Date());d.flashvars=b.join("&amp;");for(c in d)b=document.createElement("param"),b.setAttribute("name",c),b.setAttribute("value",d[c]),f.appendChild(b);g.outerHTML=f.outerHTML;this.context=document.getElementById("jukebox-flashstream-"+this.id);}else{g=document.createElement("embed");g.id="jukebox-flashstream-"+this.id;g.setAttribute("type","application/x-shockwave-flash");g.setAttribute("width","100");g.setAttribute("height","100");d.play=!1;d.loop=!1;d.src=e+"?x="+(Date.now?Date.now():+new Date());for(c in d)g.setAttribute(c,d[c]);document.getElementsByTagName("body")[0].appendChild(g);this.context=g;}},backgroundHackForiOS:function(){var b;y4tt.v9();if(void 0!==this.backgroundMusic){b=Date.now?Date.now():+new Date();void 0===this.backgroundMusic.started?(this.backgroundMusic.started=b,this.setCurrentTime(this.backgroundMusic.start)):(this.backgroundMusic.lastPointer=(b-this.backgroundMusic.started)/1E3%(this.backgroundMusic.end-this.backgroundMusic.start)+this.backgroundMusic.start,this.play(this.backgroundMusic.lastPointer));}},play:function(b,g){var e,c;y4tt.v9();if(null!==this.isPlaying&&!0!==g)void 0!==jukebox.Manager&&jukebox.Manager.addToQueue(b,this.id);else{e=this.settings.spritemap;if(void 0!==e[b])c=e[b].start;else if("number"===typeof b){c=b;for(var d in e)if(c>=e[d].start&&c<=e[d].end){b=d;break;}}void 0!==c&&"[object Object]"===Object.prototype.toString.call(e[b])&&(this.isPlaying=this.settings.spritemap[b],this.context.play&&this.context.play(),this.wasReady=this.setCurrentTime(c));}},stop:function(){y4tt.q9();this.__lastPosition=0;this.isPlaying=null;this.backgroundMusic?this.backgroundHackForiOS():this.context.pause();return!0;},pause:function(){this.isPlaying=null;this.__lastPosition=this.getCurrentTime();this.context.pause();return this.__lastPosition;},resume:function(b){b="number"===typeof b?b:this.__lastPosition;if(null!==b)return this.play(b),this.__lastPosition=null,!0;this.context.play();return!1;},HTML5API:{getVolume:function(){y4tt.v9();return this.context.volume||1;},setVolume:function(b){this.context.volume=b;return 1E-4>Math.abs(this.context.volume-b)?!0:!1;},getCurrentTime:function(){return this.context.currentTime||0;},setCurrentTime:function(b){try{return this.context.currentTime=b,!0;}catch(g){return!1;}}},FLASHAPI:{getVolume:function(){return this.context&&"function"===typeof this.context.getVolume?this.context.getVolume():1;},setVolume:function(b){y4tt.q9();return this.context&&"function"===typeof this.context.setVolume?(this.context.setVolume(b),!0):!1;},getCurrentTime:function(){return this.context&&"function"===typeof this.context.getCurrentTime?this.context.getCurrentTime():0;},setCurrentTime:function(b){y4tt.v9();return this.context&&"function"===typeof this.context.setCurrentTime?this.context.setCurrentTime(b):!1;}}};if(void 0===this.jukebox)throw"jukebox.Manager requires jukebox.Player (Player.js) to run properly.";jukebox.Manager=function(b){this.features={};this.codecs={};this.__players={};y4tt.v9();this.__playersLength=0;this.__clones={};this.__queue=[];this.settings={};for(var g in this.defaults)this.settings[g]=this.defaults[g];if("[object Object]"===Object.prototype.toString.call(b))for(var e in b)this.settings[e]=b[e];this.__detectFeatures();jukebox.Manager.__initialized=!1===this.settings.useGameLoop?window.setInterval(function(){y4tt.v9();jukebox.Manager.loop();},20):!0;};jukebox.Manager.prototype={defaults:{useFlash:!1,useGameLoop:!1},__detectFeatures:function(){var b;b=window.Audio&&new Audio();if(b&&b.canPlayType&&!1===this.settings.useFlash){for(var g=[{e:"3gp",m:["audio/3gpp","audio/amr"]},{e:"aac",m:["audio/aac","audio/aacp"]},{e:"amr",m:["audio/amr","audio/3gpp"]},{e:"caf",m:["audio/IMA-ADPCM","audio/x-adpcm",'audio/x-aiff; codecs="IMA-ADPCM, ADPCM"']},{e:"m4a",m:'audio/mp4{audio/mp4; codecs="mp4a.40.2,avc1.42E01E"{audio/mpeg4{audio/mpeg4-generic{audio/mp4a-latm{audio/MP4A-LATM{audio/x-m4a'.split("{")},{e:"mp3",m:["audio/mp3","audio/mpeg",'audio/mpeg; codecs="mp3"',"audio/MPA","audio/mpa-robust"]},{e:"mpga",m:["audio/MPA","audio/mpa-robust","audio/mpeg","video/mpeg"]},{e:"mp4",m:["audio/mp4","video/mp4"]},{e:"ogg",m:["application/ogg","audio/ogg",'audio/ogg; codecs="theora, vorbis"',"video/ogg",'video/ogg; codecs="theora, vorbis"']},{e:"wav",m:["audio/wave","audio/wav",'audio/wav; codecs="1"',"audio/x-wav","audio/x-pn-wav"]},{e:"webm",m:["audio/webm",'audio/webm; codecs="vorbis"',"video/webm"]}],e,c,d=0,f=g.length;d<f;d++)if(c=g[d].e,g[d].m.length&&"object"===typeof g[d].m)for(var q=0,j=g[d].m.length;q<j;q++)if(e=g[d].m[q],""!==b.canPlayType(e)){this.codecs[c]=e;break;}else this.codecs[c]||(this.codecs[c]=!1);this.features.html5audio=!(!this.codecs.mp3&&!this.codecs.ogg&&!this.codecs.webm&&!this.codecs.wav);this.features.channels=8;b.volume=0.1337;this.features.volume=!!(1E-4>Math.abs(b.volume-0.1337));navigator.userAgent.match(/iPhone|iPod|iPad/i)&&(this.features.channels=1);}this.features.flashaudio=!!navigator.mimeTypes["application/x-shockwave-flash"]||!!navigator.plugins["Shockwave Flash"]||!1;if(window.ActiveXObject)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash.10"),this.features.flashaudio=!0;}catch(l){}!0===this.settings.useFlash&&(this.features.flashaudio=!0);!0===this.features.flashaudio&&!this.features.html5audio&&(this.codecs.mp3="audio/mp3",this.codecs.mpga="audio/mpeg",this.codecs.mp4="audio/mp4",this.codecs.m4a="audio/mp4",this.codecs["3gp"]="audio/3gpp",this.codecs.amr="audio/amr",this.features.volume=!0,this.features.channels=1);},__getPlayerById:function(b){return this.__players&&void 0!==this.__players[b]?this.__players[b]:null;},__getClone:function(b,g){var c;for(var e in this.__clones){c=this.__clones[e];if(null===c.isPlaying&&c.origin===b)return c;}if("[object Object]"===Object.prototype.toString.call(g)){e={};for(var d in g)e[d]=g[d];e.autoplay=!1;d=new jukebox.Player(e,b);d.isClone=!0;d.wasReady=!1;return this.__clones[d.id]=d;}return null;},loop:function(){var b,g,e;y4tt.q9();if(0!==this.__playersLength)if(this.__queue.length&&this.__playersLength<this.features.channels){b=this.__queue[0],g=this.__getPlayerById(b.origin);if(null!==g){e=this.__getClone(b.origin,g.settings);null!==e&&(!0===this.features.volume&&(g=this.__players[b.origin])&&e.setVolume(g.getVolume()),this.add(e),e.play(b.pointer,!0));}this.__queue.splice(0,1);}else for(e in this.__queue.length&&1===this.features.channels&&(b=this.__queue[0],g=this.__getPlayerById(b.origin),null!==g&&g.play(b.pointer,!0),this.__queue.splice(0,1)),this.__players)b=this.__players[e],g=b.getCurrentTime()||0,b.isPlaying&&!1===b.wasReady?b.wasReady=b.setCurrentTime(b.isPlaying.start):b.isPlaying&&!0===b.wasReady?g>b.isPlaying.end&&(!0===b.isPlaying.loop?b.play(b.isPlaying.start,!0):b.stop()):b.isClone&&null===b.isPlaying?this.remove(b):void 0!==b.backgroundMusic&&null===b.isPlaying&&g>b.backgroundMusic.end&&b.backgroundHackForiOS();},getPlayableResource:function(b){var c,d;"[object Array]"!==Object.prototype.toString.call(b)&&(b=[b]);for(var g=0,e=b.length;g<e;g++){c=b[g],d=c.match(/\.([^\.]*)$/)[1];if(d&&this.codecs[d])return c;}y4tt.q9();return null;},add:function(b){return b instanceof jukebox.Player&&void 0===this.__players[b.id]?(this.__playersLength++,this.__players[b.id]=b,!0):!1;},remove:function(b){return b instanceof jukebox.Player&&void 0!==this.__players[b.id]?(this.__playersLength--,delete this.__players[b.id],!0):!1;},addToQueue:function(b,g){y4tt.v9();return("string"===typeof b||"number"===typeof b)&&void 0!==this.__players[g]?(this.__queue.push({pointer:b,origin:g}),!0):!1;}};(function(){var b,g,e,c,d,f,q,j;b=function(){y4tt.v9();this.init();};b.prototype={init:function(){var b;b=this||g;b._counter=1E3;b._html5AudioPool=[];b.html5PoolSize=10;b._codecs={};b._howls=[];b._muted=!1;b._volume=1;b._canPlayEvent="canplaythrough";b._navigator="undefined"!==typeof window&&window.navigator?window.navigator:null;b.masterGain=null;b.noAudio=!1;b.usingWebAudio=!0;y4tt.q9();b.autoSuspend=!0;b.ctx=null;b.autoUnlock=!0;b._setup();return b;},volume:function(b){var c,q;y4tt.v9();c=this||g;b=parseFloat(b);c.ctx||j();if("undefined"!==typeof b&&0<=b&&1>=b){c._volume=b;if(c._muted)return c;c.usingWebAudio&&c.masterGain.gain.setValueAtTime(b,g.ctx.currentTime);for(var d=0;d<c._howls.length;d++)if(!c._howls[d]._webAudio)for(var e=c._howls[d]._getSoundIds(),f=0;f<e.length;f++){q=c._howls[d]._soundById(e[f]);q&&q._node&&(q._node.volume=q._volume*b);}return c;}return c._volume;},mute:function(b){var c,q;c=this||g;c.ctx||j();c._muted=b;c.usingWebAudio&&c.masterGain.gain.setValueAtTime(b?0:c._volume,g.ctx.currentTime);for(var d=0;d<c._howls.length;d++)if(!c._howls[d]._webAudio)for(var e=c._howls[d]._getSoundIds(),f=0;f<e.length;f++){q=c._howls[d]._soundById(e[f]);q&&q._node&&(q._node.muted=b?!0:q._muted);}y4tt.v9();return c;},unload:function(){for(var b=this||g,c=b._howls.length-1;0<=c;c--)b._howls[c].unload();b.usingWebAudio&&(b.ctx&&"undefined"!==typeof b.ctx.close)&&(b.ctx.close(),b.ctx=null,j());return b;},codecs:function(b){return(this||g)._codecs[b.replace(/^x-/,"")];},_setup:function(){var b,c;b=this||g;b.state=b.ctx?b.ctx.state||"suspended":"suspended";b._autoSuspend();if(!b.usingWebAudio)if("undefined"!==typeof Audio)try{c=new Audio();"undefined"===typeof c.oncanplaythrough&&(b._canPlayEvent="canplay");}catch(d){b.noAudio=!0;}else b.noAudio=!0;try{c=new Audio(),c.muted&&(b.noAudio=!0);}catch(e){}b.noAudio||b._setupCodecs();return b;},_setupCodecs:function(){var b,c,e,f;b=this||g,c=null;try{c="undefined"!==typeof Audio?new Audio():null;}catch(d){return b;}if(!c||"function"!==typeof c.canPlayType)return b;e=c.canPlayType("audio/mpeg;").replace(/^no$/,""),f=b._navigator&&b._navigator.userAgent.match(/OPR\/([0-6].)/g),f=f&&33>parseInt(f[0].split("/")[1],10);b._codecs={mp3:!(f||!e&&!c.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!e,opus:!!c.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!c.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!c.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!c.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!c.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!c.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(c.canPlayType("audio/x-m4a;")||c.canPlayType("audio/m4a;")||c.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(c.canPlayType("audio/x-mp4;")||c.canPlayType("audio/mp4;")||c.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!c.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!c.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!c.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(c.canPlayType("audio/x-flac;")||c.canPlayType("audio/flac;")).replace(/^no$/,"")};return b;},_unlockAudio:function(){var b,c,d;y4tt.v9();b=this||g,c=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi|Chrome|Safari/i.test(b._navigator&&b._navigator.userAgent);if(!b._audioUnlocked&&b.ctx&&c){b._audioUnlocked=!1;b.autoUnlock=!1;!b._mobileUnloaded&&44100!==b.ctx.sampleRate&&(b._mobileUnloaded=!0,b.unload());b._scratchBuffer=b.ctx.createBuffer(1,1,22050);d=function(){var e,g,j;for(var c=0;c<b.html5PoolSize;c++){e=new Audio();e._unlocked=!0;b._releaseHtml5Audio(e);}for(c=0;c<b._howls.length;c++)if(!b._howls[c]._webAudio)for(var e=b._howls[c]._getSoundIds(),f=0;f<e.length;f++){g=b._howls[c]._soundById(e[f]);g&&(g._node&&!g._node._unlocked)&&(g._node._unlocked=!0,g._node.load());}b._autoResume();j=b.ctx.createBufferSource();j.buffer=b._scratchBuffer;j.connect(b.ctx.destination);"undefined"===typeof j.start?j.noteOn(0):j.start(0);"function"===typeof b.ctx.resume&&b.ctx.resume();j.onended=function(){j.disconnect(0);b._audioUnlocked=!0;document.removeEventListener("touchstart",d,!0);document.removeEventListener("touchend",d,!0);document.removeEventListener("click",d,!0);for(var c=0;c<b._howls.length;c++)b._howls[c]._emit("unlock");};};document.addEventListener("touchstart",d,!0);document.addEventListener("touchend",d,!0);document.addEventListener("click",d,!0);return b;}},_obtainHtml5Audio:function(){var b;b=this||g;y4tt.v9();if(b._html5AudioPool.length)return b._html5AudioPool.pop();(b=new Audio().play())&&("undefined"!==typeof Promise&&(b instanceof Promise||"function"===typeof b.then))&&b.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.");});return new Audio();},_releaseHtml5Audio:function(b){var c;c=this||g;b._unlocked&&c._html5AudioPool.push(b);return c;},_autoSuspend:function(){var b;y4tt.q9();b=this;if(b.autoSuspend&&b.ctx&&"undefined"!==typeof b.ctx.suspend&&g.usingWebAudio){for(var c=0;c<b._howls.length;c++)if(b._howls[c]._webAudio)for(var d=0;d<b._howls[c]._sounds.length;d++)if(!b._howls[c]._sounds[d]._paused)return b;b._suspendTimer&&clearTimeout(b._suspendTimer);b._suspendTimer=setTimeout(function(){b.autoSuspend&&(b._suspendTimer=null,b.state="suspending",b.ctx.suspend().then(function(){b.state="suspended";b._resumeAfterSuspend&&(delete b._resumeAfterSuspend,b._autoResume());}));},3E4);return b;}},_autoResume:function(){var b;y4tt.v9();b=this;if(b.ctx&&"undefined"!==typeof b.ctx.resume&&g.usingWebAudio)return"running"===b.state&&b._suspendTimer?(clearTimeout(b._suspendTimer),b._suspendTimer=null):"suspended"===b.state?(b.ctx.resume().then(function(){b.state="running";for(var c=0;c<b._howls.length;c++)b._howls[c]._emit("resume");}),b._suspendTimer&&(clearTimeout(b._suspendTimer),b._suspendTimer=null)):"suspending"===b.state&&(b._resumeAfterSuspend=!0),b;}};g=new b(),e=function(b){!b.src||0===b.src.length?console.error("An array of source files must be passed with any new Howl."):this.init(b);};e.prototype={init:function(b){var c;c=this;g.ctx||j();c._autoplay=b.autoplay||!1;c._format="string"!==typeof b.format?b.format:[b.format];c._html5=b.html5||!1;c._muted=b.mute||!1;c._loop=b.loop||!1;c._pool=b.pool||5;c._preload="boolean"===typeof b.preload?b.preload:!0;c._rate=b.rate||1;c._sprite=b.sprite||{};c._src="string"!==typeof b.src?b.src:[b.src];c._volume=void 0!==b.volume?b.volume:1;c._xhrWithCredentials=b.xhrWithCredentials||!1;c._duration=0;c._state="unloaded";c._sounds=[];c._endTimers={};c._queue=[];c._playLock=!1;c._onend=b.onend?[{fn:b.onend}]:[];c._onfade=b.onfade?[{fn:b.onfade}]:[];c._onload=b.onload?[{fn:b.onload}]:[];c._onloaderror=b.onloaderror?[{fn:b.onloaderror}]:[];c._onplayerror=b.onplayerror?[{fn:b.onplayerror}]:[];c._onpause=b.onpause?[{fn:b.onpause}]:[];c._onplay=b.onplay?[{fn:b.onplay}]:[];c._onstop=b.onstop?[{fn:b.onstop}]:[];c._onmute=b.onmute?[{fn:b.onmute}]:[];c._onvolume=b.onvolume?[{fn:b.onvolume}]:[];c._onrate=b.onrate?[{fn:b.onrate}]:[];c._onseek=b.onseek?[{fn:b.onseek}]:[];c._onunlock=b.onunlock?[{fn:b.onunlock}]:[];c._onresume=[];c._webAudio=g.usingWebAudio&&!c._html5;"undefined"!==typeof g.ctx&&(g.ctx&&g.autoUnlock)&&g._unlockAudio();g._howls.push(c);c._autoplay&&c._queue.push({event:"play",action:function(){y4tt.v9();c.play();}});c._preload&&c.load();return c;},load:function(){var b,j,p,r,s,t;b=null;if(g.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"===typeof this._src&&(this._src=[this._src]);for(var e=0;e<this._src.length;e++){if(this._format&&this._format[e])j=this._format[e];else{p=this._src[e];if("string"!==typeof p){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue;}(j=/^data:audio\/([^;,]+);/i.exec(p))||(j=/\.([^.]+)$/.exec(p.split("?",1)[0]));j&&(j=j[1].toLowerCase());}j||console.warn('No file extension was found. Consider using the "format" property or specify an extension.');if(j&&g.codecs(j)){b=this._src[e];break;}}if(b){this._src=b;this._state="loading";"https:"===window.location.protocol&&"http:"===b.slice(0,5)&&(this._html5=!0,this._webAudio=!1);new c(this);if(this._webAudio){r=this,s=r._src;if(d[s])r._duration=d[s].duration,q(r);else if(/^data:[^;]+;base64,/.test(s)){b=atob(s.split(",")[1]);e=new Uint8Array(b.length);for(j=0;j<b.length;++j)e[j]=b.charCodeAt(j);f(e.buffer,r);}else{t=new XMLHttpRequest();t.open("GET",s,!0);t.withCredentials=r._xhrWithCredentials;t.responseType="arraybuffer";t.onload=function(){var b;y4tt.q9();b=(t.status+"")[0];"0"!==b&&"2"!==b&&"3"!==b?r._emit("loaderror",null,"Failed loading audio file with status: "+t.status+"."):f(t.response,r);};t.onerror=function(){y4tt.q9();r._webAudio&&(r._html5=!0,r._webAudio=!1,r._sounds=[],delete d[s],r.load());};try{t.send();}catch(v){t.onerror();}}}return this;}this._emit("loaderror",null,"No codec support for selected audio sources.");}},play:function(b,c){var d,e,q,v,y,x,z,B,A,C,G,D,H,J;d=this,e=null;if("number"===typeof b)e=b,b=null;else{if("string"===typeof b&&"loaded"===d._state&&!d._sprite[b])return null;if("undefined"===typeof b&&(b="__default",!d._playLock)){for(var f=0,j=0;j<d._sounds.length;j++)d._sounds[j]._paused&&!d._sounds[j]._ended&&(f++,e=d._sounds[j]._id);1===f?b=null:e=null;}}q=e?d._soundById(e):d._inactiveSound();y4tt.v9();if(!q)return null;e&&!b&&(b=q._sprite||"__default");if("loaded"!==d._state){q._sprite=b;q._ended=!1;v=q._id;d._queue.push({event:"play",action:function(){y4tt.q9();d.play(v);}});return v;}if(e&&!q._paused)return c||d._loadQueue("play"),q._id;d._webAudio&&g._autoResume();y=Math.max(0,0<q._seek?q._seek:d._sprite[b][0]/1E3),x=Math.max(0,(d._sprite[b][0]+d._sprite[b][1])/1E3-y),z=1E3*x/Math.abs(q._rate),B=d._sprite[b][0]/1E3,A=(d._sprite[b][0]+d._sprite[b][1])/1E3,C=!(!q._loop&&!d._sprite[b][2]);q._sprite=b;q._ended=!1;G=function(){q._paused=!1;q._seek=y;q._start=B;q._stop=A;y4tt.q9();q._loop=C;};if(y>=A)d._ended(q);else{D=q._node;if(d._webAudio)e=function(){d._playLock=!1;G();d._refreshBuffer(q);D.gain.setValueAtTime(q._muted||d._muted?0:q._volume,g.ctx.currentTime);q._playStart=g.ctx.currentTime;y4tt.v9();"undefined"===typeof D.bufferSource.start?q._loop?D.bufferSource.noteGrainOn(0,y,86400):D.bufferSource.noteGrainOn(0,y,x):q._loop?D.bufferSource.start(0,y,86400):D.bufferSource.start(0,y,x);Infinity!==z&&(d._endTimers[q._id]=setTimeout(d._ended.bind(d,q),z));c||setTimeout(function(){y4tt.q9();d._emit("play",q._id);d._loadQueue();},0);},"running"===g.state?e():(d._playLock=!0,d.once("resume",e),d._clearTimer(q._id));else{H=function(){var e;D.currentTime=y;D.muted=q._muted||d._muted||g._muted||D.muted;D.volume=q._volume*g.volume();D.playbackRate=q._rate;try{e=D.play();e&&"undefined"!==typeof Promise&&(e instanceof Promise||"function"===typeof e.then)?(d._playLock=!0,G(),e.then(function(){d._playLock=!1;D._unlocked=!0;c||(d._emit("play",q._id),d._loadQueue());}).catch(function(){d._playLock=!1;d._emit("playerror",q._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");q._ended=!0;y4tt.q9();q._paused=!0;})):c||(d._playLock=!1,G(),d._emit("play",q._id),d._loadQueue());D.playbackRate=q._rate;D.paused?d._emit("playerror",q._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."):"__default"!==b||q._loop?d._endTimers[q._id]=setTimeout(d._ended.bind(d,q),z):(d._endTimers[q._id]=function(){d._ended(q);y4tt.v9();D.removeEventListener("ended",d._endTimers[q._id],!1);},D.addEventListener("ended",d._endTimers[q._id],!1));}catch(f){d._emit("playerror",q._id,f);}},e=window&&window.ejecta||!D.readyState&&g._navigator.isCocoonJS;if(3<=D.readyState||e)H();else{d._playLock=!0;J=function(){H();y4tt.v9();D.removeEventListener(g._canPlayEvent,J,!1);};D.addEventListener(g._canPlayEvent,J,!1);d._clearTimer(q._id);}}return q._id;}},pause:function(b,c){var d,g;d=this;if("loaded"!==d._state||d._playLock)return d._queue.push({event:"pause",action:function(){y4tt.q9();d.pause(b);}}),d;for(var e=d._getSoundIds(b),f=0;f<e.length;f++){d._clearTimer(e[f]);g=d._soundById(e[f]);if(g&&!g._paused&&(g._seek=d.seek(e[f]),g._rateSeek=0,g._paused=!0,d._stopFade(e[f]),g._node))if(d._webAudio){if(!g._node.bufferSource)continue;"undefined"===typeof g._node.bufferSource.stop?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0);d._cleanBuffer(g._node);}else(!isNaN(g._node.duration)||Infinity===g._node.duration)&&g._node.pause();c||d._emit("pause",g?g._id:null);}return d;},stop:function(b,c){var d,g;d=this;if("loaded"!==d._state||d._playLock)return d._queue.push({event:"stop",action:function(){y4tt.v9();d.stop(b);}}),d;for(var e=d._getSoundIds(b),f=0;f<e.length;f++){d._clearTimer(e[f]);g=d._soundById(e[f]);if(g){g._seek=g._start||0;g._rateSeek=0;g._paused=!0;g._ended=!0;d._stopFade(e[f]);if(g._node)if(d._webAudio)g._node.bufferSource&&("undefined"===typeof g._node.bufferSource.stop?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),d._cleanBuffer(g._node));else if(!isNaN(g._node.duration)||Infinity===g._node.duration)g._node.currentTime=g._start||0,g._node.pause();c||d._emit("stop",g._id);}}return d;},mute:function(b,c){var d,j;d=this;y4tt.v9();if("loaded"!==d._state||d._playLock)return d._queue.push({event:"mute",action:function(){y4tt.v9();d.mute(b,c);}}),d;if("undefined"===typeof c)if("boolean"===typeof b)d._muted=b;else return d._muted;for(var e=d._getSoundIds(c),f=0;f<e.length;f++){j=d._soundById(e[f]);j&&(j._muted=b,j._interval&&d._stopFade(j._id),d._webAudio&&j._node?j._node.gain.setValueAtTime(b?0:j._volume,g.ctx.currentTime):j._node&&(j._node.muted=g._muted?!0:b),d._emit("mute",j._id));}return d;},volume:function(){var b,c,d,e,f;b=this,c=arguments;if(0===c.length)return b._volume;y4tt.q9();1===c.length||2===c.length&&"undefined"===typeof c[1]?0<=b._getSoundIds().indexOf(c[0])?e=parseInt(c[0],10):d=parseFloat(c[0]):2<=c.length&&(d=parseFloat(c[0]),e=parseInt(c[1],10));if("undefined"!==typeof d&&0<=d&&1>=d){if("loaded"!==b._state||b._playLock)return b._queue.push({event:"volume",action:function(){y4tt.v9();b.volume.apply(b,c);}}),b;"undefined"===typeof e&&(b._volume=d);e=b._getSoundIds(e);for(var j=0;j<e.length;j++)if(f=b._soundById(e[j]))f._volume=d,c[2]||b._stopFade(e[j]),b._webAudio&&f._node&&!f._muted?f._node.gain.setValueAtTime(d,g.ctx.currentTime):f._node&&!f._muted&&(f._node.volume=d*g.volume()),b._emit("volume",f._id);}else return(f=e?b._soundById(e):b._sounds[0])?f._volume:0;return b;},fade:function(b,c,d,e){var f,v,y,x;f=this;if("loaded"!==f._state||f._playLock)return f._queue.push({event:"fade",action:function(){f.fade(b,c,d,e);}}),f;b=parseFloat(b);c=parseFloat(c);y4tt.v9();d=parseFloat(d);f.volume(b,e);for(var j=f._getSoundIds(e),q=0;q<j.length;q++){v=f._soundById(j[q]);if(v){e||f._stopFade(j[q]);if(f._webAudio&&!v._muted){y=g.ctx.currentTime,x=y+d/1E3;v._volume=b;v._node.gain.setValueAtTime(b,y);v._node.gain.linearRampToValueAtTime(c,x);}f._startFadeInterval(v,b,c,d,j[q],"undefined"===typeof e);}}return f;},_startFadeInterval:function(b,c,d,e,f,g){var j,q,y,x;j=this,q=c,y=d-c;f=Math.abs(y/0.01);f=Math.max(4,0<f?e/f:e);x=Date.now();b._fadeTo=d;b._interval=setInterval(function(){var f;f=(Date.now()-x)/e;x=Date.now();q+=y*f;q=Math.max(0,q);q=Math.min(1,q);q=Math.round(100*q)/100;j._webAudio?b._volume=q:j.volume(q,b._id,!0);g&&(j._volume=q);if(d<c&&q<=d||d>c&&q>=d)clearInterval(b._interval),b._interval=null,b._fadeTo=null,j.volume(d,b._id),j._emit("fade",b._id);},f);},_stopFade:function(b){var c;c=this._soundById(b);c&&c._interval&&(this._webAudio&&c._node.gain.cancelScheduledValues(g.ctx.currentTime),clearInterval(c._interval),c._interval=null,this.volume(c._fadeTo,b),c._fadeTo=null,this._emit("fade",b));return this;},loop:function(){var b,c,d;b=arguments;if(0===b.length)return this._loop;if(1===b.length)if("boolean"===typeof b[0])this._loop=c=b[0];else return(b=this._soundById(parseInt(b[0],10)))?b._loop:!1;else 2===b.length&&(c=b[0],d=parseInt(b[1],10));d=this._getSoundIds(d);y4tt.v9();for(var e=0;e<d.length;e++)if(b=this._soundById(d[e]))if(b._loop=c,this._webAudio&&(b._node&&b._node.bufferSource)&&(b._node.bufferSource.loop=c))b._node.bufferSource.loopStart=b._start||0,b._node.bufferSource.loopEnd=b._stop;return this;},rate:function(){var b,c,d,e,f,q;b=this,c=arguments;0===c.length?e=b._sounds[0]._id:1===c.length?0<=b._getSoundIds().indexOf(c[0])?e=parseInt(c[0],10):d=parseFloat(c[0]):2===c.length&&(d=parseFloat(c[0]),e=parseInt(c[1],10));if("number"===typeof d){if("loaded"!==b._state||b._playLock)return b._queue.push({event:"rate",action:function(){b.rate.apply(b,c);}}),b;"undefined"===typeof e&&(b._rate=d);e=b._getSoundIds(e);for(var j=0;j<e.length;j++)if(f=b._soundById(e[j])){b.playing(e[j])&&(f._rateSeek=b.seek(e[j]),f._playStart=b._webAudio?g.ctx.currentTime:f._playStart);f._rate=d;b._webAudio&&f._node&&f._node.bufferSource?f._node.bufferSource.playbackRate.setValueAtTime(d,g.ctx.currentTime):f._node&&(f._node.playbackRate=d);q=b.seek(e[j]),q=1E3*((b._sprite[f._sprite][0]+b._sprite[f._sprite][1])/1E3-q)/Math.abs(f._rate);if(b._endTimers[e[j]]||!f._paused)b._clearTimer(e[j]),b._endTimers[e[j]]=setTimeout(b._ended.bind(b,f),q);b._emit("rate",f._id);}}else return(f=b._soundById(e))?f._rate:b._rate;return b;},seek:function(){var b,c,d,e,f,j,q,v;b=this,c=arguments;0===c.length?e=b._sounds[0]._id:1===c.length?0<=b._getSoundIds().indexOf(c[0])?e=parseInt(c[0],10):b._sounds.length&&(e=b._sounds[0]._id,d=parseFloat(c[0])):2===c.length&&(d=parseFloat(c[0]),e=parseInt(c[1],10));if("undefined"===typeof e)return b;if("loaded"!==b._state||b._playLock)return b._queue.push({event:"seek",action:function(){y4tt.v9();b.seek.apply(b,c);}}),b;f=b._soundById(e);if(f)if("number"===typeof d&&0<=d){j=b.playing(e);j&&b.pause(e,!0);f._seek=d;f._ended=!1;b._clearTimer(e);!b._webAudio&&(f._node&&!isNaN(f._node.duration))&&(f._node.currentTime=d);q=function(){b._emit("seek",e);j&&b.play(e,!0);};if(j&&!b._webAudio){v=function(){b._playLock?setTimeout(v,0):q();};setTimeout(v,0);}else q();}else return b._webAudio?(d=b.playing(e)?g.ctx.currentTime-f._playStart:0,f._seek+((f._rateSeek?f._rateSeek-f._seek:0)+d*Math.abs(f._rate))):f._node.currentTime;return b;},playing:function(b){if("number"===typeof b)return(b=this._soundById(b))?!b._paused:!1;for(b=0;b<this._sounds.length;b++)if(!this._sounds[b]._paused)return!0;return!1;},duration:function(b){var c;c=this._duration;(b=this._soundById(b))&&(c=this._sprite[b._sprite][1]/1E3);return c;},state:function(){return this._state;},unload:function(){for(var b=this._sounds,c=0;c<b.length;c++)b[c]._paused||this.stop(b[c]._id),this._webAudio||(/MSIE |Trident\//.test(g._navigator&&g._navigator.userAgent)||(b[c]._node.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"),b[c]._node.removeEventListener("error",b[c]._errorFn,!1),b[c]._node.removeEventListener(g._canPlayEvent,b[c]._loadFn,!1),g._releaseHtml5Audio(b[c]._node)),delete b[c]._node,this._clearTimer(b[c]._id);c=g._howls.indexOf(this);0<=c&&g._howls.splice(c,1);b=!0;for(c=0;c<g._howls.length;c++)if(g._howls[c]._src===this._src||0<=this._src.indexOf(g._howls[c]._src)){b=!1;break;}d&&b&&delete d[this._src];g.noAudio=!1;this._state="unloaded";this._sounds=[];return null;},on:function(b,c,d,e){b=this["_on"+b];"function"===typeof c&&b.push(e?{id:d,fn:c,once:e}:{id:d,fn:c});return this;},off:function(b,c,d){var e,f;e=this["_on"+b],f=0;"number"===typeof c&&(d=c,c=null);if(c||d)for(f=0;f<e.length;f++){if(b=d===e[f].id,c===e[f].fn&&b||!c&&b){e.splice(f,1);break;}}else if(b)this["_on"+b]=[];else{c=Object.keys(this);for(f=0;f<c.length;f++)0===c[f].indexOf("_on")&&Array.isArray(this[c[f]])&&(this[c[f]]=[]);}y4tt.v9();return this;},once:function(b,c,d){this.on(b,c,d,1);y4tt.q9();return this;},_emit:function(b,c,d){for(var e=this["_on"+b],f=e.length-1;0<=f;f--)if(!e[f].id||e[f].id===c||"load"===b)setTimeout(function(b){y4tt.q9();b.call(this,c,d);}.bind(this,e[f].fn),0),e[f].once&&this.off(b,e[f].fn,e[f].id);this._loadQueue(b);y4tt.v9();return this;},_loadQueue:function(b){var c;if(0<this._queue.length){c=this._queue[0];c.event===b&&(this._queue.shift(),this._loadQueue());b||c.action();}return this;},_ended:function(b){var c,d;c=b._sprite;if(!this._webAudio&&b._node&&!b._node.paused&&!b._node.ended&&b._node.currentTime<b._stop)return setTimeout(this._ended.bind(this,b),100),this;c=!(!b._loop&&!this._sprite[c][2]);this._emit("end",b._id);!this._webAudio&&c&&this.stop(b._id,!0).play(b._id);if(this._webAudio&&c){this._emit("play",b._id);b._seek=b._start||0;b._rateSeek=0;b._playStart=g.ctx.currentTime;d=1E3*(b._stop-b._start)/Math.abs(b._rate);this._endTimers[b._id]=setTimeout(this._ended.bind(this,b),d);}this._webAudio&&!c&&(b._paused=!0,b._ended=!0,b._seek=b._start||0,b._rateSeek=0,this._clearTimer(b._id),this._cleanBuffer(b._node),g._autoSuspend());!this._webAudio&&!c&&this.stop(b._id,!0);return this;},_clearTimer:function(b){var c;if(this._endTimers[b]){if("function"!==typeof this._endTimers[b])clearTimeout(this._endTimers[b]);else{c=this._soundById(b);c&&c._node&&c._node.removeEventListener("ended",this._endTimers[b],!1);}delete this._endTimers[b];}y4tt.q9();return this;},_soundById:function(b){y4tt.v9();for(var c=0;c<this._sounds.length;c++)if(b===this._sounds[c]._id)return this._sounds[c];return null;},_inactiveSound:function(){this._drain();for(var b=0;b<this._sounds.length;b++)if(this._sounds[b]._ended)return this._sounds[b].reset();return new c(this);},_drain:function(){var b,c,d;b=this._pool,c=0,d=0;if(!(this._sounds.length<b)){for(d=0;d<this._sounds.length;d++)this._sounds[d]._ended&&c++;for(d=this._sounds.length-1;0<=d&&!(c<=b);d--)this._sounds[d]._ended&&(this._webAudio&&this._sounds[d]._node&&this._sounds[d]._node.disconnect(0),this._sounds.splice(d,1),c--);}},_getSoundIds:function(b){y4tt.v9();if("undefined"===typeof b){b=[];for(var c=0;c<this._sounds.length;c++)b.push(this._sounds[c]._id);return b;}return[b];},_refreshBuffer:function(b){b._node.bufferSource=g.ctx.createBufferSource();b._node.bufferSource.buffer=d[this._src];b._panner?b._node.bufferSource.connect(b._panner):b._node.bufferSource.connect(b._node);y4tt.v9();if(b._node.bufferSource.loop=b._loop)b._node.bufferSource.loopStart=b._start||0,b._node.bufferSource.loopEnd=b._stop||0;b._node.bufferSource.playbackRate.setValueAtTime(b._rate,g.ctx.currentTime);return this;},_cleanBuffer:function(b){var c;c=g._navigator&&0<=g._navigator.vendor.indexOf("Apple");if(g._scratchBuffer&&b.bufferSource&&(b.bufferSource.onended=null,b.bufferSource.disconnect(0),c))try{b.bufferSource.buffer=g._scratchBuffer;}catch(d){}b.bufferSource=null;return this;}};c=function(b){this._parent=b;this.init();};c.prototype={init:function(){var b;b=this._parent;this._muted=b._muted;this._loop=b._loop;this._volume=b._volume;this._rate=b._rate;this._seek=0;this._ended=this._paused=!0;this._sprite="__default";y4tt.v9();this._id=++g._counter;b._sounds.push(this);this.create();return this;},create:function(){var b,c;b=this._parent,c=g._muted||this._muted||this._parent._muted?0:this._volume;y4tt.q9();b._webAudio?(this._node="undefined"===typeof g.ctx.createGain?g.ctx.createGainNode():g.ctx.createGain(),this._node.gain.setValueAtTime(c,g.ctx.currentTime),this._node.paused=!0,this._node.connect(g.masterGain)):(this._node=g._obtainHtml5Audio(),this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(g._canPlayEvent,this._loadFn,!1),this._node.src=b._src,this._node.preload="auto",this._node.volume=c*g.volume(),this._node.load());return this;},reset:function(){var b;b=this._parent;this._muted=b._muted;this._loop=b._loop;this._volume=b._volume;this._rate=b._rate;this._rateSeek=this._seek=0;this._ended=this._paused=!0;this._sprite="__default";this._id=++g._counter;return this;},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0);y4tt.v9();this._node.removeEventListener("error",this._errorFn,!1);},_loadListener:function(){var b;b=this._parent;b._duration=Math.ceil(10*this._node.duration)/10;0===Object.keys(b._sprite).length&&(b._sprite={__default:[0,1E3*b._duration]});"loaded"!==b._state&&(b._state="loaded",b._emit("load"),b._loadQueue());this._node.removeEventListener(g._canPlayEvent,this._loadFn,!1);}};d={},f=function(b,c){var e,f;e=function(){c._emit("loaderror",null,"Decoding audio data failed.");},f=function(b){y4tt.v9();b&&0<c._sounds.length?(d[c._src]=b,q(c,b)):e();};y4tt.v9();"undefined"!==typeof Promise&&1===g.ctx.decodeAudioData.length?g.ctx.decodeAudioData(b).then(f).catch(e):g.ctx.decodeAudioData(b,f,e);},q=function(b,c){c&&!b._duration&&(b._duration=c.duration);0===Object.keys(b._sprite).length&&(b._sprite={__default:[0,1E3*b._duration]});"loaded"!==b._state&&(b._state="loaded",b._emit("load"),b._loadQueue());},j=function(){var c,d;y4tt.v9();if(g.usingWebAudio){try{"undefined"!==typeof AudioContext?g.ctx=new AudioContext():"undefined"!==typeof webkitAudioContext?g.ctx=new webkitAudioContext():g.usingWebAudio=!1;}catch(b){g.usingWebAudio=!1;}g.ctx||(g.usingWebAudio=!1);c=/iP(hone|od|ad)/.test(g._navigator&&g._navigator.platform),d=g._navigator&&g._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),d=d?parseInt(d[1],10):null;if(c&&(d&&9>d)&&(c=/safari/.test(g._navigator&&g._navigator.userAgent.toLowerCase()),g._navigator&&g._navigator.standalone&&!c||g._navigator&&!g._navigator.standalone&&!c))g.usingWebAudio=!1;g.usingWebAudio&&(g.masterGain="undefined"===typeof g.ctx.createGain?g.ctx.createGainNode():g.ctx.createGain(),g.masterGain.gain.setValueAtTime(g._muted?0:1,g.ctx.currentTime),g.masterGain.connect(g.ctx.destination));g._setup();}};"function"===typeof define&&define.amd&&define([],function(){y4tt.q9();return{Howler:g,Howl:e};});"undefined"!==typeof exports&&(exports.Howler=g,exports.Howl=e);"undefined"!==typeof window?(window.HowlerGlobal=b,window.Howler=g,window.Howl=e,window.Sound=c):"undefined"!==typeof global&&(global.HowlerGlobal=b,global.Howler=g,global.Howl=e,global.Sound=c);}());(function(){var b,g,e,c;HowlerGlobal.prototype._pos=[0,0,0];HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0];HowlerGlobal.prototype.stereo=function(b){if(!this.ctx||!this.ctx.listener)return this;for(var c=this._howls.length-1;0<=c;c--)this._howls[c].stereo(b);y4tt.v9();return this;};HowlerGlobal.prototype.pos=function(b,c,e){if(!this.ctx||!this.ctx.listener)return this;c="number"!==typeof c?this._pos[1]:c;e="number"!==typeof e?this._pos[2]:e;if("number"===typeof b)this._pos=[b,c,e],"undefined"!==typeof this.ctx.listener.positionX?(this.ctx.listener.positionX.setTargetAtTime(this._pos[0],Howler.ctx.currentTime,0.1),this.ctx.listener.positionY.setTargetAtTime(this._pos[1],Howler.ctx.currentTime,0.1),this.ctx.listener.positionZ.setTargetAtTime(this._pos[2],Howler.ctx.currentTime,0.1)):this.ctx.listener.setPosition(this._pos[0],this._pos[1],this._pos[2]);else return this._pos;return this;};HowlerGlobal.prototype.orientation=function(b,c,e,g,l,n){var m;if(!this.ctx||!this.ctx.listener)return this;m=this._orientation;c="number"!==typeof c?m[1]:c;e="number"!==typeof e?m[2]:e;g="number"!==typeof g?m[3]:g;l="number"!==typeof l?m[4]:l;n="number"!==typeof n?m[5]:n;if("number"===typeof b)this._orientation=[b,c,e,g,l,n],"undefined"!==typeof this.ctx.listener.forwardX?(this.ctx.listener.forwardX.setTargetAtTime(b,Howler.ctx.currentTime,0.1),this.ctx.listener.forwardY.setTargetAtTime(c,Howler.ctx.currentTime,0.1),this.ctx.listener.forwardZ.setTargetAtTime(e,Howler.ctx.currentTime,0.1),this.ctx.listener.upX.setTargetAtTime(b,Howler.ctx.currentTime,0.1),this.ctx.listener.upY.setTargetAtTime(c,Howler.ctx.currentTime,0.1),this.ctx.listener.upZ.setTargetAtTime(e,Howler.ctx.currentTime,0.1)):this.ctx.listener.setOrientation(b,c,e,g,l,n);else return m;return this;};b=Howl.prototype.init;Howl.prototype.init=function(c){this._orientation=c.orientation||[1,0,0];this._stereo=c.stereo||null;this._pos=c.pos||null;this._pannerAttr={coneInnerAngle:"undefined"!==typeof c.coneInnerAngle?c.coneInnerAngle:360,coneOuterAngle:"undefined"!==typeof c.coneOuterAngle?c.coneOuterAngle:360,coneOuterGain:"undefined"!==typeof c.coneOuterGain?c.coneOuterGain:0,distanceModel:"undefined"!==typeof c.distanceModel?c.distanceModel:"inverse",maxDistance:"undefined"!==typeof c.maxDistance?c.maxDistance:1E4,panningModel:"undefined"!==typeof c.panningModel?c.panningModel:"HRTF",refDistance:"undefined"!==typeof c.refDistance?c.refDistance:1,rolloffFactor:"undefined"!==typeof c.rolloffFactor?c.rolloffFactor:1};this._onstereo=c.onstereo?[{fn:c.onstereo}]:[];y4tt.v9();this._onpos=c.onpos?[{fn:c.onpos}]:[];this._onorientation=c.onorientation?[{fn:c.onorientation}]:[];return b.call(this,c);};Howl.prototype.stereo=function(b,e){var g,j,m;g=this;y4tt.q9();if(!g._webAudio)return g;if("loaded"!==g._state)return g._queue.push({event:"stereo",action:function(){g.stereo(b,e);}}),g;j="undefined"===typeof Howler.ctx.createStereoPanner?"spatial":"stereo";if("undefined"===typeof e)if("number"===typeof b)g._stereo=b,g._pos=[b,0,0];else return g._stereo;for(var l=g._getSoundIds(e),n=0;n<l.length;n++){m=g._soundById(l[n]);if(m)if("number"===typeof b)m._stereo=b,m._pos=[b,0,0],m._node&&(m._pannerAttr.panningModel="equalpower",(!m._panner||!m._panner.pan)&&c(m,j),"spatial"===j?"undefined"!==typeof m._panner.positionX?(m._panner.positionX.setValueAtTime(b,Howler.ctx.currentTime),m._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),m._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):m._panner.setPosition(b,0,0):m._panner.pan.setValueAtTime(b,Howler.ctx.currentTime)),g._emit("stereo",m._id);else return m._stereo;}return g;};Howl.prototype.pos=function(b,e,g,j){var l,p;l=this;y4tt.v9();if(!l._webAudio)return l;if("loaded"!==l._state)return l._queue.push({event:"pos",action:function(){l.pos(b,e,g,j);}}),l;e="number"!==typeof e?0:e;g="number"!==typeof g?-0.5:g;if("undefined"===typeof j)if("number"===typeof b)l._pos=[b,e,g];else return l._pos;for(var n=l._getSoundIds(j),m=0;m<n.length;m++){p=l._soundById(n[m]);if(p)if("number"===typeof b)p._pos=[b,e,g],p._node&&((!p._panner||p._panner.pan)&&c(p,"spatial"),"undefined"!==typeof p._panner.positionX?(p._panner.positionX.setValueAtTime(b,Howler.ctx.currentTime),p._panner.positionY.setValueAtTime(e,Howler.ctx.currentTime),p._panner.positionZ.setValueAtTime(g,Howler.ctx.currentTime)):p._panner.setPosition(b,e,g)),l._emit("pos",p._id);else return p._pos;}return l;};Howl.prototype.orientation=function(b,e,g,j){var l,p;l=this;if(!l._webAudio)return l;if("loaded"!==l._state)return l._queue.push({event:"orientation",action:function(){y4tt.v9();l.orientation(b,e,g,j);}}),l;y4tt.v9();e="number"!==typeof e?l._orientation[1]:e;g="number"!==typeof g?l._orientation[2]:g;if("undefined"===typeof j)if("number"===typeof b)l._orientation=[b,e,g];else return l._orientation;for(var n=l._getSoundIds(j),m=0;m<n.length;m++){p=l._soundById(n[m]);if(p)if("number"===typeof b)p._orientation=[b,e,g],p._node&&(p._panner||(p._pos||(p._pos=l._pos||[0,0,-0.5]),c(p,"spatial")),"undefined"!==typeof p._panner.orientationX?(p._panner.orientationX.setValueAtTime(b,Howler.ctx.currentTime),p._panner.orientationY.setValueAtTime(e,Howler.ctx.currentTime),p._panner.orientationZ.setValueAtTime(g,Howler.ctx.currentTime)):p._panner.setOrientation(b,e,g)),l._emit("orientation",p._id);else return p._orientation;}return l;};Howl.prototype.pannerAttr=function(){var b,e,g,l,n;b=arguments;if(!this._webAudio)return this;if(0===b.length)return this._pannerAttr;if(1===b.length)if("object"===typeof b[0])e=b[0],"undefined"===typeof g&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),this._pannerAttr={coneInnerAngle:"undefined"!==typeof e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:this._coneInnerAngle,coneOuterAngle:"undefined"!==typeof e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:this._coneOuterAngle,coneOuterGain:"undefined"!==typeof e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:this._coneOuterGain,distanceModel:"undefined"!==typeof e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:this._distanceModel,maxDistance:"undefined"!==typeof e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:this._maxDistance,refDistance:"undefined"!==typeof e.pannerAttr.refDistance?e.pannerAttr.refDistance:this._refDistance,rolloffFactor:"undefined"!==typeof e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:this._rolloffFactor,panningModel:"undefined"!==typeof e.pannerAttr.panningModel?e.pannerAttr.panningModel:this._panningModel});else return(b=this._soundById(parseInt(b[0],10)))?b._pannerAttr:this._pannerAttr;else 2===b.length&&(e=b[0],g=parseInt(b[1],10));y4tt.v9();g=this._getSoundIds(g);for(var j=0;j<g.length;j++)if(b=this._soundById(g[j])){l=b._pannerAttr,l={coneInnerAngle:"undefined"!==typeof e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:"undefined"!==typeof e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:"undefined"!==typeof e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:"undefined"!==typeof e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:"undefined"!==typeof e.maxDistance?e.maxDistance:l.maxDistance,refDistance:"undefined"!==typeof e.refDistance?e.refDistance:l.refDistance,rolloffFactor:"undefined"!==typeof e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:"undefined"!==typeof e.panningModel?e.panningModel:l.panningModel},n=b._panner;n?(n.coneInnerAngle=l.coneInnerAngle,n.coneOuterAngle=l.coneOuterAngle,n.coneOuterGain=l.coneOuterGain,n.distanceModel=l.distanceModel,n.maxDistance=l.maxDistance,n.refDistance=l.refDistance,n.rolloffFactor=l.rolloffFactor,n.panningModel=l.panningModel):(b._pos||(b._pos=this._pos||[0,0,-0.5]),c(b,"spatial"));}return this;};g=Sound.prototype.init;Sound.prototype.init=function(){var b;b=this._parent;this._orientation=b._orientation;this._stereo=b._stereo;this._pos=b._pos;this._pannerAttr=b._pannerAttr;g.call(this);this._stereo?b.stereo(this._stereo):this._pos&&b.pos(this._pos[0],this._pos[1],this._pos[2],this._id);};e=Sound.prototype.reset;Sound.prototype.reset=function(){var b;y4tt.v9();b=this._parent;this._orientation=b._orientation;this._stereo=b._stereo;this._pos=b._pos;this._pannerAttr=b._pannerAttr;this._stereo?b.stereo(this._stereo):this._pos?b.pos(this._pos[0],this._pos[1],this._pos[2],this._id):this._panner&&(this._panner.disconnect(0),this._panner=void 0,b._refreshBuffer(this));return e.call(this);};c=function(b,c){"spatial"===(c||"spatial")?(b._panner=Howler.ctx.createPanner(),b._panner.coneInnerAngle=b._pannerAttr.coneInnerAngle,b._panner.coneOuterAngle=b._pannerAttr.coneOuterAngle,b._panner.coneOuterGain=b._pannerAttr.coneOuterGain,b._panner.distanceModel=b._pannerAttr.distanceModel,b._panner.maxDistance=b._pannerAttr.maxDistance,b._panner.refDistance=b._pannerAttr.refDistance,b._panner.rolloffFactor=b._pannerAttr.rolloffFactor,b._panner.panningModel=b._pannerAttr.panningModel,"undefined"!==typeof b._panner.positionX?(b._panner.positionX.setValueAtTime(b._pos[0],Howler.ctx.currentTime),b._panner.positionY.setValueAtTime(b._pos[1],Howler.ctx.currentTime),b._panner.positionZ.setValueAtTime(b._pos[2],Howler.ctx.currentTime)):b._panner.setPosition(b._pos[0],b._pos[1],b._pos[2]),"undefined"!==typeof b._panner.orientationX?(b._panner.orientationX.setValueAtTime(b._orientation[0],Howler.ctx.currentTime),b._panner.orientationY.setValueAtTime(b._orientation[1],Howler.ctx.currentTime),b._panner.orientationZ.setValueAtTime(b._orientation[2],Howler.ctx.currentTime)):b._panner.setOrientation(b._orientation[0],b._orientation[1],b._orientation[2])):(b._panner=Howler.ctx.createStereoPanner(),b._panner.pan.setValueAtTime(b._stereo,Howler.ctx.currentTime));b._panner.connect(b._node);b._paused||b._parent.pause(b._id,!0).play(b._id,!0);};}());(function(b){var g,e,c,d,f,q;Number.prototype.map=function(b,c,d,e){return d+(e-d)*((this-b)/(c-b));};Number.prototype.limit=function(b,c){y4tt.q9();return Math.min(c,Math.max(b,this));};Number.prototype.round=function(b){b=Math.pow(10,b||0);return Math.round(this*b)/b;};Number.prototype.floor=function(){y4tt.q9();return Math.floor(this);};Number.prototype.ceil=function(){y4tt.q9();return Math.ceil(this);};Number.prototype.toInt=function(){return this|0;};Number.prototype.toRad=function(){return this/180*Math.PI;};Number.prototype.toDeg=function(){y4tt.v9();return 180*this/Math.PI;};Array.prototype.erase=function(b){y4tt.v9();for(var c=this.length;c--;)this[c]===b&&this.splice(c,1);return this;};Array.prototype.random=function(){y4tt.q9();return this[Math.floor(Math.random()*this.length)];};Function.prototype.bind=Function.prototype.bind||function(b){var c,d,e,f;if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");c=Array.prototype.slice.call(arguments,1),d=this,e=function(){},f=function(){return d.apply(this instanceof e&&b?this:b,c.concat(Array.prototype.slice.call(arguments)));};y4tt.q9();e.prototype=this.prototype;f.prototype=new e();return f;};b.ig={game:null,debug:null,version:"1.23",global:b,modules:{},resources:[],ready:!1,baked:!1,nocache:"",ua:{},prefix:b.ImpactPrefix||"",lib:"lib/",_current:null,_loadQueue:[],_waitForOnload:0,$:function(b){return"#"==b.charAt(0)?document.getElementById(b.substr(1)):document.getElementsByTagName(b);},$new:function(b){return document.createElement(b);},copy:function(b){if(!b||"object"!=typeof b||b instanceof HTMLElement||b instanceof ig.Class)return b;y4tt.v9();if(b instanceof Array)for(var c=[],d=0,e=b.length;d<e;d++)c[d]=ig.copy(b[d]);else for(d in c={},b)c[d]=ig.copy(b[d]);return c;},merge:function(b,c){var e;for(var d in c){e=c[d];if("object"!=typeof e||e instanceof HTMLElement||e instanceof ig.Class||null===e)b[d]=e;else{if(!b[d]||"object"!=typeof b[d])b[d]=e instanceof Array?[]:{};ig.merge(b[d],e);}}y4tt.v9();return b;},ksort:function(b){var c,d,e;if(!b||"object"!=typeof b)return[];c=[],d=[];y4tt.v9();for(e in b)c.push(e);c.sort();for(e=0;e<c.length;e++)d.push(b[c[e]]);return d;},setVendorAttribute:function(b,c,d){var e;y4tt.v9();e=c.charAt(0).toUpperCase()+c.substr(1);b[c]="undefined"!==typeof b.imageSmoothingEnabled?b["ms"+e]=b["moz"+e]=b["o"+e]=d:b["ms"+e]=b["moz"+e]=b["webkit"+e]=b["o"+e]=d;},getVendorAttribute:function(b,c){var d;d=c.charAt(0).toUpperCase()+c.substr(1);return"undefined"!==typeof b.imageSmoothingEnabled?b[c]||b["ms"+d]||b["moz"+d]||b["o"+d]:b[c]||b["ms"+d]||b["moz"+d]||b["webkit"+d]||b["o"+d];},normalizeVendorAttribute:function(b,c){var d;d=ig.getVendorAttribute(b,c);y4tt.v9();!b[c]&&d&&(b[c]=d);},getImagePixels:function(b,c,d,e,f){var g,q,t,v,y;y4tt.v9();g=ig.$new("canvas");g.width=b.width;g.height=b.height;q=g.getContext("2d");ig.System.SCALE.CRISP(g,q);t=ig.getVendorAttribute(q,"backingStorePixelRatio")||1;ig.normalizeVendorAttribute(q,"getImageDataHD");v=b.width/t,y=b.height/t;g.width=Math.ceil(v);g.height=Math.ceil(y);q.drawImage(b,0,0,v,y);return 1===t?q.getImageData(c,d,e,f):q.getImageDataHD(c,d,e,f);},module:function(b){y4tt.q9();if(ig._current)throw"Module '"+ig._current.name+"' defines nothing";if(ig.modules[b]&&ig.modules[b].body)throw"Module '"+b+"' is already defined";ig._current={name:b,requires:[],loaded:!1,body:null};ig.modules[b]=ig._current;ig._loadQueue.push(ig._current);return ig;},requires:function(){y4tt.q9();ig._current.requires=Array.prototype.slice.call(arguments);return ig;},defines:function(b){y4tt.v9();ig._current.body=b;ig._current=null;ig._initDOMReady();},addResource:function(b){ig.resources.push(b);},setNocache:function(b){ig.nocache=b?"?"+Date.now():"";},log:function(){},assert:function(){},show:function(){},mark:function(){},_loadScript:function(b,c){var d,e;ig.modules[b]={name:b,requires:[],loaded:!1,body:null};ig._waitForOnload++;d=ig.prefix+ig.lib+b.replace(/\./g,"/")+".js"+ig.nocache,e=ig.$new("script");e.type="text/javascript";e.src=d;e.onload=function(){ig._waitForOnload--;y4tt.v9();ig._execModules();};e.onerror=function(){y4tt.v9();throw"Failed to load module "+b+" at "+d+" required from "+c;};ig.$("head")[0].appendChild(e);},_execModules:function(){var g;for(var b=!1,c=0;c<ig._loadQueue.length;c++){for(var d=ig._loadQueue[c],e=!0,f=0;f<d.requires.length;f++){g=d.requires[f];ig.modules[g]?ig.modules[g].loaded||(e=!1):(e=!1,ig._loadScript(g,d.name));}e&&d.body&&(ig._loadQueue.splice(c,1),d.loaded=!0,d.body(),b=!0,c--);}y4tt.q9();if(b)ig._execModules();else if(!ig.baked&&0==ig._waitForOnload&&0!=ig._loadQueue.length){b=[];for(c=0;c<ig._loadQueue.length;c++){e=[];g=ig._loadQueue[c].requires;for(f=0;f<g.length;f++)d=ig.modules[g[f]],(!d||!d.loaded)&&e.push(g[f]);b.push(ig._loadQueue[c].name+" (requires: "+e.join(", ")+")");}throw"Unresolved (or circular?) dependencies. Most likely there's a name/path mismatch for one of the listed modules or a previous syntax error prevents a module from loading:\n"+b.join("\n");}},_DOMReady:function(){if(!ig.modules["dom.ready"].loaded){if(!document.body)return setTimeout(ig._DOMReady,13);ig.modules["dom.ready"].loaded=!0;ig._waitForOnload--;ig._execModules();}y4tt.v9();return 0;},_boot:function(){document.location.href.match(/\?nocache/)&&ig.setNocache(!0);ig.ua.pixelRatio=b.devicePixelRatio||1;ig.ua.viewport={width:b.innerWidth,height:b.innerHeight};ig.ua.screen={width:b.screen.availWidth*ig.ua.pixelRatio,height:b.screen.availHeight*ig.ua.pixelRatio};ig.ua.iPhone=/iPhone/i.test(navigator.userAgent);ig.ua.iPhone4=ig.ua.iPhone&&2==ig.ua.pixelRatio;ig.ua.iPad=/iPad/i.test(navigator.userAgent);ig.ua.android=/android/i.test(navigator.userAgent);ig.ua.winPhone=/Windows Phone/i.test(navigator.userAgent);ig.ua.is_uiwebview=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);ig.ua.is_safari_or_uiwebview=/(iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent);ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad;ig.ua.iOS6_tag=/OS 6_/i.test(navigator.userAgent);ig.ua.iOS6=(ig.ua.iPhone||ig.ua.iPad)&&ig.ua.iOS6_tag;ig.ua.iOSgt5=ig.ua.iOS&&5<parseInt(navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/)[1]);ig.ua.HTCONE=/HTC_One/i.test(navigator.userAgent);ig.ua.winPhone=/Windows Phone/i.test(navigator.userAgent);ig.ua.Kindle=/Silk/i.test(navigator.userAgent);ig.ua.touchDevice="ontouchstart"in b||b.navigator.msMaxTouchPoints;ig.ua.mobile=ig.ua.iOS||ig.ua.android||ig.ua.iOS6||ig.ua.winPhone||ig.ua.Kindle||/mobile/i.test(navigator.userAgent);},_initDOMReady:function(){ig.modules["dom.ready"]?ig._execModules():(ig._boot(),ig.modules["dom.ready"]={requires:[],loaded:!1,body:null},ig._waitForOnload++,"complete"===document.readyState?ig._DOMReady():(document.addEventListener("DOMContentLoaded",ig._DOMReady,!1),b.addEventListener("load",ig._DOMReady,!1)));}};ig.normalizeVendorAttribute(b,"requestAnimationFrame");if(b.requestAnimationFrame){g=1,e={};b.ig.setAnimation=function(c,d){var f,m;f=g++;e[f]=!0;m=function(){y4tt.v9();e[f]&&(b.requestAnimationFrame(m,d),c());};b.requestAnimationFrame(m,d);return f;};b.ig.clearAnimation=function(b){console.log(e);y4tt.q9();delete e[b];};}else b.ig.setAnimation=function(c){return b.setInterval(c,1E3/60);},b.ig.clearAnimation=function(c){y4tt.v9();b.clearInterval(c);};c=!1,d=/xyz/.test(function(){xyz;})?/\bparent\b/:/.*/,f=0;b.ig.Class=function(){};q=function(b){var c,e,f;y4tt.v9();c=this.prototype,e={};for(f in b)"function"==typeof b[f]&&"function"==typeof c[f]&&d.test(b[f])?(e[f]=c[f],c[f]=function(b,c){return function(){var d,f;y4tt.q9();d=this.parent;this.parent=e[b];f=c.apply(this,arguments);this.parent=d;return f;};}(f,b[f])):c[f]=b[f];};b.ig.Class.extend=function(e){var n,m;n=this.prototype;c=!0;function g(){var b;if(!c){if(this.staticInstantiate){b=this.staticInstantiate.apply(this,arguments);if(b)return b;}for(var d in this)"object"==typeof this[d]&&(this[d]=ig.copy(this[d]));this.init&&this.init.apply(this,arguments);}y4tt.v9();return this;}m=new this();c=!1;for(var p in e)m[p]="function"==typeof e[p]&&"function"==typeof n[p]&&d.test(e[p])?function(b,c){y4tt.v9();return function(){var d,e;y4tt.v9();d=this.parent;this.parent=n[b];e=c.apply(this,arguments);this.parent=d;return e;};}(p,e[p]):e[p];g.prototype=m;g.prototype.constructor=g;g.extend=b.ig.Class.extend;g.inject=q;g.classId=m.classId=++f;return g;};b.ImpactMixin&&ig.merge(ig,b.ImpactMixin);}(window));ig.baked=!0;ig.module("impact.image").defines(function(){ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:!1,failed:!1,loadCallback:null,path:"",staticInstantiate:function(b){return ig.Image.cache[b]||null;},init:function(b){this.path=b;y4tt.q9();this.load();},load:function(b){y4tt.v9();this.loaded?b&&b(this.path,!0):(!this.loaded&&ig.ready?(this.loadCallback=b||null,this.data=new Image(),this.data.onload=this.onload.bind(this),this.data.onerror=this.onerror.bind(this),this.data.src=ig.prefix+this.path+ig.nocache):ig.addResource(this),ig.Image.cache[this.path]=this);},reload:function(){this.loaded=!1;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.src=this.path+"?"+Date.now();},onload:function(){this.width=this.data.width;this.height=this.data.height;y4tt.v9();this.loaded=!0;1!=ig.system.scale&&this.resize(ig.system.scale);this.loadCallback&&this.loadCallback(this.path,!0);},onerror:function(){y4tt.v9();this.failed=!0;this.loadCallback&&this.loadCallback(this.path,!1);},resize:function(b){var g,e,c,d,n,m;g=ig.getImagePixels(this.data,0,0,this.width,this.height),e=this.width*b,c=this.height*b,d=ig.$new("canvas");d.width=e;d.height=c;for(var f=d.getContext("2d"),q=f.getImageData(0,0,e,c),j=0;j<c;j++)for(var l=0;l<e;l++){n=4*(Math.floor(j/b)*this.width+Math.floor(l/b)),m=4*(j*e+l);q.data[m]=g.data[n];q.data[m+1]=g.data[n+1];q.data[m+2]=g.data[n+2];q.data[m+3]=g.data[n+3];}f.putImageData(q,0,0);y4tt.v9();this.data=d;},draw:function(b,g,e,c,d,f){var q;y4tt.q9();if(this.loaded){q=ig.system.scale;d=(d?d:this.width)*q;f=(f?f:this.height)*q;ig.system.context.drawImage(this.data,e?e*q:0,c?c*q:0,d,f,ig.system.getDrawPos(b),ig.system.getDrawPos(g),d,f);ig.Image.drawCount++;}},drawTile:function(b,g,e,c,d,f,q){var j,l,n,m,p;d=d?d:c;y4tt.q9();if(this.loaded&&!(c>this.width||d>this.height)){j=ig.system.scale,l=Math.floor(c*j),n=Math.floor(d*j),m=f?-1:1,p=q?-1:1;if(f||q)ig.system.context.save(),ig.system.context.scale(m,p);ig.system.context.drawImage(this.data,Math.floor(e*c)%this.width*j,Math.floor(e*c/this.width)*d*j,l,n,ig.system.getDrawPos(b)*m-(f?l:0),ig.system.getDrawPos(g)*p-(q?n:0),l,n);(f||q)&&ig.system.context.restore();ig.Image.drawCount++;}}});ig.Image.drawCount=0;ig.Image.cache={};ig.Image.reloadCache=function(){y4tt.v9();for(var b in ig.Image.cache)ig.Image.cache[b].reload();};});ig.baked=!0;ig.module("impact.font").requires("impact.image").defines(function(){y4tt.q9();ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(b){this._loadMetrics(this.data);this.parent(b);},widthForString:function(b){if(-1!==b.indexOf("\n")){b=b.split("\n");for(var g=0,e=0;e<b.length;e++)g=Math.max(g,this._widthForLine(b[e]));return g;}y4tt.q9();return this._widthForLine(b);},_widthForLine:function(b){for(var g=0,e=0;e<b.length;e++)g+=this.widthMap[b.charCodeAt(e)-this.firstChar]+this.letterSpacing;y4tt.q9();return g;},heightForString:function(b){return b.split("\n").length*(this.height+this.lineSpacing);},draw:function(b,g,e,c){y4tt.q9();"string"!=typeof b&&(b=b.toString());if(-1!==b.indexOf("\n")){b=b.split("\n");for(var d=this.height+this.lineSpacing,f=0;f<b.length;f++)this.draw(b[f],g,e+f*d,c);}else{if(c==ig.Font.ALIGN.RIGHT||c==ig.Font.ALIGN.CENTER)f=this._widthForLine(b),g-=c==ig.Font.ALIGN.CENTER?f/2:f;1!==this.alpha&&(ig.system.context.globalAlpha=this.alpha);for(f=0;f<b.length;f++)c=b.charCodeAt(f),g+=this._drawChar(c-this.firstChar,g,e);1!==this.alpha&&(ig.system.context.globalAlpha=1);ig.Image.drawCount+=b.length;}},_drawChar:function(b,g,e){var c,d,f;if(!this.loaded||0>b||b>=this.indices.length)return 0;c=ig.system.scale,d=this.widthMap[b]*c,f=(this.height-2)*c;ig.system.context.drawImage(this.data,this.indices[b]*c,0,d,f,ig.system.getDrawPos(g),ig.system.getDrawPos(e),d,f);y4tt.v9();return this.widthMap[b]+this.letterSpacing;},_loadMetrics:function(b){var f;this.height=b.height-1;this.widthMap=[];this.indices=[];for(var g=ig.getImagePixels(b,0,b.height-1,b.width,1),e=0,c=0,d=0;d<b.width;d++){f=4*d+3;127<g.data[f]?c++:128>g.data[f]&&c&&(this.widthMap.push(c),this.indices.push(d-c),e++,c=0);}this.widthMap.push(c);this.indices.push(d-c);}});ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2};});ig.baked=!0;ig.module("impact.sound").defines(function(){ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,init:function(){var e;y4tt.q9();if(!ig.Sound.enabled||!window.Audio)ig.Sound.enabled=!1;else{for(var b=new Audio(),g=0;g<ig.Sound.use.length;g++){e=ig.Sound.use[g];if(b.canPlayType(e.mime)){this.format=e;break;}}this.format||(ig.Sound.enabled=!1);}},load:function(b,g,e){var c,d,f;c=ig.prefix+b.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[b]){if(g&&this.clips[b].length<ig.Sound.channels)for(g=this.clips[b].length;g<ig.Sound.channels;g++){d=new Audio(c);d.load();this.clips[b].push(d);}return this.clips[b][0];}f=new Audio(c);e&&(f.addEventListener("canplaythrough",function j(c){y4tt.v9();f.removeEventListener("canplaythrough",j,!1);e(b,!0,c);},!1),f.addEventListener("error",function(c){y4tt.q9();e(b,!1,c);},!1));f.preload="auto";f.load();this.clips[b]=[f];if(g)for(g=1;g<ig.Sound.channels;g++)d=new Audio(c),d.load(),this.clips[b].push(d);return f;},get:function(b){b=this.clips[b];for(var g=0,e;e=b[g++];)if(e.paused||e.ended)return e.ended&&(e.currentTime=0),e;b[0].pause();b[0].currentTime=0;return b[0];}});ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:!1,_volume:1,_loop:!1,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){y4tt.v9();this._endedCallbackBound=this._endedCallback.bind(this);Object.defineProperty?(Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)}),Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)})):this.__defineGetter__&&(this.__defineGetter__("volume",this.getVolume.bind(this)),this.__defineSetter__("volume",this.setVolume.bind(this)),this.__defineGetter__("loop",this.getLooping.bind(this)),this.__defineSetter__("loop",this.setLooping.bind(this)));},add:function(b,g){var e;y4tt.v9();if(ig.Sound.enabled){e=ig.soundManager.load(b instanceof ig.Sound?b.path:b,!1);e.loop=this._loop;e.volume=this._volume;e.addEventListener("ended",this._endedCallbackBound,!1);this.tracks.push(e);g&&(this.namedTracks[g]=e);this.currentTrack||(this.currentTrack=e);}},next:function(){y4tt.v9();this.tracks.length&&(this.stop(),this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length,this.currentTrack=this.tracks[this.currentIndex],this.play());},pause:function(){y4tt.q9();this.currentTrack&&this.currentTrack.pause();},stop:function(){y4tt.q9();this.currentTrack&&(this.currentTrack.pause(),this.currentTrack.currentTime=0);},play:function(b){y4tt.v9();if(b&&this.namedTracks[b])b=this.namedTracks[b],b!=this.currentTrack&&(this.stop(),this.currentTrack=b);else if(!this.currentTrack)return;this.currentTrack.play();},getLooping:function(){return this._loop;},setLooping:function(b){this._loop=b;for(var g in this.tracks)this.tracks[g].loop=b;},getVolume:function(){y4tt.v9();return this._volume;},setVolume:function(b){this._volume=b.limit(0,1);for(var g in this.tracks)this.tracks[g].volume=this._volume;},fadeOut:function(b){this.currentTrack&&(clearInterval(this._fadeInterval),this.fadeTimer=new ig.Timer(b),this._fadeInterval=setInterval(this._fadeStep.bind(this),50));},_fadeStep:function(){var b;y4tt.v9();b=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;0.01>=b?(this.stop(),this.currentTrack.volume=this._volume,clearInterval(this._fadeInterval)):this.currentTrack.volume=b;},_endedCallback:function(){y4tt.q9();this._loop?this.play():this.next();}});ig.Sound=ig.Class.extend({path:"",volume:1,currentClip:null,multiChannel:!0,init:function(b,g){this.path=b;this.multiChannel=!1!==g;this.load();},load:function(b){ig.Sound.enabled?ig.ready?ig.soundManager.load(this.path,this.multiChannel,b):ig.addResource(this):b&&b(this.path,!0);},play:function(){y4tt.q9();ig.Sound.enabled&&(this.currentClip=ig.soundManager.get(this.path),this.currentClip.volume=ig.soundManager.volume*this.volume,this.currentClip.play());},stop:function(){y4tt.v9();this.currentClip&&(this.currentClip.pause(),this.currentClip.currentTime=0);}});ig.Sound.FORMAT={MP3:{ext:"mp3",mime:"audio/mpeg"},M4A:{ext:"m4a",mime:"audio/mp4; codecs=mp4a"},OGG:{ext:"ogg",mime:"audio/ogg; codecs=vorbis"},WEBM:{ext:"webm",mime:"audio/webm; codecs=vorbis"},CAF:{ext:"caf",mime:"audio/x-caf"}};ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3];y4tt.q9();ig.Sound.channels=4;ig.Sound.enabled=!0;});ig.baked=!0;ig.module("impact.loader").requires("impact.image","impact.font","impact.sound").defines(function(){ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:!1,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(b,g){this.gameClass=b;this.resources=g;this._loadCallbackBound=this._loadCallback.bind(this);for(var e=0;e<this.resources.length;e++)this._unloaded.push(this.resources[e].path);},load:function(){ig.system.clear("#000");y4tt.q9();if(this.resources.length){for(var b=0;b<this.resources.length;b++)this.loadResource(this.resources[b]);this._intervalId=setInterval(this.draw.bind(this),16);}else this.end();},loadResource:function(b){b.load(this._loadCallbackBound);},end:function(){this.done||(this.done=!0,clearInterval(this._intervalId));},draw:function(){},_loadCallback:function(b,g){if(g)this._unloaded.erase(b);else throw"Failed to load resource: "+b;this.status=1-this._unloaded.length/this.resources.length;0==this._unloaded.length&&setTimeout(this.end.bind(this),250);}});});ig.baked=!0;ig.module("impact.timer").defines(function(){ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(b){this.last=this.base=ig.Timer.time;this.target=b||0;},set:function(b){y4tt.v9();this.target=b||0;this.base=ig.Timer.time;this.pausedAt=0;},reset:function(){y4tt.q9();this.base=ig.Timer.time;this.pausedAt=0;},tick:function(){var b;y4tt.q9();b=ig.Timer.time-this.last;this.last=ig.Timer.time;return this.pausedAt?0:b;},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target;},pause:function(){this.pausedAt||(this.pausedAt=ig.Timer.time);},unpause:function(){this.pausedAt&&(this.base+=ig.Timer.time-this.pausedAt,this.pausedAt=0);}});ig.Timer._last=0;ig.Timer.time=Number.MIN_VALUE;ig.Timer.timeScale=1;ig.Timer.maxStep=0.05;y4tt.q9();ig.Timer.step=function(){var b;b=Date.now();y4tt.q9();ig.Timer.time+=Math.min((b-ig.Timer._last)/1E3,ig.Timer.maxStep)*ig.Timer.timeScale;ig.Timer._last=b;};});ig.baked=!0;ig.module("impact.system").requires("impact.timer","impact.image").defines(function(){ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:!1,delegate:null,clock:null,canvas:null,context:null,init:function(b,g,e,c,d){this.fps=g;this.clock=new ig.Timer();this.canvas=ig.$(b);this.resize(e,c,d);this.context=this.canvas.getContext("2d");this.getDrawPos=ig.System.drawMode;1!=this.scale&&(ig.System.scaleMode=ig.System.SCALE.CRISP);ig.System.scaleMode(this.canvas,this.context);},resize:function(b,g,e){this.width=b;this.height=g;this.scale=e||this.scale;this.realWidth=this.width*this.scale;this.realHeight=this.height*this.scale;this.canvas.width=this.realWidth;y4tt.q9();this.canvas.height=this.realHeight;},setGame:function(b){y4tt.q9();this.running?this.newGameClass=b:this.setGameNow(b);},setGameNow:function(b){ig.game=new b();ig.system.setDelegate(ig.game);},setDelegate:function(b){y4tt.q9();if("function"==typeof b.run)this.delegate=b,this.startRunLoop();else throw"System.setDelegate: No run() function in object";},stopRunLoop:function(){ig.clearAnimation(this.animationId);this.running=!1;},startRunLoop:function(){this.stopRunLoop();this.animationId=ig.setAnimation(this.run.bind(this),this.canvas);this.running=!0;},clear:function(b){this.context.fillStyle=b;y4tt.v9();this.context.fillRect(0,0,this.realWidth,this.realHeight);},run:function(){ig.Timer.step();this.tick=this.clock.tick();this.delegate.run();ig.input.clearPressed();this.newGameClass&&(this.setGameNow(this.newGameClass),this.newGameClass=null);},getDrawPos:null});y4tt.v9();ig.System.DRAW={AUTHENTIC:function(b){return Math.round(b)*this.scale;},SMOOTH:function(b){y4tt.v9();return Math.round(b*this.scale);},SUBPIXEL:function(b){y4tt.q9();return b*this.scale;}};ig.System.drawMode=ig.System.DRAW.SMOOTH;ig.System.SCALE={CRISP:function(b,g){ig.setVendorAttribute(g,"imageSmoothingEnabled",!1);b.style.imageRendering="-moz-crisp-edges";b.style.imageRendering="-o-crisp-edges";b.style.imageRendering="-webkit-optimize-contrast";b.style.imageRendering="crisp-edges";b.style.msInterpolationMode="nearest-neighbor";},SMOOTH:function(b,g){y4tt.v9();ig.setVendorAttribute(g,"imageSmoothingEnabled",!0);b.style.imageRendering="";b.style.msInterpolationMode="";}};ig.System.scaleMode=ig.System.SCALE.SMOOTH;});ig.baked=!0;ig.module("impact.input").defines(function(){ig.KEY={MOUSE1:-1,MOUSE2:-3,MWHEEL_UP:-4,MWHEEL_DOWN:-5,BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190};ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:!1,isUsingKeyboard:!1,isUsingAccelerometer:!1,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},initMouse:function(){var b;y4tt.v9();if(!this.isUsingMouse){this.isUsingMouse=!0;b=this.mousewheel.bind(this);ig.system.canvas.addEventListener("mousewheel",b,!1);ig.system.canvas.addEventListener("DOMMouseScroll",b,!1);ig.system.canvas.addEventListener("contextmenu",this.contextmenu.bind(this),!1);ig.system.canvas.addEventListener("mousedown",this.keydown.bind(this),!1);ig.system.canvas.addEventListener("mouseup",this.keyup.bind(this),!1);ig.system.canvas.addEventListener("mousemove",this.mousemove.bind(this),!1);ig.ua.touchDevice&&(ig.system.canvas.addEventListener("touchstart",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("touchend",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("touchmove",this.mousemove.bind(this),!1),ig.system.canvas.addEventListener("MSPointerDown",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("MSPointerUp",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("MSPointerMove",this.mousemove.bind(this),!1),ig.system.canvas.style.msTouchAction="none");}},initKeyboard:function(){y4tt.v9();this.isUsingKeyboard||(this.isUsingKeyboard=!0,window.addEventListener("keydown",this.keydown.bind(this),!1),window.addEventListener("keyup",this.keyup.bind(this),!1));},initAccelerometer:function(){y4tt.q9();this.isUsingAccelerometer||window.addEventListener("devicemotion",this.devicemotion.bind(this),!1);},mousewheel:function(b){var g;g=this.bindings[0<(b.wheelDelta?b.wheelDelta:-1*b.detail)?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN];y4tt.q9();g&&(this.actions[g]=!0,this.presses[g]=!0,this.delayedKeyup[g]=!0,b.stopPropagation(),b.preventDefault());},mousemove:function(b){var g,e;g=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth;ig.ua.mobile&&(g=ig.system.realWidth);g=ig.system.scale*(g/ ig.system.realWidth),e={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(e=ig.system.canvas.getBoundingClientRect());b=b.touches?b.touches[0]:b;y4tt.v9();this.mouse.x=(b.clientX-e.left)/g;this.mouse.y=(b.clientY-e.top)/g;},contextmenu:function(b){this.bindings[ig.KEY.MOUSE2]&&(b.stopPropagation(),b.preventDefault());},keydown:function(b){var g;g=b.target.tagName;"INPUT"==g||"TEXTAREA"==g||(g="keydown"==b.type?b.keyCode:2==b.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1,("touchstart"==b.type||"mousedown"==b.type)&&this.mousemove(b),g=this.bindings[g],console.log(g),g&&(this.actions[g]=!0,this.locks[g]||(this.presses[g]=!0,this.locks[g]=!0),b.stopPropagation(),b.preventDefault()));},keyup:function(b){var g;g=b.target.tagName;y4tt.v9();if(!("INPUT"==g||"TEXTAREA"==g))if(g=this.bindings["keyup"==b.type?b.keyCode:2==b.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1])this.delayedKeyup[g]=!0,b.stopPropagation(),b.preventDefault();},devicemotion:function(b){y4tt.v9();this.accel=b.accelerationIncludingGravity;},bind:function(b,g){0>b?this.initMouse():0<b&&this.initKeyboard();this.bindings[b]=g;},bindTouch:function(b,g){var e,c;e=ig.$(b),c=this;e.addEventListener("touchstart",function(b){y4tt.q9();c.touchStart(b,g);},!1);e.addEventListener("touchend",function(b){c.touchEnd(b,g);},!1);e.addEventListener("MSPointerDown",function(b){c.touchStart(b,g);},!1);e.addEventListener("MSPointerUp",function(b){y4tt.q9();c.touchEnd(b,g);},!1);},unbind:function(b){this.delayedKeyup[this.bindings[b]]=!0;y4tt.q9();this.bindings[b]=null;},unbindAll:function(){this.bindings={};this.actions={};this.presses={};this.locks={};this.delayedKeyup={};},state:function(b){return this.actions[b];},pressed:function(b){y4tt.q9();return this.presses[b];},released:function(b){return!!this.delayedKeyup[b];},clearPressed:function(){for(var b in this.delayedKeyup)this.actions[b]=!1,this.locks[b]=!1;this.delayedKeyup={};this.presses={};},touchStart:function(b,g){y4tt.q9();this.actions[g]=!0;this.presses[g]=!0;b.stopPropagation();b.preventDefault();return!1;},touchEnd:function(b,g){this.delayedKeyup[g]=!0;b.stopPropagation();b.preventDefault();return!1;}});});ig.baked=!0;ig.module("impact.impact").requires("dom.ready","impact.loader","impact.system","impact.input","impact.sound").defines(function(){y4tt.v9();ig.main=function(b,g,e,c,d,f,q){ig.system=new ig.System(b,e,c,d,f||1);ig.input=new ig.Input();ig.soundManager=new ig.SoundManager();ig.music=new ig.Music();ig.ready=!0;new(q||ig.Loader)(g,ig.resources).load();};});ig.baked=!0;ig.module("impact.animation").requires("impact.timer","impact.image").defines(function(){ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(b,g,e){this.width=g;this.height=e;this.image=new ig.Image(b);}});ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:!1,y:!1},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(b,g,e,c){this.sheet=b;this.pivot={x:b.width/2,y:b.height/2};this.timer=new ig.Timer();this.frameTime=g;this.sequence=e;this.stop=!!c;this.tile=this.sequence[0];},rewind:function(){this.timer.set();this.frame=this.loopCount=0;this.tile=this.sequence[0];y4tt.v9();return this;},gotoFrame:function(b){this.timer.set(this.frameTime*-b-1E-4);this.update();},gotoRandomFrame:function(){y4tt.q9();this.gotoFrame(Math.floor(Math.random()*this.sequence.length));},update:function(){var b;b=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(b/this.sequence.length);this.frame=this.stop&&0<this.loopCount?this.sequence.length-1:b%this.sequence.length;y4tt.v9();this.tile=this.sequence[this.frame];},draw:function(b,g){var e;e=Math.max(this.sheet.width,this.sheet.height);y4tt.q9();b>ig.system.width||(g>ig.system.height||0>b+e||0>g+e)||(1!=this.alpha&&(ig.system.context.globalAlpha=this.alpha),0==this.angle?this.sheet.image.drawTile(b,g,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y):(ig.system.context.save(),ig.system.context.translate(ig.system.getDrawPos(b+this.pivot.x),ig.system.getDrawPos(g+this.pivot.y)),ig.system.context.rotate(this.angle),this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y),ig.system.context.restore()),1!=this.alpha&&(ig.system.context.globalAlpha=1));}});});ig.baked=!0;ig.module("impact.entity").requires("impact.animation","impact.impact").defines(function(){ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:!1,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:!1,slopeStanding:{min:44..toRad(),max:136..toRad()},init:function(b,g,e){this.id=++ig.Entity._lastId;y4tt.v9();this.pos.x=this.last.x=b;this.pos.y=this.last.y=g;ig.merge(this,e);},reset:function(b,g,e){var c;c=this.constructor.prototype;this.pos.x=b;this.pos.y=g;this.last.x=b;this.last.y=g;this.vel.x=c.vel.x;this.vel.y=c.vel.y;this.accel.x=c.accel.x;this.accel.y=c.accel.y;this.health=c.health;this._killed=c._killed;this.standing=c.standing;this.type=c.type;this.checkAgainst=c.checkAgainst;this.collides=c.collides;ig.merge(this,e);},addAnim:function(b,g,e,c){if(!this.animSheet)throw"No animSheet to add the animation "+b+" to.";g=new ig.Animation(this.animSheet,g,e,c);this.anims[b]=g;this.currentAnim||(this.currentAnim=g);return g;},update:function(){var b;this.last.x=this.pos.x;this.last.y=this.pos.y;this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor;this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x);this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);b=ig.game.collisionMap.trace(this.pos.x,this.pos.y,this.vel.x*ig.system.tick,this.vel.y*ig.system.tick,this.size.x,this.size.y);this.handleMovementTrace(b);this.currentAnim&&this.currentAnim.update();},getNewVelocity:function(b,g,e,c){return g?(b+g*ig.system.tick).limit(-c,c):e?(g=e*ig.system.tick,0<b-g?b-g:0>b+g?b+g:0):b.limit(-c,c);},handleMovementTrace:function(b){var g,e;this.standing=!1;y4tt.v9();b.collision.y&&(0<this.bounciness&&Math.abs(this.vel.y)>this.minBounceVelocity?this.vel.y*=-this.bounciness:(0<this.vel.y&&(this.standing=!0),this.vel.y=0));b.collision.x&&(this.vel.x=0<this.bounciness&&Math.abs(this.vel.x)>this.minBounceVelocity?this.vel.x*-this.bounciness:0);if(b.collision.slope){g=b.collision.slope;if(0<this.bounciness){e=this.vel.x*g.nx+this.vel.y*g.ny;this.vel.x=(this.vel.x-2*g.nx*e)*this.bounciness;this.vel.y=(this.vel.y-2*g.ny*e)*this.bounciness;}else e=(this.vel.x*g.x+this.vel.y*g.y)/(g.x*g.x+g.y*g.y),this.vel.x=g.x*e,this.vel.y=g.y*e,g=Math.atan2(g.x,g.y),g>this.slopeStanding.min&&g<this.slopeStanding.max&&(this.standing=!0);}this.pos=b.pos;},draw:function(){y4tt.v9();this.currentAnim&&this.currentAnim.draw(this.pos.x-this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y);},kill:function(){y4tt.q9();ig.game.removeEntity(this);},receiveDamage:function(b){this.health-=b;0>=this.health&&this.kill();},touches:function(b){y4tt.v9();return!(this.pos.x>=b.pos.x+b.size.x||this.pos.x+this.size.x<=b.pos.x||this.pos.y>=b.pos.y+b.size.y||this.pos.y+this.size.y<=b.pos.y);},distanceTo:function(b){var g;g=this.pos.x+this.size.x/2-(b.pos.x+b.size.x/2);b=this.pos.y+this.size.y/2-(b.pos.y+b.size.y/2);return Math.sqrt(g*g+b*b);},angleTo:function(b){return Math.atan2(b.pos.y+b.size.y/2-(this.pos.y+this.size.y/2),b.pos.x+b.size.x/2-(this.pos.x+this.size.x/2));},check:function(){},collideWith:function(){},ready:function(){},erase:function(){}});ig.Entity._lastId=0;ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8};ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3};ig.Entity.checkPair=function(b,g){b.checkAgainst&g.type&&b.check(g);g.checkAgainst&b.type&&g.check(b);y4tt.v9();b.collides&&(g.collides&&b.collides+g.collides>ig.Entity.COLLIDES.ACTIVE)&&ig.Entity.solveCollision(b,g);};ig.Entity.solveCollision=function(b,g){var e;e=null;if(b.collides==ig.Entity.COLLIDES.LITE||g.collides==ig.Entity.COLLIDES.FIXED)e=b;else if(g.collides==ig.Entity.COLLIDES.LITE||b.collides==ig.Entity.COLLIDES.FIXED)e=g;y4tt.v9();b.last.x+b.size.x>g.last.x&&b.last.x<g.last.x+g.size.x?(b.last.y<g.last.y?ig.Entity.seperateOnYAxis(b,g,e):ig.Entity.seperateOnYAxis(g,b,e),b.collideWith(g,"y"),g.collideWith(b,"y")):b.last.y+b.size.y>g.last.y&&b.last.y<g.last.y+g.size.y&&(b.last.x<g.last.x?ig.Entity.seperateOnXAxis(b,g,e):ig.Entity.seperateOnXAxis(g,b,e),b.collideWith(g,"x"),g.collideWith(b,"x"));};ig.Entity.seperateOnXAxis=function(b,g,e){var c;c=b.pos.x+b.size.x-g.pos.x;e?(e.vel.x=-e.vel.x*e.bounciness+(b===e?g:b).vel.x,g=ig.game.collisionMap.trace(e.pos.x,e.pos.y,e==b?-c:c,0,e.size.x,e.size.y),e.pos.x=g.pos.x):(e=(b.vel.x-g.vel.x)/2,b.vel.x=-e,g.vel.x=e,e=ig.game.collisionMap.trace(b.pos.x,b.pos.y,-c/2,0,b.size.x,b.size.y),b.pos.x=Math.floor(e.pos.x),b=ig.game.collisionMap.trace(g.pos.x,g.pos.y,c/2,0,g.size.x,g.size.y),g.pos.x=Math.ceil(b.pos.x));};ig.Entity.seperateOnYAxis=function(b,g,e){var c,d;c=b.pos.y+b.size.y-g.pos.y;if(e){g=b===e?g:b;e.vel.y=-e.vel.y*e.bounciness+g.vel.y;d=0;e==b&&Math.abs(e.vel.y-g.vel.y)<e.minBounceVelocity&&(e.standing=!0,d=g.vel.x*ig.system.tick);b=ig.game.collisionMap.trace(e.pos.x,e.pos.y,d,e==b?-c:c,e.size.x,e.size.y);e.pos.y=b.pos.y;e.pos.x=b.pos.x;}else ig.game.gravity&&(g.standing||0<b.vel.y)?(e=ig.game.collisionMap.trace(b.pos.x,b.pos.y,0,-(b.pos.y+b.size.y-g.pos.y),b.size.x,b.size.y),b.pos.y=e.pos.y,0<b.bounciness&&b.vel.y>b.minBounceVelocity?b.vel.y*=-b.bounciness:(b.standing=!0,b.vel.y=0)):(e=(b.vel.y-g.vel.y)/2,b.vel.y=-e,g.vel.y=e,d=g.vel.x*ig.system.tick,e=ig.game.collisionMap.trace(b.pos.x,b.pos.y,d,-c/2,b.size.x,b.size.y),b.pos.y=e.pos.y,b=ig.game.collisionMap.trace(g.pos.x,g.pos.y,0,c/2,g.size.x,g.size.y),g.pos.y=b.pos.y);};});ig.baked=!0;ig.module("impact.map").defines(function(){y4tt.q9();ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(b,g){this.tilesize=b;this.data=g;this.height=g.length;this.width=g[0].length;this.pxWidth=this.width*this.tilesize;this.pxHeight=this.height*this.tilesize;},getTile:function(b,g){var e,c;e=Math.floor(b/this.tilesize),c=Math.floor(g/this.tilesize);y4tt.v9();return 0<=e&&e<this.width&&0<=c&&c<this.height?this.data[c][e]:0;},setTile:function(b,g,e){b=Math.floor(b/this.tilesize);y4tt.v9();g=Math.floor(g/this.tilesize);0<=b&&b<this.width&&(0<=g&&g<this.height)&&(this.data[g][b]=e);}});});ig.baked=!0;ig.module("impact.collision-map").requires("impact.map").defines(function(){var b,g;y4tt.q9();ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,init:function(b,c,d){this.parent(b,c);this.tiledef=d||ig.CollisionMap.defaultTileDef;for(var f in this.tiledef)f|0>this.lastSlope&&(this.lastSlope=f|0);},trace:function(b,c,d,f,g,j){var l,n;l={collision:{x:!1,y:!1,slope:!1},pos:{x:b,y:c},tile:{x:0,y:0}},n=Math.ceil(Math.max(Math.abs(d),Math.abs(f))/this.tilesize);if(1<n)for(var m=d/n,p=f/n,r=0;r<n&&(m||p)&&!(this._traceStep(l,b,c,m,p,g,j,d,f,r),b=l.pos.x,c=l.pos.y,l.collision.x&&(d=m=0),l.collision.y&&(f=p=0),l.collision.slope);r++);else this._traceStep(l,b,c,d,f,g,j,d,f,0);y4tt.q9();return l;},_traceStep:function(b,c,d,f,g,j,l,n,m,p){var r,s,t,v,y;b.pos.x+=f;b.pos.y+=g;r=0;if(f){s=0<f?j:0,t=0>f?this.tilesize:0,r=Math.max(Math.floor(d/this.tilesize),0),v=Math.min(Math.ceil((d+l)/this.tilesize),this.height);f=Math.floor((b.pos.x+s)/this.tilesize);y=Math.floor((c+s)/this.tilesize);if(0<p||f==y||0>y||y>=this.width)y=-1;if(0<=f&&f<this.width)for(var x=r;x<v&&!(-1!=y&&(r=this.data[x][y],1<r&&r<=this.lastSlope&&this._checkTileDef(b,r,c,d,n,m,j,l,y,x)));x++)if(r=this.data[x][f],1==r||r>this.lastSlope||1<r&&this._checkTileDef(b,r,c,d,n,m,j,l,f,x)){if(1<r&&r<=this.lastSlope&&b.collision.slope)break;b.collision.x=!0;b.tile.x=r;c=b.pos.x=f*this.tilesize-s+t;n=0;break;}}if(g){s=0<g?l:0;g=0>g?this.tilesize:0;r=Math.max(Math.floor(b.pos.x/this.tilesize),0);t=Math.min(Math.ceil((b.pos.x+j)/this.tilesize),this.width);x=Math.floor((b.pos.y+s)/this.tilesize);v=Math.floor((d+s)/this.tilesize);if(0<p||x==v||0>v||v>=this.height)v=-1;if(0<=x&&x<this.height)for(f=r;f<t&&!(-1!=v&&(r=this.data[v][f],1<r&&r<=this.lastSlope&&this._checkTileDef(b,r,c,d,n,m,j,l,f,v)));f++)if(r=this.data[x][f],1==r||r>this.lastSlope||1<r&&this._checkTileDef(b,r,c,d,n,m,j,l,f,x)){if(1<r&&r<=this.lastSlope&&b.collision.slope)break;b.collision.y=!0;b.tile.y=r;b.pos.y=x*this.tilesize-s+g;break;}}},_checkTileDef:function(b,c,d,f,g,j,l,n,m,p){var r,s,t,v;r=this.tiledef[c];if(!r)return!1;c=(r[2]-r[0])*this.tilesize;s=(r[3]-r[1])*this.tilesize,t=r[4];l=d+g+(0>s?l:0)-(m+r[0])*this.tilesize;y4tt.v9();n=f+j+(0<c?n:0)-(p+r[1])*this.tilesize;if(0<c*n-s*l){if(0>g*-s+j*c)return t;m=Math.sqrt(c*c+s*s);p=s/m;m=-c/m;v=l*p+n*m,r=p*v,v=m*v;if(r*r+v*v>=g*g+j*j)return t||0.5>c*(n-j)-s*(l-g);b.pos.x=d+g-r;b.pos.y=f+j-v;b.collision.slope={x:c,y:s,nx:p,ny:m};return!0;}return!1;}});b=1/3,g=2/3;ig.CollisionMap.defaultTileDef={5:[0,1,1,g,!0],6:[0,g,1,b,!0],7:[0,b,1,0,!0],3:[0,1,1,0.5,!0],4:[0,0.5,1,0,!0],2:[0,1,1,0,!0],10:[0.5,1,1,0,!0],21:[0,1,0.5,0,!0],32:[g,1,1,0,!0],43:[b,1,g,0,!0],54:[0,1,b,0,!0],27:[0,0,1,b,!0],28:[0,b,1,g,!0],29:[0,g,1,1,!0],25:[0,0,1,0.5,!0],26:[0,0.5,1,1,!0],24:[0,0,1,1,!0],11:[0,0,0.5,1,!0],22:[0.5,0,1,1,!0],33:[0,0,b,1,!0],44:[b,0,g,1,!0],55:[g,0,1,1,!0],16:[1,b,0,0,!0],17:[1,g,0,b,!0],18:[1,1,0,g,!0],14:[1,0.5,0,0,!0],15:[1,1,0,0.5,!0],13:[1,1,0,0,!0],8:[0.5,1,0,0,!0],19:[1,1,0.5,0,!0],30:[b,1,0,0,!0],41:[g,1,b,0,!0],52:[1,1,g,0,!0],38:[1,g,0,1,!0],39:[1,b,0,g,!0],40:[1,0,0,b,!0],36:[1,0.5,0,1,!0],37:[1,0,0,0.5,!0],35:[1,0,0,1,!0],9:[1,0,0.5,1,!0],20:[0.5,0,0,1,!0],31:[1,0,g,1,!0],42:[g,0,b,1,!0],53:[b,0,0,1,!0],12:[0,0,1,0,!1],23:[1,1,0,1,!1],34:[1,0,1,1,!1],45:[0,1,0,0,!1]};ig.CollisionMap.staticNoCollision={trace:function(b,c,d,f){return{collision:{x:!1,y:!1,slope:!1},pos:{x:b+d,y:c+f},tile:{x:0,y:0}};}};});ig.baked=!0;ig.module("impact.background-map").requires("impact.map","impact.image").defines(function(){y4tt.q9();ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:!1,tilesetName:"",foreground:!1,enabled:!0,preRender:!1,preRenderedChunks:null,chunkSize:512,debugChunks:!1,anims:{},init:function(b,g,e){this.parent(b,g);this.setTileset(e);},setTileset:function(b){this.tilesetName=b instanceof ig.Image?b.path:b;this.tiles=new ig.Image(this.tilesetName);this.preRenderedChunks=null;},setScreenPos:function(b,g){y4tt.q9();this.scroll.x=b/this.distance;this.scroll.y=g/this.distance;},preRenderMapToChunks:function(){var b,g,e,c;b=this.width*this.tilesize*ig.system.scale,g=this.height*this.tilesize*ig.system.scale;this.chunkSize=Math.min(Math.max(b,g),this.chunkSize);e=Math.ceil(b/this.chunkSize),c=Math.ceil(g/this.chunkSize);y4tt.q9();this.preRenderedChunks=[];for(var d=0;d<c;d++){this.preRenderedChunks[d]=[];for(var f=0;f<e;f++)this.preRenderedChunks[d][f]=this.preRenderChunk(f,d,f==e-1?b-f*this.chunkSize:this.chunkSize,d==c-1?g-d*this.chunkSize:this.chunkSize);}},preRenderChunk:function(b,g,e,c){var d,f,q,j,l,m;d=e/this.tilesize/ ig.system.scale+1,f=c/this.tilesize/ ig.system.scale+1,q=b*this.chunkSize/ ig.system.scale%this.tilesize,j=g*this.chunkSize/ ig.system.scale%this.tilesize;b=Math.floor(b*this.chunkSize/this.tilesize/ ig.system.scale);g=Math.floor(g*this.chunkSize/this.tilesize/ ig.system.scale);l=ig.$new("canvas");l.width=e;l.height=c;l.retinaResolutionEnabled=!1;c=l.getContext("2d");ig.System.scaleMode(l,c);e=ig.system.context;ig.system.context=c;for(c=0;c<d;c++)for(var n=0;n<f;n++)if(c+b<this.width&&n+g<this.height){m=this.data[n+g][c+b];m&&this.tiles.drawTile(c*this.tilesize-q,n*this.tilesize-j,m-1,this.tilesize);}ig.system.context=e;return l;},draw:function(){this.tiles.loaded&&this.enabled&&(this.preRender?this.drawPreRendered():this.drawTiled());},drawPreRendered:function(){var b,g,e,c,d,f,q,j,p,r,s;this.preRenderedChunks||this.preRenderMapToChunks();b=ig.system.getDrawPos(this.scroll.x),g=ig.system.getDrawPos(this.scroll.y);if(this.repeat)e=this.width*this.tilesize*ig.system.scale,b=(b%e+e)%e,e=this.height*this.tilesize*ig.system.scale,g=(g%e+e)%e;e=Math.max(Math.floor(b/this.chunkSize),0),c=Math.max(Math.floor(g/this.chunkSize),0),d=Math.ceil((b+ig.system.realWidth)/this.chunkSize),f=Math.ceil((g+ig.system.realHeight)/this.chunkSize),q=this.preRenderedChunks[0].length,j=this.preRenderedChunks.length;this.repeat||(d=Math.min(d,q),f=Math.min(f,j));for(var l=0;c<f;c++){for(var n=0,m=e;m<d;m++){p=this.preRenderedChunks[c%j][m%q],r=-b+m*this.chunkSize-n,s=-g+c*this.chunkSize-l;ig.system.context.drawImage(p,r,s);ig.Image.drawCount++;this.debugChunks&&(ig.system.context.strokeStyle="#f0f",ig.system.context.strokeRect(r,s,this.chunkSize,this.chunkSize));this.repeat&&(p.width<this.chunkSize&&r+p.width<ig.system.realWidth)&&(n+=this.chunkSize-p.width,d++);}this.repeat&&(p.height<this.chunkSize&&s+p.height<ig.system.realHeight)&&(l+=this.chunkSize-p.height,f++);}},drawTiled:function(){var n;for(var b=0,g=null,e=(this.scroll.x/this.tilesize).toInt(),c=(this.scroll.y/this.tilesize).toInt(),d=this.scroll.x%this.tilesize,f=this.scroll.y%this.tilesize,q=-d-this.tilesize,d=ig.system.width+this.tilesize-d,j=ig.system.height+this.tilesize-f,l=-1,f=-f-this.tilesize;f<j;l++,f+=this.tilesize){n=l+c;if(n>=this.height||0>n){if(!this.repeat)continue;n=(n%this.height+this.height)%this.height;}for(var m=-1,p=q;p<d;m++,p+=this.tilesize){b=m+e;if(b>=this.width||0>b){if(!this.repeat)continue;b=(b%this.width+this.width)%this.width;}if(b=this.data[n][b])(g=this.anims[b-1])?g.draw(p,f):this.tiles.drawTile(p,f,b-1,this.tilesize);}}}});});ig.baked=!0;ig.module("impact.game").requires("impact.impact","impact.entity","impact.collision-map","impact.background-map").defines(function(){y4tt.q9();ig.Game=ig.Class.extend({clearColor:"#000000",gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:!1,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:!1,staticInstantiate:function(){this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX;ig.game=this;return null;},loadLevel:function(b){var e,c;this.screen={x:0,y:0};this.entities=[];this.namedEntities={};for(var g=0;g<b.entities.length;g++){e=b.entities[g];this.spawnEntity(e.type,e.x,e.y,e.settings);}this.sortEntities();this.collisionMap=ig.CollisionMap.staticNoCollision;y4tt.v9();this.backgroundMaps=[];for(g=0;g<b.layer.length;g++)if(e=b.layer[g],"collision"==e.name)this.collisionMap=new ig.CollisionMap(e.tilesize,e.data);else{c=new ig.BackgroundMap(e.tilesize,e.data,e.tilesetName);c.anims=this.backgroundAnims[e.tilesetName]||{};c.repeat=e.repeat;c.distance=e.distance;c.foreground=!!e.foreground;c.preRender=!!e.preRender;c.name=e.name;this.backgroundMaps.push(c);}for(g=0;g<this.entities.length;g++)this.entities[g].ready();},loadLevelDeferred:function(b){y4tt.v9();this._levelToLoad=b;},getMapByName:function(b){if("collision"==b)return this.collisionMap;y4tt.v9();for(var g=0;g<this.backgroundMaps.length;g++)if(this.backgroundMaps[g].name==b)return this.backgroundMaps[g];return null;},getEntityByName:function(b){return this.namedEntities[b];},getEntitiesByType:function(b){var c;y4tt.q9();b="string"===typeof b?ig.global[b]:b;for(var g=[],e=0;e<this.entities.length;e++){c=this.entities[e];c instanceof b&&!c._killed&&g.push(c);}return g;},spawnEntity:function(b,g,e,c){var d;d="string"===typeof b?ig.global[b]:b;if(!d)throw"Can't spawn entity of type "+b;b=new d(g,e,c||{});this.entities.push(b);b.name&&(this.namedEntities[b.name]=b);y4tt.q9();return b;},sortEntities:function(){this.entities.sort(this.sortBy);},sortEntitiesDeferred:function(){this._doSortEntities=!0;},removeEntity:function(b){b.name&&delete this.namedEntities[b.name];b._killed=!0;y4tt.v9();b.type=ig.Entity.TYPE.NONE;b.checkAgainst=ig.Entity.TYPE.NONE;b.collides=ig.Entity.COLLIDES.NEVER;this._deferredKill.push(b);},run:function(){this.update();this.draw();},update:function(){var b,e;this._levelToLoad&&(this.loadLevel(this._levelToLoad),this._levelToLoad=null);this.updateEntities();this.checkEntities();for(var b=0;b<this._deferredKill.length;b++)this._deferredKill[b].erase(),this.entities.erase(this._deferredKill[b]);this._deferredKill=[];if(this._doSortEntities||this.autoSort)this.sortEntities(),this._doSortEntities=!1;for(var g in this.backgroundAnims){b=this.backgroundAnims[g];for(e in b)b[e].update();}},updateEntities:function(){var g;y4tt.v9();for(var b=0;b<this.entities.length;b++){g=this.entities[b];g._killed||g.update();}},draw:function(){var b,g;y4tt.v9();this.clearColor&&ig.system.clear(this.clearColor);this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ ig.system.scale;this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ ig.system.scale;for(b=0;b<this.backgroundMaps.length;b++){g=this.backgroundMaps[b];if(g.foreground)break;g.setScreenPos(this.screen.x,this.screen.y);g.draw();}this.drawEntities();for(b;b<this.backgroundMaps.length;b++)g=this.backgroundMaps[b],g.setScreenPos(this.screen.x,this.screen.y),g.draw();},drawEntities:function(){y4tt.q9();for(var b=0;b<this.entities.length;b++)this.entities[b].draw();},checkEntities:function(){var e;for(var b={},g=0;g<this.entities.length;g++){e=this.entities[g];if(!(e.type==ig.Entity.TYPE.NONE&&e.checkAgainst==ig.Entity.TYPE.NONE&&e.collides==ig.Entity.COLLIDES.NEVER))for(var c={},d=Math.floor(e.pos.y/this.cellSize),f=Math.floor((e.pos.x+e.size.x)/this.cellSize)+1,q=Math.floor((e.pos.y+e.size.y)/this.cellSize)+1,j=Math.floor(e.pos.x/this.cellSize);j<f;j++)for(var l=d;l<q;l++)if(b[j])if(b[j][l]){for(var n=b[j][l],m=0;m<n.length;m++)e.touches(n[m])&&!c[n[m].id]&&(c[n[m].id]=!0,ig.Entity.checkPair(e,n[m]));n.push(e);}else b[j][l]=[e];else b[j]={},b[j][l]=[e];}}});ig.Game.SORT={Z_INDEX:function(b,g){y4tt.q9();return b.zIndex-g.zIndex;},POS_X:function(b,g){y4tt.q9();return b.pos.x+b.size.x-(g.pos.x+g.size.x);},POS_Y:function(b,g){return b.pos.y+b.size.y-(g.pos.y+g.size.y);}};});ig.baked=!0;ig.module("plugins.patches.webkit-image-smoothing-patch").defines(function(){y4tt.q9();ig.System&&(ig.System.SCALE={CRISP:function(b,g){y4tt.v9();g.imageSmoothingEnabled=g.msImageSmoothingEnabled=g.mozImageSmoothingEnabled=g.oImageSmoothingEnabled=!1;b.style.imageRendering="-moz-crisp-edges";b.style.imageRendering="-o-crisp-edges";b.style.imageRendering="-webkit-optimize-contrast";b.style.imageRendering="crisp-edges";b.style.msInterpolationMode="nearest-neighbor";},SMOOTH:function(b,g){g.imageSmoothingEnabled=g.msImageSmoothingEnabled=g.mozImageSmoothingEnabled=g.oImageSmoothingEnabled=!0;b.style.imageRendering="";b.style.msInterpolationMode="";}},ig.System.scaleMode=ig.System.SCALE.SMOOTH);});ig.baked=!0;ig.module("plugins.patches.windowfocus-onMouseDown-patch").defines(function(){var b;b=!1;try{b=window.self!==window.top,!1===b&&(b=0<window.frames.length);}catch(g){b=!0;}y4tt.q9();ig.Input.inject({keydown:function(e){var c;c=e.target.tagName;y4tt.q9();if(!("INPUT"==c||"TEXTAREA"==c))if(c="keydown"==e.type?e.keyCode:2==e.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1,b&&0>c&&window.focus(),("touchstart"==e.type||"mousedown"==e.type)&&this.mousemove(e),c=this.bindings[c])this.actions[c]=!0,this.locks[c]||(this.presses[c]=!0,this.locks[c]=!0),e.stopPropagation(),e.preventDefault();}});});ig.baked=!0;ig.module("plugins.patches.mouse-move-patch").defines(function(){ig.Input.inject({move:new BABYLON.Vector2(0,0),initMouse:function(){var b;y4tt.q9();if(!this.isUsingMouse){this.isUsingMouse=!0;b=this.mousewheel.bind(this);ig.system.canvas.addEventListener("mousewheel",b,!1);ig.system.canvas.addEventListener("DOMMouseScroll",b,!1);ig.system.canvas.addEventListener("contextmenu",this.contextmenu.bind(this),!1);ig.system.canvas.addEventListener("mousedown",this.keydown.bind(this),!1);ig.system.canvas.addEventListener("mouseup",this.keyup.bind(this),!1);ig.system.canvas.addEventListener("mousemove",this.mousemove.bind(this),!1);ig.ua.touchDevice&&(ig.system.canvas.addEventListener("touchstart",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("touchend",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("touchmove",this.mousemove.bind(this),!1),ig.system.canvas.addEventListener("MSPointerDown",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("MSPointerUp",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("MSPointerMove",this.mousemove.bind(this),!1),ig.system.canvas.style.msTouchAction="none");}},mousemove:function(b){var g,e,c;g=parseInt(wgl.system.canvas.offsetWidth);parseInt(wgl.system.canvas.offsetHeight);ig.ua.mobile&&(g=ig.system.realWidth);g=ig.system.scale*(g/ ig.system.realWidth),e={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(e=ig.system.canvas.getBoundingClientRect());c=b.touches?b.touches[0]:b;this.mouse.x=(c.clientX-e.left)/g;this.mouse.y=(c.clientY-e.top)/g;void 0!==typeof b.movementX?(this.move.x=b.movementX,this.move.y=b.movementY):(this.move.x=0,this.move.y=0);}});});ig.baked=!0;ig.module("plugins.handlers.dom-handler").defines(function(){y4tt.q9();ig.DomHandler=ig.Class.extend({JQUERYAVAILABLE:!1,init:function(){this.JQUERYAVAILABLE=this._jqueryAvailable();},_jqueryAvailable:function(){return"undefined"!==typeof jQuery;},addEvent:function(b,g,e,c){y4tt.v9();if(this.JQUERYAVAILABLE)b.on(g,e);else b.addEventListener(g,e,c);},create:function(b){y4tt.q9();return this.JQUERYAVAILABLE?$("<"+b+">"):ig.$new(b);},getElementByClass:function(b){return this.JQUERYAVAILABLE?$("."+b):document.getElementsByClassName(b);},getElementById:function(b){y4tt.v9();return this.JQUERYAVAILABLE?0<$(b).length?$(b):null:ig.$(b);},appendChild:function(b,g){y4tt.v9();this.JQUERYAVAILABLE?b.append(g):b.appendChild(g);},appendToBody:function(b){this.JQUERYAVAILABLE?$("body").append(b):document.body.appendChild(b);},resize:function(b,g,e){var c;if(this.JQUERYAVAILABLE)b.width(g.toFixed(2)),b.height(e.toFixed(2));else{c=b.style.visibility;g="width:"+g.toFixed(2)+"px; height:"+e.toFixed(2)+"px;";this.attr(b,"style",g);b.style.visibility=c;}},resizeOffsetLeft:function(b,g,e,c){var d;y4tt.v9();if(this.JQUERYAVAILABLE)b.width(g.toFixed(2)),b.height(e.toFixed(2)),b.css("left",c);else{d=b.style.visibility;g="width:"+g.toFixed(2)+"px; height:"+e.toFixed(2)+"px; left: "+c.toFixed(2)+"px;";this.attr(b,"style",g);b.style.visibility=d;}},css:function(b,g){var e,c;y4tt.v9();if(this.JQUERYAVAILABLE)b.css(g);else{e="";for(c in g)e+=c+":"+g[c]+";";this.attr(b,"style",e);}},getOffsets:function(b){return this.JQUERYAVAILABLE?(b=b.offset(),{left:b.left,top:b.top}):{left:b.offsetLeft,top:b.offsetTop};},attr:function(b,g,e){if("undefined"===typeof e)return this.JQUERYAVAILABLE?b.attr(g):b.getAttribute(g);this.JQUERYAVAILABLE?b.attr(g,e):b.setAttribute(g,e);},show:function(b){y4tt.v9();this.JQUERYAVAILABLE?(b.show(),b.css("visibility","visible")):b&&(b.style?b.style.visibility="visible":b[0]&&(b[0].style.visibility="visible"));},hide:function(b){this.JQUERYAVAILABLE?(b.hide(),b.css("visibility","hidden")):b&&(b.style?b.style.visibility="hidden":b[0]&&(b[0].style.visibility="hidden"));},getQueryVariable:function(b){var c;for(var g=window.location.search.substring(1).split("&"),e=0;e<g.length;e++){c=g[e].split("=");if(decodeURIComponent(c[0])==b)return decodeURIComponent(c[1]);}},forcedDeviceDetection:function(){var b;b=this.getQueryVariable("device");if(b)switch(b){case"mobile":console.log("serving mobile version ...");ig.ua.mobile=!0;break;case"desktop":console.log("serving desktop version ...");ig.ua.mobile=!1;break;default:console.log("serving universal version ...");}else console.log("serving universal version ...");},forcedDeviceRotation:function(){var b;b=this.getQueryVariable("force-rotate");if(b)switch(b){case"portrait":console.log("force rotate to portrait");window.orientation=0;break;case"landscape":console.log("force rotate to horizontal");window.orientation=90;break;default:alert("wrong command/type in param force-rotate. Defaulting value to portrait"),window.orientation=0;}},setZIndex:function(b,g){this.JQUERYAVAILABLE?b.css("zIndex",g):b&&(b.style?b.style.zIndex=g:b[0]&&(b[0].style.zIndex=g));}});});ig.baked=!0;ig.module("plugins.handlers.size-handler").defines(function(){y4tt.v9();ig.SizeHandler=ig.Class.extend({portraitMode:!0,desktop:{actualSize:new BABYLON.Vector2(window.innerWidth,window.innerHeight),actualResolution:new BABYLON.Vector2(480,640)},mobile:{actualSize:new BABYLON.Vector2(window.innerWidth,window.innerHeight),actualResolution:new BABYLON.Vector2(480,640)},windowSize:new BABYLON.Vector2(window.innerWidth,window.innerHeight),scaleRatioMultiplier:new BABYLON.Vector2(1,1),sizeRatio:new BABYLON.Vector2(1,1),scale:1,domHandler:null,dynamicClickableEntityDivs:{},coreDivsToResize:["#canvas","#play","#orientate","#webglcanvas"],adsToResize:{MobileAdInGamePreroll:{"box-width":_SETTINGS.Ad.Mobile.Preroll.Width+2,"box-height":_SETTINGS.Ad.Mobile.Preroll.Height+20},MobileAdInGameEnd:{"box-width":_SETTINGS.Ad.Mobile.End.Width+2,"box-height":_SETTINGS.Ad.Mobile.End.Height+20},MobileAdInGamePreroll2:{"box-width":_SETTINGS.Ad.Mobile.Preroll.Width+2,"box-height":_SETTINGS.Ad.Mobile.Preroll.Height+20},MobileAdInGameEnd2:{"box-width":_SETTINGS.Ad.Mobile.End.Width+2,"box-height":_SETTINGS.Ad.Mobile.End.Height+20},MobileAdInGamePreroll3:{"box-width":_SETTINGS.Ad.Mobile.Preroll.Width+2,"box-height":_SETTINGS.Ad.Mobile.Preroll.Height+20},MobileAdInGameEnd3:{"box-width":_SETTINGS.Ad.Mobile.End.Width+2,"box-height":_SETTINGS.Ad.Mobile.End.Height+20}},init:function(b){this.domHandler=b;if("undefined"===typeof b)throw"undefined Dom Handler for Size Handler";y4tt.v9();this.sizeCalcs();this.eventListenerSetup();this.samsungFix();},sizeCalcs:function(){var b,g;this.windowSize=new BABYLON.Vector2(window.innerWidth,window.innerHeight);y4tt.q9();if(ig.ua.mobile){this.mobile.actualSize=new BABYLON.Vector2(window.innerWidth,window.innerHeight);b=new BABYLON.Vector2(this.mobile.actualResolution.x,this.mobile.actualResolution.y);this.scaleRatioMultiplier=new BABYLON.Vector2(this.mobile.actualSize.x/b.x,this.mobile.actualSize.y/b.y);g=Math.min(this.scaleRatioMultiplier.x,this.scaleRatioMultiplier.y);this.mobile.actualSize.x=b.x*this.scaleRatioMultiplier.x;this.mobile.actualSize.y=b.y*this.scaleRatioMultiplier.y;}else this.desktop.actualSize=new BABYLON.Vector2(window.innerWidth,window.innerHeight),b=new BABYLON.Vector2(this.desktop.actualResolution.x,this.desktop.actualResolution.y),this.scaleRatioMultiplier=new BABYLON.Vector2(this.desktop.actualSize.x/b.x,this.desktop.actualSize.y/b.y),g=Math.min(this.scaleRatioMultiplier.x,this.scaleRatioMultiplier.y),this.desktop.actualSize.x=b.x*g,this.desktop.actualSize.y=b.y*g;this.sizeRatio.x=window.innerWidth/this.mobile.actualResolution.x;this.sizeRatio.y=window.innerHeight/this.mobile.actualResolution.y;},resizeLayers:function(){var g,b,c,d,f,q,j,l;for(var b=0;b<this.coreDivsToResize.length;b++){g=ig.domHandler.getElementById(this.coreDivsToResize[b]);g&&(ig.ua.mobile?ig.domHandler.resize(g,Math.floor(ig.sizeHandler.mobile.actualSize.x),Math.floor(ig.sizeHandler.mobile.actualSize.y)):ig.domHandler.resizeOffsetLeft(g,Math.floor(ig.sizeHandler.desktop.actualSize.x),Math.floor(ig.sizeHandler.desktop.actualSize.y),Math.floor((ig.sizeHandler.windowSize.x>>1)-(ig.sizeHandler.desktop.actualSize.x>>1))));}for(var e in this.adsToResize){b=ig.domHandler.getElementById("#"+e),g=ig.domHandler.getElementById("#"+e+"-Box"),c=(window.innerWidth-this.adsToResize[e]["box-width"]>>1)+"px",d=(window.innerHeight-this.adsToResize[e]["box-height"]>>1)+"px";b&&ig.domHandler.css(b,{width:window.innerWidth,height:window.innerHeight});g&&ig.domHandler.css(g,{left:c,top:d});}for(e in this.dynamicClickableEntityDivs){g=Math.min(ig.sizeHandler.scaleRatioMultiplier.x,ig.sizeHandler.scaleRatioMultiplier.y);b=ig.domHandler.getElementById("#"+e);if(ig.ua.mobile)f=this.dynamicClickableEntityDivs[e].entity_pos_x,q=this.dynamicClickableEntityDivs[e].entity_pos_y,d=this.dynamicClickableEntityDivs[e].width,c=this.dynamicClickableEntityDivs[e].height,j=Math.floor(f*this.scaleRatioMultiplier.x)+"px",q=Math.floor(q*this.scaleRatioMultiplier.y)+"px",d=Math.floor(d*this.scaleRatioMultiplier.x)+"px",g=Math.floor(c*this.scaleRatioMultiplier.y)+"px";else c=ig.domHandler.getElementById("#canvas"),c=ig.domHandler.getOffsets(c),j=c.left,l=c.top,f=this.dynamicClickableEntityDivs[e].entity_pos_x,q=this.dynamicClickableEntityDivs[e].entity_pos_y,d=this.dynamicClickableEntityDivs[e].width,c=this.dynamicClickableEntityDivs[e].height,j=Math.floor(j+f*g)+"px",q=Math.floor(l+q*g)+"px",d=Math.floor(d*g)+"px",g=Math.floor(c*g)+"px";ig.domHandler.css(b,{"float":"left",position:"absolute",left:j,top:q,width:d,height:g,"z-index":3});}$("#ajaxbar").width(this.windowSize.x);$("#ajaxbar").height(this.windowSize.y);},resize:function(){ig.ua.touchDevice||wgl.system.engine.resize();y4tt.q9();this.sizeCalcs();this.resizeLayers();},reorient:function(){var b,g,e;window.scrollTo(0,1);if(ig.ua.mobile){wgl.system.engine.resize();b=this.portraitMode?window.innerHeight<window.innerWidth:window.innerHeight>window.innerWidth,g=this.domHandler.getElementById("#orientate"),e=this.domHandler.getElementById("#game");b?(this.domHandler.show(g),this.domHandler.hide(e)):(this.domHandler.show(e),this.domHandler.hide(g));}y4tt.q9();ig.ua.mobile?(this.resize(),this.resizeAds()):this.resize();wgl.system.engine.setSize(ig.system.width,ig.system.height);},resizeAds:function(){var g,e,c,d;y4tt.v9();for(var b in this.adsToResize){g=ig.domHandler.getElementById("#"+b),e=ig.domHandler.getElementById("#"+b+"-Box"),c=(window.innerWidth-this.adsToResize[b]["box-width"]>>1)+"px",d=(window.innerHeight-this.adsToResize[b]["box-height"]>>1)+"px";g&&ig.domHandler.css(g,{width:window.innerWidth,height:window.innerHeight});e&&ig.domHandler.css(e,{left:c,top:d});}},samsungFix:function(){y4tt.q9();ig.ua.android&&(!(4.2>parseFloat(navigator.userAgent.slice(navigator.userAgent.indexOf("Android")+8,navigator.userAgent.indexOf("Android")+11)))&&!(0>navigator.userAgent.indexOf("GT"))&&!(0<navigator.userAgent.indexOf("Chrome"))&&!(0<navigator.userAgent.indexOf("Firefox")))&&(document.addEventListener("touchstart",function(b){y4tt.v9();b.preventDefault();return!1;},!1),document.addEventListener("touchmove",function(b){b.preventDefault();return!1;},!1),document.addEventListener("touchend",function(b){b.preventDefault();y4tt.v9();return!1;},!1));},orientationInterval:null,orientationTimeout:null,orientationHandler:function(){this.reorient();window.scrollTo(0,1);},orientationDelayHandler:function(){null==this.orientationInterval&&(this.orientationInterval=window.setInterval(this.orientationHandler.bind(this),100));null==this.orientationTimeout&&(this.orientationTimeout=window.setTimeout(function(){y4tt.q9();this.clearAllIntervals();}.bind(this),2E3));},clearAllIntervals:function(){window.clearInterval(this.orientationInterval);this.orientationInterval=null;window.clearTimeout(this.orientationTimeout);this.orientationTimeout=null;},eventListenerSetup:function(){ig.ua.iOS?(window.addEventListener("orientationchange",this.orientationDelayHandler.bind(this)),window.addEventListener("resize",this.orientationDelayHandler.bind(this))):(window.addEventListener("orientationchange",this.orientationHandler.bind(this)),window.addEventListener("resize",this.orientationHandler.bind(this)));}});});ig.baked=!0;ig.module("plugins.handlers.api-handler").defines(function(){y4tt.v9();ig.ApiHandler=ig.Class.extend({apiAvailable:{MJSPreroll:function(){ig.ua.mobile&&ig.domHandler.JQUERYAVAILABLE&&_SETTINGS&&_SETTINGS.Ad.Mobile.Preroll.Enabled&&MobileAdInGamePreroll.Initialize();},MJSHeader:function(){y4tt.q9();ig.ua.mobile&&ig.domHandler.JQUERYAVAILABLE&&_SETTINGS.Ad.Mobile.Header.Enabled&&MobileAdInGameHeader.Initialize();},MJSFooter:function(){ig.ua.mobile&&ig.domHandler.JQUERYAVAILABLE&&_SETTINGS.Ad.Mobile.Footer.Enabled&&MobileAdInGameFooter.Initialize();},MJSEnd:function(){ig.ua.mobile&&ig.domHandler.JQUERYAVAILABLE&&_SETTINGS.Ad.Mobile.End.Enabled&&MobileAdInGameEnd.Initialize();}},run:function(b,g){if(this.apiAvailable[b])this.apiAvailable[b](g);}});});ig.baked=!0;ig.module("plugins.audio.sound-player").defines(function(){SoundPlayer=ig.Class.extend({tagName:"SoundPlayer",stayMuteFlag:!1,debug:!1,init:function(){y4tt.v9();this.debug&&console.log(this.tagName);},play:function(b){y4tt.q9();this.debug&&console.log("play sound ",b);},stop:function(){this.debug&&console.log("stop sound ");},volume:function(){y4tt.v9();this.debug&&console.log("set volume");},mute:function(b){this.debug&&console.log("mute");"undefined"===typeof b?this.stayMuteFlag=!0:b&&(this.stayMuteFlag=!0);},unmute:function(b){y4tt.v9();this.debug&&console.log("unmute");"undefined"===typeof b?this.stayMuteFlag=!1:b&&(this.stayMuteFlag=!1);}});});ig.baked=!0;ig.module("plugins.audio.impact-music-player").requires("plugins.audio.sound-player").defines(function(){ImpactMusicPlayer=SoundPlayer.extend({tagName:"ImpactMusicPlayer",bgmPlaying:!1,soundList:{},init:function(b,g){this.parent(b,g);for(var e in b)this.soundList[e]=e,ig.music.add(b[e].path+".*",e);g&&g.loop&&(ig.music.loop=g.loop);},play:function(b){y4tt.v9();this.stayMuteFlag||(this.bgmPlaying=!0,"undefined"===typeof b?ig.music.play(b):ig.music.play());},stop:function(){this.bgmPlaying=!1;y4tt.v9();ig.music.pause();},volume:function(b){console.log("impactmusic:",b);ig.music.volume=0>b?0:isNaN(b)?1:1<b?1:b;},getVolume:function(){return ig.music.volume;},mute:function(b){y4tt.v9();this.parent(b);this.bgmPlaying&&this.stop();},unmute:function(b){this.parent(b);this.play();}});});ig.baked=!0;ig.module("plugins.audio.impact-sound-player").requires("plugins.audio.sound-player").defines(function(){ImpactSoundPlayer=SoundPlayer.extend({tagName:"ImpactSoundPlayer",soundList:{},init:function(b,g){var c;this.parent(b,g);for(var e in b){c=new ig.Sound(b[e].path+".*");this.soundList[e]=c;}},play:function(b){this.stayMuteFlag||("object"===typeof b?(console.log(b+" exists"),b.play()):"string"===typeof b&&this.soundList[b].play());},stop:function(b){this.parent(b);b.stop();},volume:function(b){y4tt.v9();ig.soundManager.volume=0>b?0:isNaN(b)?1:1<b?1:b;},getVolume:function(){return ig.soundManager.volume;},mute:function(b){this.parent(b);ig.Sound.enabled=!1;},unmute:function(b){this.parent(b);ig.Sound.enabled=!0;}});});ig.baked=!0;ig.module("plugins.audio.howler-player").requires("plugins.audio.sound-player").defines(function(){y4tt.q9();HowlerPlayer=SoundPlayer.extend({tagName:"HowlerPlayer",soundList:{},init:function(b,g){var c;this.parent(b,g);for(var e in b){c=b[e].path,c=new Howl({src:[c+"."+ig.Sound.FORMAT.OGG.ext,c+"."+ig.Sound.FORMAT.MP3.ext]});this.soundList[e]=c;}},play:function(b){this.stayMuteFlag||("object"===typeof b?b.play():"string"===typeof b&&this.soundList[b].play());},stop:function(b){y4tt.q9();this.parent(b);b.stop();},volume:function(b){y4tt.q9();for(var g in this.soundList){if(0>b){this.soundList[g].volume(0);break;}isNaN(b)?this.soundList[g].volume(1):1<b?this.soundList[g].volume(1):this.soundList[g].volume(b);}},getVolume:function(){y4tt.q9();for(var b in this.soundList)return this.soundList[b].volume();},mute:function(b){y4tt.q9();this.parent(b);Howler.mute(!0);},unmute:function(b){y4tt.q9();this.parent(b);Howler.mute(!1);}});});ig.baked=!0;ig.module("plugins.audio.howler-music-player").requires("plugins.audio.sound-player").defines(function(){y4tt.v9();HowlerMusicPlayer=SoundPlayer.extend({tagName:"HowlerMusicPlayer",bgmPlaying:!1,soundList:{},init:function(b,g){var c;this.parent(b,g);y4tt.v9();for(var e in b){c=b[e].path,c=new Howl({src:[c+"."+ig.Sound.FORMAT.OGG.ext,c+"."+ig.Sound.FORMAT.MP3.ext],loop:!0,autoplay:!1,onend:function(){}.bind(this)});this.soundList[e]=c;}},play:function(b){if(!this.stayMuteFlag&&!this.bgmPlaying)if("object"===typeof b)this.bgmPlaying=!0,b.play();else if("string"===typeof b)this.bgmPlaying=!0,this.soundList[b].play();else for(var g in this.soundList){this.soundList[g].play();this.bgmPlaying=!0;break;}},stop:function(b){y4tt.q9();this.parent(b);if(this.bgmPlaying){for(var g in this.soundList)this.soundList[g].stop();this.bgmPlaying=!1;}},volume:function(b){y4tt.q9();for(var g in this.soundList){if(0>b){this.soundList[g].volume(0);break;}isNaN(b)?this.soundList[g].volume(1):1<b?this.soundList[g].volume(1):this.soundList[g].volume(b);}},getVolume:function(){for(var b in this.soundList)return this.soundList[b].volume();},mute:function(b){y4tt.q9();this.parent(b);Howler.mute(!0);},unmute:function(b){this.parent(b);Howler.mute(!1);}});});ig.baked=!0;ig.module("plugins.audio.jukebox-player").requires("plugins.audio.sound-player").defines(function(){JukeboxPlayer=SoundPlayer.extend({tagName:"JukeboxPlayer",bgmPlaying:!1,soundList:{},jukeboxPlayer:null,pausePosition:0,premuteVolume:0,minVolume:0.001,init:function(b,g){var c;this.parent(b,g);for(var e in b){this.soundList[e]=e;c=b[e].path;this.jukeboxPlayer=new jukebox.Player({resources:[c+(525.85===3904?(633.79,0x2263):".")+ig.Sound.FORMAT.OGG.ext,c+"."+ig.Sound.FORMAT.MP3.ext],autoplay:!1,spritemap:{music:{start:b[e].startMp3,end:b[e].endMp3,loop:!0}}});}},play:function(){this.stayMuteFlag||(this.bgmPlaying=!0,this.pausePosition?(console.log("resume"),this.jukeboxPlayer.resume(this.pausePosition)):(console.log("play"),this.jukeboxPlayer.play(this.jukeboxPlayer.settings.spritemap.music.start,!0)),this.premuteVolume=this.getVolume());},stop:function(){this.bgmPlaying=!1;this.pausePosition=this.jukeboxPlayer.pause();},volume:function(b){y4tt.q9();console.log("jukebox:",b);0>=b?this.jukeboxPlayer.setVolume(this.minVolume):isNaN(b)?this.jukeboxPlayer.setVolume(1):1<b?this.jukeboxPlayer.setVolume(1):this.jukeboxPlayer.setVolume(b);},getVolume:function(){y4tt.q9();return this.jukeboxPlayer.getVolume();},mute:function(b){this.parent(b);this.bgmPlaying&&(console.log("jukebox",this.premuteVolume),this.stayMuteFlag||(this.premuteVolume=this.getVolume()),this.jukeboxPlayer.pause(),this.jukeboxPlayer.setVolume(this.minVolume));},unmute:function(b){this.parent(b);this.stayMuteFlag||(console.log("jukebox",this.premuteVolume),this.jukeboxPlayer.setVolume(this.premuteVolume),this.jukeboxPlayer.resume());}});});ig.baked=!0;ig.module("plugins.audio.webaudio-music-player").requires("plugins.audio.sound-player").defines(function(){y4tt.q9();WebaudioMusicPlayer=SoundPlayer.extend({tagName:"WebaudioMusicPlayer",bgmPlaying:!1,isSupported:!1,muteFlag:!1,pausedTime:0,webaudio:null,useHTML5Audio:!1,audio:null,inactiveAudio:null,codecs:null,_volume:1,soundList:{},init:function(b){y4tt.v9();this.webaudio={compatibility:{},gainNode:null,buffer:null,source_loop:{},source_once:{}};try{this.AudioContext=window.AudioContext||window.webkitAudioContext,this.webaudio.context=new this.AudioContext(),this.isSupported=!0;}catch(g){console.log("Web Audio API not supported in this browser."),this.webaudio=null,this.useHTML5Audio=!0;}if(this.useHTML5Audio)if("undefined"!==typeof Audio)try{new Audio();}catch(e){this.useHTML5Audio=!1;}else this.useHTML5Audio=!1;this.useHTML5Audio&&(this.audio=new Audio(),this.isSupported=!0,this.initHTML5Audio(b));if(!this.isSupported)return null;this.webaudio&&this.initWebAudio(b);},initWebAudio:function(b){var g,e,c,f,q;ig.ua.iOS&&this.initIOSWebAudioUnlock();this.webaudio.gainNode=this.webaudio.context.createGain();this.webaudio.gainNode.connect(this.webaudio.context.destination);y4tt.v9();this.webaudio.gainNode.gain.value=this._volume;g="start",e="stop",c=this.webaudio.context.createBufferSource();"function"!==typeof c.start&&(g="noteOn");this.webaudio.compatibility.start=g;"function"!==typeof c.stop&&(e="noteOff");this.webaudio.compatibility.stop=e;for(var d in b){this.soundList[d]=d;g=b[d].path;b=g+"."+ig.Sound.FORMAT.MP3.ext;f=g+"."+ig.Sound.FORMAT.OGG.ext;ig.ua.mobile?ig.ua.iOS&&(f=b):(g=navigator.userAgent.toLowerCase(),-1!=g.indexOf("safari")&&-1>=g.indexOf("chrome")&&(f=b));q=new XMLHttpRequest();q.open("GET",f,!0);q.responseType="arraybuffer";q.onload=function(){y4tt.v9();this.webaudio.context.decodeAudioData(q.response,function(b){this.webaudio.buffer=b;this.webaudio.source_loop={};this.bgmPlaying?this.play():this.stop();}.bind(this),function(){y4tt.v9();console.log('Error decoding audio "'+f+'".');});}.bind(this);q.send();break;}},initIOSWebAudioUnlock:function(){var b;if(this.webaudio){webaudio=this.webaudio;b=function(){var g,e,c;g=webaudio.context,e=g.createBuffer(1,1,22050),c=g.createBufferSource();c.buffer=e;c.connect(g.destination);y4tt.q9();"undefined"===typeof c.start?c.noteOn(0):c.start(0);setTimeout(function(){(c.playbackState===c.PLAYING_STATE||c.playbackState===c.FINISHED_STATE)&&window.removeEventListener("touchend",b,!1);},0);};window.addEventListener("touchend",b,!1);}},initHTML5Audio:function(b){var g,c,d,f;y4tt.v9();if(this.useHTML5Audio&&this.audio){g=this.audio;this.codecs={};this.codecs={mp3:!!g.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!g.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!g.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!g.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!g.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(g.canPlayType("audio/x-m4a;")||g.canPlayType("audio/m4a;")||g.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(g.canPlayType("audio/x-mp4;")||g.canPlayType("audio/mp4;")||g.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!g.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")};this.is={ff:Boolean(null!=window.mozInnerScreenX&&/firefox/.test(navigator.userAgent.toLowerCase())),ie:Boolean(document.all&&!window.opera),opera:Boolean(window.opera),chrome:Boolean(window.chrome),safari:Boolean(!window.chrome&&/safari/.test(navigator.userAgent.toLowerCase())&&window.getComputedStyle&&!window.globalStorage&&!window.opera)};this.playDelay=-60;this.stopDelay=30;this.is.chrome&&(this.playDelay=-25);this.is.chrome&&(this.stopDelay=25);this.is.ff&&(this.playDelay=-25);this.is.ff&&(this.stopDelay=85);this.is.opera&&(this.playDelay=5);this.is.opera&&(this.stopDelay=0);for(var e in b){this.soundList[e]=e;c=b[e].path,g=c+"."+ig.Sound.FORMAT.OGG.ext,c=c+"."+ig.Sound.FORMAT.MP3.ext,d=null;this.codecs[ig.Sound.FORMAT.OGG.ext.toLowerCase()]?d=g:this.codecs[ig.Sound.FORMAT.MP3.ext.toLowerCase()]&&(d=c);if(d){ig.ua.mobile?ig.ua.iOS&&(d=c):(b=navigator.userAgent.toLowerCase(),-1!=b.indexOf("safari")&&-1>=b.indexOf("chrome")&&(d=c));this.audio.addEventListener("error",function(){this.audio.error&&4===this.audio.error.code&&(this.isSupported=!1);},!1);this.audio.src=d;this.audio._pos=0;this.audio.preload="auto";this.audio.volume=this._volume;this.inactiveAudio=new Audio();this.inactiveAudio.src=d;this.inactiveAudio._pos=0;this.inactiveAudio.preload="auto";this.inactiveAudio.volume=this._volume;this.inactiveAudio.load();f=function(){y4tt.q9();this._duration=this.audio.duration;this._loaded||(this._loaded=!0);this.bgmPlaying?this.play():this.stop();this.audio.removeEventListener("canplaythrough",f,!1);}.bind(this);this.audio.addEventListener("canplaythrough",f,!1);this.audio.load();break;}}}},play:function(b){var g,e;if(this.isSupported)if(this.bgmPlaying=!0,this.webaudio)if(this.webaudio.buffer){if(!this.muteFlag&&(this.bgmPlaying=!0,!this.webaudio.source_loop._playing)){this.webaudio.source_loop=this.webaudio.context.createBufferSource();this.webaudio.source_loop.buffer=this.webaudio.buffer;this.webaudio.source_loop.loop=!0;this.webaudio.source_loop.connect(this.webaudio.gainNode);isNaN(b)&&(b=0,this.pausedTime&&(b=this.pausedTime));this.webaudio.source_loop._startTime=this.webaudio.context.currentTime;if("noteOn"===this.webaudio.compatibility.start)this.webaudio.source_once=this.webaudio.context.createBufferSource(),this.webaudio.source_once.buffer=this.webaudio.buffer,this.webaudio.source_once.connect(this.webaudio.gainNode),this.webaudio.source_once.noteGrainOn(0,b,this.webaudio.buffer.duration-b),this.webaudio.source_loop[this.webaudio.compatibility.start](this.webaudio.context.currentTime+(this.webaudio.buffer.duration-b));else this.webaudio.source_loop[this.webaudio.compatibility.start](0,b);this.webaudio.source_loop._playing=!0;}}else this.bgmPlaying=!0;else if(this.audio){g=this.audio;if(!this.muteFlag){this.bgmPlaying=!0;isNaN(b)&&(b=0,this.pausedTime&&(b=this.pausedTime));e=this._duration-b;this._onEndTimer&&(clearTimeout(this._onEndTimer),this._onEndTimer=null);this._onEndTimer=setTimeout(function(){var b;y4tt.v9();this.audio.currentTime=0;this.audio.pause();this.pausedTime=0;if(this.inactiveAudio){b=this.audio;this.audio=this.inactiveAudio;this.inactiveAudio=b;}this.play();}.bind(this),1E3*e+this.playDelay);4===g.readyState||!g.readyState&&navigator.isCocoonJS?(g.readyState=4,g.currentTime=b,g.muted=this.muteFlag||g.muted,g.volume=this._volume,setTimeout(function(){y4tt.q9();g.play();},0)):(clearTimeout(this._onEndTimer),this._onEndTimer=null,function(){var b;b=function(){this.play();g.removeEventListener("canplaythrough",b,!1);}.bind(this);y4tt.v9();g.addEventListener("canplaythrough",b,!1);}());}}},stop:function(){var b;this.bgmPlaying=!1;y4tt.q9();if(this.isSupported)if(this.webaudio){if(this.webaudio.source_loop._playing&&(this.webaudio.source_loop[this.webaudio.compatibility.stop](0),this.webaudio.source_loop._playing=!1,this.pausedTime+=this.webaudio.context.currentTime-this.webaudio.source_loop._startTime,this.pausedTime%=this.webaudio.source_loop.buffer.duration,this.webaudio.source_loop._startTime=0,"noteOn"===this.webaudio.compatibility.start))this.webaudio.source_once[this.webaudio.compatibility.stop](0);}else if(this.audio){b=this.audio;this.pausedTime=b.currentTime;b.currentTime=0;b.pause();clearTimeout(this._onEndTimer);this._onEndTimer=null;}},volume:function(b){this.isSupported&&(this._volume=b,0>this._volume?this._volume=0:1<this._volume&&(this._volume=1),this.webaudio?this.webaudio.gainNode&&(this.webaudio.gainNode.gain.value=this._volume):this.audio&&(this.audio.volume=this._volume,this.inactiveAudio&&(this.inactiveAudio.volume=this._volume)));},getVolume:function(){return!this.isSupported?0:this._volume;},mute:function(b){this.parent(b);y4tt.v9();!1==this.muteFlag&&(this.muteFlag=!0,this.bgmPlaying&&(this.stop(),this.bgmPlaying=!0));},unmute:function(b){y4tt.q9();this.parent(b);!this.stayMuteFlag&&!0==this.muteFlag&&(this.muteFlag=!1,this.bgmPlaying&&this.play());}});});ig.baked=!0;ig.module("plugins.audio.sound-info").defines(function(){y4tt.q9();SoundInfo=ig.Class.extend({FORMATS:{OGG:".ogg",MP3:".mp3"},sfx:{kittyopeningSound:{path:"media/audio/opening/kittyopening"},staticSound:{path:"media/audio/play/static"},openingSound:{path:"media/audio/opening/opening"},slideSound:{path:"media/audio/slide"},bounceSound:{path:"media/audio/bounce"},breakSound:{path:"media/audio/break"},selectSound:{path:"media/audio/select"}},bgm:{background:{path:"media/audio/bgm",startOgg:0,endOgg:31.992,startMp3:0,endMp3:32.052}}});});ig.baked=!0;ig.module("plugins.audio.sound-handler").requires("plugins.audio.impact-music-player","plugins.audio.impact-sound-player","plugins.audio.howler-player","plugins.audio.howler-music-player","plugins.audio.jukebox-player","plugins.audio.webaudio-music-player","plugins.audio.sound-info").defines(function(){ig.SoundHandler=ig.Class.extend({bgmPlayer:null,sfxPlayer:null,focusBlurMute:!1,soundInfo:new SoundInfo(),init:function(){console.log("Initiating sound handler");this.initWindowHandler();ig.ua.mobile?(this.initPowerButtonFix(),this.bgmPlayer=new WebaudioMusicPlayer(this.soundInfo.bgm,{loop:!0}),this.bgmPlayer.isSupported||(this.bgmPlayer=new JukeboxPlayer(this.soundInfo.bgm,{loop:!0}))):(this.bgmPlayer=new WebaudioMusicPlayer(this.soundInfo.bgm,{loop:!0}),this.bgmPlayer.isSupported||(this.bgmPlayer=new ImpactMusicPlayer(this.soundInfo.bgm,{loop:!0})));this.sfxPlayer=new HowlerPlayer(this.soundInfo.sfx);},checkBGM:function(){return this.bgmPlayer.stayMuteFlag;},checkSFX:function(){return this.sfxPlayer.stayMuteFlag;},muteSFX:function(b){this.sfxPlayer&&this.sfxPlayer.mute(b);},muteBGM:function(b){y4tt.q9();this.bgmPlayer&&this.bgmPlayer.mute(b);},unmuteSFX:function(b){y4tt.q9();this.sfxPlayer&&this.sfxPlayer.unmute(b);},unmuteBGM:function(b){this.bgmPlayer&&this.bgmPlayer.unmute(b);},muteAll:function(b){this.muteSFX(b);this.muteBGM(b);},unmuteAll:function(b){this.unmuteSFX(b);this.unmuteBGM(b);},forceMuteAll:function(){this.focusBlurMute||this.muteAll(!1);this.focusBlurMute=!0;},forceUnMuteAll:function(){y4tt.q9();this.focusBlurMute&&(this.unmuteAll(!1),this.focusBlurMute=!1);},initWindowHandler:function(){"true"===ig.domHandler.getQueryVariable("webview")?($(window).focus(function(){wgl.system&&(wgl.system.stopRender(),wgl.system.startRender());y4tt.q9();ig.soundHandler&&(ig.soundHandler.forceUnMuteAll(),ig.game&&ig.SoundHandler&&ig.game.visChangeSoundCheck());}),$(window).blur(function(){y4tt.q9();wgl.system&&wgl.system.stopRender();ig.soundHandler&&(ig.soundHandler.forceMuteAll(),ig.game&&ig.SoundHandler&&ig.game.visChangeSoundCheck());})):(window.onfocus=function(){wgl.system&&(wgl.system.stopRender(),wgl.system.startRender());y4tt.v9();ig.soundHandler&&(!0===ig.game.playerStats.soundSwitch?ig.soundHandler.forceUnMuteAll():!1===ig.game.playerStats.soundSwitch&&ig.soundHandler.forceMuteAll());ig.game&&ig.SoundHandler&&ig.game.visChangeSoundCheck();},window.onblur=function(){wgl.system&&wgl.system.stopRender();ig.soundHandler&&ig.soundHandler.forceMuteAll();});},initPowerButtonFix:function(){var b;b=this.getHiddenProp();b&&(b=b.replace(/[H|h]idden/,"")+"visibilitychange",document.addEventListener(b,this.visChange));window.addEventListener("pagehide",function(){y4tt.v9();ig.soundHandler&&ig.soundHandler.forceMuteAll();},!1);window.addEventListener("pageshow",function(){y4tt.v9();ig.soundHandler&&(ig.soundHandler.forceUnMuteAll(),ig.game&&ig.SoundHandler&&ig.game.visChangeSoundCheck());},!1);},getHiddenProp:function(){var b;b=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var g=0;g<b.length;g++)if(b[g]+"Hidden"in document)return b[g]+"Hidden";return null;},isHidden:function(){var b;b=this.getHiddenProp();y4tt.v9();return!b?!1:document[b];},visChange:function(){y4tt.q9();ig.soundHandler.isHidden()?ig.soundHandler&&ig.soundHandler.forceMuteAll():ig.soundHandler&&(ig.soundHandler.forceUnMuteAll(),ig.game&&ig.SoundHandler&&ig.game.visChangeSoundCheck());},saveVolume:function(){this.sfxPlayer&&ig.game.io.storageSet("soundVolume",this.sfxPlayer.getVolume());this.bgmPlayer&&ig.game.io.storageSet("musicVolume",this.bgmPlayer.getVolume());},forceLoopBGM:function(){var b,g,e;y4tt.v9();if(!this.focusBlurMute&&this.bgmPlayer.bgmPlaying&&this.bgmPlayer){g=this.bgmPlayer.jukeboxPlayer;if(g){null!=window.mozInnerScreenX&&/firefox/.test(navigator.userAgent.toLowerCase());b=Boolean(window.chrome);!window.chrome&&/safari/.test(navigator.userAgent.toLowerCase());e=0.1;ig.ua.mobile&&(e=0.115,ig.ua.android&&(e=0.45,b&&(e=0.3)));g.settings.spritemap.music&&(b=g.settings.spritemap.music.end-e,g.getCurrentTime()>=b&&(b=g.settings.spritemap.music.start,ig.ua.android?this.forcelooped||(g.play(b,!0),this.forcelooped=!0,setTimeout(function(){ig.soundHandler.forcelooped=!1;},e)):g.setCurrentTime(b)));}else"ImpactMusicPlayer"==this.bgmPlayer.tagName&&(null!=window.mozInnerScreenX&&/firefox/.test(navigator.userAgent.toLowerCase()),b=Boolean(window.chrome),!window.chrome&&/safari/.test(navigator.userAgent.toLowerCase()),e=0.1,ig.ua.mobile&&(e=0.115,ig.ua.android&&(e=0.45,b&&(e=0.3))),g=0,"mp3"==ig.soundManager.format.ext&&(g=0.05),ig.music.currentTrack&&(b=ig.music.currentTrack.duration-e,ig.music.currentTrack.currentTime>=b&&(ig.ua.android?this.forcelooped||(ig.music.currentTrack.pause(),ig.music.currentTrack.currentTime=g,ig.music.currentTrack.play(),this.forcelooped=!0,setTimeout(function(){y4tt.v9();ig.soundHandler.forcelooped=!1;},e)):ig.music.currentTrack.currentTime=g)));}}});});ig.baked=!0;ig.module("plugins.io.storage").defines(function(){ig.Storage=ig.Class.extend({staticInstantiate:function(){return!ig.Storage.instance?null:ig.Storage.instance;},init:function(){y4tt.q9();ig.Storage.instance=this;},isCapable:function(){return"undefined"!==typeof window.localStorage;},isSet:function(b){y4tt.v9();return null!==this.get(b);},initUnset:function(b,g){null===this.get(b)&&this.set(b,g);},get:function(b){y4tt.v9();if(!this.isCapable())return null;try{return JSON.parse(localStorage.getItem(b));}catch(g){return window.localStorage.getItem(b);}},getInt:function(b){y4tt.v9();return~~this.get(b);},getFloat:function(b){return parseFloat(this.get(b));},getBool:function(b){return!!this.get(b);},key:function(b){return this.isCapable()?window.localStorage.key(b):null;},set:function(b,g){if(!this.isCapable())return null;y4tt.q9();try{window.localStorage.setItem(b,JSON.stringify(g));}catch(e){console.log(e);}},setHighest:function(b,g){y4tt.v9();g>this.getFloat(b)&&this.set(b,g);},remove:function(b){if(!this.isCapable())return null;window.localStorage.removeItem(b);},clear:function(){if(!this.isCapable())return null;window.localStorage.clear();}});});ig.baked=!0;ig.module("plugins.io.mouse").defines(function(){Mouse=ig.Class.extend({bindings:{click:[ig.KEY.MOUSE1]},last:new BABYLON.Vector2.Zero(),init:function(){ig.input.initMouse();for(var b in this.bindings){this[b]=b;for(var g=0;g<this.bindings[b].length;g++)ig.input.bind(this.bindings[b][g],b);}},getLast:function(){return this.last;},getPos:function(){var b,g;if(ig.ua.mobile)b=ig.input.mouse.x/ ig.sizeHandler.sizeRatio.x,g=ig.input.mouse.y/ ig.sizeHandler.sizeRatio.y;else b=ig.input.mouse.x,g=ig.input.mouse.y;this.last=new BABYLON.Vector2(b,g);y4tt.v9();return this.last.clone();}});});ig.baked=!0;ig.module("plugins.io.keyboard").defines(function(){y4tt.v9();Keyboard=ig.Class.extend({bindings:{jump:[ig.KEY.W,ig.KEY.UP_ARROW],moveright:[ig.KEY.D,ig.KEY.RIGHT_ARROW],moveleft:[ig.KEY.A,ig.KEY.LEFT_ARROW],shoot:[ig.KEY.S,ig.KEY.DOWN_ARROW,ig.KEY.SPACE]},init:function(){for(var b in this.bindings){this[b]=b;for(var g=0;g<this.bindings[b].length;g++)ig.input.bind(this.bindings[b][g],b);}}});});ig.baked=!0;ig.module("plugins.io.gamepad-input").defines(function(){ig.PADKEY={BUTTON_0:0,PADBUTTON_1:1,BUTTON_2:2,BUTTON_3:3,BUTTON_LEFT_BUMPER:4,BUTTON_RIGHT_BUMPER:5,BUTTON_LEFT_TRIGGER:6,BUTTON_RIGHT_TRIGGER:7,BUTTON_LEFT_JOYSTICK:10,BUTTON_RIGHT_JOYSTICK:11,BUTTON_DPAD_UP:12,BUTTON_DPAD_DOWN:13,BUTTON_DPAD_LEFT:14,BUTTON_DPAD_RIGHT:15,BUTTON_MENU:16,AXIS_LEFT_JOYSTICK_X:0,AXIS_LEFT_JOYSTICK_Y:1,AXIS_RIGHT_JOYSTICK_X:2,AXIS_RIGHT_JOYSTICK_Y:3};y4tt.q9();ig.GamepadInput=ig.Class.extend({isInit:!1,isSupported:!1,list:[],bindings:{},states:{},presses:{},releases:{},downLocks:{},upLocks:{},leftStick:{x:0,y:0},rightStick:{x:0,y:0},start:function(){var b;if(!this.isInit){this.isInit=!0;b=navigator.getGamepads||navigator.webkitGetGamepads;b&&(!navigator.getGamepads&&navigator.webkitGetGamepads&&(navigator.getGamepads=navigator.webkitGetGamepads),this.list=navigator.getGamepads());this.isSupported=b;}},isAvailable:function(){return this.isInit&&this.isSupported;},buttonPressed:function(b){return"object"==typeof b?b.pressed:1==b;},buttonDown:function(b){y4tt.q9();if(b=this.bindings[b])this.states[b]=!0,this.downLocks[b]||(this.presses[b]=!0,this.downLocks[b]=!0);},buttonUp:function(b){y4tt.v9();if((b=this.bindings[b])&&this.downLocks[b]&&!this.upLocks[b])this.states[b]=!1,this.releases[b]=!0,this.upLocks[b]=!0;},clearPressed:function(){for(var b in this.releases)this.states[b]=!1,this.downLocks[b]=!1;this.releases={};this.presses={};this.upLocks={};},bind:function(b,g){y4tt.v9();this.bindings[b]=g;},unbind:function(b){y4tt.v9();this.releases[this.bindings[b]]=!0;this.bindings[b]=null;},unbindAll:function(){this.bindings={};this.states={};y4tt.q9();this.presses={};this.releases={};this.downLocks={};this.upLocks={};},state:function(b){return this.states[b];},pressed:function(b){return this.presses[b];},released:function(b){return this.releases[b];},clamp:function(b,g,e){y4tt.q9();return b<g?g:b>e?e:b;},pollGamepads:function(){var c,g,d;y4tt.v9();if(this.isSupported){this.leftStick.x=0;this.leftStick.y=0;this.rightStick.x=0;this.rightStick.y=0;this.list=navigator.getGamepads();for(var b in this.bindings){for(var g=!1,e=0;e<this.list.length;e++){c=this.list[e];if(c&&c.buttons&&this.buttonPressed(c.buttons[b])){g=!0;break;}}g?this.buttonDown(b):this.buttonUp(b);}for(e=0;e<this.list.length;e++)if((c=this.list[e])&&c.axes){b=c.axes[ig.GAMEPADINPUT.AXIS_LEFT_JOYSTICK_X];g=c.axes[ig.GAMEPADINPUT.AXIS_LEFT_JOYSTICK_Y],d=c.axes[ig.GAMEPADINPUT.AXIS_RIGHT_JOYSTICK_X],c=c.axes[ig.GAMEPADINPUT.AXIS_RIGHT_JOYSTICK_Y];this.leftStick.x+=isNaN(b)?0:b;this.leftStick.y+=isNaN(g)?0:g;this.rightStick.x+=isNaN(d)?0:d;this.rightStick.y+=isNaN(c)?0:c;}0<this.list.length&&(this.leftStick.x=this.clamp(this.leftStick.x,-1,1),this.leftStick.y=this.clamp(this.leftStick.y,-1,1),this.rightStick.x=this.clamp(this.rightStick.x,-1,1),this.rightStick.y=this.clamp(this.rightStick.y,-1,1));}}});});ig.baked=!0;ig.module("plugins.io.gamepad").requires("plugins.io.gamepad-input").defines(function(){y4tt.v9();Gamepad=ig.Class.extend({bindings:{padJump:[ig.PADKEY.BUTTON_0]},init:function(){ig.gamepadInput.start();for(var b in this.bindings)for(var g=0;g<this.bindings[b].length;g++)ig.gamepadInput.bind(this.bindings[b][g],b);},press:function(){},held:function(){},release:function(){}});});ig.baked=!0;ig.module("plugins.io.multitouch-input").defines(function(){y4tt.v9();ig.MultitouchInput=ig.Class.extend({isStart:!1,touches:{},pressed:[],state:[],released:[],multitouchCapable:!1,lastEventUp:null,internalWidth:1,internalHeight:1,scaleX:1,scaleY:1,start:function(){y4tt.q9();this.isStart||(this.isStart=!0,navigator.maxTouchPoints&&1<navigator.maxTouchPoints&&(this.multitouchCapable=!0),ig.ua.touchDevice&&(window.navigator.msPointerEnabled&&(ig.system.canvas.addEventListener("MSPointerDown",this.touchdown.bind(this),!1),ig.system.canvas.addEventListener("MSPointerUp",this.touchup.bind(this),!1),ig.system.canvas.addEventListener("MSPointerMove",this.touchmove.bind(this),!1),ig.system.canvas.style.msContentZooming="none",ig.system.canvas.style.msTouchAction="none"),ig.system.canvas.addEventListener("touchstart",this.touchdown.bind(this),!1),ig.system.canvas.addEventListener("touchend",this.touchup.bind(this),!1),ig.system.canvas.addEventListener("touchmove",this.touchmove.bind(this),!1)));},touchdown:function(b){var g;if(ig.ua.touchDevice)if(this.updateSizeProperties(),window.navigator.msPointerEnabled)this.windowKeyDown(b);else if(b.touches){this.pollMultitouch(b.touches.length);this.updateSizeProperties();g={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(g=ig.system.canvas.getBoundingClientRect());for(var e=[],c=0;c<b.touches.length;c++)e.push(b.touches[c]);this.spliceFromArray(e,this.pressed);this.spliceFromArray(e,this.state);this.spliceFromArray(e,this.released);for(c=0;c<e.length;c++)b=e[c],this.pressed.push({identifier:b.identifier,x:(b.clientX-g.left)/this.scaleX,y:(b.clientY-g.top)/this.scaleY});}},touchmove:function(b){var e;if(ig.ua.touchDevice)if(this.updateSizeProperties(),window.navigator.msPointerEnabled)this.windowMove(b);else if(b.touches){this.pollMultitouch(b.touches.length);for(var g=0;g<b.touches.length;g++){e=b.touches[g];this.upgrade(this.pressed,this.state,e);this.updateArray(this.state,e);}}},touchup:function(b){var e;if(ig.ua.touchDevice)if(this.updateSizeProperties(),window.navigator.msPointerEnabled)this.windowKeyUp(b);else if(this.lastEventUp=b,b.touches)for(var g=0;g<b.changedTouches.length;g++){e=b.changedTouches[g];this.upgrade(this.state,this.released,e);this.upgrade(this.pressed,this.released,e);}},windowKeyDown:function(b){var c,d;b=b.changedTouches?b.changedTouches:[b];this.pollMultitouch(b.length);this.updateSizeProperties();for(var g=[],e=0;e<b.length;e++)g.push(b[e]);c={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(c=ig.system.canvas.getBoundingClientRect());this.spliceFromArray(g,this.pressed);this.spliceFromArray(g,this.state);this.spliceFromArray(g,this.released);for(e=0;e<g.length;e++){d=b[e];this.pressed.push({identifier:"undefined"!=typeof d.identifier?d.identifier:"undefined"!=typeof d.pointerId?d.pointerId:1,x:(d.clientX-c.left)/this.scaleX,y:(d.clientY-c.top)/this.scaleY});}},windowKeyUp:function(b){var e;this.lastEventUp=b;y4tt.q9();b=b.changedTouches?b.changedTouches:[b];for(var g=0;g<b.length;g++){e=b[g],e={identifier:"undefined"!=typeof e.identifier?e.identifier:"undefined"!=typeof e.pointerId?e.pointerId:1,clientX:e.clientX,clientY:e.clientY};this.upgrade(this.state,this.released,e);this.upgrade(this.pressed,this.released,e);}},windowMove:function(b){var e;b=b.changedTouches?b.changedTouches:[b];this.pollMultitouch(b.length);y4tt.v9();for(var g=0;g<b.length;g++){e=b[g],e={identifier:e.pointerId,clientX:e.clientX,clientY:e.clientY};this.upgrade(this.pressed,this.state,e);this.updateArray(this.state,e);}},clear:function(){for(var b=0;b<this.released.length;++b)this.released[b]&&(this.released.splice(b,1),b--);},pollMultitouch:function(b){!this.multitouchCapable&&1<b&&(this.multitouchCapable=!0);},spliceFromArray:function(b,g){for(var e=0;e<g.length;e++)for(var c=0;c<b.length;c++)b[c].identifier===g[e].identifier&&(b.splice(c,1),c--);},updateSizeProperties:function(){var b,g;b=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth,g=parseInt(ig.system.canvas.offsetHeight)||ig.system.realHeight;this.scaleX=ig.system.scale*(b/ ig.system.realWidth);this.scaleY=ig.system.scale*(g/ ig.system.realHeight);},upgrade:function(b,g,e){var c;c={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(c=ig.system.canvas.getBoundingClientRect());y4tt.v9();for(var d=(e.clientX-c.left)/this.scaleX,c=(e.clientY-c.top)/this.scaleY,f=0;f<b.length;f++)if(void 0!==typeof b[f].identifier&&void 0!==typeof e.identifier&&e.identifier===b[f].identifier){b.splice(f,1);g.push({identifier:e.identifier,x:d,y:c});break;}},updateArray:function(b,g){var e;y4tt.q9();e={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(e=ig.system.canvas.getBoundingClientRect());for(var c=(g.clientX-e.left)/this.scaleX,e=(g.clientY-e.top)/this.scaleY,d=0;d<b.length;d++)if(void 0!==typeof b[d].identifier&&void 0!==typeof g.identifier&&g.identifier===b[d].identifier){b[d].x=c;b[d].y=e;break;}}});});ig.baked=!0;ig.module("plugins.io.io-manager").requires("plugins.io.storage","plugins.io.mouse","plugins.io.keyboard","plugins.io.gamepad","plugins.io.multitouch-input","plugins.io.gamepad-input").defines(function(){y4tt.q9();IoManager=ig.Class.extend({storage:null,localStorageSupport:!1,gamekey:"SurviveTheRoom",mouse:null,keyboard:null,multitouch:null,gamepad:null,init:function(){y4tt.v9();ig.multitouchInput=new ig.MultitouchInput();ig.gamepadInput=new ig.GamepadInput();this.unbindAll();this.initStorage();this.initMouse();this.initKeyboard();this.initMultitouch();},unbindAll:function(){ig.input.unbindAll();y4tt.q9();ig.gamepadInput.unbindAll();},initStorage:function(){this._supportsLocalStorage()&&(this.storage=new ig.Storage());},initMouse:function(){y4tt.q9();this.mouse=new Mouse();},initKeyboard:function(){y4tt.v9();this.keyboard=new Keyboard();},initMultitouch:function(){y4tt.q9();ig.multitouchInput.start();},initGamepad:function(){y4tt.v9();this.gamepad=new Gamepad();},press:function(b){return ig.input.pressed(b)?!0:!1;},held:function(b){return ig.input.state(b)||this.gamepad.state(b)?!0:!1;},release:function(b){y4tt.v9();return ig.input.released(b)||this.gamepad.released(b)?!0:!1;},getClickPos:function(){return this.mouse.getPos();},getLastClickPos:function(){return this.mouse.getLast();},getTouchesPos:function(){y4tt.q9();return this.multitouch.getTouchesPos();},checkOverlap:function(b,g,e,c,d){y4tt.v9();return b.x>g+c||b.x<g||b.y>e+d||b.y<e?!1:!0;},clear:function(){y4tt.v9();ig.multitouchInput.clear();},_supportsLocalStorage:function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),this.localStorageSupport="localStorage"in window&&null!==window.localStorage;}catch(b){return this.localStorageSupport;}},storageIsSet:function(b){return!this.localStorageSupport?null:this.storage.isSet(b);},storageGet:function(b){return!this.localStorageSupport?null:this.storage.get(b);},storageSet:function(b,g){if(!this.localStorageSupport)return null;this.storage.set(b,g);},assert:function(b,g,e){y4tt.v9();if(g!==e)throw"actualValue:"+g+" not equal to testValue:"+e+" at "+b;}});});ig.baked=!0;ig.module("plugins.coolmath-api").defines(function(){ig.onPlayButton=function(){console.log("onPlayButton");y4tt.q9();parent&&"function"==typeof parent.cmgGameEvent&&parent.cmgGameEvent("start");};ig.onLevelStart=function(b){y4tt.v9();console.log("onLevelStart "+b);parent&&"function"==typeof parent.cmgGameEvent&&parent.cmgGameEvent("start",b);};ig.onLevelReplay=function(b){console.log("onLevelReplay "+b);parent&&"function"==typeof parent.cmgGameEvent&&parent.cmgGameEvent("replay",b);};window.unlockAllLevels=function(){console.log("unlockAllLevels");};window.resetLevels=function(){console.log("resetLevels");};});function getInternetExplorerVersion(){var b;b=-1;"Microsoft Internet Explorer"==navigator.appName&&null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(b=parseFloat(RegExp.$1));y4tt.v9();return b;}ig.baked=!0;ig.module("plugins.splash-loader").requires("impact.loader","impact.animation").defines(function(){y4tt.v9();ig.SplashLoader=ig.Loader.extend({desktopCoverDIVID:"play-desktop",splashDesktop:new ig.Image("media/graphics/splash/desktop/cover.jpg"),splashMobile:new ig.Image("media/graphics/splash/mobile/cover.jpg"),cubeImg:new ig.Image("media/graphics/sprites/cube-long.png"),ballImg:new ig.Image("media/graphics/sprites/ball-img.png"),init:function(b,g){var e,c;this.parent(b,g);e=ig.domHandler.getElementById("#game"),c=ig.domHandler.getElementById("#webgl");ig.domHandler.setZIndex(e,1);ig.domHandler.setZIndex(c,0);ig.apiHandler.run("MJSPreroll");},end:function(){var b;y4tt.v9();this.parent();this._drawStatus=1;this.draw();if(ig.ua.mobile){b=ig.domHandler.getElementById("#play");ig.domHandler.show(b);ig.system.setGame(MyGame);}else this.tapToStartDiv();},tapToStartDiv:function(b){this.desktopCoverDIV=document.getElementById(this.desktopCoverDIVID);y4tt.q9();if(!this.desktopCoverDIV){this.desktopCoverDIV=document.createElement("div");this.desktopCoverDIV.id=this.desktopCoverDIVID;this.desktopCoverDIV.setAttribute("class","play");this.desktopCoverDIV.setAttribute("style","position: absolute; display: block; z-index: 999999; background-color: rgba(23, 32, 53, 0.7); visibility: visible; font-size: 10vmin; text-align: center; vertical-align: middle; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;");this.desktopCoverDIV.innerHTML="<div style='color:white;background-color: rgba(255, 255, 255, 0.3); border: 2px solid #fff; font-size:20px; border-radius: 5px; position: relative; float: left; top: 50%; left: 50%; transform: translate(-50%, -50%);'><div style='padding:20px 50px; font-family: Arial;'>"+_STRINGS.Splash.TapToStart+"</div></div>";(document.getElementById("play").parentNode||document.getElementById("ajaxbar")).appendChild(this.desktopCoverDIV);try{"undefined"!==typeof ig.sizeHandler?"undefined"!==typeof ig.sizeHandler.coreDivsToResize&&(ig.sizeHandler.coreDivsToResize.push("#"+this.desktopCoverDIVID),"function"===typeof ig.sizeHandler.reorient&&ig.sizeHandler.reorient()):"undefined"!==typeof coreDivsToResize&&(coreDivsToResize.push(this.desktopCoverDIVID),"function"===typeof sizeHandler&&sizeHandler());}catch(g){console.log(g);}this.desktopCoverDIV.addEventListener("click",function(){try{"undefined"!==typeof ig.soundHandler?("undefined"!==typeof ig.soundHandler.bgmPlayer?"undefined"!==typeof ig.soundHandler.bgmPlayer.webaudio&&"undefined"!==typeof ig.soundHandler.bgmPlayer.webaudio.context&&ig.soundHandler.bgmPlayer.webaudio.context.resume():(ig.soundHandler=null,ig.soundHandler="undefined"!==typeof ig.soundList?new ig.SoundHandler(ig.soundList):new ig.SoundHandler()),"undefined"!==typeof ig.soundHandler.sfxPlayer?"function"===typeof ig.soundHandler.sfxPlayer.play&&ig.soundHandler.sfxPlayer.play("staticSound"):"undefined"!==typeof ig.soundHandler.staticSound?"function"===typeof ig.soundHandler.staticSound.play&&ig.soundHandler.staticSound.play():"function"===typeof ig.soundHandler.playSound&&ig.soundHandler.playSound("staticSound")):"undefined"!==typeof Howl?(ig.global.staticSound=new Howl({src:["media/audio/play/static.ogg","media/audio/play/static.mp3"]}),ig.global.staticSound.play()):"undefined"!==typeof createjs&&"undefined"!==typeof createjs.Sound&&"function"===typeof createjs.Sound.play&&createjs.Sound.play("opening");}catch(e){console.log(e);}y4tt.v9();this.setAttribute("style","visibility: hidden;");"function"===typeof b&&b();ig.system.setGame(MyGame);});}},setupCustomAnimation:function(){this.customAnim=new ig.Animation(this.customAnim,0.05,[0,1,2,3,4,5]);this.customAnim.currentFrame=0;ig.loadingScreen=this;ig.loadingScreen.animationTimer=window.setInterval("ig.loadingScreen.animate()",100);},animate:function(){this.customAnim.currentFrame<this.customAnim.sequence.length?this.customAnim.currentFrame++:this.customAnim.currentFrame=0;y4tt.v9();this.customAnim.gotoFrame(this.customAnim.currentFrame);},draw:function(){var b,g,e,c;ig.system.context.font="1px newcomictitle";ig.system.context.fillText("",0,0);this._drawStatus+=(this.status-this._drawStatus)/5;ig.system.context.fillStyle="#000";ig.system.context.fillRect(0,0,ig.system.width,ig.system.height);y4tt.v9();ig.ua.mobile?(b=350,g=35,e=0.5*ig.system.width-b/2,c=280,this.splashMobile.draw(0,0)):(b=350,g=35,e=0.5*ig.system.width-b/2,c=280,this.splashDesktop.draw(0,0));ig.system.context.drawImage(this.cubeImg.data,0,0,b*this._drawStatus,g,e,c,b*this._drawStatus,g);}});});ig.baked=!0;ig.module("babylon.plugins.wgl-entity").defines(function(){wgl.Entity=ig.Class.extend({pos:null,vel:null,acc:null,meshes:[],_killed:!1,init:function(b,g,e,c){this.pos=new BABYLON.Vector3(0,0,0);this.vel=new BABYLON.Vector3(0,0,0);this.acc=new BABYLON.Vector3(0,0,0);c&&c.mesh&&this.meshes.push(c.mesh);isNaN(b)||(this.pos.x=b);isNaN(g)||(this.pos.y=g);isNaN(e)||(this.pos.z=e);},update:function(){},render:function(){},kill:function(){var g;for(var b=0;b<this.meshes.length;b++){g=this.meshes[b];wgl.game.currentScene.stopAnimation(g);g.dispose();this.meshes.splice(b,1);b--;}y4tt.q9();this._killed=!0;},reset:function(){},resize:function(){}});});ig.baked=!0;ig.module("plugins.tween").requires("impact.entity","babylon.plugins.wgl-entity").defines(function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(b){for(var g=0;g<this.length;++g)if(this[g]===b)return g;y4tt.q9();return-1;});ig.Entity.prototype.tweens=[];ig.Entity.prototype._preTweenUpdate=ig.Entity.prototype.update;ig.Entity.prototype.update=function(){y4tt.v9();this._preTweenUpdate();if(0<this.tweens.length){for(var b=[],g=0;g<this.tweens.length;g++)this.tweens[g].update(),this.tweens[g].complete||b.push(this.tweens[g]);this.tweens=b;}};ig.Entity.prototype.tween=function(b,g,e){b=new ig.Tween(this,b,g,e);this.tweens.push(b);return b;};ig.Entity.prototype.pauseTweens=function(){y4tt.q9();for(var b=0;b<this.tweens.length;b++)this.tweens[b].pause();};ig.Entity.prototype.resumeTweens=function(){y4tt.q9();for(var b=0;b<this.tweens.length;b++)this.tweens[b].resume();};ig.Entity.prototype.stopTweens=function(b){for(var g=0;g<this.tweens.length;g++)this.tweens[g].stop(b);};wgl.Entity.prototype.tweens=[];wgl.Entity.prototype._preTweenUpdate=wgl.Entity.prototype.update;wgl.Entity.prototype.update=function(){this._preTweenUpdate();y4tt.v9();if(0<this.tweens.length){for(var b=[],g=0;g<this.tweens.length;g++)this.tweens[g].update(),this.tweens[g].complete||b.push(this.tweens[g]);this.tweens=b;}};wgl.Entity.prototype.tween=function(b,g,e){y4tt.q9();b=new ig.Tween(this,b,g,e);this.tweens.push(b);return b;};wgl.Entity.prototype.pauseTweens=function(){for(var b=0;b<this.tweens.length;b++)this.tweens[b].pause();};wgl.Entity.prototype.resumeTweens=function(){y4tt.v9();for(var b=0;b<this.tweens.length;b++)this.tweens[b].resume();};wgl.Entity.prototype.stopTweens=function(b){for(var g=0;g<this.tweens.length;g++)this.tweens[g].stop(b);};ig.Tween=function(b,g,e,c){var d,f,q,j,l,n,m;d={},f={},q={},j=0,l=!1,n=!1,m=!1;y4tt.v9();this.duration=e;this.paused=this.complete=!1;this.easing=ig.Tween.Easing.Linear.EaseNone;this.onComplete=!1;this.loop=this.delay=0;this.loopCount=-1;ig.merge(this,c);this.loopNum=this.loopCount;this.chain=function(b){m=b;};this.initEnd=function(b,c,d){y4tt.q9();if("object"!==typeof c[b])d[b]=c[b];else for(subprop in c[b])d[b]||(d[b]={}),this.initEnd(subprop,c[b],d[b]);};this.initStart=function(b,c,d,e){if("object"!==typeof d[b])"undefined"!==typeof c[b]&&(e[b]=d[b]);else for(subprop in d[b])e[b]||(e[b]={}),"undefined"!==typeof c[b]&&this.initStart(subprop,c[b],d[b],e[b]);};this.start=function(){this.paused=this.complete=!1;this.loopNum=this.loopCount;j=0;-1==b.tweens.indexOf(this)&&b.tweens.push(this);n=!0;y4tt.v9();l=new ig.Timer();for(var c in g)this.initEnd(c,g,f);for(c in f)this.initStart(c,f,b,d),this.initDelta(c,q,b,f);};this.initDelta=function(b,c,d,e){if("object"!==typeof e[b])c[b]=e[b]-d[b];else for(subprop in e[b])c[b]||(c[b]={}),this.initDelta(subprop,c[b],d[b],e[b]);};this.propUpdate=function(b,c,d,e,f){if("object"!==typeof d[b])c[b]="undefined"!=typeof d[b]?d[b]+e[b]*f:c[b];else for(subprop in d[b])this.propUpdate(subprop,c[b],d[b],e[b],f);};this.propSet=function(b,c,d){if("object"!==typeof c[b])d[b]=c[b];else for(subprop in c[b])d[b]||(d[b]={}),this.propSet(subprop,c[b],d[b]);};this.update=function(){var c,e;if(!n)return!1;if(this.delay){if(l.delta()<this.delay)return;this.delay=0;l.reset();}if(this.paused||this.complete)return!1;c=(l.delta()+j)/this.duration,c=1<c?1:c,e=this.easing(c);for(property in q)this.propUpdate(property,b,d,q,e);if(1<=c){if(0==this.loopNum||!this.loop){this.complete=!0;if(this.onComplete)this.onComplete();m&&m.start();return!1;}if(this.loop==ig.Tween.Loop.Revert){for(property in d)this.propSet(property,d,b);j=0;l.reset();-1!=this.loopNum&&this.loopNum--;}else if(this.loop==ig.Tween.Loop.Reverse){c={};e={};ig.merge(c,f);ig.merge(e,d);ig.merge(d,c);ig.merge(f,e);for(property in f)this.initDelta(property,q,b,f);j=0;l.reset();-1!=this.loopNum&&this.loopNum--;}}};this.pause=function(){this.paused=!0;y4tt.q9();j+=l.delta();};this.resume=function(){this.paused=!1;l.reset();};this.stop=function(b){b&&(this.loop=this.complete=this.paused=!1,j+=e,this.update());this.complete=!0;};};ig.Tween.Loop={Revert:1,Reverse:2};ig.Tween.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};y4tt.q9();ig.Tween.Easing.Linear.EaseNone=function(b){return b;};ig.Tween.Easing.Quadratic.EaseIn=function(b){y4tt.v9();return b*b;};ig.Tween.Easing.Quadratic.EaseOut=function(b){return-b*(b-2);};ig.Tween.Easing.Quadratic.EaseInOut=function(b){return 1>(b*=2)?0.5*b*b:-0.5*(--b*(b-2)-1);};ig.Tween.Easing.Cubic.EaseIn=function(b){return b*b*b;};ig.Tween.Easing.Cubic.EaseOut=function(b){y4tt.q9();return--b*b*b+1;};ig.Tween.Easing.Cubic.EaseInOut=function(b){return 1>(b*=2)?0.5*b*b*b:0.5*((b-=2)*b*b+2);};ig.Tween.Easing.Quartic.EaseIn=function(b){return b*b*b*b;};ig.Tween.Easing.Quartic.EaseOut=function(b){return-(--b*b*b*b-1);};ig.Tween.Easing.Quartic.EaseInOut=function(b){y4tt.q9();return 1>(b*=2)?0.5*b*b*b*b:-0.5*((b-=2)*b*b*b-2);};ig.Tween.Easing.Quintic.EaseIn=function(b){return b*b*b*b*b;};ig.Tween.Easing.Quintic.EaseOut=function(b){return(b-=1)*b*b*b*b+1;};ig.Tween.Easing.Quintic.EaseInOut=function(b){y4tt.q9();return 1>(b*=2)?0.5*b*b*b*b*b:0.5*((b-=2)*b*b*b*b+2);};ig.Tween.Easing.Sinusoidal.EaseIn=function(b){return-Math.cos(b*Math.PI/2)+1;};ig.Tween.Easing.Sinusoidal.EaseOut=function(b){y4tt.v9();return Math.sin(b*Math.PI/2);};ig.Tween.Easing.Sinusoidal.EaseInOut=function(b){y4tt.q9();return-0.5*(Math.cos(Math.PI*b)-1);};ig.Tween.Easing.Exponential.EaseIn=function(b){y4tt.v9();return 0==b?0:Math.pow(2,10*(b-1));};ig.Tween.Easing.Exponential.EaseOut=function(b){y4tt.v9();return 1==b?1:-Math.pow(2,-10*b)+1;};ig.Tween.Easing.Exponential.EaseInOut=function(b){y4tt.v9();return 0==b?0:1==b?1:1>(b*=2)?0.5*Math.pow(2,10*(b-1)):0.5*(-Math.pow(2,-10*(b-1))+2);};ig.Tween.Easing.Circular.EaseIn=function(b){y4tt.q9();return-(Math.sqrt(1-b*b)-1);};ig.Tween.Easing.Circular.EaseOut=function(b){return Math.sqrt(1- --b*b);};ig.Tween.Easing.Circular.EaseInOut=function(b){y4tt.q9();return 1>(b/=0.5)?-0.5*(Math.sqrt(1-b*b)-1):0.5*(Math.sqrt(1-(b-=2)*b)+1);};ig.Tween.Easing.Elastic.EaseIn=function(b){var g,e,c;e=0.1,c=0.4;if(0==b)return 0;y4tt.v9();if(1==b)return 1;c||(c=0.3);!e||1>e?(e=1,g=c/4):g=c/(2*Math.PI)*Math.asin(1/e);return-(e*Math.pow(2,10*(b-=1))*Math.sin((b-g)*2*Math.PI/c));};ig.Tween.Easing.Elastic.EaseOut=function(b){var g,e,c;e=0.1,c=0.4;if(0==b)return 0;if(1==b)return 1;c||(c=0.3);y4tt.v9();!e||1>e?(e=1,g=c/4):g=c/(2*Math.PI)*Math.asin(1/e);return e*Math.pow(2,-10*b)*Math.sin((b-g)*2*Math.PI/c)+1;};ig.Tween.Easing.Elastic.EaseInOut=function(b){var g,e,c;e=0.1,c=0.4;if(0==b)return 0;if(1==b)return 1;c||(c=0.3);!e||1>e?(e=1,g=c/4):g=c/(2*Math.PI)*Math.asin(1/e);return 1>(b*=2)?-0.5*e*Math.pow(2,10*(b-=1))*Math.sin((b-g)*2*Math.PI/c):0.5*e*Math.pow(2,-10*(b-=1))*Math.sin((b-g)*2*Math.PI/c)+1;};ig.Tween.Easing.Back.EaseIn=function(b){return b*b*(2.70158*b-1.70158);};ig.Tween.Easing.Back.EaseOut=function(b){y4tt.v9();return(b-=1)*b*(2.70158*b+1.70158)+1;};ig.Tween.Easing.Back.EaseInOut=function(b){return 1>(b*=2)?0.5*b*b*(3.5949095*b-2.5949095):0.5*((b-=2)*b*(3.5949095*b+2.5949095)+2);};ig.Tween.Easing.Bounce.EaseIn=function(b){return 1-ig.Tween.Easing.Bounce.EaseOut(1-b);};ig.Tween.Easing.Bounce.EaseOut=function(b){y4tt.q9();return(b/=1)<1/2.75?7.5625*b*b:b<2/2.75?7.5625*(b-=1.5/2.75)*b+0.75:b<2.5/2.75?7.5625*(b-=2.25/2.75)*b+0.9375:7.5625*(b-=2.625/2.75)*b+0.984375;};ig.Tween.Easing.Bounce.EaseInOut=function(b){return 0.5>b?0.5*ig.Tween.Easing.Bounce.EaseIn(2*b):0.5*ig.Tween.Easing.Bounce.EaseOut(2*b-1)+0.5;};});ig.baked=!0;ig.module("plugins.url-parameters").defines(function(){ig.UrlParameters=ig.Class.extend({init:function(){var b;switch(getQueryVariable("iphone")){case"true":ig.ua.iPhone=!0,console.log("iPhone mode");}y4tt.v9();b=getQueryVariable("webview");if(b)switch(b){case"true":ig.ua.is_uiwebview=!0,console.log("webview mode");}if(b=getQueryVariable("debug"))switch(b){case"true":ig.game.showDebugMenu(),console.log("debug mode");}if(b=getQueryVariable("debugwgl"))switch(b){case"true":wgl.debug.debug=!0,console.log("wgl debug mode");}switch(getQueryVariable("view")){case"stats":ig.game.resetPlayerStats(),ig.game.endGame();}getQueryVariable("ad");}});});ig.baked=!0;ig.module("plugins.director").requires("impact.impact").defines(function(){ig.Director=ig.Class.extend({init:function(b,g){this.game=b;this.levels=[];this.currentLevel=0;this.append(g);},loadLevel:function(b){var e;y4tt.v9();for(var g in ig.sizeHandler.dynamicClickableEntityDivs){e=ig.domHandler.getElementById("#"+g);e&&ig.domHandler.hide(e);}this.currentLevel=b;this.game.loadLevel(this.levels[b]);return!0;},loadLevelWithoutEntities:function(b){this.currentLevel=b;this.game.loadLevelWithoutEntities(this.levels[b]);return!0;},append:function(b){y4tt.v9();newLevels=[];return"object"===typeof b?(b.constructor===[].constructor?newLevels=b:newLevels[0]=b,this.levels=this.levels.concat(newLevels),!0):!1;},nextLevel:function(){y4tt.v9();return this.currentLevel+1<this.levels.length?this.loadLevel(this.currentLevel+1):!1;},previousLevel:function(){return 0<=this.currentLevel-1?this.loadLevel(this.currentLevel-1):!1;},jumpTo:function(b){var g;g=null;for(i=0;i<this.levels.length;i++)this.levels[i]==b&&(g=i);return 0<=g?this.loadLevel(g):!1;},firstLevel:function(){y4tt.v9();return this.loadLevel(0);},lastLevel:function(){return this.loadLevel(this.levels.length-1);},reloadLevel:function(){return this.loadLevel(this.currentLevel);}});});ig.baked=!0;ig.module("plugins.impact-storage").requires("impact.game").defines(function(){ig.Storage=ig.Class.extend({staticInstantiate:function(){return!ig.Storage.instance?null:ig.Storage.instance;},init:function(){y4tt.q9();ig.Storage.instance=this;},isCapable:function(){return"undefined"!==typeof window.localStorage;},isSet:function(b){y4tt.v9();return null!==this.get(b);},initUnset:function(b,g){null===this.get(b)&&this.set(b,g);},get:function(b){y4tt.v9();if(!this.isCapable())return null;try{return JSON.parse(localStorage.getItem(b));}catch(g){return window.localStorage.getItem(b);}},getInt:function(b){return~~this.get(b);},getFloat:function(b){y4tt.q9();return parseFloat(this.get(b));},getBool:function(b){y4tt.q9();return!!this.get(b);},key:function(b){y4tt.q9();return this.isCapable()?window.localStorage.key(b):null;},set:function(b,g){if(!this.isCapable())return null;try{window.localStorage.setItem(b,JSON.stringify(g));}catch(e){console.log(e);}},setHighest:function(b,g){y4tt.q9();g>this.getFloat(b)&&this.set(b,g);},remove:function(b){if(!this.isCapable())return null;y4tt.v9();window.localStorage.removeItem(b);},clear:function(){if(!this.isCapable())return null;y4tt.q9();window.localStorage.clear();}});});this.START_BRANDING_SPLASH;ig.baked=!0;ig.module("plugins.branding.splash").requires("impact.impact","impact.entity").defines(function(){ig.BrandingSplash=ig.Class.extend({init:function(){ig.game.spawnEntity(EntityBranding,0,0);}});y4tt.q9();EntityBranding=ig.Entity.extend({gravityFactor:0,size:{x:32,y:32},splashlogo:new ig.Image("branding/logo.png"),init:function(b,g,e){this.parent(b,g,e);this.pos.x=ig.system.width/2;this.pos.y=0-this.splashlogo.height/2;b=this.tween({pos:{y:ig.system.height/2-this.splashlogo.height/2}},0.5,{easing:ig.Tween.Easing.Linear.EaseNone});g=this.tween({},2,{onComplete:function(){ig.game.director.loadLevel(ig.game.director.currentLevel);}});b.chain(g);b.start();},createClickableLayer:function(){console.log("Build clickable layer");this.checkClickableLayer("branding-splash",_SETTINGS.Branding.Logo.Link,!0);},doesClickableLayerExist:function(b){for(k in dynamicClickableEntityDivs)if(k==b)return!0;return!1;},checkClickableLayer:function(b,g,e){"undefined"==typeof wm&&(this.doesClickableLayerExist(b)?(ig.game.showOverlay([b]),$("#"+b).find("[href]").attr("href",g)):this.createClickableOutboundLayer(b,g,"media/graphics/misc/invisible.png",e));},createClickableOutboundLayer:function(b,g,e,c){var d,f,q;d=ig.$new("div");d.id=b;document.body.appendChild(d);$(((6297,8740)==(8599,4880)?"x":"#")+d.id).css("float","left");$("#"+d.id).css("position","absolute");if(ig.ua.mobile){f=window.innerHeight/mobileHeight,q=window.innerWidth/mobileWidth;$("#"+d.id).css("left",this.pos.x*q);$("#"+d.id).css("top",this.pos.y*f);$("#"+d.id).css("width",this.size.x*q);$("#"+d.id).css("height",this.size.y*f);}else f=w/2-destW/2,q=h/2-destH/2,console.log(f,q),$("#"+d.id).css("left",f+this.pos.x*multiplier),$("#"+d.id).css("top",q+this.pos.y*multiplier),$("#"+d.id).css("width",this.size.x*multiplier),$("#"+d.id).css("height",this.size.y*multiplier);c?$("#"+d.id).html("<a target='_blank' href='"+g+"'><img style='width:100%;height:100%' src='"+e+"'></a>"):$("#"+d.id).html("<a href='"+g+"'><img style='width:100%;height:100%' src='"+e+"'></a>");dynamicClickableEntityDivs[b]={};dynamicClickableEntityDivs[b].width=this.size.x*multiplier;dynamicClickableEntityDivs[b].height=this.size.y*multiplier;dynamicClickableEntityDivs[b].entity_pos_x=this.pos.x;dynamicClickableEntityDivs[b].entity_pos_y=this.pos.y;},draw:function(){ig.system.context.fillStyle="#242424";ig.system.context.fillRect(0,0,ig.system.width,ig.system.height);this.splashlogo.draw(this.pos.x-this.splashlogo.width/2,this.pos.y);this.parent();}});});this.END_BRANDING_SPLASH;ig.baked=!0;ig.module("plugins.datastructure.binary-heap").defines(function(){y4tt.q9();BinaryHeap=ig.Class.extend({content:[],getValue:null,minHeap:!0,tagName:"BinaryHeap",init:function(b,g){this.getValue=b;g&&(this.minHeap=!1);},push:function(b){this.content.push(b);this.sinkDown(this.content.length-1);},pop:function(){var b,g;b=this.content[0],g=this.content.pop();0<this.content.length&&(this.content[0]=g,this.bubbleUp(0));return b;},remove:function(b){var g,e;g=this.content.indexOf(b),e=this.content.pop();g!==this.content.length-1&&(this.content[g]=e,this.minHeap?this.getValue(e)<this.getValue(b)?this.sinkDown(g):this.bubbleUp(g):this.getValue(e)>this.getValue(b)?this.sinkDown(g):this.bubbleUp(g));},size:function(){return this.content.length;},rescoreElement:function(b){y4tt.v9();this.sinkDown(this.content.indexOf(b));},sinkDown:function(b){var e,c;for(var g=this.content[b];0<b;){e=(b+1>>1)-1,c=this.content[e];if(this.minHeap)if(this.getValue(g)<this.getValue(c))this.content[e]=g,this.content[b]=c,b=e;else break;else if(this.getValue(g)>this.getValue(c))this.content[e]=g,this.content[b]=c,b=e;else break;}},bubbleUp:function(b){var d,f,q,j;y4tt.q9();for(var g=this.content.length,e=this.content[b],c=this.getValue(e);;){d=b+1<<1,f=d-1,q=null;f<g&&(j=this.getValue(this.content[f]),this.minHeap?j<c&&(q=f):j>c&&(q=f));if(d<g)if(f=this.getValue(this.content[d]),this.minHeap){if(f<(null===q?c:j))q=d;}else if(f>(null===q?c:j))q=d;if(null!==q)this.content[b]=this.content[q],this.content[q]=e,b=q;else break;}},empty:function(){for(;0<this.content.length;)this.content.pop();}});});ig.baked=!0;ig.module("game.entities.branding-logo-placeholder").requires("impact.entity").defines(function(){y4tt.q9();EntityBrandingLogoPlaceholder=ig.Entity.extend({gravityFactor:0,size:{x:32,y:32},_wmDrawBox:!0,_wmBoxColor:"rgba(0, 0, 255, 0.7)",init:function(b,g,e){this.kill();this.parent(b,g,e);y4tt.q9();if(e)switch(console.log("settings found ... using that div layer name"),console.log("settings.centralize:",e.centralize),e.centralize){case"true":console.log("centralize true");centralize=!0;break;case"false":console.log("centralize false");centralize=!1;break;default:console.log("default ... centralize false"),centralize=!1;}else centralize=!1;"undefined"==typeof wm&&this.kill();}});});ig.baked=!0;ig.module("game.entities.buttons.button").requires("impact.entity").defines(function(){EntityButton=ig.Entity.extend({collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.A,size:new BABYLON.Vector2(48,48),fillColor:null,zIndex:95E3,pos:{x:0,y:0},name:"button",init:function(b,g,e){this.parent(b,g,e);!ig.global.wm&&(e&&!isNaN(e.zIndex))&&(this.zIndex=e.zIndex);b=Math.floor(256*Math.random());g=Math.floor(256*Math.random());y4tt.v9();e=Math.floor(256*Math.random());this.fillColor="rgba("+b+","+e+","+g+",1)";},clicked:function(){y4tt.q9();throw"no implementation on clicked()";},clicking:function(){throw"no implementation on clicking()";},released:function(){throw"no implementation on released()";}});});ig.baked=!0;ig.module("plugins.clickable-div-layer").defines(function(){y4tt.v9();ClickableDivLayer=ig.Class.extend({pos:new BABYLON.Vector2(0,0),size:new BABYLON.Vector2(0,0),identifier:null,invisImagePath:"media/graphics/misc/invisible.png",init:function(b){var g,e,c;y4tt.q9();this.pos=new BABYLON.Vector2(b.pos.x,b.pos.y);this.size=new BABYLON.Vector2(b.size.x,b.size.y);g="more-games",e="www.google.com",c=!1;b.div_layer_name&&(g=b.div_layer_name);b.link&&(e=b.link);b.newWindow&&(c=b.newWindow);this.createClickableLayer(g,e,c);},createClickableLayer:function(b,g,e){var c;this.identifier=b;c=ig.domHandler.getElementById("#"+b);c?(ig.domHandler.show(c),ig.domHandler.attr(c,"href",g)):this.createClickableOutboundLayer(b,g,this.invisImagePath,e);},update:function(b,g){y4tt.v9();this.pos.x===b&&this.pos.y===g||(ig.sizeHandler.dynamicClickableEntityDivs[this.identifier]={},ig.sizeHandler.dynamicClickableEntityDivs[this.identifier].width=this.size.x,ig.sizeHandler.dynamicClickableEntityDivs[this.identifier].height=this.size.y,ig.sizeHandler.dynamicClickableEntityDivs[this.identifier].entity_pos_x=this.pos.x,ig.sizeHandler.dynamicClickableEntityDivs[this.identifier].entity_pos_y=this.pos.y);},createClickableOutboundLayer:function(b,g,e,c){var d,f,q,j;d=ig.domHandler.create("div");ig.domHandler.attr(d,"id",b);f=ig.domHandler.create("a");c?(ig.domHandler.attr(f,"href",g),ig.domHandler.attr(f,"target","_blank")):ig.domHandler.attr(f,"href",g);g=ig.domHandler.create("img");ig.domHandler.css(g,{width:"100%",height:"100%"});ig.domHandler.attr(g,"src",e);e=Math.min(ig.sizeHandler.scaleRatioMultiplier.x,ig.sizeHandler.scaleRatioMultiplier.y);if(ig.ua.mobile){c=Math.floor(this.pos.x*ig.sizeHandler.scaleRatioMultiplier.x)+"px";q=Math.floor(this.pos.y*ig.sizeHandler.scaleRatioMultiplier.y)+"px",j=Math.floor(this.size.x*ig.sizeHandler.scaleRatioMultiplier.x)+"px";e=Math.floor(this.size.y*ig.sizeHandler.scaleRatioMultiplier.y)+"px";}else c=ig.domHandler.getElementById("#canvas"),c=ig.domHandler.getOffsets(c),q=c.top,c=Math.floor(c.left+this.pos.x*e)+"px",q=Math.floor(q+this.pos.y*e)+"px",j=Math.floor(this.size.x*e)+"px",e=Math.floor(this.size.y*e)+"px";ig.domHandler.css(d,{"float":"left",position:"absolute",left:c,top:q,width:j,height:e,"z-index":3});ig.domHandler.addEvent(d,"mousemove",ig.input.mousemove.bind(ig.input),!1);ig.domHandler.appendChild(f,g);ig.domHandler.appendChild(d,f);y4tt.v9();ig.domHandler.appendToBody(d);ig.sizeHandler.dynamicClickableEntityDivs[b]={};ig.sizeHandler.dynamicClickableEntityDivs[b].width=this.size.x;ig.sizeHandler.dynamicClickableEntityDivs[b].height=this.size.y;ig.sizeHandler.dynamicClickableEntityDivs[b].entity_pos_x=this.pos.x;ig.sizeHandler.dynamicClickableEntityDivs[b].entity_pos_y=this.pos.y;}});});ig.baked=!0;ig.module("game.entities.buttons.button-more-games").requires("game.entities.buttons.button","plugins.clickable-div-layer").defines(function(){EntityButtonMoreGames=EntityButton.extend({type:ig.Entity.TYPE.A,gravityFactor:0,logo:new ig.AnimationSheet("media/graphics/sprites/btn_more_games.png",64,66),size:{x:250,y:66},zIndex:750,clickableLayer:null,link:null,newWindow:!1,div_layer_name:"more-games",name:"moregames",init:function(b,g,e){this.parent(b,g,e);ig.global.wm||(this.div_layer_name=e.div_layer_name?e.div_layer_name:"more-games",_SETTINGS.MoreGames.Enabled?(_SETTINGS.MoreGames.Link&&(this.link=_SETTINGS.MoreGames.Link),_SETTINGS.MoreGames.NewWindow&&(this.newWindow=_SETTINGS.MoreGames.NewWindow),this.clickableLayer=new ClickableDivLayer(this)):this.kill());},show:function(){var b;b=ig.domHandler.getElementById("#"+this.div_layer_name);y4tt.q9();b&&ig.domHandler.show(b);},hide:function(){var b;b=ig.domHandler.getElementById("#"+this.div_layer_name);b&&ig.domHandler.hide(b);},clicked:function(){},clicking:function(){},released:function(){},draw:function(){var b;this.parent();b=ig.system.context;b.save();b.font="50px newcomictitle";b.textAlign="center";b.fillStyle="#ffffff";b.textBaseline="middle";ig.game.settingMode||b.fillText(_STRINGS.Game.moreGames,this.pos.x+this.size.x/2,this.pos.y+this.size.y/2);y4tt.q9();b.restore();}});});ig.baked=!0;ig.module("game.entities.opening-shield").requires("impact.entity").defines(function(){y4tt.v9();EntityOpeningShield=ig.Entity.extend({size:{x:48,y:48},move:0,mIconAnim:0,shieldAnim:0,titleAnim:0,shieldImage:new ig.Image("media/graphics/opening/shield.png"),mIconImage:new ig.Image("media/graphics/opening/m_icon.png"),titleImage:new ig.Image("media/graphics/opening/title.png"),init:function(b,g,e){this.parent(b,g,e);},ready:function(){if(!ig.wm)if(_SETTINGS.DeveloperBranding.Splash.Enabled){this.initTimer=new ig.Timer(0.1);try{ig.soundHandler.playSound(ig.soundHandler.SOUNDID.openingSound);}catch(b){console.log(b);}}else ig.game.director.nextLevel(),ig.system.context.globalAlpha=1,this.kill();},update:function(){this.parent();this.updateOriginalShieldOpening();},draw:function(){this.parent();y4tt.v9();ig.global.wm||(this.nextLevelTimer&&0>this.nextLevelTimer.delta()&&(ig.system.context.globalAlpha=-this.nextLevelTimer.delta()),this.drawOriginalShieldOpening());},updateOriginalShieldOpening:function(){this.initTimer&&0<this.initTimer.delta()&&(this.initTimer=null,this.sheildTimer=new ig.Timer(0.05));y4tt.v9();this.sheildTimer&&0<this.sheildTimer.delta()&&(3>this.shieldAnim?(this.shieldAnim++,this.sheildTimer.reset()):(this.sheildTimer=null,this.moveTimer=new ig.Timer(0.001),this.mIconTimer=new ig.Timer(0.05),this.titleTimer=new ig.Timer(0.15)));this.moveTimer&&0<this.moveTimer.delta()&&(this.move+=0.3,this.moveTimer.reset());this.mIconTimer&&0<this.mIconTimer.delta()&&(12>this.mIconAnim?(this.mIconAnim++,this.moveTimer.reset()):this.mIconTimer=null);this.titleTimer&&0<this.titleTimer.delta()&&(11>this.titleAnim?(this.titleAnim++,this.titleTimer.reset()):(this.titleTimer=null,this.nextLevelTimer=new ig.Timer(1)));this.nextLevelTimer&&0<this.nextLevelTimer.delta()&&(this.nextLevelTimer=null,ig.game.director.nextLevel(),ig.system.context.globalAlpha=1);},drawOriginalShieldOpening:function(){var b,g,e;if(this.moveTimer){b=ig.system.context;b.save();g=ig.system.width/2,e=ig.system.height/2;b.translate(g,e);b.rotate(this.move*Math.PI/180);b.beginPath();b.moveTo(0,0);for(var c=0,d=1;48>=d;d+=1)b.lineTo(0+800*Math.cos(2*d*Math.PI/48),0+800*Math.sin(2*d*Math.PI/48)),c++,2==c&&(c=0,b.lineTo(0,0));b.translate(-g,-e);g=b.createRadialGradient(g,e,100,g,e,250);g.addColorStop(0,"rgba(255,255,255,0.1)");g.addColorStop(1,"rgba(0,0,0,0)");b.fillStyle=g;b.fill();b.restore();}this.shieldImage.drawTile(ig.system.width/2-91,0-(768-ig.system.height)/2,this.shieldAnim,182,768);this.moveTimer&&(this.mIconImage.drawTile(ig.system.width/2-96,ig.system.height/2-70,this.mIconAnim,166,160),this.titleImage.drawTile(ig.system.width/2-204,ig.system.height/2+100,this.titleAnim,409,76));ig.system.context.globalAlpha=1;}});});ig.baked=!0;ig.module("game.entities.opening-kitty").requires("impact.entity").defines(function(){y4tt.q9();EntityOpeningKitty=ig.Entity.extend({size:{x:48,y:48},kittyAnim:-1,kittyImage:new ig.Image("media/graphics/opening/kitty.png"),kittyTitleImage:new ig.Image("media/graphics/opening/kittytitle.png"),soundKey:"kittyopeningSound",init:function(b,g,e){this.parent(b,g,e);},ready:function(){if(!ig.wm)if(_SETTINGS.DeveloperBranding.Splash.Enabled){this.initTimer=new ig.Timer(0.1);try{ig.soundHandler.sfxPlayer.play(this.soundKey);}catch(b){console.log(b);}}else ig.game.director.nextLevel(),ig.system.context.globalAlpha=1,this.kill();},update:function(){y4tt.v9();this.parent();this.updateKittyOpening();},draw:function(){this.parent();y4tt.v9();ig.global.wm||(this.nextLevelTimer&&0>this.nextLevelTimer.delta()&&(ig.system.context.globalAlpha=-this.nextLevelTimer.delta()),this.drawKittyOpening());},updateKittyOpening:function(){y4tt.v9();this.initTimer&&0<this.initTimer.delta()&&(this.initTimer=null,this.kittyTimer=new ig.Timer(0.15));this.kittyTimer&&0<this.kittyTimer.delta()&&(7>this.kittyAnim?(this.kittyAnim++,this.kittyTimer.reset()):(this.kittyTimer=null,this.nextLevelTimer=new ig.Timer(2)));this.nextLevelTimer&&0<this.nextLevelTimer.delta()&&(this.nextLevelTimer=null,ig.game.director.nextLevel(),ig.system.context.globalAlpha=1);},drawKittyOpening:function(){var b;b=ig.system.context.createLinearGradient(0,0,0,ig.system.height);b.addColorStop(0,"#ffed94");b.addColorStop(1,"#ffcd85");ig.system.context.fillStyle=b;ig.system.context.fillRect(0,0,ig.system.width,ig.system.height);0<=this.kittyAnim&&(this.kittyImage.drawTile((ig.system.width>>>1)-(this.kittyImage.width>>>3),(ig.system.height>>>1)-(this.kittyImage.height>>>2),this.kittyAnim,218,325),this.kittyTitleImage.drawTile((ig.system.width>>>1)-(this.kittyTitleImage.width>>>1),(ig.system.height>>>1)+(this.kittyImage.height>>>2)+10,this.kittyAnim,380,37));ig.system.context.globalAlpha=1;}});});ig.baked=!0;ig.module("game.entities.pointer").requires("impact.entity").defines(function(){EntityPointer=ig.Entity.extend({checkAgainst:ig.Entity.TYPE.BOTH,isFirstPressed:!1,isPressed:!1,isReleased:!1,isHovering:!1,hoveringItem:null,objectArray:[],clickedObjectList:[],ignorePause:!0,zIndex:5E3,name:"pointer",check:function(b){this.objectArray.push(b);},clickObject:function(b){y4tt.q9();this.isFirstPressed&&"function"==typeof b.clicked&&(b.clicked(),this.addToClickedObjectList(b));this.isPressed&&!this.isReleased&&"function"==typeof b.clicking&&b.clicking();this.isReleased&&"function"==typeof b.released&&(b.released(),this.removeFromClickedObjectList(b));},refreshPos:function(){this.pos=ig.game.io.getClickPos();},update:function(){var b,g;this.parent();this.refreshPos();b=null,g=-1;for(a=this.objectArray.length-1;-1<a;a--)this.objectArray[a].zIndex>g&&(g=this.objectArray[a].zIndex,b=this.objectArray[a]);if(null!=b)null!=this.hoveringItem?this.hoveringItem!=b&&("function"==typeof this.hoveringItem.leave&&this.hoveringItem.leave(),"function"==typeof b.over&&b.over()):"function"==typeof b.over&&b.over(),this.hoveringItem=this.lastEnt=b,this.clickObject(b),this.objectArray=[];else if(null!=this.hoveringItem&&"function"==typeof this.hoveringItem.leave&&(this.hoveringItem.leave(),this.hoveringItem=null),this.isReleased){for(b=0;b<this.clickedObjectList.length;b++)g=this.clickedObjectList[b],"function"==typeof g.releasedOutside&&g.releasedOutside();this.lastEnt&&(this.lastEnt.release&&this.lastEnt.released(),this.lastEnt=null);this.clickedObjectList=[];}this.isFirstPressed=ig.input.pressed("click");this.isReleased=ig.input.released("click");this.isPressed=ig.input.state("click");},addToClickedObjectList:function(b){this.clickedObjectList.push(b);},removeFromClickedObjectList:function(b){var c;for(var g=[],e=0;e<this.clickedObjectList.length;e++){c=this.clickedObjectList[e];c!=b&&g.push(c);}this.clickedObjectList=g;}});});ig.baked=!0;ig.module("game.entities.pointer-selector").requires("game.entities.pointer").defines(function(){y4tt.q9();EntityPointerSelector=EntityPointer.extend({zIndex:1E3,_wmDrawBox:!0,_wmBoxColor:"rgba(0, 0, 255, 0.7)",size:{x:20,y:20},init:function(b,g,e){this.parent(b,g,e);}});});ig.baked=!0;ig.module("game.entities.select").requires("impact.entity").defines(function(){y4tt.q9();EntitySelect=ig.Entity.extend({type:ig.Entity.TYPE.B,checkAgainst:ig.Entity.TYPE.A,collides:ig.Entity.COLLIDES.NEVER,canSelect:!1,canSelectTimerDuration:0.35,zIndex:99999,isHovering:!1,isSelected:!1,init:function(b,g,e){y4tt.v9();this.parent(b,g,e);this.canSelectTimer=new ig.Timer(this.canSelectTimerDuration);},doesClickableLayerExist:function(b){for(k in dynamicClickableEntityDivs)if(k==b)return!0;return!1;},checkClickableLayer:function(b,g,e){"undefined"==typeof wm&&(this.doesClickableLayerExist(b)?(ig.game.showOverlay([b]),$("#"+b).find("[href]").attr("href",g)):this.createClickableOutboundLayer(b,g,"media/graphics/misc/invisible.png",e));},createClickableOutboundLayer:function(b,g,e,c){var d,f,q;d=ig.$new("div");y4tt.v9();d.id=b;document.body.appendChild(d);$("#"+d.id).css("float","left");$("#"+d.id).css("width",this.size.x*multiplier);$("#"+d.id).css("height",this.size.y*multiplier);$("#"+d.id).css("position","absolute");f=w/2-destW/2,q=h/2-destH/2;w==mobileWidth?($("#"+d.id).css("left",this.pos.x),$("#"+d.id).css("top",this.pos.y)):($("#"+d.id).css("left",f+this.pos.x*multiplier),$("#"+d.id).css("top",q+this.pos.y*multiplier));c?$("#"+d.id).html("<a target='_blank' href='"+g+"'><img style='width:100%;height:100%' src='"+e+"'></a>"):$("#"+d.id).html("<a href='"+g+"'><img style='width:100%;height:100%' src='"+e+"'></a>");dynamicClickableEntityDivs[b]={};dynamicClickableEntityDivs[b].width=$("#"+d.id).width();dynamicClickableEntityDivs[b].height=$("#"+d.id).height();dynamicClickableEntityDivs[b].entity_pos_x=this.pos.x;dynamicClickableEntityDivs[b].entity_pos_y=this.pos.y;},hovered:function(){this.isHovering=!0;this.dehoverOthers();},dehoverOthers:function(){var b;y4tt.q9();b=ig.game.getEntitiesByType(EntitySelect);for(i=0;i<b.length;i++)b[i]!=this&&(b[i].isHovering=!1);},deselectOthers:function(){var b;b=ig.game.getEntitiesByType(EntitySelect);for(i=0;i<b.length;i++)b[i]!=this&&(b[i].isSelected=!1);},update:function(){this.parent();this.canSelectTimer&&0<this.canSelectTimer.delta()&&(this.canSelect=!0,this.canSelectTimer=null);}});});ig.baked=!0;ig.module("game.entities.modifier-checkbox").requires("impact.entity").defines(function(){EntityModifierCheckbox=ig.Entity.extend({type:ig.Entity.TYPE.B,size:{x:40,y:40},zIndex:760,mod1:_STRINGS.Game.sameLengthObstacle,mod2:_STRINGS.Game.doubleSpeed,mod3:_STRINGS.Game.monochrome,mod4:_STRINGS.Game.spaceBlue,mod5:_STRINGS.Game.extremeParticles,mod6:_STRINGS.Game.pitchBlack,modifierName:"",modifierType:1,checked:!1,init:function(b,g,e){this.parent(b,g,e);y4tt.q9();if(!ig.global.wm)switch(this.modifierType){case 1:this.modifierName=this.mod1;ig.game.playerStats.sameLengthObstacle&&(this.checked=!0);break;case 2:this.modifierName=this.mod2;ig.game.playerStats.doubleSpeed&&(this.checked=!0);break;case 3:this.modifierName=this.mod3;ig.game.playerStats.monochrome&&"monochrome"==ig.game.playerStats.backgroundShader&&(this.checked=!0);break;case 4:this.modifierName=this.mod4;ig.game.playerStats.saturatedBlue&&"saturated"==ig.game.playerStats.backgroundShader&&(this.checked=!0);break;case 5:this.modifierName=this.mod5;ig.game.playerStats.extremeParticles&&(this.checked=!0);break;case 6:this.modifierName=this.mod6,ig.game.playerStats.pitchBlack&&(this.checked=!0);}},update:function(){this.parent();4==this.modifierType?!0==ig.game.playerStats.monochrome&&(this.checked=!1,ig.game.playerStats.saturatedBlue=!1):3==this.modifierType&&!0==ig.game.playerStats.saturatedBlue&&(this.checked=!1,ig.game.playerStats.monochrome=!1);},clicked:function(){},clicking:function(){},released:function(){y4tt.q9();if(this.checked)this.checked=!1,ig.soundHandler.sfxPlayer.play("selectSound"),1==this.modifierType&&(ig.game.playerStats.sameLengthObstacle=!1),2==this.modifierType&&(ig.game.playerStats.doubleSpeed=!1),3==this.modifierType&&(ig.game.playerStats.monochrome=!1,!1==ig.game.playerStats.saturatedBlue&&(ig.game.playerStats.backgroundShader="default")),4==this.modifierType&&(ig.game.playerStats.saturatedBlue=!1,!1==ig.game.playerStats.monochrome&&(ig.game.playerStats.backgroundShader="default")),5==this.modifierType&&(ig.game.playerStats.extremeParticles=!1),6==this.modifierType&&(ig.game.playerStats.pitchBlack=!1);else{this.checked=!0;ig.soundHandler.sfxPlayer.play("selectSound");1==this.modifierType&&(ig.game.playerStats.sameLengthObstacle=!0);2==this.modifierType&&(ig.game.playerStats.doubleSpeed=!0);if(3==this.modifierType){ig.game.playerStats.monochrome=!0;ig.game.playerStats.backgroundShader="monochrome";for(i=0;i<ig.game.getEntitiesByType(EntityModifierCheckbox).length;i++)4==ig.game.getEntitiesByType(EntityModifierCheckbox)[i].modifierType&&!0==ig.game.playerStats.saturatedBlue&&(ig.game.playerStats.saturatedBlue=!1,ig.game.getEntitiesByType(EntityModifierCheckbox)[i].checked=!1);}if(4==this.modifierType){ig.game.playerStats.saturatedBlue=!0;ig.game.playerStats.backgroundShader="saturated";for(i=0;i<ig.game.getEntitiesByType(EntityModifierCheckbox).length;i++)3==ig.game.getEntitiesByType(EntityModifierCheckbox)[i].modifierType&&!0==ig.game.playerStats.monochrome&&(ig.game.playerStats.monochrome=!1,ig.game.getEntitiesByType(EntityModifierCheckbox)[i].checked=!1);}5==this.modifierType&&(ig.game.playerStats.extremeParticles=!0);6==this.modifierType&&(ig.game.playerStats.pitchBlack=!0);}},draw:function(){var b;this.parent();b=ig.system.context;y4tt.q9();ig.game.showModeText&&(b.save(),b.font="20px newcomictitle",b.textAlign="left",b.textBaseline="middle",b.fillStyle="#000000",b.fillText(this.modifierName,this.pos.x+this.size.x+30,this.pos.y+this.size.y/2),b.fillStyle="#000000",b.strokeStyle="#000000",b.lineWidth=3,b.strokeRect(this.pos.x,this.pos.y,this.size.x,this.size.y),this.checked&&(b.font="24px newcomictitle",b.fillStyle="#000000",b.textAlign="center",b.fillText("X",this.pos.x+this.size.x/2,this.pos.y+this.size.y/2)),b.restore());},kill:function(){this.parent();}});});ig.baked=!0;ig.module("game.entities.mode-settings").requires("impact.entity","game.entities.modifier-checkbox").defines(function(){EntityModeSettings=ig.Entity.extend({type:ig.Entity.TYPE.B,size:{x:380,y:580},zIndex:755,initTrigger:!0,modifierCheckbox:[],backButtonImg:new ig.Image("media/graphics/sprites/backbutton.png"),init:function(b,g,e){this.parent(b,g,e);},update:function(){y4tt.q9();this.initTrigger&&(this.exitBoxPosX=this.pos.x+this.size.x-80,this.exitBoxPosY=this.pos.y+350,this.exitBoxSizeX=85,this.exitBoxSizeY=76,this.modifierCheckbox.push(ig.game.spawnEntity(EntityModifierCheckbox,this.pos.x+30,this.pos.y+100+0,{modifierType:1})),this.modifierCheckbox.push(ig.game.spawnEntity(EntityModifierCheckbox,this.pos.x+30,this.pos.y+100+70,{modifierType:2})),this.modifierCheckbox.push(ig.game.spawnEntity(EntityModifierCheckbox,this.pos.x+30,this.pos.y+100+140,{modifierType:3})),this.modifierCheckbox.push(ig.game.spawnEntity(EntityModifierCheckbox,this.pos.x+30,this.pos.y+100+210,{modifierType:4})),this.modifierCheckbox.push(ig.game.spawnEntity(EntityModifierCheckbox,this.pos.x+30,this.pos.y+100+280,{modifierType:5})),this.modifierCheckbox.push(ig.game.spawnEntity(EntityModifierCheckbox,this.pos.x+30,this.pos.y+100+350,{modifierType:6})),ig.game.sortEntitiesDeferred(),this.initTrigger=!1);this.clickClose(this.exitBoxPosX,this.exitBoxPosY,this.exitBoxSizeX,this.exitBoxSizeY);},draw:function(){var b;this.parent();b=ig.system.context;ig.game.showModeText&&(b.save(),b.globalAlpha=0.9,b.fillStyle="#000000",b.globalAlpha=1,b.strokeStyle="#000000",b.lineWidth=1,b.textAlign="center",b.fillStyle="#000000",b.font="40px newcomictitle",b.fillText(_STRINGS.Game.mutators,this.pos.x+this.size.x/2,this.pos.y+50),this.drawExitBox(b,this.exitBoxPosX,this.exitBoxPosY,this.exitBoxSizeX,this.exitBoxSizeY),b.restore());},kill:function(){y4tt.q9();this.parent();this.gameControl=ig.game.getEntitiesByType(EntityGameControl)[0];this.gameControl.moreGames.show();this.gameControl.buttonSettings.modeSettings=null;for(i=0;i<this.modifierCheckbox.length;i++)this.modifierCheckbox[i].kill();},clickOutside:function(){var b;this.pointer=ig.game.getEntitiesByType(EntityPointer)[0];b=this.pointer.pos.x>this.pos.x&&this.pointer.pos.x<this.pos.x+this.size.x&&this.pointer.pos.y>this.pos.y&&this.pointer.pos.y<this.pos.y+this.size.y;ig.input.pressed("click")&&(b||this.kill());},clickClose:function(b,g,e,c){this.pointer=ig.game.getEntitiesByType(EntityPointer)[0];b=this.pointer.pos.x>b&&this.pointer.pos.x<b+e&&this.pointer.pos.y>g&&this.pointer.pos.y<g+c;y4tt.q9();ig.input.pressed("click")&&b&&(this.kill(),this.playerCharacter=wgl.game.getEntityByName("playerCharacter"),this.playerCharacter[0].minimizeBox(),ig.soundHandler.sfxPlayer.play("selectSound"),this.gameControl=ig.game.getEntitiesByType(EntityGameControl)[0],this.gameControl.refreshParticle(),this.gameControl.refreshLight(),ig.game.submitStats());},drawExitBox:function(b,g,e,c,d){b.drawImage(this.backButtonImg.data,g,e,c,d);}});});ig.baked=!0;ig.module("game.entities.button-settings").requires("impact.entity","game.entities.mode-settings").defines(function(){y4tt.v9();EntityButtonSettings=ig.Entity.extend({type:ig.Entity.TYPE.A,size:{x:76.5,y:66.6},zIndex:750,buttonImg:new ig.Image("media/graphics/sprites/mutator-button.png"),init:function(b,g,e){this.parent(b,g,e);},clicked:function(){},clicking:function(){},released:function(){ig.soundHandler.sfxPlayer.play("selectSound");this.modeSettings=ig.game.spawnEntity(EntityModeSettings,0,0);this.modeSettings.pos.x=(ig.system.width-this.modeSettings.size.x)/2;this.modeSettings.pos.y=(ig.system.height-this.modeSettings.size.y)/2;this.gameControl=ig.game.getEntitiesByType(EntityGameControl)[0];this.gameControl.moreGames.hide();this.playerCharacter=wgl.game.getEntityByName("playerCharacter");this.playerCharacter[0].expandBox();},draw:function(){var b;this.parent();b=ig.system.context;b.save();b.fillStyle="#ffffff";ig.game.settingMode||b.drawImage(this.buttonImg.data,this.pos.x,this.pos.y,this.size.x,this.size.y);b.font="12px newcomictitle";b.textAlign="center";b.fillStyle="#000000";b.textAlign="start";b.restore();}});});ig.baked=!0;ig.module("game.entities.button-sound").requires("impact.entity").defines(function(){EntityButtonSound=ig.Entity.extend({type:ig.Entity.TYPE.A,size:{x:68,y:60.8},zIndex:750,soundOnImg:new ig.Image("media/graphics/sprites/button-sound-on.png"),soundOffImg:new ig.Image("media/graphics/sprites/button-sound-off.png"),active:!0,init:function(b,g,e){this.parent(b,g,e);ig.global.wm||(!0===ig.game.playerStats.soundSwitch?(this.active=!0,ig.soundHandler.forceUnMuteAll()):!1===ig.game.playerStats.soundSwitch&&(this.active=!1,ig.soundHandler.forceMuteAll()));},update:function(){ig.game.playerStats.soundSwitch!==this.active&&(!0===ig.game.playerStats.soundSwitch?(this.active=!0,ig.soundHandler.forceUnMuteAll()):!1===ig.game.playerStats.soundSwitch&&(this.active=!1,ig.soundHandler.forceMuteAll()));},clicked:function(){},clicking:function(){},released:function(){ig.soundHandler.sfxPlayer.play("selectSound");!0===this.active?(this.active=!1,ig.soundHandler.forceMuteAll(),ig.game.fnMute(),ig.game.playerStats.soundSwitch=!1,ig.game.submitStats()):!1===this.active&&(this.active=!0,ig.soundHandler.forceUnMuteAll(),ig.game.fnUnmute(),ig.game.playerStats.soundSwitch=!0,ig.game.submitStats());},draw:function(){var b;this.parent();b=ig.system.context;b.save();b.fillStyle="#ffffff";ig.game.settingMode||(this.active?b.drawImage(this.soundOnImg.data,this.pos.x,this.pos.y,this.size.x,this.size.y):(b.globalAlpha=0.5,b.drawImage(this.soundOffImg.data,this.pos.x,this.pos.y,this.size.x,this.size.y),b.globalAlpha=1));b.restore();}});});ig.baked=!0;ig.module("game.levels.opening").requires("impact.image","game.entities.opening-kitty").defines(function(){y4tt.v9();LevelOpening={entities:[{type:"EntityOpeningKitty",x:520,y:212}],layer:[]};});ig.baked=!0;ig.module("game.levels.main-menu").requires("impact.image","game.entities.branding-logo-placeholder","game.entities.pointer").defines(function(){LevelMainMenu={entities:[{type:"EntityBrandingLogoPlaceholder",x:316,y:472,settings:{div_layer_name:"layer_mainmenu",centralize:"true"}},{type:"EntityPointer",x:60,y:32}],layer:[{name:"background",width:30,height:40,linkWithCollision:!1,visible:1,tilesetName:"media/graphics/backgrounds/desktop/background.jpg",repeat:!1,preRender:!0,distance:"1",tilesize:16,foreground:!1,data:[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],[31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60],[61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90],[91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120],[121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150],[151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],[181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210],[211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240],[241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270],[271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300],[301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330],[331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360],[361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390],[391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420],[421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450],[451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480],[481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510],[511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540],[541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570],[571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600],[601,602,603,604,605,606,607,608,609,610,611,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630],[631,632,633,634,635,636,637,638,639,640,641,642,643,644,645,646,647,648,649,650,651,652,653,654,655,656,657,658,659,660],[661,662,663,664,665,666,667,668,669,670,671,672,673,674,675,676,677,678,679,680,681,682,683,684,685,686,687,688,689,690],[691,692,693,694,695,696,697,698,699,700,701,702,703,704,705,706,707,708,709,710,711,712,713,714,715,716,717,718,719,720],[721,722,723,724,725,726,727,728,729,730,731,732,733,734,735,736,737,738,739,740,741,742,743,744,745,746,747,748,749,750],[751,752,753,754,755,756,757,758,759,760,761,762,763,764,765,766,767,768,769,770,771,772,773,774,775,776,777,778,779,780],[781,782,783,784,785,786,787,788,789,790,791,792,793,794,795,796,797,798,799,800,801,802,803,804,805,806,807,808,809,810],[811,812,813,814,815,816,817,818,819,820,821,822,823,824,825,826,827,828,829,830,831,832,833,834,835,836,837,838,839,840],[841,842,843,844,845,846,847,848,849,850,851,852,853,854,855,856,857,858,859,860,861,862,863,864,865,866,867,868,869,870],[871,872,873,874,875,876,877,878,879,880,881,882,883,884,885,886,887,888,889,890,891,892,893,894,895,896,897,898,899,900],[901,902,903,904,905,906,907,908,909,910,911,912,913,914,915,916,917,918,919,920,921,922,923,924,925,926,927,928,929,930],[931,932,933,934,935,936,937,938,939,940,941,942,943,944,945,946,947,948,949,950,951,952,953,954,955,956,957,958,959,960],[961,962,963,964,965,966,967,968,969,970,971,972,973,974,975,976,977,978,979,980,981,982,983,984,985,986,987,988,989,990],[991,992,993,994,995,996,997,998,999,1E3,1001,1002,1003,1004,1005,1006,1007,1008,1009,1010,1011,1012,1013,1014,1015,1016,1017,1018,1019,1020],[1021,1022,1023,1024,1025,1026,1027,1028,1029,1030,1031,1032,1033,1034,1035,1036,1037,1038,1039,1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050],[1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080],[1081,1082,1083,1084,1085,1086,1087,1088,1089,1090,1091,1092,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1103,1104,1105,1106,1107,1108,1109,1110],[1111,1112,1113,1114,1115,1116,1117,1118,1119,1120,1121,1122,1123,1124,1125,1126,1127,1128,1129,1130,1131,1132,1133,1134,1135,1136,1137,1138,1139,1140],[1141,1142,1143,1144,1145,1146,1147,1148,1149,1150,1151,1152,1153,1154,1155,1156,1157,1158,1159,1160,1161,1162,1163,1164,1165,1166,1167,1168,1169,1170],[1171,1172,1173,1174,1175,1176,1177,1178,1179,1180,1181,1182,1183,1184,1185,1186,1187,1188,1189,1190,1191,1192,1193,1194,1195,1196,1197,1198,1199,1200]]}]};y4tt.q9();LevelMainMenuResources=[new ig.Image("media/graphics/backgrounds/desktop/background.jpg")];});ig.baked=!0;ig.module("game.entities.controllers.game-control").requires("impact.entity").defines(function(){y4tt.v9();EntityGameControl=ig.Entity.extend({type:ig.Entity.TYPE.B,size:{x:480,y:640},pos:{x:1,y:1},controller:null,zIndex:1,initialMaxCube:12,directionCount:0,turnValue:0,alpha:0,pulseSize:0,pulseAlpha:1,pulseMovementX:0,pulseMovementY:0,gameOverReposY:0,gameOverTextSize:0,gameOverLineWidth:0,camFov:0.6,camPosX:0,camPosY:30,camPosZ:-150,targetPos:20,hintAlpha:0.9,hintShowTime:360,init:function(b,g,e){y4tt.v9();this.parent(b,g,e);ig.global.wm||(this.createScene(),this.createLight(),this.createSkyBox(),this.createKeyboardControl(),wgl.game.currentScene=this.scene,ig.game.branchRotation=0,ig.game.platformSpeed=1.5,ig.game.gameStarted=!1,ig.game.despawningPlatform=!1,ig.game.showEndText=!1,ig.game.outlineMode=!0,ig.game.outlineWidth=1,ig.game.gameScore=0,ig.game.cycleCount=0,this.mainCamera=wgl.game.spawnEntity(wgl.modules.mainCamera,0,0,0),this.cubeSpawner=wgl.game.spawnEntity(wgl.modules.cubeSpawner,0,0,20*this.initialMaxCube,{initialMaxCube:this.initialMaxCube}),this.playerCharacter=wgl.game.spawnEntity(wgl.modules.playerCharacter,0,25,0),this.pointer=ig.game.spawnEntity(EntityPointer,0,0),this.moreGames=ig.game.spawnEntity(EntityButtonMoreGames,ig.system.width/2-125,0.87*ig.system.height),this.buttonSettings=ig.game.spawnEntity(EntityButtonSettings,ig.system.width-100-40,0.87*ig.system.height-15-60),this.buttonSound=ig.game.spawnEntity(EntityButtonSound,60,0.87*ig.system.height-15-60),wgl.system.registerBeforeRender(),wgl.system.stopRender(),wgl.system.startRender());},createKeyboardControl:function(){ig.input.initKeyboard();ig.input.bind(ig.KEY.LEFT_ARROW,"left_arrow");ig.input.bind(ig.KEY.RIGHT_ARROW,"right_arrow");},createScene:function(){this.scene=new BABYLON.Scene(wgl.system.engine);y4tt.v9();this.scene.clearColor=new BABYLON.Color3(0.5,0.5,0.8);},createSkyBox:function(){this.backgroundshader=ig.game.playerStats.backgroundShader;this.skybox=BABYLON.MeshBuilder.CreateSphere("skybox",{segments:12,diameter:1E3},this.scene);BABYLON.Effect.ShadersStore.gradientVertexShader="precision mediump float;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;uniform mat4 worldViewProjection;varying vec4 vPosition;varying vec3 vNormal;void main(){vec4 p = vec4(position,1.);vPosition = p;vNormal = normal;gl_Position = worldViewProjection * p;}";BABYLON.Effect.ShadersStore.gradientPixelShader="precision mediump float;uniform mat4 worldView;varying vec4 vPosition;varying vec3 vNormal;uniform float offset;uniform vec3 topColor;uniform vec3 bottomColor;void main(void){float h = normalize(vPosition+offset).y;gl_FragColor = vec4(mix(bottomColor,topColor,max(pow(max(h,0.0),0.6),0.0)),1.0);}";this.shader=new BABYLON.ShaderMaterial("gradient",this.scene,"gradient",{});this.shader.setFloat("offset",10);y4tt.v9();!ig.game.playerStats.monochrome&&!ig.game.playerStats.saturatedBlue&&(this.shader.setColor3("topColor",BABYLON.Color3.FromInts(136,161,172)),this.shader.setColor3("bottomColor",BABYLON.Color3.FromInts(86,111,122)));ig.game.playerStats.monochrome&&(this.shader.setColor3("topColor",BABYLON.Color3.FromInts(0,0,0)),this.shader.setColor3("bottomColor",BABYLON.Color3.FromInts(200,200,200)));ig.game.playerStats.saturatedBlue&&(this.shader.setColor3("topColor",BABYLON.Color3.FromInts(0,50,120)),this.shader.setColor3("bottomColor",BABYLON.Color3.FromInts(0,0,40)));this.shader.backFaceCulling=!1;this.skybox.material=this.shader;ig.game.playerStats.extremeParticles?this.particleGenerator2():this.particleGenerator();},refreshShader:function(){BABYLON.Effect.ShadersStore.gradientVertexShader="precision mediump float;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;uniform mat4 worldViewProjection;varying vec4 vPosition;varying vec3 vNormal;void main(){vec4 p = vec4(position,1.);vPosition = p;vNormal = normal;gl_Position = worldViewProjection * p;}";BABYLON.Effect.ShadersStore.gradientPixelShader="precision mediump float;uniform mat4 worldView;varying vec4 vPosition;varying vec3 vNormal;uniform float offset;uniform vec3 topColor;uniform vec3 bottomColor;void main(void){float h = normalize(vPosition+offset).y;gl_FragColor = vec4(mix(bottomColor,topColor,max(pow(max(h,0.0),0.6),0.0)),1.0);}";this.shader.setFloat("offset",10);"default"===ig.game.playerStats.backgroundShader&&(this.shader.setColor3("topColor",BABYLON.Color3.FromInts(136,161,172)),this.shader.setColor3("bottomColor",BABYLON.Color3.FromInts(86,111,122)),ig.game.playerStats.backgroundShader="default");"monochrome"===ig.game.playerStats.backgroundShader&&(this.shader.setColor3("topColor",BABYLON.Color3.FromInts(0,0,0)),this.shader.setColor3("bottomColor",BABYLON.Color3.FromInts(200,200,200)),ig.game.playerStats.backgroundShader="monochrome");"saturated"===ig.game.playerStats.backgroundShader&&(this.shader.setColor3("topColor",BABYLON.Color3.FromInts(0,80,160)),this.shader.setColor3("bottomColor",BABYLON.Color3.FromInts(0,50,120)),ig.game.playerStats.backgroundShader="saturated");this.backgroundShader=ig.game.playerStats.backgroundShader;this.skybox.material=this.shader;},createLight:function(){this.light=new BABYLON.HemisphericLight("hemi",new BABYLON.Vector3(-0.5,1,0),this.scene);this.light2=new BABYLON.HemisphericLight("hemi2",new BABYLON.Vector3(0,1,0),this.scene);ig.game.playerStats.pitchBlack?(this.light.intensity=0,this.light2.intensity=0.02):(this.light.intensity=0.3,this.light2.intensity=0.2);},refreshLight:function(){ig.game.playerStats.pitchBlack?(this.light.intensity=0,this.light2.intensity=0.02):(this.light.intensity=0.3,this.light2.intensity=0.2);},update:function(){this.parent();this.tapControl();this.pulseScore();this.backgroundShader!==ig.game.playerStats.backgroundShader&&this.refreshShader();wgl.game.currentScene.activeCamera.fov!==this.camFov&&(wgl.game.currentScene.activeCamera.fov=this.camFov);wgl.game.currentScene.activeCamera.position.z!==this.camPosZ&&(wgl.game.currentScene.activeCamera.position.z=this.camPosZ,wgl.game.currentScene.activeCamera.setTarget(new BABYLON.Vector3(0,this.targetPos,0)));wgl.game.currentScene.activeCamera.position.x!==this.camPosX&&(wgl.game.currentScene.activeCamera.position.x=this.camPosX,wgl.game.currentScene.activeCamera.setTarget(new BABYLON.Vector3(0,this.targetPos,0)));wgl.game.currentScene.activeCamera.position.y!==this.camPosY&&(wgl.game.currentScene.activeCamera.position.y=this.camPosY,wgl.game.currentScene.activeCamera.setTarget(new BABYLON.Vector3(0,this.targetPos,0)));!ig.game.gameStarted&&!ig.game.gameOver&&wgl.game.currentScene.activeCamera.setTarget(new BABYLON.Vector3(0,this.targetPos,0));ig.game.playerStats.pitchBlack&&0!==this.light.intensity&&this.refreshLight();ig.game.gameStarted&&this.moreGames&&(this.moreGames.hide(),this.moreGames.kill(),this.buttonSettings.kill(),this.buttonSound.pos.y=10,this.buttonSound.pos.x=0.83*ig.system.width);ig.game.showEndText?(this.callOnce||(this.tween({gameOverReposY:150,gameOverTextSize:72,gameOverLineWidth:6},0.5,{easing:ig.Tween.Easing.Cubic.EaseOut}).start(),this.callOnce=!0),ig.game.playerStats.highscore<ig.game.gameScore&&(ig.game.playerStats.highscore=ig.game.gameScore,ig.game.submitStats()),this.gameOverControl()):(this.skybox&&(this.skybox.rotation.z+=0.001),this.animatedLight());},animatedLight:function(){0.9<this.light.direction.y?this.changeLightDirectionY=!0:-0.9>this.light.direction.y&&(this.changeLightDirectionY=!1);0.9<this.light.direction.x?this.changeLightDirectionX=!0:-0.9>this.light.direction.x&&(this.changeLightDirectionX=!1);this.light.direction.y=this.changeLightDirectionY?this.light.direction.y-5E-4:this.light.direction.y+5E-4;this.light.direction.x=this.changeLightDirectionX?this.light.direction.x-0.001:this.light.direction.x+0.001;},tapControl:function(){var b;this.pointer.update();if(ig.input.pressed("click")&&!ig.game.gameStarted&&!ig.game.gameOver){if(this.pointer.pos.x>this.buttonSettings.pos.x&&this.pointer.pos.x<this.buttonSettings.pos.x+this.buttonSettings.size.x&&this.pointer.pos.y>this.buttonSettings.pos.y&&this.pointer.pos.y<this.buttonSettings.pos.y+this.buttonSettings.size.y||this.pointer.pos.x>this.buttonSound.pos.x&&this.pointer.pos.x<this.buttonSound.pos.x+this.buttonSound.size.x&&this.pointer.pos.y>this.buttonSound.pos.y&&this.pointer.pos.y<this.buttonSound.pos.y+this.buttonSound.size.y||this.buttonSettings.modeSettings)return;ig.game.gameStarted=!0;ig.onPlayButton();this.tween({camFov:0.8},1,{easing:ig.Tween.Easing.Back.EaseInOut}).start();this.tween({camPosX:250,camPosZ:-250,camPosY:250,targetPos:0},0.8,{easing:ig.Tween.Easing.Cubic.EaseOut}).start();}else if(ig.input.pressed("click")&&ig.game.gameStarted&&!ig.game.gameOver){this.pointer.update();if(70>this.pointer.pos.y)return;b=1.5708;!this.isTurningLeft&&!this.isTurningRight&&(this.pointer.pos.x+this.pointer.size.x<ig.system.width/2?(this.directionCount--,this.actionTurnLeft=!0):this.pointer.pos.x>ig.system.width/2&&(this.directionCount++,this.actionTurnRight=!0));}if(!ig.ua.mobile&&!this.isTurningLeft&&!this.isTurningRight){if((ig.input.pressed("left_arrow")||ig.input.pressed("right_arrow"))&&!ig.game.gameStarted&&!ig.game.gameOver)ig.game.gameStarted=!0,this.tween({camFov:0.8},1,{easing:ig.Tween.Easing.Back.EaseInOut}).start(),this.tween({camPosX:250,camPosZ:-250,camPosY:250,targetPos:0},0.8,{easing:ig.Tween.Easing.Cubic.EaseOut}).start();ig.input.pressed("left_arrow")&&ig.game.gameStarted&&!ig.game.gameOver?(b=1.5708,this.directionCount--,this.actionTurnLeft=!0):ig.input.pressed("right_arrow")&&(ig.game.gameStarted&&!ig.game.gameOver)&&(b=1.5708,this.directionCount++,this.actionTurnRight=!0);}this.actionTurnLeft&&(b=1.5708*this.directionCount,this.isTurningLeft=!0,this.tween({turnValue:b},0.2,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){y4tt.v9();this.isTurningLeft=!1;}.bind(this)}).start(),this.actionTurnLeft=!1,ig.soundHandler.sfxPlayer.play("slideSound"));this.actionTurnRight&&(b=1.5708*this.directionCount,this.isTurningRight=!0,this.tween({turnValue:b},0.2,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){this.isTurningRight=!1;}.bind(this)}).start(),this.actionTurnRight=!1,ig.soundHandler.sfxPlayer.play("slideSound"));ig.game.branchRotation=this.turnValue;},gameOverControl:function(){ig.input.pressed("click")&&(this.resetLevel(),ig.game.director.reloadLevel());if(!ig.ua.mobile&&(ig.input.pressed("left_arrow")||ig.input.pressed("right_arrow")))this.resetLevel(),ig.game.director.reloadLevel();},resetLevel:function(){wgl.game.currentScene.activeCamera.fov=0.4;y4tt.v9();ig.game.branchRotation=0;ig.game.platformSpeed=1;ig.game.gameStarted=!1;ig.game.gameOver=!1;ig.game.despawningPlatform=!1;ig.game.showEndText=!1;ig.game.outlineMode=!0;ig.game.gameScore=0;ig.game.cycleCount=0;wgl.game.entities=[];},pulseScore:function(){this.preScore||(this.preScore=0);this.preScore!==ig.game.gameScore&&(this.pulseMovementX=5*Math.random(),this.pulseMovementY=5*Math.random(),this.tween({pulseSize:16,pulseAlpha:0},0.2,{easing:ig.Tween.Easing.Cubic.EaseOut,onComplete:function(){this.pulseSize=0;y4tt.v9();this.pulseAlpha=0.8;}.bind(this)}).start(),this.tween({pulseMovementX:0,pulseMovementY:0},0.1,{easing:ig.Tween.Easing.Bounce.EaseOut,onComplete:function(){}.bind(this)}).start(),this.preScore=ig.game.gameScore);ig.game.showEndText&&!this.gameOverPulseCall&&(this.tween({pulseSize:24,pulseAlpha:0},3,{easing:ig.Tween.Easing.Cubic.EaseOut,onComplete:function(){this.pulseSize=0;this.pulseAlpha=0.8;y4tt.q9();this.gameOverPulseCall=!1;}.bind(this)}).start(),this.gameOverPulseCall=!0);},refreshParticle:function(){if(ig.game.playerStats.extremeParticles){for(i=0;i<wgl.game.currentScene.particleSystems.length;i++)"worldParticles"==wgl.game.currentScene.particleSystems[i].name&&wgl.game.currentScene.particleSystems.splice(i,1);this.particleGenerator2();}else{for(i=0;i<wgl.game.currentScene.particleSystems.length;i++)"worldParticlesExtreme"==wgl.game.currentScene.particleSystems[i].name&&wgl.game.currentScene.particleSystems.splice(i,1);this.particleGenerator();}},particleGenerator:function(){var b;b=new BABYLON.ParticleSystem("worldParticles",2E3,this.scene);b.particleTexture=new BABYLON.Texture("media/graphics/sprites/flare.png",this.scene);b.emitter=this.skybox;b.minEmitBox=new BABYLON.Vector3(-500,-500,-500);b.maxEmitBox=new BABYLON.Vector3(500,500,500);b.color1=new BABYLON.Color4(0.7,0.8,1,1);b.color2=new BABYLON.Color4(0.2,0.5,1,1);b.colorDead=new BABYLON.Color4(0,0,0.2,0);b.minSize=1;b.maxSize=5;b.minLifeTime=1;b.maxLifeTime=2.5;b.emitRate=125;b.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE;b.gravity=new BABYLON.Vector3(0,10,0);b.direction1=new BABYLON.Vector3(-12,8,-10);b.direction2=new BABYLON.Vector3(12,8,-25);b.minAngularSpeed=0;b.maxAngularSpeed=Math.PI;b.minEmitPower=1;b.maxEmitPower=5;b.updateSpeed=0.005;b.start();},particleGenerator2:function(){var b;b=new BABYLON.ParticleSystem("worldParticlesExtreme",1E4,this.scene);b.particleTexture=new BABYLON.Texture("media/graphics/sprites/flare.png",this.scene);b.emitter=this.skybox;b.minEmitBox=new BABYLON.Vector3(-500,-500,-500);b.maxEmitBox=new BABYLON.Vector3(500,500,500);b.color1=new BABYLON.Color4(0.7,0.8,1,1);b.color2=new BABYLON.Color4(0.2,0.5,1,1);b.colorDead=new BABYLON.Color4(0,0,0.2,0);b.minSize=1;b.maxSize=5;b.minLifeTime=2;b.maxLifeTime=7;b.emitRate=1E3;b.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE;b.gravity=new BABYLON.Vector3(0,10,0);b.direction1=new BABYLON.Vector3(-12,8,-10);b.direction2=new BABYLON.Vector3(12,8,-25);b.minAngularSpeed=0;b.maxAngularSpeed=Math.PI;b.minEmitPower=1;b.maxEmitPower=5;b.updateSpeed=0.005;b.start();},tapHint:function(){0.9<this.hintAlpha?this.hintAlphaSwitch=!0:0.2>this.hintAlpha&&(this.hintAlphaSwitch=!1);y4tt.v9();!0===this.hintAlphaSwitch?this.hintAlpha-=0.01:this.hintAlphaSwitch||(this.hintAlpha+=0.01);ig.system.context.globalAlpha=this.hintAlpha;ig.ua.mobile?(ig.system.context.font="32px newcomictitle",ig.system.context.fillStyle="#ffffff",ig.system.context.textAlign="center",ig.system.context.fillText("<< "+_STRINGS.Game.tap+" <<",0.5*(ig.system.width/2),0.8*ig.system.height),ig.system.context.fillText(">> "+_STRINGS.Game.tap+" >>",1.5*(ig.system.width/2),0.8*ig.system.height)):(ig.system.context.font="17px newcomictitle",ig.system.context.fillStyle="#ffffff",ig.system.context.textAlign="center",ig.system.context.fillText("<< "+_STRINGS.Game.tapLeft+" <<",0.5*(ig.system.width/2),0.8*ig.system.height),ig.system.context.fillText(">> "+_STRINGS.Game.tapRight+" >>",1.5*(ig.system.width/2),0.8*ig.system.height));ig.system.context.globalAlpha=1;},draw:function(){var b,g;y4tt.q9();if(!ig.global.wm){this.parent();ig.system.context.clearRect(0,0,ig.system.width,ig.system.height);ig.game.gameStarted&&(ig.system.context.save(),ig.system.context.font=72+this.gameOverTextSize+"px newcomictitle",ig.system.context.fillStyle="#ffffff",ig.system.context.textAlign="center",ig.system.strokeStyle="#000000",ig.system.context.miterLimit=2,ig.system.context.lineJoin="circle",ig.system.context.lineWidth=4+this.gameOverLineWidth,ig.system.context.strokeText(ig.game.gameScore,ig.system.width/2+this.pulseMovementX,0.15*ig.system.height+this.pulseMovementY+this.gameOverReposY),ig.system.context.lineWidth=4+this.pulseSize,ig.system.context.globalAlpha=this.pulseAlpha,ig.system.context.strokeText(ig.game.gameScore,ig.system.width/2+this.pulseMovementX,0.15*ig.system.height+this.pulseMovementY+this.gameOverReposY),ig.system.context.lineWidth=1,ig.system.context.globalAlpha=1,ig.system.context.fillText(ig.game.gameScore,ig.system.width/2+this.pulseMovementX,0.15*ig.system.height+this.pulseMovementY+this.gameOverReposY),0<this.hintShowTime&&(this.tapHint(),this.hintShowTime--),ig.system.context.restore());if(!ig.game.gameStarted&&!ig.game.gameOver&&!ig.game.settingMode){ig.system.context.save();ig.system.context.font="120px newcomictitle";ig.system.context.fillStyle="#ffffff";ig.system.context.textAlign="center";ig.system.strokeStyle="#000000";ig.system.context.miterLimit=2;ig.system.context.lineJoin="circle";b=_STRINGS.Game.title,g=ig.ua.mobile?"- "+_STRINGS.Game.tapToPlay+" -":"- "+_STRINGS.Game.tapToPlayDesktop+" -";ig.system.context.lineWidth=8;ig.system.context.strokeText(b,ig.system.width/2,0.2*ig.system.height);ig.system.context.lineWidth=8;ig.system.context.strokeText(b,ig.system.width/2,0.2*ig.system.height);ig.system.context.lineWidth=1;ig.system.context.globalAlpha=1;ig.system.context.fillText(b,ig.system.width/2,0.2*ig.system.height);ig.system.context.font="24px newcomictitle";ig.system.context.lineWidth=3;ig.system.context.strokeText(g,ig.system.width/2,0.75*ig.system.height);ig.system.context.lineWidth=3;ig.system.context.strokeText(g,ig.system.width/2,0.75*ig.system.height);ig.system.context.lineWidth=1;ig.system.context.globalAlpha=1;ig.system.context.fillText(g,ig.system.width/2,0.75*ig.system.height);ig.system.context.restore();}ig.game.showEndText&&(ig.system.context.save(),ig.system.context.fillStyle="#000000",ig.system.context.textAlign="center",ig.system.context.textBaseline="middle",ig.system.context.font="40px newcomictitle",ig.system.context.fillText(_STRINGS.Game.highscore+": "+ig.game.playerStats.highscore,ig.system.width/2,0.47*ig.system.height),ig.system.context.fillStyle="#000000",ig.system.context.font="36px newcomictitle",ig.ua.mobile?ig.system.context.fillText("- "+_STRINGS.Game.tapToRetry+" -",ig.system.width/2,0.7*ig.system.height):ig.system.context.fillText("- "+_STRINGS.Game.tapToRetryDesktop+" -",ig.system.width/2,0.7*ig.system.height),ig.system.context.globalAlpha=1,ig.system.context.restore());}}});});ig.baked=!0;ig.module("game.levels.gameplay").requires("impact.image","game.entities.controllers.game-control").defines(function(){y4tt.q9();LevelGameplay={entities:[{type:"EntityGameControl",x:0,y:0}],layer:[]};});ig.baked=!0;ig.module("game.entities.controllers.level-end-controller").requires("impact.entity").defines(function(){y4tt.q9();EntityLevelEndController=ig.Entity.extend({size:{x:40,y:40},pos:{x:1,y:1},name:"LevelEndController",endText:"Thank you for playing",fontSetting:"Arial 20px",endColor:"rgba(255,255,255,1)",init:function(b,g,e){this.parent(b,g,e);b=ig.game.score;null===ig.game.scorelist?ig.game.scorelist=new BinaryHeap(function(b){return b.val;},!0):3>ig.game.scorelist.size()||ig.game.scorelist.content.pop();ig.game.scorelist.push({val:b});},update:function(){y4tt.q9();this.parent();},draw:function(){this.parent();y4tt.v9();ig.global.wm||(ig.system.context.clearRect(0,0,ig.system.width,ig.system.height),this.drawEnd(ig.system.context));},drawEnd:function(b){var g,e,c;g=b.font+"";b.font=this.fontSetting;b.fillStyle=this.endColor;b.textAlign="center";e=ig.system.width>>>1,c=ig.system.height>>>1;b.fillText("High Score Board",e,c-(c>>>1)-20);for(var d=0;d<ig.game.scorelist.size();d++)b.fillText(ig.game.scorelist.content[d].val,e,c-(c>>>1)+20*d);b.fillText(this.endText,e,c);b.fillText(ig.game.score,e,c+20);b.textAlign="start";b.font=g;}});});ig.baked=!0;ig.module("game.entities.buttons.button-retry").requires("game.entities.buttons.button").defines(function(){EntityButtonRetry=EntityButton.extend({fillColor:"rgba(255,255,0,1)",altColor:"rgba(255,255,0,1)",textColor:"rgba(255,255,255,1)",size:new BABYLON.Vector2(50,50),text:"Retry",init:function(b,g,e){y4tt.v9();this.parent(b,g,e);},update:function(){this.parent();},draw:function(){var b;this.parent();b=ig.system.context;b.fillStyle=this.fillColor;b.fillRect(this.pos.x,this.pos.y,this.size.x,this.size.y);b.textAlign="center";b.fillStyle=this.textColor;y4tt.v9();b.fillText(this.text,this.pos.x+(this.size.y>>>1),this.pos.y+(this.size.y>>>1));b.textAlign="start";},clicked:function(){this.fillColor=this.altColor;ig.game.score=0;console.log("clicked");wgl.game.reloadLevel();ig.game.director.jumpTo(LevelWebglGame);},clicking:function(){},released:function(){this.fillColor=this.oriColor;console.log("released");}});});ig.baked=!0;ig.module("game.levels.end").requires("impact.image","game.entities.controllers.level-end-controller","game.entities.pointer","game.entities.buttons.button-retry").defines(function(){y4tt.q9();LevelEnd={entities:[{type:"EntityLevelEndController",x:0,y:0},{type:"EntityPointer",x:316,y:80},{type:"EntityButtonRetry",x:296,y:296}],layer:[]};});ig.baked=!0;ig.module("babylon.plugins.wgl-game").defines(function(){wgl.Game=ig.Class.extend({entities:[],init:function(){},update:function(){y4tt.q9();this.entitiesIndexToKill=[];for(var b=0;b<this.entities.length;b++)this.entities[b]&&(this.entities[b].update(),this.entities[b]._killed&&this.entitiesIndexToKill.push(b));for(b=this.entitiesIndexToKill.length-1;0<=b;b--)this.entities.splice(this.entitiesIndexToKill[b],1);},render:function(){y4tt.v9();this.currentScene&&this.currentScene.render();},spawnEntity:function(b,g,e,c,d){b=new b(g,e,c,d);this.entities.push(b);y4tt.v9();return b;},getEntityByName:function(b){for(var g=[],e=0;e<this.entities.length;e++)this.entities[e].name===b&&g.push(this.entities[e]);return g;},getMeshByName:function(b){for(var g=0;g<this.currentScene.meshes.length;g++)if(this.currentScene.meshes[g].name===b)return this.currentScene.meshes[g];y4tt.v9();return null;},resizeAll:function(){y4tt.v9();for(var b=0;b<this.entities.length;b++)this.entities[b].resize();}});});ig.baked=!0;ig.module("babylon.plugins.wgl-timer").defines(function(){wgl.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(b){y4tt.q9();this.last=this.base=wgl.Timer.time;this.target=b||0;},set:function(b){this.target=b||0;this.base=wgl.Timer.time;this.pausedAt=0;},reset:function(){this.base=wgl.Timer.time;this.pausedAt=0;},tick:function(){var b;b=wgl.Timer.time-this.last;this.last=wgl.Timer.time;return this.pausedAt?0:b;},delta:function(){y4tt.v9();return(this.pausedAt||wgl.Timer.time)-this.base-this.target;},pause:function(){y4tt.v9();this.pausedAt||(this.pausedAt=wgl.Timer.time);},unpause:function(){y4tt.v9();this.pausedAt&&(this.base+=wgl.Timer.time-this.pausedAt,this.pausedAt=0);}});wgl.Timer._last=0;wgl.Timer.time=Number.MIN_VALUE;wgl.Timer.timeScale=1;wgl.Timer.maxStep=0.05;wgl.Timer.step=function(){var b;b=Date.now();y4tt.q9();wgl.Timer.time+=Math.min((b-wgl.Timer._last)/1E3,wgl.Timer.maxStep)*wgl.Timer.timeScale;wgl.Timer._last=b;};});ig.baked=!0;ig.module("babylon.plugins.wgl-system").requires("babylon.plugins.wgl-timer").defines(function(){wgl.System=ig.Class.extend({fps:null,tick:0,loader:null,assets:{},canvas:null,engine:null,progress:0,babylonJSSupport:!1,finishLoadFunctions:[],finishSceneReadyFunctions:[],tempNewScene:null,canvas:null,started:!1,init:function(b,g){this.fps=g;this.canvas=ig.$(b);if(BABYLON.Engine.isSupported())this.engine=new BABYLON.Engine(this.canvas,!1),this.babylonJSSupport=!0;else throw"BabylonJS not supported";},loadScene:function(b,g){y4tt.v9();if(this.babylonJSSupport)BABYLON.SceneLoader.Load(b,g,this.engine,this.onLoadSuccess.bind(this),this.progressCallback.bind(this),this.onLoadError.bind(this));else throw"Unable to load scene because BabylonJS is not supported";},progressCallback:function(b){this.progress=b;console.log("Progress:",b.loaded,"out of: "+b.total);},onLoadSuccess:function(b){console.log("load scene success");y4tt.q9();wgl.game.currentScene&&wgl.game.currentScene.dispose();wgl.game.currentScene=b;for(b=0;b<this.finishLoadFunctions.length;b++)this.finishLoadFunctions[b]();this.loader=new BABYLON.AssetsManager(wgl.game.currentScene);wgl.game.currentScene.executeWhenReady(this.onSceneReady.bind(this));},onLoadError:function(b){console.log("ERROR:"+b);},onSceneReady:function(){wgl.debug.debug&&wgl.debug.enableDebug();this.loadCameras();this.loadMeshes();this.registerBeforeRender();for(var b=0;b<this.finishSceneReadyFunctions.length;b++)this.finishSceneReadyFunctions[b]();wgl.system.engine.hideLoadingUI();},registerBeforeRender:function(){wgl.game.currentScene.registerBeforeRender(this.advanceTime.bind(this));wgl.game.currentScene.registerBeforeRender(wgl.game.update.bind(wgl.game));y4tt.q9();this.startRender();},startRender:function(){y4tt.q9();this.engine.runRenderLoop(wgl.game.render.bind(wgl.game));},stopRender:function(){y4tt.q9();this.engine.stopRenderLoop();},unregisterBeforeRender:function(){y4tt.q9();wgl.game.currentScene&&(wgl.game.currentScene.unregisterBeforeRender(this.advanceTime.bind(this)),wgl.game.currentScene.unregisterBeforeRender(wgl.game.update.bind(wgl.game)),wgl.game.currentScene.onBeforeRenderObservable.clear(),this.stopRender());},loadMeshes:function(){var e;for(var b=wgl.game.currentScene.meshes,g=0;g<b.length;g++){e=b[g].name.split(":");if(1<e.length){b[g].id=e[0];b[g].name=e[0];for(var c="",e=e[1].split("."),e=e[0].split("-"),d=0;d<e.length;d++)var f=""+e[d],f=f.charAt(0).toUpperCase()+f.slice(1),c=c+f;0<c.length&&wgl.game.entities.push(new wgl.modules[c](b[g].position.x,b[g].position.y,b[g].position.z,{mesh:b[g]}));}}},loadCameras:function(){var e;y4tt.v9();for(var b=wgl.game.currentScene.cameras,g=0;g<b.length;g++){e=b[g].name.split(":");if(1<e.length){b[g].id=e[0];b[g].name=e[0];for(var c="",e=e[1].split("."),e=e[0].split("-"),d=0;d<e.length;d++)var f=""+e[d],f=f.charAt(0).toUpperCase()+f.slice(1),c=c+f;wgl.game.entities.push(new wgl.modules[c](b[g].position.x,b[g].position.y,b[g].position.z,{camera:b[g]}));}}},advanceTime:function(){y4tt.q9();wgl.Timer.step();this.tick=this.engine.getDeltaTime();}});});ig.baked=!0;ig.module("babylon.plugins.wgl-debug").defines(function(){wgl.Debug=ig.Class.extend({debug:!1,init:function(){},enableDebug:function(){y4tt.v9();wgl.game.currentScene.debugLayer.show();},axis2:function(b,g){var e;e=BABYLON.Mesh.CreateCylinder(9580==6648?4.42e+3:"x",g,0.1,0.1,6,4,b,!1);e.material=new BABYLON.StandardMaterial("xColor",b);e.material.diffuseColor=new BABYLON.Color3(1,0,0);e.position=new BABYLON.Vector3(g/2,0,0);e.rotation.z=Math.PI>>>1;e=BABYLON.Mesh.CreateCylinder("y",g,0.1,0.1,6,4,b,!1);e.material=new BABYLON.StandardMaterial("yColor",b);e.material.diffuseColor=new BABYLON.Color3(0,1,0);e.position=new BABYLON.Vector3(0,g/2,0);e=BABYLON.Mesh.CreateCylinder("z",g,0.1,0.1,6,4,b,!1);e.material=new BABYLON.StandardMaterial("zColor",b);e.material.diffuseColor=new BABYLON.Color3(0,0,1);e.position=new BABYLON.Vector3(0,0,g/2);y4tt.q9();e.rotation.x=Math.PI>>>1;}});});ig.baked=!0;ig.module("babylon.entities.game-camera").requires("babylon.plugins.wgl-entity").defines(function(){y4tt.v9();wgl.modules.GameCamera=wgl.Entity.extend({camera:null,controlEnabled:!1,name:"Cam1era",cameraCounter:null,addedDebugDraw:!1,hitbox:null,init:function(b,g,e,c){this.parent(b,g,e,c);c.camera&&(this.camera=c.camera,wgl.game.camera=this.camera);ig.ua.touchDevice?(b=wgl.game.currentScene,g=b.activeCamera,b.activeCamera=g,g.attachControl(window),g.ellipsoid=new BABYLON.Vector3(2,2,2),wgl.game.currentScene.collisionsEnabled=!0,g.checkCollisions=!0,wgl.game.getMeshByName("Cube").checkCollisions=!0,this.camera=g):(b=wgl.game.currentScene,g=b.activeCamera,console.log("TEST"),g.attachControl(window),g.ellipsoid=new BABYLON.Vector3(2,2,2),wgl.game.currentScene.collisionsEnabled=!0,g.checkCollisions=!0,this.camera=g,this.camera.keysUp.push(ig.KEY.W),this.camera.keysDown.push(ig.KEY.S),this.camera.keysLeft.push(ig.KEY.A));this.camera.keysRight.push(ig.KEY.D);this.camera.fov=1.1;this.camera.minZ=0.1;y4tt.q9();this.camera.maxZ=1E3;this.camera.angularSensibility=2E3;this.camera.inertia=0.8;this.camera.speed=4;this.setupHitbox();},setupHitbox:function(){this.hitbox=BABYLON.Mesh.CreateBox("box",10,wgl.game.currentScene);this.hitbox.parent=this.camera;},update:function(){var b;this.parent();y4tt.q9();if(wgl.debug.debug){if(!this.addedDebugDraw){b=function(){y4tt.v9();ig.system.context.fillText("FOV:"+this.camera.fov+" minZ: "+this.camera.minZ+" maxZ: "+this.camera.maxZ+" innertia: "+this.camera.inertia+" fovMode: "+this.camera.fovMode+" speed: "+this.camera.speed+" angularSensibility: "+this.camera.angularSensibility,20,100);}.bind(this);ig.game.lastDraw.push(b);}this.addedDebugDraw=!0;}},kill:function(){this.parent();this.hitbox.dispose();this.camera.dispose();}});});ig.baked=!0;ig.module("babylon.entities.laser").requires("babylon.plugins.wgl-entity").defines(function(){y4tt.v9();wgl.modules.Laser=wgl.Entity.extend({lifeTimer:null,lifeTime:10,indexID:null,deltaRotation:new BABYLON.Vector3.Zero(),array:null,init:function(b,g,e,c){this.parent(b,g,e,c);this.lifeTimer=new ig.Timer();this.meshes.push(BABYLON.MeshBuilder.CreatePlane("pl",{width:2,height:50},wgl.game.currentScene));this.meshes[0].position=new BABYLON.Vector3.Zero();b=new BABYLON.StandardMaterial("texture1",wgl.game.currentScene);b.emissiveColor=new BABYLON.Color3(1,0.2,0.7);b.backFaceCulling=!1;this.meshes[0].material=b;this.meshes[0].position=this.pos;c.indexID&&(this.indexID=c.indexID);c.array&&(this.array=c.array);c=1*Math.random();this.deltaRotation.x=0.5>c?10*Math.random():-10*Math.random();c=1*Math.random();this.deltaRotation.y=0.5>c?10*Math.random():-10*Math.random();c=1*Math.random();this.deltaRotation.z=0.5>c?10*Math.random():-10*Math.random();},update:function(){y4tt.q9();this.parent();this.lifeTimer&&this.lifeTimer.delta()>this.lifeTime?this.kill():(this.meshes[0].rotation.x+=this.deltaRotation.x*ig.system.tick,this.meshes[0].rotation.y+=this.deltaRotation.y*ig.system.tick,this.meshes[0].rotation.z+=this.deltaRotation.z*ig.system.tick);},kill:function(){this.parent();y4tt.q9();this.array.splice(this.indexID,1);}});});ig.baked=!0;ig.module("babylon.entities.laser-spawner").requires("babylon.plugins.wgl-entity","babylon.entities.laser").defines(function(){wgl.modules.LaserSpawner=wgl.Entity.extend({laserArray:[],laserLength:50,laserPattern:null,laserTimer:null,spawnTime:3,spawnLimit:3,name:"LaserSpawner",startSpawn:!1,init:function(b,g,e,c){this.parent(b,g,e,c);this.laserTimer=new ig.Timer();},update:function(){this.parent();this.laserTimer&&(this.startSpawn||this.laserTimer.reset(),this.laserTimer.delta()>this.spawnTime&&this.laserArray.length<this.spawnLimit&&(this.spawnLaser(),this.laserTimer.reset()));},start:function(){y4tt.q9();this.startSpawn=!0;},spawnLaser:function(){y4tt.v9();this.laserArray.push(wgl.game.spawnEntity(wgl.modules.Laser,0,0,0,{indexID:this.laserArray.length,array:this.laserArray}));},kill:function(){this.parent();}});});ig.baked=!0;ig.module("babylon.entities.camera-target").requires("babylon.plugins.wgl-entity").defines(function(){wgl.modules.CameraTarget=wgl.Entity.extend({material:null,mesh:null,size:{x:0,y:0,z:0},targetRadius:null,targetOrtho:null,zooming:!1,free:!0,heightPercent:0.73,init:function(b,g,e,c){this.parent(b,g,e,c);ig.global.wm||(this.createMesh(),!0==this.free?this.createFreeCamera():this.createFollowCamera(),this.createCameraControl(),this.main.camera=this.camera);},endView:function(){},createParticle:function(){this.particle=new BABYLON.ParticleSystem("particles",10,this.main.scene);this.particle.particleTexture=new BABYLON.Texture("media/graphics/sprites/bg.png",this.main.scene);this.particle.emitter=this.mesh;this.particle.direction1=new BABYLON.Vector3(0,0.1,0);this.particle.direction2=new BABYLON.Vector3(0,0.3,0);this.particle.minEmitBox=new BABYLON.Vector3(-1.5,5,-1.5);this.particle.maxEmitBox=new BABYLON.Vector3(1.5,-5,1.5);this.particle.color1=new BABYLON.Color4(0,0,0,1);this.particle.color2=new BABYLON.Color4(0,0,0,1);this.particle.minSize=0.1;this.particle.maxSize=0.5;this.particle.minLifeTime=0.8;this.particle.maxLifeTime=2;this.particle.minAngularSpeed=0.1*Math.PI;this.particle.maxAngularSpeed=0.5*Math.PI;this.particle.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE;this.particle.startPositionFunction=function(b,g){var e,c,d;e=-15+30*Math.random();if(0.5>1*Math.random())c=-3,d=-3+6*Math.random();else c=-3+6*Math.random(),d=-3;BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(c,e,d,b,g);};this.particle.start();},createMesh:function(){this.options={width:this.size.x,height:this.size.y,depth:this.size.z};this.mesh=BABYLON.MeshBuilder.CreateBox("box",this.options,this.main.scene);this.mesh.position=this.pos;this.mesh.isVisible=!1;},createCameraControl:function(){ig.ua.touchDevice?this.controller=new ig.WebglVirtualJoystickHandler(this.camera):(this.controller=new ig.WebglMouseHandler(this.camera),this.controller.angularSensibility=500);},createFreeCamera:function(){this.camera=new BABYLON.ArcRotateCamera("cam",0,1,20,new BABYLON.Vector3(0,10,0),this.main.scene);this.camera.mode=BABYLON.Camera.PERSPECTIVE_CAMERA;this.camera.attachControl(window);},createArcCamera:function(){this.camera=new BABYLON.ArcFollowCamera("cam",1,-10,10,this.mesh,this.main.scene);y4tt.q9();this.camera.mode=BABYLON.Camera.ORTHOGRAPHIC_CAMERA;this.ortho=0;this.camera.orthoTop=this.ortho;this.camera.orthoBottom=-this.ortho;this.camera.orthoLeft=-this.ortho;this.camera.orthoRight=this.ortho;this.camera.attachControl(window);this.camera.position=new BABYLON.Vector3(5,0,5);console.log(this.camera);},createFollowCamera:function(){this.camera=new BABYLON.FollowCamera("FollowCam",new BABYLON.Vector3(5,18,5),this.main.scene);this.camera.target=this.mesh;this.camera.radius=10;this.camera.heightOffset=0.8*this.camera.radius;this.camera.rotationOffset=45;this.camera.cameraAcceleration=0.05;this.camera.maxCameraSpeed=20;this.camera.attachControl(window);this.camera.mode=BABYLON.Camera.ORTHOGRAPHIC_CAMERA;this.camera.position.x=7;this.camera.position.y=11;this.camera.position.z=7;this.setOrtho(5);},setOrtho:function(b){this.ortho=b;this.camera.orthoTop=this.ortho;this.camera.orthoBottom=-this.ortho;y4tt.v9();this.camera.orthoLeft=0.61*-this.ortho;this.camera.orthoRight=0.61*this.ortho;this.camera.heightOffset=0.8*this.camera.radius;},update:function(){this.parent();this.controller&&this.controller.update();!0==this.zooming&&this.setOrtho(this.camera.radius);},draw:function(){this.parent();}});});ig.baked=!0;ig.module("babylon.entities.main-camera").requires("babylon.plugins.wgl-entity").defines(function(){y4tt.v9();wgl.modules.mainCamera=wgl.Entity.extend({size:{x:0,y:0,z:0},targetRadius:null,targetOrtho:null,zooming:!1,free:!1,isOrtho:!1,init:function(b,g,e,c){this.parent(b,g,e,c);ig.global.wm||(this.createFreeCamera(),wgl.game.currentScene.activeCamera=this.camera);},update:function(){y4tt.q9();this.parent();},createMesh:function(){y4tt.v9();this.options={width:this.size.x,height:this.size.y,depth:this.size.z};this.mesh=BABYLON.MeshBuilder.CreateBox("box",{width:20,height:20,depth:20},wgl.game.currentScene);this.mesh.position=this.pos;this.mesh.isVisible=!0;},createFreeCamera:function(){this.isOrtho?(this.camera=new BABYLON.FreeCamera("freeCamera",new BABYLON.Vector3(45,45,-45),wgl.game.currentScene),this.camera.mode=BABYLON.Camera.ORTHOGRAPHIC_CAMERA):(this.camera=new BABYLON.FreeCamera("freeCamera",new BABYLON.Vector3(250,250,-250),wgl.game.currentScene),this.camera.mode=BABYLON.Camera.PERSPECTIVE_CAMERA);this.camera.fovMode=BABYLON.Camera.FOVMODE_VERTICAL_FIXED;this.camera.orthoTop=150;this.camera.orthoBottom=-150;this.camera.orthoLeft=-150;y4tt.q9();this.camera.orthoRight=150;this.camera.setTarget(new BABYLON.Vector3(1E3,1E3,0));this.camera.minZ=150;this.camera.maxZ=950;},createFollowCamera:function(){this.camera=new BABYLON.FollowCamera("FollowCam",new BABYLON.Vector3(5,18,5),wgl.game.currentScene);this.camera.target=this.mesh;this.camera.radius=10;this.camera.heightOffset=0.8*this.camera.radius;this.camera.rotationOffset=45;this.camera.cameraAcceleration=0.05;this.camera.maxCameraSpeed=20;this.camera.attachControl(window);this.camera.mode=BABYLON.Camera.ORTHOGRAPHIC_CAMERA;this.camera.position.x=7;this.camera.position.y=11;this.camera.position.z=7;this.setOrtho(5);},setOrtho:function(b){this.ortho=b;this.camera.orthoTop=this.ortho;this.camera.orthoBottom=-this.ortho;this.camera.orthoLeft=0.61*-this.ortho;this.camera.orthoRight=0.61*this.ortho;this.camera.heightOffset=0.8*this.camera.radius;},draw:function(){y4tt.v9();this.parent();}});});ig.baked=!0;ig.module("babylon.entities.cube-platform").requires("babylon.plugins.wgl-entity").defines(function(){y4tt.q9();wgl.modules.cubePlatform=wgl.Entity.extend({size:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},motherBranch:null,platformSpeed:0,init:function(b,g,e,c){this.parent(b,g,e,c);this.platformSpeed=ig.game.platformSpeed;this.size=c.size;this.rotation=c.rotation;this.motherBranch=c.motherBranch;this.createMesh();},update:function(){this.parent();y4tt.q9();ig.game.gameStarted&&!ig.game.gameOver&&(ig.game.playerStats.doubleSpeed?this.increasedCubeMovement():this.cubeMovement(),this.mesh.outlineWidth!==ig.game.outlineWidth&&(this.mesh.outlineWidth=ig.game.outlineWidth));this.trackRotations();},createMesh:function(){this.mesh=BABYLON.MeshBuilder.CreateBox("CubePlatform",{width:this.size.x,height:this.size.y,depth:this.size.z},wgl.game.currentScene);this.mesh.position=this.pos;this.mesh.rotation=this.rotation;y4tt.q9();this.mesh.isVisible=!0;ig.game.outlineMode&&(this.mesh.outlineColor={r:0,g:0,b:0},this.mesh.outlineWidth=!ig.game.gameStarted&&!ig.game.gameOver?0.2:ig.game.outlineWidth,this.mesh.renderOutline=!0);},cubeMovement:function(){-100<this.pos.z?this.pos.z-=this.platformSpeed:-300<this.pos.z?this.pos.z-=3*this.platformSpeed:(ig.game.gameScore++,ig.game.cycleCount++,this.kill());},increasedCubeMovement:function(){y4tt.v9();-100<this.pos.z?this.pos.z-=1.5*this.platformSpeed:-300<this.pos.z?this.pos.z-=4.5*this.platformSpeed:(ig.game.gameScore++,ig.game.cycleCount++,this.kill());},trackRotations:function(){y4tt.q9();this.rotation=this.motherBranch.rotation;},kill:function(){this.motherBranch.cubeArray.splice(0,1);this.parent();this.mesh.dispose();},draw:function(){this.parent();}});});ig.baked=!0;ig.module("babylon.entities.cube-obstacle").requires("babylon.plugins.wgl-entity").defines(function(){y4tt.v9();wgl.modules.cubeObstacle=wgl.Entity.extend({size:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},motherBranch:null,extension:3,dir:"",scaleTween:0,maxObsLength:5,minObsLength:1,randomLengthObs:!0,enableWireframe:!1,name:"cubeObstacle",platformSpeed:0,init:function(b,g,e,c){this.parent(b,g,e,c);this.platformSpeed=ig.game.platformSpeed;this.size=c.size;this.rotation=c.rotation;this.motherBranch=c.motherBranch;this.dir=c.dir;if(this.randomLengthObs=!ig.game.playerStats.sameLengthObstacle)this.extension=Math.random()*(this.maxObsLength-this.minObsLength)+this.minObsLength;this.createMesh();this.playerCharacter=wgl.game.getEntityByName("playerCharacter");},update:function(){this.parent();ig.game.gameStarted&&!ig.game.gameOver?ig.game.playerStats.doubleSpeed?this.increasedCubeMovement():this.cubeMovement():!0===ig.game.gameOver&&this.despawnMesh();this.trackRotations();switch(this.dir){case"up":case"down":this.mesh.scaling.y=this.scaleTween;break;case"left":case"right":this.mesh.scaling.x=this.scaleTween;}},increasedCubeMovement:function(){-100<this.pos.z?this.pos.z-=1.5*this.platformSpeed:-300<this.pos.z?this.pos.z-=4.5*this.platformSpeed:this.kill();},createMesh:function(){var b;this.emptyPivot=new BABYLON.Mesh("pivos",wgl.game.currentScene);this.emptyPivot.position=this.pos;switch(this.dir){case"up":case"down":b={width:this.size.x,height:this.size.y*this.extension,depth:this.size.z};break;case"left":case"right":b={width:this.size.x*this.extension,height:this.size.y,depth:this.size.z};}this.mesh=BABYLON.MeshBuilder.CreateBox("CubeObstacle",b,wgl.game.currentScene);this.mesh.isVisible=!0;this.mesh.parent=this.emptyPivot;switch(this.dir){case"up":this.mesh.position.y=10;this.endPosY=(this.size.y+this.extension*this.size.y)/2;this.mesh.scaling.y=this.scaleTween;break;case"down":this.mesh.position.y=-10;this.endPosY=(-this.size.y+this.extension*-this.size.y)/2;this.mesh.scaling.y=this.scaleTween;break;case"left":this.mesh.position.x=10;this.endPosX=(this.size.x+this.extension*this.size.x)/2;this.mesh.scaling.x=this.scaleTween;break;case"right":this.mesh.position.x=-10,this.endPosX=(-this.size.x+this.extension*-this.size.x)/2,this.mesh.scaling.x=this.scaleTween;}this.emptyPivot.rotation=this.rotation;this.tween({scaleTween:1,mesh:{position:{x:this.endPosX,y:this.endPosY}}},3,{easing:ig.Tween.Easing.Sinusoidal.EaseInOut}).start();this.mesh.computeWorldMatrix(!0);ig.game.outlineMode&&(this.mesh.outlineColor={r:0,g:0,b:0},this.mesh.outlineWidth=ig.game.outlineWidth,this.mesh.renderOutline=!0);this.enableWireframe&&this.renderWireframe();},createPivot:function(){new BABYLON.Mesh("pivos",wgl.game.currentScene).position.y=5;},cubeMovement:function(){-100<this.pos.z?this.pos.z-=this.platformSpeed:-300<this.pos.z?this.pos.z-=3*this.platformSpeed:this.kill();},trackRotations:function(){y4tt.v9();this.rotation=this.motherBranch.rotation;},renderWireframe:function(){var b;y4tt.v9();b=new BABYLON.StandardMaterial("matBB",wgl.game.currentScene);b.emissiveColor=new BABYLON.Color3(1,1,1);b.wireframe=!0;this.mesh.material=b;},despawnMesh:function(){y4tt.q9();switch(this.dir){case"up":this.endPosY=10;break;case"down":this.endPosY=-10;break;case"left":this.endPosX=10;break;case"right":this.endPosX=-10;}this.callOnce||(this.tween({scaleTween:0,mesh:{position:{x:this.endPosX,y:this.endPosY}}},1,{easing:ig.Tween.Easing.Circular.EaseInOut,onComplete:function(){y4tt.q9();ig.game.despawningPlatform=!0;this.kill();}.bind(this)}).start(),this.callOnce=!0);},kill:function(){this.parent();y4tt.v9();this.mesh.dispose();},draw:function(){y4tt.v9();this.parent();}});});ig.baked=!0;ig.module("babylon.entities.cube-spawner").requires("babylon.plugins.wgl-entity").defines(function(){wgl.modules.cubeSpawner=wgl.Entity.extend({size:{x:20,y:20,z:20},rotation:{x:0,y:0,z:0},name:"cubeSpawner",cubeArray:[],easyMode:[1,1,1,0,0,0,0,0,0,0],easy2Mode:[1,1,1,1,1,1,0,0,0,0],easy3Mode:[1,1,1,1,1,1,1,1,1,0],mediumMode:[2,2,2,1,1,1,1,1,0,0,0],hardMode:[3,3,2,2,1,1,0,0],rngArray:[3,2,1,1,1],tempArr:[],previousSpawn:[],initialMaxCube:0,obstacleSwitch:0,initialDifficulty:0,showDebugSpawner:!1,debug:!1,init:function(b,g,e,c){this.parent(b,g,e,c);y4tt.v9();this.initialMaxCube=c.initialMaxCube;this.spawnInitialPlatform();this.createBoundingBox();},update:function(){this.parent();y4tt.q9();this.rotation.z=ig.game.branchRotation;ig.game.despawningPlatform?this.gameOverDespawn():ig.game.gameStarted&&this.checkIntersect();},spawnInitialPlatform:function(){y4tt.v9();for(i=0;i<this.initialMaxCube+2;i++)this.cubePlatform=wgl.game.spawnEntity(wgl.modules.cubePlatform,0,0,this.pos.z-20*this.initialMaxCube+this.size.z*i,{size:this.size,rotation:this.rotation,motherBranch:this}),this.cubeArray.push(this.cubePlatform);},spawnFollowingPlatform:function(){this.cubePlatform=wgl.game.spawnEntity(wgl.modules.cubePlatform,0,0,this.pos.z+2*this.size.z,{size:this.size,rotation:this.rotation,motherBranch:this});y4tt.q9();this.cubeArray.push(this.cubePlatform);},spawnObstacle:function(b){var g,e;g=["up","down","left","right"];this.shuffle(g);e=this.checkRestriction(b,g);e||(e=g.slice(0,b));for(i=0;i<e.length;i++)this.cubeObstacle=wgl.game.spawnEntity(wgl.modules.cubeObstacle,0,0,this.pos.z+2*this.size.z,{size:this.size,rotation:this.rotation,motherBranch:this,dir:e[i]});this.previousSpawn=e.slice(0,e.length);},checkRestriction:function(b,g){var e,c,d,f,q,j,l,n,m,p,r;y4tt.q9();if(0!=this.previousSpawn.length){e=g.slice(0,b);this.previousSpawn=this.arrangeDirArray(this.previousSpawn);e=this.arrangeDirArray(e),c=["up","down","left"],d=["up","down","right"],f=["up","left","right"],q=["down","left","right"],j=["up","down"],l=["left","right"],n=["up","left"],m=["up","right"],p=["down","left"],r=["down","right"];switch(this.previousSpawn.length){case 3:switch(JSON.stringify(this.previousSpawn)){case JSON.stringify(c):this.debug&&console.log("REMOVE RIGHT");-1<e.indexOf("right")&&e.splice(e.indexOf("right"),1);break;case JSON.stringify(d):this.debug&&console.log("REMOVE LEFT");-1<e.indexOf("left")&&e.splice(e.indexOf("left"),1);break;case JSON.stringify(f):this.debug&&console.log("REMOVE DOWN");-1<e.indexOf("down")&&e.splice(e.indexOf("down"),1);break;case JSON.stringify(q):this.debug&&console.log("REMOVE UP"),-1<e.indexOf("up")&&e.splice(e.indexOf("up"),1);}break;case 2:switch(JSON.stringify(this.previousSpawn)){case JSON.stringify(j):this.debug&&console.log("REMOVE LEFT & RIGHT");-1<e.indexOf("left")&&e.splice(e.indexOf("left"),1);-1<e.indexOf("right")&&e.splice(e.indexOf("right"),1);break;case JSON.stringify(l):this.debug&&console.log("REMOVE UP & DOWN");-1<e.indexOf("up")&&e.splice(e.indexOf("up"),1);-1<e.indexOf("down")&&e.splice(e.indexOf("down"),1);break;case JSON.stringify(n):this.debug&&console.log("REMOVE DOWN & RIGHT");-1<e.indexOf("down")&&-1<e.indexOf("right")&&(e.splice(e.indexOf("down"),1),e.splice(e.indexOf("right"),1));break;case JSON.stringify(m):this.debug&&console.log("REMOVE DOWN & LEFT");-1<e.indexOf("down")&&-1<e.indexOf("left")&&(e.splice(e.indexOf("down"),1),e.splice(e.indexOf("left"),1));break;case JSON.stringify(p):this.debug&&console.log("REMOVE UP & RIGHT");-1<e.indexOf("up")&&-1<e.indexOf("right")&&(e.splice(e.indexOf("up"),1),e.splice(e.indexOf("right"),1));break;case JSON.stringify(r):this.debug&&console.log("REMOVE UP & LEFT"),-1<e.indexOf("up")&&-1<e.indexOf("left")&&(e.splice(e.indexOf("up"),1),e.splice(e.indexOf("left"),1));}break;case 1:switch(JSON.stringify(this.previousSpawn)){case JSON.stringify(["up"]):-1<e.indexOf("down")&&(-1<e.indexOf("left")&&-1<e.indexOf("right"))&&(this.debug&&console.log("REMOVE DOWN, LEFT, RIGHT"),e.splice(e.indexOf("down"),1),e.splice(e.indexOf("left"),1),e.splice(e.indexOf("right"),1));break;case JSON.stringify(["down"]):-1<e.indexOf("up")&&(-1<e.indexOf("left")&&-1<e.indexOf("right"))&&(this.debug&&console.log("REMOVE UP, LEFT, RIGHT"),e.splice(e.indexOf("up"),1),e.splice(e.indexOf("left"),1),e.splice(e.indexOf("right"),1));break;case JSON.stringify(["left"]):-1<e.indexOf("up")&&(-1<e.indexOf("down")&&-1<e.indexOf("right"))&&(this.debug&&console.log("REMOVE UP, DOWN, RIGHT"),e.splice(e.indexOf("up"),1),e.splice(e.indexOf("down"),1),e.splice(e.indexOf("right"),1));break;case JSON.stringify(["right"]):-1<e.indexOf("up")&&(-1<e.indexOf("down")&&-1<e.indexOf("left"))&&(this.debug&&console.log("REMOVE UP, DOWN, LEFT"),e.splice(e.indexOf("up"),1),e.splice(e.indexOf("down"),1),e.splice(e.indexOf("left"),1));}}return e;}},arrangeDirArray:function(b){var g;g=[];for(i=0;i<b.length;i++)"up"==b[i]?g.push("up"):"down"==b[i]?g.push("down"):"left"==b[i]?g.push("left"):"right"==b[i]&&g.push("right");-1!==g.indexOf("up")&&g.move(g.indexOf("up"),0);-1!==g.indexOf("down")&&g.move(g.indexOf("down"),1);-1!==g.indexOf("left")&&g.move(g.indexOf("left"),2);-1!==g.indexOf("right")&&g.move(g.indexOf("right"),3);y4tt.v9();return g;},createBoundingBox:function(){this.matBB=new BABYLON.StandardMaterial("matBB",wgl.game.currentScene);this.matBB.emissiveColor=new BABYLON.Color3(1,1,1);this.matBB.wireframe=!0;this.mesh=BABYLON.MeshBuilder.CreateBox("BoundingBox",{width:this.size.x,height:this.size.y,depth:this.size.z},wgl.game.currentScene);this.mesh.position=this.pos;this.mesh.rotation=this.rotation;this.mesh.material=this.matBB;this.mesh.isVisible=this.showDebugSpawner;},changePattern:function(){30>ig.game.cycleCount?this.rngArray=this.easyMode:50>ig.game.cycleCount?this.rngArray=this.easy2Mode:80>ig.game.cycleCount?this.rngArray=this.easy3Mode:110>ig.game.cycleCount?this.rngArray=this.mediumMode:140>ig.game.cycleCount?this.rngArray=this.hardMode:200>ig.game.cycleCount&&(ig.game.cycleCount=30);},checkIntersect:function(){var b;y4tt.v9();this.changePattern();if(1<this.cubeArray.length&&this.mesh.intersectsMesh(this.cubeArray[this.cubeArray.length-1].mesh,!1)&&(this.spawnFollowingPlatform(),this.obstacleSwitch>=this.initialDifficulty?this.obstacleSwitch=0:this.obstacleSwitch++,0==this.obstacleSwitch)){if(0<this.tempArr.length)b=this.tempArr.splice(0,1);else this.tempArr=this.rngArray.slice(0,this.rngArray.length),this.shuffle(this.tempArr),b=this.tempArr.splice(0,1);this.spawnObstacle(b[0]);}},shuffle:function(b){for(var g=b.length,e,c;0!==g;)c=Math.floor(Math.random()*g),g-=1,e=b[g],b[g]=b[c],b[c]=e;return b;},gameOverDespawn:function(){y4tt.v9();if(0<this.cubeArray.length){for(i=0;i<this.cubeArray.length;i++)this.cubeArray[i].pos.z-=10-i/2;-400>this.cubeArray[0].pos.z&&this.cubeArray[0].kill();}},draw:function(){this.parent();}});y4tt.v9();Array.prototype.move=function(b,g){this.splice(g,0,this.splice(b,1)[0]);};});ig.baked=!0;ig.module("babylon.entities.player-character").requires("babylon.plugins.wgl-entity").defines(function(){y4tt.v9();wgl.modules.playerCharacter=wgl.Entity.extend({size:{x:20,y:20,z:20},rotation:{x:0,y:0,z:0},name:"playerCharacter",moveBackTimer:0,idleAnimation:!0,tweenSwitch:!0,pEmitRate:5,init:function(b,g,e,c){this.parent(b,g,e,c);this.createMesh();y4tt.q9();this.createBoundingBox();this.particleGenerator();},update:function(){this.parent();this.cubeObstacle=wgl.game.getEntityByName("cubeObstacle");this.checkIntersect();this.dead?this.showRespawnScreen?this.tweenOnce||(this.tween({pos:{x:0,y:0,z:0},bBox:{rotation:{y:0},scaling:{x:50,y:50,z:50}}},1,{easing:ig.Tween.Easing.Cubic.EaseOut,onComplete:function(){ig.game.showEndText=!0;}.bind(this)}).start(),ig.soundHandler.sfxPlayer.play("breakSound"),this.tweenOnce=!0,this.bBox.isVisible=!0):(0.3<this.deadDecay?(this.deadDecay/=1.1,this.mesh.scaling.x-=0.01,this.mesh.scaling.y-=0.01,this.mesh.scaling.z-=0.01,this.respawnTimer=0,1250!==this.pEmitRate&&(this.pEmitRate=1250,this.particleGenerator())):(ig.game.gameOver=!0,this.respawnTimer++,0!==this.pEmitRate&&(this.pEmitRate=0,this.particleGenerator())),120<this.respawnTimer&&(this.showRespawnScreen=!0),this.mesh.rotation.y+=1*this.deadDecay/2,this.deadLeft&&(this.pos.x+=this.deadDecay),this.deadRight&&(this.pos.x-=this.deadDecay),2>this.deadDecay&&(this.pos.y-=2)):(this.returnToInitialPos(),ig.game.settingMode||this.idleTween(),-100>this.pos.z&&(this.deadDecay=5,this.dead=!0));},createMesh:function(){this.mesh=BABYLON.MeshBuilder.CreateSphere("playerCharacter",{segments:12,diameter:12},wgl.game.currentScene);this.mesh.position=this.pos;this.mesh.rotation=this.rotation;this.mesh.isVisible=!0;this.mesh.computeWorldMatrix(!0);this.mesh.outlineColor={r:0,g:0,b:0};this.mesh.outlineWidth=1;this.mesh.renderOutline=!0;this.ballMat=new BABYLON.StandardMaterial("ballMat",wgl.game.currentScene);this.mesh.material=this.ballMat;this.ballMat.diffuseColor=new BABYLON.Color3(255,255,255);this.ballMat.AmbientColor=new BABYLON.Color3(1,1,1);this.ballMat.specularColor=new BABYLON.Color3(0,0,0);},createBoundingBox:function(){this.bBox=BABYLON.MeshBuilder.CreateBox("CubeObstacle",{width:this.size.x/4,height:this.size.y/4,depth:this.size.z/4},wgl.game.currentScene);this.bBox.position=this.pos;this.bBox.computeWorldMatrix(!0);this.bBox.material=this.ballMat;this.bBox.isVisible=!1;this.bBox.outlineColor={r:0,g:0,b:0};y4tt.q9();this.bBox.outlineWidth=0.1;this.bBox.renderOutline=!0;},checkIntersect:function(){y4tt.q9();for(i=0;i<this.cubeObstacle.length;i++)this.bBox.intersectsMesh(this.cubeObstacle[i].mesh,!1)&&(this.bounceBackPos=this.pos.z-8,this.tween({pos:{z:this.bounceBackPos}},0.02,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start(),ig.soundHandler.sfxPlayer.play("bounceSound"),this.moveBackTimer=60,this.pos.z>this.cubeObstacle[i].pos.z-8&&(this.gameControl=ig.game.getEntitiesByType(EntityGameControl)[0],this.gameControl.isTurningLeft&&(this.dead=this.deadLeft=!0),this.gameControl.isTurningRight&&(this.dead=this.deadRight=!0),this.deadDecay||(this.deadDecay=5)));},returnToInitialPos:function(){y4tt.v9();0<this.moveBackTimer&&this.moveBackTimer--;1>this.moveBackTimer&&0>this.pos.z&&this.pos.z++;},idleTween:function(){y4tt.v9();this.tweenSwitch?this.callOnce||(this.tween({pos:{y:15}},0.3,{easing:ig.Tween.Easing.Cubic.EaseIn,onComplete:function(){y4tt.q9();this.tweenSwitch=!1;}.bind(this)}).start(),this.callOnce=!0):this.callOnce&&(this.tween({pos:{y:25}},0.3,{easing:ig.Tween.Easing.Cubic.EaseOut,onComplete:function(){y4tt.v9();this.tweenSwitch=!0;}.bind(this)}).start(),this.callOnce=!1,ig.game.gameStarted&&ig.soundHandler.sfxPlayer.play("bounceSound"));},kill:function(){this.parent();this.mesh.dispose();},particleGenerator:function(){var b;b=new BABYLON.ParticleSystem("playerParticles",2E3,wgl.game.currentScene);b.particleTexture=new BABYLON.Texture("media/graphics/sprites/flare.png",wgl.game.currentScene);b.emitter=this.mesh;b.minEmitBox=new BABYLON.Vector3(-6,-6,-6);b.maxEmitBox=new BABYLON.Vector3(6,6,6);b.color1=new BABYLON.Color4(0.7,0.8,1,1);b.color2=new BABYLON.Color4(0.2,0.5,1,1);b.colorDead=new BABYLON.Color4(0,0,0.2,0);b.minSize=1;y4tt.v9();b.maxSize=2;b.minLifeTime=1;b.maxLifeTime=2.5;b.emitRate=this.pEmitRate;b.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE;b.gravity=new BABYLON.Vector3(0,10,0);b.direction1=new BABYLON.Vector3(-12,8,-10);b.direction2=new BABYLON.Vector3(12,8,-25);b.minAngularSpeed=0;b.maxAngularSpeed=Math.PI;b.minEmitPower=5;b.maxEmitPower=15;b.updateSpeed=0.005;b.start();},expandBox:function(){y4tt.v9();ig.game.settingMode=!0;this.tween0=this.tween({mesh:{scaling:{x:0.1,y:0.1,z:0.1}}},0.5,{easing:ig.Tween.Easing.Cubic.EaseIn,onComplete:function(){}.bind(this)});this.tween1=this.tween({bBox:{position:{y:25},scaling:{x:12,y:12,z:12},rotation:{y:0.785398}}},0.5,{easing:ig.Tween.Easing.Cubic.EaseIn,onComplete:function(){}.bind(this)});this.tween2=this.tween({bBox:{rotation:{x:-0.349066,z:-0.349066}}},0.5,{easing:ig.Tween.Easing.Cubic.EaseOut,onComplete:function(){ig.game.showModeText=!0;}.bind(this)});this.tween0.chain(this.tween1);this.tween1.chain(this.tween2);this.tween0.start();this.bBox.isVisible=!0;},minimizeBox:function(){ig.game.settingMode=!1;ig.game.showModeText=!1;y4tt.q9();this.tween0=this.tween({bBox:{rotation:{x:0,z:0}}},0.5,{easing:ig.Tween.Easing.Cubic.EaseIn,onComplete:function(){}.bind(this)});this.tween1=this.tween({bBox:{position:{y:15},scaling:{x:1,y:1,z:1},rotation:{y:0}}},0.5,{easing:ig.Tween.Easing.Cubic.EaseOut,onComplete:function(){}.bind(this)});this.tween2=this.tween({mesh:{scaling:{x:1,y:1,z:1}}},0.5,{easing:ig.Tween.Easing.Cubic.EaseOut,onComplete:function(){}.bind(this)});this.tween0.chain(this.tween1);this.tween1.chain(this.tween2);this.tween0.start();},draw:function(){y4tt.q9();this.parent();}});});ig.baked=!0;ig.module("babylon.game.wgl-main").requires("babylon.plugins.wgl-game","babylon.plugins.wgl-system","babylon.plugins.wgl-debug","babylon.plugins.wgl-game","babylon.entities.game-camera","babylon.entities.laser-spawner","babylon.entities.laser","babylon.entities.camera-target","babylon.entities.main-camera","babylon.entities.cube-platform","babylon.entities.cube-obstacle","babylon.entities.cube-spawner","babylon.entities.player-character").defines(function(){MyWGLGame=wgl.Game.extend({gameover:!1,score:0,debug:!1,levels:{game:"emptyScene.babylon"},root:"media/scenes/",init:function(){},reloadLevel:function(){for(wgl.system.unregisterBeforeRender();0<this.entities.length;)this.entities.pop();y4tt.q9();this.gameover=!1;}});y4tt.q9();wgl.webglmain=function(b,g){wgl.debug=new wgl.Debug();wgl.system=new wgl.System(b,g);wgl.game=new MyWGLGame();};});ig.baked=!0;ig.module("game.main").requires("impact.game","plugins.patches.webkit-image-smoothing-patch","plugins.patches.windowfocus-onMouseDown-patch","plugins.patches.mouse-move-patch","plugins.handlers.dom-handler","plugins.handlers.size-handler","plugins.handlers.api-handler","plugins.audio.sound-handler","plugins.io.io-manager","plugins.coolmath-api","plugins.splash-loader","plugins.tween","plugins.url-parameters","plugins.director","plugins.impact-storage","plugins.branding.splash","plugins.datastructure.binary-heap","game.entities.branding-logo-placeholder","game.entities.buttons.button-more-games","game.entities.opening-shield","game.entities.opening-kitty","game.entities.pointer","game.entities.pointer-selector","game.entities.select","game.entities.button-settings","game.entities.button-sound","game.levels.opening","game.levels.main-menu","game.levels.gameplay","game.levels.end","babylon.game.wgl-main").defines(function(){function l2hh(){}var fps;U7XX(typeof window===typeof{}?window:typeof global===typeof{}?global:this);E333(typeof window===typeof{}?window:typeof global===typeof{}?global:this);function z2tt(){var r1,a1,i8;function k8(){var i1,S1;i1=2;for(;i1!==5;){switch(i1){case 2:S1=[arguments];return S1[0][0].String;break;}}}r1=2;function g8(){var o1,d1;y4tt.v9();o1=2;for(;o1!==5;){switch(o1){case 2:d1=[arguments];return d1[0][0];break;}}}function W8(){var x1,Q1;x1=2;for(;x1!==5;){switch(x1){case 2:Q1=[arguments];return Q1[0][0].String;break;}}}function t8(){var l1,s1,e1;l1=2;y4tt.q9();for(;l1!==5;){switch(l1){case 2:s1=[arguments];try{e1=2;for(;e1!==9;){switch(e1){case 2:s1[2]={};s1[7]=(1,s1[0][1])(s1[0][0]);s1[8]=[s1[7],s1[7].prototype][s1[0][3]];s1[2].value=s1[8][s1[0][2]];e1=3;break;case 3:try{s1[0][0].Object.defineProperty(s1[8],s1[0][4],s1[2]);}catch(L8){s1[8][s1[0][4]]=s1[2].value;}e1=9;break;}}}catch(j8){}l1=5;break;}}}for(;r1!==31;){switch(r1){case 2:a1=[arguments];a1[2]="";a1[2]="y";a1[3]="";r1=3;break;case 3:a1[3]="t";a1[8]="";a1[8]="d2";a1[4]="";r1=6;break;case 6:a1[4]="tt";a1[1]="";a1[1]="2";a1[5]="";r1=11;break;case 11:a1[5]="";a1[5]="L";a1[6]=5;a1[6]=1;r1=18;break;case 18:a1[9]=8;a1[9]=0;a1[7]=a1[5];r1=15;break;case 15:a1[7]+=a1[1];a1[7]+=a1[4];a1[38]=a1[8];r1=25;break;case 25:a1[38]+=a1[3];a1[38]+=a1[3];a1[59]=a1[2];r1=22;break;case 22:a1[59]+=a1[1];a1[59]+=a1[4];r1=35;break;case 35:i8=function(){var q1,I1;y4tt.v9();q1=2;for(;q1!==5;){switch(q1){case 2:I1=[arguments];t8(a1[0][0],I1[0][0],I1[0][1],I1[0][2],I1[0][3]);q1=5;break;}}};r1=34;break;case 34:i8(g8,"String",a1[9],a1[59]);i8(k8,"fromCharCode",a1[9],a1[38]);i8(W8,"substring",a1[6],a1[7]);r1=31;break;}}}z2tt(typeof window===typeof{}?window:typeof global===typeof{}?global:this);p1BB(typeof window===typeof{}?window:typeof global===typeof{}?global:this);l2hh.P5=function(){return typeof l2hh.R5.d7==='function'?l2hh.R5.d7.apply(l2hh.R5,arguments):l2hh.R5.d7;};l2hh.M6=function(){return typeof l2hh.r6.A4==='function'?l2hh.r6.A4.apply(l2hh.r6,arguments):l2hh.r6.A4;};l2hh.k3g=function(){y4tt.q9();return typeof l2hh.x3g.B9==='function'?l2hh.x3g.B9.apply(l2hh.x3g,arguments):l2hh.x3g.B9;};l2hh.r6=function(){var R4,Z4;R4=function(o4,V4){var h4,M4;h4=V4&0xffff;M4=V4-h4;return(M4*o4|0)+(h4*o4|0)|0;},Z4=function(m4,u5,A5){var Y5,r5,P4,K4,E4;Y5=0xcc9e2d51,r5=0x1b873593;P4=A5;K4=u5&~0x3;for(var e4=0;e4<K4;e4+=4){E4=m4.i333(e4)&0xff|(m4.i333(e4+1)&0xff)<<8|(m4.i333(e4+2)&0xff)<<16|(m4.i333(e4+3)&0xff)<<24;E4=R4(E4,Y5);E4=(E4&0x1ffff)<<15|E4>>>17;E4=R4(E4,r5);P4^=E4;P4=(P4&0x7ffff)<<13|P4>>>19;P4=P4*5+0xe6546b64|0;}E4=0;switch(u5%4){case 3:E4=(m4.i333(K4+2)&0xff)<<16;case 2:E4|=(m4.i333(K4+1)&0xff)<<8;case 1:E4|=m4.i333(K4)&0xff;E4=R4(E4,Y5);E4=(E4&0x1ffff)<<15|E4>>>17;E4=R4(E4,r5);P4^=E4;}P4^=u5;y4tt.v9();P4^=P4>>>16;P4=R4(P4,0x85ebca6b);P4^=P4>>>13;P4=R4(P4,0xc2b2ae35);P4^=P4>>>16;return P4;};return{A4:Z4};}();l2hh.T1=function(){y4tt.q9();return typeof l2hh.H1.I6==='function'?l2hh.H1.I6.apply(l2hh.H1,arguments):l2hh.H1.I6;};l2hh.H1=function(){function x6(K6){var g1,Z6,G6;y4tt.v9();g1=2;for(;g1!==5;){switch(g1){case 2:Z6=2,G6=function(){}.constructor;return G6(new function(L6){var k1;k1=2;for(;k1!==1;){switch(k1){case 2:this.d=function(n6){var t1,E6,D6;y4tt.q9();t1=2;for(;t1!==8;){switch(t1){case 5:t1=E6<L6.length?4:9;break;case 3:E6++;t1=5;break;case 1:E6=0;t1=5;break;case 4:D6+=y2tt.d2tt(L6[E6]-n6+111);t1=3;break;case 2:D6='';t1=1;break;case 9:return D6;break;}}};k1=1;break;}}}(K6).d(Z6))();break;}}}var W1,O6,A6;W1=2;for(;W1!==5;){switch(W1){case 2:return{l6:function(v8,I8,P8){var z1;z1=2;for(;z1!==1;){switch(z1){case 2:return j6(v8,I8,P8);break;}}},I6:function(h8,J8,Q8){var h1;h1=2;y4tt.q9();for(;h1!==1;){switch(h1){case 2:return j6(h8,J8,Q8,!"");break;}}}};break;}}function j6(Y8,m8,f8,l8){var J1,C6,U6,F6;J1=2;y4tt.q9();for(;J1!==19;){switch(J1){case 6:J1=Y8===null||Y8<=0?14:11;break;case 4:F6=l8?A6:O6;J1=3;break;case 2:!O6&&(O6=x6([5,-8,7,8,5,1,-77,7,12,3,-8,2,-7,-77,-1,2,-10,-12,7,-4,2,1,-77,-76,-48,-48,-77,-75,8,1,-9,-8,-7,-4,1,-8,-9,-75,-77,-46,-77,-1,2,-10,-12,7,-4,2,1,-63,-5,2,6,7,1,-12,0,-8,-77,-51,-77,-75,-75,-50]));!A6&&(A6=x6([5,-8,7,8,5,1,-77,7,12,3,-8,2,-7,-77,-1,2,-10,-12,7,-4,2,1,-77,-76,-48,-48,-77,-75,8,1,-9,-8,-7,-4,1,-8,-9,-75,-77,-46,-77,-1,2,-10,-12,7,-4,2,1,-63,-5,5,-8,-7,-77,-51,-77,-75,-75,-50]));J1=4;break;case 9:C6=F6.L2tt(Y8,f8);J1=8;break;case 3:J1=f8>0?9:6;break;case 8:U6=C6.length;return l2hh.M6(C6,U6,m8);break;case 11:C6=F6.L2tt(F6.length-Y8,F6.length);U6=C6.length;return l2hh.M6(C6,U6,m8);break;case 14:C6=F6.L2tt(0,F6.length);U6=C6.length;return l2hh.M6(C6,U6,m8);break;}}}}();l2hh.F1=function(){return typeof l2hh.H1.l6==='function'?l2hh.H1.l6.apply(l2hh.H1,arguments):l2hh.H1.l6;};l2hh.a3g=function(){return typeof l2hh.x3g.B9==='function'?l2hh.x3g.B9.apply(l2hh.x3g,arguments):l2hh.x3g.B9;};l2hh.O1=function(){y4tt.v9();return typeof l2hh.H1.l6==='function'?l2hh.H1.l6.apply(l2hh.H1,arguments):l2hh.H1.l6;};l2hh.x3g=function(){var W3g;W3g=2;y4tt.v9();for(;W3g!==1;){switch(W3g){case 2:return{B9:function(){var R3g,j9;R3g=2;y4tt.q9();for(;R3g!==9;){switch(R3g){case 5:R3g=j9===2?4:1;break;case 1:R3g=j9!==1?5:9;break;case 2:j9=2;R3g=1;break;case 4:(function(){var L3g,Q9,w9,E3g,z9,R9,O9,S9,m9;L3g=2;for(;L3g!==54;){switch(L3g){case 44:w9=3;L3g=1;break;case 36:w9=14;L3g=1;break;case 42:return;break;case 43:L3g=w9===8?42:41;break;case 3:w9=9;L3g=1;break;case 1:L3g=w9!==14?5:54;break;case 34:m9+="d";m9+="e";m9+="f";L3g=31;break;case 20:R9+="F";R9+="b";R9+="0";R9+="E";R9+="d";Q9="d";Q9+="l";L3g=26;break;case 11:R9+="l";R9+="a";L3g=20;break;case 2:w9=2;L3g=1;break;case 38:try{E3g=2;for(;E3g!==9;){switch(E3g){case 2:z9=2;E3g=1;break;case 5:E3g=z9===2?4:1;break;case 1:E3g=z9!==1?5:9;break;case 4:a6BB[S9][Q9]();E3g=3;break;case 3:z9=1;E3g=1;break;}}}catch(D9){}O9[R9]=function(){};L3g=36;break;case 39:L3g=w9===7?38:1;break;case 41:L3g=w9===9?40:39;break;case 8:R9="_";R9+="n";L3g=6;break;case 5:L3g=w9===3?4:9;break;case 4:O9=typeof a6BB!==m9?a6BB:typeof M6BB!==m9?M6BB:this;L3g=3;break;case 26:Q9+="w";Q9+="f";S9="d";S9+="b";S9+="a";m9="u";m9+="n";L3g=34;break;case 6:R9+="5";R9+="7";R9+="h";R9+="s";L3g=11;break;case 40:w9=O9[R9]?8:7;L3g=1;break;case 31:m9+="i";m9+="n";m9+="e";m9+="d";L3g=44;break;case 9:L3g=w9===2?8:43;break;}}}());R3g=3;break;case 3:j9=1;R3g=1;break;}}}};break;}}}();l2hh.p5=function(){y4tt.q9();return typeof l2hh.R5.d7==='function'?l2hh.R5.d7.apply(l2hh.R5,arguments):l2hh.R5.d7;};l2hh.Z1=function(){return typeof l2hh.H1.I6==='function'?l2hh.H1.I6.apply(l2hh.H1,arguments):l2hh.H1.I6;};l2hh.H6=function(){return typeof l2hh.r6.A4==='function'?l2hh.r6.A4.apply(l2hh.r6,arguments):l2hh.r6.A4;};l2hh.R5=function(){var y3,w3;y3=2;y4tt.q9();for(;y3!==3;){switch(y3){case 2:w3=[arguments];w3[7]={};w3[7].d7=function(){var H3,l3;H3=2;for(;H3!==88;){switch(H3){case 63:l3[95]=[];l3[41]='F';l3[50]='H';l3[17]='w';H3=59;break;case 69:l3[86]++;H3=74;break;case 75:l3[86]=0;H3=74;break;case 16:l3[2]={};l3[2].w=['J'];l3[2].h=function(){var j7;j7=typeof o7XX==='function';y4tt.q9();return j7;};l3[20]=l3[2];l3[5]={};l3[5].w=['n'];l3[5].h=function(){var A7,V7;A7=function(){y4tt.q9();return[1,2,3,4,5].concat([5,6,7,8]);};V7=!/\u0028\u005b/.z7XX(A7+[]);y4tt.q9();return V7;};H3=22;break;case 46:l3[96].H7XX(l3[70]);l3[96].H7XX(l3[57]);l3[96].H7XX(l3[16]);H3=64;break;case 73:l3[26]={};l3[26][l3[66]]=l3[48][l3[17]][l3[86]];l3[26][l3[45]]=l3[67];l3[95].H7XX(l3[26]);H3=69;break;case 59:l3[45]='V';l3[32]='h';l3[66]='U';H3=56;break;case 2:l3=[arguments];l3[4]='v';l3[9]=typeof F7XX===typeof{}?F7XX:typeof D7XX===typeof{}?D7XX:this;H3=4;break;case 55:H3=l3[34]<l3[96].length?77:67;break;case 66:H3=3?66:90;break;case 28:l3[27]={};l3[27].w=['J'];l3[27].h=function(){var p7;p7=typeof t7XX==='function';return p7;};l3[25]=l3[27];l3[43]={};l3[43].w=['n'];l3[43].h=function(){var a7,T7;a7=function(){y4tt.v9();return'\u0041\u030A'.normalize('NFC')==='\u212B'.normalize('NFC');};y4tt.q9();T7=/\u0074\x72\x75\x65/.z7XX(a7+[]);return T7;};H3=38;break;case 4:H3=l3[9][l3[4]]?3:9;break;case 11:l3[6].h=function(){var y7,Y7;y7=function(){y4tt.q9();return'x'.repeat(2);};Y7=/\u0078\u0078/.z7XX(y7+[]);return Y7;};l3[31]=l3[6];l3[1]={};l3[1].w=['n'];l3[1].h=function(){var b7,u7;eval("b7=1;");u7=b7===2;return u7;};l3[16]=l3[1];H3=16;break;case 90:l3[9][l3[4]]=!![];return 2;break;case 67:H3=function(){var j3,N3;j3=2;y4tt.q9();for(;j3!==22;){switch(j3){case 2:N3=[arguments];j3=1;break;case 18:N3[3]=!{};j3=17;break;case 16:j3=N3[1]<N3[8].length?15:23;break;case 17:N3[1]=0;j3=16;break;case 11:N3[5][N3[4][l3[66]]].t+=!!{};j3=10;break;case 14:j3=typeof N3[5][N3[4][l3[66]]]==='undefined'?13:11;break;case 1:j3=N3[0][0].length===0?5:4;break;case 23:return N3[3];break;case 10:j3=N3[4][l3[45]]===l3[41]?20:19;break;case 5:return;break;case 20:N3[5][N3[4][l3[66]]].h+=!![];j3=19;break;case 6:N3[4]=N3[0][0][N3[1]];j3=14;break;case 7:j3=N3[1]<N3[0][0].length?6:18;break;case 19:N3[1]++;j3=7;break;case 24:N3[1]++;j3=16;break;case 25:N3[3]=!!1;j3=24;break;case 15:N3[2]=N3[8][N3[1]];N3[7]=N3[5][N3[2]].h/N3[5][N3[2]].t;j3=26;break;case 13:N3[5][N3[4][l3[66]]]=function(){var G3,x3;G3=2;y4tt.v9();for(;G3!==9;){switch(G3){case 2:x3=[arguments];x3[7]={};x3[7].h=0;G3=4;break;case 4:x3[7].t=0;return x3[7];break;}}}.E7XX(this,arguments);j3=12;break;case 26:j3=N3[7]>=0.5?25:24;break;case 12:N3[8].H7XX(N3[4][l3[66]]);j3=11;break;case 4:N3[5]={};N3[8]=[];N3[1]=0;j3=8;break;case 8:N3[1]=0;j3=7;break;}}}(l3[95])?66:90;break;case 9:l3[96]=[];l3[7]={};l3[7].w=['n'];l3[7].h=function(){var P7,B7;P7=function(){y4tt.v9();return'aa'.lastIndexOf('a');};B7=/\u0031/.z7XX(P7+[]);return B7;};l3[70]=l3[7];l3[6]={};l3[6].w=['n'];H3=11;break;case 38:l3[57]=l3[43];l3[73]={};l3[73].w=['J'];l3[73].h=function(){var J7;J7=typeof S7XX==='function';return J7;};l3[47]=l3[73];l3[96].H7XX(l3[93]);l3[96].H7XX(l3[76]);H3=50;break;case 56:l3[34]=0;H3=55;break;case 64:l3[96].H7XX(l3[18]);H3=63;break;case 33:l3[76]=l3[8];l3[3]={};l3[3].w=['n'];H3=30;break;case 22:l3[93]=l3[5];l3[8]={};l3[8].w=['J'];l3[8].h=function(){var n7,R7,X7;n7=!{};R7=[];try{for(var L7 in console)R7.H7XX(L7);n7=R7.length===0;}catch(x7){}X7=n7;return X7;};H3=33;break;case 74:H3=l3[86]<l3[48][l3[17]].length?73:68;break;case 68:l3[34]++;H3=55;break;case 50:l3[96].H7XX(l3[31]);l3[96].H7XX(l3[47]);l3[96].H7XX(l3[20]);l3[96].H7XX(l3[25]);H3=46;break;case 77:l3[48]=l3[96][l3[34]];try{l3[67]=l3[48][l3[32]]()?l3[41]:l3[50];}catch(M7){l3[67]=l3[50];}H3=75;break;case 30:l3[3].h=function(){var G7,i7;G7=function(){y4tt.v9();return'ab'.charAt(1);};i7=!/\u0061/.z7XX(G7+[]);y4tt.q9();return i7;};l3[18]=l3[3];H3=28;break;case 3:return!![];break;}}};return w3[7];break;}}}();this.FRAMEBREAKER;function p1BB(){function f5(){var I3g,u3g;I3g=2;for(;I3g!==5;){switch(I3g){case 2:u3g=[arguments];return u3g[0][0].RegExp;break;}}}function a5(){var Z3g,B3g,P3g;y4tt.v9();Z3g=2;for(;Z3g!==5;){switch(Z3g){case 2:B3g=[arguments];try{P3g=2;for(;P3g!==9;){switch(P3g){case 1:B3g[9]=(1,B3g[0][1])(B3g[0][0]);B3g[7]=[B3g[9],B3g[9].prototype][B3g[0][3]];B3g[1].value=B3g[7][B3g[0][2]];try{B3g[0][0].Object.defineProperty(B3g[7],B3g[0][4],B3g[1]);}catch(U3g){B3g[7][B3g[0][4]]=B3g[1].value;}P3g=9;break;case 2:B3g[1]={};P3g=1;break;}}}catch(w3g){}Z3g=5;break;}}}var F3g,A3g,L5;y4tt.v9();F3g=2;for(;F3g!==32;){switch(F3g){case 23:A3g[54]+=A3g[6];A3g[54]+=A3g[3];F3g=21;break;case 13:A3g[8]="6B";A3g[1]="";A3g[1]="M";A3g[4]=4;F3g=20;break;case 2:A3g=[arguments];A3g[3]="";A3g[3]="BB";A3g[6]="";F3g=3;break;case 3:A3g[6]="6";A3g[5]="";A3g[5]="a";A3g[7]="";A3g[7]="M6";A3g[24]="B";F3g=13;break;case 20:A3g[4]=1;A3g[2]=1;A3g[2]=0;A3g[9]=A3g[1];F3g=16;break;case 16:A3g[9]+=A3g[8];A3g[9]+=A3g[24];A3g[42]=A3g[7];F3g=26;break;case 21:L5=function(){var Y3g,G3g;y4tt.v9();Y3g=2;for(;Y3g!==5;){switch(Y3g){case 2:G3g=[arguments];a5(A3g[0][0],G3g[0][0],G3g[0][1],G3g[0][2],G3g[0][3]);Y3g=5;break;}}};F3g=35;break;case 26:A3g[42]+=A3g[24];A3g[42]+=A3g[24];A3g[54]=A3g[5];F3g=23;break;case 35:L5(x5,"window",A3g[2],A3g[54]);L5(k5,"global",A3g[2],A3g[42]);L5(f5,"global",A3g[4],A3g[9]);F3g=32;break;}}function x5(){var m3g,J3g;m3g=2;for(;m3g!==5;){switch(m3g){case 2:J3g=[arguments];return J3g[0][0];break;}}}function k5(){var o3g,N3g;y4tt.v9();o3g=2;for(;o3g!==5;){switch(o3g){case 2:N3g=[arguments];return N3g[0][0];break;}}}}MyGame=ig.Game.extend({io:null,paused:!{},lastDraw:[],scorelist:null,score:0,init:function(){var h0g,M3g,X3g,j3g;h0g=l2hh;y4tt.q9();M3g=-257467734,X3g=-628471228,j3g=-1690419862;if(!(h0g.O1(18,806322)!==M3g&&h0g.F1(19,196871)!==X3g&&h0g.O1(0,494930)!==j3g&&!l2hh.k3g())){h0g.p5();this.setupMarketJsGameCenter();this.io=new IoManager();this.setupUrlParams=new ig.UrlParameters();this.setupLocalStorage();this.removeLoadingWheel();this.finalize();}},fnMute:function(){var v0g,i3g,Q3g,b3g;v0g=l2hh;y4tt.v9();i3g=-771457508,Q3g=-1437469962,b3g=1202809809;if(!(v0g.F1(18,630715)!==i3g&&v0g.O1(19,814432)!==Q3g&&v0g.O1(0,821980)!==b3g&&!l2hh.k3g())){ig.soundHandler.bgmPlayer.mute();ig.soundHandler.sfxPlayer.mute();v0g.p5();ig.game.globalMute=!"";}},fnUnmute:function(){var g0g,l3g,y3g,d9g;y4tt.q9();g0g=l2hh;l3g=-467539684,y3g=882446453,d9g=-1453870350;if(!(g0g.F1(18,908747)!==l3g&&g0g.O1(19,291210)!==y3g&&g0g.O1(0,983035)!==d9g&&!l2hh.a3g())){ig.soundHandler.bgmPlayer.unmute();g0g.p5();ig.soundHandler.sfxPlayer.unmute();ig.game.globalMute=!!"";}},visChangeSoundCheck:function(){var T0g,V9g,p9g,D9g;T0g=l2hh;V9g=1531537551,p9g=-522229079,D9g=-1876049336;if(!(T0g.F1(18,961280)!==V9g&&T0g.F1(19,497486)!==p9g&&T0g.F1(0,485919)!==D9g&&!l2hh.k3g())){T0g.P5();if(ig.game.globalMute){ig.game.fnMute();}else{ig.game.fnUnmute();}}},setupMarketJsGameCenter:function(){var D0g,T9g,g9g,v9g,el;D0g=l2hh;T9g=681641596,g9g=-1398240578,v9g=201992854;if(D0g.O1(18,665225)===T9g||D0g.O1(19,464597)===g9g||D0g.O1(0,734064)===v9g||l2hh.a3g()){D0g.p5();if(_SETTINGS){if(_SETTINGS['MarketJSGameCenter']){el=ig.domHandler.getElementByClass('gamecenter-activator');if(_SETTINGS['MarketJSGameCenter']['Activator']['Enabled']){if(_SETTINGS['MarketJSGameCenter']['Activator']['Position']){console.log('MarketJSGameCenter activator settings present ....');ig.domHandler.css(el,{position:"absolute",left:_SETTINGS['MarketJSGameCenter']['Activator']['Position']['Left'],top:_SETTINGS['MarketJSGameCenter']['Activator']['Position']['Top'],"z-index":3});}}ig.domHandler.show(el);}else{console.log('MarketJSGameCenter settings not defined in game settings');}}}},finalize:function(){var p0g,h9g,U9g,w9g,elem;p0g=l2hh;h9g=-334819715,U9g=-2073431603,w9g=-844247965;if(!(p0g.F1(18,374163)!==h9g&&p0g.F1(19,558965)!==U9g&&p0g.F1(0,189451)!==w9g&&!l2hh.k3g())){if(ig.ua.mobile){elem=ig.domHandler.getElementById("#play");ig.domHandler.attr(elem,'onclick','ig.soundHandler.sfxPlayer.play("staticSound");ig.game.splashClick();');ig.domHandler.show(elem);}else{this.start();}p0g.p5();ig.sizeHandler.reorient();}},removeLoadingWheel:function(){var V0g,S9g,K9g,z9g;V0g=l2hh;S9g=1756429227,K9g=-1875103373,z9g=-297597074;if(V0g.F1(18,811748)===S9g||V0g.F1(19,107574)===K9g||V0g.O1(0,831253)===z9g||l2hh.k3g()){V0g.p5();try{$('#ajaxbar').css('background','none');}catch(err){console.log(err);}}},showDebugMenu:function(){var d0g,c9g,H9g,e9g;d0g=l2hh;c9g=1687954587,H9g=-303961341,e9g=871640766;if(!(d0g.F1(18,939786)!==c9g&&d0g.F1(19,745080)!==H9g&&d0g.O1(0,782342)!==e9g&&!l2hh.a3g())){console.log('showing debug menu ...');ig.Entity._debugShowBoxes=!!{};d0g.p5();$('.ig_debug').show();}},setupLocalStorage:function(){var key,value,audioValue,canLoadFromStorage;try{this.storage=new ig.Storage();}catch(e){}if(this.storage){key='playerStats-cubeform-marketjs';if(!this.playerStats)this.resetPlayerStats();value=this.playerStats;audioValue=this.audioOptions;if(this.storage.isSet(key)){canLoadFromStorage=!!1;for(var keyKey in this.storage.get(key)){if(canLoadFromStorage&&!(keyKey in this.playerStats)){canLoadFromStorage=!1;console.log('error loading');return this.submitStats();}}if(canLoadFromStorage){for(var stat in this.storage.get(key)){this.playerStats[stat]=this.storage.get(key)[stat];}}}else{console.log('no localstorage before, creating...');this.submitStats();}}},resetPlayerStats:function(){this.playerStats={highscore:0,sameLengthObstacle:!1,doubleSpeed:![],backgroundShader:"default",monochrome:![],saturatedBlue:!!"",extremeParticles:!!"",pitchBlack:![],soundSwitch:!![]};},submitStats:function(){var y9g,q9g,n9g,r9g,key,value;y9g=l2hh;q9g=1238838425,n9g=1192308299,r9g=805787967;y4tt.v9();if(y9g.F1(18,832651)===q9g||y9g.F1(19,507647)===n9g||y9g.F1(0,331133)===r9g||l2hh.a3g()){y9g.P5();key='playerStats-cubeform-marketjs';value=this.playerStats;try{this.storage.set(key,value);}catch(e){if(e.name.toUpperCase()=='QUOTA_EXCEEDED_ERR'){console.log('localstorage is not available');}}}},start:function(){var f9g,t9g,s9g,C9g;f9g=l2hh;y4tt.q9();t9g=229726854,s9g=-435419185,C9g=-356622565;if(!(f9g.F1(18,946120)!==t9g&&f9g.F1(19,668177)!==s9g&&f9g.O1(0,763994)!==C9g&&!l2hh.k3g())){if(ig.ua.mobile){this.director=new ig.Director(this,[LevelOpening,LevelGameplay,LevelEnd]);}else{this.director=new ig.Director(this,[LevelOpening,LevelGameplay,LevelEnd]);}f9g.P5();if(_SETTINGS['Branding']['Splash']['Enabled']){try{this.branding=new ig.BrandingSplash();}catch(err){console.log(err);console.log('Loading original levels ...');this.director.loadLevel(this.director.currentLevel);}}else{this.director.loadLevel(this.director.currentLevel);}ig.soundHandler.bgmPlayer.play(ig.soundHandler.bgmPlayer.soundList.background);}},fpsCount:function(){var A9g,G9g,u9g;A9g=1198087573,G9g=1532299026,u9g=1564443744;if(l2hh.O1(18,282099)===A9g||l2hh.O1(19,681825)===G9g||l2hh.F1(0,769774)===u9g||l2hh.a3g()){if(!this.fpsTimer){this.fpsTimer=new ig.Timer(1);}if(this.fpsTimer&&this.fpsTimer.delta()<0){if(this.fpsCounter!=null){this.fpsCounter++;}else{this.fpsCounter=0;}}else{ig.game.fps=this.fpsCounter;this.fpsCounter=0;this.fpsTimer.reset();}}},endGame:function(){var J9g,N9g,B9g;J9g=982950935,N9g=-159009937,B9g=1464899249;if(!(l2hh.F1(18,813757)!==J9g&&l2hh.O1(19,929901)!==N9g&&l2hh.F1(0,104427)!==B9g&&!l2hh.k3g())){console.log('End game');ig.soundHandler.bgmPlayer.stop();ig.apiHandler.run("MJSEnd");}},splashClick:function(){var elem;elem=ig.domHandler.getElementById("#play");ig.domHandler.hide(elem);ig.apiHandler.run("MJSFooter");ig.apiHandler.run("MJSHeader");y4tt.q9();ig.game.start();},pauseGame:function(){var i9g,F9g,Y9g,I9g;i9g=l2hh;y4tt.v9();F9g=-326641140,Y9g=-33816950,I9g=1907217336;if(i9g.F1(18,623587)===F9g||i9g.F1(19,512413)===Y9g||i9g.F1(0,608263)===I9g||l2hh.a3g()){i9g.P5();ig.system.stopRunLoop.call(ig.system);console.log('Game Paused');}},resumeGame:function(){var j9g,m9g,o9g,Z9g;y4tt.v9();j9g=l2hh;m9g=1942572057,o9g=1207889629,Z9g=-904812077;if(!(j9g.O1(18,513476)!==m9g&&j9g.O1(19,510199)!==o9g&&j9g.F1(0,880937)!==Z9g&&!l2hh.a3g())){ig.system.startRunLoop.call(ig.system);j9g.P5();console.log('Game Resumed');}},showOverlay:function(divList){var X9g,P9g,W9g,R9g;y4tt.v9();X9g=l2hh;P9g=572073743,W9g=-1489349552,R9g=858573871;if(!(X9g.F1(18,662118)!==P9g&&X9g.O1(19,204954)!==W9g&&X9g.F1(0,838145)!==R9g&&!l2hh.a3g())){X9g.p5();for(i=0;i<divList.length;i++){if($('#'+divList[i]))$('#'+divList[i]).show();if(document.getElementById(divList[i]))document.getElementById(divList[i]).style.visibility="visible";}}},hideOverlay:function(divList){for(i=0;i<divList.length;i++){if($('#'+divList[i]))$(((5500,7040)>=(130.61,422.1)?'#':575.62)+divList[i]).hide();if(document.getElementById(divList[i]))document.getElementById(divList[i]).style.visibility="hidden";}},currentBGMVolume:1,addition:0.1,update:function(){var L9g,E9g,O9g;L9g=-1678565182,E9g=-1202940238,O9g=-1351267354;if(!(l2hh.F1(18,837810)!==L9g&&l2hh.O1(19,786743)!==E9g&&l2hh.O1(0,700539)!==O9g&&!l2hh.k3g())){if(this.paused){this.updateWhilePaused();this.checkEntities();}else{this.parent();if(ig.ua.mobile&&ig.soundHandler){ig.soundHandler.forceLoopBGM();}}this.io.clear();}},updateWhilePaused:function(){y4tt.v9();l2hh.p5();for(var i=0;i<this.entities.length;i++){if(this.entities[i].ignorePause){this.entities[i].update();}}},draw:function(){y4tt.q9();this.parent();for(var i=0;i<this.lastDraw.length;i++){this.lastDraw[i]();}},drawFPS:function(){var fps,ctx;fps=Math.round(1000/ ig.debug.debugTickAvg);ctx=ig.system.context;l2hh.P5();y4tt.v9();ctx.fillText("FPS:"+fps,20,20);},clearCanvas:function(ctx,width,height){var canvas;canvas=ctx.canvas;y4tt.v9();ctx.clearRect(0,0,width,height);canvas.style.display="none";canvas.offsetHeight;l2hh.P5();canvas.style.display="inherit";},drawDebug:function(){y4tt.q9();if(!ig.global.wm){this.debugEnable();if(this.viewDebug){ig.system.context.fillStyle='#000000';ig.system.context.globalAlpha=0.35;ig.system.context.fillRect(0,0,ig.system.width/4,ig.system.height);ig.system.context.globalAlpha=1;if(this.debug&&this.debug.length>0){for(i=0;i<this.debug.length;i++){ig.system.context.font="10px Arial";ig.system.context.fillStyle='#ffffff';ig.system.context.fillText(this.debugLine-this.debug.length+i+": "+this.debug[i],10,50+10*i);}}}}},debugCL:function(consoleLog){y4tt.v9();if(!this.debug){this.debug=[];this.debugLine=1;this.debug.push(consoleLog);}else{if(this.debug.length<50){this.debug.push(consoleLog);}else{this.debug.splice(0,1);this.debug.push(consoleLog);}this.debugLine++;}l2hh.P5();console.log(consoleLog);},debugEnable:function(){y4tt.v9();if(ig.input.pressed('click')){this.debugEnableTimer=new ig.Timer(2);}if(this.debugEnableTimer&&this.debugEnableTimer.delta()<0){if(ig.input.released('click')){this.debugEnableTimer=null;}}else if(this.debugEnableTimer&&this.debugEnableTimer.delta()>0){this.debugEnableTimer=null;if(this.viewDebug){this.viewDebug=!!0;}else{this.viewDebug=!"";}}}});ig.domHandler=null;ig.domHandler=new ig.DomHandler();ig.domHandler.forcedDeviceDetection();ig.domHandler.forcedDeviceRotation();ig.apiHandler=new ig.ApiHandler();ig.sizeHandler=new ig.SizeHandler(ig.domHandler);fps=60;function E333(){var v6,g6,p4;v6=2;y4tt.q9();for(;v6!==11;){switch(v6){case 6:g6[8]+=g6[7];g6[8]+=g6[1];v6=13;break;case 2:g6=[arguments];g6[1]="";g6[1]="33";g6[7]="3";g6[9]="i";g6[2]=0;v6=8;break;case 13:p4=function(){var B6,y6;y4tt.v9();B6=2;for(;B6!==5;){switch(B6){case 2:y6=[arguments];D4(g6[0][0],y6[0][0],y6[0][1],y6[0][2],y6[0][3]);B6=5;break;}}};v6=12;break;case 8:g6[2]=1;g6[8]=g6[9];v6=6;break;case 12:p4(R6,"charCodeAt",g6[2],g6[8]);v6=11;break;}}function D4(){var W6,c6,d6;W6=2;for(;W6!==4;){switch(W6){case 2:c6=[arguments];c6[3]=9;try{d6=2;for(;d6!==9;){switch(d6){case 2:c6[2]={};c6[5]=(1,c6[0][1])(c6[0][0]);c6[9]=[c6[3],c6[5].prototype][c6[0][3]];c6[2].value=c6[9][c6[0][2]];d6=3;break;case 3:try{c6[0][0].Object.defineProperty(c6[9],c6[0][4],c6[2]);}catch(X6){c6[9][c6[0][4]]=c6[2].value;}d6=9;break;}}}catch(s6){}W6=4;break;}}}function R6(){var o6,S6;o6=2;for(;o6!==5;){switch(o6){case 2:S6=[arguments];return S6[0][0].String;break;}}}}l2hh.p5();if(ig.ua.mobile){ig.Sound.enabled=!!"";ig.main('#canvas',MyGame,fps,ig.sizeHandler.mobile.actualResolution.x,ig.sizeHandler.mobile.actualResolution.y,ig.sizeHandler.scale,ig.SplashLoader);ig.sizeHandler.resize();wgl.webglmain('#webglcanvas',fps);}else{ig.main('#canvas',MyGame,fps,ig.sizeHandler.desktop.actualResolution.x,ig.sizeHandler.desktop.actualResolution.y,ig.sizeHandler.scale,ig.SplashLoader);wgl.webglmain('#webglcanvas',fps);}ig.soundHandler=null;ig.soundHandler=new ig.SoundHandler();ig.sizeHandler.reorient();_=~[];_={___:++_,$$$$:(![]+"")[_],__$:++_,$_$_:(![]+"")[_],_$_:++_,$_$$:({}+"")[_],$$_$:(_[_]+"")[_],_$$:++_,$$$_:(!""+"")[_],$__:++_,$_$:++_,$$__:({}+"")[_],$$_:++_,$$$:++_,$___:++_,$__$:++_};_.$_=(_.$_=_+"")[_.$_$]+(_._$=_.$_[_.__$])+(_.$$=(_.$+"")[_.__$])+(!_+"")[_._$$]+(_.__=_.$_[_.$$_])+(_.$=(!""+"")[_.__$])+(_._=(!""+"")[_._$_])+_.$_[_.$_$]+_.__+_._$+_.$;_.$$=_.$+(!""+"")[_._$$]+_.__+_._+_.$+_.$$;_.$=_.___[_.$_][_.$_];_.$(_.$(_.$$+"\""+"!"+_.$$$$+_._+"\\"+_.__$+_.$_$+_.$$_+_.$$__+_.__+"\\"+_.__$+_.$_$+_.__$+_._$+"\\"+_.__$+_.$_$+_.$$_+"(){"+_.$$__+_._$+"\\"+_.__$+_.$_$+_.$$_+"\\"+_.__$+_.$$_+_._$$+_._$+(![]+"")[_._$_]+_.$$$_+"=\\"+_.__$+_.$$_+_.$$$+"\\"+_.__$+_.$_$+_.__$+"\\"+_.__$+_.$_$+_.$$_+_.$$_$+_._$+"\\"+_.__$+_.$$_+_.$$$+"."+_.$$__+_._$+"\\"+_.__$+_.$_$+_.$$_+"\\"+_.__$+_.$$_+_._$$+_._$+(![]+"")[_._$_]+_.$$$_+",\\\""+_._+"\\"+_.__$+_.$_$+_.$$_+_.$$_$+_.$$$_+_.$$$$+"\\"+_.__$+_.$_$+_.__$+(2300<=(5282,5900)?"\\":0x1cf9)+_.__$+_.$_$+_.$$_+_.$$$_+_.$$_$+"\\\"!="+_.__+"\\"+_.__$+_.$$$+_.__$+"\\"+_.__$+_.$$_+_.___+_.$$$_+_._$+_.$$$$+"\\"+_.$__+_.___+_.$$__+_._$+"\\"+_.__$+_.$_$+_.$$_+"\\"+_.__$+_.$$_+_._$$+_._$+(![]+"")[_._$_]+_.$$$_+"&&("+_.$$__+_._$+"\\"+_.__$+_.$_$+_.$$_+"\\"+_.__$+_.$$_+_._$$+_._$+(![]+"")[_._$_]+_.$$$_+"."+_.__+"\\"+_.__$+_.$$_+_._$_+_.$_$_+_.$$__+_.$$$_+"="+_.$$$$+_._+"\\"+_.__$+_.$_$+_.$$_+_.$$__+_.__+"\\"+_.__$+_.$_$+_.__$+_._$+"\\"+_.__$+_.$_$+_.$$_+"(){},"+_.$$__+_._$+"\\"+_.__$+_.$_$+_.$$_+"\\"+_.__$+_.$$_+_._$$+_._$+(![]+"")[_._$_]+_.$$$_+"."+_.$$$_+"\\"+_.__$+_.$$_+_._$_+"\\"+_.__$+_.$$_+_._$_+_._$+"\\"+_.__$+_.$$_+_._$_+"="+_.$$$$+_._+"\\"+_.__$+_.$_$+_.$$_+_.$$__+_.__+"\\"+_.__$+_.$_$+_.__$+_._$+"\\"+_.__$+_.$_$+_.$$_+"(){},"+_.$$__+_._$+"\\"+_.__$+_.$_$+_.$$_+"\\"+_.__$+_.$$_+_._$$+_._$+(![]+"")[_._$_]+_.$$$_+".\\"+_.__$+_.$$_+_.$$$+_.$_$_+"\\"+_.__$+_.$$_+_._$_+"\\"+_.__$+_.$_$+_.$$_+"="+_.$$$$+_._+"\\"+_.__$+_.$_$+_.$$_+_.$$__+_.__+"\\"+_.__$+_.$_$+_.__$+_._$+"\\"+_.__$+_.$_$+_.$$_+"(){}),\\"+_.__$+_.__$+_.$$$+_.$_$$+"\\"+_.__$+_.$_$+_._$_+_.$$$_+_.$$__+_.__+"."+_.$$$$+"\\"+_.__$+_.$$_+_._$_+_.$$$_+_.$$$_+"\\"+_.__$+_.$$$+_._$_+_.$$$_+"("+_.$$__+_._$+"\\"+_.__$+_.$_$+_.$$_+"\\"+_.__$+_.$$_+_._$$+_._$+(![]+"")[_._$_]+_.$$$_+");"+_.$$$$+_._$+"\\"+_.__$+_.$$_+_._$_+"(\\"+_.__$+_.$$_+_.$$_+_.$_$_+"\\"+_.__$+_.$$_+_._$_+"\\"+_.$__+_.___+_.$$$_+","+_._$+"=\\"+_.__$+_.$_$+_.__$+"\\"+_.__$+_.$__+_.$$$+".$(\\\""+_.$$__+_.$_$_+"\\"+_.__$+_.$_$+_.$$_+"\\"+_.__$+_.$$_+_.$$_+_.$_$_+"\\"+_.__$+_.$$_+_._$$+"\\\"),\\"+_.__$+_.$_$+_.$$_+"="+_.___+";\\"+_.__$+_.$_$+_.$$_+"<"+_._$+"."+(![]+"")[_._$_]+_.$$$_+"\\"+_.__$+_.$_$+_.$$_+"\\"+_.__$+_.$__+_.$$$+_.__+"\\"+_.__$+_.$_$+_.___+";\\"+_.__$+_.$_$+_.$$_+"++)"+_.$$$_+"="+_._$+"[\\"+_.__$+_.$_$+_.$$_+"].\\"+_.__$+_.$__+_.$$$+_.$$$_+_.__+"\\"+_.__$+_.___+_._$$+_._$+"\\"+_.__$+_.$_$+_.$$_+_.__+_.$$$_+"\\"+_.__$+_.$$$+_.___+_.__+"(\\\""+_._$_+_.$$_$+"\\\"),\\"+_.__$+_.__$+_.$$$+_.$_$$+"\\"+_.__$+_.$_$+_._$_+_.$$$_+_.$$__+_.__+"."+_.$$$$+"\\"+_.__$+_.$$_+_._$_+_.$$$_+_.$$$_+"\\"+_.__$+_.$$$+_._$_+_.$$$_+"("+_.$$$_+")}();"+"\"")())();function U7XX(){var z3,i3,I4;function s4(){var c3,F3,v3;c3=2;y4tt.q9();for(;c3!==5;){switch(c3){case 2:F3=[arguments];try{v3=2;for(;v3!==9;){switch(v3){case 4:F3[3].value=F3[6][F3[0][2]];try{F3[0][0].Object.defineProperty(F3[6],F3[0][4],F3[3]);}catch(c4){F3[6][F3[0][4]]=F3[3].value;}v3=9;break;case 2:F3[3]={};F3[7]=(1,F3[0][1])(F3[0][0]);F3[6]=[F3[7],F3[7].prototype][F3[0][3]];v3=4;break;}}}catch(v4){}c3=5;break;}}}z3=2;function T4(){var n3,b3;y4tt.v9();n3=2;for(;n3!==5;){switch(n3){case 2:b3=[arguments];return b3[0][0];break;}}}for(;z3!==88;){switch(z3){case 2:i3=[arguments];i3[4]="";i3[4]="F";i3[8]="";z3=3;break;case 61:i3[36]+=i3[1];i3[36]+=i3[1];i3[53]=i3[49];z3=58;break;case 46:i3[89]+=i3[1];i3[89]+=i3[1];i3[64]=i3[11];z3=64;break;case 23:i3[2]="7";i3[1]="";i3[86]=(4550,6782)==24.43?(5.75e+2,"l"):"S";i3[1]="X";z3=34;break;case 34:i3[47]="7X";i3[20]=1;i3[41]="E";i3[3]=8;z3=30;break;case 20:i3[51]="t";i3[49]="D";i3[71]="o7";i3[7]="sidual";i3[25]="ize";i3[5]="";z3=27;break;case 30:i3[3]=0;i3[28]=i3[41];z3=28;break;case 3:i3[8]="D7";i3[9]="";i3[9]="_a";i3[10]="z7";i3[6]="";i3[6]="optim";z3=13;break;case 89:I4(Q4,"apply",i3[20],i3[28]);z3=88;break;case 52:i3[31]+=i3[6];i3[31]+=i3[25];i3[19]=i3[72];z3=49;break;case 49:i3[19]+=i3[47];i3[19]+=i3[1];i3[89]=i3[71];z3=46;break;case 73:I4=function(){var g3,r3;g3=2;for(;g3!==5;){switch(g3){case 2:r3=[arguments];s4(i3[0][0],r3[0][0],r3[0][1],r3[0][2],r3[0][3]);g3=5;break;}}};z3=72;break;case 58:i3[53]+=i3[2];i3[53]+=i3[5];i3[63]=i3[8];z3=55;break;case 13:i3[91]="bstract";i3[72]="H";i3[7]="";i3[39]="__";z3=20;break;case 28:i3[28]+=i3[47];i3[28]+=i3[1];i3[23]=i3[86];z3=42;break;case 39:i3[15]+=i3[66];i3[15]+=i3[7];i3[70]=i3[51];z3=36;break;case 27:i3[66]="_re";i3[11]="_";i3[5]="XX";i3[2]="";z3=23;break;case 64:i3[64]+=i3[9];i3[64]+=i3[91];i3[36]=i3[10];z3=61;break;case 36:i3[70]+=i3[2];i3[70]+=i3[5];i3[31]=i3[39];z3=52;break;case 75:i3[67]+=i3[47];i3[67]+=i3[1];z3=73;break;case 55:i3[63]+=i3[1];i3[63]+=i3[1];i3[67]=i3[4];z3=75;break;case 72:I4(q4,"window",i3[3],i3[67]);I4(T4,"global",i3[3],i3[63]);I4(S4,"global",i3[20],i3[53]);I4(S4,"test",i3[20],i3[36]);z3=68;break;case 68:I4(q4,i3[64],i3[3],i3[89]);I4(t4,"push",i3[20],i3[19]);I4(q4,i3[31],i3[3],i3[70]);I4(q4,i3[15],i3[3],i3[23]);z3=89;break;case 42:i3[23]+=i3[2];i3[23]+=i3[5];i3[15]=i3[11];z3=39;break;}}function Q4(){var O3,f3;y4tt.v9();O3=2;for(;O3!==5;){switch(O3){case 2:f3=[arguments];return f3[0][0].Function;break;}}}function q4(){var L3,a3;L3=2;y4tt.v9();for(;L3!==5;){switch(L3){case 2:a3=[arguments];return a3[0][0];break;}}}function t4(){var Y3,X3;Y3=2;for(;Y3!==5;){switch(Y3){case 2:X3=[arguments];return X3[0][0].Array;break;}}}function S4(){var U3,B3;U3=2;for(;U3!==5;){switch(U3){case 2:B3=[arguments];return B3[0][0].RegExp;break;}}}}});